\hypertarget{md2cmds_8c}{\section{md2cmds.\-c File Reference}
\label{md2cmds_8c}\index{md2cmds.\-c@{md2cmds.\-c}}
}


Implements commands to run the md2 diffractometer attached to a P\-M\-A\-C controled by postgresql.  


{\ttfamily \#include \char`\"{}pgpmac.\-h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{md2cmds_8c_adba92015101973846ee66a33ea39addf}{md2cmds\-\_\-transfer} ()
\begin{DoxyCompactList}\small\item\em Transfer a sample T\-O\-D\-O\-: Implement. \end{DoxyCompactList}\item 
char $\ast$ \hyperlink{md2cmds_8c_a0b466dd608ba033b0b618c6dce8b2601}{logtime} ()
\begin{DoxyCompactList}\small\item\em Return a time string for loggin Time is from the first call to this funciton. \end{DoxyCompactList}\item 
void \hyperlink{md2cmds_8c_a82542bd5f69f6975583bbd9dfadec0cb}{md2cmds\-\_\-move\-Abs} (char $\ast$cmd)
\begin{DoxyCompactList}\small\item\em Move a motor to the position requested. \end{DoxyCompactList}\item 
void \hyperlink{md2cmds_8c_afc2d53af3d531cfaae116e7b57077347}{md2cmds\-\_\-mvcenter\-\_\-prep} ()
\begin{DoxyCompactList}\small\item\em Sets up a centering table and alignment table move Ensures that when we issue the move command that we can detect that the move happened. \end{DoxyCompactList}\item 
void \hyperlink{md2cmds_8c_afdc46152b46ae4d37c73407b83016b78}{md2cmds\-\_\-mvcenter\-\_\-move} (double cx, double cy, double ax, double ay, double az)
\begin{DoxyCompactList}\small\item\em Move the centering and alignment tables. \end{DoxyCompactList}\item 
void \hyperlink{md2cmds_8c_a9073a0af983da505daff01e954f0c430}{md2cmds\-\_\-mvcenter\-\_\-wait} ()
\begin{DoxyCompactList}\small\item\em Wait for the centering and alignment tables to stop moving. \end{DoxyCompactList}\item 
void \hyperlink{md2cmds_8c_af4a069c2e8a1e3957d15487672b18d47}{md2cmds\-\_\-collect} ()
\begin{DoxyCompactList}\small\item\em Collect some data. \end{DoxyCompactList}\item 
void \hyperlink{md2cmds_8c_ac9e84b4a527da535d21cca65dc4aa61a}{md2cmds\-\_\-rotate} ()
\begin{DoxyCompactList}\small\item\em Spin 360 and make a video (recenter first, maybe) \end{DoxyCompactList}\item 
void \hyperlink{md2cmds_8c_a5a9d72c08597ffe45287622c40975e7f}{md2cmds\-\_\-center} ()
\begin{DoxyCompactList}\small\item\em Move centering and alignment tables as requested T\-O\-D\-O\-: Implement. \end{DoxyCompactList}\item 
void $\ast$ \hyperlink{md2cmds_8c_ae967e769d23555a631f615e630f25b00}{md2cmds\-\_\-worker} (void $\ast$dummy)
\begin{DoxyCompactList}\small\item\em Our worker thread. \end{DoxyCompactList}\item 
void \hyperlink{md2cmds_8c_a0851b1baecda6a67993efde41d77b1c1}{md2cmds\-\_\-init} ()
\begin{DoxyCompactList}\small\item\em Initialize the md2cmds module. \end{DoxyCompactList}\item 
void \hyperlink{md2cmds_8c_aa62da7d423952334d41c7d282f45233d}{md2cmds\-\_\-run} ()
\begin{DoxyCompactList}\small\item\em Start up the thread. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
pthread\-\_\-cond\-\_\-t \hyperlink{md2cmds_8c_a08d5b18ec9478d753c46a3e28d1f2126}{md2cmds\-\_\-cond}
\begin{DoxyCompactList}\small\item\em condition to signal when it's time to run an md2 command \end{DoxyCompactList}\item 
pthread\-\_\-mutex\-\_\-t \hyperlink{md2cmds_8c_ad67304bb851dc6268b0cda2f40fc5aa8}{md2cmds\-\_\-mutex}
\begin{DoxyCompactList}\small\item\em mutex for the condition \end{DoxyCompactList}\item 
pthread\-\_\-cond\-\_\-t \hyperlink{md2cmds_8c_ab517a930528e2b7d0993e11087765b03}{md2cmds\-\_\-pg\-\_\-cond}
\begin{DoxyCompactList}\small\item\em coordinate call and response \end{DoxyCompactList}\item 
pthread\-\_\-mutex\-\_\-t \hyperlink{md2cmds_8c_a4d2c3ac81d4b13eb21f4ddcdda8c7308}{md2cmds\-\_\-pg\-\_\-mutex}
\begin{DoxyCompactList}\small\item\em message passing between md2cmds and pg \end{DoxyCompactList}\item 
char \hyperlink{md2cmds_8c_a5f0fe1e2dfa92cf345b8c29134ab1ede}{md2cmds\-\_\-cmd} \mbox{[}\hyperlink{pgpmac_8h_a30f0f377b0f0695284145d420ea51846}{M\-D2\-C\-M\-D\-S\-\_\-\-C\-M\-D\-\_\-\-L\-E\-N\-G\-T\-H}\mbox{]}
\begin{DoxyCompactList}\small\item\em our command; \end{DoxyCompactList}\item 
static pthread\-\_\-t \hyperlink{md2cmds_8c_aa230921945149692de98fff15c01962f}{md2cmds\-\_\-thread}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Implements commands to run the md2 diffractometer attached to a P\-M\-A\-C controled by postgresql. \begin{DoxyDate}{Date}
2012 
\end{DoxyDate}
\begin{DoxyAuthor}{Author}
Keith Brister 
\end{DoxyAuthor}
\begin{DoxyCopyright}{Copyright}
All Rights Reserved 
\end{DoxyCopyright}


Definition in file \hyperlink{md2cmds_8c_source}{md2cmds.\-c}.



\subsection{Function Documentation}
\hypertarget{md2cmds_8c_a0b466dd608ba033b0b618c6dce8b2601}{\index{md2cmds.\-c@{md2cmds.\-c}!logtime@{logtime}}
\index{logtime@{logtime}!md2cmds.c@{md2cmds.\-c}}
\subsubsection[{logtime}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ logtime (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{md2cmds_8c_a0b466dd608ba033b0b618c6dce8b2601}


Return a time string for loggin Time is from the first call to this funciton. 



Definition at line 30 of file md2cmds.\-c.


\begin{DoxyCode}
                \{
  \textcolor{keyword}{static} \textcolor{keywordtype}{char} rtn[128];
  \textcolor{keyword}{static} \textcolor{keywordtype}{char} tmp[64];
  \textcolor{keyword}{static} \textcolor{keywordtype}{int} first\_time = 1;
  \textcolor{keyword}{static} \textcolor{keyword}{struct }timeval base;
  \textcolor{keyword}{struct }timeval \hyperlink{lspg_8c_ad40ac52086f6b774928af45b09d54c6e}{now};
  \textcolor{keyword}{struct }tm nows;
  \textcolor{keywordtype}{double} diffs;

  \textcolor{keywordflow}{if}( first\_time) \{
    first\_time=0;
    gettimeofday( &base, NULL);
    strftime(tmp, \textcolor{keyword}{sizeof}(tmp)-1, \textcolor{stringliteral}{"%Y-%m-%d %H:%M:%S"}, localtime( &(base.tv\_sec)
      ));
    tmp[\textcolor{keyword}{sizeof}(tmp)-1]=0;
    snprintf( rtn, \textcolor{keyword}{sizeof}(rtn)-1, \textcolor{stringliteral}{"%s.%06d"}, tmp, base.tv\_usec);
    rtn[\textcolor{keyword}{sizeof}(rtn)-1]=0;
  \} \textcolor{keywordflow}{else} \{
    gettimeofday( &\hyperlink{lspg_8c_ad40ac52086f6b774928af45b09d54c6e}{now}, NULL);
    diffs =  (\hyperlink{lspg_8c_ad40ac52086f6b774928af45b09d54c6e}{now}.tv\_sec - base.tv\_sec);
    diffs += (\hyperlink{lspg_8c_ad40ac52086f6b774928af45b09d54c6e}{now}.tv\_usec - base.tv\_usec)/1000000.;
    snprintf( rtn, \textcolor{keyword}{sizeof}( rtn)-1, \textcolor{stringliteral}{"%0.6f"}, diffs);
    rtn[\textcolor{keyword}{sizeof}(rtn)-1]=0;
  \}

  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{md2cmds_8c_a5a9d72c08597ffe45287622c40975e7f}{\index{md2cmds.\-c@{md2cmds.\-c}!md2cmds\-\_\-center@{md2cmds\-\_\-center}}
\index{md2cmds\-\_\-center@{md2cmds\-\_\-center}!md2cmds.c@{md2cmds.\-c}}
\subsubsection[{md2cmds\-\_\-center}]{\setlength{\rightskip}{0pt plus 5cm}void md2cmds\-\_\-center (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{md2cmds_8c_a5a9d72c08597ffe45287622c40975e7f}


Move centering and alignment tables as requested T\-O\-D\-O\-: Implement. 



Definition at line 496 of file md2cmds.\-c.


\begin{DoxyCode}
                      \{
\}
\end{DoxyCode}
\hypertarget{md2cmds_8c_af4a069c2e8a1e3957d15487672b18d47}{\index{md2cmds.\-c@{md2cmds.\-c}!md2cmds\-\_\-collect@{md2cmds\-\_\-collect}}
\index{md2cmds\-\_\-collect@{md2cmds\-\_\-collect}!md2cmds.c@{md2cmds.\-c}}
\subsubsection[{md2cmds\-\_\-collect}]{\setlength{\rightskip}{0pt plus 5cm}void md2cmds\-\_\-collect (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{md2cmds_8c_af4a069c2e8a1e3957d15487672b18d47}


Collect some data. 



Definition at line 211 of file md2cmds.\-c.


\begin{DoxyCode}
                       \{
  \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} skey;
  \textcolor{keywordtype}{double} p170;  \textcolor{comment}{// start cnts}
  \textcolor{keywordtype}{double} p171;  \textcolor{comment}{// end cnts}
  \textcolor{keywordtype}{double} p173;  \textcolor{comment}{// omega velocity cnts/msec}
  \textcolor{keywordtype}{double} p175;  \textcolor{comment}{// acceleration time (msec)}
  \textcolor{keywordtype}{double} p180;  \textcolor{comment}{// exposure time (msec)}
  FILE *zzlog;
  \textcolor{keyword}{struct }timeval tt\_base, tt\_now;
  \textcolor{keywordtype}{int} center\_request;

  zzlog = fopen( \textcolor{stringliteral}{"/tmp/collect\_log.txt"}, \textcolor{stringliteral}{"w"});
  fprintf( zzlog, \textcolor{stringliteral}{"%s: Start md2cmds\(\backslash\)n"}, \hyperlink{md2cmds_8c_a0b466dd608ba033b0b618c6dce8b2601}{logtime}());
  fflush( zzlog);

  \textcolor{comment}{//}
  \textcolor{comment}{// reset shutter has opened flag}
  \textcolor{comment}{//}
  \hyperlink{lspmac_8c_aaa442d9bc7a3cdee39adea0724f0e18c}{lspmac\_SockSendline}( \textcolor{stringliteral}{"P3001=0 P3002=0"});


  \textcolor{keywordflow}{while}( 1) \{
    fprintf( zzlog, \textcolor{stringliteral}{"%s: call lspg\_nextshot\_call\(\backslash\)n"}, \hyperlink{md2cmds_8c_a0b466dd608ba033b0b618c6dce8b2601}{logtime}());
    fflush( zzlog);
    \hyperlink{lspg_8c_af17ef79544ca5d78fd477010fe90d538}{lspg\_nextshot\_call}();

    \textcolor{comment}{//}
    \textcolor{comment}{// This is where we'd tell the md2 to move the organs into position}
    \textcolor{comment}{//}

    fprintf( zzlog, \textcolor{stringliteral}{"%s: call lspg\_nextshot\_wait\(\backslash\)n"}, \hyperlink{md2cmds_8c_a0b466dd608ba033b0b618c6dce8b2601}{logtime}());
    fflush( zzlog);

    \hyperlink{lspg_8c_a784a6de32a86fec9efb3ef3ae4b6e3ac}{lspg\_nextshot\_wait}();
    fprintf( zzlog, \textcolor{stringliteral}{"%s: returned from  lspg\_nextshot\_wait\(\backslash\)n"}, \hyperlink{md2cmds_8c_a0b466dd608ba033b0b618c6dce8b2601}{logtime}()
      );
    fflush( zzlog);

    \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_abc9242805729f70b83df79706c394c71}{no\_rows\_returned}) \{
      \hyperlink{lspg_8c_a50458a014041a4118452802dfb303960}{lspg\_nextshot\_done}();
      \textcolor{keywordflow}{break};
    \}

    skey = \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_af64a4e3f17752b5f1f05fb15d6f48382}{skey};
    \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( NULL, \textcolor{stringliteral}{"SELECT px.shots\_set\_state(%lld,
       'Preparing')"}, skey);

    center\_request = 0;
    \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a1a94eefbad713976a3d9213695a6ca28}{active}) \{
      \textcolor{keywordflow}{if}(
         (fabs( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ad9eb2013fa6f295f72f0891fe98c863f}{cx} - \hyperlink{lspmac_8c_ac940d950d9efeaf3f0ae67e9bf331188}{cenx}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position}) >
       0.1) ||
         (fabs( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ab7a7b37a17f06c4e9ebdcdf056946098}{cy} - \hyperlink{lspmac_8c_aaed18e738ba7bfb6c771a44f5d7ea827}{ceny}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position}) >
       0.1) ||
         (fabs( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a7f57874223897ab7d9c7531a9522904d}{ax} - \hyperlink{lspmac_8c_a6cb218bdccfe5a93471c161f15a15cab}{alignx}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position}
      ) > 0.1) ||
         (fabs( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a9e20b9a0aeb41f7f7d653a1c60335bf1}{ay} - \hyperlink{lspmac_8c_a737c246c3948e644a18d191a931e1acd}{aligny}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position}
      ) > 0.1) ||
         (fabs( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a66e678866ce79f6398b66d033ae45a17}{az} - \hyperlink{lspmac_8c_ae7642b1da0f7c7f8448104c691d40a12}{alignz}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position}
      ) > 0.1)) \{

        center\_request = 1;
        \hyperlink{md2cmds_8c_afc2d53af3d531cfaae116e7b57077347}{md2cmds\_mvcenter\_prep}();
        \hyperlink{md2cmds_8c_afdc46152b46ae4d37c73407b83016b78}{md2cmds\_mvcenter\_move}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.
      \hyperlink{structlspg__nextshot__struct_ad9eb2013fa6f295f72f0891fe98c863f}{cx}, \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ab7a7b37a17f06c4e9ebdcdf056946098}{cy}, \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a7f57874223897ab7d9c7531a9522904d}{ax}, 
      \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a9e20b9a0aeb41f7f7d653a1c60335bf1}{ay}, \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a66e678866ce79f6398b66d033ae45a17}{az});
      \}
    \}

    \textcolor{keywordflow}{if}( !\hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a2d1f51cb1bb575a214344773136be878}{dsphi\_isnull}) \{
      \hyperlink{lspmac_8c_aa4ea5a4c387ef167702c58eaddcb4151}{lspmac\_moveabs\_queue}( \hyperlink{lspmac_8c_ac8070dc568ad974a3db42b51eca828cc}{phi}, \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}
      .\hyperlink{structlspg__nextshot__struct_a64ebde597ca97a3b98145dc2d580c64f}{dsphi});
    \}
  
    \textcolor{keywordflow}{if}( !\hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a1686a72509cc1c3383ee95a790ddff14}{dskappa\_isnull}) \{
      \hyperlink{lspmac_8c_aa4ea5a4c387ef167702c58eaddcb4151}{lspmac\_moveabs\_queue}( \hyperlink{lspmac_8c_a0be79ccb7ebf3a665248fd856112b9fd}{kappa}, \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}
      .\hyperlink{structlspg__nextshot__struct_a59355281e8eb935cd7bfac597fdc5289}{dskappa});
    \}

  
    \textcolor{comment}{//}
    \textcolor{comment}{// Wait for all those motors to stop}
    \textcolor{comment}{//}
    \textcolor{keywordflow}{if}( center\_request) \{
      \hyperlink{md2cmds_8c_a9073a0af983da505daff01e954f0c430}{md2cmds\_mvcenter\_wait}();
    \}

    \textcolor{keywordflow}{if}( !\hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a2d1f51cb1bb575a214344773136be878}{dsphi\_isnull}) \{
      \hyperlink{lspmac_8c_aae2282edace621ee65c682d03b7ccc36}{lspmac\_moveabs\_wait}( \hyperlink{lspmac_8c_ac8070dc568ad974a3db42b51eca828cc}{phi});
    \}
  
    \textcolor{keywordflow}{if}( !\hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a1686a72509cc1c3383ee95a790ddff14}{dskappa\_isnull}) \{
      \hyperlink{lspmac_8c_aae2282edace621ee65c682d03b7ccc36}{lspmac\_moveabs\_wait}( \hyperlink{lspmac_8c_a0be79ccb7ebf3a665248fd856112b9fd}{kappa});
    \}

    \textcolor{comment}{//}
    \textcolor{comment}{// Calculate the parameters we'll need to run the scan}
    \textcolor{comment}{//}
    p180 = \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a063e4c99201a763c2eb048acfc855efa}{dsexp} * 1000.0;
    p170 = \hyperlink{lspmac_8c_a8237e646ce032a840637a4ef7bff49b9}{omega}->\hyperlink{structlspmac__motor__struct_a61415627ab2dc0f438b190d117e532db}{u2c} * \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a8dc11eaa094d59f61642c4abc226918f}{sstart};
    \textcolor{comment}{//    p171 = omega->u2c * ( lspg\_nextshot.sstart + lspg\_nextshot.dsowidth);}
    p171 = \hyperlink{lspmac_8c_a8237e646ce032a840637a4ef7bff49b9}{omega}->\hyperlink{structlspmac__motor__struct_a61415627ab2dc0f438b190d117e532db}{u2c} * \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ad5a8f568a04aa6a13767933062b28f19}{dsowidth};
    p173 = fabs(p180) < 1.e-4 ? 0.0 : \hyperlink{lspmac_8c_a8237e646ce032a840637a4ef7bff49b9}{omega}->\hyperlink{structlspmac__motor__struct_a61415627ab2dc0f438b190d117e532db}{u2c} * \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}
      .\hyperlink{structlspg__nextshot__struct_ad5a8f568a04aa6a13767933062b28f19}{dsowidth} / p180;
    p175 = p173/\hyperlink{lspmac_8c_a8237e646ce032a840637a4ef7bff49b9}{omega}->\hyperlink{structlspmac__motor__struct_afec8dc1d4b97ba9c1d6e4f7a088342e4}{max\_accel};


    \textcolor{comment}{//}
    \textcolor{comment}{// free up access to nextshot}
    \textcolor{comment}{//}
    \hyperlink{lspg_8c_a50458a014041a4118452802dfb303960}{lspg\_nextshot\_done}();

    fprintf( zzlog, \textcolor{stringliteral}{"%s: finished with lspg\_nextshot\_done, calling
       lspg\_seq\_run\_prep\_all\(\backslash\)n"}, \hyperlink{md2cmds_8c_a0b466dd608ba033b0b618c6dce8b2601}{logtime}());
    fflush( zzlog);

    \textcolor{comment}{//}
    \textcolor{comment}{// prepare the database and detector to expose}
    \textcolor{comment}{// On exit we own the diffractometer lock and}
    \textcolor{comment}{// have checked that all is OK with the detector}
    \textcolor{comment}{//}
    \hyperlink{lspg_8c_a4253474d4dd305aec0afdd5552b3ddd5}{lspg\_seq\_run\_prep\_all}( skey,
                           \hyperlink{lspmac_8c_a0be79ccb7ebf3a665248fd856112b9fd}{kappa}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position},
                           \hyperlink{lspmac_8c_ac8070dc568ad974a3db42b51eca828cc}{phi}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position},
                           \hyperlink{lspmac_8c_ac940d950d9efeaf3f0ae67e9bf331188}{cenx}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position},
                           \hyperlink{lspmac_8c_aaed18e738ba7bfb6c771a44f5d7ea827}{ceny}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position},
                           \hyperlink{lspmac_8c_a6cb218bdccfe5a93471c161f15a15cab}{alignx}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position},
                           \hyperlink{lspmac_8c_a737c246c3948e644a18d191a931e1acd}{aligny}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position},
                           \hyperlink{lspmac_8c_ae7642b1da0f7c7f8448104c691d40a12}{alignz}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position}
                           );

    
    fprintf( zzlog, \textcolor{stringliteral}{"%s: finished with lspg\_seq\_run\_prep\_all\(\backslash\)n"}, \hyperlink{md2cmds_8c_a0b466dd608ba033b0b618c6dce8b2601}{logtime}
      ());
    fflush( zzlog);
    \textcolor{comment}{//}
    \textcolor{comment}{// make sure our has opened flag is down}
    \textcolor{comment}{// wait for the p3001=0 command to be noticed}
    \textcolor{comment}{//}
    pthread\_mutex\_lock( &\hyperlink{lspmac_8c_a1b78a13c654409333569815e1c109d38}{lspmac\_shutter\_mutex});
    \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_a396fbf06208de3ecbe1b0df549f1cd46}{lspmac\_shutter\_has\_opened} == 1)
      pthread\_cond\_wait( &\hyperlink{lspmac_8c_afbd51c2cefcee87afe994c9e9f372241}{lspmac\_shutter\_cond}, &
      \hyperlink{lspmac_8c_a1b78a13c654409333569815e1c109d38}{lspmac\_shutter\_mutex});
    pthread\_mutex\_unlock( &\hyperlink{lspmac_8c_a1b78a13c654409333569815e1c109d38}{lspmac\_shutter\_mutex});

    \textcolor{comment}{//}
    \textcolor{comment}{// Start the exposure}
    \textcolor{comment}{//}
    \hyperlink{lspmac_8c_aaa442d9bc7a3cdee39adea0724f0e18c}{lspmac\_SockSendline}( \textcolor{stringliteral}{"P170=%.1f P171=%.1f P173=%.1f
       P174=0 P175=%.1f P176=0 P177=1 P178=0 P180=%.1f M431=1 &1B131R"},
                         p170,      p171,     p173,            p175,           
                     p180);


    fprintf( zzlog, \textcolor{stringliteral}{"%s: sent command to pmac\(\backslash\)n"}, \hyperlink{md2cmds_8c_a0b466dd608ba033b0b618c6dce8b2601}{logtime}());
    fflush( zzlog);

    \textcolor{comment}{//}
    \textcolor{comment}{// wait for the shutter to open}
    \textcolor{comment}{//}
    pthread\_mutex\_lock( &\hyperlink{lspmac_8c_a1b78a13c654409333569815e1c109d38}{lspmac\_shutter\_mutex});
    \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_a396fbf06208de3ecbe1b0df549f1cd46}{lspmac\_shutter\_has\_opened} == 0)
      pthread\_cond\_wait( &\hyperlink{lspmac_8c_afbd51c2cefcee87afe994c9e9f372241}{lspmac\_shutter\_cond}, &
      \hyperlink{lspmac_8c_a1b78a13c654409333569815e1c109d38}{lspmac\_shutter\_mutex});

    fprintf( zzlog, \textcolor{stringliteral}{"%s: shutter has opened\(\backslash\)n"}, \hyperlink{md2cmds_8c_a0b466dd608ba033b0b618c6dce8b2601}{logtime}());
    fflush( zzlog);

    \textcolor{comment}{//}
    \textcolor{comment}{// wait for the shutter to close}
    \textcolor{comment}{//}
    \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_a112158e0cd50449a440ac55c7af7bea2}{lspmac\_shutter\_state} == 1)
      pthread\_cond\_wait( &\hyperlink{lspmac_8c_afbd51c2cefcee87afe994c9e9f372241}{lspmac\_shutter\_cond}, &
      \hyperlink{lspmac_8c_a1b78a13c654409333569815e1c109d38}{lspmac\_shutter\_mutex});
    pthread\_mutex\_unlock( &\hyperlink{lspmac_8c_a1b78a13c654409333569815e1c109d38}{lspmac\_shutter\_mutex});

    fprintf( zzlog, \textcolor{stringliteral}{"%s: shutter now closed, unlocking diffractometer\(\backslash\)n"}, 
      \hyperlink{md2cmds_8c_a0b466dd608ba033b0b618c6dce8b2601}{logtime}());
    fflush( zzlog);


    \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( NULL, \textcolor{stringliteral}{"SELECT px.unlock\_diffractometer()"});

    fprintf( zzlog, \textcolor{stringliteral}{"%s: unlocked diffractometer\(\backslash\)n"}, \hyperlink{md2cmds_8c_a0b466dd608ba033b0b618c6dce8b2601}{logtime}());
    fflush( zzlog);

    \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( NULL, \textcolor{stringliteral}{"SELECT px.shots\_set\_state(%lld,
       'Writing')"}, skey);

    \textcolor{comment}{//}
    \textcolor{comment}{// reset shutter has opened flag}
    \textcolor{comment}{//}
    \hyperlink{lspmac_8c_aaa442d9bc7a3cdee39adea0724f0e18c}{lspmac\_SockSendline}( \textcolor{stringliteral}{"P3001=0"});
    \textcolor{comment}{//}
    \textcolor{comment}{// TODO:}
    \textcolor{comment}{// wait for omega to stop moving then position it for the next frame}
    \textcolor{comment}{//}


    \textcolor{keywordflow}{if}( !\hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a1aa11ff4a4c8d69695786b4349e84e6b}{active2\_isnull} && 
      \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a2875aa18df587806a3d8c05220fd62b5}{active2}) \{
      \textcolor{keywordflow}{if}(
         (fabs( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a10d45763100bc59f9a5f68f1b48db6d3}{cx2} - \hyperlink{lspmac_8c_ac940d950d9efeaf3f0ae67e9bf331188}{cenx}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position})
       > 0.1) ||
         (fabs( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a3644e5c3f12af18a3b426d4d4d7e16a5}{cy2} - \hyperlink{lspmac_8c_aaed18e738ba7bfb6c771a44f5d7ea827}{ceny}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position})
       > 0.1) ||
         (fabs( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ab76bd38d2a098bc7eda82aff5dcb9c66}{ax2} - \hyperlink{lspmac_8c_a6cb218bdccfe5a93471c161f15a15cab}{alignx}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position}
      ) > 0.1) ||
         (fabs( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ad13759740204b42e379161f98815f3d0}{ay2} - \hyperlink{lspmac_8c_a737c246c3948e644a18d191a931e1acd}{aligny}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position}
      ) > 0.1) ||
         (fabs( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a94698a030fd5b2abf1f10a2ad33476a4}{az2} - \hyperlink{lspmac_8c_ae7642b1da0f7c7f8448104c691d40a12}{alignz}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position}
      ) > 0.1)) \{

        center\_request = 1;
        \hyperlink{md2cmds_8c_afc2d53af3d531cfaae116e7b57077347}{md2cmds\_mvcenter\_prep}();
        \hyperlink{md2cmds_8c_afdc46152b46ae4d37c73407b83016b78}{md2cmds\_mvcenter\_move}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.
      \hyperlink{structlspg__nextshot__struct_ad9eb2013fa6f295f72f0891fe98c863f}{cx}, \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ab7a7b37a17f06c4e9ebdcdf056946098}{cy}, \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a7f57874223897ab7d9c7531a9522904d}{ax}, 
      \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a9e20b9a0aeb41f7f7d653a1c60335bf1}{ay}, \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a66e678866ce79f6398b66d033ae45a17}{az});
        \hyperlink{md2cmds_8c_a9073a0af983da505daff01e954f0c430}{md2cmds\_mvcenter\_wait}();
      \}
    \}

  \}
  fprintf( zzlog, \textcolor{stringliteral}{"%s: done\(\backslash\)n"}, \hyperlink{md2cmds_8c_a0b466dd608ba033b0b618c6dce8b2601}{logtime}());
  fflush( zzlog);
  fclose( zzlog);
\}
\end{DoxyCode}
\hypertarget{md2cmds_8c_a0851b1baecda6a67993efde41d77b1c1}{\index{md2cmds.\-c@{md2cmds.\-c}!md2cmds\-\_\-init@{md2cmds\-\_\-init}}
\index{md2cmds\-\_\-init@{md2cmds\-\_\-init}!md2cmds.c@{md2cmds.\-c}}
\subsubsection[{md2cmds\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void md2cmds\-\_\-init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{md2cmds_8c_a0851b1baecda6a67993efde41d77b1c1}


Initialize the md2cmds module. 



Definition at line 535 of file md2cmds.\-c.


\begin{DoxyCode}
                    \{
  memset( \hyperlink{md2cmds_8c_a5f0fe1e2dfa92cf345b8c29134ab1ede}{md2cmds\_cmd}, 0, \textcolor{keyword}{sizeof}( \hyperlink{md2cmds_8c_a5f0fe1e2dfa92cf345b8c29134ab1ede}{md2cmds\_cmd}));

  pthread\_mutex\_init( &\hyperlink{md2cmds_8c_ad67304bb851dc6268b0cda2f40fc5aa8}{md2cmds\_mutex}, NULL);
  pthread\_cond\_init( &\hyperlink{md2cmds_8c_a08d5b18ec9478d753c46a3e28d1f2126}{md2cmds\_cond}, NULL);

  pthread\_mutex\_init( &\hyperlink{md2cmds_8c_a4d2c3ac81d4b13eb21f4ddcdda8c7308}{md2cmds\_pg\_mutex}, NULL);
  pthread\_cond\_init( &\hyperlink{md2cmds_8c_ab517a930528e2b7d0993e11087765b03}{md2cmds\_pg\_cond}, NULL);

\}
\end{DoxyCode}
\hypertarget{md2cmds_8c_a82542bd5f69f6975583bbd9dfadec0cb}{\index{md2cmds.\-c@{md2cmds.\-c}!md2cmds\-\_\-move\-Abs@{md2cmds\-\_\-move\-Abs}}
\index{md2cmds\-\_\-move\-Abs@{md2cmds\-\_\-move\-Abs}!md2cmds.c@{md2cmds.\-c}}
\subsubsection[{md2cmds\-\_\-move\-Abs}]{\setlength{\rightskip}{0pt plus 5cm}void md2cmds\-\_\-move\-Abs (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{cmd}
\end{DoxyParamCaption}
)}}\label{md2cmds_8c_a82542bd5f69f6975583bbd9dfadec0cb}


Move a motor to the position requested. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em cmd} & The full command string to parse, ie, \char`\"{}move\-Abs omega 180\char`\"{} \\
\hline
\end{DoxyParams}


Definition at line 59 of file md2cmds.\-c.


\begin{DoxyCode}
                       \{
  \textcolor{keywordtype}{char} *ignore;
  \textcolor{keywordtype}{char} *ptr;
  \textcolor{keywordtype}{char} *mtr;
  \textcolor{keywordtype}{char} *pos;
  \textcolor{keywordtype}{double} fpos;
  \textcolor{keywordtype}{char} *endptr;
  \hyperlink{structlspmac__motor__struct}{lspmac\_motor\_t} *mp;
  \textcolor{keywordtype}{int} i;

  \textcolor{comment}{// Parse the command string}
  \textcolor{comment}{//}
  ignore = strtok\_r( cmd, \textcolor{stringliteral}{" "}, &ptr);
  \textcolor{keywordflow}{if}( ignore == NULL) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"md2cmds\_moveAbs: ignoring
       blank command '%s'"}, cmd);
    \textcolor{keywordflow}{return};
  \}

  \textcolor{comment}{// The first string should be "moveAbs" cause that's how we got here.}
  \textcolor{comment}{// Toss it.}
  
  mtr = strtok\_r( NULL, \textcolor{stringliteral}{" "}, &ptr);
  \textcolor{keywordflow}{if}( mtr == NULL) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"md2cmds moveAbs error: missing
       motor name"});
    \textcolor{keywordflow}{return};
  \}

  mp = NULL;
  \textcolor{keywordflow}{for}( i=0; i<\hyperlink{lspmac_8c_a56260f012c50a591ee7f97e500f16994}{lspmac\_nmotors}; i++) \{
    \textcolor{keywordflow}{if}( strcmp( \hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}[i].name, mtr) == 0) \{
      mp = &(\hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}[i]);
      \textcolor{keywordflow}{break};
    \}
  \}
  \textcolor{keywordflow}{if}( mp == NULL) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"md2cmds moveAbs error: cannot
       find motor %s"}, mtr);
    \textcolor{keywordflow}{return};
  \}

  pos = strtok\_r( NULL, \textcolor{stringliteral}{" "}, &ptr);
  \textcolor{keywordflow}{if}( pos == NULL) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"md2cmds moveAbs error: missing
       position"});
    \textcolor{keywordflow}{return};
  \}

  fpos = strtod( pos, &endptr);
  \textcolor{keywordflow}{if}( pos == endptr) \{
    \textcolor{comment}{//}
    \textcolor{comment}{// Maybe we have a preset.  Give it a whirl}
    \textcolor{comment}{// In any case we are done here.}
    \textcolor{comment}{//}
    \hyperlink{lspmac_8c_a290212c160e6ef1f560c9df9fc8f58e4}{lspmac\_move\_preset\_queue}( mp, pos);
    \textcolor{keywordflow}{return};
  \}
  


  \textcolor{keywordflow}{if}( mp != NULL && mp->\hyperlink{structlspmac__motor__struct_a20db3de86854b627815b3d940555ea75}{moveAbs} != NULL) \{
    wprintw( \hyperlink{pgpmac_8c_a65daf0f4a5bc6def23a9df98ff5ca57e}{term\_output}, \textcolor{stringliteral}{"Moving %s to %f\(\backslash\)n"}, mtr, fpos);
    wnoutrefresh( \hyperlink{pgpmac_8c_a65daf0f4a5bc6def23a9df98ff5ca57e}{term\_output});
    mp->\hyperlink{structlspmac__motor__struct_a20db3de86854b627815b3d940555ea75}{moveAbs}( mp, fpos);
  \}

\}
\end{DoxyCode}
\hypertarget{md2cmds_8c_afdc46152b46ae4d37c73407b83016b78}{\index{md2cmds.\-c@{md2cmds.\-c}!md2cmds\-\_\-mvcenter\-\_\-move@{md2cmds\-\_\-mvcenter\-\_\-move}}
\index{md2cmds\-\_\-mvcenter\-\_\-move@{md2cmds\-\_\-mvcenter\-\_\-move}!md2cmds.c@{md2cmds.\-c}}
\subsubsection[{md2cmds\-\_\-mvcenter\-\_\-move}]{\setlength{\rightskip}{0pt plus 5cm}void md2cmds\-\_\-mvcenter\-\_\-move (
\begin{DoxyParamCaption}
\item[{double}]{cx, }
\item[{double}]{cy, }
\item[{double}]{ax, }
\item[{double}]{ay, }
\item[{double}]{az}
\end{DoxyParamCaption}
)}}\label{md2cmds_8c_afdc46152b46ae4d37c73407b83016b78}


Move the centering and alignment tables. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em cx} & Requested Centering Table X \\
\hline
\mbox{\tt in}  & {\em cy} & Requested Centering Table Y \\
\hline
\mbox{\tt in}  & {\em ax} & Requested Alignment Table X \\
\hline
\mbox{\tt in}  & {\em ay} & Requested Alignment Table Y \\
\hline
\mbox{\tt in}  & {\em az} & Requested Alignment Table Z \\
\hline
\end{DoxyParams}


Definition at line 170 of file md2cmds.\-c.


\begin{DoxyCode}
                             \{
  \textcolor{comment}{//}
  \textcolor{comment}{// centering stage is coordinate system 2}
  \textcolor{comment}{// alignment stage is coordinate system 3}
  \textcolor{comment}{//}
  
  \textcolor{keywordtype}{double} cx\_cts, cy\_cts, ax\_cts, ay\_cts, az\_cts;

  cx\_cts = \hyperlink{lspmac_8c_ac940d950d9efeaf3f0ae67e9bf331188}{cenx}->\hyperlink{structlspmac__motor__struct_a61415627ab2dc0f438b190d117e532db}{u2c}   * cx;
  cy\_cts = \hyperlink{lspmac_8c_aaed18e738ba7bfb6c771a44f5d7ea827}{ceny}->\hyperlink{structlspmac__motor__struct_a61415627ab2dc0f438b190d117e532db}{u2c}   * cy;
  ax\_cts = \hyperlink{lspmac_8c_a6cb218bdccfe5a93471c161f15a15cab}{alignx}->\hyperlink{structlspmac__motor__struct_a61415627ab2dc0f438b190d117e532db}{u2c} * ax;
  ay\_cts = \hyperlink{lspmac_8c_a737c246c3948e644a18d191a931e1acd}{aligny}->\hyperlink{structlspmac__motor__struct_a61415627ab2dc0f438b190d117e532db}{u2c} * ay;
  az\_cts = \hyperlink{lspmac_8c_ae7642b1da0f7c7f8448104c691d40a12}{alignz}->\hyperlink{structlspmac__motor__struct_a61415627ab2dc0f438b190d117e532db}{u2c} * az;

  \hyperlink{lspmac_8c_aaa442d9bc7a3cdee39adea0724f0e18c}{lspmac\_SockSendline}( \textcolor{stringliteral}{"M7075=(M7075 | 2) &2 Q100=2 Q20=%.1f
       Q21=%.1f B150R"}, cx\_cts, cy\_cts);
  \hyperlink{lspmac_8c_aaa442d9bc7a3cdee39adea0724f0e18c}{lspmac\_SockSendline}( \textcolor{stringliteral}{"M7075=(M7075 | 4) &3 Q100=4 Q30=%.1f
       Q31=%.1f Q32=%.1f B160R"}, ax\_cts, ay\_cts, az\_cts);
  
\}
\end{DoxyCode}
\hypertarget{md2cmds_8c_afc2d53af3d531cfaae116e7b57077347}{\index{md2cmds.\-c@{md2cmds.\-c}!md2cmds\-\_\-mvcenter\-\_\-prep@{md2cmds\-\_\-mvcenter\-\_\-prep}}
\index{md2cmds\-\_\-mvcenter\-\_\-prep@{md2cmds\-\_\-mvcenter\-\_\-prep}!md2cmds.c@{md2cmds.\-c}}
\subsubsection[{md2cmds\-\_\-mvcenter\-\_\-prep}]{\setlength{\rightskip}{0pt plus 5cm}void md2cmds\-\_\-mvcenter\-\_\-prep (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{md2cmds_8c_afc2d53af3d531cfaae116e7b57077347}


Sets up a centering table and alignment table move Ensures that when we issue the move command that we can detect that the move happened. 



Definition at line 131 of file md2cmds.\-c.


\begin{DoxyCode}
                             \{
  \textcolor{comment}{//}
  \textcolor{comment}{// Clears the motion flags for coordinate systems 2 and 3}
  \textcolor{comment}{// Then sets them.}
  \textcolor{comment}{// Each time we wait until we've read back}
  \textcolor{comment}{// the changed values}
  \textcolor{comment}{//}
  \textcolor{comment}{// This guarantees that when we are waiting for motion to stop that it did,
       in fact, start}
  \textcolor{comment}{//}

  \textcolor{comment}{//}
  \textcolor{comment}{// Clear the centering and alignment stage flags}
  \textcolor{comment}{//}
  \hyperlink{lspmac_8c_aaa442d9bc7a3cdee39adea0724f0e18c}{lspmac\_SockSendline}( \textcolor{stringliteral}{"M7075=(M7075 | 6) ^ 6"});

  \textcolor{comment}{//}
  \textcolor{comment}{// Make sure it propagates}
  \textcolor{comment}{//}
  pthread\_mutex\_lock( &\hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex});
  \textcolor{keywordflow}{while}( \hyperlink{lspmac_8c_a7a32c617c183166308241e270959df56}{lspmac\_moving\_flags} & 6)
    pthread\_cond\_wait( &\hyperlink{lspmac_8c_a57547d211906c981ef20257eba99f8df}{lspmac\_moving\_cond}, &
      \hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex});
  pthread\_mutex\_unlock( &\hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex});

  \textcolor{comment}{//}
  \textcolor{comment}{// Set the centering and alignment stage flags}
  \textcolor{comment}{//}
  \hyperlink{lspmac_8c_aaa442d9bc7a3cdee39adea0724f0e18c}{lspmac\_SockSendline}( \textcolor{stringliteral}{"M7075=(M7075 | 6)"});

  \textcolor{comment}{//}
  \textcolor{comment}{// Make sure it propagates}
  \textcolor{comment}{//}
  pthread\_mutex\_lock( &\hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex});
  \textcolor{keywordflow}{while}( (\hyperlink{lspmac_8c_a7a32c617c183166308241e270959df56}{lspmac\_moving\_flags} & 6) == 0)
    pthread\_cond\_wait( &\hyperlink{lspmac_8c_a57547d211906c981ef20257eba99f8df}{lspmac\_moving\_cond}, &
      \hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex});
  pthread\_mutex\_unlock( &\hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex});
\}
\end{DoxyCode}
\hypertarget{md2cmds_8c_a9073a0af983da505daff01e954f0c430}{\index{md2cmds.\-c@{md2cmds.\-c}!md2cmds\-\_\-mvcenter\-\_\-wait@{md2cmds\-\_\-mvcenter\-\_\-wait}}
\index{md2cmds\-\_\-mvcenter\-\_\-wait@{md2cmds\-\_\-mvcenter\-\_\-wait}!md2cmds.c@{md2cmds.\-c}}
\subsubsection[{md2cmds\-\_\-mvcenter\-\_\-wait}]{\setlength{\rightskip}{0pt plus 5cm}void md2cmds\-\_\-mvcenter\-\_\-wait (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{md2cmds_8c_a9073a0af983da505daff01e954f0c430}


Wait for the centering and alignment tables to stop moving. 



Definition at line 197 of file md2cmds.\-c.


\begin{DoxyCode}
                             \{
  \textcolor{comment}{//}
  \textcolor{comment}{// Just wait until the motion flags are lowered}
  \textcolor{comment}{//}

  pthread\_mutex\_lock( &\hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex});
  \textcolor{keywordflow}{while}( \hyperlink{lspmac_8c_a7a32c617c183166308241e270959df56}{lspmac\_moving\_flags} & 6)
    pthread\_cond\_wait( &\hyperlink{lspmac_8c_a57547d211906c981ef20257eba99f8df}{lspmac\_moving\_cond}, &
      \hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex});
  pthread\_mutex\_unlock( &\hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex});
\}
\end{DoxyCode}
\hypertarget{md2cmds_8c_ac9e84b4a527da535d21cca65dc4aa61a}{\index{md2cmds.\-c@{md2cmds.\-c}!md2cmds\-\_\-rotate@{md2cmds\-\_\-rotate}}
\index{md2cmds\-\_\-rotate@{md2cmds\-\_\-rotate}!md2cmds.c@{md2cmds.\-c}}
\subsubsection[{md2cmds\-\_\-rotate}]{\setlength{\rightskip}{0pt plus 5cm}void md2cmds\-\_\-rotate (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{md2cmds_8c_ac9e84b4a527da535d21cca65dc4aa61a}


Spin 360 and make a video (recenter first, maybe) 



Definition at line 413 of file md2cmds.\-c.


\begin{DoxyCode}
                      \{
  \textcolor{comment}{//}
  \textcolor{comment}{// BLUMax disables scintilator here.}
  \textcolor{comment}{//}

  \textcolor{comment}{//}
  \textcolor{comment}{// get the new center information}
  \textcolor{comment}{//}
  \hyperlink{lspg_8c_a6f7cd0a06f6a266ef65b3604cf33d6c4}{lspg\_getcenter\_call}();

  \hyperlink{lspg_8c_a3e0e4b3cb9fa03961ee0c104e0b06754}{lspg\_getcenter\_wait}();


  \textcolor{comment}{// put up the back light}
  \hyperlink{lspmac_8c_af813a2eff0b7efa4c70633559054e84c}{blight\_ud}->\hyperlink{structlspmac__motor__struct_a20db3de86854b627815b3d940555ea75}{moveAbs}( \hyperlink{lspmac_8c_af813a2eff0b7efa4c70633559054e84c}{blight\_ud}, 1);

  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_aaeb0ccf4289b4fb306c2bc04ae85b237}{no\_rows\_returned}) \{
    \textcolor{comment}{//}
    \textcolor{comment}{// the other case is considered below}
    \textcolor{comment}{// Bottom line, zoom is always defined}
    \textcolor{comment}{//}
    \hyperlink{lspmac_8c_ad53a42cfaa04eff0336a44c8c9986333}{zoom}->\hyperlink{structlspmac__motor__struct_a20db3de86854b627815b3d940555ea75}{moveAbs}( \hyperlink{lspmac_8c_ad53a42cfaa04eff0336a44c8c9986333}{zoom}, 1);     \textcolor{comment}{// default zoom is 1}
  \}


  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_aaeb0ccf4289b4fb306c2bc04ae85b237}{no\_rows\_returned} == 0) \{
    \textcolor{keywordtype}{double} cx, cy, ax, ay, az;

    \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a6ca85a8de29039188357b2814acd7803}{zoom\_isnull} == 0) \{
      \hyperlink{lspmac_8c_ad53a42cfaa04eff0336a44c8c9986333}{zoom}->\hyperlink{structlspmac__motor__struct_a20db3de86854b627815b3d940555ea75}{moveAbs}( \hyperlink{lspmac_8c_ad53a42cfaa04eff0336a44c8c9986333}{zoom}, \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a63e640a925611d2404a1529aea30a853}{zoom}
      );
    \} \textcolor{keywordflow}{else} \{
      \hyperlink{lspmac_8c_ad53a42cfaa04eff0336a44c8c9986333}{zoom}->\hyperlink{structlspmac__motor__struct_a20db3de86854b627815b3d940555ea75}{moveAbs}( \hyperlink{lspmac_8c_ad53a42cfaa04eff0336a44c8c9986333}{zoom}, 1);
    \}

    \textcolor{comment}{//}
    \textcolor{comment}{// OK, why not just implement a nice getter that does the locking
       transparently?  UGLY!}
    \textcolor{comment}{//}
    pthread\_mutex\_lock( &(\hyperlink{lspmac_8c_ac940d950d9efeaf3f0ae67e9bf331188}{cenx}->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
    cx = \hyperlink{lspmac_8c_ac940d950d9efeaf3f0ae67e9bf331188}{cenx}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position};
    pthread\_mutex\_unlock( &(\hyperlink{lspmac_8c_ac940d950d9efeaf3f0ae67e9bf331188}{cenx}->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
    \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_aa404da85af654998f039c81a77626748}{dcx\_isnull} == 0)
      cx += \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_ade0534056296e9ed568404c538be9227}{dcx};

    pthread\_mutex\_lock( &(\hyperlink{lspmac_8c_aaed18e738ba7bfb6c771a44f5d7ea827}{ceny}->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
    cy = \hyperlink{lspmac_8c_aaed18e738ba7bfb6c771a44f5d7ea827}{ceny}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position};
    pthread\_mutex\_unlock( &(\hyperlink{lspmac_8c_aaed18e738ba7bfb6c771a44f5d7ea827}{ceny}->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
    \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a352c48c8d443c52f18ebd13019d01684}{dcy\_isnull} == 0)
      cy  += \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a55b1a488b714e6a40d8e06a6e182bd0a}{dcy};
                          
    pthread\_mutex\_lock( &(\hyperlink{lspmac_8c_a6cb218bdccfe5a93471c161f15a15cab}{alignx}->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
    ax = \hyperlink{lspmac_8c_a6cb218bdccfe5a93471c161f15a15cab}{alignx}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position};
    pthread\_mutex\_unlock( &(\hyperlink{lspmac_8c_a6cb218bdccfe5a93471c161f15a15cab}{alignx}->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
    \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a621b489777d61e9db8b33b784b8d70f9}{dax\_isnull} == 0)
      ax  += \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a17db52848c28852a470222ec93ae8886}{dax};

    pthread\_mutex\_lock( &(\hyperlink{lspmac_8c_a737c246c3948e644a18d191a931e1acd}{aligny}->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
    ay = \hyperlink{lspmac_8c_a737c246c3948e644a18d191a931e1acd}{aligny}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position};
    pthread\_mutex\_unlock( &(\hyperlink{lspmac_8c_a737c246c3948e644a18d191a931e1acd}{aligny}->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
    \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a36f57a319288810caf365cca7827ff96}{day\_isnull} == 0)
      ay  += \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a9ce0f29540f2ff47be9788565d19f1b8}{day};
                          
    pthread\_mutex\_lock( &(\hyperlink{lspmac_8c_ae7642b1da0f7c7f8448104c691d40a12}{alignz}->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
    az = \hyperlink{lspmac_8c_ae7642b1da0f7c7f8448104c691d40a12}{alignz}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position};
    pthread\_mutex\_unlock( &(\hyperlink{lspmac_8c_ae7642b1da0f7c7f8448104c691d40a12}{alignz}->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
    \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a36742b6bd0f4bf9356414930ba893617}{daz\_isnull} == 0)
      az  += \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a1170bab2161f03ab29c39f79519ed9ae}{daz};
                          
    \hyperlink{md2cmds_8c_afdc46152b46ae4d37c73407b83016b78}{md2cmds\_mvcenter\_move}( cx, cy, ax, ay, az);
    \hyperlink{md2cmds_8c_a9073a0af983da505daff01e954f0c430}{md2cmds\_mvcenter\_wait}();
  \}
  \hyperlink{lspg_8c_a7c678553b44c874d08ec9966ed7bb1c0}{lspg\_getcenter\_done}();

  \textcolor{comment}{// Home omega}
  \hyperlink{lspmac_8c_aaa442d9bc7a3cdee39adea0724f0e18c}{lspmac\_SockSendline}(\textcolor{stringliteral}{"M401=1 M1115=1 #1$ &1B1R"});

  
  
  
\}
\end{DoxyCode}
\hypertarget{md2cmds_8c_aa62da7d423952334d41c7d282f45233d}{\index{md2cmds.\-c@{md2cmds.\-c}!md2cmds\-\_\-run@{md2cmds\-\_\-run}}
\index{md2cmds\-\_\-run@{md2cmds\-\_\-run}!md2cmds.c@{md2cmds.\-c}}
\subsubsection[{md2cmds\-\_\-run}]{\setlength{\rightskip}{0pt plus 5cm}void md2cmds\-\_\-run (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{md2cmds_8c_aa62da7d423952334d41c7d282f45233d}


Start up the thread. 



Definition at line 548 of file md2cmds.\-c.


\begin{DoxyCode}
                   \{
  pthread\_create( &\hyperlink{md2cmds_8c_aa230921945149692de98fff15c01962f}{md2cmds\_thread}, NULL, \hyperlink{md2cmds_8c_ae967e769d23555a631f615e630f25b00}{md2cmds\_worker}
      , NULL);
\}
\end{DoxyCode}
\hypertarget{md2cmds_8c_adba92015101973846ee66a33ea39addf}{\index{md2cmds.\-c@{md2cmds.\-c}!md2cmds\-\_\-transfer@{md2cmds\-\_\-transfer}}
\index{md2cmds\-\_\-transfer@{md2cmds\-\_\-transfer}!md2cmds.c@{md2cmds.\-c}}
\subsubsection[{md2cmds\-\_\-transfer}]{\setlength{\rightskip}{0pt plus 5cm}void md2cmds\-\_\-transfer (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{md2cmds_8c_adba92015101973846ee66a33ea39addf}


Transfer a sample T\-O\-D\-O\-: Implement. 



Definition at line 24 of file md2cmds.\-c.


\begin{DoxyCode}
                        \{
\}
\end{DoxyCode}
\hypertarget{md2cmds_8c_ae967e769d23555a631f615e630f25b00}{\index{md2cmds.\-c@{md2cmds.\-c}!md2cmds\-\_\-worker@{md2cmds\-\_\-worker}}
\index{md2cmds\-\_\-worker@{md2cmds\-\_\-worker}!md2cmds.c@{md2cmds.\-c}}
\subsubsection[{md2cmds\-\_\-worker}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ md2cmds\-\_\-worker (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{dummy}
\end{DoxyParamCaption}
)}}\label{md2cmds_8c_ae967e769d23555a631f615e630f25b00}


Our worker thread. 


\begin{DoxyParams}{Parameters}
{\em dummy} & \begin{quotation}
\mbox{[}in\mbox{]} Unused but required by protocol \end{quotation}
\\
\hline
\end{DoxyParams}


Definition at line 503 of file md2cmds.\-c.


\begin{DoxyCode}
                       \{

  pthread\_mutex\_lock( &\hyperlink{md2cmds_8c_ad67304bb851dc6268b0cda2f40fc5aa8}{md2cmds\_mutex});

  \textcolor{keywordflow}{while}( 1) \{
    \textcolor{comment}{//}
    \textcolor{comment}{// wait for someone to give us a command (and tell us they did so)}
    \textcolor{comment}{//}
    \textcolor{keywordflow}{while}( \hyperlink{md2cmds_8c_a5f0fe1e2dfa92cf345b8c29134ab1ede}{md2cmds\_cmd}[0] == 0)
      pthread\_cond\_wait( &\hyperlink{md2cmds_8c_a08d5b18ec9478d753c46a3e28d1f2126}{md2cmds\_cond}, &\hyperlink{md2cmds_8c_ad67304bb851dc6268b0cda2f40fc5aa8}{md2cmds\_mutex}
      );

    \textcolor{keywordflow}{if}( strcmp( \hyperlink{md2cmds_8c_a5f0fe1e2dfa92cf345b8c29134ab1ede}{md2cmds\_cmd}, \textcolor{stringliteral}{"transfer"}) == 0) \{
      \hyperlink{md2cmds_8c_adba92015101973846ee66a33ea39addf}{md2cmds\_transfer}();
    \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( strcmp( \hyperlink{md2cmds_8c_a5f0fe1e2dfa92cf345b8c29134ab1ede}{md2cmds\_cmd}, \textcolor{stringliteral}{"collect"}) == 0) \{
      \hyperlink{md2cmds_8c_af4a069c2e8a1e3957d15487672b18d47}{md2cmds\_collect}();
    \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( strcmp( \hyperlink{md2cmds_8c_a5f0fe1e2dfa92cf345b8c29134ab1ede}{md2cmds\_cmd}, \textcolor{stringliteral}{"rotate"}) == 0) \{
      \hyperlink{md2cmds_8c_ac9e84b4a527da535d21cca65dc4aa61a}{md2cmds\_rotate}();
    \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( strcmp( \hyperlink{md2cmds_8c_a5f0fe1e2dfa92cf345b8c29134ab1ede}{md2cmds\_cmd}, \textcolor{stringliteral}{"center"}) == 0) \{
      \hyperlink{md2cmds_8c_a5a9d72c08597ffe45287622c40975e7f}{md2cmds\_center}();
    \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( strncmp( \hyperlink{md2cmds_8c_a5f0fe1e2dfa92cf345b8c29134ab1ede}{md2cmds\_cmd}, \textcolor{stringliteral}{"moveAbs"}, 7) == 0) \{
      \hyperlink{md2cmds_8c_a82542bd5f69f6975583bbd9dfadec0cb}{md2cmds\_moveAbs}( \hyperlink{md2cmds_8c_a5f0fe1e2dfa92cf345b8c29134ab1ede}{md2cmds\_cmd});
    \}

    \hyperlink{md2cmds_8c_a5f0fe1e2dfa92cf345b8c29134ab1ede}{md2cmds\_cmd}[0] = 0;
  \}
\}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{md2cmds_8c_a5f0fe1e2dfa92cf345b8c29134ab1ede}{\index{md2cmds.\-c@{md2cmds.\-c}!md2cmds\-\_\-cmd@{md2cmds\-\_\-cmd}}
\index{md2cmds\-\_\-cmd@{md2cmds\-\_\-cmd}!md2cmds.c@{md2cmds.\-c}}
\subsubsection[{md2cmds\-\_\-cmd}]{\setlength{\rightskip}{0pt plus 5cm}char md2cmds\-\_\-cmd\mbox{[}{\bf M\-D2\-C\-M\-D\-S\-\_\-\-C\-M\-D\-\_\-\-L\-E\-N\-G\-T\-H}\mbox{]}}}\label{md2cmds_8c_a5f0fe1e2dfa92cf345b8c29134ab1ede}


our command; 



Definition at line 16 of file md2cmds.\-c.

\hypertarget{md2cmds_8c_a08d5b18ec9478d753c46a3e28d1f2126}{\index{md2cmds.\-c@{md2cmds.\-c}!md2cmds\-\_\-cond@{md2cmds\-\_\-cond}}
\index{md2cmds\-\_\-cond@{md2cmds\-\_\-cond}!md2cmds.c@{md2cmds.\-c}}
\subsubsection[{md2cmds\-\_\-cond}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-cond\-\_\-t md2cmds\-\_\-cond}}\label{md2cmds_8c_a08d5b18ec9478d753c46a3e28d1f2126}


condition to signal when it's time to run an md2 command 



Definition at line 10 of file md2cmds.\-c.

\hypertarget{md2cmds_8c_ad67304bb851dc6268b0cda2f40fc5aa8}{\index{md2cmds.\-c@{md2cmds.\-c}!md2cmds\-\_\-mutex@{md2cmds\-\_\-mutex}}
\index{md2cmds\-\_\-mutex@{md2cmds\-\_\-mutex}!md2cmds.c@{md2cmds.\-c}}
\subsubsection[{md2cmds\-\_\-mutex}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-mutex\-\_\-t md2cmds\-\_\-mutex}}\label{md2cmds_8c_ad67304bb851dc6268b0cda2f40fc5aa8}


mutex for the condition 



Definition at line 11 of file md2cmds.\-c.

\hypertarget{md2cmds_8c_ab517a930528e2b7d0993e11087765b03}{\index{md2cmds.\-c@{md2cmds.\-c}!md2cmds\-\_\-pg\-\_\-cond@{md2cmds\-\_\-pg\-\_\-cond}}
\index{md2cmds\-\_\-pg\-\_\-cond@{md2cmds\-\_\-pg\-\_\-cond}!md2cmds.c@{md2cmds.\-c}}
\subsubsection[{md2cmds\-\_\-pg\-\_\-cond}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-cond\-\_\-t md2cmds\-\_\-pg\-\_\-cond}}\label{md2cmds_8c_ab517a930528e2b7d0993e11087765b03}


coordinate call and response 



Definition at line 13 of file md2cmds.\-c.

\hypertarget{md2cmds_8c_a4d2c3ac81d4b13eb21f4ddcdda8c7308}{\index{md2cmds.\-c@{md2cmds.\-c}!md2cmds\-\_\-pg\-\_\-mutex@{md2cmds\-\_\-pg\-\_\-mutex}}
\index{md2cmds\-\_\-pg\-\_\-mutex@{md2cmds\-\_\-pg\-\_\-mutex}!md2cmds.c@{md2cmds.\-c}}
\subsubsection[{md2cmds\-\_\-pg\-\_\-mutex}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-mutex\-\_\-t md2cmds\-\_\-pg\-\_\-mutex}}\label{md2cmds_8c_a4d2c3ac81d4b13eb21f4ddcdda8c7308}


message passing between md2cmds and pg 



Definition at line 14 of file md2cmds.\-c.

\hypertarget{md2cmds_8c_aa230921945149692de98fff15c01962f}{\index{md2cmds.\-c@{md2cmds.\-c}!md2cmds\-\_\-thread@{md2cmds\-\_\-thread}}
\index{md2cmds\-\_\-thread@{md2cmds\-\_\-thread}!md2cmds.c@{md2cmds.\-c}}
\subsubsection[{md2cmds\-\_\-thread}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-t md2cmds\-\_\-thread\hspace{0.3cm}{\ttfamily [static]}}}\label{md2cmds_8c_aa230921945149692de98fff15c01962f}


Definition at line 18 of file md2cmds.\-c.

