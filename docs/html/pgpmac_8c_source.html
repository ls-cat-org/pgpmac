<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>LS-CAT PGPMAC: pgpmac.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>pgpmac.c</h1><a href="pgpmac_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00226"></a>00226 <span class="preprocessor">#include &quot;<a class="code" href="pgpmac_8h.html" title="Headers for the entire pgpmac project.">pgpmac.h</a>&quot;</span>
<a name="l00227"></a>00227 
<a name="l00228"></a><a class="code" href="pgpmac_8h.html#a65daf0f4a5bc6def23a9df98ff5ca57e">00228</a> WINDOW *<a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>;                    
<a name="l00229"></a><a class="code" href="pgpmac_8h.html#ab0487111dbe3c05d0bd835eb2fb9a3f7">00229</a> WINDOW *<a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>;                     
<a name="l00230"></a><a class="code" href="pgpmac_8h.html#ae746a6903fb8a4ea216def88eccedc3c">00230</a> WINDOW *<a class="code" href="pgpmac_8c.html#ae746a6903fb8a4ea216def88eccedc3c" title="shutter, lamp, air, etc status">term_status</a>;                    
<a name="l00231"></a><a class="code" href="pgpmac_8h.html#ae2d7da3afeb756716e6e4ee9cab78f8a">00231</a> WINDOW *<a class="code" href="pgpmac_8c.html#ae2d7da3afeb756716e6e4ee9cab78f8a" title="shutter, lamp, air, etc status">term_status2</a>;                   
<a name="l00232"></a>00232 
<a name="l00233"></a><a class="code" href="pgpmac_8h.html#ad128c64890c7c0d4f836d9ec6e99216a">00233</a> pthread_mutex_t <a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>;          
<a name="l00234"></a>00234 
<a name="l00235"></a>00235 
<a name="l00236"></a>00236 <span class="comment">//</span>
<a name="l00237"></a>00237 <span class="comment">// globals</span>
<a name="l00238"></a>00238 <span class="comment">//</span>
<a name="l00239"></a><a class="code" href="pgpmac_8c.html#a6dc08e82e698d914ccb09077dd33668a">00239</a> <span class="keyword">static</span> <span class="keyword">struct </span>pollfd <a class="code" href="pgpmac_8c.html#a6dc08e82e698d914ccb09077dd33668a" title="Handle input from the keyboard.">stdinfda</a>;                  
<a name="l00240"></a>00240 
<a name="l00241"></a>00241 
<a name="l00242"></a>00242 
<a name="l00245"></a><a class="code" href="pgpmac_8c.html#a9127a8f722451b5996ffbc6966f4aa95">00245</a> <span class="keywordtype">void</span> <a class="code" href="pgpmac_8c.html#a9127a8f722451b5996ffbc6966f4aa95" title="Handle keyboard input.">stdinService</a>(
<a name="l00246"></a>00246                   <span class="keyword">struct</span> pollfd *evt            
<a name="l00247"></a>00247                   ) {
<a name="l00248"></a>00248   <span class="keyword">static</span> <span class="keywordtype">char</span> cmds[1024];
<a name="l00249"></a>00249   <span class="keyword">static</span> <span class="keywordtype">char</span> cntrlcmd[2];
<a name="l00250"></a>00250   <span class="keyword">static</span> <span class="keywordtype">char</span> cmds_on = 0;
<a name="l00251"></a>00251   <span class="keywordtype">int</span> ch;
<a name="l00252"></a>00252 
<a name="l00253"></a>00253 
<a name="l00254"></a>00254   <span class="keywordflow">for</span>( ch=wgetch(<a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>); ch != ERR; ch=wgetch(<a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>)) {
<a name="l00255"></a>00255     <span class="comment">// wprintw( term_output, &quot;%04x\n&quot;, ch);</span>
<a name="l00256"></a>00256     <span class="comment">// wnoutrefresh( term_output);</span>
<a name="l00257"></a>00257 
<a name="l00258"></a>00258     <span class="keywordflow">switch</span>( ch) {
<a name="l00259"></a>00259     <span class="keywordflow">case</span> KEY_F(1):
<a name="l00260"></a>00260       endwin();
<a name="l00261"></a>00261       exit(0);
<a name="l00262"></a>00262       <span class="keywordflow">break</span>;
<a name="l00263"></a>00263 
<a name="l00264"></a>00264     <span class="keywordflow">case</span> 0x0001:        <span class="comment">// Control-A</span>
<a name="l00265"></a>00265     <span class="keywordflow">case</span> 0x0002:        <span class="comment">// Control-B</span>
<a name="l00266"></a>00266     <span class="keywordflow">case</span> 0x0003:        <span class="comment">// Control-C</span>
<a name="l00267"></a>00267     <span class="keywordflow">case</span> 0x0004:        <span class="comment">// Control-D</span>
<a name="l00268"></a>00268     <span class="keywordflow">case</span> 0x0005:        <span class="comment">// Control-E</span>
<a name="l00269"></a>00269     <span class="keywordflow">case</span> 0x0006:        <span class="comment">// Control-F</span>
<a name="l00270"></a>00270     <span class="keywordflow">case</span> 0x0007:        <span class="comment">// Control-G</span>
<a name="l00271"></a>00271     <span class="keywordflow">case</span> 0x000b:        <span class="comment">// Control-K</span>
<a name="l00272"></a>00272     <span class="keywordflow">case</span> 0x000f:        <span class="comment">// Control-O</span>
<a name="l00273"></a>00273     <span class="keywordflow">case</span> 0x0010:        <span class="comment">// Control-P</span>
<a name="l00274"></a>00274     <span class="keywordflow">case</span> 0x0011:        <span class="comment">// Control-Q</span>
<a name="l00275"></a>00275     <span class="keywordflow">case</span> 0x0012:        <span class="comment">// Control-R</span>
<a name="l00276"></a>00276     <span class="keywordflow">case</span> 0x0013:        <span class="comment">// Control-Q</span>
<a name="l00277"></a>00277     <span class="keywordflow">case</span> 0x0016:        <span class="comment">// Control-V</span>
<a name="l00278"></a>00278       cntrlcmd[0] = ch;
<a name="l00279"></a>00279       cntrlcmd[1] = 0;
<a name="l00280"></a>00280       <a class="code" href="lspmac_8c.html#aaa442d9bc7a3cdee39adea0724f0e18c" title="Send a one line command.">lspmac_SockSendline</a>( cntrlcmd);
<a name="l00281"></a>00281       <span class="comment">//      PmacSockSendControlCharPrint( ch);</span>
<a name="l00282"></a>00282       <span class="keywordflow">break</span>;
<a name="l00283"></a>00283 
<a name="l00284"></a>00284     <span class="keywordflow">case</span> KEY_BACKSPACE:
<a name="l00285"></a>00285       cmds[cmds_on] = 0;
<a name="l00286"></a>00286       cmds_on == 0 ? 0 : cmds_on--;
<a name="l00287"></a>00287       <span class="keywordflow">break</span>;
<a name="l00288"></a>00288       
<a name="l00289"></a>00289     <span class="keywordflow">case</span> KEY_ENTER:
<a name="l00290"></a>00290     <span class="keywordflow">case</span> 0x000a:
<a name="l00291"></a>00291       <span class="keywordflow">if</span>( cmds_on &gt; 0 &amp;&amp; strlen( cmds) &gt; 0) {
<a name="l00292"></a>00292         <a class="code" href="lspmac_8c.html#aaa442d9bc7a3cdee39adea0724f0e18c" title="Send a one line command.">lspmac_SockSendline</a>( cmds);
<a name="l00293"></a>00293       }
<a name="l00294"></a>00294       memset( cmds, 0, <span class="keyword">sizeof</span>(cmds));
<a name="l00295"></a>00295       cmds_on = 0;
<a name="l00296"></a>00296       <span class="keywordflow">break</span>;
<a name="l00297"></a>00297       
<a name="l00298"></a>00298     <span class="keywordflow">default</span>:
<a name="l00299"></a>00299       <span class="keywordflow">if</span>( cmds_on &lt; <span class="keyword">sizeof</span>( cmds)-1) {
<a name="l00300"></a>00300         cmds[cmds_on++] = ch;
<a name="l00301"></a>00301         cmds[cmds_on] = 0;
<a name="l00302"></a>00302       }
<a name="l00303"></a>00303       <span class="keywordflow">break</span>;
<a name="l00304"></a>00304     }
<a name="l00305"></a>00305     
<a name="l00306"></a>00306     mvwprintw( <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>, 1, 1, <span class="stringliteral">&quot;PMAC&gt; %s&quot;</span>, cmds);
<a name="l00307"></a>00307     wclrtoeol( <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>);
<a name="l00308"></a>00308     box( <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>, 0, 0);
<a name="l00309"></a>00309     wnoutrefresh( <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>);
<a name="l00310"></a>00310     doupdate();
<a name="l00311"></a>00311 
<a name="l00312"></a>00312   }
<a name="l00313"></a>00313 }
<a name="l00314"></a>00314 
<a name="l00317"></a><a class="code" href="pgpmac_8h.html#a7762ca7b97b44b979e23ce88ca3b4249">00317</a> <span class="keywordtype">void</span> <a class="code" href="pgpmac_8c.html#a7762ca7b97b44b979e23ce88ca3b4249" title="Terminal output routine ala printf.">pgpmac_printf</a>(
<a name="l00318"></a>00318                    <span class="keywordtype">char</span> *fmt,           
<a name="l00319"></a>00319                    ...                  <span class="comment">/*         Arguments required by fmt                    */</span>
<a name="l00320"></a>00320                    ) {
<a name="l00321"></a>00321   va_list arg_ptr;
<a name="l00322"></a>00322 
<a name="l00323"></a>00323   pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00324"></a>00324 
<a name="l00325"></a>00325   va_start( arg_ptr, fmt);
<a name="l00326"></a>00326   vwprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, fmt, arg_ptr);
<a name="l00327"></a>00327   va_end( arg_ptr);
<a name="l00328"></a>00328 
<a name="l00329"></a>00329   wnoutrefresh( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>);
<a name="l00330"></a>00330   wnoutrefresh( <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>);
<a name="l00331"></a>00331   doupdate();
<a name="l00332"></a>00332 
<a name="l00333"></a>00333   pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00334"></a>00334 
<a name="l00335"></a>00335 }
<a name="l00336"></a>00336 
<a name="l00337"></a>00337 
<a name="l00340"></a><a class="code" href="pgpmac_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">00340</a> <span class="keywordtype">int</span> <a class="code" href="pgpmac_8c.html#a3c04138a5bfe5d72780bb7e82a18e627" title="Our main routine.">main</a>(
<a name="l00341"></a>00341          <span class="keywordtype">int</span> argc,              
<a name="l00342"></a>00342          <span class="keywordtype">char</span> **argv            
<a name="l00343"></a>00343          ) {
<a name="l00344"></a>00344   <span class="keyword">static</span> nfds_t nfds;
<a name="l00345"></a>00345 
<a name="l00346"></a>00346   <span class="keyword">static</span> <span class="keyword">struct </span>pollfd fda[3], *fdp;    <span class="comment">// input for poll: room for postgres, pmac, and stdin</span>
<a name="l00347"></a>00347   <span class="keyword">static</span> <span class="keywordtype">int</span> nfd = 0;                   <span class="comment">// number of items in fda</span>
<a name="l00348"></a>00348   <span class="keyword">static</span> <span class="keywordtype">int</span> pollrtn = 0;
<a name="l00349"></a>00349   <span class="keyword">static</span> <span class="keyword">struct </span>option long_options[] = {
<a name="l00350"></a>00350     { <span class="stringliteral">&quot;i-vars&quot;</span>, 0, NULL, <span class="charliteral">&apos;i&apos;</span>},
<a name="l00351"></a>00351     { <span class="stringliteral">&quot;m-vars&quot;</span>, 0, NULL, <span class="charliteral">&apos;m&apos;</span>},
<a name="l00352"></a>00352     { NULL,     0, NULL, 0}
<a name="l00353"></a>00353   };
<a name="l00354"></a>00354   <span class="keywordtype">int</span> c;
<a name="l00355"></a>00355   <span class="keywordtype">int</span> ivars, mvars;
<a name="l00356"></a>00356   mvars=0;
<a name="l00357"></a>00357   ivars=0;
<a name="l00358"></a>00358 
<a name="l00359"></a>00359   <span class="keywordtype">int</span> i;                                <span class="comment">// standard loop counter</span>
<a name="l00360"></a>00360 
<a name="l00361"></a>00361   <span class="keywordflow">while</span>( 1) {
<a name="l00362"></a>00362     c=getopt_long( argc, argv, <span class="stringliteral">&quot;im&quot;</span>, long_options, NULL);
<a name="l00363"></a>00363     <span class="keywordflow">if</span>( c == -1)
<a name="l00364"></a>00364       <span class="keywordflow">break</span>;
<a name="l00365"></a>00365 
<a name="l00366"></a>00366     <span class="keywordflow">switch</span>( c) {
<a name="l00367"></a>00367     <span class="keywordflow">case</span> <span class="charliteral">&apos;i&apos;</span>:
<a name="l00368"></a>00368       ivars=1;
<a name="l00369"></a>00369       <span class="keywordflow">break</span>;
<a name="l00370"></a>00370 
<a name="l00371"></a>00371     <span class="keywordflow">case</span> <span class="charliteral">&apos;m&apos;</span>:
<a name="l00372"></a>00372       mvars=1;
<a name="l00373"></a>00373       <span class="keywordflow">break</span>;
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     }
<a name="l00376"></a>00376   }
<a name="l00377"></a>00377 
<a name="l00378"></a>00378   <a class="code" href="pgpmac_8c.html#a6dc08e82e698d914ccb09077dd33668a" title="Handle input from the keyboard.">stdinfda</a>.fd = 0;
<a name="l00379"></a>00379   <a class="code" href="pgpmac_8c.html#a6dc08e82e698d914ccb09077dd33668a" title="Handle input from the keyboard.">stdinfda</a>.events = POLLIN;
<a name="l00380"></a>00380 
<a name="l00381"></a>00381   initscr();                            <span class="comment">// Start ncurses</span>
<a name="l00382"></a>00382   raw();                                <span class="comment">// Line buffering disabled, control chars trapped</span>
<a name="l00383"></a>00383   keypad( stdscr, TRUE);                <span class="comment">// Why is F1 nifty?</span>
<a name="l00384"></a>00384   refresh();
<a name="l00385"></a>00385 
<a name="l00386"></a>00386   pthread_mutex_init( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>, NULL);    <span class="comment">// don&apos;t lock this mutex yet because we are not multi-threaded until the &quot;_run&quot; functions</span>
<a name="l00387"></a>00387 
<a name="l00388"></a>00388   <span class="comment">//</span>
<a name="l00389"></a>00389   <span class="comment">// Since the modules reference objects in other modules it is important</span>
<a name="l00390"></a>00390   <span class="comment">// that everyone is initiallized before anyone runs</span>
<a name="l00391"></a>00391   <span class="comment">//</span>
<a name="l00392"></a>00392   <a class="code" href="lslogging_8c.html#a3418b9ab57811d28632794236e056408">lslogging_init</a>();
<a name="l00393"></a>00393   <a class="code" href="lsevents_8c.html#af19a77187e7406fc87d36bd26e672e6d">lsevents_init</a>();
<a name="l00394"></a>00394   <a class="code" href="lstimer_8c.html#a8cd37a8fb0f061456456a5d79bdd5189">lstimer_init</a>();
<a name="l00395"></a>00395   <a class="code" href="lspmac_8c.html#a236945579e57dbb30c0b64f5b9184e9d" title="Initialize this module.">lspmac_init</a>( ivars, mvars);
<a name="l00396"></a>00396   <a class="code" href="lspg_8c.html#a8a77972df14166e05c94ed0792baa09b" title="Initiallize the lspg module.">lspg_init</a>();
<a name="l00397"></a>00397   <a class="code" href="lsupdate_8c.html#adf63440ffbc65024fef87ea6a11ea8b0" title="Initialize this module.">lsupdate_init</a>();
<a name="l00398"></a>00398   <a class="code" href="lskvs_8c.html#ae4c780cd3a394259ca74d447bdae3537">lskvs_init</a>();
<a name="l00399"></a>00399   <a class="code" href="md2cmds_8c.html#a0851b1baecda6a67993efde41d77b1c1" title="Initialize the md2cmds module.">md2cmds_init</a>();
<a name="l00400"></a>00400 
<a name="l00401"></a>00401   <a class="code" href="pgpmac_8c.html#ae746a6903fb8a4ea216def88eccedc3c" title="shutter, lamp, air, etc status">term_status</a> = newwin( <a class="code" href="pgpmac_8h.html#a3bae94e8e4e4347dd5f87b6bda058de6" title="Number of status box rows.">LS_DISPLAY_WINDOW_HEIGHT</a>, <a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>, 3*<a class="code" href="pgpmac_8h.html#a3bae94e8e4e4347dd5f87b6bda058de6" title="Number of status box rows.">LS_DISPLAY_WINDOW_HEIGHT</a>, 0*<a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>);
<a name="l00402"></a>00402   box( <a class="code" href="pgpmac_8c.html#ae746a6903fb8a4ea216def88eccedc3c" title="shutter, lamp, air, etc status">term_status</a>, 0, 0);
<a name="l00403"></a>00403   wnoutrefresh( <a class="code" href="pgpmac_8c.html#ae746a6903fb8a4ea216def88eccedc3c" title="shutter, lamp, air, etc status">term_status</a>);
<a name="l00404"></a>00404                                                       
<a name="l00405"></a>00405   <a class="code" href="pgpmac_8c.html#ae2d7da3afeb756716e6e4ee9cab78f8a" title="shutter, lamp, air, etc status">term_status2</a> = newwin( <a class="code" href="pgpmac_8h.html#a3bae94e8e4e4347dd5f87b6bda058de6" title="Number of status box rows.">LS_DISPLAY_WINDOW_HEIGHT</a>, <a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>, 3*<a class="code" href="pgpmac_8h.html#a3bae94e8e4e4347dd5f87b6bda058de6" title="Number of status box rows.">LS_DISPLAY_WINDOW_HEIGHT</a>, 1*<a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>);
<a name="l00406"></a>00406   box( <a class="code" href="pgpmac_8c.html#ae2d7da3afeb756716e6e4ee9cab78f8a" title="shutter, lamp, air, etc status">term_status2</a>, 0, 0);
<a name="l00407"></a>00407   wnoutrefresh( <a class="code" href="pgpmac_8c.html#ae2d7da3afeb756716e6e4ee9cab78f8a" title="shutter, lamp, air, etc status">term_status2</a>);
<a name="l00408"></a>00408                                                       
<a name="l00409"></a>00409   <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a> = newwin( 20, 5*<a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>, 4*<a class="code" href="pgpmac_8h.html#a3bae94e8e4e4347dd5f87b6bda058de6" title="Number of status box rows.">LS_DISPLAY_WINDOW_HEIGHT</a>, 0);
<a name="l00410"></a>00410   scrollok( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, 1);                          
<a name="l00411"></a>00411   wnoutrefresh( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>);                         
<a name="l00412"></a>00412                                                       
<a name="l00413"></a>00413   <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>  = newwin( 3, 5*<a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>, 20+4*<a class="code" href="pgpmac_8h.html#a3bae94e8e4e4347dd5f87b6bda058de6" title="Number of status box rows.">LS_DISPLAY_WINDOW_HEIGHT</a>, 0);
<a name="l00414"></a>00414   box( <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>, 0, 0);                             
<a name="l00415"></a>00415   mvwprintw( <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>, 1, 1, <span class="stringliteral">&quot;PMAC&gt; &quot;</span>);             
<a name="l00416"></a>00416   nodelay( <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>, TRUE);                         
<a name="l00417"></a>00417   keypad( <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>, TRUE);                          
<a name="l00418"></a>00418   wnoutrefresh( <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>);                          
<a name="l00419"></a>00419                                                       
<a name="l00420"></a>00420   doupdate();                                         
<a name="l00421"></a>00421 
<a name="l00422"></a>00422   <a class="code" href="lslogging_8c.html#ad9f65252584e65957f461b809d59e3a2">lslogging_run</a>();
<a name="l00423"></a>00423   <a class="code" href="lsevents_8c.html#a4ddde538b603e3d4580ae9356bf9b89d">lsevents_run</a>();
<a name="l00424"></a>00424   <a class="code" href="lstimer_8c.html#a0b918acc1a4bf737cb62b5a70f8b553a">lstimer_run</a>();
<a name="l00425"></a>00425   <a class="code" href="lspmac_8c.html#a3a7fb93fb3fb9c4454613f30bfb0b1ee" title="Start up the lspmac thread.">lspmac_run</a>();
<a name="l00426"></a>00426   <a class="code" href="lspg_8c.html#a1adfdb5ca9fdb5060849d726bf540117" title="Start &amp;#39;er runnin&amp;#39;.">lspg_run</a>();
<a name="l00427"></a>00427   <a class="code" href="lsupdate_8c.html#af219e9b2cc124f109aa4c2c2e16b5d07" title="run the update routines">lsupdate_run</a>();
<a name="l00428"></a>00428   <a class="code" href="md2cmds_8c.html#aa62da7d423952334d41c7d282f45233d" title="Start up the thread.">md2cmds_run</a>();
<a name="l00429"></a>00429 
<a name="l00430"></a>00430   <span class="keywordflow">while</span>( 1) {
<a name="l00431"></a>00431     <span class="comment">//</span>
<a name="l00432"></a>00432     <span class="comment">// Big loop</span>
<a name="l00433"></a>00433     <span class="comment">//</span>
<a name="l00434"></a>00434 
<a name="l00435"></a>00435     nfd = 0;
<a name="l00436"></a>00436 
<a name="l00437"></a>00437     <span class="comment">//</span>
<a name="l00438"></a>00438     <span class="comment">// keyboard</span>
<a name="l00439"></a>00439     <span class="comment">//</span>
<a name="l00440"></a>00440     memcpy( &amp;(fda[nfd++]), &amp;<a class="code" href="pgpmac_8c.html#a6dc08e82e698d914ccb09077dd33668a" title="Handle input from the keyboard.">stdinfda</a>, <span class="keyword">sizeof</span>( <span class="keyword">struct</span> pollfd));
<a name="l00441"></a>00441     
<a name="l00442"></a>00442 
<a name="l00443"></a>00443     <span class="keywordflow">if</span>( nfd == 0) {
<a name="l00444"></a>00444       <span class="comment">//</span>
<a name="l00445"></a>00445       <span class="comment">// No connectons yet.  Wait a bit and try again.</span>
<a name="l00446"></a>00446       <span class="comment">//</span>
<a name="l00447"></a>00447       sleep( 10);
<a name="l00448"></a>00448       <span class="comment">//</span>
<a name="l00449"></a>00449       <span class="comment">// go try to connect again</span>
<a name="l00450"></a>00450       <span class="comment">//</span>
<a name="l00451"></a>00451       <span class="keywordflow">continue</span>;
<a name="l00452"></a>00452     }
<a name="l00453"></a>00453 
<a name="l00454"></a>00454 
<a name="l00455"></a>00455     pollrtn = poll( fda, nfd, 10);
<a name="l00456"></a>00456 
<a name="l00457"></a>00457     <span class="keywordflow">for</span>( i=0; pollrtn&gt;0 &amp;&amp; i&lt;nfd; i++) {
<a name="l00458"></a>00458       <span class="keywordflow">if</span>( fda[i].revents) {
<a name="l00459"></a>00459         pollrtn--;
<a name="l00460"></a>00460         <span class="keywordflow">if</span>( fda[i].fd == 0) {
<a name="l00461"></a>00461           <a class="code" href="pgpmac_8c.html#a9127a8f722451b5996ffbc6966f4aa95" title="Handle keyboard input.">stdinService</a>( &amp;fda[i]);
<a name="l00462"></a>00462         }
<a name="l00463"></a>00463       }
<a name="l00464"></a>00464     }
<a name="l00465"></a>00465   }
<a name="l00466"></a>00466 }
<a name="l00467"></a>00467 
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 14 Nov 2012 for LS-CAT PGPMAC by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
