\hypertarget{zz_8c}{
\section{zz.c File Reference}
\label{zz_8c}\index{zz.c@{zz.c}}
}
{\ttfamily \#include $<$stdlib.h$>$}\par
{\ttfamily \#include $<$unistd.h$>$}\par
{\ttfamily \#include $<$stdio.h$>$}\par
{\ttfamily \#include $<$signal.h$>$}\par
{\ttfamily \#include $<$time.h$>$}\par
\subsection*{Defines}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{zz_8c_a2694a39dfd1fa087ca6f9f391c91dae7}{CLOCKID}~CLOCK\_\-REALTIME
\item 
\#define \hyperlink{zz_8c_ad6f1d374549d22100d676d5fcac0a7e5}{SIG}~SIGRTMIN
\item 
\#define \hyperlink{zz_8c_ad11e20af81db034a0ebada85dcc7ec99}{errExit}(msg)
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static void \hyperlink{zz_8c_af380088ba9300678acecdd879187581b}{print\_\-siginfo} (siginfo\_\-t $\ast$si)
\item 
static void \hyperlink{zz_8c_a2643462d2f12a8804cf64cee546bb59e}{handler} (int sig, siginfo\_\-t $\ast$si, void $\ast$uc)
\item 
int \hyperlink{zz_8c_a0ddf1224851353fc92bfbff6f499fa97}{main} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\end{DoxyCompactItemize}


\subsection{Define Documentation}
\hypertarget{zz_8c_a2694a39dfd1fa087ca6f9f391c91dae7}{
\index{zz.c@{zz.c}!CLOCKID@{CLOCKID}}
\index{CLOCKID@{CLOCKID}!zz.c@{zz.c}}
\subsubsection[{CLOCKID}]{\setlength{\rightskip}{0pt plus 5cm}\#define CLOCKID~CLOCK\_\-REALTIME}}
\label{zz_8c_a2694a39dfd1fa087ca6f9f391c91dae7}


Definition at line 8 of file zz.c.\hypertarget{zz_8c_ad11e20af81db034a0ebada85dcc7ec99}{
\index{zz.c@{zz.c}!errExit@{errExit}}
\index{errExit@{errExit}!zz.c@{zz.c}}
\subsubsection[{errExit}]{\setlength{\rightskip}{0pt plus 5cm}\#define errExit(msg)}}
\label{zz_8c_ad11e20af81db034a0ebada85dcc7ec99}
{\bfseries Value:}
\begin{DoxyCode}
do { perror(msg); exit(EXIT_FAILURE);   \
  } while (0)
\end{DoxyCode}


Definition at line 11 of file zz.c.\hypertarget{zz_8c_ad6f1d374549d22100d676d5fcac0a7e5}{
\index{zz.c@{zz.c}!SIG@{SIG}}
\index{SIG@{SIG}!zz.c@{zz.c}}
\subsubsection[{SIG}]{\setlength{\rightskip}{0pt plus 5cm}\#define SIG~SIGRTMIN}}
\label{zz_8c_ad6f1d374549d22100d676d5fcac0a7e5}


Definition at line 9 of file zz.c.

\subsection{Function Documentation}
\hypertarget{zz_8c_a2643462d2f12a8804cf64cee546bb59e}{
\index{zz.c@{zz.c}!handler@{handler}}
\index{handler@{handler}!zz.c@{zz.c}}
\subsubsection[{handler}]{\setlength{\rightskip}{0pt plus 5cm}static void handler (int {\em sig}, \/  siginfo\_\-t $\ast$ {\em si}, \/  void $\ast$ {\em uc})\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}}
\label{zz_8c_a2643462d2f12a8804cf64cee546bb59e}


Definition at line 33 of file zz.c.


\begin{DoxyCode}
34 {
35   /* Note: calling printf() from a signal handler is not
36      strictly correct, since printf() is not async-signal-safe;
37      see signal(7) */
38 
39   printf("Caught signal %d\n", sig);
40   print_siginfo(si);
41   signal(sig, SIG_IGN);
42 }
\end{DoxyCode}
\hypertarget{zz_8c_a0ddf1224851353fc92bfbff6f499fa97}{
\index{zz.c@{zz.c}!main@{main}}
\index{main@{main}!zz.c@{zz.c}}
\subsubsection[{main}]{\setlength{\rightskip}{0pt plus 5cm}int main (int {\em argc}, \/  char $\ast$ {\em argv}\mbox{[}$\,$\mbox{]})}}
\label{zz_8c_a0ddf1224851353fc92bfbff6f499fa97}


Definition at line 45 of file zz.c.


\begin{DoxyCode}
46 {
47   timer_t timerid;
48   struct sigevent sev;
49   struct itimerspec its;
50   long long freq_nanosecs;
51   sigset_t mask;
52   struct sigaction sa;
53 
54   if (argc != 3) {
55     fprintf(stderr, "Usage: %s <sleep-secs> <freq-nanosecs>\n",
56             argv[0]);
57     exit(EXIT_FAILURE);
58   }
59 
60   /* Establish handler for timer signal */
61 
62   printf("Establishing handler for signal %d\n", SIG);
63   sa.sa_flags = SA_SIGINFO;
64   sa.sa_sigaction = handler;
65   sigemptyset(&sa.sa_mask);
66   if (sigaction(SIG, &sa, NULL) == -1)
67     errExit("sigaction");
68 
69   /* Block timer signal temporarily */
70 
71   printf("Blocking signal %d\n", SIG);
72   sigemptyset(&mask);
73   sigaddset(&mask, SIG);
74   if (sigprocmask(SIG_SETMASK, &mask, NULL) == -1)
75     errExit("sigprocmask");
76 
77   /* Create the timer */
78 
79   sev.sigev_notify = SIGEV_SIGNAL;
80   sev.sigev_signo = SIG;
81   sev.sigev_value.sival_ptr = &timerid;
82   if (timer_create(CLOCKID, &sev, &timerid) == -1)
83     errExit("timer_create");
84 
85   printf("timer ID is 0x%lx\n", (long) timerid);
86 
87   /* Start the timer */
88 
89   freq_nanosecs = atoll(argv[2]);
90   its.it_value.tv_sec = freq_nanosecs / 1000000000;
91   its.it_value.tv_nsec = freq_nanosecs % 1000000000;
92   its.it_interval.tv_sec = its.it_value.tv_sec;
93   its.it_interval.tv_nsec = its.it_value.tv_nsec;
94 
95   if (timer_settime(timerid, 0, &its, NULL) == -1)
96     errExit("timer_settime");
97 
98   /* Sleep for a while; meanwhile, the timer may expire
99      multiple times */
100 
101   printf("Sleeping for %d seconds\n", atoi(argv[1]));
102   sleep(atoi(argv[1]));
103 
104   /* Unlock the timer signal, so that timer notification
105      can be delivered */
106 
107   printf("Unblocking signal %d\n", SIG);
108   if (sigprocmask(SIG_UNBLOCK, &mask, NULL) == -1)
109     errExit("sigprocmask");
110 
111   exit(EXIT_SUCCESS);
112 }
\end{DoxyCode}
\hypertarget{zz_8c_af380088ba9300678acecdd879187581b}{
\index{zz.c@{zz.c}!print\_\-siginfo@{print\_\-siginfo}}
\index{print\_\-siginfo@{print\_\-siginfo}!zz.c@{zz.c}}
\subsubsection[{print\_\-siginfo}]{\setlength{\rightskip}{0pt plus 5cm}static void print\_\-siginfo (siginfo\_\-t $\ast$ {\em si})\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}}
\label{zz_8c_af380088ba9300678acecdd879187581b}


Definition at line 15 of file zz.c.


\begin{DoxyCode}
16 {
17   timer_t *tidp;
18   int or;
19 
20   tidp = si->si_value.sival_ptr;
21 
22   printf("    sival_ptr = %p; ", si->si_value.sival_ptr);
23   printf("    *sival_ptr = 0x%lx\n", (long) *tidp);
24 
25   or = timer_getoverrun(*tidp);
26   if (or == -1)
27     errExit("timer_getoverrun");
28   else
29     printf("    overrun count = %d\n", or);
30 }
\end{DoxyCode}
