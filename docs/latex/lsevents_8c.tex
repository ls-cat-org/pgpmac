\hypertarget{lsevents_8c}{\section{lsevents.\-c File Reference}
\label{lsevents_8c}\index{lsevents.\-c@{lsevents.\-c}}
}


event subsystem for inter-\/pgpmac communication  


{\ttfamily \#include \char`\"{}pgpmac.\-h\char`\"{}}\\*
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structlsevents__queue__struct}{lsevents\-\_\-queue\-\_\-struct}
\begin{DoxyCompactList}\small\item\em Storage definition for the events. \end{DoxyCompactList}\item 
struct \hyperlink{structlsevents__listener__struct}{lsevents\-\_\-listener\-\_\-struct}
\begin{DoxyCompactList}\small\item\em Linked list of event listeners. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{lsevents_8c_a75469307c70790f04b9b2bfcb1473a48}{L\-S\-E\-V\-E\-N\-T\-S\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H}~256
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef struct \\*
\hyperlink{structlsevents__queue__struct}{lsevents\-\_\-queue\-\_\-struct} \hyperlink{lsevents_8c_a82bd12b9e91198e33f44262d324616c4}{lsevents\-\_\-queue\-\_\-t}
\begin{DoxyCompactList}\small\item\em Storage definition for the events. \end{DoxyCompactList}\item 
typedef struct \\*
\hyperlink{structlsevents__listener__struct}{lsevents\-\_\-listener\-\_\-struct} \hyperlink{lsevents_8c_a8be5b9ff7269a3b057e354536cf9b0aa}{lsevents\-\_\-listener\-\_\-t}
\begin{DoxyCompactList}\small\item\em Linked list of event listeners. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{lsevents_8c_a5c6f122382dea3dcc231b772e5e75b46}{lsevents\-\_\-send\-\_\-event} (char $\ast$fmt,...)
\begin{DoxyCompactList}\small\item\em Call the callback routines for the given event. \end{DoxyCompactList}\item 
void \hyperlink{lsevents_8c_ab0617d3f0594b51d10e34bf397096654}{lsevents\-\_\-add\-\_\-listener} (char $\ast$event, void($\ast$cb)(char $\ast$))
\begin{DoxyCompactList}\small\item\em Add a callback routine to listen for a specific event. \end{DoxyCompactList}\item 
void \hyperlink{lsevents_8c_ab9c425de8de28f0089ad51676873f7e0}{lsevents\-\_\-remove\-\_\-listener} (char $\ast$event, void($\ast$cb)(char $\ast$))
\begin{DoxyCompactList}\small\item\em Remove a listener previously added with lsevents\-\_\-add\-\_\-listener. \end{DoxyCompactList}\item 
void $\ast$ \hyperlink{lsevents_8c_a48e8f9dee00710bbe293b4bbded37a39}{lsevents\-\_\-worker} (void $\ast$dummy)
\begin{DoxyCompactList}\small\item\em Our worker. \end{DoxyCompactList}\item 
void \hyperlink{lsevents_8c_af19a77187e7406fc87d36bd26e672e6d}{lsevents\-\_\-init} ()
\begin{DoxyCompactList}\small\item\em Initialize this module. \end{DoxyCompactList}\item 
void \hyperlink{lsevents_8c_a4ddde538b603e3d4580ae9356bf9b89d}{lsevents\-\_\-run} ()
\begin{DoxyCompactList}\small\item\em Start up the thread and get out of the way. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static \hyperlink{lsevents_8c_a82bd12b9e91198e33f44262d324616c4}{lsevents\-\_\-queue\-\_\-t} \hyperlink{lsevents_8c_ad1ff5e895b4016113c8414d9a5daa2f2}{lsevents\-\_\-queue} \mbox{[}\hyperlink{lsevents_8c_a75469307c70790f04b9b2bfcb1473a48}{L\-S\-E\-V\-E\-N\-T\-S\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H}\mbox{]}
\begin{DoxyCompactList}\small\item\em simple list of events \end{DoxyCompactList}\item 
static unsigned int \hyperlink{lsevents_8c_a3bccf603d56d5b2f4a92fad341d37e2c}{lsevents\-\_\-queue\-\_\-on} = 0
\begin{DoxyCompactList}\small\item\em next queue location to write \end{DoxyCompactList}\item 
static unsigned int \hyperlink{lsevents_8c_a50ad47e12cc4fc2d88659230b2fd44ff}{lsevents\-\_\-queue\-\_\-off} = 0
\begin{DoxyCompactList}\small\item\em next queue location to read \end{DoxyCompactList}\item 
static \hyperlink{lsevents_8c_a8be5b9ff7269a3b057e354536cf9b0aa}{lsevents\-\_\-listener\-\_\-t} $\ast$ \hyperlink{lsevents_8c_a300dc3edfa8546d75e9f8bab8fa06c5c}{lsevents\-\_\-listeners\-\_\-p} = N\-U\-L\-L
\begin{DoxyCompactList}\small\item\em Pointer to the first item in the link list of listeners. \end{DoxyCompactList}\item 
static pthread\-\_\-t \hyperlink{lsevents_8c_a314640d7c3cb4fa90823ab2418fbac9b}{lsevents\-\_\-thread}
\begin{DoxyCompactList}\small\item\em thread to run the event queue \end{DoxyCompactList}\item 
static pthread\-\_\-mutex\-\_\-t \hyperlink{lsevents_8c_a70bba59930a1c7d7d181aa03cdfb6c00}{lsevents\-\_\-listener\-\_\-mutex}
\begin{DoxyCompactList}\small\item\em mutex to protect the listener linked list \end{DoxyCompactList}\item 
static pthread\-\_\-mutex\-\_\-t \hyperlink{lsevents_8c_ab46f4ebda5e926a213faedac1a545ec1}{lsevents\-\_\-queue\-\_\-mutex}
\begin{DoxyCompactList}\small\item\em mutex to protect the event queue \end{DoxyCompactList}\item 
static pthread\-\_\-cond\-\_\-t \hyperlink{lsevents_8c_a8079d9fb8c35db3ca5f83be5aeb2a747}{lsevents\-\_\-queue\-\_\-cond}
\begin{DoxyCompactList}\small\item\em condition to pause the queue if needed \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
event subsystem for inter-\/pgpmac communication \begin{DoxyDate}{Date}
2012 
\end{DoxyDate}
\begin{DoxyAuthor}{Author}
Keith Brister 
\end{DoxyAuthor}
\begin{DoxyCopyright}{Copyright}
All Rights Reserved 
\end{DoxyCopyright}


Definition in file \hyperlink{lsevents_8c_source}{lsevents.\-c}.



\subsection{Macro Definition Documentation}
\hypertarget{lsevents_8c_a75469307c70790f04b9b2bfcb1473a48}{\index{lsevents.\-c@{lsevents.\-c}!L\-S\-E\-V\-E\-N\-T\-S\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H@{L\-S\-E\-V\-E\-N\-T\-S\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H}}
\index{L\-S\-E\-V\-E\-N\-T\-S\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H@{L\-S\-E\-V\-E\-N\-T\-S\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H}!lsevents.c@{lsevents.\-c}}
\subsubsection[{L\-S\-E\-V\-E\-N\-T\-S\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-E\-V\-E\-N\-T\-S\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H~256}}\label{lsevents_8c_a75469307c70790f04b9b2bfcb1473a48}


Definition at line 10 of file lsevents.\-c.



\subsection{Typedef Documentation}
\hypertarget{lsevents_8c_a8be5b9ff7269a3b057e354536cf9b0aa}{\index{lsevents.\-c@{lsevents.\-c}!lsevents\-\_\-listener\-\_\-t@{lsevents\-\_\-listener\-\_\-t}}
\index{lsevents\-\_\-listener\-\_\-t@{lsevents\-\_\-listener\-\_\-t}!lsevents.c@{lsevents.\-c}}
\subsubsection[{lsevents\-\_\-listener\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf lsevents\-\_\-listener\-\_\-struct}  {\bf lsevents\-\_\-listener\-\_\-t}}}\label{lsevents_8c_a8be5b9ff7269a3b057e354536cf9b0aa}


Linked list of event listeners. 

\hypertarget{lsevents_8c_a82bd12b9e91198e33f44262d324616c4}{\index{lsevents.\-c@{lsevents.\-c}!lsevents\-\_\-queue\-\_\-t@{lsevents\-\_\-queue\-\_\-t}}
\index{lsevents\-\_\-queue\-\_\-t@{lsevents\-\_\-queue\-\_\-t}!lsevents.c@{lsevents.\-c}}
\subsubsection[{lsevents\-\_\-queue\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf lsevents\-\_\-queue\-\_\-struct}  {\bf lsevents\-\_\-queue\-\_\-t}}}\label{lsevents_8c_a82bd12b9e91198e33f44262d324616c4}


Storage definition for the events. 

Just a string for now. Perhaps one day we'll succumb to the temptation to add an argument or two. 

\subsection{Function Documentation}
\hypertarget{lsevents_8c_ab0617d3f0594b51d10e34bf397096654}{\index{lsevents.\-c@{lsevents.\-c}!lsevents\-\_\-add\-\_\-listener@{lsevents\-\_\-add\-\_\-listener}}
\index{lsevents\-\_\-add\-\_\-listener@{lsevents\-\_\-add\-\_\-listener}!lsevents.c@{lsevents.\-c}}
\subsubsection[{lsevents\-\_\-add\-\_\-listener}]{\setlength{\rightskip}{0pt plus 5cm}void lsevents\-\_\-add\-\_\-listener (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{event, }
\item[{void($\ast$)(char $\ast$)}]{cb}
\end{DoxyParamCaption}
)}}\label{lsevents_8c_ab0617d3f0594b51d10e34bf397096654}


Add a callback routine to listen for a specific event. 


\begin{DoxyParams}{Parameters}
{\em event} & the name of the event to listen for \\
\hline
{\em cb} & the routine to call \\
\hline
\end{DoxyParams}


Definition at line 76 of file lsevents.\-c.


\begin{DoxyCode}
                                                             \{
  \hyperlink{structlsevents__listener__struct}{lsevents\_listener\_t} *\textcolor{keyword}{new};

  \textcolor{keyword}{new} = calloc( 1, \textcolor{keyword}{sizeof}( \hyperlink{structlsevents__listener__struct}{lsevents\_listener\_t}));
  \textcolor{keywordflow}{if}( \textcolor{keyword}{new} == NULL) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsevents\_add\_listener: out of
       memory"});
    exit( -1);
  \}

  strncpy( new->event, event, \hyperlink{pgpmac_8h_ab61d790b5572f116e091babfda53627b}{LSEVENTS\_EVENT\_LENGTH});
  \textcolor{keyword}{new}->event[\hyperlink{pgpmac_8h_ab61d790b5572f116e091babfda53627b}{LSEVENTS\_EVENT\_LENGTH}-1] = 0;
  \textcolor{keyword}{new}->cb   = cb;

  pthread\_mutex\_lock( &\hyperlink{lsevents_8c_a70bba59930a1c7d7d181aa03cdfb6c00}{lsevents\_listener\_mutex});
  \textcolor{keyword}{new}->next = \hyperlink{lsevents_8c_a300dc3edfa8546d75e9f8bab8fa06c5c}{lsevents\_listeners\_p};
  \hyperlink{lsevents_8c_a300dc3edfa8546d75e9f8bab8fa06c5c}{lsevents\_listeners\_p} = \textcolor{keyword}{new};
  pthread\_mutex\_unlock( &\hyperlink{lsevents_8c_a70bba59930a1c7d7d181aa03cdfb6c00}{lsevents\_listener\_mutex});

  \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsevents\_add\_listener: added
       listener for event %s"}, event);

\}
\end{DoxyCode}
\hypertarget{lsevents_8c_af19a77187e7406fc87d36bd26e672e6d}{\index{lsevents.\-c@{lsevents.\-c}!lsevents\-\_\-init@{lsevents\-\_\-init}}
\index{lsevents\-\_\-init@{lsevents\-\_\-init}!lsevents.c@{lsevents.\-c}}
\subsubsection[{lsevents\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void lsevents\-\_\-init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lsevents_8c_af19a77187e7406fc87d36bd26e672e6d}


Initialize this module. 



Definition at line 187 of file lsevents.\-c.


\begin{DoxyCode}
                     \{
  pthread\_mutex\_init( &\hyperlink{lsevents_8c_ab46f4ebda5e926a213faedac1a545ec1}{lsevents\_queue\_mutex}, NULL);
  pthread\_cond\_init(  &\hyperlink{lsevents_8c_a8079d9fb8c35db3ca5f83be5aeb2a747}{lsevents\_queue\_cond}, NULL);
  pthread\_mutex\_init( &\hyperlink{lsevents_8c_a70bba59930a1c7d7d181aa03cdfb6c00}{lsevents\_listener\_mutex}, NULL);
\}
\end{DoxyCode}
\hypertarget{lsevents_8c_ab9c425de8de28f0089ad51676873f7e0}{\index{lsevents.\-c@{lsevents.\-c}!lsevents\-\_\-remove\-\_\-listener@{lsevents\-\_\-remove\-\_\-listener}}
\index{lsevents\-\_\-remove\-\_\-listener@{lsevents\-\_\-remove\-\_\-listener}!lsevents.c@{lsevents.\-c}}
\subsubsection[{lsevents\-\_\-remove\-\_\-listener}]{\setlength{\rightskip}{0pt plus 5cm}void lsevents\-\_\-remove\-\_\-listener (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{event, }
\item[{void($\ast$)(char $\ast$)}]{cb}
\end{DoxyParamCaption}
)}}\label{lsevents_8c_ab9c425de8de28f0089ad51676873f7e0}


Remove a listener previously added with lsevents\-\_\-add\-\_\-listener. 


\begin{DoxyParams}{Parameters}
{\em event} & The name of the event \\
\hline
{\em cb} & The callback routine to remove \\
\hline
\end{DoxyParams}


Definition at line 102 of file lsevents.\-c.


\begin{DoxyCode}
                                                                \{
  
  \hyperlink{structlsevents__listener__struct}{lsevents\_listener\_t} *last, *current;

  \textcolor{comment}{//}
  \textcolor{comment}{// Find the listener to remove}
  \textcolor{comment}{// and unlink it from the list}
  \textcolor{comment}{//}
  pthread\_mutex\_lock( &\hyperlink{lsevents_8c_a70bba59930a1c7d7d181aa03cdfb6c00}{lsevents\_listener\_mutex});
  last = NULL;
  \textcolor{keywordflow}{for}( current = \hyperlink{lsevents_8c_a300dc3edfa8546d75e9f8bab8fa06c5c}{lsevents\_listeners\_p}; current != NULL; 
      current = current->\hyperlink{structlsevents__listener__struct_a8aed9196b0deab84e018b96c0cc59305}{next}) \{
    \textcolor{keywordflow}{if}( strcmp( last->\hyperlink{structlsevents__listener__struct_a270117dccadeda0164592c753dae15a1}{event}, event) == 0 && last->\hyperlink{structlsevents__listener__struct_a005906c1c9f0647e6ed1fb4592d8c5d0}{cb} == cb) \{
      \textcolor{keywordflow}{if}( last == NULL) \{
        \hyperlink{lsevents_8c_a300dc3edfa8546d75e9f8bab8fa06c5c}{lsevents\_listeners\_p} = current->\hyperlink{structlsevents__listener__struct_a8aed9196b0deab84e018b96c0cc59305}{next};
      \} \textcolor{keywordflow}{else} \{
        last->\hyperlink{structlsevents__listener__struct_a8aed9196b0deab84e018b96c0cc59305}{next} = current->\hyperlink{structlsevents__listener__struct_a8aed9196b0deab84e018b96c0cc59305}{next};
      \}
      \textcolor{keywordflow}{break};
    \}
  \}
  pthread\_mutex\_unlock( &\hyperlink{lsevents_8c_a70bba59930a1c7d7d181aa03cdfb6c00}{lsevents\_listener\_mutex});

  \textcolor{comment}{//}
  \textcolor{comment}{// Now remove it}
  \textcolor{comment}{// TODO: use saner memory management where we allocate many listeners at a
       time}
  \textcolor{comment}{// as an array and then just flag the ones that are used}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( current != NULL) \{
    \textcolor{keywordflow}{if}( current->\hyperlink{structlsevents__listener__struct_a270117dccadeda0164592c753dae15a1}{event} != NULL)
      free( current->\hyperlink{structlsevents__listener__struct_a270117dccadeda0164592c753dae15a1}{event});
    free(current);
  \}
\}
\end{DoxyCode}
\hypertarget{lsevents_8c_a4ddde538b603e3d4580ae9356bf9b89d}{\index{lsevents.\-c@{lsevents.\-c}!lsevents\-\_\-run@{lsevents\-\_\-run}}
\index{lsevents\-\_\-run@{lsevents\-\_\-run}!lsevents.c@{lsevents.\-c}}
\subsubsection[{lsevents\-\_\-run}]{\setlength{\rightskip}{0pt plus 5cm}void lsevents\-\_\-run (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lsevents_8c_a4ddde538b603e3d4580ae9356bf9b89d}


Start up the thread and get out of the way. 



Definition at line 195 of file lsevents.\-c.


\begin{DoxyCode}
                    \{
  pthread\_create( &\hyperlink{lsevents_8c_a314640d7c3cb4fa90823ab2418fbac9b}{lsevents\_thread}, NULL, \hyperlink{lsevents_8c_a48e8f9dee00710bbe293b4bbded37a39}{lsevents\_worker}
      , NULL);
\}
\end{DoxyCode}
\hypertarget{lsevents_8c_a5c6f122382dea3dcc231b772e5e75b46}{\index{lsevents.\-c@{lsevents.\-c}!lsevents\-\_\-send\-\_\-event@{lsevents\-\_\-send\-\_\-event}}
\index{lsevents\-\_\-send\-\_\-event@{lsevents\-\_\-send\-\_\-event}!lsevents.c@{lsevents.\-c}}
\subsubsection[{lsevents\-\_\-send\-\_\-event}]{\setlength{\rightskip}{0pt plus 5cm}void lsevents\-\_\-send\-\_\-event (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{fmt, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{lsevents_8c_a5c6f122382dea3dcc231b772e5e75b46}


Call the callback routines for the given event. 


\begin{DoxyParams}{Parameters}
{\em fmt} & a printf style formating string \\
\hline
{\em ...} & list of arguments specified by the format string \\
\hline
\end{DoxyParams}


Definition at line 44 of file lsevents.\-c.


\begin{DoxyCode}
                                          \{
  \textcolor{keywordtype}{char} \textcolor{keyword}{event}[\hyperlink{pgpmac_8h_ab61d790b5572f116e091babfda53627b}{LSEVENTS\_EVENT\_LENGTH}];
  \textcolor{keywordtype}{char} *sp;
  va\_list arg\_ptr;

  va\_start( arg\_ptr, fmt);
  vsnprintf( event, \textcolor{keyword}{sizeof}(event)-1, fmt, arg\_ptr);
  \textcolor{keyword}{event}[\textcolor{keyword}{sizeof}(event)-1]=0;
  va\_end( arg\_ptr);

  \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsevents\_send\_event: %s"}, event)
      ;

  pthread\_mutex\_lock( &\hyperlink{lsevents_8c_ab46f4ebda5e926a213faedac1a545ec1}{lsevents\_queue\_mutex});

  \textcolor{comment}{// maybe wait for room on the queue}
  \textcolor{keywordflow}{while}( \hyperlink{lsevents_8c_a3bccf603d56d5b2f4a92fad341d37e2c}{lsevents\_queue\_on} + 1 == \hyperlink{lsevents_8c_a50ad47e12cc4fc2d88659230b2fd44ff}{lsevents\_queue\_off}
      )
    pthread\_cond\_wait( &\hyperlink{lsevents_8c_a8079d9fb8c35db3ca5f83be5aeb2a747}{lsevents\_queue\_cond}, &
      \hyperlink{lsevents_8c_ab46f4ebda5e926a213faedac1a545ec1}{lsevents\_queue\_mutex});
  
  sp = \hyperlink{lsevents_8c_ad1ff5e895b4016113c8414d9a5daa2f2}{lsevents\_queue}[(\hyperlink{lsevents_8c_a3bccf603d56d5b2f4a92fad341d37e2c}{lsevents\_queue\_on}++) % 
      \hyperlink{lsevents_8c_a75469307c70790f04b9b2bfcb1473a48}{LSEVENTS\_QUEUE\_LENGTH}].event;
  strncpy( sp, event, \hyperlink{pgpmac_8h_ab61d790b5572f116e091babfda53627b}{LSEVENTS\_EVENT\_LENGTH});
  sp[\hyperlink{pgpmac_8h_ab61d790b5572f116e091babfda53627b}{LSEVENTS\_EVENT\_LENGTH} - 1] = 0;

  pthread\_cond\_signal(  &\hyperlink{lsevents_8c_a8079d9fb8c35db3ca5f83be5aeb2a747}{lsevents\_queue\_cond});
  pthread\_mutex\_unlock( &\hyperlink{lsevents_8c_ab46f4ebda5e926a213faedac1a545ec1}{lsevents\_queue\_mutex});

\}
\end{DoxyCode}
\hypertarget{lsevents_8c_a48e8f9dee00710bbe293b4bbded37a39}{\index{lsevents.\-c@{lsevents.\-c}!lsevents\-\_\-worker@{lsevents\-\_\-worker}}
\index{lsevents\-\_\-worker@{lsevents\-\_\-worker}!lsevents.c@{lsevents.\-c}}
\subsubsection[{lsevents\-\_\-worker}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ lsevents\-\_\-worker (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{dummy}
\end{DoxyParamCaption}
)}}\label{lsevents_8c_a48e8f9dee00710bbe293b4bbded37a39}


Our worker. 


\begin{DoxyParams}{Parameters}
{\em dummy} & Unused but needed by pthreads to be happy \\
\hline
\end{DoxyParams}


Definition at line 139 of file lsevents.\-c.


\begin{DoxyCode}
                       \{
  
  \textcolor{keywordtype}{char} \textcolor{keyword}{event}[\hyperlink{pgpmac_8h_ab61d790b5572f116e091babfda53627b}{LSEVENTS\_EVENT\_LENGTH}];
  \hyperlink{structlsevents__queue__struct}{lsevents\_queue\_t} *ep;
  \hyperlink{structlsevents__listener__struct}{lsevents\_listener\_t} *p;

  \textcolor{keywordflow}{while}( 1) \{
    pthread\_mutex\_lock( &\hyperlink{lsevents_8c_ab46f4ebda5e926a213faedac1a545ec1}{lsevents\_queue\_mutex});

    \textcolor{comment}{//}
    \textcolor{comment}{// wait for someone to send an event}
    \textcolor{comment}{//}
    \textcolor{keywordflow}{while}( \hyperlink{lsevents_8c_a50ad47e12cc4fc2d88659230b2fd44ff}{lsevents\_queue\_off} == \hyperlink{lsevents_8c_a3bccf603d56d5b2f4a92fad341d37e2c}{lsevents\_queue\_on}
      )
      pthread\_cond\_wait( &\hyperlink{lsevents_8c_a8079d9fb8c35db3ca5f83be5aeb2a747}{lsevents\_queue\_cond}, &
      \hyperlink{lsevents_8c_ab46f4ebda5e926a213faedac1a545ec1}{lsevents\_queue\_mutex});

    \textcolor{comment}{//}
    \textcolor{comment}{// copy event string since the value in the queue may change when}
    \textcolor{comment}{// we unlock the mutex}
    \textcolor{comment}{//}
    ep = &(\hyperlink{lsevents_8c_ad1ff5e895b4016113c8414d9a5daa2f2}{lsevents\_queue}[(\hyperlink{lsevents_8c_a50ad47e12cc4fc2d88659230b2fd44ff}{lsevents\_queue\_off}++
      ) % \hyperlink{lsevents_8c_a75469307c70790f04b9b2bfcb1473a48}{LSEVENTS\_QUEUE\_LENGTH}]);
    strncpy( event, ep->\hyperlink{structlsevents__queue__struct_a945691e4f4afbca101722840a891581e}{event}, \hyperlink{pgpmac_8h_ab61d790b5572f116e091babfda53627b}{LSEVENTS\_EVENT\_LENGTH})
      ;
    \textcolor{keyword}{event}[\hyperlink{pgpmac_8h_ab61d790b5572f116e091babfda53627b}{LSEVENTS\_EVENT\_LENGTH}-1] = 0;

    \textcolor{comment}{//}
    \textcolor{comment}{// let the send event process know there is room on the queue again}
    \textcolor{comment}{//}
    pthread\_cond\_signal(  &\hyperlink{lsevents_8c_a8079d9fb8c35db3ca5f83be5aeb2a747}{lsevents\_queue\_cond});
    pthread\_mutex\_unlock( &\hyperlink{lsevents_8c_ab46f4ebda5e926a213faedac1a545ec1}{lsevents\_queue\_mutex});

    \textcolor{comment}{//}
    \textcolor{comment}{// Find the callbacks and, well, call them back}
    \textcolor{comment}{//}
    pthread\_mutex\_lock( &\hyperlink{lsevents_8c_a70bba59930a1c7d7d181aa03cdfb6c00}{lsevents\_listener\_mutex});
    \textcolor{keywordflow}{for}( p = \hyperlink{lsevents_8c_a300dc3edfa8546d75e9f8bab8fa06c5c}{lsevents\_listeners\_p}; p != NULL; p = p->\hyperlink{structlsevents__listener__struct_a8aed9196b0deab84e018b96c0cc59305}{next}
      ) \{
      \textcolor{keywordflow}{if}( strcmp( event, p->\hyperlink{structlsevents__listener__struct_a270117dccadeda0164592c753dae15a1}{event}) == 0) \{
        p->\hyperlink{structlsevents__listener__struct_a005906c1c9f0647e6ed1fb4592d8c5d0}{cb}( p->\hyperlink{structlsevents__listener__struct_a270117dccadeda0164592c753dae15a1}{event});
      \}
    \}

    pthread\_mutex\_unlock( &\hyperlink{lsevents_8c_a70bba59930a1c7d7d181aa03cdfb6c00}{lsevents\_listener\_mutex});
  \}
  \textcolor{keywordflow}{return} NULL;
\}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{lsevents_8c_a70bba59930a1c7d7d181aa03cdfb6c00}{\index{lsevents.\-c@{lsevents.\-c}!lsevents\-\_\-listener\-\_\-mutex@{lsevents\-\_\-listener\-\_\-mutex}}
\index{lsevents\-\_\-listener\-\_\-mutex@{lsevents\-\_\-listener\-\_\-mutex}!lsevents.c@{lsevents.\-c}}
\subsubsection[{lsevents\-\_\-listener\-\_\-mutex}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-mutex\-\_\-t lsevents\-\_\-listener\-\_\-mutex\hspace{0.3cm}{\ttfamily [static]}}}\label{lsevents_8c_a70bba59930a1c7d7d181aa03cdfb6c00}


mutex to protect the listener linked list 



Definition at line 36 of file lsevents.\-c.

\hypertarget{lsevents_8c_a300dc3edfa8546d75e9f8bab8fa06c5c}{\index{lsevents.\-c@{lsevents.\-c}!lsevents\-\_\-listeners\-\_\-p@{lsevents\-\_\-listeners\-\_\-p}}
\index{lsevents\-\_\-listeners\-\_\-p@{lsevents\-\_\-listeners\-\_\-p}!lsevents.c@{lsevents.\-c}}
\subsubsection[{lsevents\-\_\-listeners\-\_\-p}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lsevents\-\_\-listener\-\_\-t}$\ast$ lsevents\-\_\-listeners\-\_\-p = N\-U\-L\-L\hspace{0.3cm}{\ttfamily [static]}}}\label{lsevents_8c_a300dc3edfa8546d75e9f8bab8fa06c5c}


Pointer to the first item in the link list of listeners. 



Definition at line 33 of file lsevents.\-c.

\hypertarget{lsevents_8c_ad1ff5e895b4016113c8414d9a5daa2f2}{\index{lsevents.\-c@{lsevents.\-c}!lsevents\-\_\-queue@{lsevents\-\_\-queue}}
\index{lsevents\-\_\-queue@{lsevents\-\_\-queue}!lsevents.c@{lsevents.\-c}}
\subsubsection[{lsevents\-\_\-queue}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lsevents\-\_\-queue\-\_\-t} lsevents\-\_\-queue\mbox{[}{\bf L\-S\-E\-V\-E\-N\-T\-S\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H}\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}}\label{lsevents_8c_ad1ff5e895b4016113c8414d9a5daa2f2}


simple list of events 



Definition at line 21 of file lsevents.\-c.

\hypertarget{lsevents_8c_a8079d9fb8c35db3ca5f83be5aeb2a747}{\index{lsevents.\-c@{lsevents.\-c}!lsevents\-\_\-queue\-\_\-cond@{lsevents\-\_\-queue\-\_\-cond}}
\index{lsevents\-\_\-queue\-\_\-cond@{lsevents\-\_\-queue\-\_\-cond}!lsevents.c@{lsevents.\-c}}
\subsubsection[{lsevents\-\_\-queue\-\_\-cond}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-cond\-\_\-t lsevents\-\_\-queue\-\_\-cond\hspace{0.3cm}{\ttfamily [static]}}}\label{lsevents_8c_a8079d9fb8c35db3ca5f83be5aeb2a747}


condition to pause the queue if needed 



Definition at line 38 of file lsevents.\-c.

\hypertarget{lsevents_8c_ab46f4ebda5e926a213faedac1a545ec1}{\index{lsevents.\-c@{lsevents.\-c}!lsevents\-\_\-queue\-\_\-mutex@{lsevents\-\_\-queue\-\_\-mutex}}
\index{lsevents\-\_\-queue\-\_\-mutex@{lsevents\-\_\-queue\-\_\-mutex}!lsevents.c@{lsevents.\-c}}
\subsubsection[{lsevents\-\_\-queue\-\_\-mutex}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-mutex\-\_\-t lsevents\-\_\-queue\-\_\-mutex\hspace{0.3cm}{\ttfamily [static]}}}\label{lsevents_8c_ab46f4ebda5e926a213faedac1a545ec1}


mutex to protect the event queue 



Definition at line 37 of file lsevents.\-c.

\hypertarget{lsevents_8c_a50ad47e12cc4fc2d88659230b2fd44ff}{\index{lsevents.\-c@{lsevents.\-c}!lsevents\-\_\-queue\-\_\-off@{lsevents\-\_\-queue\-\_\-off}}
\index{lsevents\-\_\-queue\-\_\-off@{lsevents\-\_\-queue\-\_\-off}!lsevents.c@{lsevents.\-c}}
\subsubsection[{lsevents\-\_\-queue\-\_\-off}]{\setlength{\rightskip}{0pt plus 5cm}unsigned int lsevents\-\_\-queue\-\_\-off = 0\hspace{0.3cm}{\ttfamily [static]}}}\label{lsevents_8c_a50ad47e12cc4fc2d88659230b2fd44ff}


next queue location to read 



Definition at line 23 of file lsevents.\-c.

\hypertarget{lsevents_8c_a3bccf603d56d5b2f4a92fad341d37e2c}{\index{lsevents.\-c@{lsevents.\-c}!lsevents\-\_\-queue\-\_\-on@{lsevents\-\_\-queue\-\_\-on}}
\index{lsevents\-\_\-queue\-\_\-on@{lsevents\-\_\-queue\-\_\-on}!lsevents.c@{lsevents.\-c}}
\subsubsection[{lsevents\-\_\-queue\-\_\-on}]{\setlength{\rightskip}{0pt plus 5cm}unsigned int lsevents\-\_\-queue\-\_\-on = 0\hspace{0.3cm}{\ttfamily [static]}}}\label{lsevents_8c_a3bccf603d56d5b2f4a92fad341d37e2c}


next queue location to write 



Definition at line 22 of file lsevents.\-c.

\hypertarget{lsevents_8c_a314640d7c3cb4fa90823ab2418fbac9b}{\index{lsevents.\-c@{lsevents.\-c}!lsevents\-\_\-thread@{lsevents\-\_\-thread}}
\index{lsevents\-\_\-thread@{lsevents\-\_\-thread}!lsevents.c@{lsevents.\-c}}
\subsubsection[{lsevents\-\_\-thread}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-t lsevents\-\_\-thread\hspace{0.3cm}{\ttfamily [static]}}}\label{lsevents_8c_a314640d7c3cb4fa90823ab2418fbac9b}


thread to run the event queue 



Definition at line 35 of file lsevents.\-c.

