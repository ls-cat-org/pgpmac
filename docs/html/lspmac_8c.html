<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LS-CAT PGPMAC: lspmac.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LS-CAT PGPMAC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lspmac_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">lspmac.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Routines concerned with communication with PMAC.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="pgpmac_8h_source.html">pgpmac.h</a>&quot;</code><br/>
</div>
<p><a href="lspmac_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmd2StatusStruct.html">md2StatusStruct</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">The block of memory retrieved in a status request.  <a href="structmd2StatusStruct.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlspmac__ascii__buffers__struct.html">lspmac_ascii_buffers_struct</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlspmac__dpascii__queue__struct.html">lspmac_dpascii_queue_struct</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a7e1c68021b3dbb53ba1bac2afbd8fc20"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a7e1c68021b3dbb53ba1bac2afbd8fc20">LS_PMAC_STATE_RESET</a>&#160;&#160;&#160;-1</td></tr>
<tr class="separator:a7e1c68021b3dbb53ba1bac2afbd8fc20"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7eb86ecf0789ab9555de1e03a4c73567"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a7eb86ecf0789ab9555de1e03a4c73567">LS_PMAC_STATE_DETACHED</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a7eb86ecf0789ab9555de1e03a4c73567"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37741af675425d61c876cc30ae6c99d0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a37741af675425d61c876cc30ae6c99d0">LS_PMAC_STATE_IDLE</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:a37741af675425d61c876cc30ae6c99d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d8f34fc599cc08c1a9d2cd62ccbb20a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a7d8f34fc599cc08c1a9d2cd62ccbb20a">LS_PMAC_STATE_SC</a>&#160;&#160;&#160;2</td></tr>
<tr class="separator:a7d8f34fc599cc08c1a9d2cd62ccbb20a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63356b0c18fcb186f456c12c6e927d84"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a63356b0c18fcb186f456c12c6e927d84">LS_PMAC_STATE_WACK_NFR</a>&#160;&#160;&#160;3</td></tr>
<tr class="separator:a63356b0c18fcb186f456c12c6e927d84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adef540911028fda73e8bbf0aa6ad39e9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#adef540911028fda73e8bbf0aa6ad39e9">LS_PMAC_STATE_WACK_CC</a>&#160;&#160;&#160;4</td></tr>
<tr class="separator:adef540911028fda73e8bbf0aa6ad39e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5eba9ef09d4316e803b9d75bd3104f43"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a5eba9ef09d4316e803b9d75bd3104f43">LS_PMAC_STATE_WACK</a>&#160;&#160;&#160;5</td></tr>
<tr class="separator:a5eba9ef09d4316e803b9d75bd3104f43"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a220b39710719cfe8b500d51819e8efeb"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a220b39710719cfe8b500d51819e8efeb">LS_PMAC_STATE_GMR</a>&#160;&#160;&#160;6</td></tr>
<tr class="separator:a220b39710719cfe8b500d51819e8efeb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abbd709b56a71eb1fc6adc9063605d243"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#abbd709b56a71eb1fc6adc9063605d243">LS_PMAC_STATE_CR</a>&#160;&#160;&#160;7</td></tr>
<tr class="separator:abbd709b56a71eb1fc6adc9063605d243"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add5325f4a84e4fe05f558880349485ea"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#add5325f4a84e4fe05f558880349485ea">LS_PMAC_STATE_RR</a>&#160;&#160;&#160;8</td></tr>
<tr class="separator:add5325f4a84e4fe05f558880349485ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e0a62cd9a1212419ad3615c34bdc65a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a3e0a62cd9a1212419ad3615c34bdc65a">LS_PMAC_STATE_WACK_RR</a>&#160;&#160;&#160;9</td></tr>
<tr class="separator:a3e0a62cd9a1212419ad3615c34bdc65a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f4ff8874677aac48a4c675f2c1ca4e9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a5f4ff8874677aac48a4c675f2c1ca4e9">LS_PMAC_STATE_GB</a>&#160;&#160;&#160;10</td></tr>
<tr class="separator:a5f4ff8874677aac48a4c675f2c1ca4e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a27ee6c39d58604c8aa9bd6c249c4833f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a27ee6c39d58604c8aa9bd6c249c4833f">LS_PMAC_STATE_WCR</a>&#160;&#160;&#160;11</td></tr>
<tr class="separator:a27ee6c39d58604c8aa9bd6c249c4833f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a591822cc92f76a39b293c2e90b322db2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a591822cc92f76a39b293c2e90b322db2">LS_PMAC_STATE_WGB</a>&#160;&#160;&#160;12</td></tr>
<tr class="separator:a591822cc92f76a39b293c2e90b322db2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86ef4ac4630165f30f6c16e4783ed89f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a86ef4ac4630165f30f6c16e4783ed89f">LSPMAC_PRESET_REGEX</a>&#160;&#160;&#160;&quot;(.*\\.%s\\.presets)\\.([0-9]+)\\.(name|position)&quot;</td></tr>
<tr class="memdesc:a86ef4ac4630165f30f6c16e4783ed89f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Regex to pick out preset name and corresponding position.  <a href="#a86ef4ac4630165f30f6c16e4783ed89f"></a><br/></td></tr>
<tr class="separator:a86ef4ac4630165f30f6c16e4783ed89f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac95886e84843b6b0bb6cc270e42043c4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ac95886e84843b6b0bb6cc270e42043c4">PMACPORT</a>&#160;&#160;&#160;1025</td></tr>
<tr class="memdesc:ac95886e84843b6b0bb6cc270e42043c4"><td class="mdescLeft">&#160;</td><td class="mdescRight">The PMAC (only) listens on this port.  <a href="#ac95886e84843b6b0bb6cc270e42043c4"></a><br/></td></tr>
<tr class="separator:ac95886e84843b6b0bb6cc270e42043c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abdc45e3f7106f84f688419e2da9b3627"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#abdc45e3f7106f84f688419e2da9b3627">pmac_cmd_size</a>&#160;&#160;&#160;8</td></tr>
<tr class="memdesc:abdc45e3f7106f84f688419e2da9b3627"><td class="mdescLeft">&#160;</td><td class="mdescRight">PMAC command size in bytes.  <a href="#abdc45e3f7106f84f688419e2da9b3627"></a><br/></td></tr>
<tr class="separator:abdc45e3f7106f84f688419e2da9b3627"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5485d08fdc80533b5cebadff63696ed2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>&#160;&#160;&#160;0xc0</td></tr>
<tr class="separator:a5485d08fdc80533b5cebadff63696ed2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af24ecdc10723dc8fd6320fef416ae514"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#af24ecdc10723dc8fd6320fef416ae514">VR_DOWNLOAD</a>&#160;&#160;&#160;0x40</td></tr>
<tr class="separator:af24ecdc10723dc8fd6320fef416ae514"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a772b2ea2ad93989ae4275c79a93525ee"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a772b2ea2ad93989ae4275c79a93525ee">VR_PMAC_SENDLINE</a>&#160;&#160;&#160;0xb0</td></tr>
<tr class="separator:a772b2ea2ad93989ae4275c79a93525ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af3c7372a48fccf0458f266f4bc758a2c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#af3c7372a48fccf0458f266f4bc758a2c">VR_PMAC_GETLINE</a>&#160;&#160;&#160;0xb1</td></tr>
<tr class="separator:af3c7372a48fccf0458f266f4bc758a2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0e5588681366b52589cd321eabf12ff"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ac0e5588681366b52589cd321eabf12ff">VR_PMAC_FLUSH</a>&#160;&#160;&#160;0xb3</td></tr>
<tr class="separator:ac0e5588681366b52589cd321eabf12ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9c53e7c5b2681a5ca1c5410a914a2dc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#af9c53e7c5b2681a5ca1c5410a914a2dc">VR_PMAC_GETMEM</a>&#160;&#160;&#160;0xb4</td></tr>
<tr class="separator:af9c53e7c5b2681a5ca1c5410a914a2dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab79207cc3145740f8c070a24c91b11e0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ab79207cc3145740f8c070a24c91b11e0">VR_PMAC_SETMEM</a>&#160;&#160;&#160;0xb5</td></tr>
<tr class="separator:ab79207cc3145740f8c070a24c91b11e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76c1c401354826ac2ba8906578be930f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a76c1c401354826ac2ba8906578be930f">VR_PMAC_SENDCTRLCHAR</a>&#160;&#160;&#160;0xb6</td></tr>
<tr class="separator:a76c1c401354826ac2ba8906578be930f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaed77195148c3d9fe10c6e82fc6b2ea7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aaed77195148c3d9fe10c6e82fc6b2ea7">VR_PMAC_SETBIT</a>&#160;&#160;&#160;0xba</td></tr>
<tr class="separator:aaed77195148c3d9fe10c6e82fc6b2ea7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91a625425f6df7610f440231868a5cf1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a91a625425f6df7610f440231868a5cf1">VR_PMAC_SETBITS</a>&#160;&#160;&#160;0xbb</td></tr>
<tr class="separator:a91a625425f6df7610f440231868a5cf1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4cd95cb80b8da3962ebe9ec8afe844c8"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a4cd95cb80b8da3962ebe9ec8afe844c8">VR_PMAC_PORT</a>&#160;&#160;&#160;0xbe</td></tr>
<tr class="separator:a4cd95cb80b8da3962ebe9ec8afe844c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee7c46f33b9b6945c6b2b260810dc7f5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aee7c46f33b9b6945c6b2b260810dc7f5">VR_PMAC_GETRESPONSE</a>&#160;&#160;&#160;0xbf</td></tr>
<tr class="separator:aee7c46f33b9b6945c6b2b260810dc7f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad3c7b4a9403e56c09eceadcf21252c0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aad3c7b4a9403e56c09eceadcf21252c0">VR_PMAC_READREADY</a>&#160;&#160;&#160;0xc2</td></tr>
<tr class="separator:aad3c7b4a9403e56c09eceadcf21252c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f4ce4666a23a3fb153d680bd1cb6556"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a8f4ce4666a23a3fb153d680bd1cb6556">VR_CTRL_RESPONSE</a>&#160;&#160;&#160;0xc4</td></tr>
<tr class="separator:a8f4ce4666a23a3fb153d680bd1cb6556"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50e444b5ceb6d62a1be43c88c55c549c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a50e444b5ceb6d62a1be43c88c55c549c">VR_PMAC_GETBUFFER</a>&#160;&#160;&#160;0xc5</td></tr>
<tr class="separator:a50e444b5ceb6d62a1be43c88c55c549c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5e53c37c17cd06e42f7b0df211f96d8"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#af5e53c37c17cd06e42f7b0df211f96d8">VR_PMAC_WRITEBUFFER</a>&#160;&#160;&#160;0xc6</td></tr>
<tr class="separator:af5e53c37c17cd06e42f7b0df211f96d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8367c4c9247a96c6828418d87b8623b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ab8367c4c9247a96c6828418d87b8623b">VR_PMAC_WRITEERROR</a>&#160;&#160;&#160;0xc7</td></tr>
<tr class="separator:ab8367c4c9247a96c6828418d87b8623b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15e4dbce5615c285ec1755f01057b5fe"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a15e4dbce5615c285ec1755f01057b5fe">VR_FWDOWNLOAD</a>&#160;&#160;&#160;0xcb</td></tr>
<tr class="separator:a15e4dbce5615c285ec1755f01057b5fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34a2e0d5c1f48ba463ae5d98431d05f7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a34a2e0d5c1f48ba463ae5d98431d05f7">VR_IPADDRESS</a>&#160;&#160;&#160;0xe0</td></tr>
<tr class="separator:a34a2e0d5c1f48ba463ae5d98431d05f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59f5f5218e25332dbf64f216aec116e5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a59f5f5218e25332dbf64f216aec116e5">PMAC_MIN_CMD_TIME</a>&#160;&#160;&#160;10000.0</td></tr>
<tr class="memdesc:a59f5f5218e25332dbf64f216aec116e5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Minimum time between commands to the pmac.  <a href="#a59f5f5218e25332dbf64f216aec116e5"></a><br/></td></tr>
<tr class="separator:a59f5f5218e25332dbf64f216aec116e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3fae557baafab24b7518dc84f5ef5a9b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a3fae557baafab24b7518dc84f5ef5a9b">PMAC_CMD_QUEUE_LENGTH</a>&#160;&#160;&#160;2048</td></tr>
<tr class="memdesc:a3fae557baafab24b7518dc84f5ef5a9b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Size of the PMAC command queue.  <a href="#a3fae557baafab24b7518dc84f5ef5a9b"></a><br/></td></tr>
<tr class="separator:a3fae557baafab24b7518dc84f5ef5a9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a407e2e4d57ac45ecd700f8bad3d3b5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a3a407e2e4d57ac45ecd700f8bad3d3b5">LSPMAC_DPASCII_QUEUE_LENGTH</a>&#160;&#160;&#160;1024</td></tr>
<tr class="separator:a3a407e2e4d57ac45ecd700f8bad3d3b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a3495613b8b94cadc4205f19e1254ebeb"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structmd2StatusStruct.html">md2StatusStruct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a3495613b8b94cadc4205f19e1254ebeb">md2_status_t</a></td></tr>
<tr class="memdesc:a3495613b8b94cadc4205f19e1254ebeb"><td class="mdescLeft">&#160;</td><td class="mdescRight">The block of memory retrieved in a status request.  <a href="#a3495613b8b94cadc4205f19e1254ebeb"></a><br/></td></tr>
<tr class="separator:a3495613b8b94cadc4205f19e1254ebeb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f7d17365bd23c29c6f498210179d2c1"><td class="memItemLeft" align="right" valign="top">typedef struct <br class="typebreak"/>
<a class="el" href="structlspmac__ascii__buffers__struct.html">lspmac_ascii_buffers_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a3f7d17365bd23c29c6f498210179d2c1">lspmac_ascii_buffers_t</a></td></tr>
<tr class="separator:a3f7d17365bd23c29c6f498210179d2c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93786bb32f3e2ef44e7967210beeeca3"><td class="memItemLeft" align="right" valign="top">typedef struct <br class="typebreak"/>
<a class="el" href="structlspmac__dpascii__queue__struct.html">lspmac_dpascii_queue_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a93786bb32f3e2ef44e7967210beeeca3">lspmac_dpascii_queue_t</a></td></tr>
<tr class="separator:a93786bb32f3e2ef44e7967210beeeca3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:adb46b594a6926134322186a3c85df37d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#adb46b594a6926134322186a3c85df37d">lspmac_get_ascii</a> (char *)</td></tr>
<tr class="memdesc:adb46b594a6926134322186a3c85df37d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Forward declarateion.  <a href="#adb46b594a6926134322186a3c85df37d"></a><br/></td></tr>
<tr class="separator:adb46b594a6926134322186a3c85df37d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55b882be15d56a2a777f2b1f92901b7d"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a55b882be15d56a2a777f2b1f92901b7d">lspmac_lut</a> (int nlut, double *lut, double x)</td></tr>
<tr class="memdesc:a55b882be15d56a2a777f2b1f92901b7d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Look up table support for motor positions (think x=zoom, y=light intensity) use a lookup table to find the "counts" to move the motor to the requested position The look up table is a simple one dimensional array with the x values as even indicies and the y values as odd indices.  <a href="#a55b882be15d56a2a777f2b1f92901b7d"></a><br/></td></tr>
<tr class="separator:a55b882be15d56a2a777f2b1f92901b7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5afe5cd407b44f9c05ad4f1c4e4d5f6a"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a5afe5cd407b44f9c05ad4f1c4e4d5f6a">lspmac_rlut</a> (int nlut, double *lut, double y)</td></tr>
<tr class="separator:a5afe5cd407b44f9c05ad4f1c4e4d5f6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c3786f3a38724f497afc4fe6d82d8c4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a1c3786f3a38724f497afc4fe6d82d8c4">hex_dump</a> (int n, unsigned char *s)</td></tr>
<tr class="memdesc:a1c3786f3a38724f497afc4fe6d82d8c4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prints a hex dump of the given data.  <a href="#a1c3786f3a38724f497afc4fe6d82d8c4"></a><br/></td></tr>
<tr class="separator:a1c3786f3a38724f497afc4fe6d82d8c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f9f1ad624350095075aa6b51423b02d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a8f9f1ad624350095075aa6b51423b02d">cleanstr</a> (char *s)</td></tr>
<tr class="memdesc:a8f9f1ad624350095075aa6b51423b02d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Replace \r with \n in null terminated string and print result to terminal.  <a href="#a8f9f1ad624350095075aa6b51423b02d"></a><br/></td></tr>
<tr class="separator:a8f9f1ad624350095075aa6b51423b02d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae020ea2478b41702ce8b7d20b2560be"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aae020ea2478b41702ce8b7d20b2560be">lsConnect</a> (char *ipaddr)</td></tr>
<tr class="memdesc:aae020ea2478b41702ce8b7d20b2560be"><td class="mdescLeft">&#160;</td><td class="mdescRight">Connect to the PMAC socket.  <a href="#aae020ea2478b41702ce8b7d20b2560be"></a><br/></td></tr>
<tr class="separator:aae020ea2478b41702ce8b7d20b2560be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42a441a750044362f1d21bf9f08521cb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a42a441a750044362f1d21bf9f08521cb">lspmac_reset_queue</a> ()</td></tr>
<tr class="memdesc:a42a441a750044362f1d21bf9f08521cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clear the queue as part of PMAC reinitialization.  <a href="#a42a441a750044362f1d21bf9f08521cb"></a><br/></td></tr>
<tr class="separator:a42a441a750044362f1d21bf9f08521cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84a6096d9bfff2bfb1506a216756ae28"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a84a6096d9bfff2bfb1506a216756ae28">lspmac_push_queue</a> (<a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *cmd)</td></tr>
<tr class="memdesc:a84a6096d9bfff2bfb1506a216756ae28"><td class="mdescLeft">&#160;</td><td class="mdescRight">Put a new command on the queue.  <a href="#a84a6096d9bfff2bfb1506a216756ae28"></a><br/></td></tr>
<tr class="separator:a84a6096d9bfff2bfb1506a216756ae28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9627f30135aa7007bc4ab8dde905739a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a9627f30135aa7007bc4ab8dde905739a">lspmac_pop_queue</a> ()</td></tr>
<tr class="memdesc:a9627f30135aa7007bc4ab8dde905739a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove the oldest queue item.  <a href="#a9627f30135aa7007bc4ab8dde905739a"></a><br/></td></tr>
<tr class="separator:a9627f30135aa7007bc4ab8dde905739a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f60f18dfe11c1c0299909521596be8f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a0f60f18dfe11c1c0299909521596be8f">lspmac_pop_reply</a> ()</td></tr>
<tr class="memdesc:a0f60f18dfe11c1c0299909521596be8f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove the next command queue item that is waiting for a reply.  <a href="#a0f60f18dfe11c1c0299909521596be8f"></a><br/></td></tr>
<tr class="separator:a0f60f18dfe11c1c0299909521596be8f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac60f32e1ab6d81a60155e355db752726"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726">lspmac_send_command</a> (int rqType, int rq, int wValue, int wIndex, int wLength, char *data, void(*responseCB)(<a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *, int, char *), int no_reply, char *event)</td></tr>
<tr class="memdesc:ac60f32e1ab6d81a60155e355db752726"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compose a packet and send it to the PMAC.  <a href="#ac60f32e1ab6d81a60155e355db752726"></a><br/></td></tr>
<tr class="separator:ac60f32e1ab6d81a60155e355db752726"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5745f25f242edf02f7b9b7c77ed6126"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ac5745f25f242edf02f7b9b7c77ed6126">lspmac_SockFlush</a> ()</td></tr>
<tr class="memdesc:ac5745f25f242edf02f7b9b7c77ed6126"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset the PMAC socket from the PMAC side.  <a href="#ac5745f25f242edf02f7b9b7c77ed6126"></a><br/></td></tr>
<tr class="separator:ac5745f25f242edf02f7b9b7c77ed6126"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaedae34bc18ac1742a232117c125d7b9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aaedae34bc18ac1742a232117c125d7b9">lspmac_Reset</a> ()</td></tr>
<tr class="memdesc:aaedae34bc18ac1742a232117c125d7b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clear the queue and put the PMAC into a known state.  <a href="#aaedae34bc18ac1742a232117c125d7b9"></a><br/></td></tr>
<tr class="separator:aaedae34bc18ac1742a232117c125d7b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4748a88d1fe46aa3ab1beee55bcddf1b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a4748a88d1fe46aa3ab1beee55bcddf1b">lspmac_Error</a> (char *buff)</td></tr>
<tr class="memdesc:a4748a88d1fe46aa3ab1beee55bcddf1b"><td class="mdescLeft">&#160;</td><td class="mdescRight">The service routing detected an error condition.  <a href="#a4748a88d1fe46aa3ab1beee55bcddf1b"></a><br/></td></tr>
<tr class="separator:a4748a88d1fe46aa3ab1beee55bcddf1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af3fa79868ba88f7c37f7b8f7d53149ff"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#af3fa79868ba88f7c37f7b8f7d53149ff">lspmac_Service</a> (struct pollfd *evt)</td></tr>
<tr class="memdesc:af3fa79868ba88f7c37f7b8f7d53149ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Service routine for packet coming from the PMAC.  <a href="#af3fa79868ba88f7c37f7b8f7d53149ff"></a><br/></td></tr>
<tr class="separator:af3fa79868ba88f7c37f7b8f7d53149ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81e8e315099cf9b6eef0335b01f97bfd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a81e8e315099cf9b6eef0335b01f97bfd">lspmac_GetShortReplyCB</a> (<a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *cmd, int nreceived, char *buff)</td></tr>
<tr class="memdesc:a81e8e315099cf9b6eef0335b01f97bfd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receive a reply that does not require multiple buffers.  <a href="#a81e8e315099cf9b6eef0335b01f97bfd"></a><br/></td></tr>
<tr class="separator:a81e8e315099cf9b6eef0335b01f97bfd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2dd5e31cb4a69470b061aa56473be14"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ae2dd5e31cb4a69470b061aa56473be14">lspmac_SendControlReplyPrintCB</a> (<a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *cmd, int nreceived, char *buff)</td></tr>
<tr class="memdesc:ae2dd5e31cb4a69470b061aa56473be14"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receive a reply to a control character Print a "printable" version of the character to the terminal Followed by a hex dump of the response.  <a href="#ae2dd5e31cb4a69470b061aa56473be14"></a><br/></td></tr>
<tr class="separator:ae2dd5e31cb4a69470b061aa56473be14"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e4b7bbfb008acbbad98accf18492f0b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a5e4b7bbfb008acbbad98accf18492f0b">lspmac_GetmemReplyCB</a> (<a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *cmd, int nreceived, char *buff)</td></tr>
<tr class="memdesc:a5e4b7bbfb008acbbad98accf18492f0b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Service a reply to the getmem command.  <a href="#a5e4b7bbfb008acbbad98accf18492f0b"></a><br/></td></tr>
<tr class="separator:a5e4b7bbfb008acbbad98accf18492f0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a56c777b1469ad8c3d29d825a71e300"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a0a56c777b1469ad8c3d29d825a71e300">lspmac_SockGetmem</a> (int offset, int nbytes)</td></tr>
<tr class="memdesc:a0a56c777b1469ad8c3d29d825a71e300"><td class="mdescLeft">&#160;</td><td class="mdescRight">Request a chunk of memory to be returned.  <a href="#a0a56c777b1469ad8c3d29d825a71e300"></a><br/></td></tr>
<tr class="separator:a0a56c777b1469ad8c3d29d825a71e300"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adebcd9b5045d49112b704a7656a981c9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#adebcd9b5045d49112b704a7656a981c9">lspmac_SockSendline</a> (char *event, char *fmt,...)</td></tr>
<tr class="memdesc:adebcd9b5045d49112b704a7656a981c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a one line command.  <a href="#adebcd9b5045d49112b704a7656a981c9"></a><br/></td></tr>
<tr class="separator:adebcd9b5045d49112b704a7656a981c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d62df6a1f2245df8b6e549984c9b46f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a9d62df6a1f2245df8b6e549984c9b46f">lspmac_SockSendline_nr</a> (char *event, char *fmt,...)</td></tr>
<tr class="memdesc:a9d62df6a1f2245df8b6e549984c9b46f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a command and ignore the response.  <a href="#a9d62df6a1f2245df8b6e549984c9b46f"></a><br/></td></tr>
<tr class="separator:a9d62df6a1f2245df8b6e549984c9b46f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8707477f9799b4cc8c6f465ecfeee24b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a8707477f9799b4cc8c6f465ecfeee24b">lspmac_SockSendControlCharPrint</a> (char *event, char c)</td></tr>
<tr class="memdesc:a8707477f9799b4cc8c6f465ecfeee24b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a control character.  <a href="#a8707477f9799b4cc8c6f465ecfeee24b"></a><br/></td></tr>
<tr class="separator:a8707477f9799b4cc8c6f465ecfeee24b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a825ba2feb0108b977c34872e24a6c827"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a825ba2feb0108b977c34872e24a6c827">lspmac_Getmem</a> ()</td></tr>
<tr class="memdesc:a825ba2feb0108b977c34872e24a6c827"><td class="mdescLeft">&#160;</td><td class="mdescRight">Request a block of double buffer memory.  <a href="#a825ba2feb0108b977c34872e24a6c827"></a><br/></td></tr>
<tr class="separator:a825ba2feb0108b977c34872e24a6c827"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a05aeb6b4b78725f3e36e11eecb3623a4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a05aeb6b4b78725f3e36e11eecb3623a4">lspmac_bo_read</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp)</td></tr>
<tr class="memdesc:a05aeb6b4b78725f3e36e11eecb3623a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read the state of a binary i/o motor This is the read method for the binary i/o motor class.  <a href="#a05aeb6b4b78725f3e36e11eecb3623a4"></a><br/></td></tr>
<tr class="separator:a05aeb6b4b78725f3e36e11eecb3623a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a200bc9306d54fca566eb5e29d8e82308"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a200bc9306d54fca566eb5e29d8e82308">lspmac_dac_read</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp)</td></tr>
<tr class="memdesc:a200bc9306d54fca566eb5e29d8e82308"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read a DAC motor position.  <a href="#a200bc9306d54fca566eb5e29d8e82308"></a><br/></td></tr>
<tr class="separator:a200bc9306d54fca566eb5e29d8e82308"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab81f07dea6bb0e88103a05a380de1034"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ab81f07dea6bb0e88103a05a380de1034">lspmac_shutter_read</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp)</td></tr>
<tr class="memdesc:ab81f07dea6bb0e88103a05a380de1034"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fast shutter read routine The shutter is mildly complicated in that we need to take into account the fact that the shutter can open and close again between status updates.  <a href="#ab81f07dea6bb0e88103a05a380de1034"></a><br/></td></tr>
<tr class="separator:ab81f07dea6bb0e88103a05a380de1034"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fbadf816a842c8f131cf8ee47b54e29"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a9fbadf816a842c8f131cf8ee47b54e29">lspmac_home1_queue</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp)</td></tr>
<tr class="memdesc:a9fbadf816a842c8f131cf8ee47b54e29"><td class="mdescLeft">&#160;</td><td class="mdescRight">Home the motor.  <a href="#a9fbadf816a842c8f131cf8ee47b54e29"></a><br/></td></tr>
<tr class="separator:a9fbadf816a842c8f131cf8ee47b54e29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43e54631dc8de372854ebbb63ff28f70"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a43e54631dc8de372854ebbb63ff28f70">lspmac_home2_queue</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp)</td></tr>
<tr class="memdesc:a43e54631dc8de372854ebbb63ff28f70"><td class="mdescLeft">&#160;</td><td class="mdescRight">Second stage of homing.  <a href="#a43e54631dc8de372854ebbb63ff28f70"></a><br/></td></tr>
<tr class="separator:a43e54631dc8de372854ebbb63ff28f70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc46bdddee59bd8c5ad662b3fd445e9f"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#acc46bdddee59bd8c5ad662b3fd445e9f">lspmac_getPosition</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp)</td></tr>
<tr class="memdesc:acc46bdddee59bd8c5ad662b3fd445e9f"><td class="mdescLeft">&#160;</td><td class="mdescRight">get the motor position (with locking)  <a href="#acc46bdddee59bd8c5ad662b3fd445e9f"></a><br/></td></tr>
<tr class="separator:acc46bdddee59bd8c5ad662b3fd445e9f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a637fc023d1255f3519b2eee01913d64d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a637fc023d1255f3519b2eee01913d64d">lspmac_pmacmotor_read</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp)</td></tr>
<tr class="memdesc:a637fc023d1255f3519b2eee01913d64d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read the position and status of a normal PMAC motor.  <a href="#a637fc023d1255f3519b2eee01913d64d"></a><br/></td></tr>
<tr class="separator:a637fc023d1255f3519b2eee01913d64d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af57fb3f335edcfd2adff8186e1efd458"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#af57fb3f335edcfd2adff8186e1efd458">lspmac_getBIPosition</a> (<a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *bip)</td></tr>
<tr class="memdesc:af57fb3f335edcfd2adff8186e1efd458"><td class="mdescLeft">&#160;</td><td class="mdescRight">get binary input value  <a href="#af57fb3f335edcfd2adff8186e1efd458"></a><br/></td></tr>
<tr class="separator:af57fb3f335edcfd2adff8186e1efd458"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f9772f2a907b40a464c02977c7a8c87"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a5f9772f2a907b40a464c02977c7a8c87">lspmac_get_status_cb</a> (<a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *cmd, int nreceived, char *buff)</td></tr>
<tr class="memdesc:a5f9772f2a907b40a464c02977c7a8c87"><td class="mdescLeft">&#160;</td><td class="mdescRight">Service routing for status upate This updates positions and status information.  <a href="#a5f9772f2a907b40a464c02977c7a8c87"></a><br/></td></tr>
<tr class="separator:a5f9772f2a907b40a464c02977c7a8c87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6dedca923b3a6904395ad02158e2e96f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a6dedca923b3a6904395ad02158e2e96f">lspmac_get_status</a> ()</td></tr>
<tr class="memdesc:a6dedca923b3a6904395ad02158e2e96f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Request a status update from the PMAC.  <a href="#a6dedca923b3a6904395ad02158e2e96f"></a><br/></td></tr>
<tr class="separator:a6dedca923b3a6904395ad02158e2e96f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a039af7c2d8d90cf24c2a8840f7402999"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a039af7c2d8d90cf24c2a8840f7402999">lspmac_more_ascii_cb</a> (<a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *cmd, int nreceived, char *buff)</td></tr>
<tr class="memdesc:a039af7c2d8d90cf24c2a8840f7402999"><td class="mdescLeft">&#160;</td><td class="mdescRight">we are expecting more characters from the DPRAM ASCII interface  <a href="#a039af7c2d8d90cf24c2a8840f7402999"></a><br/></td></tr>
<tr class="separator:a039af7c2d8d90cf24c2a8840f7402999"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd2f9e53bb838d0d9d898948877f1104"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#afd2f9e53bb838d0d9d898948877f1104">lspmac_get_ascii_cb</a> (<a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *cmd, int nreceived, char *buff)</td></tr>
<tr class="memdesc:afd2f9e53bb838d0d9d898948877f1104"><td class="mdescLeft">&#160;</td><td class="mdescRight">service the ascii buffer request response  <a href="#afd2f9e53bb838d0d9d898948877f1104"></a><br/></td></tr>
<tr class="separator:afd2f9e53bb838d0d9d898948877f1104"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2136d97501e077e3d4b23237e7fe374"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ae2136d97501e077e3d4b23237e7fe374">lspmac_asciicmdCB</a> (<a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *cmd, int nreceived, char *buf)</td></tr>
<tr class="memdesc:ae2136d97501e077e3d4b23237e7fe374"><td class="mdescLeft">&#160;</td><td class="mdescRight">PMAC has received our ascii command request Now see when it is ready for the next one.  <a href="#ae2136d97501e077e3d4b23237e7fe374"></a><br/></td></tr>
<tr class="separator:ae2136d97501e077e3d4b23237e7fe374"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afab9e8f0502a92ee5cf93209af710f81"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81">lspmac_SockSendDPline</a> (char *event, char *fmt,...)</td></tr>
<tr class="memdesc:afab9e8f0502a92ee5cf93209af710f81"><td class="mdescLeft">&#160;</td><td class="mdescRight">prepare (queue up) a line to send the dpram ascii command interface  <a href="#afab9e8f0502a92ee5cf93209af710f81"></a><br/></td></tr>
<tr class="separator:afab9e8f0502a92ee5cf93209af710f81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb3caf2837d7bcb702c26fc8f08259b3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#afb3caf2837d7bcb702c26fc8f08259b3">lspmac_SockSendDPControlCharCB</a> (<a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *cmd, int nreceived, char *buf)</td></tr>
<tr class="separator:afb3caf2837d7bcb702c26fc8f08259b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0575fc751cecf35ffe8b290ab483ac21"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a0575fc751cecf35ffe8b290ab483ac21">lspmac_SockSendDPControlChar</a> (char *event, char c)</td></tr>
<tr class="memdesc:a0575fc751cecf35ffe8b290ab483ac21"><td class="mdescLeft">&#160;</td><td class="mdescRight">use dpram ascii interface to send a control character  <a href="#a0575fc751cecf35ffe8b290ab483ac21"></a><br/></td></tr>
<tr class="separator:a0575fc751cecf35ffe8b290ab483ac21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad59af2883f1a6f2ee5daeebb7282f8a6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ad59af2883f1a6f2ee5daeebb7282f8a6">lspmac_SockSendDPqueue</a> ()</td></tr>
<tr class="separator:ad59af2883f1a6f2ee5daeebb7282f8a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85f7a5e4d853b7a86ddde1006dd4dc1f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a85f7a5e4d853b7a86ddde1006dd4dc1f">lspmac_abort</a> ()</td></tr>
<tr class="memdesc:a85f7a5e4d853b7a86ddde1006dd4dc1f"><td class="mdescLeft">&#160;</td><td class="mdescRight">abort motion and try to recover  <a href="#a85f7a5e4d853b7a86ddde1006dd4dc1f"></a><br/></td></tr>
<tr class="separator:a85f7a5e4d853b7a86ddde1006dd4dc1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a049ea733ada1148fda6fc84a3edfa69b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a049ea733ada1148fda6fc84a3edfa69b">lspmac_GetAllIVarsCB</a> (<a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *cmd, int nreceived, char *buff)</td></tr>
<tr class="memdesc:a049ea733ada1148fda6fc84a3edfa69b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receive the values of all the I variables Update our Postgresql database with the results.  <a href="#a049ea733ada1148fda6fc84a3edfa69b"></a><br/></td></tr>
<tr class="separator:a049ea733ada1148fda6fc84a3edfa69b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac24bdffa893a9bf7c9cb084fe1417f6f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ac24bdffa893a9bf7c9cb084fe1417f6f">lspmac_GetAllIVars</a> ()</td></tr>
<tr class="memdesc:ac24bdffa893a9bf7c9cb084fe1417f6f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Request the values of all the I variables.  <a href="#ac24bdffa893a9bf7c9cb084fe1417f6f"></a><br/></td></tr>
<tr class="separator:ac24bdffa893a9bf7c9cb084fe1417f6f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad59c1c0489d28fbc33c0afc5c6f3c99b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ad59c1c0489d28fbc33c0afc5c6f3c99b">lspmac_GetAllMVarsCB</a> (<a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *cmd, int nreceived, char *buff)</td></tr>
<tr class="memdesc:ad59c1c0489d28fbc33c0afc5c6f3c99b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receive the values of all the M variables Update our database with the results.  <a href="#ad59c1c0489d28fbc33c0afc5c6f3c99b"></a><br/></td></tr>
<tr class="separator:ad59c1c0489d28fbc33c0afc5c6f3c99b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a983d291506dc387ba5d71a97766e8a25"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a983d291506dc387ba5d71a97766e8a25">lspmac_GetAllMVars</a> ()</td></tr>
<tr class="memdesc:a983d291506dc387ba5d71a97766e8a25"><td class="mdescLeft">&#160;</td><td class="mdescRight">Request the values of all the M variables.  <a href="#a983d291506dc387ba5d71a97766e8a25"></a><br/></td></tr>
<tr class="separator:a983d291506dc387ba5d71a97766e8a25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9bbf5ae34ce793d3d72945c64c43948"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aa9bbf5ae34ce793d3d72945c64c43948">lspmac_sendcmd_nocb</a> (char *fmt,...)</td></tr>
<tr class="memdesc:aa9bbf5ae34ce793d3d72945c64c43948"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a command that does not need to deal with the reply.  <a href="#aa9bbf5ae34ce793d3d72945c64c43948"></a><br/></td></tr>
<tr class="separator:aa9bbf5ae34ce793d3d72945c64c43948"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3c6f12528ce940f73d44d8ddda245c6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ae3c6f12528ce940f73d44d8ddda245c6">lspmac_sendcmd</a> (char *event, void(*responseCB)(<a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *, int, char *), char *fmt,...)</td></tr>
<tr class="memdesc:ae3c6f12528ce940f73d44d8ddda245c6"><td class="mdescLeft">&#160;</td><td class="mdescRight">PMAC command with call back.  <a href="#ae3c6f12528ce940f73d44d8ddda245c6"></a><br/></td></tr>
<tr class="separator:ae3c6f12528ce940f73d44d8ddda245c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68886d1b658e7b1d996c07e9dbcd9c15"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a68886d1b658e7b1d996c07e9dbcd9c15">lspmac_next_state</a> ()</td></tr>
<tr class="memdesc:a68886d1b658e7b1d996c07e9dbcd9c15"><td class="mdescLeft">&#160;</td><td class="mdescRight">State machine logic.  <a href="#a68886d1b658e7b1d996c07e9dbcd9c15"></a><br/></td></tr>
<tr class="separator:a68886d1b658e7b1d996c07e9dbcd9c15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abdec5883055967b1eda043670870f55f"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#abdec5883055967b1eda043670870f55f">lspmac_worker</a> (void *dummy)</td></tr>
<tr class="memdesc:abdec5883055967b1eda043670870f55f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Our lspmac worker thread.  <a href="#abdec5883055967b1eda043670870f55f"></a><br/></td></tr>
<tr class="separator:abdec5883055967b1eda043670870f55f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98ad3d807b8826439b710e97bf53b478"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a98ad3d807b8826439b710e97bf53b478">lspmac_movedac_queue</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp, double requested_position)</td></tr>
<tr class="memdesc:a98ad3d807b8826439b710e97bf53b478"><td class="mdescLeft">&#160;</td><td class="mdescRight">Move method for dac motor objects (ie, lights)  <a href="#a98ad3d807b8826439b710e97bf53b478"></a><br/></td></tr>
<tr class="separator:a98ad3d807b8826439b710e97bf53b478"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82cf6576d41c31fce48a59db2d22188b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a82cf6576d41c31fce48a59db2d22188b">lspmac_movezoom_queue</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp, double requested_position)</td></tr>
<tr class="memdesc:a82cf6576d41c31fce48a59db2d22188b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Move method for the zoom motor.  <a href="#a82cf6576d41c31fce48a59db2d22188b"></a><br/></td></tr>
<tr class="separator:a82cf6576d41c31fce48a59db2d22188b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd26454acc150847b01717f60f956674"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#acd26454acc150847b01717f60f956674">lspmac_move_preset_queue</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp, char *preset_name)</td></tr>
<tr class="memdesc:acd26454acc150847b01717f60f956674"><td class="mdescLeft">&#160;</td><td class="mdescRight">Move a given motor to one of its preset positions.  <a href="#acd26454acc150847b01717f60f956674"></a><br/></td></tr>
<tr class="separator:acd26454acc150847b01717f60f956674"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37fc3302586bba36fa3b15c6f5e5b98a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a37fc3302586bba36fa3b15c6f5e5b98a">lspmac_test_preset</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp, char *preset_name, double tolerance)</td></tr>
<tr class="memdesc:a37fc3302586bba36fa3b15c6f5e5b98a"><td class="mdescLeft">&#160;</td><td class="mdescRight">see if the motor is within tolerance of the preset 1 means yes, it is 0 mean no it isn't or that the preset was not found  <a href="#a37fc3302586bba36fa3b15c6f5e5b98a"></a><br/></td></tr>
<tr class="separator:a37fc3302586bba36fa3b15c6f5e5b98a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adafed595ff5fcd7667175a9e730dbb8d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#adafed595ff5fcd7667175a9e730dbb8d">lspmac_moveabs_fshut_queue</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp, double requested_position)</td></tr>
<tr class="memdesc:adafed595ff5fcd7667175a9e730dbb8d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Move method for the fast shutter.  <a href="#adafed595ff5fcd7667175a9e730dbb8d"></a><br/></td></tr>
<tr class="separator:adafed595ff5fcd7667175a9e730dbb8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa94d5a726be9f97dee7a1889a759e0a7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aa94d5a726be9f97dee7a1889a759e0a7">lspmac_moveabs_bo_queue</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp, double requested_position)</td></tr>
<tr class="memdesc:aa94d5a726be9f97dee7a1889a759e0a7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Move method for binary i/o motor objects.  <a href="#aa94d5a726be9f97dee7a1889a759e0a7"></a><br/></td></tr>
<tr class="separator:aa94d5a726be9f97dee7a1889a759e0a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a443655e2971b0484a78e99c4c18c1a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a9a443655e2971b0484a78e99c4c18c1a">lspmac_moveabs_timed_queue</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp, double start, double delta, double time)</td></tr>
<tr class="memdesc:a9a443655e2971b0484a78e99c4c18c1a"><td class="mdescLeft">&#160;</td><td class="mdescRight">timed motor move  <a href="#a9a443655e2971b0484a78e99c4c18c1a"></a><br/></td></tr>
<tr class="separator:a9a443655e2971b0484a78e99c4c18c1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3c75b8bbde4b8b8ff2b416eabe45552"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aa3c75b8bbde4b8b8ff2b416eabe45552">lspmac_moveabs_frontlight_oo_queue</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp, double pos)</td></tr>
<tr class="memdesc:aa3c75b8bbde4b8b8ff2b416eabe45552"><td class="mdescLeft">&#160;</td><td class="mdescRight">"move" frontlight on/off  <a href="#aa3c75b8bbde4b8b8ff2b416eabe45552"></a><br/></td></tr>
<tr class="separator:aa3c75b8bbde4b8b8ff2b416eabe45552"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acbe3a8e54208048506e77b365b4c0f58"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#acbe3a8e54208048506e77b365b4c0f58">lspmac_moveabs_flight_factor_queue</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp, double pos)</td></tr>
<tr class="separator:acbe3a8e54208048506e77b365b4c0f58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c4e5e996755d21603e0afdd41ab9cd4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a4c4e5e996755d21603e0afdd41ab9cd4">lspmac_moveabs_blight_factor_queue</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp, double pos)</td></tr>
<tr class="separator:a4c4e5e996755d21603e0afdd41ab9cd4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8bf745a9ec388783009e2275a8b56f8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aa8bf745a9ec388783009e2275a8b56f8">lspmac_video_rotate</a> (double secs)</td></tr>
<tr class="memdesc:aa8bf745a9ec388783009e2275a8b56f8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Special motion program to collect centering video.  <a href="#aa8bf745a9ec388783009e2275a8b56f8"></a><br/></td></tr>
<tr class="separator:aa8bf745a9ec388783009e2275a8b56f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ab30559739e0232331f53d16c0cb5ac"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a2ab30559739e0232331f53d16c0cb5ac">lspmac_move_or_jog_abs_queue</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp, double requested_position, int use_jog)</td></tr>
<tr class="memdesc:a2ab30559739e0232331f53d16c0cb5ac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Move method for normal stepper and servo motor objects Returns non-zero on abort, zero if OK.  <a href="#a2ab30559739e0232331f53d16c0cb5ac"></a><br/></td></tr>
<tr class="separator:a2ab30559739e0232331f53d16c0cb5ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4451ae36e7b01c349d510249f52611da"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a4451ae36e7b01c349d510249f52611da">lspmac_move_or_jog_preset_queue</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp, char *preset, int use_jog)</td></tr>
<tr class="memdesc:a4451ae36e7b01c349d510249f52611da"><td class="mdescLeft">&#160;</td><td class="mdescRight">move using a preset value returns 0 on success, non-zero on error  <a href="#a4451ae36e7b01c349d510249f52611da"></a><br/></td></tr>
<tr class="separator:a4451ae36e7b01c349d510249f52611da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ef1fd07d6dfe8071eb0f696945bcab5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5">lspmac_moveabs_queue</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp, double requested_position)</td></tr>
<tr class="memdesc:a1ef1fd07d6dfe8071eb0f696945bcab5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Use coordinate system motion program, if available, to move motor to requested position.  <a href="#a1ef1fd07d6dfe8071eb0f696945bcab5"></a><br/></td></tr>
<tr class="separator:a1ef1fd07d6dfe8071eb0f696945bcab5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51216d824b3693de350f3be1ab30a7e0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a51216d824b3693de350f3be1ab30a7e0">lspmac_jogabs_queue</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp, double requested_position)</td></tr>
<tr class="memdesc:a51216d824b3693de350f3be1ab30a7e0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Use jog to move motor to requested position.  <a href="#a51216d824b3693de350f3be1ab30a7e0"></a><br/></td></tr>
<tr class="separator:a51216d824b3693de350f3be1ab30a7e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55ffe2b135854f75079ecd39d507d3b4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a55ffe2b135854f75079ecd39d507d3b4">lspmac_moveabs_wait</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp, double timeout_secs)</td></tr>
<tr class="memdesc:a55ffe2b135854f75079ecd39d507d3b4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for motor to finish moving.  <a href="#a55ffe2b135854f75079ecd39d507d3b4"></a><br/></td></tr>
<tr class="separator:a55ffe2b135854f75079ecd39d507d3b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd005045e9cc3f4bb93d424fe50eb733"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#afd005045e9cc3f4bb93d424fe50eb733">_lspmac_motor_init</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *d, char *name)</td></tr>
<tr class="memdesc:afd005045e9cc3f4bb93d424fe50eb733"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper funciton for the init calls.  <a href="#afd005045e9cc3f4bb93d424fe50eb733"></a><br/></td></tr>
<tr class="separator:afd005045e9cc3f4bb93d424fe50eb733"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a939e8aae7c78a7d9f93f0ad198cc4463"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a939e8aae7c78a7d9f93f0ad198cc4463">lspmac_motor_init</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *d, int wy, int wx, int *posp, int *stat1p, int *stat2p, char *wtitle, char *name, int(*moveAbs)(<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *, double))</td></tr>
<tr class="memdesc:a939e8aae7c78a7d9f93f0ad198cc4463"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize a pmac stepper or servo motor.  <a href="#a939e8aae7c78a7d9f93f0ad198cc4463"></a><br/></td></tr>
<tr class="separator:a939e8aae7c78a7d9f93f0ad198cc4463"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40aa4aeb5c799a6a3a089137da4fd6a8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a40aa4aeb5c799a6a3a089137da4fd6a8">lspmac_fshut_init</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *d)</td></tr>
<tr class="memdesc:a40aa4aeb5c799a6a3a089137da4fd6a8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initalize the fast shutter motor.  <a href="#a40aa4aeb5c799a6a3a089137da4fd6a8"></a><br/></td></tr>
<tr class="separator:a40aa4aeb5c799a6a3a089137da4fd6a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeaa263af25d139f249d8b825a058d0ce"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aeaa263af25d139f249d8b825a058d0ce">lspmac_bo_init</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *d, char *name, char *write_fmt, int *read_ptr, int read_mask)</td></tr>
<tr class="memdesc:aeaa263af25d139f249d8b825a058d0ce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize binary i/o motor.  <a href="#aeaa263af25d139f249d8b825a058d0ce"></a><br/></td></tr>
<tr class="separator:aeaa263af25d139f249d8b825a058d0ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acea9dfc6367bbcf16f49e664e0fc3774"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#acea9dfc6367bbcf16f49e664e0fc3774">lspmac_dac_init</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *d, int *posp, char *mvar, char *name, int(*moveAbs)(<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *, double))</td></tr>
<tr class="memdesc:acea9dfc6367bbcf16f49e664e0fc3774"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize DAC motor Note that some motors require further initialization from a database query.  <a href="#acea9dfc6367bbcf16f49e664e0fc3774"></a><br/></td></tr>
<tr class="separator:acea9dfc6367bbcf16f49e664e0fc3774"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4504b147f551d86865a7e7ca1e795990"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a4504b147f551d86865a7e7ca1e795990">lspmac_soft_motor_read</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *p)</td></tr>
<tr class="memdesc:a4504b147f551d86865a7e7ca1e795990"><td class="mdescLeft">&#160;</td><td class="mdescRight">Dummy routine to read a soft motor.  <a href="#a4504b147f551d86865a7e7ca1e795990"></a><br/></td></tr>
<tr class="separator:a4504b147f551d86865a7e7ca1e795990"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a698719a7ce58e2052fa70ab87b1fb293"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a698719a7ce58e2052fa70ab87b1fb293">lspmac_soft_motor_init</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *d, char *name, int(*moveAbs)(<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *, double))</td></tr>
<tr class="separator:a698719a7ce58e2052fa70ab87b1fb293"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac27a61fa5aca398b0db588674e7f6dc7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ac27a61fa5aca398b0db588674e7f6dc7">lspmac_bi_init</a> (<a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *d, int *ptr, int mask, char *onEvent, char *offEvent)</td></tr>
<tr class="memdesc:ac27a61fa5aca398b0db588674e7f6dc7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize binary input.  <a href="#ac27a61fa5aca398b0db588674e7f6dc7"></a><br/></td></tr>
<tr class="separator:ac27a61fa5aca398b0db588674e7f6dc7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a236945579e57dbb30c0b64f5b9184e9d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a236945579e57dbb30c0b64f5b9184e9d">lspmac_init</a> (int ivarsflag, int mvarsflag)</td></tr>
<tr class="memdesc:a236945579e57dbb30c0b64f5b9184e9d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize this module.  <a href="#a236945579e57dbb30c0b64f5b9184e9d"></a><br/></td></tr>
<tr class="separator:a236945579e57dbb30c0b64f5b9184e9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc00ddac633f8c8a3a699e3d22de2770"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#afc00ddac633f8c8a3a699e3d22de2770">lspmac_cryoSwitchChanged_cb</a> (char *event)</td></tr>
<tr class="separator:afc00ddac633f8c8a3a699e3d22de2770"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8707350625ca81a089a90f8b64ce6d28"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a8707350625ca81a089a90f8b64ce6d28">lspmac_scint_inPosition_cb</a> (char *event)</td></tr>
<tr class="memdesc:a8707350625ca81a089a90f8b64ce6d28"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maybe start drying off the scintilator.  <a href="#a8707350625ca81a089a90f8b64ce6d28"></a><br/></td></tr>
<tr class="separator:a8707350625ca81a089a90f8b64ce6d28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a094f66824c57b27c9dad2ca36bd75e44"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a094f66824c57b27c9dad2ca36bd75e44">lspmac_backLight_up_cb</a> (char *event)</td></tr>
<tr class="memdesc:a094f66824c57b27c9dad2ca36bd75e44"><td class="mdescLeft">&#160;</td><td class="mdescRight">Turn on the backlight whenever it goes up.  <a href="#a094f66824c57b27c9dad2ca36bd75e44"></a><br/></td></tr>
<tr class="separator:a094f66824c57b27c9dad2ca36bd75e44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a571cf14b82b5aae163af5aec3201cd3e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a571cf14b82b5aae163af5aec3201cd3e">lspmac_backLight_down_cb</a> (char *event)</td></tr>
<tr class="memdesc:a571cf14b82b5aae163af5aec3201cd3e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Turn off the backlight whenever it goes down.  <a href="#a571cf14b82b5aae163af5aec3201cd3e"></a><br/></td></tr>
<tr class="separator:a571cf14b82b5aae163af5aec3201cd3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55791bd8a07e5ca1dd2aeedf3c23942c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a55791bd8a07e5ca1dd2aeedf3c23942c">lspmac_light_zoom_cb</a> (char *event)</td></tr>
<tr class="memdesc:a55791bd8a07e5ca1dd2aeedf3c23942c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the backlight intensity whenever the zoom is changed (and the backlight is up)  <a href="#a55791bd8a07e5ca1dd2aeedf3c23942c"></a><br/></td></tr>
<tr class="separator:a55791bd8a07e5ca1dd2aeedf3c23942c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a585676eb411025c7b44da958d4e98eb2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a585676eb411025c7b44da958d4e98eb2">lspmac_scint_dried_cb</a> (char *event)</td></tr>
<tr class="memdesc:a585676eb411025c7b44da958d4e98eb2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Turn off the dryer.  <a href="#a585676eb411025c7b44da958d4e98eb2"></a><br/></td></tr>
<tr class="separator:a585676eb411025c7b44da958d4e98eb2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3816a9a1a3bb5bb89fcec8a30d863970"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a3816a9a1a3bb5bb89fcec8a30d863970">lspmac_zoom_lut_setup</a> ()</td></tr>
<tr class="memdesc:a3816a9a1a3bb5bb89fcec8a30d863970"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set up lookup table for zoom.  <a href="#a3816a9a1a3bb5bb89fcec8a30d863970"></a><br/></td></tr>
<tr class="separator:a3816a9a1a3bb5bb89fcec8a30d863970"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad52a5dbc2f06247eca7619195936b85f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ad52a5dbc2f06247eca7619195936b85f">lspmac_flight_lut_setup</a> ()</td></tr>
<tr class="memdesc:ad52a5dbc2f06247eca7619195936b85f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set up lookup table for flight.  <a href="#ad52a5dbc2f06247eca7619195936b85f"></a><br/></td></tr>
<tr class="separator:ad52a5dbc2f06247eca7619195936b85f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4aa8c178a56276eb64138d52fe65dc8c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a4aa8c178a56276eb64138d52fe65dc8c">lspmac_blight_lut_setup</a> ()</td></tr>
<tr class="memdesc:a4aa8c178a56276eb64138d52fe65dc8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set up lookup table for blight.  <a href="#a4aa8c178a56276eb64138d52fe65dc8c"></a><br/></td></tr>
<tr class="separator:a4aa8c178a56276eb64138d52fe65dc8c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54ceac41b127ad8bbad07bd90c6729dc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a54ceac41b127ad8bbad07bd90c6729dc">lspmac_fscint_lut_setup</a> ()</td></tr>
<tr class="memdesc:a54ceac41b127ad8bbad07bd90c6729dc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set up lookup table for fscint.  <a href="#a54ceac41b127ad8bbad07bd90c6729dc"></a><br/></td></tr>
<tr class="separator:a54ceac41b127ad8bbad07bd90c6729dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a611168a1076b2de45c596ed95c68445a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a611168a1076b2de45c596ed95c68445a">lspmac_command_done_cb</a> (char *event)</td></tr>
<tr class="separator:a611168a1076b2de45c596ed95c68445a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a7fb93fb3fb9c4454613f30bfb0b1ee"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a3a7fb93fb3fb9c4454613f30bfb0b1ee">lspmac_run</a> ()</td></tr>
<tr class="memdesc:a3a7fb93fb3fb9c4454613f30bfb0b1ee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start up the lspmac thread.  <a href="#a3a7fb93fb3fb9c4454613f30bfb0b1ee"></a><br/></td></tr>
<tr class="separator:a3a7fb93fb3fb9c4454613f30bfb0b1ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a6d9261680ee01b1e106d1ea1d7ffa390"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390">ls_pmac_state</a> = <a class="el" href="lspmac_8c.html#a7eb86ecf0789ab9555de1e03a4c73567">LS_PMAC_STATE_DETACHED</a></td></tr>
<tr class="memdesc:a6d9261680ee01b1e106d1ea1d7ffa390"><td class="mdescLeft">&#160;</td><td class="mdescRight">Current state of the PMAC communications state machine.  <a href="#a6d9261680ee01b1e106d1ea1d7ffa390"></a><br/></td></tr>
<tr class="separator:a6d9261680ee01b1e106d1ea1d7ffa390"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a112158e0cd50449a440ac55c7af7bea2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a112158e0cd50449a440ac55c7af7bea2">lspmac_shutter_state</a></td></tr>
<tr class="memdesc:a112158e0cd50449a440ac55c7af7bea2"><td class="mdescLeft">&#160;</td><td class="mdescRight">State of the shutter, used to detect changes.  <a href="#a112158e0cd50449a440ac55c7af7bea2"></a><br/></td></tr>
<tr class="separator:a112158e0cd50449a440ac55c7af7bea2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a396fbf06208de3ecbe1b0df549f1cd46"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a396fbf06208de3ecbe1b0df549f1cd46">lspmac_shutter_has_opened</a></td></tr>
<tr class="memdesc:a396fbf06208de3ecbe1b0df549f1cd46"><td class="mdescLeft">&#160;</td><td class="mdescRight">Indicates that the shutter had opened, perhaps briefly even if the state did not change.  <a href="#a396fbf06208de3ecbe1b0df549f1cd46"></a><br/></td></tr>
<tr class="separator:a396fbf06208de3ecbe1b0df549f1cd46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b78a13c654409333569815e1c109d38"><td class="memItemLeft" align="right" valign="top">pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a1b78a13c654409333569815e1c109d38">lspmac_shutter_mutex</a></td></tr>
<tr class="memdesc:a1b78a13c654409333569815e1c109d38"><td class="mdescLeft">&#160;</td><td class="mdescRight">Coordinates threads reading shutter status.  <a href="#a1b78a13c654409333569815e1c109d38"></a><br/></td></tr>
<tr class="separator:a1b78a13c654409333569815e1c109d38"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afbd51c2cefcee87afe994c9e9f372241"><td class="memItemLeft" align="right" valign="top">pthread_cond_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#afbd51c2cefcee87afe994c9e9f372241">lspmac_shutter_cond</a></td></tr>
<tr class="memdesc:afbd51c2cefcee87afe994c9e9f372241"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allows waiting for the shutter status to change.  <a href="#afbd51c2cefcee87afe994c9e9f372241"></a><br/></td></tr>
<tr class="separator:afbd51c2cefcee87afe994c9e9f372241"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85679cac947e199c88794f8e5a12bf5f"><td class="memItemLeft" align="right" valign="top">pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f">lspmac_moving_mutex</a></td></tr>
<tr class="memdesc:a85679cac947e199c88794f8e5a12bf5f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Coordinate moving motors between threads.  <a href="#a85679cac947e199c88794f8e5a12bf5f"></a><br/></td></tr>
<tr class="separator:a85679cac947e199c88794f8e5a12bf5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57547d211906c981ef20257eba99f8df"><td class="memItemLeft" align="right" valign="top">pthread_cond_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a57547d211906c981ef20257eba99f8df">lspmac_moving_cond</a></td></tr>
<tr class="memdesc:a57547d211906c981ef20257eba99f8df"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for motor(s) to finish moving condition.  <a href="#a57547d211906c981ef20257eba99f8df"></a><br/></td></tr>
<tr class="separator:a57547d211906c981ef20257eba99f8df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a32c617c183166308241e270959df56"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a7a32c617c183166308241e270959df56">lspmac_moving_flags</a></td></tr>
<tr class="memdesc:a7a32c617c183166308241e270959df56"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flag used to implement motor moving condition.  <a href="#a7a32c617c183166308241e270959df56"></a><br/></td></tr>
<tr class="separator:a7a32c617c183166308241e270959df56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ff142105e17d933871d09759e7082f8"><td class="memItemLeft" align="right" valign="top">static pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a2ff142105e17d933871d09759e7082f8">lspmac_ascii_mutex</a></td></tr>
<tr class="memdesc:a2ff142105e17d933871d09759e7082f8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Keep too many processes from sending commands at once.  <a href="#a2ff142105e17d933871d09759e7082f8"></a><br/></td></tr>
<tr class="separator:a2ff142105e17d933871d09759e7082f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb9e57459496c33e0da5cdb773113a61"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#afb9e57459496c33e0da5cdb773113a61">lspmac_ascii_busy</a> = 0</td></tr>
<tr class="memdesc:afb9e57459496c33e0da5cdb773113a61"><td class="mdescLeft">&#160;</td><td class="mdescRight">flag for condition to wait for  <a href="#afb9e57459496c33e0da5cdb773113a61"></a><br/></td></tr>
<tr class="separator:afb9e57459496c33e0da5cdb773113a61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae06d2291c1996ffb7dcf7d132e25b038"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ae06d2291c1996ffb7dcf7d132e25b038">omega_zero_search</a> = 0</td></tr>
<tr class="memdesc:ae06d2291c1996ffb7dcf7d132e25b038"><td class="mdescLeft">&#160;</td><td class="mdescRight">Indicate we'd really like to know when omega crosses zero.  <a href="#ae06d2291c1996ffb7dcf7d132e25b038"></a><br/></td></tr>
<tr class="separator:ae06d2291c1996ffb7dcf7d132e25b038"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea11895d2ec4a3324f4baa9d24cd192d"><td class="memItemLeft" align="right" valign="top">static double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aea11895d2ec4a3324f4baa9d24cd192d">omega_zero_velocity</a> = 0</td></tr>
<tr class="memdesc:aea11895d2ec4a3324f4baa9d24cd192d"><td class="mdescLeft">&#160;</td><td class="mdescRight">rate (cnts/sec) that omega was traveling when it crossed zero  <a href="#aea11895d2ec4a3324f4baa9d24cd192d"></a><br/></td></tr>
<tr class="separator:aea11895d2ec4a3324f4baa9d24cd192d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6631a094accc469661805bdf80fc6d8"><td class="memItemLeft" align="right" valign="top">struct timespec&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ae6631a094accc469661805bdf80fc6d8">omega_zero_time</a></td></tr>
<tr class="memdesc:ae6631a094accc469661805bdf80fc6d8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Time we believe that omega crossed zero.  <a href="#ae6631a094accc469661805bdf80fc6d8"></a><br/></td></tr>
<tr class="separator:ae6631a094accc469661805bdf80fc6d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3bf4c21e9e375862e5a955b539fb073"><td class="memItemLeft" align="right" valign="top">static struct timespec&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ae3bf4c21e9e375862e5a955b539fb073">lspmac_status_time</a></td></tr>
<tr class="memdesc:ae3bf4c21e9e375862e5a955b539fb073"><td class="mdescLeft">&#160;</td><td class="mdescRight">Time the status was read.  <a href="#ae3bf4c21e9e375862e5a955b539fb073"></a><br/></td></tr>
<tr class="separator:ae3bf4c21e9e375862e5a955b539fb073"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c950ade1e11ec8d4c859d7f1bf94864"><td class="memItemLeft" align="right" valign="top">static struct timespec&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a9c950ade1e11ec8d4c859d7f1bf94864">lspmac_status_last_time</a></td></tr>
<tr class="memdesc:a9c950ade1e11ec8d4c859d7f1bf94864"><td class="mdescLeft">&#160;</td><td class="mdescRight">Time the status was read.  <a href="#a9c950ade1e11ec8d4c859d7f1bf94864"></a><br/></td></tr>
<tr class="separator:a9c950ade1e11ec8d4c859d7f1bf94864"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b7011dd7d2c2d3afadff8d3e50e7677"><td class="memItemLeft" align="right" valign="top">static pthread_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a6b7011dd7d2c2d3afadff8d3e50e7677">pmac_thread</a></td></tr>
<tr class="memdesc:a6b7011dd7d2c2d3afadff8d3e50e7677"><td class="mdescLeft">&#160;</td><td class="mdescRight">our thread to manage access and communication to the pmac  <a href="#a6b7011dd7d2c2d3afadff8d3e50e7677"></a><br/></td></tr>
<tr class="separator:a6b7011dd7d2c2d3afadff8d3e50e7677"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc1bb77b9bcbc4d970f841a41fd274b3"><td class="memItemLeft" align="right" valign="top">pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#acc1bb77b9bcbc4d970f841a41fd274b3">pmac_queue_mutex</a></td></tr>
<tr class="memdesc:acc1bb77b9bcbc4d970f841a41fd274b3"><td class="mdescLeft">&#160;</td><td class="mdescRight">manage access to the pmac command queue  <a href="#acc1bb77b9bcbc4d970f841a41fd274b3"></a><br/></td></tr>
<tr class="separator:acc1bb77b9bcbc4d970f841a41fd274b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a25bd9c593c6985107f90f999ce0b08"><td class="memItemLeft" align="right" valign="top">pthread_cond_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a8a25bd9c593c6985107f90f999ce0b08">pmac_queue_cond</a></td></tr>
<tr class="memdesc:a8a25bd9c593c6985107f90f999ce0b08"><td class="mdescLeft">&#160;</td><td class="mdescRight">wait for a command to be sent to PMAC before continuing  <a href="#a8a25bd9c593c6985107f90f999ce0b08"></a><br/></td></tr>
<tr class="separator:a8a25bd9c593c6985107f90f999ce0b08"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adba7f5f4bbeabc4dac859221d4c684ba"><td class="memItemLeft" align="right" valign="top">static struct pollfd&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba">pmacfd</a></td></tr>
<tr class="memdesc:adba7f5f4bbeabc4dac859221d4c684ba"><td class="mdescLeft">&#160;</td><td class="mdescRight">our poll structure  <a href="#adba7f5f4bbeabc4dac859221d4c684ba"></a><br/></td></tr>
<tr class="separator:adba7f5f4bbeabc4dac859221d4c684ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a07b7b8254772075e6a4ced500b589c36"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a07b7b8254772075e6a4ced500b589c36">getivars</a> = 0</td></tr>
<tr class="memdesc:a07b7b8254772075e6a4ced500b589c36"><td class="mdescLeft">&#160;</td><td class="mdescRight">flag set at initialization to send i vars to db  <a href="#a07b7b8254772075e6a4ced500b589c36"></a><br/></td></tr>
<tr class="separator:a07b7b8254772075e6a4ced500b589c36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50e9c0a06654fd81b3446a6e54ff12c3"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a50e9c0a06654fd81b3446a6e54ff12c3">getmvars</a> = 0</td></tr>
<tr class="memdesc:a50e9c0a06654fd81b3446a6e54ff12c3"><td class="mdescLeft">&#160;</td><td class="mdescRight">flag set at initialization to send m vars to db  <a href="#a50e9c0a06654fd81b3446a6e54ff12c3"></a><br/></td></tr>
<tr class="separator:a50e9c0a06654fd81b3446a6e54ff12c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37c46609cb32aea5178c4d59d7892d13"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13">lspmac_bis</a> [32]</td></tr>
<tr class="memdesc:a37c46609cb32aea5178c4d59d7892d13"><td class="mdescLeft">&#160;</td><td class="mdescRight">array of binary inputs  <a href="#a37c46609cb32aea5178c4d59d7892d13"></a><br/></td></tr>
<tr class="separator:a37c46609cb32aea5178c4d59d7892d13"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a33c5ed169a5437cb59ab904ffa3e3ffe"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a33c5ed169a5437cb59ab904ffa3e3ffe">lspmac_nbis</a> = 0</td></tr>
<tr class="memdesc:a33c5ed169a5437cb59ab904ffa3e3ffe"><td class="mdescLeft">&#160;</td><td class="mdescRight">number of active binary inputs  <a href="#a33c5ed169a5437cb59ab904ffa3e3ffe"></a><br/></td></tr>
<tr class="separator:a33c5ed169a5437cb59ab904ffa3e3ffe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a894c709ddd0652583d6db22e86282503"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503">lspmac_motors</a> [48]</td></tr>
<tr class="memdesc:a894c709ddd0652583d6db22e86282503"><td class="mdescLeft">&#160;</td><td class="mdescRight">All our motors.  <a href="#a894c709ddd0652583d6db22e86282503"></a><br/></td></tr>
<tr class="separator:a894c709ddd0652583d6db22e86282503"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a56260f012c50a591ee7f97e500f16994"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a56260f012c50a591ee7f97e500f16994">lspmac_nmotors</a> = 0</td></tr>
<tr class="memdesc:a56260f012c50a591ee7f97e500f16994"><td class="mdescLeft">&#160;</td><td class="mdescRight">The number of motors we manage.  <a href="#a56260f012c50a591ee7f97e500f16994"></a><br/></td></tr>
<tr class="separator:a56260f012c50a591ee7f97e500f16994"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8237e646ce032a840637a4ef7bff49b9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a8237e646ce032a840637a4ef7bff49b9">omega</a></td></tr>
<tr class="memdesc:a8237e646ce032a840637a4ef7bff49b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">MD2 omega axis (the air bearing)  <a href="#a8237e646ce032a840637a4ef7bff49b9"></a><br/></td></tr>
<tr class="separator:a8237e646ce032a840637a4ef7bff49b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6cb218bdccfe5a93471c161f15a15cab"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a6cb218bdccfe5a93471c161f15a15cab">alignx</a></td></tr>
<tr class="memdesc:a6cb218bdccfe5a93471c161f15a15cab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Alignment stage X.  <a href="#a6cb218bdccfe5a93471c161f15a15cab"></a><br/></td></tr>
<tr class="separator:a6cb218bdccfe5a93471c161f15a15cab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a737c246c3948e644a18d191a931e1acd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a737c246c3948e644a18d191a931e1acd">aligny</a></td></tr>
<tr class="memdesc:a737c246c3948e644a18d191a931e1acd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Alignment stage Y.  <a href="#a737c246c3948e644a18d191a931e1acd"></a><br/></td></tr>
<tr class="separator:a737c246c3948e644a18d191a931e1acd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7642b1da0f7c7f8448104c691d40a12"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ae7642b1da0f7c7f8448104c691d40a12">alignz</a></td></tr>
<tr class="memdesc:ae7642b1da0f7c7f8448104c691d40a12"><td class="mdescLeft">&#160;</td><td class="mdescRight">Alignment stage X.  <a href="#ae7642b1da0f7c7f8448104c691d40a12"></a><br/></td></tr>
<tr class="separator:ae7642b1da0f7c7f8448104c691d40a12"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa90d2363b744acbd4d45133b7a716d8f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aa90d2363b744acbd4d45133b7a716d8f">anal</a></td></tr>
<tr class="memdesc:aa90d2363b744acbd4d45133b7a716d8f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Polaroid analyzer motor.  <a href="#aa90d2363b744acbd4d45133b7a716d8f"></a><br/></td></tr>
<tr class="separator:aa90d2363b744acbd4d45133b7a716d8f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad53a42cfaa04eff0336a44c8c9986333"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ad53a42cfaa04eff0336a44c8c9986333">zoom</a></td></tr>
<tr class="memdesc:ad53a42cfaa04eff0336a44c8c9986333"><td class="mdescLeft">&#160;</td><td class="mdescRight">Optical zoom.  <a href="#ad53a42cfaa04eff0336a44c8c9986333"></a><br/></td></tr>
<tr class="separator:ad53a42cfaa04eff0336a44c8c9986333"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a139200ddaa9856a7ffcec0e6cbaa8f1b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a139200ddaa9856a7ffcec0e6cbaa8f1b">apery</a></td></tr>
<tr class="memdesc:a139200ddaa9856a7ffcec0e6cbaa8f1b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Aperture Y.  <a href="#a139200ddaa9856a7ffcec0e6cbaa8f1b"></a><br/></td></tr>
<tr class="separator:a139200ddaa9856a7ffcec0e6cbaa8f1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab93bd6ee850b285ca3a95e64d15e9477"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ab93bd6ee850b285ca3a95e64d15e9477">aperz</a></td></tr>
<tr class="memdesc:ab93bd6ee850b285ca3a95e64d15e9477"><td class="mdescLeft">&#160;</td><td class="mdescRight">Aperture Z.  <a href="#ab93bd6ee850b285ca3a95e64d15e9477"></a><br/></td></tr>
<tr class="separator:ab93bd6ee850b285ca3a95e64d15e9477"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51358daaea8b5236f08414877d8af6c2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a51358daaea8b5236f08414877d8af6c2">capy</a></td></tr>
<tr class="memdesc:a51358daaea8b5236f08414877d8af6c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Capillary Y.  <a href="#a51358daaea8b5236f08414877d8af6c2"></a><br/></td></tr>
<tr class="separator:a51358daaea8b5236f08414877d8af6c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa45f268d0af9f3d465acfab128919718"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aa45f268d0af9f3d465acfab128919718">capz</a></td></tr>
<tr class="memdesc:aa45f268d0af9f3d465acfab128919718"><td class="mdescLeft">&#160;</td><td class="mdescRight">Capillary Z.  <a href="#aa45f268d0af9f3d465acfab128919718"></a><br/></td></tr>
<tr class="separator:aa45f268d0af9f3d465acfab128919718"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a589431b3a79c21c251fcb97cc9126991"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a589431b3a79c21c251fcb97cc9126991">scint</a></td></tr>
<tr class="memdesc:a589431b3a79c21c251fcb97cc9126991"><td class="mdescLeft">&#160;</td><td class="mdescRight">Scintillator Z.  <a href="#a589431b3a79c21c251fcb97cc9126991"></a><br/></td></tr>
<tr class="separator:a589431b3a79c21c251fcb97cc9126991"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac940d950d9efeaf3f0ae67e9bf331188"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ac940d950d9efeaf3f0ae67e9bf331188">cenx</a></td></tr>
<tr class="memdesc:ac940d950d9efeaf3f0ae67e9bf331188"><td class="mdescLeft">&#160;</td><td class="mdescRight">Centering Table X.  <a href="#ac940d950d9efeaf3f0ae67e9bf331188"></a><br/></td></tr>
<tr class="separator:ac940d950d9efeaf3f0ae67e9bf331188"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaed18e738ba7bfb6c771a44f5d7ea827"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aaed18e738ba7bfb6c771a44f5d7ea827">ceny</a></td></tr>
<tr class="memdesc:aaed18e738ba7bfb6c771a44f5d7ea827"><td class="mdescLeft">&#160;</td><td class="mdescRight">Centering Table Y.  <a href="#aaed18e738ba7bfb6c771a44f5d7ea827"></a><br/></td></tr>
<tr class="separator:aaed18e738ba7bfb6c771a44f5d7ea827"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0be79ccb7ebf3a665248fd856112b9fd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a0be79ccb7ebf3a665248fd856112b9fd">kappa</a></td></tr>
<tr class="memdesc:a0be79ccb7ebf3a665248fd856112b9fd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Kappa.  <a href="#a0be79ccb7ebf3a665248fd856112b9fd"></a><br/></td></tr>
<tr class="separator:a0be79ccb7ebf3a665248fd856112b9fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8070dc568ad974a3db42b51eca828cc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ac8070dc568ad974a3db42b51eca828cc">phi</a></td></tr>
<tr class="memdesc:ac8070dc568ad974a3db42b51eca828cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Phi (not data collection axis)  <a href="#ac8070dc568ad974a3db42b51eca828cc"></a><br/></td></tr>
<tr class="separator:ac8070dc568ad974a3db42b51eca828cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26dec4623af9beed912b8e7e6f99822c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a26dec4623af9beed912b8e7e6f99822c">fshut</a></td></tr>
<tr class="memdesc:a26dec4623af9beed912b8e7e6f99822c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fast shutter.  <a href="#a26dec4623af9beed912b8e7e6f99822c"></a><br/></td></tr>
<tr class="separator:a26dec4623af9beed912b8e7e6f99822c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb09895663eff333b7a75acb319a9fc1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1">flight</a></td></tr>
<tr class="memdesc:aeb09895663eff333b7a75acb319a9fc1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Front Light DAC.  <a href="#aeb09895663eff333b7a75acb319a9fc1"></a><br/></td></tr>
<tr class="separator:aeb09895663eff333b7a75acb319a9fc1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85d6eaa4b4a82bb3112574f458d1dc50"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50">blight</a></td></tr>
<tr class="memdesc:a85d6eaa4b4a82bb3112574f458d1dc50"><td class="mdescLeft">&#160;</td><td class="mdescRight">Back Light DAC.  <a href="#a85d6eaa4b4a82bb3112574f458d1dc50"></a><br/></td></tr>
<tr class="separator:a85d6eaa4b4a82bb3112574f458d1dc50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a3ca6fcf5e24dcc26170736843e53b2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a8a3ca6fcf5e24dcc26170736843e53b2">fscint</a></td></tr>
<tr class="memdesc:a8a3ca6fcf5e24dcc26170736843e53b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Scintillator Piezo DAC.  <a href="#a8a3ca6fcf5e24dcc26170736843e53b2"></a><br/></td></tr>
<tr class="separator:a8a3ca6fcf5e24dcc26170736843e53b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abee73a0d9e5f3af9eb88d5cfd6b953c3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#abee73a0d9e5f3af9eb88d5cfd6b953c3">smart_mag_oo</a></td></tr>
<tr class="memdesc:abee73a0d9e5f3af9eb88d5cfd6b953c3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Smart Magnet on/off.  <a href="#abee73a0d9e5f3af9eb88d5cfd6b953c3"></a><br/></td></tr>
<tr class="separator:abee73a0d9e5f3af9eb88d5cfd6b953c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af813a2eff0b7efa4c70633559054e84c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#af813a2eff0b7efa4c70633559054e84c">blight_ud</a></td></tr>
<tr class="memdesc:af813a2eff0b7efa4c70633559054e84c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Back light Up/Down actuator.  <a href="#af813a2eff0b7efa4c70633559054e84c"></a><br/></td></tr>
<tr class="separator:af813a2eff0b7efa4c70633559054e84c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae78d9a757d4c85419fff9c94b15e25d7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ae78d9a757d4c85419fff9c94b15e25d7">cryo</a></td></tr>
<tr class="memdesc:ae78d9a757d4c85419fff9c94b15e25d7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Move the cryostream towards or away from the crystal.  <a href="#ae78d9a757d4c85419fff9c94b15e25d7"></a><br/></td></tr>
<tr class="separator:ae78d9a757d4c85419fff9c94b15e25d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d9c5030d817483ca9518027c91adac4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a9d9c5030d817483ca9518027c91adac4">dryer</a></td></tr>
<tr class="memdesc:a9d9c5030d817483ca9518027c91adac4"><td class="mdescLeft">&#160;</td><td class="mdescRight">blow air on the scintilator to dry it off  <a href="#a9d9c5030d817483ca9518027c91adac4"></a><br/></td></tr>
<tr class="separator:a9d9c5030d817483ca9518027c91adac4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:addb26c80065506faa1de3c1b468fe03f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#addb26c80065506faa1de3c1b468fe03f">fluo</a></td></tr>
<tr class="memdesc:addb26c80065506faa1de3c1b468fe03f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Move the fluorescence detector in/out.  <a href="#addb26c80065506faa1de3c1b468fe03f"></a><br/></td></tr>
<tr class="separator:addb26c80065506faa1de3c1b468fe03f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6630442dc65ce8a30a24ed718b301971"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a6630442dc65ce8a30a24ed718b301971">flight_oo</a></td></tr>
<tr class="memdesc:a6630442dc65ce8a30a24ed718b301971"><td class="mdescLeft">&#160;</td><td class="mdescRight">Turn front light on/off.  <a href="#a6630442dc65ce8a30a24ed718b301971"></a><br/></td></tr>
<tr class="separator:a6630442dc65ce8a30a24ed718b301971"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af55c51d52c4586b647114f95d7ac1f42"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#af55c51d52c4586b647114f95d7ac1f42">blight_f</a></td></tr>
<tr class="memdesc:af55c51d52c4586b647114f95d7ac1f42"><td class="mdescLeft">&#160;</td><td class="mdescRight">Back light scale factor.  <a href="#af55c51d52c4586b647114f95d7ac1f42"></a><br/></td></tr>
<tr class="separator:af55c51d52c4586b647114f95d7ac1f42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabf4ec595b5183c1777d029ca56134b0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aabf4ec595b5183c1777d029ca56134b0">flight_f</a></td></tr>
<tr class="memdesc:aabf4ec595b5183c1777d029ca56134b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Front light scale factor.  <a href="#aabf4ec595b5183c1777d029ca56134b0"></a><br/></td></tr>
<tr class="separator:aabf4ec595b5183c1777d029ca56134b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aade15098d213bb25522048e4a231941a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aade15098d213bb25522048e4a231941a">lp_air</a></td></tr>
<tr class="memdesc:aade15098d213bb25522048e4a231941a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Low pressure air OK.  <a href="#aade15098d213bb25522048e4a231941a"></a><br/></td></tr>
<tr class="separator:aade15098d213bb25522048e4a231941a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb29b117ad38156ba16fcf44eeb427af"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#abb29b117ad38156ba16fcf44eeb427af">hp_air</a></td></tr>
<tr class="memdesc:abb29b117ad38156ba16fcf44eeb427af"><td class="mdescLeft">&#160;</td><td class="mdescRight">High pressure air OK.  <a href="#abb29b117ad38156ba16fcf44eeb427af"></a><br/></td></tr>
<tr class="separator:abb29b117ad38156ba16fcf44eeb427af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28df32fd6be9160603aa1bb74a823574"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a28df32fd6be9160603aa1bb74a823574">cryo_switch</a></td></tr>
<tr class="memdesc:a28df32fd6be9160603aa1bb74a823574"><td class="mdescLeft">&#160;</td><td class="mdescRight">that little toggle switch for the cryo  <a href="#a28df32fd6be9160603aa1bb74a823574"></a><br/></td></tr>
<tr class="separator:a28df32fd6be9160603aa1bb74a823574"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0d0bc95bcbcbd154b30c72a9645c8b2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ac0d0bc95bcbcbd154b30c72a9645c8b2">blight_down</a></td></tr>
<tr class="memdesc:ac0d0bc95bcbcbd154b30c72a9645c8b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Backlight is down.  <a href="#ac0d0bc95bcbcbd154b30c72a9645c8b2"></a><br/></td></tr>
<tr class="separator:ac0d0bc95bcbcbd154b30c72a9645c8b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fba65f6555c5c7908852c6cf1ad0c94"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a7fba65f6555c5c7908852c6cf1ad0c94">blight_up</a></td></tr>
<tr class="memdesc:a7fba65f6555c5c7908852c6cf1ad0c94"><td class="mdescLeft">&#160;</td><td class="mdescRight">Backlight is up.  <a href="#a7fba65f6555c5c7908852c6cf1ad0c94"></a><br/></td></tr>
<tr class="separator:a7fba65f6555c5c7908852c6cf1ad0c94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a871d4cdea0a1a8db85b8658a07655212"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a871d4cdea0a1a8db85b8658a07655212">cryo_back</a></td></tr>
<tr class="memdesc:a871d4cdea0a1a8db85b8658a07655212"><td class="mdescLeft">&#160;</td><td class="mdescRight">cryo is in the back position  <a href="#a871d4cdea0a1a8db85b8658a07655212"></a><br/></td></tr>
<tr class="separator:a871d4cdea0a1a8db85b8658a07655212"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a67092de6f3fcc0b245e4970437eaff6b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a67092de6f3fcc0b245e4970437eaff6b">fluor_back</a></td></tr>
<tr class="memdesc:a67092de6f3fcc0b245e4970437eaff6b"><td class="mdescLeft">&#160;</td><td class="mdescRight">fluor is in the back position  <a href="#a67092de6f3fcc0b245e4970437eaff6b"></a><br/></td></tr>
<tr class="separator:a67092de6f3fcc0b245e4970437eaff6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac59ab990e48033a811aeb0281fb588fc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ac59ab990e48033a811aeb0281fb588fc">sample_detected</a></td></tr>
<tr class="memdesc:ac59ab990e48033a811aeb0281fb588fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">smart magnet detected sample  <a href="#ac59ab990e48033a811aeb0281fb588fc"></a><br/></td></tr>
<tr class="separator:ac59ab990e48033a811aeb0281fb588fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5538a6aa526eeed65ff237303da2d348"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a5538a6aa526eeed65ff237303da2d348">etel_ready</a></td></tr>
<tr class="memdesc:a5538a6aa526eeed65ff237303da2d348"><td class="mdescLeft">&#160;</td><td class="mdescRight">ETEL is ready.  <a href="#a5538a6aa526eeed65ff237303da2d348"></a><br/></td></tr>
<tr class="separator:a5538a6aa526eeed65ff237303da2d348"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab48d4a2cf0225796db9aad49f034dc59"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ab48d4a2cf0225796db9aad49f034dc59">etel_on</a></td></tr>
<tr class="memdesc:ab48d4a2cf0225796db9aad49f034dc59"><td class="mdescLeft">&#160;</td><td class="mdescRight">ETEL is on.  <a href="#ab48d4a2cf0225796db9aad49f034dc59"></a><br/></td></tr>
<tr class="separator:ab48d4a2cf0225796db9aad49f034dc59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e690d4ad981d020ea2c850282dca3be"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a1e690d4ad981d020ea2c850282dca3be">etel_init_ok</a></td></tr>
<tr class="memdesc:a1e690d4ad981d020ea2c850282dca3be"><td class="mdescLeft">&#160;</td><td class="mdescRight">ETEL initialized OK.  <a href="#a1e690d4ad981d020ea2c850282dca3be"></a><br/></td></tr>
<tr class="separator:a1e690d4ad981d020ea2c850282dca3be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab552f2e28dd9cccefafe01f27717101b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ab552f2e28dd9cccefafe01f27717101b">minikappa_ok</a></td></tr>
<tr class="memdesc:ab552f2e28dd9cccefafe01f27717101b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Minikappa is OK (whatever that means)  <a href="#ab552f2e28dd9cccefafe01f27717101b"></a><br/></td></tr>
<tr class="separator:ab552f2e28dd9cccefafe01f27717101b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2dc6fa78bb6313fe8b696d646eaa2443"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a2dc6fa78bb6313fe8b696d646eaa2443">smart_mag_on</a></td></tr>
<tr class="memdesc:a2dc6fa78bb6313fe8b696d646eaa2443"><td class="mdescLeft">&#160;</td><td class="mdescRight">smart magnet is on  <a href="#a2dc6fa78bb6313fe8b696d646eaa2443"></a><br/></td></tr>
<tr class="separator:a2dc6fa78bb6313fe8b696d646eaa2443"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afaff4fbb5f03b0d2469fc7a14f174d69"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#afaff4fbb5f03b0d2469fc7a14f174d69">arm_parked</a></td></tr>
<tr class="memdesc:afaff4fbb5f03b0d2469fc7a14f174d69"><td class="mdescLeft">&#160;</td><td class="mdescRight">(whose arm? parked where?)  <a href="#afaff4fbb5f03b0d2469fc7a14f174d69"></a><br/></td></tr>
<tr class="separator:afaff4fbb5f03b0d2469fc7a14f174d69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae98a0792d6b4b96a33df0a31bdec6342"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ae98a0792d6b4b96a33df0a31bdec6342">shutter_open</a></td></tr>
<tr class="memdesc:ae98a0792d6b4b96a33df0a31bdec6342"><td class="mdescLeft">&#160;</td><td class="mdescRight">shutter is open (note in pmc says this is a slow input)  <a href="#ae98a0792d6b4b96a33df0a31bdec6342"></a><br/></td></tr>
<tr class="separator:ae98a0792d6b4b96a33df0a31bdec6342"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37903ed8430ac4d9ead609a78eb62f32"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a37903ed8430ac4d9ead609a78eb62f32">smart_mag_err</a></td></tr>
<tr class="memdesc:a37903ed8430ac4d9ead609a78eb62f32"><td class="mdescLeft">&#160;</td><td class="mdescRight">smart magnet error (coil broken perhaps)  <a href="#a37903ed8430ac4d9ead609a78eb62f32"></a><br/></td></tr>
<tr class="separator:a37903ed8430ac4d9ead609a78eb62f32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4892e918830dd12093d28c53a1c2df98"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a4892e918830dd12093d28c53a1c2df98">smart_mag_off</a></td></tr>
<tr class="memdesc:a4892e918830dd12093d28c53a1c2df98"><td class="mdescLeft">&#160;</td><td class="mdescRight">smart magnet is off  <a href="#a4892e918830dd12093d28c53a1c2df98"></a><br/></td></tr>
<tr class="separator:a4892e918830dd12093d28c53a1c2df98"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9da2795d11ccbc3a060c4811770ad04c"><td class="memItemLeft" align="right" valign="top">static unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a9da2795d11ccbc3a060c4811770ad04c">dbmem</a> [64 *1024]</td></tr>
<tr class="memdesc:a9da2795d11ccbc3a060c4811770ad04c"><td class="mdescLeft">&#160;</td><td class="mdescRight">double buffered memory  <a href="#a9da2795d11ccbc3a060c4811770ad04c"></a><br/></td></tr>
<tr class="separator:a9da2795d11ccbc3a060c4811770ad04c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0be2f26364c4d12c9c81c10913f0b26"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aa0be2f26364c4d12c9c81c10913f0b26">dbmemIn</a> = 0</td></tr>
<tr class="memdesc:aa0be2f26364c4d12c9c81c10913f0b26"><td class="mdescLeft">&#160;</td><td class="mdescRight">next location  <a href="#aa0be2f26364c4d12c9c81c10913f0b26"></a><br/></td></tr>
<tr class="separator:aa0be2f26364c4d12c9c81c10913f0b26"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4bed9053319d1d2cad5cc03d0549e17f"><td class="memItemLeft" align="right" valign="top">static struct timeval <br class="typebreak"/>
pmac_time_sent&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f">now</a></td></tr>
<tr class="memdesc:a4bed9053319d1d2cad5cc03d0549e17f"><td class="mdescLeft">&#160;</td><td class="mdescRight">used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands.  <a href="#a4bed9053319d1d2cad5cc03d0549e17f"></a><br/></td></tr>
<tr class="separator:a4bed9053319d1d2cad5cc03d0549e17f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6fcbbe47fe9912533962601f5befdb29"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="pgpmac_8h.html#a2d163436571135a457f4a4e2fbd09633">pmac_cmd_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a></td></tr>
<tr class="separator:a6fcbbe47fe9912533962601f5befdb29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7b21213b9c78b6745213409f1ef7320"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="pgpmac_8h.html#a2d163436571135a457f4a4e2fbd09633">pmac_cmd_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a></td></tr>
<tr class="separator:ae7b21213b9c78b6745213409f1ef7320"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8908812f4ff25c196679e00d330edd81"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="pgpmac_8h.html#a2d163436571135a457f4a4e2fbd09633">pmac_cmd_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81">cr_cmd</a></td></tr>
<tr class="memdesc:a8908812f4ff25c196679e00d330edd81"><td class="mdescLeft">&#160;</td><td class="mdescRight">commands to send out "readready", "getbuffer", "controlresponse" (initialized in main)  <a href="#a8908812f4ff25c196679e00d330edd81"></a><br/></td></tr>
<tr class="separator:a8908812f4ff25c196679e00d330edd81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69e569a833fe7f202b92e860d1548f2b"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a69e569a833fe7f202b92e860d1548f2b">ethCmdQueue</a> [<a class="el" href="lspmac_8c.html#a3fae557baafab24b7518dc84f5ef5a9b">PMAC_CMD_QUEUE_LENGTH</a>]</td></tr>
<tr class="memdesc:a69e569a833fe7f202b92e860d1548f2b"><td class="mdescLeft">&#160;</td><td class="mdescRight">PMAC command queue.  <a href="#a69e569a833fe7f202b92e860d1548f2b"></a><br/></td></tr>
<tr class="separator:a69e569a833fe7f202b92e860d1548f2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad62b1f9e907acc3de9f3d6a05d55829e"><td class="memItemLeft" align="right" valign="top">static unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ad62b1f9e907acc3de9f3d6a05d55829e">ethCmdOn</a> = 0</td></tr>
<tr class="memdesc:ad62b1f9e907acc3de9f3d6a05d55829e"><td class="mdescLeft">&#160;</td><td class="mdescRight">points to next empty PMAC command queue position  <a href="#ad62b1f9e907acc3de9f3d6a05d55829e"></a><br/></td></tr>
<tr class="separator:ad62b1f9e907acc3de9f3d6a05d55829e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae85caec6f4ddb2fc52ca14a26549ab08"><td class="memItemLeft" align="right" valign="top">static unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ae85caec6f4ddb2fc52ca14a26549ab08">ethCmdOff</a> = 0</td></tr>
<tr class="memdesc:ae85caec6f4ddb2fc52ca14a26549ab08"><td class="mdescLeft">&#160;</td><td class="mdescRight">points to current command (or none if == ethCmdOn)  <a href="#ae85caec6f4ddb2fc52ca14a26549ab08"></a><br/></td></tr>
<tr class="separator:ae85caec6f4ddb2fc52ca14a26549ab08"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a78524ada402bb74759a3dfc5f8a571"><td class="memItemLeft" align="right" valign="top">static unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a7a78524ada402bb74759a3dfc5f8a571">ethCmdReply</a> = 0</td></tr>
<tr class="memdesc:a7a78524ada402bb74759a3dfc5f8a571"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used like ethCmdOff only to deal with the pmac reply to a command.  <a href="#a7a78524ada402bb74759a3dfc5f8a571"></a><br/></td></tr>
<tr class="separator:a7a78524ada402bb74759a3dfc5f8a571"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab5a76f1ac64049314f9836e5c01fb7e"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aab5a76f1ac64049314f9836e5c01fb7e">pmac_error_strs</a> []</td></tr>
<tr class="memdesc:aab5a76f1ac64049314f9836e5c01fb7e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Decode the errors perhaps returned by the PMAC.  <a href="#aab5a76f1ac64049314f9836e5c01fb7e"></a><br/></td></tr>
<tr class="separator:aab5a76f1ac64049314f9836e5c01fb7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5bce7451d48127bace5af445d03b492"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="lspmac_8c.html#a3495613b8b94cadc4205f19e1254ebeb">md2_status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492">md2_status</a></td></tr>
<tr class="memdesc:ad5bce7451d48127bace5af445d03b492"><td class="mdescLeft">&#160;</td><td class="mdescRight">Buffer for MD2 Status.  <a href="#ad5bce7451d48127bace5af445d03b492"></a><br/></td></tr>
<tr class="separator:ad5bce7451d48127bace5af445d03b492"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a3e763682bd7f987d07f149e94b3bf8"><td class="memItemLeft" align="right" valign="top">pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a7a3e763682bd7f987d07f149e94b3bf8">md2_status_mutex</a></td></tr>
<tr class="memdesc:a7a3e763682bd7f987d07f149e94b3bf8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Synchronize reading/writting status buffer.  <a href="#a7a3e763682bd7f987d07f149e94b3bf8"></a><br/></td></tr>
<tr class="separator:a7a3e763682bd7f987d07f149e94b3bf8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a859f81d68defff3836a94afd5ef38e9a"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="lspmac_8c.html#a3f7d17365bd23c29c6f498210179d2c1">lspmac_ascii_buffers_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a859f81d68defff3836a94afd5ef38e9a">lspmac_ascii_buffers</a></td></tr>
<tr class="separator:a859f81d68defff3836a94afd5ef38e9a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e7ae750b8988cd2eb93895e3ea1a49e"><td class="memItemLeft" align="right" valign="top">pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a3e7ae750b8988cd2eb93895e3ea1a49e">lspmac_ascii_buffers_mutex</a></td></tr>
<tr class="separator:a3e7ae750b8988cd2eb93895e3ea1a49e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2bd5340143f40b5e6404a381fb438710"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="lspmac_8c.html#a93786bb32f3e2ef44e7967210beeeca3">lspmac_dpascii_queue_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a2bd5340143f40b5e6404a381fb438710">lspmac_dpascii_queue</a> [<a class="el" href="lspmac_8c.html#a3a407e2e4d57ac45ecd700f8bad3d3b5">LSPMAC_DPASCII_QUEUE_LENGTH</a>]</td></tr>
<tr class="separator:a2bd5340143f40b5e6404a381fb438710"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09701de0235acaeae5abf4e04268be33"><td class="memItemLeft" align="right" valign="top">static uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a09701de0235acaeae5abf4e04268be33">lspmac_dpascii_on</a> = 0</td></tr>
<tr class="separator:a09701de0235acaeae5abf4e04268be33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b0d9e2c858f6f0178be2bfdd96d4c05"><td class="memItemLeft" align="right" valign="top">static uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a9b0d9e2c858f6f0178be2bfdd96d4c05">lspmac_dpascii_off</a> = 0</td></tr>
<tr class="separator:a9b0d9e2c858f6f0178be2bfdd96d4c05"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Routines concerned with communication with PMAC. </p>
<pre class="fragment">\date 2012
\author Keith Brister
\copyright All Rights Reserved
</pre><p>This is a state machine (surprise!) Lacking is support for writingbuffer, control writing and reading, as well as double buffered memory It looks like several different methods of managing PMAC communications are possible. Here is set up a queue of outgoing commands and deal completely with the result before sending the next. A full handshake of acknowledgements and "readready" is expected.</p>
<pre></pre><pre> State    Description
  -1      Reset the connection
   0      Detached: need to connect to tcp port
   1      Idle (waiting for a command to send to the pmac)
   2      Send command
   3      Waiting for command acknowledgement (no further response expected)
   4      Waiting for control character acknowledgement (further response expected)
   5      Waiting for command acknowledgement (further response expected)
   6      Waiting for get memory response
   7      Send controlresponse
   8      Send readready
   9      Waiting for acknowledgement of "readready"
  10      Send readbuffer
  11      Waiting for control response
  12      Waiting for readbuffer response</pre><pre></pre> 
<p>Definition in file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="abbd709b56a71eb1fc6adc9063605d243"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_CR&#160;&#160;&#160;7</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00045">45</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7eb86ecf0789ab9555de1e03a4c73567"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_DETACHED&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00038">38</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5f4ff8874677aac48a4c675f2c1ca4e9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_GB&#160;&#160;&#160;10</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00048">48</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a220b39710719cfe8b500d51819e8efeb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_GMR&#160;&#160;&#160;6</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00044">44</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a37741af675425d61c876cc30ae6c99d0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_IDLE&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00039">39</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7e1c68021b3dbb53ba1bac2afbd8fc20"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_RESET&#160;&#160;&#160;-1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00037">37</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="add5325f4a84e4fe05f558880349485ea"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_RR&#160;&#160;&#160;8</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00046">46</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7d8f34fc599cc08c1a9d2cd62ccbb20a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_SC&#160;&#160;&#160;2</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00040">40</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5eba9ef09d4316e803b9d75bd3104f43"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_WACK&#160;&#160;&#160;5</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00043">43</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="adef540911028fda73e8bbf0aa6ad39e9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_WACK_CC&#160;&#160;&#160;4</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00042">42</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a63356b0c18fcb186f456c12c6e927d84"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_WACK_NFR&#160;&#160;&#160;3</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00041">41</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3e0a62cd9a1212419ad3615c34bdc65a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_WACK_RR&#160;&#160;&#160;9</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00047">47</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a27ee6c39d58604c8aa9bd6c249c4833f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_WCR&#160;&#160;&#160;11</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00049">49</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a591822cc92f76a39b293c2e90b322db2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_WGB&#160;&#160;&#160;12</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00050">50</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3a407e2e4d57ac45ecd700f8bad3d3b5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LSPMAC_DPASCII_QUEUE_LENGTH&#160;&#160;&#160;1024</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00357">357</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a86ef4ac4630165f30f6c16e4783ed89f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LSPMAC_PRESET_REGEX&#160;&#160;&#160;&quot;(.*\\.%s\\.presets)\\.([0-9]+)\\.(name|position)&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Regex to pick out preset name and corresponding position. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00140">140</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3fae557baafab24b7518dc84f5ef5a9b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PMAC_CMD_QUEUE_LENGTH&#160;&#160;&#160;2048</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Size of the PMAC command queue. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00184">184</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="abdc45e3f7106f84f688419e2da9b3627"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define pmac_cmd_size&#160;&#160;&#160;8</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>PMAC command size in bytes. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00150">150</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a59f5f5218e25332dbf64f216aec116e5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PMAC_MIN_CMD_TIME&#160;&#160;&#160;10000.0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Minimum time between commands to the pmac. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00180">180</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac95886e84843b6b0bb6cc270e42043c4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PMACPORT&#160;&#160;&#160;1025</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The PMAC (only) listens on this port. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00144">144</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8f4ce4666a23a3fb153d680bd1cb6556"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_CTRL_RESPONSE&#160;&#160;&#160;0xc4</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00166">166</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="af24ecdc10723dc8fd6320fef416ae514"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_DOWNLOAD&#160;&#160;&#160;0x40</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00153">153</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a15e4dbce5615c285ec1755f01057b5fe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_FWDOWNLOAD&#160;&#160;&#160;0xcb</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00170">170</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a34a2e0d5c1f48ba463ae5d98431d05f7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_IPADDRESS&#160;&#160;&#160;0xe0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00171">171</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac0e5588681366b52589cd321eabf12ff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_FLUSH&#160;&#160;&#160;0xb3</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00157">157</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a50e444b5ceb6d62a1be43c88c55c549c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_GETBUFFER&#160;&#160;&#160;0xc5</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00167">167</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="af3c7372a48fccf0458f266f4bc758a2c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_GETLINE&#160;&#160;&#160;0xb1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00156">156</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="af9c53e7c5b2681a5ca1c5410a914a2dc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_GETMEM&#160;&#160;&#160;0xb4</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00158">158</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aee7c46f33b9b6945c6b2b260810dc7f5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_GETRESPONSE&#160;&#160;&#160;0xbf</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00164">164</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a4cd95cb80b8da3962ebe9ec8afe844c8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_PORT&#160;&#160;&#160;0xbe</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00163">163</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aad3c7b4a9403e56c09eceadcf21252c0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_READREADY&#160;&#160;&#160;0xc2</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00165">165</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a76c1c401354826ac2ba8906578be930f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_SENDCTRLCHAR&#160;&#160;&#160;0xb6</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00160">160</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a772b2ea2ad93989ae4275c79a93525ee"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_SENDLINE&#160;&#160;&#160;0xb0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00155">155</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aaed77195148c3d9fe10c6e82fc6b2ea7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_SETBIT&#160;&#160;&#160;0xba</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00161">161</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a91a625425f6df7610f440231868a5cf1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_SETBITS&#160;&#160;&#160;0xbb</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00162">162</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab79207cc3145740f8c070a24c91b11e0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_SETMEM&#160;&#160;&#160;0xb5</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00159">159</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="af5e53c37c17cd06e42f7b0df211f96d8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_WRITEBUFFER&#160;&#160;&#160;0xc6</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00168">168</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab8367c4c9247a96c6828418d87b8623b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_WRITEERROR&#160;&#160;&#160;0xc7</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00169">169</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5485d08fdc80533b5cebadff63696ed2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_UPLOAD&#160;&#160;&#160;0xc0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00152">152</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="a3f7d17365bd23c29c6f498210179d2c1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlspmac__ascii__buffers__struct.html">lspmac_ascii_buffers_struct</a>  <a class="el" href="lspmac_8c.html#a3f7d17365bd23c29c6f498210179d2c1">lspmac_ascii_buffers_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a93786bb32f3e2ef44e7967210beeeca3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlspmac__dpascii__queue__struct.html">lspmac_dpascii_queue_struct</a>  <a class="el" href="lspmac_8c.html#a93786bb32f3e2ef44e7967210beeeca3">lspmac_dpascii_queue_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a3495613b8b94cadc4205f19e1254ebeb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structmd2StatusStruct.html">md2StatusStruct</a>  <a class="el" href="lspmac_8c.html#a3495613b8b94cadc4205f19e1254ebeb">md2_status_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The block of memory retrieved in a status request. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="afd005045e9cc3f4bb93d424fe50eb733"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void _lspmac_motor_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Helper funciton for the init calls. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02904">2904</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                        {</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a56260f012c50a591ee7f97e500f16994" title="The number of motors we manage.">lspmac_nmotors</a>++;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_init( &amp;(d-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>), NULL);</div>
<div class="line">  pthread_cond_init(  &amp;(d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa0ea4108b8fed5b41ff91ca7266f3d84" title="used to signal when a motor is done moving">cond</a>), NULL);</div>
<div class="line"></div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>                = strdup(name);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#aed4998885bcd5a2a30069637180f58e3" title="Use the motor (&quot;true&quot;) or not (&quot;false&quot;)">active</a>              = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.active&quot;</span>,            d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#ac2a02f137e4a35db816bc728290d3558" title="pmac commands to make this motor active">active_init</a>         = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.active_init&quot;</span>,       d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a7437ef16c2dce65bde4dda1ea00e9df3" title="the axis (X, Y, Z, etc) or null if not in a coordinate system">axis</a>                = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.axis&quot;</span>,              d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a5614e003272e8323f8809bf7b6559532" title="coordinate system this motor belongs to (0 if none)">coord_num</a>           = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.coord_num&quot;</span>,         d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a6dc1ceab86687f741d4c4a574501959c" title="pmac commands to home motor">home</a>                = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.home&quot;</span>,              d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#ab329ce9b277eca9984c18417dece7bf7" title="pmac commands to inactivate the motor">inactive_init</a>       = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.inactive_init&quot;</span>,     d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a91c38b2072d878b71f4e77de2f1375a4" title="special format string to create text array for putting the position back into redis">redis_fmt</a>           = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.format&quot;</span>,            d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a50cf4c0711cea164e332bc34705a1a68" title="our maximum acceleration (cts/msec^2)">max_accel</a>           = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.max_accel&quot;</span>,         d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a69e49769a1001665377efc7193d88a0a" title="our maximum speed (cts/msec)">max_speed</a>           = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.max_speed&quot;</span>,         d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#aac8c31a857910cdcbb409331e128e766" title="our maximum position (soft limit)">max_pos</a>             = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.maxPosition&quot;</span>,       d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a7c1f2f67c64d26b12d6bb0d681797d8d" title="our minimum position (soft limit)">min_pos</a>             = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.minPosition&quot;</span>,       d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#ad6a51cca3c7e5f79168e5c33fd9e736b" title="pmac motor number">motor_num</a>           = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.motor_num&quot;</span>,         d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#afe13c86941928d20357f4f3e2a4d915a" title="negative limit status">neg_limit_hit</a>       = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.negLimitSet&quot;</span>,       d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#ae931e9bc9fc2fa82ca649334fc052fbe" title="zero offset">neutral_pos</a>         = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.neutralPosition&quot;</span>,   d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#af94a0b2611136058ead4948fd7c858e3" title="how we report our position to the world">redis_position</a>      = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.position&quot;</span>,          d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#af39d2e7a681d7c2fbdc39d53fab1a475" title="positive limit status">pos_limit_hit</a>       = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.posLimitSet&quot;</span>,       d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a411f12c0ecdc481687d4fbbbec4c5510" title="moves of less than this amount may be ignored">precision</a>           = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.precision&quot;</span>,         d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a25b13b65baf1b28c34012850809b0a3a" title="printf format">printf_fmt</a>          = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.printf&quot;</span>,            d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa0a6bed8379c5b1f90a4eb826cde9136" title="A talky version of the status.">status_str</a>          = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.status_str&quot;</span>,        d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a8838915ebb6f9989944117c8197d5e86" title="conversion from counts to units: 0.0 means not loaded yet">u2c</a>                 = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.u2c&quot;</span>,               d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#af8e6eb1df6b0d343fc4da93fbdd63133" title="string to use as the units">unit</a>                = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.unit&quot;</span>,              d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#aefa84c7592369090eec8b211caaa3a51" title="Change needs to be at least this big to report as a new position to the database.">update_resolution</a>   = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.update_resolution&quot;</span>, d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>                 = NULL;</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a>                = 0;</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa74108855693f94fc2ff76333c9fb6ac" title="Homing routine started.">homing</a>              = 0;</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a05dff021221abbc1bf656039fffb3275" title="controlling mvariable as a string">dac_mvar</a>            = NULL;</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a>   = NULL;</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a56c41875faf19c643e97c10519e6eb8c" title="First 24 bit PMAC motor status word.">status1_p</a>           = NULL;</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a2b33ef6e12717459c1e9967cc6e659c6" title="Sectond 24 bit PMAC motor status word.">status2_p</a>           = NULL;</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>                 = NULL;</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#ac62692eb939c04ca35e939d1c3acfe8f" title="method to read the motor status and position">read</a>                = NULL;</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#ae5f1f605a0f587500e627332ad4e5e7e" title="previous position reported to the database">reported_position</a>   = INFINITY;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8f9f1ad624350095075aa6b51423b02d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cleanstr </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Replace \r with \n in null terminated string and print result to terminal. </p>
<p>Needed to turn PMAC messages into something printable. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">s</td><td>String to print to terminal. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00537">537</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                {</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;strlen( s); i++) {</div>
<div class="line">    <span class="keywordflow">if</span>( s[i] == <span class="charliteral">&#39;\r&#39;</span>)</div>
<div class="line">      wprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      wprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, <span class="stringliteral">&quot;%c&quot;</span>, s[i]);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1c3786f3a38724f497afc4fe6d82d8c4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void hex_dump </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>s</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prints a hex dump of the given data. </p>
<p>Used to debug packet data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>Number of bytes passed in s </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">s</td><td>Data to dump </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00510">510</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                {</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;        <span class="comment">// row counter</span></div>
<div class="line">  <span class="keywordtype">int</span> j;        <span class="comment">// column counter</span></div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> outs[128], outs1[4];</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span>( i=0; n &gt; 0; i++) {</div>
<div class="line"></div>
<div class="line">    sprintf( (<span class="keywordtype">char</span> *)outs, <span class="stringliteral">&quot;%04d: &quot;</span>, 16*i);</div>
<div class="line">    <span class="keywordflow">for</span>( j=0; j&lt;16 &amp;&amp; n &gt; 0; j++) {</div>
<div class="line">      <span class="keywordflow">if</span>( j==8)</div>
<div class="line">        strcat( (<span class="keywordtype">char</span> *)outs, <span class="stringliteral">&quot;  &quot;</span>);</div>
<div class="line">      sprintf( (<span class="keywordtype">char</span> *)outs1, <span class="stringliteral">&quot; %02x&quot;</span>,  *(s + 16*i + j));</div>
<div class="line">      strcat( (<span class="keywordtype">char</span> *)outs, (<span class="keywordtype">char</span> *)outs1);</div>
<div class="line">      n--;</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;hex_dump: %s&quot;</span>, outs);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aae020ea2478b41702ce8b7d20b2560be"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsConnect </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>ipaddr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Connect to the PMAC socket. </p>
<p>Establish or reestablish communications. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ipaddr</td><td>String representation of the IP address (dot quad or FQN) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00558">558</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                 {</div>
<div class="line">  <span class="keywordtype">int</span> psock;                    <span class="comment">// our socket: value stored in pmacfda.fd</span></div>
<div class="line">  <span class="keywordtype">int</span> err;                      <span class="comment">// error code from some system calls</span></div>
<div class="line">  <span class="keyword">struct </span>sockaddr_in *addrP;    <span class="comment">// our address structure to connect to</span></div>
<div class="line">  <span class="keyword">struct </span>addrinfo ai_hints;     <span class="comment">// required for getaddrinfo</span></div>
<div class="line">  <span class="keyword">struct </span>addrinfo *ai_resultP;  <span class="comment">// linked list of address structures (we&#39;ll always pick the first)</span></div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba" title="our poll structure">pmacfd</a>.fd     = -1;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba" title="our poll structure">pmacfd</a>.events = 0;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Initial buffer(s)</span></div>
<div class="line">  memset( &amp;ai_hints,  0, <span class="keyword">sizeof</span>( ai_hints));</div>
<div class="line"></div>
<div class="line">  ai_hints.ai_family   = AF_INET;</div>
<div class="line">  ai_hints.ai_socktype = SOCK_STREAM;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// get address</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  err = getaddrinfo( ipaddr, NULL, &amp;ai_hints, &amp;ai_resultP);</div>
<div class="line">  <span class="keywordflow">if</span>( err != 0) {</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Could not find address: %s&quot;</span>, gai_strerror( err));</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  addrP = (<span class="keyword">struct </span>sockaddr_in *)ai_resultP-&gt;ai_addr;</div>
<div class="line">  addrP-&gt;sin_port = htons( <a class="code" href="lspmac_8c.html#ac95886e84843b6b0bb6cc270e42043c4" title="The PMAC (only) listens on this port.">PMACPORT</a>);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  psock = socket( PF_INET, SOCK_STREAM, 0);</div>
<div class="line">  <span class="keywordflow">if</span>( psock == -1) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Could not create socket&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  err = connect( psock, (<span class="keyword">const</span> <span class="keyword">struct</span> sockaddr *)addrP, <span class="keyword">sizeof</span>( *addrP));</div>
<div class="line">  <span class="keywordflow">if</span>( err != 0) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Could not connect socket: %s&quot;</span>, strerror( errno));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a37741af675425d61c876cc30ae6c99d0">LS_PMAC_STATE_IDLE</a>;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba" title="our poll structure">pmacfd</a>.fd     = psock;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba" title="our poll structure">pmacfd</a>.events = POLLIN;</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a85f7a5e4d853b7a86ddde1006dd4dc1f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_abort </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>abort motion and try to recover </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02012">2012</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                    {</div>
<div class="line">  <a class="code" href="structlspmac__motor__struct.html" title="Motor information.">lspmac_motor_t</a> *mp;</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#a0575fc751cecf35ffe8b290ab483ac21" title="use dpram ascii interface to send a control character">lspmac_SockSendDPControlChar</a>( <span class="stringliteral">&quot;Abort Request&quot;</span>, 0x01);</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;<a class="code" href="lspmac_8c.html#a56260f012c50a591ee7f97e500f16994" title="The number of motors we manage.">lspmac_nmotors</a>; i++) {</div>
<div class="line">    mp = &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>]);</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ad6a51cca3c7e5f79168e5c33fd9e736b" title="pmac motor number">motor_num</a>) &gt;=1 &amp;&amp; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a69e49769a1001665377efc7193d88a0a" title="our maximum speed (cts/msec)">max_speed</a> != NULL) {</div>
<div class="line">        <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( NULL, <span class="stringliteral">&quot;i%d22=%d&quot;</span>, <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ad6a51cca3c7e5f79168e5c33fd9e736b" title="pmac motor number">motor_num</a>), <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a69e49769a1001665377efc7193d88a0a" title="our maximum speed (cts/msec)">max_speed</a>));</div>
<div class="line">      }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae2136d97501e077e3d4b23237e7fe374"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_asciicmdCB </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nreceived</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>PMAC has received our ascii command request Now see when it is ready for the next one. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01943">1943</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                                         {</div>
<div class="line">  <a class="code" href="lspmac_8c.html#adb46b594a6926134322186a3c85df37d" title="Forward declarateion.">lspmac_get_ascii</a>( cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#ace4d453ad6d6225e910dffb33cde866a" title="event name to send">event</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a571cf14b82b5aae163af5aec3201cd3e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_backLight_down_cb </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Turn off the backlight whenever it goes down. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">event</td><td>Name of the event that called us </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l03264">3264</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                            {</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a38b6eee046c3ceff84f908af3335ebcf" title="function to move the motor">moveAbs</a>( <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>, 0.0);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a094f66824c57b27c9dad2ca36bd75e44"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_backLight_up_cb </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Turn on the backlight whenever it goes up. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">event</td><td>Name of the event that called us </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l03257">3257</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                          {</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a38b6eee046c3ceff84f908af3335ebcf" title="function to move the motor">moveAbs</a>( <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>, round(<a class="code" href="lspmac_8c.html#acc46bdddee59bd8c5ad662b3fd445e9f" title="get the motor position (with locking)">lspmac_getPosition</a>( <a class="code" href="lspmac_8c.html#ad53a42cfaa04eff0336a44c8c9986333" title="Optical zoom.">zoom</a>)));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac27a61fa5aca398b0db588674e7f6dc7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* lspmac_bi_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>onEvent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>offEvent</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize binary input. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l03059">3059</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                                                                {</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a33c5ed169a5437cb59ab904ffa3e3ffe" title="number of active binary inputs">lspmac_nbis</a>++;</div>
<div class="line">  pthread_mutex_init( &amp;(d-&gt;<a class="code" href="structlspmac__bi__struct.html#a58053a98fa4696b56d674e775b3b4690" title="so we don&#39;t get confused">mutex</a>), NULL);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__bi__struct.html#ae201bf05130bcb6985704ea42efabeb3" title="points to the location in the status buffer">ptr</a>            = ptr;</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__bi__struct.html#ac010058c9883088705059dee1d90ee72" title="mask for the bit in the status register">mask</a>           = mask;</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__bi__struct.html#ae7178007dfdf21be0e5b1fbaa36732af" title="Event to send when the value changes to 1.">changeEventOn</a>  = strdup( onEvent);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__bi__struct.html#ae0859842f637694ace0e6d54c0e2af6a" title="Event to send when the value changes to 0.">changeEventOff</a> = strdup( offEvent);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__bi__struct.html#a814978c33dc99e7911faa4ddb12bfd90" title="flag indicating we&#39;ve not read the input even once">first_time</a>     = 1;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> d;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4aa8c178a56276eb64138d52fe65dc8c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_blight_lut_setup </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set up lookup table for blight. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l03366">3366</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                               {</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">  <a class="code" href="structlsredis__obj__struct.html" title="Redis Object Basic object whose value is sychronized with our redis db.">lsredis_obj_t</a> *<a class="code" href="namespacemk__pgpmac__redis.html#a11daf2847f2dc94562b5b61b3f412574">p</a>;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a> = 11;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a> = calloc( 2 * <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a>, <span class="keyword">sizeof</span>( <span class="keywordtype">double</span>));</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a> == NULL) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_blight_lut_setup: out of memory&quot;</span>);</div>
<div class="line">    exit( -1);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>[0] = 0;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>[1] = 0;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span>( i=1; i&lt;<a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a>; i++) {</div>
<div class="line">    p = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;cam.zoom.%d.LightIntensity&quot;</span>, i);</div>
<div class="line">    <span class="keywordflow">if</span>( p==NULL || strlen( <a class="code" href="lsredis_8c.html#ac1994e56114b2315294527d76311f829" title="return a copy of the key&#39;s string value">lsredis_getstr</a>(p)) == 0) {</div>
<div class="line">      free( <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>);</div>
<div class="line">      <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a> = NULL;</div>
<div class="line">      <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a> = 0;</div>
<div class="line">      pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>);</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_blight_lut_setup: cannot find MotorPosition element for cam.blight level %d&quot;</span>, i);</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>[2*<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>]   = <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>[2*i+1] = 20000.0 * <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( p) / 100.0;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;<a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a>; i++) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_blight_lut_setup:  i: %d  x: %f  y: %f  y(lut): %f  x(rlut): %f&quot;</span>,</div>
<div class="line">                           i, <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>[2*i], <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>[2*i+1],</div>
<div class="line">                           <a class="code" href="lspmac_8c.html#a55b882be15d56a2a777f2b1f92901b7d" title="Look up table support for motor positions (think x=zoom, y=light intensity) use a lookup table to fin...">lspmac_lut</a>( <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a>, <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>, <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>[2*i]),</div>
<div class="line">                           <a class="code" href="lspmac_8c.html#a5afe5cd407b44f9c05ad4f1c4e4d5f6a">lspmac_rlut</a>( <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a>, <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>, <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>[2*i+1])</div>
<div class="line">                           );</div>
<div class="line">  }</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aeaa263af25d139f249d8b825a058d0ce"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* lspmac_bo_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>write_fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>read_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>read_mask</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize binary i/o motor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">d</td><td>Our uninitialized motor object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">name</td><td>Name of motor to coordinate with DB </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">write_fmt</td><td>Format string used to generate PMAC command to move motor </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">read_ptr</td><td>Pointer to byte in md2_status to find position </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">read_mask</td><td>Bitmask to find position in *read_ptr </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02993">2993</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                  {</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#afd005045e9cc3f4bb93d424fe50eb733" title="Helper funciton for the init calls.">_lspmac_motor_init</a>( d, name);</div>
<div class="line"></div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a38b6eee046c3ceff84f908af3335ebcf" title="function to move the motor">moveAbs</a>           = <a class="code" href="lspmac_8c.html#aa94d5a726be9f97dee7a1889a759e0a7" title="Move method for binary i/o motor objects.">lspmac_moveabs_bo_queue</a>;</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#ac62692eb939c04ca35e939d1c3acfe8f" title="method to read the motor status and position">read</a>              = <a class="code" href="lspmac_8c.html#a05aeb6b4b78725f3e36e11eecb3623a4" title="Read the state of a binary i/o motor This is the read method for the binary i/o motor class...">lspmac_bo_read</a>;</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a70291ddfe7994c0bec7fc2287cb6dd89" title="Format string to write requested position to PMAC used for binary io.">write_fmt</a>         = strdup( write_fmt);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a844b28ccabab5048ca216db074fb9704" title="With read_mask finds bit to read for binary i/o.">read_ptr</a>          = read_ptr;</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a3c24ed30c5a3ad490c6139b2780b2af7" title="With read_ptr find bit to read for binary i/o.">read_mask</a>         = read_mask;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> d;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a05aeb6b4b78725f3e36e11eecb3623a4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_bo_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read the state of a binary i/o motor This is the read method for the binary i/o motor class. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>The motor </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01121">1121</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                      {</div>
<div class="line">  <span class="keywordtype">int</span> pos, changed;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  pos = (*(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a844b28ccabab5048ca216db074fb9704" title="With read_mask finds bit to read for binary i/o.">read_ptr</a>) &amp; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a3c24ed30c5a3ad490c6139b2780b2af7" title="With read_ptr find bit to read for binary i/o.">read_mask</a>) == 0 ? 0 : 1;</div>
<div class="line"></div>
<div class="line">  changed = pos != mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a>;</div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a> = pos;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( changed)</div>
<div class="line">    <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s %d&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, pos);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a611168a1076b2de45c596ed95c68445a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_command_done_cb </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l03426">3426</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                          {</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">  <a class="code" href="structlspmac__motor__struct.html" title="Motor information.">lspmac_motor_t</a> *mp;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// O(n).  Bad.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;<a class="code" href="lspmac_8c.html#a56260f012c50a591ee7f97e500f16994" title="The number of motors we manage.">lspmac_nmotors</a>; i++) {</div>
<div class="line">    <span class="keywordflow">if</span>( strncmp( <a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[i].name, event, strlen( <a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[i].name)) == 0)</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( i &gt;= lspmac_nmotors)</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">  mp = &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>]);</div>
<div class="line">  pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a59a7f007476b2428fd3c5bd7f24440e8" title="Motion command verified sent to pmac.">command_sent</a> = 1;</div>
<div class="line"></div>
<div class="line">  pthread_cond_signal( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa0ea4108b8fed5b41ff91ca7266f3d84" title="used to signal when a motor is done moving">cond</a>));</div>
<div class="line">  pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="afc00ddac633f8c8a3a699e3d22de2770"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_cryoSwitchChanged_cb </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l03219">3219</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                               {</div>
<div class="line">  <span class="keywordtype">int</span> pos;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspmac_8c.html#ae78d9a757d4c85419fff9c94b15e25d7" title="Move the cryostream towards or away from the crystal.">cryo</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  pos = <a class="code" href="lspmac_8c.html#ae78d9a757d4c85419fff9c94b15e25d7" title="Move the cryostream towards or away from the crystal.">cryo</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a>;</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspmac_8c.html#ae78d9a757d4c85419fff9c94b15e25d7" title="Move the cryostream towards or away from the crystal.">cryo</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#ae78d9a757d4c85419fff9c94b15e25d7" title="Move the cryostream towards or away from the crystal.">cryo</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a38b6eee046c3ceff84f908af3335ebcf" title="function to move the motor">moveAbs</a>( <a class="code" href="lspmac_8c.html#ae78d9a757d4c85419fff9c94b15e25d7" title="Move the cryostream towards or away from the crystal.">cryo</a>, pos ? 0.0 : 1.0);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="acea9dfc6367bbcf16f49e664e0fc3774"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* lspmac_dac_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>posp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>mvar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int(*)(<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *, double)&#160;</td>
          <td class="paramname"><em>moveAbs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize DAC motor Note that some motors require further initialization from a database query. </p>
<p>For this reason this initialzation code must be run before the database queue is allowed to be processed. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">d</td><td>Returns the (almost) initialized motor object [in,out] unitintialized motor </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">posp</td><td>Location of current position </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mvar</td><td>M variable, ie, "M1200" </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">name</td><td>name to coordinate with DB </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">moveAbs</td><td>Method to use to move this motor </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l03019">3019</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                  {</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#afd005045e9cc3f4bb93d424fe50eb733" title="Helper funciton for the init calls.">_lspmac_motor_init</a>( d, name);</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a38b6eee046c3ceff84f908af3335ebcf" title="function to move the motor">moveAbs</a>           = moveAbs;</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#ac62692eb939c04ca35e939d1c3acfe8f" title="method to read the motor status and position">read</a>              = <a class="code" href="lspmac_8c.html#a200bc9306d54fca566eb5e29d8e82308" title="Read a DAC motor position.">lspmac_dac_read</a>;</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a> = posp;</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a05dff021221abbc1bf656039fffb3275" title="controlling mvariable as a string">dac_mvar</a>          = strdup(mvar);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> d;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a200bc9306d54fca566eb5e29d8e82308"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_dac_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read a DAC motor position. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>The motor </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01141">1141</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                       {</div>
<div class="line">  <span class="keywordtype">double</span> u2c;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae5c7aea45b9637a1817be246688fd980" title="local copy of actual counts so only our mutex is needed to read">actual_pos_cnts</a> = *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a>;</div>
<div class="line">  u2c = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a8838915ebb6f9989944117c8197d5e86" title="conversion from counts to units: 0.0 means not loaded yet">u2c</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a> &gt;0 &amp;&amp; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a> != NULL) {</div>
<div class="line">    <span class="keywordflow">if</span>( u2c == 0.0)</div>
<div class="line">      u2c = 1.0;</div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a> = <a class="code" href="lspmac_8c.html#a5afe5cd407b44f9c05ad4f1c4e4d5f6a">lspmac_rlut</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae5c7aea45b9637a1817be246688fd980" title="local copy of actual counts so only our mutex is needed to read">actual_pos_cnts</a>/u2c);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="keywordflow">if</span>( u2c != 0.0) {</div>
<div class="line">      mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a> = mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae5c7aea45b9637a1817be246688fd980" title="local copy of actual counts so only our mutex is needed to read">actual_pos_cnts</a> / u2c;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a> = mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae5c7aea45b9637a1817be246688fd980" title="local copy of actual counts so only our mutex is needed to read">actual_pos_cnts</a>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4748a88d1fe46aa3ab1beee55bcddf1b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_Error </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buff</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The service routing detected an error condition. </p>
<p>Scan the response buffer for an error code and print it out. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">buff</td><td>Buffer returned by PMAC perhaps containing a NULL terminated message. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00767">767</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                    {</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// assume buff points to a 1400 byte array of stuff read from the pmac</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( buff[0] == 7 &amp;&amp; buff[1] == <span class="charliteral">&#39;E&#39;</span> &amp;&amp; buff[2] == <span class="charliteral">&#39;R&#39;</span> &amp;&amp; buff[3] == <span class="charliteral">&#39;R&#39;</span>) {</div>
<div class="line">    buff[7] = 0;  <span class="comment">// For null termination</span></div>
<div class="line">    err = atoi( &amp;(buff[4]));</div>
<div class="line">    <span class="keywordflow">if</span>( err &gt; 0 &amp;&amp; err &lt; 20) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <a class="code" href="lspmac_8c.html#aab5a76f1ac64049314f9836e5c01fb7e" title="Decode the errors perhaps returned by the PMAC.">pmac_error_strs</a>[err]);</div>
<div class="line"></div>
<div class="line">      pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);</div>
<div class="line">      wprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, <span class="stringliteral">&quot;\n%s\n&quot;</span>, <a class="code" href="lspmac_8c.html#aab5a76f1ac64049314f9836e5c01fb7e" title="Decode the errors perhaps returned by the PMAC.">pmac_error_strs</a>[err]);</div>
<div class="line">      wnoutrefresh( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>);</div>
<div class="line">      wnoutrefresh( <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>);</div>
<div class="line">      doupdate();</div>
<div class="line">      pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="lspmac_8c.html#aaedae34bc18ac1742a232117c125d7b9" title="Clear the queue and put the PMAC into a known state.">lspmac_Reset</a>();</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad52a5dbc2f06247eca7619195936b85f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_flight_lut_setup </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set up lookup table for flight. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l03333">3333</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                               {</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">  <a class="code" href="structlsredis__obj__struct.html" title="Redis Object Basic object whose value is sychronized with our redis db.">lsredis_obj_t</a> *<a class="code" href="namespacemk__pgpmac__redis.html#a11daf2847f2dc94562b5b61b3f412574">p</a>;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a> = 11;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a> = calloc( 2 * <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a>, <span class="keyword">sizeof</span>( <span class="keywordtype">double</span>));</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a> == NULL) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_flight_lut_setup: out of memory&quot;</span>);</div>
<div class="line">    exit( -1);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>[0] = 0;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>[1] = 0;</div>
<div class="line">  <span class="keywordflow">for</span>( i=1; i &lt; <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a>; i++) {</div>
<div class="line">    p = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;cam.zoom.%d.FrontLightIntensity&quot;</span>, i);</div>
<div class="line">    <span class="keywordflow">if</span>( p==NULL || strlen( <a class="code" href="lsredis_8c.html#ac1994e56114b2315294527d76311f829" title="return a copy of the key&#39;s string value">lsredis_getstr</a>(p)) == 0) {</div>
<div class="line">      free( <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>);</div>
<div class="line">      <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>  = NULL;</div>
<div class="line">      <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a> = 0;</div>
<div class="line">      pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>);</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_flight_lut_setup: cannot find MotorPosition element for cam.flight level %d&quot;</span>, i);</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>[2*<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>]   = <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">    <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>[2*i+1] = 32767.0 * <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( p) / 100.0;</div>
<div class="line">  }</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a54ceac41b127ad8bbad07bd90c6729dc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_fscint_lut_setup </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set up lookup table for fscint. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l03407">3407</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                               {</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#a8a3ca6fcf5e24dcc26170736843e53b2" title="Scintillator Piezo DAC.">fscint</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#a8a3ca6fcf5e24dcc26170736843e53b2" title="Scintillator Piezo DAC.">fscint</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a> = 101;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a8a3ca6fcf5e24dcc26170736843e53b2" title="Scintillator Piezo DAC.">fscint</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a> = calloc( 2 * <a class="code" href="lspmac_8c.html#a8a3ca6fcf5e24dcc26170736843e53b2" title="Scintillator Piezo DAC.">fscint</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a>, <span class="keyword">sizeof</span>( <span class="keywordtype">double</span>));</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#a8a3ca6fcf5e24dcc26170736843e53b2" title="Scintillator Piezo DAC.">fscint</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a> == NULL) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_fscint_lut_setup: out of memory&quot;</span>);</div>
<div class="line">    exit( -1);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;<a class="code" href="lspmac_8c.html#a8a3ca6fcf5e24dcc26170736843e53b2" title="Scintillator Piezo DAC.">fscint</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a>; i++) {</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a8a3ca6fcf5e24dcc26170736843e53b2" title="Scintillator Piezo DAC.">fscint</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>[2*<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>] = <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a8a3ca6fcf5e24dcc26170736843e53b2" title="Scintillator Piezo DAC.">fscint</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>[2*i+1] = 320.0 * <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">  }</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#a8a3ca6fcf5e24dcc26170736843e53b2" title="Scintillator Piezo DAC.">fscint</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a40aa4aeb5c799a6a3a089137da4fd6a8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* lspmac_fshut_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>d</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initalize the fast shutter motor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">d</td><td>Our uninitialized motor object </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02977">2977</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                    {</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#afd005045e9cc3f4bb93d424fe50eb733" title="Helper funciton for the init calls.">_lspmac_motor_init</a>( d, <span class="stringliteral">&quot;fastShutter&quot;</span>);</div>
<div class="line"></div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a38b6eee046c3ceff84f908af3335ebcf" title="function to move the motor">moveAbs</a>           = <a class="code" href="lspmac_8c.html#adafed595ff5fcd7667175a9e730dbb8d" title="Move method for the fast shutter.">lspmac_moveabs_fshut_queue</a>;</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#ac62692eb939c04ca35e939d1c3acfe8f" title="method to read the motor status and position">read</a>              = <a class="code" href="lspmac_8c.html#ab81f07dea6bb0e88103a05a380de1034" title="Fast shutter read routine The shutter is mildly complicated in that we need to take into account the ...">lspmac_shutter_read</a>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> d;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adb46b594a6926134322186a3c85df37d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_get_ascii </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Forward declarateion. </p>
<p>Request the ascii buffers from the PMAC. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01935">1935</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                    {</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>, <a class="code" href="lspmac_8c.html#af9c53e7c5b2681a5ca1c5410a914a2dc">VR_PMAC_GETMEM</a>, 0x0e9c, 0, <span class="keyword">sizeof</span>(<a class="code" href="structlspmac__ascii__buffers__struct.html">lspmac_ascii_buffers_t</a>), NULL, <a class="code" href="lspmac_8c.html#afd2f9e53bb838d0d9d898948877f1104" title="service the ascii buffer request response">lspmac_get_ascii_cb</a>, 0, event);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="afd2f9e53bb838d0d9d898948877f1104"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_get_ascii_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nreceived</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buff</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>service the ascii buffer request response </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01827">1827</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                                            {</div>
<div class="line">  uint32_t clrdata;</div>
<div class="line">  <span class="keywordtype">int</span> need_more;</div>
<div class="line"></div>
<div class="line">  need_more = 0;</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#a2ff142105e17d933871d09759e7082f8" title="Keep too many processes from sending commands at once.">lspmac_ascii_mutex</a>);</div>
<div class="line">  memcpy( &amp;<a class="code" href="lspmac_8c.html#a859f81d68defff3836a94afd5ef38e9a">lspmac_ascii_buffers</a>, buff, <span class="keyword">sizeof</span>(<a class="code" href="lspmac_8c.html#a859f81d68defff3836a94afd5ef38e9a">lspmac_ascii_buffers</a>));</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// The response is not ready yet</span></div>
<div class="line">  <span class="comment">// This will be an infinite loop if we queue a command that does not</span></div>
<div class="line">  <span class="comment">// produce a response.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Quoted comments below from Delta Tau &quot;Turbo PMAC User Manual 9/12/2008, page 422&quot;</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// &quot;1.  Wait for the Host-Input Control Word at 0x0F40 (Y:$063D0) to become greater than 0, indicating</span></div>
<div class="line">  <span class="comment">// that a response line is ready.&quot;</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#a859f81d68defff3836a94afd5ef38e9a">lspmac_ascii_buffers</a>.<a class="code" href="structlspmac__ascii__buffers__struct.html#ae1d37cf9568478c9d8dad540ce77183c">response_buf</a> == 0) {</div>
<div class="line">    need_more = 1;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="keywordflow">if</span>( (<a class="code" href="lspmac_8c.html#a859f81d68defff3836a94afd5ef38e9a">lspmac_ascii_buffers</a>.<a class="code" href="structlspmac__ascii__buffers__struct.html#ae1d37cf9568478c9d8dad540ce77183c">response_buf</a> &amp; 0x8000) != 0) {</div>
<div class="line">      <span class="keywordtype">char</span> bcd1, bcd2, bcd3;</div>
<div class="line">      <span class="keywordtype">int</span> errcode;</div>
<div class="line">      <span class="comment">// Error response</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// &quot;2.  Interpret the value in this register to determine what</span></div>
<div class="line">      <span class="comment">// type of response is present. If Bit 15 is 1, Turbo PMAC is</span></div>
<div class="line">      <span class="comment">// reporting an error in the command, and there is no response</span></div>
<div class="line">      <span class="comment">// other than this word. In this case, Bits 0  11 encode the</span></div>
<div class="line">      <span class="comment">// error number for the command as 3 BCD digits.&quot;</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      need_more = 0;</div>
<div class="line">      bcd1 = <a class="code" href="lspmac_8c.html#a859f81d68defff3836a94afd5ef38e9a">lspmac_ascii_buffers</a>.<a class="code" href="structlspmac__ascii__buffers__struct.html#ae1d37cf9568478c9d8dad540ce77183c">response_buf</a>  &amp; 0x000f;</div>
<div class="line">      bcd2 = (<a class="code" href="lspmac_8c.html#a859f81d68defff3836a94afd5ef38e9a">lspmac_ascii_buffers</a>.<a class="code" href="structlspmac__ascii__buffers__struct.html#ae1d37cf9568478c9d8dad540ce77183c">response_buf</a> &amp; 0x00f0) &gt;&gt; 4;</div>
<div class="line">      bcd3 = (<a class="code" href="lspmac_8c.html#a859f81d68defff3836a94afd5ef38e9a">lspmac_ascii_buffers</a>.<a class="code" href="structlspmac__ascii__buffers__struct.html#ae1d37cf9568478c9d8dad540ce77183c">response_buf</a> &amp; 0x0f00) &gt;&gt; 8;</div>
<div class="line">      errcode = (bcd3 * 10 + bcd2) * 10 + bcd1;</div>
<div class="line">      </div>
<div class="line">      <span class="keywordflow">if</span>( errcode &gt;= <span class="keyword">sizeof</span>( <a class="code" href="lspmac_8c.html#aab5a76f1ac64049314f9836e5c01fb7e" title="Decode the errors perhaps returned by the PMAC.">pmac_error_strs</a>)/<span class="keyword">sizeof</span>( *pmac_error_strs))</div>
<div class="line">        errcode = 0;</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_get_ascii_cb: Error returned for %s: %s&quot;</span>, <a class="code" href="lspmac_8c.html#a859f81d68defff3836a94afd5ef38e9a">lspmac_ascii_buffers</a>.<a class="code" href="structlspmac__ascii__buffers__struct.html#abe6a433dd9be4781dbf7e31d16484a4b">command_str</a>, <a class="code" href="lspmac_8c.html#aab5a76f1ac64049314f9836e5c01fb7e" title="Decode the errors perhaps returned by the PMAC.">pmac_error_strs</a>[errcode]);</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Command not allowed during program execution.</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Requeue it;</span></div>
<div class="line">      <span class="keywordflow">if</span>( errcode == 1) {</div>
<div class="line">        <a class="code" href="lspmac_8c.html#a9b0d9e2c858f6f0178be2bfdd96d4c05">lspmac_dpascii_off</a>--;</div>
<div class="line">      }</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// &quot;3.  Read the response string starting at 0x0F44</span></div>
<div class="line">      <span class="comment">// (Y:$0603D1). Two 8-bit characters are packed into each 16-bit</span></div>
<div class="line">      <span class="comment">// word; the first character is placed into the low</span></div>
<div class="line">      <span class="comment">// byte. Subsequent characters are placed into consecutive</span></div>
<div class="line">      <span class="comment">// higher addresses, two per 16-bit word. (In byte addressing,</span></div>
<div class="line">      <span class="comment">// each character is read from an address one higher than the</span></div>
<div class="line">      <span class="comment">// preceding character.) Up to 255 characters can be sent in a</span></div>
<div class="line">      <span class="comment">// single response line. The string is terminated with the NULL</span></div>
<div class="line">      <span class="comment">// character (byte value 0), convenient for C-style string</span></div>
<div class="line">      <span class="comment">// handling. For Pascal-style string handling, the register at</span></div>
<div class="line">      <span class="comment">// 0x0F42 (X:$0603D0) contains the number of characters in the</span></div>
<div class="line">      <span class="comment">// string (plus one).&quot;</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#a859f81d68defff3836a94afd5ef38e9a">lspmac_ascii_buffers</a>.<a class="code" href="structlspmac__ascii__buffers__struct.html#a97c2fdd21eec29c2cba993e361c3c069">response_n</a> &gt; 1)</div>
<div class="line">        <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_get_ascii_cb: &#39;%s&#39;   &#39;%s&#39;&quot;</span>, <a class="code" href="lspmac_8c.html#a859f81d68defff3836a94afd5ef38e9a">lspmac_ascii_buffers</a>.<a class="code" href="structlspmac__ascii__buffers__struct.html#abe6a433dd9be4781dbf7e31d16484a4b">command_str</a>, <a class="code" href="lspmac_8c.html#a859f81d68defff3836a94afd5ef38e9a">lspmac_ascii_buffers</a>.<a class="code" href="structlspmac__ascii__buffers__struct.html#a32c4baecf20143eb71d348b6b5679039">response_str</a>);</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_get_ascii_cb: &#39;%s&#39;   responded&quot;</span>, <a class="code" href="lspmac_8c.html#a859f81d68defff3836a94afd5ef38e9a">lspmac_ascii_buffers</a>.<a class="code" href="structlspmac__ascii__buffers__struct.html#abe6a433dd9be4781dbf7e31d16484a4b">command_str</a>);</div>
<div class="line"></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// 5.  &quot;If Bits 0  7 of the Host-Input Control Word had</span></div>
<div class="line">      <span class="comment">// contained the value $0D (13 decimal, CR), this was not the</span></div>
<div class="line">      <span class="comment">// last line in the response, and steps 1  4 should be</span></div>
<div class="line">      <span class="comment">// repeated. If they had contained the value $06 (6 decimal,</span></div>
<div class="line">      <span class="comment">// ACK), this was the last line in the response.&quot;</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="keywordflow">if</span>( (<a class="code" href="lspmac_8c.html#a859f81d68defff3836a94afd5ef38e9a">lspmac_ascii_buffers</a>.<a class="code" href="structlspmac__ascii__buffers__struct.html#ae1d37cf9568478c9d8dad540ce77183c">response_buf</a> &amp; 0x00ff) == 0x0d) {</div>
<div class="line">        need_more = 1;</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        need_more = 0;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span>( cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#ace4d453ad6d6225e910dffb33cde866a" title="event name to send">event</a> != NULL &amp;&amp; *(cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#ace4d453ad6d6225e910dffb33cde866a" title="event name to send">event</a>) != 0)</div>
<div class="line">          <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s command accepted&quot;</span>, cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#ace4d453ad6d6225e910dffb33cde866a" title="event name to send">event</a>);</div>
<div class="line">      }</div>
<div class="line">    } </div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#a2ff142105e17d933871d09759e7082f8" title="Keep too many processes from sending commands at once.">lspmac_ascii_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Reset the buffer flags and, perhaps, requeue a request</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// &quot;4.  Clear the Host-Input Control Word at 0x0F40 (Y:$063D0)</span></div>
<div class="line">  <span class="comment">// to 0. Turbo PMAC will not send another response line until it sees</span></div>
<div class="line">  <span class="comment">// this register set to 0.&quot;</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  clrdata = 0;          <span class="comment">// set the control word to zero</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( need_more) {</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>, <a class="code" href="lspmac_8c.html#ab79207cc3145740f8c070a24c91b11e0">VR_PMAC_SETMEM</a>, 0x0f40, 0, 4, (<span class="keywordtype">char</span> *)&amp;clrdata, <a class="code" href="lspmac_8c.html#a039af7c2d8d90cf24c2a8840f7402999" title="we are expecting more characters from the DPRAM ASCII interface">lspmac_more_ascii_cb</a>, 1, NULL);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>, <a class="code" href="lspmac_8c.html#ab79207cc3145740f8c070a24c91b11e0">VR_PMAC_SETMEM</a>, 0x0f40, 0, 4, (<span class="keywordtype">char</span> *)&amp;clrdata, NULL, 1, NULL);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#afb9e57459496c33e0da5cdb773113a61" title="flag for condition to wait for">lspmac_ascii_busy</a> = 0;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6dedca923b3a6904395ad02158e2e96f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_get_status </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Request a status update from the PMAC. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01815">1815</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                         {</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>, <a class="code" href="lspmac_8c.html#af9c53e7c5b2681a5ca1c5410a914a2dc">VR_PMAC_GETMEM</a>, 0x400, 0, <span class="keyword">sizeof</span>(<a class="code" href="structmd2StatusStruct.html" title="The block of memory retrieved in a status request.">md2_status_t</a>), NULL, <a class="code" href="lspmac_8c.html#a5f9772f2a907b40a464c02977c7a8c87" title="Service routing for status upate This updates positions and status information.">lspmac_get_status_cb</a>, 0, NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5f9772f2a907b40a464c02977c7a8c87"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_get_status_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nreceived</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buff</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Service routing for status upate This updates positions and status information. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cmd</td><td>The command that generated this reply </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nreceived</td><td>Number of bytes received </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">buff</td><td>The Big Byte Buffer </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01591">1591</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                            {</div>
<div class="line"><span class="preprocessor">  #ifdef SHOW_RATE</span></div>
<div class="line"><span class="preprocessor"></span>  <span class="keyword">static</span> <span class="keyword">struct </span>timespec ts1;</div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">struct </span>timespec ts2;</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> cnt = 0;</div>
<div class="line"><span class="preprocessor">  #endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">  <a class="code" href="structlspmac__bi__struct.html" title="Storage for binary inputs.">lspmac_bi_t</a>    *bp;</div>
<div class="line"></div>
<div class="line">  clock_gettime( CLOCK_REALTIME, &amp;<a class="code" href="lspmac_8c.html#ae3bf4c21e9e375862e5a955b539fb073" title="Time the status was read.">lspmac_status_time</a>);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">  #ifdef SHOW_RATE</span></div>
<div class="line"><span class="preprocessor"></span>  <span class="keywordflow">if</span>( cnt == 0) {</div>
<div class="line">    clock_gettime( CLOCK_REALTIME, &amp;ts1);</div>
<div class="line">  }</div>
<div class="line"><span class="preprocessor">  #endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#a7a3e763682bd7f987d07f149e94b3bf8" title="Synchronize reading/writting status buffer.">md2_status_mutex</a>);</div>
<div class="line">  memcpy( &amp;<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>, buff, <span class="keyword">sizeof</span>(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>));</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Note that we are the only thread that writes to md2_status</span></div>
<div class="line">  <span class="comment">// so we no longer need the lock to read.  Other threads must</span></div>
<div class="line">  <span class="comment">// lock the mutex to read md2_status.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#a7a3e763682bd7f987d07f149e94b3bf8" title="Synchronize reading/writting status buffer.">md2_status_mutex</a>);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// track the coordinate system moving flags</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#aac82f8e97fa39ea9be7823dd1d308986">moving_flags</a> != <a class="code" href="lspmac_8c.html#a7a32c617c183166308241e270959df56" title="Flag used to implement motor moving condition.">lspmac_moving_flags</a>) {</div>
<div class="line">    <span class="keywordtype">int</span> mask;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_get_status_cb: new moving flag: %0x&quot;</span>, <a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#aac82f8e97fa39ea9be7823dd1d308986">moving_flags</a>);</div>
<div class="line">    mask = 1;</div>
<div class="line">    <span class="keywordflow">for</span>( i=1; i&lt;=16; i++, mask &lt;&lt;= 1) {</div>
<div class="line">      <span class="keywordflow">if</span>( ((<a class="code" href="lspmac_8c.html#a7a32c617c183166308241e270959df56" title="Flag used to implement motor moving condition.">lspmac_moving_flags</a> &amp; mask) != 0) &amp;&amp; ((<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#aac82f8e97fa39ea9be7823dd1d308986">moving_flags</a> &amp; mask) == 0)) {</div>
<div class="line">        <span class="comment">// Falling edge: send event</span></div>
<div class="line">        <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;Coordsys %d Stopped&quot;</span>, i);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a7a32c617c183166308241e270959df56" title="Flag used to implement motor moving condition.">lspmac_moving_flags</a> = <a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#aac82f8e97fa39ea9be7823dd1d308986">moving_flags</a>;</div>
<div class="line">    pthread_cond_signal( &amp;<a class="code" href="lspmac_8c.html#a57547d211906c981ef20257eba99f8df" title="Wait for motor(s) to finish moving condition.">lspmac_moving_cond</a>);</div>
<div class="line">  }</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Read the motor positions</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;<a class="code" href="lspmac_8c.html#a56260f012c50a591ee7f97e500f16994" title="The number of motors we manage.">lspmac_nmotors</a>; i++) {</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>].<a class="code" href="structlspmac__motor__struct.html#ac62692eb939c04ca35e939d1c3acfe8f" title="method to read the motor status and position">read</a>(&amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[i]));</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Read the binary inputs and perhaps send an event</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;<a class="code" href="lspmac_8c.html#a33c5ed169a5437cb59ab904ffa3e3ffe" title="number of active binary inputs">lspmac_nbis</a>; i++) {</div>
<div class="line">    bp = &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>]);</div>
<div class="line">    </div>
<div class="line">    pthread_mutex_lock( &amp;(bp-&gt;<a class="code" href="structlspmac__bi__struct.html#a58053a98fa4696b56d674e775b3b4690" title="so we don&#39;t get confused">mutex</a>));</div>
<div class="line"></div>
<div class="line">    bp-&gt;<a class="code" href="structlspmac__bi__struct.html#a76c4627028b86141c101f1764bebb7b0" title="the current value.">position</a> = (*(bp-&gt;<a class="code" href="structlspmac__bi__struct.html#ae201bf05130bcb6985704ea42efabeb3" title="points to the location in the status buffer">ptr</a>) &amp; bp-&gt;<a class="code" href="structlspmac__bi__struct.html#ac010058c9883088705059dee1d90ee72" title="mask for the bit in the status register">mask</a>) == 0 ? 0 : 1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( bp-&gt;<a class="code" href="structlspmac__bi__struct.html#a814978c33dc99e7911faa4ddb12bfd90" title="flag indicating we&#39;ve not read the input even once">first_time</a>) {</div>
<div class="line">      bp-&gt;<a class="code" href="structlspmac__bi__struct.html#a814978c33dc99e7911faa4ddb12bfd90" title="flag indicating we&#39;ve not read the input even once">first_time</a> = 0;</div>
<div class="line">      <span class="keywordflow">if</span>( bp-&gt;<a class="code" href="structlspmac__bi__struct.html#a76c4627028b86141c101f1764bebb7b0" title="the current value.">position</a>==1 &amp;&amp; bp-&gt;<a class="code" href="structlspmac__bi__struct.html#ae7178007dfdf21be0e5b1fbaa36732af" title="Event to send when the value changes to 1.">changeEventOn</a> != NULL &amp;&amp; bp-&gt;<a class="code" href="structlspmac__bi__struct.html#ae7178007dfdf21be0e5b1fbaa36732af" title="Event to send when the value changes to 1.">changeEventOn</a>[0] != 0)</div>
<div class="line">        <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[i].changeEventOn);</div>
<div class="line">      <span class="keywordflow">if</span>( bp-&gt;<a class="code" href="structlspmac__bi__struct.html#a76c4627028b86141c101f1764bebb7b0" title="the current value.">position</a>==0 &amp;&amp; bp-&gt;<a class="code" href="structlspmac__bi__struct.html#ae0859842f637694ace0e6d54c0e2af6a" title="Event to send when the value changes to 0.">changeEventOff</a> != NULL &amp;&amp; bp-&gt;<a class="code" href="structlspmac__bi__struct.html#ae0859842f637694ace0e6d54c0e2af6a" title="Event to send when the value changes to 0.">changeEventOff</a>[0] != 0)</div>
<div class="line">        <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[i].changeEventOff);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <span class="keywordflow">if</span>( bp-&gt;<a class="code" href="structlspmac__bi__struct.html#a76c4627028b86141c101f1764bebb7b0" title="the current value.">position</a> != bp-&gt;<a class="code" href="structlspmac__bi__struct.html#a00f09cb3d7bdbe1058fb56bb8c2b0fa3" title="the previous value">previous</a>) {</div>
<div class="line">        <span class="keywordflow">if</span>( bp-&gt;<a class="code" href="structlspmac__bi__struct.html#a76c4627028b86141c101f1764bebb7b0" title="the current value.">position</a>==1 &amp;&amp; bp-&gt;<a class="code" href="structlspmac__bi__struct.html#ae7178007dfdf21be0e5b1fbaa36732af" title="Event to send when the value changes to 1.">changeEventOn</a> != NULL &amp;&amp; bp-&gt;<a class="code" href="structlspmac__bi__struct.html#ae7178007dfdf21be0e5b1fbaa36732af" title="Event to send when the value changes to 1.">changeEventOn</a>[0] != 0)</div>
<div class="line">          <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[i].changeEventOn);</div>
<div class="line">        <span class="keywordflow">if</span>(bp-&gt;<a class="code" href="structlspmac__bi__struct.html#a76c4627028b86141c101f1764bebb7b0" title="the current value.">position</a>==0 &amp;&amp; bp-&gt;<a class="code" href="structlspmac__bi__struct.html#ae0859842f637694ace0e6d54c0e2af6a" title="Event to send when the value changes to 0.">changeEventOff</a> != NULL &amp;&amp; bp-&gt;<a class="code" href="structlspmac__bi__struct.html#ae0859842f637694ace0e6d54c0e2af6a" title="Event to send when the value changes to 0.">changeEventOff</a>[0] != 0)</div>
<div class="line">          <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[i].changeEventOff);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    bp-&gt;<a class="code" href="structlspmac__bi__struct.html#a00f09cb3d7bdbe1058fb56bb8c2b0fa3" title="the previous value">previous</a> = bp-&gt;<a class="code" href="structlspmac__bi__struct.html#a76c4627028b86141c101f1764bebb7b0" title="the current value.">position</a>;</div>
<div class="line">    pthread_mutex_unlock( &amp;(bp-&gt;<a class="code" href="structlspmac__bi__struct.html#a58053a98fa4696b56d674e775b3b4690" title="so we don&#39;t get confused">mutex</a>));</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// acc11c_1   INPUTS</span></div>
<div class="line">  <span class="comment">// mask  bit</span></div>
<div class="line">  <span class="comment">// 0x01  0    M1000   Air pressure OK</span></div>
<div class="line">  <span class="comment">// 0x02  1    M1001   Air bearing OK</span></div>
<div class="line">  <span class="comment">// 0x04  2    M1002   Cryo switch</span></div>
<div class="line">  <span class="comment">// 0x08  3    M1003   Backlight Down</span></div>
<div class="line">  <span class="comment">// 0x10  4    M1004   Backlight Up</span></div>
<div class="line">  <span class="comment">// 0x20  5</span></div>
<div class="line">  <span class="comment">// 0x40  6    M1006   Cryo is back</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// acc11c_2   INPUTS</span></div>
<div class="line">  <span class="comment">// mask  bit</span></div>
<div class="line">  <span class="comment">// 0x01  0    M1008   Fluor Dector back</span></div>
<div class="line">  <span class="comment">// 0x02  1    M1009   Sample Detected</span></div>
<div class="line">  <span class="comment">// 0x04  2    M1020   {SC load request}</span></div>
<div class="line">  <span class="comment">// 0x08  3    M1021   {SC move cryo back request}</span></div>
<div class="line">  <span class="comment">// 0x10  4    M1022   {SC sample magnet control}</span></div>
<div class="line">  <span class="comment">// 0x20  5    M1013   Etel Ready</span></div>
<div class="line">  <span class="comment">// 0x40  6    M1014   Etel On</span></div>
<div class="line">  <span class="comment">// 0x80  7    M1015   Etel Init OK</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ad186f06cb4670b00b8af8264d1da66a4">acc11c_2</a> &amp; 0x01)</div>
<div class="line">    mvwprintw( <a class="code" href="pgpmac_8c.html#ae2d7da3afeb756716e6e4ee9cab78f8a" title="shutter, lamp, air, etc status">term_status2</a>, 3, 10, <span class="stringliteral">&quot;%*s&quot;</span>, -8, <span class="stringliteral">&quot;Fluor Out&quot;</span>);</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    mvwprintw( <a class="code" href="pgpmac_8c.html#ae2d7da3afeb756716e6e4ee9cab78f8a" title="shutter, lamp, air, etc status">term_status2</a>, 3, 10, <span class="stringliteral">&quot;%*s&quot;</span>, -8, <span class="stringliteral">&quot;Fluor In&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ab09c1342dc12052b8f5b35f78ef95000">acc11c_5</a> &amp; 0x08)</div>
<div class="line">    mvwprintw( <a class="code" href="pgpmac_8c.html#ae2d7da3afeb756716e6e4ee9cab78f8a" title="shutter, lamp, air, etc status">term_status2</a>, 4, 1, <span class="stringliteral">&quot;%*s&quot;</span>, -(<a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2), <span class="stringliteral">&quot;Dryer On&quot;</span>);</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    mvwprintw( <a class="code" href="pgpmac_8c.html#ae2d7da3afeb756716e6e4ee9cab78f8a" title="shutter, lamp, air, etc status">term_status2</a>, 4, 1, <span class="stringliteral">&quot;%*s&quot;</span>, -(<a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2), <span class="stringliteral">&quot;Dryer Off&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ad186f06cb4670b00b8af8264d1da66a4">acc11c_2</a> &amp; 0x02)</div>
<div class="line">    mvwprintw( <a class="code" href="pgpmac_8c.html#ae2d7da3afeb756716e6e4ee9cab78f8a" title="shutter, lamp, air, etc status">term_status2</a>, 2, 1, <span class="stringliteral">&quot;%*s&quot;</span>, -(<a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2), <span class="stringliteral">&quot;Cap Dectected&quot;</span>);</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    mvwprintw( <a class="code" href="pgpmac_8c.html#ae2d7da3afeb756716e6e4ee9cab78f8a" title="shutter, lamp, air, etc status">term_status2</a>, 2, 1, <span class="stringliteral">&quot;%*s&quot;</span>, -(<a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2), <span class="stringliteral">&quot;Cap Not Dectected&quot;</span>);</div>
<div class="line">  wnoutrefresh( <a class="code" href="pgpmac_8c.html#ae2d7da3afeb756716e6e4ee9cab78f8a" title="shutter, lamp, air, etc status">term_status2</a>);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// acc11c_3   INPUTS</span></div>
<div class="line">  <span class="comment">// mask  bit</span></div>
<div class="line">  <span class="comment">// 0x01  0    M1025   Minikappa OK</span></div>
<div class="line">  <span class="comment">// 0x02  1    M1023   {SC unload request}</span></div>
<div class="line">  <span class="comment">// 0x04  2    M1024   Smartmagnet is on (note in pmc saying this is not used in VB interface)</span></div>
<div class="line">  <span class="comment">// 0x08  3    M1027   Arm Parked</span></div>
<div class="line">  <span class="comment">// 0x10  4    M1031   Smartmagnet error (coil is broken)</span></div>
<div class="line">  <span class="comment">// 0x20  5</span></div>
<div class="line">  <span class="comment">// 0x40  6</span></div>
<div class="line">  <span class="comment">// 0x80  7</span></div>
<div class="line">  <span class="comment">// 0x100 8    M1048   Shutter is open (note in pmc says: slow input !!!)</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">// acc11c_4   INPUTS</span></div>
<div class="line">  <span class="comment">// mask  bit</span></div>
<div class="line">  <span class="comment">// 0x01  0    M1031   {laser mirror is back}</span></div>
<div class="line">  <span class="comment">// 0x02  1    M1032   {laser PSS OK}</span></div>
<div class="line">  <span class="comment">// 0x04  2    M1033   {laser shutter open}</span></div>
<div class="line"></div>
<div class="line">  </div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// acc11c_5   OUTPUTS</span></div>
<div class="line">  <span class="comment">// mask  bit</span></div>
<div class="line">  <span class="comment">// 0x01  0    M1100   Mag Off</span></div>
<div class="line">  <span class="comment">// 0x02  1    M1191   Condenser Out</span></div>
<div class="line">  <span class="comment">// 0x04  2    M1102   Cryo Back</span></div>
<div class="line">  <span class="comment">// 0x08  3    M1103   Dryer On</span></div>
<div class="line">  <span class="comment">// 0x10  4    M1104   FluoDet Out</span></div>
<div class="line">  <span class="comment">// 0x20  5    M1105   {smartmagnet on/off: note in pmc says this is not used}</span></div>
<div class="line">  <span class="comment">// 0x40  6    M1106   1=SmartMag, 0=Permanent Mag</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ab09c1342dc12052b8f5b35f78ef95000">acc11c_5</a> &amp; 0x04)</div>
<div class="line">    mvwprintw( <a class="code" href="pgpmac_8c.html#ae2d7da3afeb756716e6e4ee9cab78f8a" title="shutter, lamp, air, etc status">term_status2</a>, 3, 1, <span class="stringliteral">&quot;%*s&quot;</span>, -8, <span class="stringliteral">&quot;Cryo Out&quot;</span>);</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    mvwprintw( <a class="code" href="pgpmac_8c.html#ae2d7da3afeb756716e6e4ee9cab78f8a" title="shutter, lamp, air, etc status">term_status2</a>, 3, 1, <span class="stringliteral">&quot;%*s&quot;</span>, -8, <span class="stringliteral">&quot;Cryo In &quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// acc11c_6   OUTPUTS</span></div>
<div class="line">  <span class="comment">// mask   bit</span></div>
<div class="line">  <span class="comment">// 0x0001   0 M1040   {SC Sample transfer is on}</span></div>
<div class="line">  <span class="comment">// 0x0002   1</span></div>
<div class="line">  <span class="comment">// 0x0004   2</span></div>
<div class="line">  <span class="comment">// 0x0008   3</span></div>
<div class="line">  <span class="comment">// 0x0010   4</span></div>
<div class="line">  <span class="comment">// 0x0020   5</span></div>
<div class="line">  <span class="comment">// 0x0040   6</span></div>
<div class="line">  <span class="comment">// 0x0080   7 M1115   Etel Enable</span></div>
<div class="line">  <span class="comment">// 0x0100   8 M1124   Fast Shutter Enable</span></div>
<div class="line">  <span class="comment">// 0x0200   9 M1125   Fast Shutter Manual Enable</span></div>
<div class="line">  <span class="comment">// 0x0400  10 M1126   Fast Shutter On</span></div>
<div class="line">  <span class="comment">// 0x0800  11  </span></div>
<div class="line">  <span class="comment">// 0x1000  12 M1128   ADC1 gain bit 0</span></div>
<div class="line">  <span class="comment">// 0x2000  13 M1129   ADC1 gain bit 1</span></div>
<div class="line">  <span class="comment">// 0x4000  14 M1130   ADC2 gain bit 0</span></div>
<div class="line">  <span class="comment">// 0x8000  15 M1131   ADC2 gain bit 1</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ab09c1342dc12052b8f5b35f78ef95000">acc11c_5</a> &amp; 0x02)</div>
<div class="line">    mvwprintw( <a class="code" href="pgpmac_8c.html#ae746a6903fb8a4ea216def88eccedc3c" title="shutter, lamp, air, etc status">term_status</a>,  3, 1, <span class="stringliteral">&quot;%*s&quot;</span>, -(<a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2), <span class="stringliteral">&quot;Backlight Up&quot;</span>);</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    mvwprintw( <a class="code" href="pgpmac_8c.html#ae746a6903fb8a4ea216def88eccedc3c" title="shutter, lamp, air, etc status">term_status</a>,  3, 1, <span class="stringliteral">&quot;%*s&quot;</span>, -(<a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2), <span class="stringliteral">&quot;Backlight Down&quot;</span>);</div>
<div class="line"></div>
<div class="line">  mvwprintw( <a class="code" href="pgpmac_8c.html#ae746a6903fb8a4ea216def88eccedc3c" title="shutter, lamp, air, etc status">term_status</a>, 4, 1, <span class="stringliteral">&quot;Front: %*u&quot;</span>, <a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2-8, (<span class="keywordtype">int</span>)<a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a>);</div>
<div class="line">  mvwprintw( <a class="code" href="pgpmac_8c.html#ae746a6903fb8a4ea216def88eccedc3c" title="shutter, lamp, air, etc status">term_status</a>, 5, 1, <span class="stringliteral">&quot;Back: %*u&quot;</span>, <a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2-7,  (<span class="keywordtype">int</span>)<a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a>);</div>
<div class="line">  mvwprintw( <a class="code" href="pgpmac_8c.html#ae746a6903fb8a4ea216def88eccedc3c" title="shutter, lamp, air, etc status">term_status</a>, 6, 1, <span class="stringliteral">&quot;Piezo: %*u&quot;</span>, <a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2-8, (<span class="keywordtype">int</span>)<a class="code" href="lspmac_8c.html#a8a3ca6fcf5e24dcc26170736843e53b2" title="Scintillator Piezo DAC.">fscint</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a>);</div>
<div class="line">  wnoutrefresh( <a class="code" href="pgpmac_8c.html#ae746a6903fb8a4ea216def88eccedc3c" title="shutter, lamp, air, etc status">term_status</a>);</div>
<div class="line"></div>
<div class="line">  wnoutrefresh( <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>);</div>
<div class="line">  doupdate();</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">  #ifdef SHOW_RATE</span></div>
<div class="line"><span class="preprocessor"></span>  <span class="keywordflow">if</span>( ++cnt % 1000 == 0) {</div>
<div class="line">    <span class="keywordtype">long</span> diff_sec;</div>
<div class="line">    <span class="keywordtype">long</span> diff_nsec;</div>
<div class="line"></div>
<div class="line">    clock_gettime( CLOCK_REALTIME, &amp;ts2);</div>
<div class="line"></div>
<div class="line">    diff_sec  = ts2.tv_sec  - ts1.tv_sec;</div>
<div class="line">    diff_nsec = ts2.tv_nsec - ts1.tv_nsec;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( diff_nsec &lt; 0) {</div>
<div class="line">      diff_nsec += 1000000000;</div>
<div class="line">      diff_sec--;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Refresh Rate: %0.1f Hz&quot;</span>, (<span class="keywordtype">double</span>)cnt / (diff_sec + diff_nsec/1000000000.));</div>
<div class="line"></div>
<div class="line">    cnt = 0;</div>
<div class="line">  }</div>
<div class="line"><span class="preprocessor">  #endif</span></div>
<div class="line"><span class="preprocessor"></span>}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac24bdffa893a9bf7c9cb084fe1417f6f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_GetAllIVars </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Request the values of all the I variables. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02049">2049</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">char</span> *cmds = <span class="stringliteral">&quot;I0..8191&quot;</span>;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#af24ecdc10723dc8fd6320fef416ae514">VR_DOWNLOAD</a>, <a class="code" href="lspmac_8c.html#a772b2ea2ad93989ae4275c79a93525ee">VR_PMAC_SENDLINE</a>, 0, 0, strlen( cmds), cmds, <a class="code" href="lspmac_8c.html#a049ea733ada1148fda6fc84a3edfa69b" title="Receive the values of all the I variables Update our Postgresql database with the results...">lspmac_GetAllIVarsCB</a>, 0, NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a049ea733ada1148fda6fc84a3edfa69b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_GetAllIVarsCB </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nreceived</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buff</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Receive the values of all the I variables Update our Postgresql database with the results. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cmd</td><td>The command that gave this response </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nreceived</td><td>Number of bytes received </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">buff</td><td>The byte buffer </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02032">2032</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                            {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">char</span> qs[<a class="code" href="kvredis_8c.html#a3a8ef1b4b5994d6dd12bf74454ea891b">LS_PG_QUERY_STRING_LENGTH</a>];</div>
<div class="line">  <span class="keywordtype">char</span> *sp;</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">  <span class="keywordflow">for</span>( i=0, sp=strtok(buff, <span class="stringliteral">&quot;\r&quot;</span>); sp != NULL; sp=strtok( NULL, <span class="stringliteral">&quot;\r&quot;</span>), i++) {</div>
<div class="line">    snprintf( qs, <span class="keyword">sizeof</span>( qs)-1, <span class="stringliteral">&quot;SELECT pmac.md2_ivar_set( %d, &#39;%s&#39;)&quot;</span>, i, sp);</div>
<div class="line">    qs[<span class="keyword">sizeof</span>( qs)-1]=0;</div>
<div class="line">    <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( NULL, qs);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a983d291506dc387ba5d71a97766e8a25"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_GetAllMVars </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Request the values of all the M variables. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02074">2074</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">char</span> *cmds = <span class="stringliteral">&quot;M0..8191-&gt;&quot;</span>;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#af24ecdc10723dc8fd6320fef416ae514">VR_DOWNLOAD</a>, <a class="code" href="lspmac_8c.html#a772b2ea2ad93989ae4275c79a93525ee">VR_PMAC_SENDLINE</a>, 0, 0, strlen( cmds), cmds, <a class="code" href="lspmac_8c.html#ad59c1c0489d28fbc33c0afc5c6f3c99b" title="Receive the values of all the M variables Update our database with the results.">lspmac_GetAllMVarsCB</a>, 0, NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad59c1c0489d28fbc33c0afc5c6f3c99b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_GetAllMVarsCB </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nreceived</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buff</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Receive the values of all the M variables Update our database with the results. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cmd</td><td>The command that started this </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nreceived</td><td>Number of bytes received </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">buff</td><td>Our byte buffer </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02057">2057</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                            {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">char</span> qs[<a class="code" href="kvredis_8c.html#a3a8ef1b4b5994d6dd12bf74454ea891b">LS_PG_QUERY_STRING_LENGTH</a>];</div>
<div class="line">  <span class="keywordtype">char</span> *sp;</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">  <span class="keywordflow">for</span>( i=0, sp=strtok(buff, <span class="stringliteral">&quot;\r&quot;</span>); sp != NULL; sp=strtok( NULL, <span class="stringliteral">&quot;\r&quot;</span>), i++) {</div>
<div class="line">    snprintf( qs, <span class="keyword">sizeof</span>( qs)-1, <span class="stringliteral">&quot;SELECT pmac.md2_mvar_set( %d, &#39;%s&#39;)&quot;</span>, i, sp);</div>
<div class="line">    qs[<span class="keyword">sizeof</span>( qs)-1]=0;</div>
<div class="line">    <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( NULL, qs);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af57fb3f335edcfd2adff8186e1efd458"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_getBIPosition </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td>
          <td class="paramname"><em>bip</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>get binary input value </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01579">1579</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                            {</div>
<div class="line">  <span class="keywordtype">int</span> rtn;</div>
<div class="line">  pthread_mutex_lock( &amp;bip-&gt;<a class="code" href="structlspmac__bi__struct.html#a58053a98fa4696b56d674e775b3b4690" title="so we don&#39;t get confused">mutex</a>);</div>
<div class="line">  rtn = bip-&gt;<a class="code" href="structlspmac__bi__struct.html#a76c4627028b86141c101f1764bebb7b0" title="the current value.">position</a>;</div>
<div class="line">  pthread_mutex_unlock( &amp;bip-&gt;<a class="code" href="structlspmac__bi__struct.html#a58053a98fa4696b56d674e775b3b4690" title="so we don&#39;t get confused">mutex</a>);</div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a825ba2feb0108b977c34872e24a6c827"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_Getmem </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Request a block of double buffer memory. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01112">1112</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                     {</div>
<div class="line">  <span class="keywordtype">int</span> nbytes;</div>
<div class="line">  nbytes = (<a class="code" href="lspmac_8c.html#aa0be2f26364c4d12c9c81c10913f0b26" title="next location">dbmemIn</a> + 1400 &gt; <span class="keyword">sizeof</span>( <a class="code" href="lspmac_8c.html#a9da2795d11ccbc3a060c4811770ad04c" title="double buffered memory">dbmem</a>)) ? <span class="keyword">sizeof</span>( <a class="code" href="lspmac_8c.html#a9da2795d11ccbc3a060c4811770ad04c" title="double buffered memory">dbmem</a>) - <a class="code" href="lspmac_8c.html#aa0be2f26364c4d12c9c81c10913f0b26" title="next location">dbmemIn</a> : 1400;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a0a56c777b1469ad8c3d29d825a71e300" title="Request a chunk of memory to be returned.">lspmac_SockGetmem</a>( <a class="code" href="lspmac_8c.html#aa0be2f26364c4d12c9c81c10913f0b26" title="next location">dbmemIn</a>, nbytes);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5e4b7bbfb008acbbad98accf18492f0b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_GetmemReplyCB </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nreceived</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buff</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Service a reply to the getmem command. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cmd</td><td>Queue item this is a reply to </td></tr>
    <tr><td class="paramname">nreceived</td><td>Number of bytes received </td></tr>
    <tr><td class="paramname">buff</td><td>Buffer of bytes recieved </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01038">1038</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                                             {</div>
<div class="line"></div>
<div class="line">  memcpy( &amp;(<a class="code" href="lspmac_8c.html#a9da2795d11ccbc3a060c4811770ad04c" title="double buffered memory">dbmem</a>[ntohs(cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#aec0ee9a5f6c7e3bc6e4bd98f1bd52783" title="Command parameter 1.">wValue</a>)]), buff, nreceived);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#aa0be2f26364c4d12c9c81c10913f0b26" title="next location">dbmemIn</a> += nreceived;</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#aa0be2f26364c4d12c9c81c10913f0b26" title="next location">dbmemIn</a> &gt;= <span class="keyword">sizeof</span>( <a class="code" href="lspmac_8c.html#a9da2795d11ccbc3a060c4811770ad04c" title="double buffered memory">dbmem</a>)) {</div>
<div class="line">    <a class="code" href="lspmac_8c.html#aa0be2f26364c4d12c9c81c10913f0b26" title="next location">dbmemIn</a> = 0;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="acc46bdddee59bd8c5ad662b3fd445e9f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double lspmac_getPosition </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>get the motor position (with locking) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mp</td><td>the motor object </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01339">1339</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                               {</div>
<div class="line">  <span class="keywordtype">double</span> rtn;</div>
<div class="line">  pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  rtn = mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a>;</div>
<div class="line">  pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a81e8e315099cf9b6eef0335b01f97bfd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_GetShortReplyCB </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nreceived</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buff</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Receive a reply that does not require multiple buffers. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cmd</td><td>Queue item this is a reply to </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nreceived</td><td>Number of bytes received </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">buff</td><td>The buffer of bytes </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00981">981</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                              {</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">char</span> *sp;     <span class="comment">// pointer to the command this is a reply to</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( nreceived &lt; 1400)</div>
<div class="line">    buff[nreceived]=0;</div>
<div class="line"></div>
<div class="line">  sp = (<span class="keywordtype">char</span> *)(cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( *buff == 0) {</div>
<div class="line">    pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);</div>
<div class="line">    wprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, <span class="stringliteral">&quot;%s\n&quot;</span>, sp);</div>
<div class="line">    pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);</div>
<div class="line">    wprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, <span class="stringliteral">&quot;%s: &quot;</span>, sp);</div>
<div class="line">    pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a8f9f1ad624350095075aa6b51423b02d" title="Replace \r with \n in null terminated string and print result to terminal.">cleanstr</a>( buff);</div>
<div class="line">  }</div>
<div class="line">  wnoutrefresh( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>);</div>
<div class="line">  wnoutrefresh( <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>);</div>
<div class="line">  doupdate();</div>
<div class="line"></div>
<div class="line">  memset( cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>, 0, <span class="keyword">sizeof</span>( cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9fbadf816a842c8f131cf8ee47b54e29"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_home1_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Home the motor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>motor we are concerned about </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01205">1205</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">  <span class="keywordtype">int</span> motor_num;</div>
<div class="line">  <span class="keywordtype">int</span> coord_num;</div>
<div class="line">  <span class="keywordtype">char</span> **home;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  motor_num = <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ad6a51cca3c7e5f79168e5c33fd9e736b" title="pmac motor number">motor_num</a>);</div>
<div class="line">  coord_num = <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a5614e003272e8323f8809bf7b6559532" title="coordinate system this motor belongs to (0 if none)">coord_num</a>);</div>
<div class="line">  home      = <a class="code" href="lsredis_8c.html#abe31d0e11c41b2235307612c963bb652">lsredis_get_string_array</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6dc1ceab86687f741d4c4a574501959c" title="pmac commands to home motor">home</a>);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Each of the motors should have this defined</span></div>
<div class="line">  <span class="comment">// but let&#39;s not seg fault if home is missing</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( home == NULL || *home == NULL) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Note we are already initialized</span></div>
<div class="line">    <span class="comment">// so if we are here there is something wrong.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_home1_queue: null or empty home strings for motor %s&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">    pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// We&#39;ve already been called.  Don&#39;t home again until</span></div>
<div class="line">  <span class="comment">// we&#39;re finish with the last time.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa74108855693f94fc2ff76333c9fb6ac" title="Homing routine started.">homing</a>) {</div>
<div class="line">    pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }    </div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Don&#39;t go on if any other motors in this coordinate system are homing.</span></div>
<div class="line">  <span class="comment">// It&#39;s possible to write the homing program to home all the motors in the coordinate</span></div>
<div class="line">  <span class="comment">// system.  TODO  (hint hint)</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( coord_num &gt; 0) {</div>
<div class="line">    <span class="keywordflow">for</span>( i=0; i&lt;<a class="code" href="lspmac_8c.html#a56260f012c50a591ee7f97e500f16994" title="The number of motors we manage.">lspmac_nmotors</a>; i++) {</div>
<div class="line">      <span class="keywordflow">if</span>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[i]) == mp)</div>
<div class="line">        <span class="keywordflow">continue</span>;</div>
<div class="line">      <span class="keywordflow">if</span>( <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[i].coord_num) == coord_num) {</div>
<div class="line">        <span class="keywordtype">int</span> nogo;</div>
<div class="line">        nogo = 0;</div>
<div class="line">        pthread_mutex_lock( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[i].mutex));</div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">//  Don&#39;t go on if</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">//    we are homing         or      ( not in position                while     in open loop)</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[i].homing || (((<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[i].status2 &amp; 0x01)==0) &amp;&amp; ((<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[i].status1 &amp; 0x040000) != 0)))</div>
<div class="line">          nogo = 1;</div>
<div class="line">        pthread_mutex_unlock( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[i].mutex));</div>
<div class="line">        <span class="keywordflow">if</span>( nogo) {</div>
<div class="line">          pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">          <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa74108855693f94fc2ff76333c9fb6ac" title="Homing routine started.">homing</a>   = 1;</div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a> = 1;     <span class="comment">// set up waiting for cond</span></div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a68c471836f52707fa8582f7860cf500f" title="set to 1 when motion has been verified to have started">motion_seen</a> = 0;</div>
<div class="line">  <span class="comment">// This opens the control loop.</span></div>
<div class="line">  <span class="comment">// The status routine should notice this and the fact that</span></div>
<div class="line">  <span class="comment">// the homing flag is set and call on the home2 routine</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Only send the open loop command if we are not in</span></div>
<div class="line">  <span class="comment">// open loop mode already.  This test might prevent a race condition</span></div>
<div class="line">  <span class="comment">// where we&#39;ve already moved the home2 routine (and queue the homing program motion)</span></div>
<div class="line">  <span class="comment">// before the open loop command is dequeued and acted on.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( ~(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#acb52b612b9237e8eec0b97fb1e76a35d" title="local copy of status1">status1</a>) &amp; 0x040000) {</div>
<div class="line">    <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, <span class="stringliteral">&quot;#%d$*&quot;</span>, motor_num);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s Homing&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a43e54631dc8de372854ebbb63ff28f70"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_home2_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Second stage of homing. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>motor we are concerned about </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01293">1293</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">char</span> **spp;</div>
<div class="line">  <span class="keywordtype">char</span> **home;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// At this point we are in open loop.</span></div>
<div class="line">  <span class="comment">// Run the motor specific commands</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  home = <a class="code" href="lsredis_8c.html#abe31d0e11c41b2235307612c963bb652">lsredis_get_string_array</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6dc1ceab86687f741d4c4a574501959c" title="pmac commands to home motor">home</a>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// We don&#39;t have any motors that have a null home text array so </span></div>
<div class="line">  <span class="comment">// there is currently no need to worry about this case other than</span></div>
<div class="line">  <span class="comment">// not to seg fault</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Also, Only go on if the first homing phase has been started</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( home == NULL || mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa74108855693f94fc2ff76333c9fb6ac" title="Homing routine started.">homing</a> != 1) {</div>
<div class="line">    pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span>( spp = home; *spp != NULL; spp++) {</div>
<div class="line"></div>
<div class="line">    pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);</div>
<div class="line">    wprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, <span class="stringliteral">&quot;home2 is queuing &#39;%s&#39;\n&quot;</span>, *spp);</div>
<div class="line">    wnoutrefresh( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>);</div>
<div class="line">    doupdate();</div>
<div class="line">    pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, *spp);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa74108855693f94fc2ff76333c9fb6ac" title="Homing routine started.">homing</a> = 2;</div>
<div class="line">  pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a236945579e57dbb30c0b64f5b9184e9d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_init </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ivarsflag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mvarsflag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize this module. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ivarsflag</td><td>Set global flag to harvest i variables </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mvarsflag</td><td>Set global flag to harvest m variables </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l03075">3075</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                   {</div>
<div class="line">  <a class="code" href="structmd2StatusStruct.html" title="The block of memory retrieved in a status request.">md2_status_t</a> *<a class="code" href="namespacemk__pgpmac__redis.html#a11daf2847f2dc94562b5b61b3f412574">p</a>;</div>
<div class="line">  pthread_mutexattr_t mutex_initializer;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Set our global harvest flags</span></div>
<div class="line">  <a class="code" href="lspmac_8c.html#a07b7b8254772075e6a4ced500b589c36" title="flag set at initialization to send i vars to db">getivars</a> = ivarsflag;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a50e9c0a06654fd81b3446a6e54ff12c3" title="flag set at initialization to send m vars to db">getmvars</a> = mvarsflag;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Use recursive mutexs</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  pthread_mutexattr_init( &amp;mutex_initializer);</div>
<div class="line">  pthread_mutexattr_settype( &amp;mutex_initializer, PTHREAD_MUTEX_RECURSIVE);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// All important status mutex</span></div>
<div class="line">  pthread_mutex_init( &amp;<a class="code" href="lspmac_8c.html#a7a3e763682bd7f987d07f149e94b3bf8" title="Synchronize reading/writting status buffer.">md2_status_mutex</a>, &amp;mutex_initializer);</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Get the MD2 initialization strings</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">//  lspmac_md2_init = lsredis_get_obj( &quot;md2_pmac.init&quot;);  // hard coded now.</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Initialize the motor objects</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  p = &amp;<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#a8237e646ce032a840637a4ef7bff49b9" title="MD2 omega axis (the air bearing)">omega</a>  = <a class="code" href="lspmac_8c.html#a939e8aae7c78a7d9f93f0ad198cc4463" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[ 0]), 0, 0, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a6ce303bec89082cae1e9b1fddf6b6c10">omega_act_pos</a>,     &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#af6cf3cd65b9ef205685a0d970f168907">omega_status_1</a>,     &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a8577c9df7b663b548b2759ac3db721cd">omega_status_2</a>,     <span class="stringliteral">&quot;Omega   #1 &amp;1 X&quot;</span>, <span class="stringliteral">&quot;omega&quot;</span>,       <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a6cb218bdccfe5a93471c161f15a15cab" title="Alignment stage X.">alignx</a> = <a class="code" href="lspmac_8c.html#a939e8aae7c78a7d9f93f0ad198cc4463" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[ 1]), 0, 1, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a9653a75bc0b66c5f86d8b0206dc39b4f">alignx_act_pos</a>,    &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a56accf8cb00c59bff87ed75df7dafbbe">alignx_status_1</a>,    &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a2feb35ceab8129fd2cc34d1104af8b8f">alignx_status_2</a>,    <span class="stringliteral">&quot;Align X #2 &amp;3 X&quot;</span>, <span class="stringliteral">&quot;align.x&quot;</span>,     <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a737c246c3948e644a18d191a931e1acd" title="Alignment stage Y.">aligny</a> = <a class="code" href="lspmac_8c.html#a939e8aae7c78a7d9f93f0ad198cc4463" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[ 2]), 0, 2, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a0d40a01d2aa93c443526e826440f77fc">aligny_act_pos</a>,    &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a2f2a11fe2fc7a446323def2be465185a">aligny_status_1</a>,    &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a1f98d8b9831e32d77129f9b0f1d7d255">aligny_status_2</a>,    <span class="stringliteral">&quot;Align Y #3 &amp;3 Y&quot;</span>, <span class="stringliteral">&quot;align.y&quot;</span>,     <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ae7642b1da0f7c7f8448104c691d40a12" title="Alignment stage X.">alignz</a> = <a class="code" href="lspmac_8c.html#a939e8aae7c78a7d9f93f0ad198cc4463" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[ 3]), 0, 3, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a480f892fe91b05b2980fb00064807e2b">alignz_act_pos</a>,    &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#aadbfac5709de57e449a37e2937d6ade7">alignz_status_1</a>,    &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ac378da16eeaab2bc47f3f8f88f7411ed">alignz_status_2</a>,    <span class="stringliteral">&quot;Align Z #4 &amp;3 Z&quot;</span>, <span class="stringliteral">&quot;align.z&quot;</span>,     <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#aa90d2363b744acbd4d45133b7a716d8f" title="Polaroid analyzer motor.">anal</a>   = <a class="code" href="lspmac_8c.html#a939e8aae7c78a7d9f93f0ad198cc4463" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[ 4]), 0, 4, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a49d1151b0e819646587be0ca9c9d612a">analyzer_act_pos</a>,  &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ab876b484f55bcce576fcd89dcc3f7267">analyzer_status_1</a>,  &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a4f88bb778e4e18f1fbf7672ac11e7433">analyzer_status_2</a>,  <span class="stringliteral">&quot;Anal    #5&quot;</span>,      <span class="stringliteral">&quot;lightPolar&quot;</span>,  <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ad53a42cfaa04eff0336a44c8c9986333" title="Optical zoom.">zoom</a>   = <a class="code" href="lspmac_8c.html#a939e8aae7c78a7d9f93f0ad198cc4463" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[ 5]), 1, 0, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a920b80e9f5f08aedac3ad541d5ffc8ae">zoom_act_pos</a>,      &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#af28e978b761dc07eefed3971547cfd4d">zoom_status_1</a>,      &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a34e4200315a083deb8a970e21bbbe277">zoom_status_2</a>,      <span class="stringliteral">&quot;Zoom    #6 &amp;4 Z&quot;</span>, <span class="stringliteral">&quot;cam.zoom&quot;</span>,    <a class="code" href="lspmac_8c.html#a82cf6576d41c31fce48a59db2d22188b" title="Move method for the zoom motor.">lspmac_movezoom_queue</a>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a139200ddaa9856a7ffcec0e6cbaa8f1b" title="Aperture Y.">apery</a>  = <a class="code" href="lspmac_8c.html#a939e8aae7c78a7d9f93f0ad198cc4463" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[ 6]), 1, 1, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a2a434d2b57dbb669de0765486a1516ff">aperturey_act_pos</a>, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a2ef953eaddf7058bf4276585e6ff066b">aperturey_status_1</a>, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a0a7738f13a0fa80626cafc2299b104b4">aperturey_status_2</a>, <span class="stringliteral">&quot;Aper Y  #7 &amp;5 Y&quot;</span>, <span class="stringliteral">&quot;appy&quot;</span>,        <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ab93bd6ee850b285ca3a95e64d15e9477" title="Aperture Z.">aperz</a>  = <a class="code" href="lspmac_8c.html#a939e8aae7c78a7d9f93f0ad198cc4463" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[ 7]), 1, 2, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a62d584ce23cfd9aa626d3c03649b455c">aperturez_act_pos</a>, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a27880dd795e1ba4fea4870c64ee3aa84">aperturez_status_1</a>, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ae407a99e428d9f4a7444a02c8bc3414e">aperturez_status_2</a>, <span class="stringliteral">&quot;Aper Z  #8 &amp;5 Z&quot;</span>, <span class="stringliteral">&quot;appz&quot;</span>,        <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a51358daaea8b5236f08414877d8af6c2" title="Capillary Y.">capy</a>   = <a class="code" href="lspmac_8c.html#a939e8aae7c78a7d9f93f0ad198cc4463" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[ 8]), 1, 3, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ae25122a6db146501b51609b9cb59b044">capy_act_pos</a>,      &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a7f4e945e80b1980b9e69366a69ad79cc">capy_status_1</a>,      &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a5d7c10d9a16ebcc53ac4a0770ab2ef62">capy_status_2</a>,      <span class="stringliteral">&quot;Cap Y   #9 &amp;5 U&quot;</span>, <span class="stringliteral">&quot;capy&quot;</span>,        <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#aa45f268d0af9f3d465acfab128919718" title="Capillary Z.">capz</a>   = <a class="code" href="lspmac_8c.html#a939e8aae7c78a7d9f93f0ad198cc4463" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[ 9]), 1, 4, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a257c04efac3a33d5d34b21d64c6f1266">capz_act_pos</a>,      &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a719db4477f35331eaa8b7b44150e88a2">capz_status_1</a>,      &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a3abb998bb89433aed16121d0dae6275a">capz_status_2</a>,      <span class="stringliteral">&quot;Cap Z  #10 &amp;5 V&quot;</span>, <span class="stringliteral">&quot;capz&quot;</span>,        <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a589431b3a79c21c251fcb97cc9126991" title="Scintillator Z.">scint</a>  = <a class="code" href="lspmac_8c.html#a939e8aae7c78a7d9f93f0ad198cc4463" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[10]), 2, 0, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a1c146fc792c4285eed5b2c446c214f98">scint_act_pos</a>,     &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a1723870357f428ac5c2758a2c9a475c7">scint_status_1</a>,     &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a4e5bc72e2f4007370f1c29ea272c952f">scint_status_2</a>,     <span class="stringliteral">&quot;Scin Z #11 &amp;5 W&quot;</span>, <span class="stringliteral">&quot;scint&quot;</span>,       <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ac940d950d9efeaf3f0ae67e9bf331188" title="Centering Table X.">cenx</a>   = <a class="code" href="lspmac_8c.html#a939e8aae7c78a7d9f93f0ad198cc4463" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[11]), 2, 1, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ae7924b6e91e1de82f6f7910cb3a9c9bd">centerx_act_pos</a>,   &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#aa619cdbd7a563408c6b825ddc4f74ebb">centerx_status_1</a>,   &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ae4fad6debe138ed7815d463e83f8d0f6">centerx_status_2</a>,   <span class="stringliteral">&quot;Cen X  #17 &amp;2 X&quot;</span>, <span class="stringliteral">&quot;centering.x&quot;</span>, <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#aaed18e738ba7bfb6c771a44f5d7ea827" title="Centering Table Y.">ceny</a>   = <a class="code" href="lspmac_8c.html#a939e8aae7c78a7d9f93f0ad198cc4463" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[12]), 2, 2, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a6be71a92a599d490ca808af8c7e7faa0">centery_act_pos</a>,   &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a57f65ebe28ef88f1c632d9f35d9167eb">centery_status_1</a>,   &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#aa242098c185cce8f852cd6e081ef0b1d">centery_status_2</a>,   <span class="stringliteral">&quot;Cen Y  #18 &amp;2 Y&quot;</span>, <span class="stringliteral">&quot;centering.y&quot;</span>, <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a0be79ccb7ebf3a665248fd856112b9fd" title="Kappa.">kappa</a>  = <a class="code" href="lspmac_8c.html#a939e8aae7c78a7d9f93f0ad198cc4463" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[13]), 2, 3, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ac384fb7073387dd5dcb2e85a00ec8a77">kappa_act_pos</a>,     &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ab152694bc32d37c1d180f55e8d282020">kappa_status_1</a>,     &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#af6891f5f8dcfc62668f64c583042c6bc">kappa_status_2</a>,     <span class="stringliteral">&quot;Kappa  #19 &amp;7 X&quot;</span>, <span class="stringliteral">&quot;kappa&quot;</span>,       <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ac8070dc568ad974a3db42b51eca828cc" title="Phi (not data collection axis)">phi</a>    = <a class="code" href="lspmac_8c.html#a939e8aae7c78a7d9f93f0ad198cc4463" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[14]), 2, 4, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a4de22995a72ff6e72a1a9ccab6d00620">phi_act_pos</a>,       &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ad8b8fd90ffff43016e2adaab5ccbfa02">phi_status_1</a>,       &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a0e6cea4c32cb34e602b9ac3d21259219">phi_status_2</a>,       <span class="stringliteral">&quot;Phi    #20 &amp;7 Y&quot;</span>, <span class="stringliteral">&quot;phi&quot;</span>,         <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#a26dec4623af9beed912b8e7e6f99822c" title="Fast shutter.">fshut</a>  = <a class="code" href="lspmac_8c.html#a40aa4aeb5c799a6a3a089137da4fd6a8" title="Initalize the fast shutter motor.">lspmac_fshut_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[15]));</div>
<div class="line">  <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a> = <a class="code" href="lspmac_8c.html#acea9dfc6367bbcf16f49e664e0fc3774" title="Initialize DAC motor Note that some motors require further initialization from a database query...">lspmac_dac_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[16]), &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a3be73c48b09190241a2bcb801af5b97c">front_dac</a>,   <span class="stringliteral">&quot;M1200&quot;</span>, <span class="stringliteral">&quot;frontLight.intensity&quot;</span>, <a class="code" href="lspmac_8c.html#a98ad3d807b8826439b710e97bf53b478" title="Move method for dac motor objects (ie, lights)">lspmac_movedac_queue</a>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a> = <a class="code" href="lspmac_8c.html#acea9dfc6367bbcf16f49e664e0fc3774" title="Initialize DAC motor Note that some motors require further initialization from a database query...">lspmac_dac_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[17]), &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a33ce490348c8de255cf49b96469d3d4e">back_dac</a>,    <span class="stringliteral">&quot;M1201&quot;</span>, <span class="stringliteral">&quot;backLight.intensity&quot;</span>,  <a class="code" href="lspmac_8c.html#a98ad3d807b8826439b710e97bf53b478" title="Move method for dac motor objects (ie, lights)">lspmac_movedac_queue</a>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a8a3ca6fcf5e24dcc26170736843e53b2" title="Scintillator Piezo DAC.">fscint</a> = <a class="code" href="lspmac_8c.html#acea9dfc6367bbcf16f49e664e0fc3774" title="Initialize DAC motor Note that some motors require further initialization from a database query...">lspmac_dac_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[18]), &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a031be48adfa016c637d6eae49054c435">scint_piezo</a>, <span class="stringliteral">&quot;M1203&quot;</span>, <span class="stringliteral">&quot;scint.focus&quot;</span>,          <a class="code" href="lspmac_8c.html#a98ad3d807b8826439b710e97bf53b478" title="Move method for dac motor objects (ie, lights)">lspmac_movedac_queue</a>);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#abee73a0d9e5f3af9eb88d5cfd6b953c3" title="Smart Magnet on/off.">smart_mag_oo</a>  = <a class="code" href="lspmac_8c.html#aeaa263af25d139f249d8b825a058d0ce" title="Initialize binary i/o motor.">lspmac_bo_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[19]), <span class="stringliteral">&quot;smartMagnet&quot;</span>,<span class="stringliteral">&quot;M1100=%d&quot;</span>, &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ab09c1342dc12052b8f5b35f78ef95000">acc11c_5</a>), 0x01);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#af813a2eff0b7efa4c70633559054e84c" title="Back light Up/Down actuator.">blight_ud</a>     = <a class="code" href="lspmac_8c.html#aeaa263af25d139f249d8b825a058d0ce" title="Initialize binary i/o motor.">lspmac_bo_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[20]), <span class="stringliteral">&quot;backLight&quot;</span>,  <span class="stringliteral">&quot;M1101=%d&quot;</span>, &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ab09c1342dc12052b8f5b35f78ef95000">acc11c_5</a>), 0x02);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ae78d9a757d4c85419fff9c94b15e25d7" title="Move the cryostream towards or away from the crystal.">cryo</a>          = <a class="code" href="lspmac_8c.html#aeaa263af25d139f249d8b825a058d0ce" title="Initialize binary i/o motor.">lspmac_bo_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[21]), <span class="stringliteral">&quot;cryo&quot;</span>,       <span class="stringliteral">&quot;M1102=%d&quot;</span>, &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ab09c1342dc12052b8f5b35f78ef95000">acc11c_5</a>), 0x04);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a9d9c5030d817483ca9518027c91adac4" title="blow air on the scintilator to dry it off">dryer</a>         = <a class="code" href="lspmac_8c.html#aeaa263af25d139f249d8b825a058d0ce" title="Initialize binary i/o motor.">lspmac_bo_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[22]), <span class="stringliteral">&quot;dryer&quot;</span>,      <span class="stringliteral">&quot;M1103=%d&quot;</span>, &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ab09c1342dc12052b8f5b35f78ef95000">acc11c_5</a>), 0x08);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#addb26c80065506faa1de3c1b468fe03f" title="Move the fluorescence detector in/out.">fluo</a>          = <a class="code" href="lspmac_8c.html#aeaa263af25d139f249d8b825a058d0ce" title="Initialize binary i/o motor.">lspmac_bo_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[23]), <span class="stringliteral">&quot;fluo&quot;</span>,       <span class="stringliteral">&quot;M1104=%d&quot;</span>, &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ab09c1342dc12052b8f5b35f78ef95000">acc11c_5</a>), 0x10);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a6630442dc65ce8a30a24ed718b301971" title="Turn front light on/off.">flight_oo</a>     = <a class="code" href="lspmac_8c.html#a698719a7ce58e2052fa70ab87b1fb293">lspmac_soft_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[24]), <span class="stringliteral">&quot;frontLight&quot;</span>,        <a class="code" href="lspmac_8c.html#aa3c75b8bbde4b8b8ff2b416eabe45552" title="&quot;move&quot; frontlight on/off">lspmac_moveabs_frontlight_oo_queue</a>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#af55c51d52c4586b647114f95d7ac1f42" title="Back light scale factor.">blight_f</a>      = <a class="code" href="lspmac_8c.html#a698719a7ce58e2052fa70ab87b1fb293">lspmac_soft_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[25]), <span class="stringliteral">&quot;backLight.factor&quot;</span>,  <a class="code" href="lspmac_8c.html#a4c4e5e996755d21603e0afdd41ab9cd4">lspmac_moveabs_blight_factor_queue</a>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#aabf4ec595b5183c1777d029ca56134b0" title="Front light scale factor.">flight_f</a>      = <a class="code" href="lspmac_8c.html#a698719a7ce58e2052fa70ab87b1fb293">lspmac_soft_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[26]), <span class="stringliteral">&quot;frontLight.factor&quot;</span>, <a class="code" href="lspmac_8c.html#acbe3a8e54208048506e77b365b4c0f58">lspmac_moveabs_flight_factor_queue</a>);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#aade15098d213bb25522048e4a231941a" title="Low pressure air OK.">lp_air</a>          = <a class="code" href="lspmac_8c.html#ac27a61fa5aca398b0db588674e7f6dc7" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[ 0]), &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a69fc2e30a5de0a11c992d133e7a761cd">acc11c_1</a>),  0x01, <span class="stringliteral">&quot;Low Pressure Air OK&quot;</span>,  <span class="stringliteral">&quot;Low Pressure Air Failed&quot;</span>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#abb29b117ad38156ba16fcf44eeb427af" title="High pressure air OK.">hp_air</a>          = <a class="code" href="lspmac_8c.html#ac27a61fa5aca398b0db588674e7f6dc7" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[ 1]), &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a69fc2e30a5de0a11c992d133e7a761cd">acc11c_1</a>),  0x02, <span class="stringliteral">&quot;High Pressure Air OK&quot;</span>, <span class="stringliteral">&quot;High Pressure Air Failed&quot;</span>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a28df32fd6be9160603aa1bb74a823574" title="that little toggle switch for the cryo">cryo_switch</a>     = <a class="code" href="lspmac_8c.html#ac27a61fa5aca398b0db588674e7f6dc7" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[ 2]), &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a69fc2e30a5de0a11c992d133e7a761cd">acc11c_1</a>),  0x04, <span class="stringliteral">&quot;CryoSwitchChanged&quot;</span>,    <span class="stringliteral">&quot;CryoSwitchChanged&quot;</span>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ac0d0bc95bcbcbd154b30c72a9645c8b2" title="Backlight is down.">blight_down</a>     = <a class="code" href="lspmac_8c.html#ac27a61fa5aca398b0db588674e7f6dc7" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[ 3]), &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a69fc2e30a5de0a11c992d133e7a761cd">acc11c_1</a>),  0x08, <span class="stringliteral">&quot;Backlight Down&quot;</span>,       <span class="stringliteral">&quot;Backlight Not Down&quot;</span>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a7fba65f6555c5c7908852c6cf1ad0c94" title="Backlight is up.">blight_up</a>       = <a class="code" href="lspmac_8c.html#ac27a61fa5aca398b0db588674e7f6dc7" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[ 4]), &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a69fc2e30a5de0a11c992d133e7a761cd">acc11c_1</a>),  0x10, <span class="stringliteral">&quot;Backlight Up&quot;</span>,         <span class="stringliteral">&quot;Backlight Not Up&quot;</span>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a871d4cdea0a1a8db85b8658a07655212" title="cryo is in the back position">cryo_back</a>       = <a class="code" href="lspmac_8c.html#ac27a61fa5aca398b0db588674e7f6dc7" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[ 5]), &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a69fc2e30a5de0a11c992d133e7a761cd">acc11c_1</a>),  0x40, <span class="stringliteral">&quot;Cryo Back&quot;</span>,            <span class="stringliteral">&quot;Cryo Not Back&quot;</span>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a67092de6f3fcc0b245e4970437eaff6b" title="fluor is in the back position">fluor_back</a>      = <a class="code" href="lspmac_8c.html#ac27a61fa5aca398b0db588674e7f6dc7" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[ 6]), &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ad186f06cb4670b00b8af8264d1da66a4">acc11c_2</a>),  0x01, <span class="stringliteral">&quot;Fluor. Det. Parked&quot;</span>,   <span class="stringliteral">&quot;Fluor. Det. Not Parked&quot;</span>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ac59ab990e48033a811aeb0281fb588fc" title="smart magnet detected sample">sample_detected</a> = <a class="code" href="lspmac_8c.html#ac27a61fa5aca398b0db588674e7f6dc7" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[ 7]), &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ad186f06cb4670b00b8af8264d1da66a4">acc11c_2</a>),  0x02, <span class="stringliteral">&quot;SamplePresent&quot;</span>,        <span class="stringliteral">&quot;SampleAbsent&quot;</span>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a5538a6aa526eeed65ff237303da2d348" title="ETEL is ready.">etel_ready</a>      = <a class="code" href="lspmac_8c.html#ac27a61fa5aca398b0db588674e7f6dc7" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[ 8]), &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ad186f06cb4670b00b8af8264d1da66a4">acc11c_2</a>),  0x20, <span class="stringliteral">&quot;ETEL Ready&quot;</span>,           <span class="stringliteral">&quot;ETEL Not Ready&quot;</span>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ab48d4a2cf0225796db9aad49f034dc59" title="ETEL is on.">etel_on</a>         = <a class="code" href="lspmac_8c.html#ac27a61fa5aca398b0db588674e7f6dc7" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[ 9]), &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ad186f06cb4670b00b8af8264d1da66a4">acc11c_2</a>),  0x40, <span class="stringliteral">&quot;ETEL On&quot;</span>,              <span class="stringliteral">&quot;ETEL Off&quot;</span>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a1e690d4ad981d020ea2c850282dca3be" title="ETEL initialized OK.">etel_init_ok</a>    = <a class="code" href="lspmac_8c.html#ac27a61fa5aca398b0db588674e7f6dc7" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[10]), &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ad186f06cb4670b00b8af8264d1da66a4">acc11c_2</a>),  0x80, <span class="stringliteral">&quot;ETEL Init OK&quot;</span>,         <span class="stringliteral">&quot;ETEL Init Not OK&quot;</span>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ab552f2e28dd9cccefafe01f27717101b" title="Minikappa is OK (whatever that means)">minikappa_ok</a>    = <a class="code" href="lspmac_8c.html#ac27a61fa5aca398b0db588674e7f6dc7" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[11]), &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a20a15620e12888f61c0aed1e47e97932">acc11c_3</a>),  0x01, <span class="stringliteral">&quot;Minikappa OK&quot;</span>,         <span class="stringliteral">&quot;Minikappa Not OK&quot;</span>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a2dc6fa78bb6313fe8b696d646eaa2443" title="smart magnet is on">smart_mag_on</a>    = <a class="code" href="lspmac_8c.html#ac27a61fa5aca398b0db588674e7f6dc7" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[12]), &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a20a15620e12888f61c0aed1e47e97932">acc11c_3</a>),  0x04, <span class="stringliteral">&quot;Smart Magnet On&quot;</span>,      <span class="stringliteral">&quot;Smart Magnet Not On&quot;</span>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#afaff4fbb5f03b0d2469fc7a14f174d69" title="(whose arm? parked where?)">arm_parked</a>      = <a class="code" href="lspmac_8c.html#ac27a61fa5aca398b0db588674e7f6dc7" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[13]), &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a20a15620e12888f61c0aed1e47e97932">acc11c_3</a>),  0x08, <span class="stringliteral">&quot;Arm Parked&quot;</span>,           <span class="stringliteral">&quot;Arm Not Parked&quot;</span>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a37903ed8430ac4d9ead609a78eb62f32" title="smart magnet error (coil broken perhaps)">smart_mag_err</a>   = <a class="code" href="lspmac_8c.html#ac27a61fa5aca398b0db588674e7f6dc7" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[14]), &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a20a15620e12888f61c0aed1e47e97932">acc11c_3</a>),  0x10, <span class="stringliteral">&quot;Smart Magnet Error&quot;</span>,   <span class="stringliteral">&quot;Smart Magnet OK&quot;</span>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ae98a0792d6b4b96a33df0a31bdec6342" title="shutter is open (note in pmc says this is a slow input)">shutter_open</a>    = <a class="code" href="lspmac_8c.html#ac27a61fa5aca398b0db588674e7f6dc7" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[15]), &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a20a15620e12888f61c0aed1e47e97932">acc11c_3</a>), 0x100, <span class="stringliteral">&quot;Shutter Open&quot;</span>,         <span class="stringliteral">&quot;Shutter Not Open&quot;</span>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a4892e918830dd12093d28c53a1c2df98" title="smart magnet is off">smart_mag_off</a>   = <a class="code" href="lspmac_8c.html#ac27a61fa5aca398b0db588674e7f6dc7" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[16]), &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ab09c1342dc12052b8f5b35f78ef95000">acc11c_5</a>),  0x01, <span class="stringliteral">&quot;Smart Magnet Off&quot;</span>,     <span class="stringliteral">&quot;Smart Magnet Not Off&quot;</span>);</div>
<div class="line">  </div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Initialize several commands that get called, perhaps, alot</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  </div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a6a155eb3ae546dd29369c4a33ddb3310" title="VR_UPLOAD or VR_DOWNLOAD.">RequestType</a> = <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a0dc566e7edbb226f1a4ea443d93d56e2" title="The command to run (VR_PMAC_GETMEM, etc).">Request</a>     = <a class="code" href="lspmac_8c.html#aad3c7b4a9403e56c09eceadcf21252c0">VR_PMAC_READREADY</a>;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#aec0ee9a5f6c7e3bc6e4bd98f1bd52783" title="Command parameter 1.">wValue</a>      = 0;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a92f5a374e87d4f496b64b4888850d6e6" title="Command parameter 2.">wIndex</a>      = 0;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#af5df25ff13ca30fa33719d0df1ab7e97" title="Number of bytes in bData.">wLength</a>     = htons(2);</div>
<div class="line">  memset( <a class="code" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a6a155eb3ae546dd29369c4a33ddb3310" title="VR_UPLOAD or VR_DOWNLOAD.">RequestType</a> = <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a0dc566e7edbb226f1a4ea443d93d56e2" title="The command to run (VR_PMAC_GETMEM, etc).">Request</a>     = <a class="code" href="lspmac_8c.html#a50e444b5ceb6d62a1be43c88c55c549c">VR_PMAC_GETBUFFER</a>;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a>.<a class="code" href="structtagEthernetCmd.html#aec0ee9a5f6c7e3bc6e4bd98f1bd52783" title="Command parameter 1.">wValue</a>      = 0;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a92f5a374e87d4f496b64b4888850d6e6" title="Command parameter 2.">wIndex</a>      = 0;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a>.<a class="code" href="structtagEthernetCmd.html#af5df25ff13ca30fa33719d0df1ab7e97" title="Number of bytes in bData.">wLength</a>     = htons(1400);</div>
<div class="line">  memset( <a class="code" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81" title="commands to send out &quot;readready&quot;, &quot;getbuffer&quot;, &quot;controlresponse&quot; (initialized in main)">cr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a6a155eb3ae546dd29369c4a33ddb3310" title="VR_UPLOAD or VR_DOWNLOAD.">RequestType</a> = <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81" title="commands to send out &quot;readready&quot;, &quot;getbuffer&quot;, &quot;controlresponse&quot; (initialized in main)">cr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a0dc566e7edbb226f1a4ea443d93d56e2" title="The command to run (VR_PMAC_GETMEM, etc).">Request</a>     = <a class="code" href="lspmac_8c.html#a8f4ce4666a23a3fb153d680bd1cb6556">VR_CTRL_RESPONSE</a>;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81" title="commands to send out &quot;readready&quot;, &quot;getbuffer&quot;, &quot;controlresponse&quot; (initialized in main)">cr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#aec0ee9a5f6c7e3bc6e4bd98f1bd52783" title="Command parameter 1.">wValue</a>      = 0;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81" title="commands to send out &quot;readready&quot;, &quot;getbuffer&quot;, &quot;controlresponse&quot; (initialized in main)">cr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a92f5a374e87d4f496b64b4888850d6e6" title="Command parameter 2.">wIndex</a>      = 0;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81" title="commands to send out &quot;readready&quot;, &quot;getbuffer&quot;, &quot;controlresponse&quot; (initialized in main)">cr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#af5df25ff13ca30fa33719d0df1ab7e97" title="Number of bytes in bData.">wLength</a>     = htons(1400);</div>
<div class="line">  memset( <a class="code" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81" title="commands to send out &quot;readready&quot;, &quot;getbuffer&quot;, &quot;controlresponse&quot; (initialized in main)">cr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81" title="commands to send out &quot;readready&quot;, &quot;getbuffer&quot;, &quot;controlresponse&quot; (initialized in main)">cr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>));</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Initialize some mutexs and conditions</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  pthread_mutex_init( &amp;<a class="code" href="lspmac_8c.html#acc1bb77b9bcbc4d970f841a41fd274b3" title="manage access to the pmac command queue">pmac_queue_mutex</a>, &amp;mutex_initializer);</div>
<div class="line">  pthread_cond_init(  &amp;<a class="code" href="lspmac_8c.html#a8a25bd9c593c6985107f90f999ce0b08" title="wait for a command to be sent to PMAC before continuing">pmac_queue_cond</a>, NULL);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#a112158e0cd50449a440ac55c7af7bea2" title="State of the shutter, used to detect changes.">lspmac_shutter_state</a> = 0;                             <span class="comment">// assume the shutter is now closed: not a big deal if we are wrong</span></div>
<div class="line">  pthread_mutex_init( &amp;<a class="code" href="lspmac_8c.html#a1b78a13c654409333569815e1c109d38" title="Coordinates threads reading shutter status.">lspmac_shutter_mutex</a>, &amp;mutex_initializer);</div>
<div class="line">  pthread_cond_init(  &amp;<a class="code" href="lspmac_8c.html#afbd51c2cefcee87afe994c9e9f372241" title="Allows waiting for the shutter status to change.">lspmac_shutter_cond</a>, NULL);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba" title="our poll structure">pmacfd</a>.fd = -1;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_init( &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>, &amp;mutex_initializer);</div>
<div class="line">  pthread_cond_init(  &amp;<a class="code" href="lspmac_8c.html#a57547d211906c981ef20257eba99f8df" title="Wait for motor(s) to finish moving condition.">lspmac_moving_cond</a>, NULL);</div>
<div class="line"></div>
<div class="line">  pthread_mutex_init( &amp;<a class="code" href="lspmac_8c.html#a2ff142105e17d933871d09759e7082f8" title="Keep too many processes from sending commands at once.">lspmac_ascii_mutex</a>, &amp;mutex_initializer);</div>
<div class="line"></div>
<div class="line">  pthread_mutex_init( &amp;<a class="code" href="lspmac_8c.html#a3e7ae750b8988cd2eb93895e3ea1a49e">lspmac_ascii_buffers_mutex</a>, &amp;mutex_initializer);</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// clear the ascii communications buffers</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  {</div>
<div class="line">    uint32_t cc;</div>
<div class="line">    cc = 0;</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>, <a class="code" href="lspmac_8c.html#ab79207cc3145740f8c070a24c91b11e0">VR_PMAC_SETMEM</a>, 0x0e9e, 0, 4, (<span class="keywordtype">char</span> *)&amp;cc, NULL, 1, NULL);</div>
<div class="line"></div>
<div class="line">    cc = 0x18;</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>, <a class="code" href="lspmac_8c.html#ab79207cc3145740f8c070a24c91b11e0">VR_PMAC_SETMEM</a>, 0x0e9e, 0, 4, (<span class="keywordtype">char</span> *)&amp;cc, NULL, 1, NULL);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( NULL, <span class="stringliteral">&quot;I5=0&quot;</span>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( NULL, <span class="stringliteral">&quot;ENABLE PLCC 0,2&quot;</span>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( NULL, <span class="stringliteral">&quot;DISABLE PLCC 1&quot;</span>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( NULL, <span class="stringliteral">&quot;I5=3&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a51216d824b3693de350f3be1ab30a7e0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_jogabs_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>requested_position</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Use jog to move motor to requested position. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>The motor to move </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">requested_position</td><td>Where to move it </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02814">2814</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                            {</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="lspmac_8c.html#a2ab30559739e0232331f53d16c0cb5ac" title="Move method for normal stepper and servo motor objects Returns non-zero on abort, zero if OK...">lspmac_move_or_jog_abs_queue</a>( mp, requested_position, 1);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a55791bd8a07e5ca1dd2aeedf3c23942c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_light_zoom_cb </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the backlight intensity whenever the zoom is changed (and the backlight is up) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">event</td><td>Name of the event that calledus </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l03271">3271</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                        {</div>
<div class="line">  <span class="keywordtype">int</span> z;</div>
<div class="line"></div>
<div class="line">  z = round(<a class="code" href="lspmac_8c.html#acc46bdddee59bd8c5ad662b3fd445e9f" title="get the motor position (with locking)">lspmac_getPosition</a>( <a class="code" href="lspmac_8c.html#ad53a42cfaa04eff0336a44c8c9986333" title="Optical zoom.">zoom</a>));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_light_zoom_cb: zoom = %d&quot;</span>, z);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#acc46bdddee59bd8c5ad662b3fd445e9f" title="get the motor position (with locking)">lspmac_getPosition</a>( <a class="code" href="lspmac_8c.html#a6630442dc65ce8a30a24ed718b301971" title="Turn front light on/off.">flight_oo</a>) != 0.0) {</div>
<div class="line">    <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a38b6eee046c3ceff84f908af3335ebcf" title="function to move the motor">moveAbs</a>( <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>, (<span class="keywordtype">double</span>)z);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a38b6eee046c3ceff84f908af3335ebcf" title="function to move the motor">moveAbs</a>( <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>, 0.0);</div>
<div class="line">    }</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#acc46bdddee59bd8c5ad662b3fd445e9f" title="get the motor position (with locking)">lspmac_getPosition</a>( <a class="code" href="lspmac_8c.html#af813a2eff0b7efa4c70633559054e84c" title="Back light Up/Down actuator.">blight_ud</a>) != 0.0) {</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a38b6eee046c3ceff84f908af3335ebcf" title="function to move the motor">moveAbs</a>( <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>, (<span class="keywordtype">double</span>)z);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a38b6eee046c3ceff84f908af3335ebcf" title="function to move the motor">moveAbs</a>( <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>, 0.0);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a55b882be15d56a2a777f2b1f92901b7d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double lspmac_lut </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nlut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>lut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>x</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Look up table support for motor positions (think x=zoom, y=light intensity) use a lookup table to find the "counts" to move the motor to the requested position The look up table is a simple one dimensional array with the x values as even indicies and the y values as odd indices. </p>
<p>Returns: y value </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">nlut</td><td>number of entries in lookup table </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">lut</td><td>The lookup table: even indicies are the x values, odd are the y's </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">x</td><td>The x value we are looking up. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00378">378</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                    {</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>, foundone;</div>
<div class="line">  <span class="keywordtype">double</span> m;</div>
<div class="line">  <span class="keywordtype">double</span> y1, y2, x1, x2, <a class="code" href="namespacemk__pgpmac__redis.html#a34220d58136fb95853f54ed51a130f79">y</a>;</div>
<div class="line"></div>
<div class="line">  foundone = 0;</div>
<div class="line">  <span class="keywordflow">if</span>( lut != NULL &amp;&amp; nlut &gt; 1) {</div>
<div class="line">    <span class="keywordflow">for</span>( i=0; i &lt; 2*nlut; i += 2) {</div>
<div class="line">      x1 = lut[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>];</div>
<div class="line">      y1 = lut[i+1];</div>
<div class="line">      <span class="keywordflow">if</span>( i &lt; 2*nlut - 2) {</div>
<div class="line">        x2 = lut[i+2];</div>
<div class="line">        y2 = lut[i+3];</div>
<div class="line">      }</div>
<div class="line"></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// First one too big?  Use the y value of the first element</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="keywordflow">if</span>( i == 0 &amp;&amp; x1 &gt; <a class="code" href="namespacemk__pgpmac__redis.html#abc8696f6f2f3fd3edd30989d3c8ec301">x</a>) {</div>
<div class="line">        y = y1;</div>
<div class="line">        foundone = 1;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line"></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Look for equality</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="keywordflow">if</span>( x1 == <a class="code" href="namespacemk__pgpmac__redis.html#abc8696f6f2f3fd3edd30989d3c8ec301">x</a>) {</div>
<div class="line">        y = y1;</div>
<div class="line">        foundone = 1;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line"></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Maybe interpolate</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="keywordflow">if</span>( (i &lt; 2*nlut-2) &amp;&amp; <a class="code" href="namespacemk__pgpmac__redis.html#abc8696f6f2f3fd3edd30989d3c8ec301">x</a> &lt; x2) {</div>
<div class="line">        m = (y2 - y1) / (x2 - x1);</div>
<div class="line">        y = m*(<a class="code" href="namespacemk__pgpmac__redis.html#abc8696f6f2f3fd3edd30989d3c8ec301">x</a> - x1) + y1;</div>
<div class="line">        foundone = 1;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span>( foundone == 0) {</div>
<div class="line">      <span class="comment">// must be bigger than the last entry</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      y = lut[2*(nlut-1) + 1];</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="namespacemk__pgpmac__redis.html#a34220d58136fb95853f54ed51a130f79">y</a>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> 0.0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a039af7c2d8d90cf24c2a8840f7402999"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_more_ascii_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nreceived</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buff</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>we are expecting more characters from the DPRAM ASCII interface </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01821">1821</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                                             {</div>
<div class="line">  <a class="code" href="lspmac_8c.html#adb46b594a6926134322186a3c85df37d" title="Forward declarateion.">lspmac_get_ascii</a>( cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#ace4d453ad6d6225e910dffb33cde866a" title="event name to send">event</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a939e8aae7c78a7d9f93f0ad198cc4463"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* lspmac_motor_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>wy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>wx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>posp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>stat1p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>stat2p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>wtitle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int(*)(<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *, double)&#160;</td>
          <td class="paramname"><em>moveAbs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize a pmac stepper or servo motor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">d</td><td>An uninitialize motor object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">wy</td><td>Curses status window row index </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">wx</td><td>Curses status window column index </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">posp</td><td>Pointer to position status </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">stat1p</td><td>Pointer to 1st status word </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">stat2p</td><td>Pointer to 2nd status word </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">wtitle</td><td>Title for this motor (to display) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">name</td><td>This motor's name </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">moveAbs</td><td>Method to use to move this motor </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02948">2948</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                    {</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#afd005045e9cc3f4bb93d424fe50eb733" title="Helper funciton for the init calls.">_lspmac_motor_init</a>( d, name);</div>
<div class="line"></div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a38b6eee046c3ceff84f908af3335ebcf" title="function to move the motor">moveAbs</a>             = moveAbs;</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#ac62692eb939c04ca35e939d1c3acfe8f" title="method to read the motor status and position">read</a>                = <a class="code" href="lspmac_8c.html#a637fc023d1255f3519b2eee01913d64d" title="Read the position and status of a normal PMAC motor.">lspmac_pmacmotor_read</a>;</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a>   = posp;</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a56c41875faf19c643e97c10519e6eb8c" title="First 24 bit PMAC motor status word.">status1_p</a>           = stat1p;</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a2b33ef6e12717459c1e9967cc6e659c6" title="Sectond 24 bit PMAC motor status word.">status2_p</a>           = stat2p;</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a> = newwin( <a class="code" href="pgpmac_8h.html#a3bae94e8e4e4347dd5f87b6bda058de6" title="Number of status box rows.">LS_DISPLAY_WINDOW_HEIGHT</a>, <a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>, wy*<a class="code" href="pgpmac_8h.html#a3bae94e8e4e4347dd5f87b6bda058de6" title="Number of status box rows.">LS_DISPLAY_WINDOW_HEIGHT</a>, wx*<a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>);</div>
<div class="line">  box( d-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>, 0, 0);</div>
<div class="line">  mvwprintw( d-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>, 1, 1, <span class="stringliteral">&quot;%s&quot;</span>, wtitle);</div>
<div class="line">  wnoutrefresh( d-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> d;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2ab30559739e0232331f53d16c0cb5ac"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_move_or_jog_abs_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>requested_position</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>use_jog</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Move method for normal stepper and servo motor objects Returns non-zero on abort, zero if OK. </p>
<p>&lt; format string for coordinate system move</p>
<p>&lt; coordinate system bit</p>
<p>&lt; the requested position in units of "counts"</p>
<p>&lt; motor and coordinate system;</p>
<p>&lt; our axis </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>The motor to move </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">requested_position</td><td>Where to move it </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">use_jog</td><td>1 to force jog, 0 for motion prog </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02607">2607</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                            {</div>
<div class="line">  <span class="keywordtype">char</span> *fmt;                    </div>
<div class="line">  <span class="keywordtype">int</span> q100;                     </div>
<div class="line">  <span class="keywordtype">int</span> requested_pos_cnts;       </div>
<div class="line">  <span class="keywordtype">int</span> coord_num, motor_num;     </div>
<div class="line">  <span class="keywordtype">char</span> *axis;                   </div>
<div class="line">  <span class="keywordtype">double</span> u2c;</div>
<div class="line">  <span class="keywordtype">double</span> neutral_pos;</div>
<div class="line">  <span class="keywordtype">double</span> min_pos, max_pos;</div>
<div class="line">  <span class="keywordtype">int</span> pos_limit_hit, neg_limit_hit;</div>
<div class="line">  <span class="keyword">struct </span>timespec timeout, <a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands...">now</a>;</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  u2c           = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>(   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a8838915ebb6f9989944117c8197d5e86" title="conversion from counts to units: 0.0 means not loaded yet">u2c</a>);</div>
<div class="line">  motor_num     = <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>(   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ad6a51cca3c7e5f79168e5c33fd9e736b" title="pmac motor number">motor_num</a>);</div>
<div class="line">  coord_num     = <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>(   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a5614e003272e8323f8809bf7b6559532" title="coordinate system this motor belongs to (0 if none)">coord_num</a>);</div>
<div class="line">  axis          = <a class="code" href="lsredis_8c.html#ac1994e56114b2315294527d76311f829" title="return a copy of the key&#39;s string value">lsredis_getstr</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7437ef16c2dce65bde4dda1ea00e9df3" title="the axis (X, Y, Z, etc) or null if not in a coordinate system">axis</a>);</div>
<div class="line">  neutral_pos   = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>(   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae931e9bc9fc2fa82ca649334fc052fbe" title="zero offset">neutral_pos</a>);</div>
<div class="line">  min_pos       = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>(   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7c1f2f67c64d26b12d6bb0d681797d8d" title="our minimum position (soft limit)">min_pos</a>);</div>
<div class="line">  max_pos       = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>(   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aac8c31a857910cdcbb409331e128e766" title="our maximum position (soft limit)">max_pos</a>);</div>
<div class="line">  pos_limit_hit = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>(   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af39d2e7a681d7c2fbdc39d53fab1a475" title="positive limit status">pos_limit_hit</a>);</div>
<div class="line">  neg_limit_hit = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>(   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#afe13c86941928d20357f4f3e2a4d915a" title="negative limit status">neg_limit_hit</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( u2c == 0.0 || requested_position &lt; min_pos || requested_position &gt; max_pos) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Shouldn&#39;t try moving a motor that&#39;s in trouble</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_move_or_jog_abs_queue: %s  u2c=%f  requested position=%f  min allowed=%f  max allowed=%f&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, u2c, requested_position, min_pos, max_pos);</div>
<div class="line">    <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s Move Aborted&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( (neg_limit_hit &amp;&amp; (requested_position &lt; mp-&gt;position)) || (pos_limit_hit &amp;&amp; (requested_position &gt; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a>))) {</div>
<div class="line">    pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_move_or_jog_abs_queue: %s Moving wrong way on limit: requested position=%f  current position=%f  low limit=%d high limit=%d&quot;</span>,</div>
<div class="line">                           mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, requested_position, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a>, neg_limit_hit, pos_limit_hit);</div>
<div class="line">    <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s Move Aborted&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">    <span class="keywordflow">return</span> 2;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8cdc94c6e2478b12ce942d4cf1d7499" title="The position as requested by the user.">requested_position</a> = requested_position;</div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a>     = 1;</div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a68c471836f52707fa8582f7860cf500f" title="set to 1 when motion has been verified to have started">motion_seen</a>  = 0;</div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a59a7f007476b2428fd3c5bd7f24440e8" title="Motion command verified sent to pmac.">command_sent</a> = 0;</div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a> = u2c * (requested_position + neutral_pos);</div>
<div class="line">  requested_pos_cnts = mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( use_jog || axis == NULL || *axis == 0) {</div>
<div class="line">    use_jog = 1;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    use_jog = 0;</div>
<div class="line">    q100 = 1 &lt;&lt; (coord_num -1);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( !use_jog) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Make sure the coordinate system is not moving something, wait if it is</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>);</div>
<div class="line"></div>
<div class="line">    clock_gettime( CLOCK_REALTIME, &amp;<a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands...">now</a>);</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// TODO: Have all moves estimate how long they&#39;ll take and use that here</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    timeout.tv_sec  = <a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands...">now</a>.tv_sec + 60.0;                <span class="comment">// a long timeout, but we might really be moving something that takes this long (or longer)</span></div>
<div class="line">    timeout.tv_nsec = <a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands...">now</a>.tv_nsec;</div>
<div class="line"></div>
<div class="line">    err = 0;</div>
<div class="line">    <span class="keywordflow">while</span>( err == 0 &amp;&amp;  (<a class="code" href="lspmac_8c.html#a7a32c617c183166308241e270959df56" title="Flag used to implement motor moving condition.">lspmac_moving_flags</a> &amp; q100) != 0)</div>
<div class="line">      err = pthread_cond_timedwait( &amp;<a class="code" href="lspmac_8c.html#a57547d211906c981ef20257eba99f8df" title="Wait for motor(s) to finish moving condition.">lspmac_moving_cond</a>, &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>, &amp;timeout);</div>
<div class="line">    </div>
<div class="line">    pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( err == ETIMEDOUT) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_move_or_jog_abs_queue: Done.  lspmac_moving_flags = %0x&quot;</span>, <a class="code" href="lspmac_8c.html#a7a32c617c183166308241e270959df56" title="Flag used to implement motor moving condition.">lspmac_moving_flags</a>);</div>
<div class="line">      <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s Move Aborted&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Set the &quot;we are moving this coordinate system&quot; flag</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( NULL, <span class="stringliteral">&quot;M5075=(M5075 | %d)&quot;</span>, q100);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">switch</span>( *axis) {</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;A&#39;</span>:</div>
<div class="line">      fmt = <span class="stringliteral">&quot;&amp;%d Q16=%d Q100=%d B146R&quot;</span>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;B&#39;</span>:</div>
<div class="line">      fmt = <span class="stringliteral">&quot;&amp;%d Q17=%d Q100=%d B147R&quot;</span>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;C&#39;</span>:</div>
<div class="line">      fmt = <span class="stringliteral">&quot;&amp;%d Q18=%d Q100=%d B148R&quot;</span>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;X&#39;</span>:</div>
<div class="line">      fmt = <span class="stringliteral">&quot;&amp;%d Q10=%d Q100=%d B140R&quot;</span>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;Y&#39;</span>:</div>
<div class="line">      fmt = <span class="stringliteral">&quot;&amp;%d Q11=%d Q100=%d B141R&quot;</span>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;Z&#39;</span>:</div>
<div class="line">      fmt = <span class="stringliteral">&quot;&amp;%d Q12=%d Q100=%d B142R&quot;</span>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;U&#39;</span>:</div>
<div class="line">      fmt = <span class="stringliteral">&quot;&amp;%d Q13=%d Q100=%d B143R&quot;</span>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;V&#39;</span>:</div>
<div class="line">      fmt = <span class="stringliteral">&quot;&amp;%d Q14=%d Q100=%d B144R&quot;</span>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;W&#39;</span>:</div>
<div class="line">      fmt = <span class="stringliteral">&quot;&amp;%d Q15=%d Q100=%d B145R&quot;</span>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Make sure the flag has been seen</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">    clock_gettime( CLOCK_REALTIME, &amp;<a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands...">now</a>);</div>
<div class="line">    timeout.tv_sec  = <a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands...">now</a>.tv_sec + 4.0;         <span class="comment">// also a long timeout.  This should really only take a few milliseconds on a slow day</span></div>
<div class="line">    timeout.tv_nsec = <a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands...">now</a>.tv_nsec;</div>
<div class="line"></div>
<div class="line">    pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>);</div>
<div class="line"></div>
<div class="line">    err = 0;</div>
<div class="line">    <span class="keywordflow">while</span>( err == 0 &amp;&amp; (<a class="code" href="lspmac_8c.html#a7a32c617c183166308241e270959df56" title="Flag used to implement motor moving condition.">lspmac_moving_flags</a> &amp; q100) == 0)</div>
<div class="line">      err = pthread_cond_timedwait( &amp;<a class="code" href="lspmac_8c.html#a57547d211906c981ef20257eba99f8df" title="Wait for motor(s) to finish moving condition.">lspmac_moving_cond</a>, &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>, &amp;timeout);</div>
<div class="line">    pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( err == ETIMEDOUT) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_move_or_jog_abs_queue: Did not see flag propagate.  Move aborted.  lspmac_moving_flags = %0x&quot;</span>, <a class="code" href="lspmac_8c.html#a7a32c617c183166308241e270959df56" title="Flag used to implement motor moving condition.">lspmac_moving_flags</a>);</div>
<div class="line">      <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s Move Aborted&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  <span class="keywordflow">if</span>( use_jog) {</div>
<div class="line">    <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, <span class="stringliteral">&quot;#%d j=%d&quot;</span>, motor_num, requested_pos_cnts);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, fmt, coord_num, requested_pos_cnts, q100);</div>
<div class="line">  }</div>
<div class="line">  pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  free( axis);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4451ae36e7b01c349d510249f52611da"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_move_or_jog_preset_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>preset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>use_jog</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>move using a preset value returns 0 on success, non-zero on error </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>Our motor </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">preset</td><td>the name of the preset </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">use_jog</td><td>[in[ 1 to force jog, 0 to try motion prog </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02776">2776</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                       {</div>
<div class="line">  <span class="keywordtype">double</span> pos;</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line">  <span class="keywordtype">int</span> rtn;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( preset == NULL || *preset == 0) {</div>
<div class="line">    <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s Move Aborted&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  err = <a class="code" href="lsredis_8c.html#a1ad60526a09ca679f39174ce5d773abe">lsredis_find_preset</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, preset, &amp;pos);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( err != 0)</div>
<div class="line">    rtn = <a class="code" href="lspmac_8c.html#a2ab30559739e0232331f53d16c0cb5ac" title="Move method for normal stepper and servo motor objects Returns non-zero on abort, zero if OK...">lspmac_move_or_jog_abs_queue</a>( mp, pos, use_jog);</div>
<div class="line">  <span class="keywordflow">else</span> {</div>
<div class="line">    <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s Move Aborted&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">    rtn = 1;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="acd26454acc150847b01717f60f956674"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_move_preset_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>preset_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Move a given motor to one of its preset positions. </p>
<p>No movement if the preset is not found. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mp</td><td>lspmac motor pointer </td></tr>
    <tr><td class="paramname">name</td><td>Name of the preset to use </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02358">2358</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                                     {</div>
<div class="line">  <span class="keywordtype">double</span> pos;</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_move_preset_queue: Called with motor %s and preset named &#39;%s&#39;&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, preset_name);</div>
<div class="line"></div>
<div class="line">  err = <a class="code" href="lsredis_8c.html#a1ad60526a09ca679f39174ce5d773abe">lsredis_find_preset</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, preset_name, &amp;pos);</div>
<div class="line">  <span class="keywordflow">if</span>( err == 0)</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line"></div>
<div class="line">  err = mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a38b6eee046c3ceff84f908af3335ebcf" title="function to move the motor">moveAbs</a>( mp, pos);</div>
<div class="line">  <span class="keywordflow">if</span>( !err)</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_move_preset_queue: moving %s to preset &#39;%s&#39; (%f)&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, preset_name, pos);</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// the abort event should have been sent in moveAbs</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">return</span> err;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4c4e5e996755d21603e0afdd41ab9cd4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_moveabs_blight_factor_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>pos</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02551">2551</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                                        {</div>
<div class="line">  <span class="keywordtype">char</span> *fmt;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( pos &gt;= 60 &amp;&amp; pos &lt;= 140) {</div>
<div class="line">    pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">    *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a> = pos;</div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a> =           pos;</div>
<div class="line">    pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">    pthread_mutex_lock( &amp;(<a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">    fmt = <a class="code" href="lsredis_8c.html#ac1994e56114b2315294527d76311f829" title="return a copy of the key&#39;s string value">lsredis_getstr</a>( <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a91c38b2072d878b71f4e77de2f1375a4" title="special format string to create text array for putting the position back into redis">redis_fmt</a>);</div>
<div class="line">    <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a8838915ebb6f9989944117c8197d5e86" title="conversion from counts to units: 0.0 means not loaded yet">u2c</a>, fmt, pos / 100.0);</div>
<div class="line">    free( fmt);</div>
<div class="line">    pthread_mutex_unlock( &amp;(<a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a38b6eee046c3ceff84f908af3335ebcf" title="function to move the motor">moveAbs</a>( <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>, <a class="code" href="lspmac_8c.html#acc46bdddee59bd8c5ad662b3fd445e9f" title="get the motor position (with locking)">lspmac_getPosition</a>( <a class="code" href="lspmac_8c.html#ad53a42cfaa04eff0336a44c8c9986333" title="Optical zoom.">zoom</a>));</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa94d5a726be9f97dee7a1889a759e0a7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_moveabs_bo_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>requested_position</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Move method for binary i/o motor objects. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>A binary i/o motor object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">requested_position</td><td>a 1 or a 0 request to move </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02432">2432</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                {</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8cdc94c6e2478b12ce942d4cf1d7499" title="The position as requested by the user.">requested_position</a> = requested_position == 0.0 ? 0.0 : 1.0;</div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a> = requested_position == 0.0 ? 0 : 1;</div>
<div class="line"></div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a>    = 1;</div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a68c471836f52707fa8582f7860cf500f" title="set to 1 when motion has been verified to have started">motion_seen</a> = 0;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a70291ddfe7994c0bec7fc2287cb6dd89" title="Format string to write requested position to PMAC used for binary io.">write_fmt</a>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a>);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="acbe3a8e54208048506e77b365b4c0f58"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_moveabs_flight_factor_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>pos</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02528">2528</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                                        {</div>
<div class="line">  <span class="keywordtype">char</span> *fmt;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( pos &gt;= 60 &amp;&amp; pos &lt;= 140) {</div>
<div class="line">    pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">    *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a> = pos;</div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a> =           pos;</div>
<div class="line">    pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">    pthread_mutex_lock( &amp;(<a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">    fmt = <a class="code" href="lsredis_8c.html#ac1994e56114b2315294527d76311f829" title="return a copy of the key&#39;s string value">lsredis_getstr</a>( <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a91c38b2072d878b71f4e77de2f1375a4" title="special format string to create text array for putting the position back into redis">redis_fmt</a>);</div>
<div class="line">    <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a8838915ebb6f9989944117c8197d5e86" title="conversion from counts to units: 0.0 means not loaded yet">u2c</a>, fmt, pos / 100.0);</div>
<div class="line">    free( fmt);</div>
<div class="line"></div>
<div class="line">    pthread_mutex_unlock( &amp;(<a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a38b6eee046c3ceff84f908af3335ebcf" title="function to move the motor">moveAbs</a>( <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>, <a class="code" href="lspmac_8c.html#acc46bdddee59bd8c5ad662b3fd445e9f" title="get the motor position (with locking)">lspmac_getPosition</a>( <a class="code" href="lspmac_8c.html#ad53a42cfaa04eff0336a44c8c9986333" title="Optical zoom.">zoom</a>));</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa3c75b8bbde4b8b8ff2b416eabe45552"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_moveabs_frontlight_oo_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>pos</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>"move" frontlight on/off </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02515">2515</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                                        {</div>
<div class="line">  pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a> = pos;</div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a> =           pos;</div>
<div class="line">  pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  <span class="keywordflow">if</span>( pos == 0.0) {</div>
<div class="line">    <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a38b6eee046c3ceff84f908af3335ebcf" title="function to move the motor">moveAbs</a>( <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>, 0.0);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a38b6eee046c3ceff84f908af3335ebcf" title="function to move the motor">moveAbs</a>( <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>, <a class="code" href="lspmac_8c.html#acc46bdddee59bd8c5ad662b3fd445e9f" title="get the motor position (with locking)">lspmac_getPosition</a>( <a class="code" href="lspmac_8c.html#ad53a42cfaa04eff0336a44c8c9986333" title="Optical zoom.">zoom</a>));</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adafed595ff5fcd7667175a9e730dbb8d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_moveabs_fshut_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>requested_position</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Move method for the fast shutter. </p>
<p>Slightly more complicated than a binary io as some flags need to be set up. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mp</td><td>The fast shutter motor instance </td></tr>
    <tr><td class="paramname">requested_position</td><td>1 (open) or 0 (close), really </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02402">2402</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                  {</div>
<div class="line">  pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8cdc94c6e2478b12ce942d4cf1d7499" title="The position as requested by the user.">requested_position</a> = requested_position;</div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a>    = 1;</div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a68c471836f52707fa8582f7860cf500f" title="set to 1 when motion has been verified to have started">motion_seen</a> = 0;</div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a> = requested_position;</div>
<div class="line">  <span class="keywordflow">if</span>( requested_position != 0) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">   <span class="comment">// ScanEnable=0, ManualEnable=1, ManualOn=1</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, <span class="stringliteral">&quot;M1124=0 M1125=1 M1126=1&quot;</span>);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// ManualOn=0, ManualEnable=0, ScanEnable=1</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, <span class="stringliteral">&quot;M1126=0 M1125=0 M1124=1&quot;</span>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1ef1fd07d6dfe8071eb0f696945bcab5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_moveabs_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>requested_position</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Use coordinate system motion program, if available, to move motor to requested position. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>The motor to move </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">requested_position</td><td>Where to move it </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02804">2804</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                            {</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="lspmac_8c.html#a2ab30559739e0232331f53d16c0cb5ac" title="Move method for normal stepper and servo motor objects Returns non-zero on abort, zero if OK...">lspmac_move_or_jog_abs_queue</a>( mp, requested_position, 0);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9a443655e2971b0484a78e99c4c18c1a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_moveabs_timed_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>delta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>timed motor move </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mp</td><td>Our motor object </td></tr>
    <tr><td class="paramname">start</td><td>Beginning of motion </td></tr>
    <tr><td class="paramname">delta</td><td>Distance to move </td></tr>
    <tr><td class="paramname">time</td><td>to move it in (secs) </td></tr>
  </table>
  </dd>
</dl>
<p>&lt; Flags needed for wait routine </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02458">2458</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                  {</div>
<div class="line">  <span class="comment">// 240                LS-CAT Timed X move</span></div>
<div class="line">  <span class="comment">//            Q10    = Starting X value (cnts)</span></div>
<div class="line">  <span class="comment">//            Q11    = Delta X value   (cnts)</span></div>
<div class="line">  <span class="comment">//            Q12    = Time to run between the two points (mSec)</span></div>
<div class="line">  <span class="comment">//            Q13    = Acceleration time (msecs)</span></div>
<div class="line">  <span class="comment">//            Q100   = 1 &lt;&lt; (coord sys no - 1)</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">int</span> q10;       <span class="comment">// Starting value (counts)</span></div>
<div class="line">  <span class="keywordtype">int</span> q11;       <span class="comment">// Delta (counts)</span></div>
<div class="line">  <span class="keywordtype">int</span> q12;       <span class="comment">// Time to run (msecs)</span></div>
<div class="line">  <span class="keywordtype">int</span> q13;       <span class="comment">// Acceleration time (msecs)</span></div>
<div class="line">  <span class="keywordtype">int</span> q100;      <span class="comment">// 1 &lt;&lt; (coord sys no - 1)</span></div>
<div class="line">  <span class="keywordtype">int</span> coord_num; <span class="comment">// our coordinate number</span></div>
<div class="line">  <span class="keywordtype">double</span> u2c;</div>
<div class="line">  <span class="keywordtype">double</span> neutral_pos;</div>
<div class="line">  <span class="keywordtype">double</span> max_accel;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  u2c         = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a8838915ebb6f9989944117c8197d5e86" title="conversion from counts to units: 0.0 means not loaded yet">u2c</a>);</div>
<div class="line">  max_accel   = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a50cf4c0711cea164e332bc34705a1a68" title="our maximum acceleration (cts/msec^2)">max_accel</a>);</div>
<div class="line">  coord_num   = <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a5614e003272e8323f8809bf7b6559532" title="coordinate system this motor belongs to (0 if none)">coord_num</a>);</div>
<div class="line">  neutral_pos = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae931e9bc9fc2fa82ca649334fc052fbe" title="zero offset">neutral_pos</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( u2c == 0.0 || time &lt;= 0.0 || max_accel &lt;= 0.0) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Shouldn&#39;t try moving a motor that has bad motion parameters</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a>    = 1;          </div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a68c471836f52707fa8582f7860cf500f" title="set to 1 when motion has been verified to have started">motion_seen</a> = 0;</div>
<div class="line"></div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8cdc94c6e2478b12ce942d4cf1d7499" title="The position as requested by the user.">requested_position</a> = start + delta;</div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a> = u2c * (mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8cdc94c6e2478b12ce942d4cf1d7499" title="The position as requested by the user.">requested_position</a> + neutral_pos);</div>
<div class="line">  q10 = mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a>;</div>
<div class="line">  q11 = u2c * delta;</div>
<div class="line">  q12 = 1000 * time;</div>
<div class="line">  q13 = q11 / q12 / max_accel;</div>
<div class="line">  q100 = 1 &lt;&lt; (coord_num - 1);</div>
<div class="line">  pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, <span class="stringliteral">&quot;&amp;%d Q10=%d Q11=%d Q12=%d Q13=%d Q100=%d B240R&quot;</span>, coord_num, q10, q11, q12, q13, q100);</div>
<div class="line">  pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a55ffe2b135854f75079ecd39d507d3b4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_moveabs_wait </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>timeout_secs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for motor to finish moving. </p>
<p>Assume motion already queued, now just wait </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>The motor object to wait for </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02826">2826</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                           {</div>
<div class="line">  <span class="keyword">struct </span>timespec timeout, <a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands...">now</a>;</div>
<div class="line">  <span class="keywordtype">double</span> isecs, fsecs;</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Copy the queue item for the most recent move request</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  clock_gettime( CLOCK_REALTIME, &amp;<a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands...">now</a>);</div>
<div class="line"></div>
<div class="line">  fsecs = modf( timeout_secs, &amp;isecs);</div>
<div class="line"></div>
<div class="line">  timeout.tv_sec  = <a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands...">now</a>.tv_sec  + (long)floor( isecs);</div>
<div class="line">  timeout.tv_nsec = <a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands...">now</a>.tv_nsec + (long)floor( fsecs * 1.0e9);</div>
<div class="line">  </div>
<div class="line">  timeout.tv_sec  += timeout.tv_nsec / 1000000000;</div>
<div class="line">  timeout.tv_nsec %= 1000000000;</div>
<div class="line"></div>
<div class="line">  err = 0;</div>
<div class="line">  pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">while</span>( err == 0 &amp;&amp; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a59a7f007476b2428fd3c5bd7f24440e8" title="Motion command verified sent to pmac.">command_sent</a> == 0)</div>
<div class="line">    err = pthread_cond_timedwait( &amp;mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa0ea4108b8fed5b41ff91ca7266f3d84" title="used to signal when a motor is done moving">cond</a>, &amp;mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>, &amp;timeout);</div>
<div class="line">  pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  <span class="keywordflow">if</span>( err != 0) {</div>
<div class="line">    <span class="keywordflow">if</span>( err != ETIMEDOUT) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_moveabs_wait: unexpected error from timedwait: %d  tv_sec %ld   tv_nsec %ld&quot;</span>, err, timeout.tv_sec, timeout.tv_nsec);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// wait for the motion to have started</span></div>
<div class="line">  <span class="comment">// This will time out if the motion ends before we can read the status back</span></div>
<div class="line">  <span class="comment">// hence the added complication of time stamp of the sent packet.</span></div>
<div class="line"></div>
<div class="line">  err = 0;</div>
<div class="line">  pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  <span class="keywordflow">while</span>( err == 0 &amp;&amp; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a68c471836f52707fa8582f7860cf500f" title="set to 1 when motion has been verified to have started">motion_seen</a> == 0)</div>
<div class="line">    err = pthread_cond_timedwait( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa0ea4108b8fed5b41ff91ca7266f3d84" title="used to signal when a motor is done moving">cond</a>), &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>), &amp;timeout);</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">if</span>( err != 0) {</div>
<div class="line">    <span class="keywordflow">if</span>( err != ETIMEDOUT) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_moveabs_wait: unexpected error from timedwait: %d  tv_sec %ld   tv_nsec %ld&quot;</span>, err, timeout.tv_sec, timeout.tv_nsec);</div>
<div class="line">    }</div>
<div class="line">    pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// wait for the motion that we know has started to finish</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  err = 0;</div>
<div class="line">  <span class="keywordflow">while</span>( err == 0 &amp;&amp; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a>)</div>
<div class="line">    err = pthread_cond_timedwait( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa0ea4108b8fed5b41ff91ca7266f3d84" title="used to signal when a motor is done moving">cond</a>), &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>), &amp;timeout);</div>
<div class="line"></div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">if</span>( err != 0) {</div>
<div class="line">    <span class="keywordflow">if</span>( err != ETIMEDOUT) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_moveabs_wait: unexpected error from timedwait: %d  tv_sec %ld   tv_nsec %ld&quot;</span>, err, timeout.tv_sec, timeout.tv_nsec);</div>
<div class="line">    }</div>
<div class="line">    pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// if return code was not 0 then we know we shouldn&#39;t wait for not_done flag.</span></div>
<div class="line">  <span class="comment">// In this case the motion ended before we read the status registers</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a98ad3d807b8826439b710e97bf53b478"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_movedac_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>requested_position</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Move method for dac motor objects (ie, lights) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>Our motor </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">requested_position</td><td>Desired x postion (look up and send y position) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02292">2292</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                            {</div>
<div class="line">  <span class="keywordtype">double</span> u2c;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  u2c = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a8838915ebb6f9989944117c8197d5e86" title="conversion from counts to units: 0.0 means not loaded yet">u2c</a>);</div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8cdc94c6e2478b12ce942d4cf1d7499" title="The position as requested by the user.">requested_position</a> = requested_position;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a> &gt; 0 &amp;&amp; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a> != NULL) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// u2c scales the lookup table value</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a> = u2c * <a class="code" href="lspmac_8c.html#a55b882be15d56a2a777f2b1f92901b7d" title="Look up table support for motor positions (think x=zoom, y=light intensity) use a lookup table to fin...">lspmac_lut</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>, requested_position);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_movedac_queue: motor %s requested position %f  requested counts %d  u2c %f&quot;</span>,</div>
<div class="line">                           mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8cdc94c6e2478b12ce942d4cf1d7499" title="The position as requested by the user.">requested_position</a>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a>, u2c);</div>
<div class="line"></div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a>    = 1;</div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a68c471836f52707fa8582f7860cf500f" title="set to 1 when motion has been verified to have started">motion_seen</a> = 0;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, <span class="stringliteral">&quot;%s=%d&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a05dff021221abbc1bf656039fffb3275" title="controlling mvariable as a string">dac_mvar</a>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a82cf6576d41c31fce48a59db2d22188b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_movezoom_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>requested_position</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Move method for the zoom motor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>the zoom motor </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">requested_position</td><td>our desired zoom </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02325">2325</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                             {</div>
<div class="line">  <span class="keywordtype">double</span> <a class="code" href="namespacemk__pgpmac__redis.html#a34220d58136fb95853f54ed51a130f79">y</a>;</div>
<div class="line">  <span class="keywordtype">int</span> motor_num;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  motor_num = <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ad6a51cca3c7e5f79168e5c33fd9e736b" title="pmac motor number">motor_num</a>);</div>
<div class="line"></div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8cdc94c6e2478b12ce942d4cf1d7499" title="The position as requested by the user.">requested_position</a> = requested_position;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a> &gt; 0 &amp;&amp; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a> != NULL) {</div>
<div class="line">    y = <a class="code" href="lspmac_8c.html#a55b882be15d56a2a777f2b1f92901b7d" title="Look up table support for motor positions (think x=zoom, y=light intensity) use a lookup table to fin...">lspmac_lut</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>, requested_position);</div>
<div class="line"></div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a> = (int)y;</div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a>    = 1;</div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a68c471836f52707fa8582f7860cf500f" title="set to 1 when motion has been verified to have started">motion_seen</a> = 0;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, <span class="stringliteral">&quot;#%d j=%d&quot;</span>, motor_num, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a>);</div>
<div class="line"></div>
<div class="line">  }</div>
<div class="line">  pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a68886d1b658e7b1d996c07e9dbcd9c15"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_next_state </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>State machine logic. </p>
<p>Given the current state, generate the next one </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02123">2123</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                         {</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Connect to the pmac and perhaps initialize it.</span></div>
<div class="line">  <span class="comment">// OK, this is slightly more than just the state</span></div>
<div class="line">  <span class="comment">// machine logic...</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> == <a class="code" href="lspmac_8c.html#a7eb86ecf0789ab9555de1e03a4c73567">LS_PMAC_STATE_DETACHED</a>) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// TODO (eventually)</span></div>
<div class="line">    <span class="comment">// This ip address wont change in a single PMAC installation</span></div>
<div class="line">    <span class="comment">// We&#39;ll need to audit the code if we decide to implement</span></div>
<div class="line">    <span class="comment">// multiple PMACs so might as well wait til then.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="lspmac_8c.html#aae020ea2478b41702ce8b7d20b2560be" title="Connect to the PMAC socket.">lsConnect</a>( <span class="stringliteral">&quot;192.6.94.5&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// If the connect was successful we can proceed with the initialization</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> != <a class="code" href="lspmac_8c.html#a7eb86ecf0789ab9555de1e03a4c73567">LS_PMAC_STATE_DETACHED</a>) {</div>
<div class="line">      <a class="code" href="lspmac_8c.html#ac5745f25f242edf02f7b9b7c77ed6126" title="Reset the PMAC socket from the PMAC side.">lspmac_SockFlush</a>();</div>
<div class="line">      </div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Harvest the I and M variables in case we need them</span></div>
<div class="line">      <span class="comment">// one day.</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#a50e9c0a06654fd81b3446a6e54ff12c3" title="flag set at initialization to send m vars to db">getmvars</a>) {</div>
<div class="line">        <a class="code" href="lspmac_8c.html#a983d291506dc387ba5d71a97766e8a25" title="Request the values of all the M variables.">lspmac_GetAllMVars</a>();</div>
<div class="line">        <a class="code" href="lspmac_8c.html#a50e9c0a06654fd81b3446a6e54ff12c3" title="flag set at initialization to send m vars to db">getmvars</a> = 0;</div>
<div class="line">      }</div>
<div class="line">      </div>
<div class="line">      <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#a07b7b8254772075e6a4ced500b589c36" title="flag set at initialization to send i vars to db">getivars</a>) {</div>
<div class="line">        <a class="code" href="lspmac_8c.html#ac24bdffa893a9bf7c9cb084fe1417f6f" title="Request the values of all the I variables.">lspmac_GetAllIVars</a>();</div>
<div class="line">        <a class="code" href="lspmac_8c.html#a07b7b8254772075e6a4ced500b589c36" title="flag set at initialization to send i vars to db">getivars</a> = 0;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Check the command queue and perhaps go to the &quot;Send Command&quot; state.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> == <a class="code" href="lspmac_8c.html#a37741af675425d61c876cc30ae6c99d0">LS_PMAC_STATE_IDLE</a>) {</div>
<div class="line">    <span class="keywordtype">int</span> goodtogo;</div>
<div class="line">    goodtogo = 0;</div>
<div class="line">    pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#a2ff142105e17d933871d09759e7082f8" title="Keep too many processes from sending commands at once.">lspmac_ascii_mutex</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#afb9e57459496c33e0da5cdb773113a61" title="flag for condition to wait for">lspmac_ascii_busy</a>==0 &amp;&amp; <a class="code" href="lspmac_8c.html#a09701de0235acaeae5abf4e04268be33">lspmac_dpascii_on</a> != <a class="code" href="lspmac_8c.html#a9b0d9e2c858f6f0178be2bfdd96d4c05">lspmac_dpascii_off</a>)</div>
<div class="line">      goodtogo = 1;</div>
<div class="line">    pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#a2ff142105e17d933871d09759e7082f8" title="Keep too many processes from sending commands at once.">lspmac_ascii_mutex</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( goodtogo)</div>
<div class="line">      <a class="code" href="lspmac_8c.html#ad59af2883f1a6f2ee5daeebb7282f8a6">lspmac_SockSendDPqueue</a>();</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> == <a class="code" href="lspmac_8c.html#a37741af675425d61c876cc30ae6c99d0">LS_PMAC_STATE_IDLE</a> &amp;&amp; <a class="code" href="lspmac_8c.html#ad62b1f9e907acc3de9f3d6a05d55829e" title="points to next empty PMAC command queue position">ethCmdOn</a> != <a class="code" href="lspmac_8c.html#ae85caec6f4ddb2fc52ca14a26549ab08" title="points to current command (or none if == ethCmdOn)">ethCmdOff</a>)</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a7d8f34fc599cc08c1a9d2cd62ccbb20a">LS_PMAC_STATE_SC</a>;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Set the events flag</span></div>
<div class="line">  <span class="comment">// to tell poll what we are waiting for.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">switch</span>( <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a>) {</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a7eb86ecf0789ab9555de1e03a4c73567">LS_PMAC_STATE_DETACHED</a>:</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// there shouldn&#39;t be a valid fd, so ignore the events</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba" title="our poll structure">pmacfd</a>.events = 0;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a37741af675425d61c876cc30ae6c99d0">LS_PMAC_STATE_IDLE</a>:</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#ad62b1f9e907acc3de9f3d6a05d55829e" title="points to next empty PMAC command queue position">ethCmdOn</a> == <a class="code" href="lspmac_8c.html#ae85caec6f4ddb2fc52ca14a26549ab08" title="points to current command (or none if == ethCmdOn)">ethCmdOff</a>) {</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Anytime we are idle we want to</span></div>
<div class="line">      <span class="comment">// get the status of the PMAC</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">      <a class="code" href="lspmac_8c.html#a6dedca923b3a6904395ad02158e2e96f" title="Request a status update from the PMAC.">lspmac_get_status</a>();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// These states require that we listen for packets</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a63356b0c18fcb186f456c12c6e927d84">LS_PMAC_STATE_WACK_NFR</a>:</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a5eba9ef09d4316e803b9d75bd3104f43">LS_PMAC_STATE_WACK</a>:</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#adef540911028fda73e8bbf0aa6ad39e9">LS_PMAC_STATE_WACK_CC</a>:</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a3e0a62cd9a1212419ad3615c34bdc65a">LS_PMAC_STATE_WACK_RR</a>:</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a27ee6c39d58604c8aa9bd6c249c4833f">LS_PMAC_STATE_WCR</a>:</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a591822cc92f76a39b293c2e90b322db2">LS_PMAC_STATE_WGB</a>:</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a220b39710719cfe8b500d51819e8efeb">LS_PMAC_STATE_GMR</a>:</div>
<div class="line">    <a class="code" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba" title="our poll structure">pmacfd</a>.events = POLLIN;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">    </div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// These states require that we send packets out.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a7d8f34fc599cc08c1a9d2cd62ccbb20a">LS_PMAC_STATE_SC</a>:</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#abbd709b56a71eb1fc6adc9063605d243">LS_PMAC_STATE_CR</a>:</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#add5325f4a84e4fe05f558880349485ea">LS_PMAC_STATE_RR</a>:</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a5f4ff8874677aac48a4c675f2c1ca4e9">LS_PMAC_STATE_GB</a>:</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Sad fact: PMAC will fail to process commands if we send them too quickly.</span></div>
<div class="line">    <span class="comment">// We deal with that by waiting a tad before we let poll tell us the PMAC socket is ready to write.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    gettimeofday( &amp;<a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands...">now</a>, NULL);</div>
<div class="line">    <span class="keywordflow">if</span>(  ((<a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands...">now</a>.tv_sec * 1000000. + <a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands...">now</a>.tv_usec) - (pmac_time_sent.tv_sec * 1000000. + pmac_time_sent.tv_usec)) &lt; <a class="code" href="lspmac_8c.html#a59f5f5218e25332dbf64f216aec116e5" title="Minimum time between commands to the pmac.">PMAC_MIN_CMD_TIME</a>) {</div>
<div class="line">      <a class="code" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba" title="our poll structure">pmacfd</a>.events = 0;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <a class="code" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba" title="our poll structure">pmacfd</a>.events = POLLOUT;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a637fc023d1255f3519b2eee01913d64d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_pmacmotor_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read the position and status of a normal PMAC motor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>Our motor </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01350">1350</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                             {</div>
<div class="line">  <span class="keywordtype">char</span> s[512], *sp;</div>
<div class="line">  <span class="keywordtype">int</span> homing1, homing2;</div>
<div class="line">  <span class="keywordtype">double</span> u2c;</div>
<div class="line">  <span class="keywordtype">double</span> neutral_pos;</div>
<div class="line">  <span class="keywordtype">int</span> motor_num;</div>
<div class="line">  <span class="keywordtype">char</span> *fmt;</div>
<div class="line">  <span class="keywordtype">int</span> status_changed;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// if this time and last time were both &quot;in position&quot;</span></div>
<div class="line">  <span class="comment">// and the position changed significantly then log the event</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// On E omega has been observed to change by 0x10000 on its own</span></div>
<div class="line">  <span class="comment">// with no real motion.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6a412224c09268c1dc92de9c2a1a2512" title="local copy of status2">status2</a> &amp; 1 &amp;&amp; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6a412224c09268c1dc92de9c2a1a2512" title="local copy of status2">status2</a> == *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a2b33ef6e12717459c1e9967cc6e659c6" title="Sectond 24 bit PMAC motor status word.">status2_p</a> &amp;&amp; abs( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae5c7aea45b9637a1817be246688fd980" title="local copy of actual counts so only our mutex is needed to read">actual_pos_cnts</a> - *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a>) &gt; 256) {</div>
<div class="line">    <span class="comment">//    lslogging_log_message( &quot;Instantaneous change: %s old status1: %0x, new status1: %0x, old status2: %0x, new status2: %0x, old cnts: %0x, new cnts: %0x&quot;,</span></div>
<div class="line">    <span class="comment">//                     mp-&gt;name, mp-&gt;status1, *mp-&gt;status1_p, mp-&gt;status2, *mp-&gt;status2_p, mp-&gt;actual_pos_cnts, *mp-&gt;actual_pos_cnts_p);</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// At this point we&#39;ll just log the event and return</span></div>
<div class="line">    <span class="comment">// There is no reason to believe the change is real.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// There is a non-zero probability that the first value is the bad one and any value afterwards will be taken as</span></div>
<div class="line">    <span class="comment">// wrong.  Homing (or moving) the motor should fix this.  There is a non-zero probably that it can happen</span></div>
<div class="line">    <span class="comment">// two or more times in a row after moving.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// TODO: account for the case where mp-&gt;actual_pos_cnts is the bad value.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// TODO: Is this a problem when the motor is moving?  Can we detect it?</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// TODO: Think of the correct change value here (currently 256) that works for all motors</span></div>
<div class="line">    <span class="comment">// or have this value configurable</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// Send an event if inPosition has changed</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( (mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6a412224c09268c1dc92de9c2a1a2512" title="local copy of status2">status2</a> &amp; 0x000001) != (*mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a2b33ef6e12717459c1e9967cc6e659c6" title="Sectond 24 bit PMAC motor status word.">status2_p</a> &amp; 0x000001)) {</div>
<div class="line">    <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s %s&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, (*mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a2b33ef6e12717459c1e9967cc6e659c6" title="Sectond 24 bit PMAC motor status word.">status2_p</a> &amp; 0x000001) ? <span class="stringliteral">&quot;In Position&quot;</span> : <span class="stringliteral">&quot;Moving&quot;</span>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Get some values we might need later</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  u2c         = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a8838915ebb6f9989944117c8197d5e86" title="conversion from counts to units: 0.0 means not loaded yet">u2c</a>);</div>
<div class="line">  motor_num   = <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ad6a51cca3c7e5f79168e5c33fd9e736b" title="pmac motor number">motor_num</a>);</div>
<div class="line">  neutral_pos = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae931e9bc9fc2fa82ca649334fc052fbe" title="zero offset">neutral_pos</a>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// maybe look for omega zero crossing</span></div>
<div class="line">  <span class="comment">// </span></div>
<div class="line">  <span class="keywordflow">if</span>( motor_num == 1 &amp;&amp; <a class="code" href="lspmac_8c.html#ae06d2291c1996ffb7dcf7d132e25b038" title="Indicate we&#39;d really like to know when omega crosses zero.">omega_zero_search</a> &amp;&amp; *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a> &gt;=0 &amp;&amp; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae5c7aea45b9637a1817be246688fd980" title="local copy of actual counts so only our mutex is needed to read">actual_pos_cnts</a> &lt; 0) {</div>
<div class="line">    <span class="keywordtype">int</span> secs, nsecs;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#aea11895d2ec4a3324f4baa9d24cd192d" title="rate (cnts/sec) that omega was traveling when it crossed zero">omega_zero_velocity</a> &gt; 0.0) {</div>
<div class="line">      secs = *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a> / <a class="code" href="lspmac_8c.html#aea11895d2ec4a3324f4baa9d24cd192d" title="rate (cnts/sec) that omega was traveling when it crossed zero">omega_zero_velocity</a>;</div>
<div class="line">      nsecs = (*mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a> / <a class="code" href="lspmac_8c.html#aea11895d2ec4a3324f4baa9d24cd192d" title="rate (cnts/sec) that omega was traveling when it crossed zero">omega_zero_velocity</a> - secs) * 1000000000;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">      <a class="code" href="lspmac_8c.html#ae6631a094accc469661805bdf80fc6d8" title="Time we believe that omega crossed zero.">omega_zero_time</a>.tv_sec = <a class="code" href="lspmac_8c.html#ae3bf4c21e9e375862e5a955b539fb073" title="Time the status was read.">lspmac_status_time</a>.tv_sec  - secs;</div>
<div class="line">      <a class="code" href="lspmac_8c.html#ae6631a094accc469661805bdf80fc6d8" title="Time we believe that omega crossed zero.">omega_zero_time</a>.tv_nsec= <a class="code" href="lspmac_8c.html#ae3bf4c21e9e375862e5a955b539fb073" title="Time the status was read.">lspmac_status_time</a>.tv_nsec;</div>
<div class="line">      <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#ae6631a094accc469661805bdf80fc6d8" title="Time we believe that omega crossed zero.">omega_zero_time</a>.tv_nsec &lt; nsecs) {</div>
<div class="line">        <a class="code" href="lspmac_8c.html#ae6631a094accc469661805bdf80fc6d8" title="Time we believe that omega crossed zero.">omega_zero_time</a>.tv_sec  -= 1;</div>
<div class="line">        <a class="code" href="lspmac_8c.html#ae6631a094accc469661805bdf80fc6d8" title="Time we believe that omega crossed zero.">omega_zero_time</a>.tv_nsec += 1000000000;</div>
<div class="line">      }</div>
<div class="line">      <a class="code" href="lspmac_8c.html#ae6631a094accc469661805bdf80fc6d8" title="Time we believe that omega crossed zero.">omega_zero_time</a>.tv_nsec -= nsecs;</div>
<div class="line"></div>
<div class="line">      <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;omega crossed zero&quot;</span>);</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>(<span class="stringliteral">&quot;lspmac_pmacmotor_read: omega zero secs %d  nsecs %d ozt.tv_sec %ld  ozt.tv_nsec  %ld, motor cnts %d&quot;</span>,</div>
<div class="line">                            secs, nsecs, <a class="code" href="lspmac_8c.html#ae6631a094accc469661805bdf80fc6d8" title="Time we believe that omega crossed zero.">omega_zero_time</a>.tv_sec, <a class="code" href="lspmac_8c.html#ae6631a094accc469661805bdf80fc6d8" title="Time we believe that omega crossed zero.">omega_zero_time</a>.tv_nsec, *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a>);</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ae06d2291c1996ffb7dcf7d132e25b038" title="Indicate we&#39;d really like to know when omega crosses zero.">omega_zero_search</a> = 0;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// Make local copies so we can inspect them in other threads</span></div>
<div class="line">  <span class="comment">// without having to grab the status mutex</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#acb52b612b9237e8eec0b97fb1e76a35d" title="local copy of status1">status1</a> != *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a56c41875faf19c643e97c10519e6eb8c" title="First 24 bit PMAC motor status word.">status1_p</a> || mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6a412224c09268c1dc92de9c2a1a2512" title="local copy of status2">status2</a> != *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a2b33ef6e12717459c1e9967cc6e659c6" title="Sectond 24 bit PMAC motor status word.">status2_p</a>) {</div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#acb52b612b9237e8eec0b97fb1e76a35d" title="local copy of status1">status1</a> = *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a56c41875faf19c643e97c10519e6eb8c" title="First 24 bit PMAC motor status word.">status1_p</a>;</div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6a412224c09268c1dc92de9c2a1a2512" title="local copy of status2">status2</a> = *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a2b33ef6e12717459c1e9967cc6e659c6" title="Sectond 24 bit PMAC motor status word.">status2_p</a>;</div>
<div class="line">    status_changed = 1;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    status_changed = 0;</div>
<div class="line">  }</div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae5c7aea45b9637a1817be246688fd980" title="local copy of actual counts so only our mutex is needed to read">actual_pos_cnts</a> = *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a>;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// See if we are done moving, ie, in position</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6a412224c09268c1dc92de9c2a1a2512" title="local copy of status2">status2</a> &amp; 0x000001) {</div>
<div class="line">    <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a>) {</div>
<div class="line">      mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a> = 0;</div>
<div class="line">      pthread_cond_signal( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa0ea4108b8fed5b41ff91ca7266f3d84" title="used to signal when a motor is done moving">cond</a>));</div>
<div class="line">    }</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a> == 0) {</div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a> = 1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// See if the motor is moving</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">//                move timer                  homing</span></div>
<div class="line">  <span class="comment">//                  123456                    123456</span></div>
<div class="line">  <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#acb52b612b9237e8eec0b97fb1e76a35d" title="local copy of status1">status1</a> &amp; 0x020000 || mp-&gt;<a class="code" href="structlspmac__motor__struct.html#acb52b612b9237e8eec0b97fb1e76a35d" title="local copy of status1">status1</a> &amp; 0x000400) {</div>
<div class="line">    <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a68c471836f52707fa8582f7860cf500f" title="set to 1 when motion has been verified to have started">motion_seen</a> == 0) {</div>
<div class="line">      mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a68c471836f52707fa8582f7860cf500f" title="set to 1 when motion has been verified to have started">motion_seen</a> = 1;</div>
<div class="line">      pthread_cond_signal( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa0ea4108b8fed5b41ff91ca7266f3d84" title="used to signal when a motor is done moving">cond</a>));</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  mvwprintw( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>, 2, 1, <span class="stringliteral">&quot;%*s&quot;</span>, <a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line">  mvwprintw( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>, 2, 1, <span class="stringliteral">&quot;%*d cts&quot;</span>, <a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-6, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae5c7aea45b9637a1817be246688fd980" title="local copy of actual counts so only our mutex is needed to read">actual_pos_cnts</a>);</div>
<div class="line">  mvwprintw( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>, 3, 1, <span class="stringliteral">&quot;%*s&quot;</span>, <a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a> &gt;0 &amp;&amp; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a> != NULL) {</div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a> = <a class="code" href="lspmac_8c.html#a5afe5cd407b44f9c05ad4f1c4e4d5f6a">lspmac_rlut</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae5c7aea45b9637a1817be246688fd980" title="local copy of actual counts so only our mutex is needed to read">actual_pos_cnts</a>);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="keywordflow">if</span>( u2c != 0.0) {</div>
<div class="line">      mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a> = ((mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae5c7aea45b9637a1817be246688fd980" title="local copy of actual counts so only our mutex is needed to read">actual_pos_cnts</a> / u2c) - neutral_pos);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a> = mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae5c7aea45b9637a1817be246688fd980" title="local copy of actual counts so only our mutex is needed to read">actual_pos_cnts</a>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( status_changed || fabs(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae5f1f605a0f587500e627332ad4e5e7e" title="previous position reported to the database">reported_position</a> - mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a>) &gt;= <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aefa84c7592369090eec8b211caaa3a51" title="Change needs to be at least this big to report as a new position to the database.">update_resolution</a>)) {</div>
<div class="line">    fmt = <a class="code" href="lsredis_8c.html#ac1994e56114b2315294527d76311f829" title="return a copy of the key&#39;s string value">lsredis_getstr</a>(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a91c38b2072d878b71f4e77de2f1375a4" title="special format string to create text array for putting the position back into redis">redis_fmt</a>);</div>
<div class="line">    <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af94a0b2611136058ead4948fd7c858e3" title="how we report our position to the world">redis_position</a>, fmt, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a>);</div>
<div class="line">    free(fmt);</div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae5f1f605a0f587500e627332ad4e5e7e" title="previous position reported to the database">reported_position</a> = mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  fmt = <a class="code" href="lsredis_8c.html#ac1994e56114b2315294527d76311f829" title="return a copy of the key&#39;s string value">lsredis_getstr</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a25b13b65baf1b28c34012850809b0a3a" title="printf format">printf_fmt</a>);</div>
<div class="line">  snprintf( s, <span class="keyword">sizeof</span>(s)-1, fmt, 8, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a>);</div>
<div class="line">  s[<span class="keyword">sizeof</span>(s)-1] = 0;</div>
<div class="line">  free( fmt);</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// indicate limit problems</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af39d2e7a681d7c2fbdc39d53fab1a475" title="positive limit status">pos_limit_hit</a>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#acb52b612b9237e8eec0b97fb1e76a35d" title="local copy of status1">status1</a> &amp; 0x200000 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;0&quot;</span>);</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#afe13c86941928d20357f4f3e2a4d915a" title="negative limit status">neg_limit_hit</a>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#acb52b612b9237e8eec0b97fb1e76a35d" title="local copy of status1">status1</a> &amp; 0x400000 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;0&quot;</span>);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// set flag if we are not homed</span></div>
<div class="line">  homing1 = 0;</div>
<div class="line">  <span class="comment">//                        ~(homed flag)</span></div>
<div class="line">  <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa74108855693f94fc2ff76333c9fb6ac" title="Homing routine started.">homing</a> == 0  &amp;&amp; (~mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6a412224c09268c1dc92de9c2a1a2512" title="local copy of status2">status2</a> &amp; 0x000400) != 0) {</div>
<div class="line">    homing1 = 1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// set flag if we are homing and in open loop</span></div>
<div class="line">  homing2 = 0;</div>
<div class="line">  <span class="comment">//                         open loop</span></div>
<div class="line">  <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa74108855693f94fc2ff76333c9fb6ac" title="Homing routine started.">homing</a> == 1 &amp;&amp; (mp-&gt;<a class="code" href="structlspmac__motor__struct.html#acb52b612b9237e8eec0b97fb1e76a35d" title="local copy of status1">status1</a> &amp; 0x040000) != 0) {</div>
<div class="line">    homing2 = 1;</div>
<div class="line">  }</div>
<div class="line">  <span class="comment">// maybe reset homing flag</span></div>
<div class="line">  <span class="comment">//                        homed flag                       in position flag</span></div>
<div class="line">  <span class="keywordflow">if</span>( (mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa74108855693f94fc2ff76333c9fb6ac" title="Homing routine started.">homing</a> == 2) &amp;&amp; ((mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6a412224c09268c1dc92de9c2a1a2512" title="local copy of status2">status2</a> &amp; 0x000400) != 0) &amp;&amp; ((mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6a412224c09268c1dc92de9c2a1a2512" title="local copy of status2">status2</a> &amp; 0x000001) != 0)) {</div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa74108855693f94fc2ff76333c9fb6ac" title="Homing routine started.">homing</a> = 0;</div>
<div class="line">    <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s Homed&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  s[<span class="keyword">sizeof</span>(s)-1] = 0;</div>
<div class="line">  mvwprintw( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>, 3, 1, <span class="stringliteral">&quot;%*s&quot;</span>, <a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-6, s);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( status_changed) {</div>
<div class="line">    mvwprintw( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>, 4, 1, <span class="stringliteral">&quot;%*x&quot;</span>, <a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#acb52b612b9237e8eec0b97fb1e76a35d" title="local copy of status1">status1</a>);</div>
<div class="line">    mvwprintw( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>, 5, 1, <span class="stringliteral">&quot;%*x&quot;</span>, <a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6a412224c09268c1dc92de9c2a1a2512" title="local copy of status2">status2</a>);</div>
<div class="line">    sp = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line">    <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6a412224c09268c1dc92de9c2a1a2512" title="local copy of status2">status2</a> &amp; 0x000002)</div>
<div class="line">      sp = <span class="stringliteral">&quot;Following Warning&quot;</span>;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6a412224c09268c1dc92de9c2a1a2512" title="local copy of status2">status2</a> &amp; 0x000004)</div>
<div class="line">      sp = <span class="stringliteral">&quot;Following Error&quot;</span>;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6a412224c09268c1dc92de9c2a1a2512" title="local copy of status2">status2</a> &amp; 0x000020)</div>
<div class="line">      sp = <span class="stringliteral">&quot;I2T Amp Fault&quot;</span>;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6a412224c09268c1dc92de9c2a1a2512" title="local copy of status2">status2</a> &amp; 0x000008)</div>
<div class="line">      sp = <span class="stringliteral">&quot;Amp. Fault&quot;</span>;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6a412224c09268c1dc92de9c2a1a2512" title="local copy of status2">status2</a> &amp; 0x000800)</div>
<div class="line">      sp = <span class="stringliteral">&quot;Stopped on Limit&quot;</span>;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#acb52b612b9237e8eec0b97fb1e76a35d" title="local copy of status1">status1</a> &amp; 0x040000)</div>
<div class="line">      sp = <span class="stringliteral">&quot;Open Loop&quot;</span>;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( ~(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#acb52b612b9237e8eec0b97fb1e76a35d" title="local copy of status1">status1</a>) &amp; 0x080000)</div>
<div class="line">      sp = <span class="stringliteral">&quot;Motor Disabled&quot;</span>;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#acb52b612b9237e8eec0b97fb1e76a35d" title="local copy of status1">status1</a> &amp; 0x000400)</div>
<div class="line">      sp = <span class="stringliteral">&quot;Homing&quot;</span>;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( (mp-&gt;<a class="code" href="structlspmac__motor__struct.html#acb52b612b9237e8eec0b97fb1e76a35d" title="local copy of status1">status1</a> &amp; 0x600000) == 0x600000)</div>
<div class="line">      sp = <span class="stringliteral">&quot;Both Limits Tripped&quot;</span>;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#acb52b612b9237e8eec0b97fb1e76a35d" title="local copy of status1">status1</a> &amp; 0x200000)</div>
<div class="line">      sp = <span class="stringliteral">&quot;Positive Limit&quot;</span>;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#acb52b612b9237e8eec0b97fb1e76a35d" title="local copy of status1">status1</a> &amp; 0x400000)</div>
<div class="line">      sp = <span class="stringliteral">&quot;Negative Limit&quot;</span>;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( ~(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6a412224c09268c1dc92de9c2a1a2512" title="local copy of status2">status2</a>) &amp; 0x000400)</div>
<div class="line">      sp = <span class="stringliteral">&quot;Not Homed&quot;</span>;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#acb52b612b9237e8eec0b97fb1e76a35d" title="local copy of status1">status1</a> &amp; 0x020000)</div>
<div class="line">      sp = <span class="stringliteral">&quot;Moving&quot;</span>;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6a412224c09268c1dc92de9c2a1a2512" title="local copy of status2">status2</a> &amp; 0x000001)</div>
<div class="line">      sp = <span class="stringliteral">&quot;In Position&quot;</span>;</div>
<div class="line"></div>
<div class="line">    mvwprintw( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>, 6, 1, <span class="stringliteral">&quot;%*s&quot;</span>, <a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2, sp);</div>
<div class="line">  </div>
<div class="line">    <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa0a6bed8379c5b1f90a4eb826cde9136" title="A talky version of the status.">status_str</a>, sp);</div>
<div class="line">  }</div>
<div class="line">  wnoutrefresh( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>);</div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( homing1)</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a9fbadf816a842c8f131cf8ee47b54e29" title="Home the motor.">lspmac_home1_queue</a>( mp);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( homing2)</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a43e54631dc8de372854ebbb63ff28f70" title="Second stage of homing.">lspmac_home2_queue</a>( mp);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#a9c950ade1e11ec8d4c859d7f1bf94864" title="Time the status was read.">lspmac_status_last_time</a>.tv_sec  = <a class="code" href="lspmac_8c.html#ae3bf4c21e9e375862e5a955b539fb073" title="Time the status was read.">lspmac_status_time</a>.tv_sec;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a9c950ade1e11ec8d4c859d7f1bf94864" title="Time the status was read.">lspmac_status_last_time</a>.tv_nsec = <a class="code" href="lspmac_8c.html#ae3bf4c21e9e375862e5a955b539fb073" title="Time the status was read.">lspmac_status_time</a>.tv_nsec;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9627f30135aa7007bc4ab8dde905739a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a>* lspmac_pop_queue </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove the oldest queue item. </p>
<p>Used to send command to PMAC. Note that there is a separate reply index to ensure we've know to what command a reply is refering. Returns the item. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00652">652</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                     {</div>
<div class="line">  <a class="code" href="structlspmac__cmd__queue__struct.html" title="PMAC command queue item.">pmac_cmd_queue_t</a> *rtn;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#acc1bb77b9bcbc4d970f841a41fd274b3" title="manage access to the pmac command queue">pmac_queue_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#ad62b1f9e907acc3de9f3d6a05d55829e" title="points to next empty PMAC command queue position">ethCmdOn</a> == <a class="code" href="lspmac_8c.html#ae85caec6f4ddb2fc52ca14a26549ab08" title="points to current command (or none if == ethCmdOn)">ethCmdOff</a>)</div>
<div class="line">    rtn = NULL;</div>
<div class="line">  <span class="keywordflow">else</span> {</div>
<div class="line">    rtn = &amp;(<a class="code" href="lspmac_8c.html#a69e569a833fe7f202b92e860d1548f2b" title="PMAC command queue.">ethCmdQueue</a>[(<a class="code" href="lspmac_8c.html#ae85caec6f4ddb2fc52ca14a26549ab08" title="points to current command (or none if == ethCmdOn)">ethCmdOff</a>++) % <a class="code" href="lspmac_8c.html#a3fae557baafab24b7518dc84f5ef5a9b" title="Size of the PMAC command queue.">PMAC_CMD_QUEUE_LENGTH</a>]);</div>
<div class="line">    clock_gettime( CLOCK_REALTIME, &amp;(rtn-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a276ebc4b35c2554e4cb7377b60fd89b7" title="time this item was dequeued and sent to the pmac">time_sent</a>));</div>
<div class="line">  }</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#acc1bb77b9bcbc4d970f841a41fd274b3" title="manage access to the pmac command queue">pmac_queue_mutex</a>);</div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0f60f18dfe11c1c0299909521596be8f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a>* lspmac_pop_reply </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove the next command queue item that is waiting for a reply. </p>
<p>We always need a reply to know we are done with a given command. Returns the item. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00672">672</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                     {</div>
<div class="line">  <a class="code" href="structlspmac__cmd__queue__struct.html" title="PMAC command queue item.">pmac_cmd_queue_t</a> *rtn;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#acc1bb77b9bcbc4d970f841a41fd274b3" title="manage access to the pmac command queue">pmac_queue_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#ad62b1f9e907acc3de9f3d6a05d55829e" title="points to next empty PMAC command queue position">ethCmdOn</a> == <a class="code" href="lspmac_8c.html#a7a78524ada402bb74759a3dfc5f8a571" title="Used like ethCmdOff only to deal with the pmac reply to a command.">ethCmdReply</a>)</div>
<div class="line">    rtn = NULL;</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    rtn = &amp;(<a class="code" href="lspmac_8c.html#a69e569a833fe7f202b92e860d1548f2b" title="PMAC command queue.">ethCmdQueue</a>[(<a class="code" href="lspmac_8c.html#a7a78524ada402bb74759a3dfc5f8a571" title="Used like ethCmdOff only to deal with the pmac reply to a command.">ethCmdReply</a>++) % <a class="code" href="lspmac_8c.html#a3fae557baafab24b7518dc84f5ef5a9b" title="Size of the PMAC command queue.">PMAC_CMD_QUEUE_LENGTH</a>]);</div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#acc1bb77b9bcbc4d970f841a41fd274b3" title="manage access to the pmac command queue">pmac_queue_mutex</a>);</div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a84a6096d9bfff2bfb1506a216756ae28"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a>* lspmac_push_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *&#160;</td>
          <td class="paramname"><em>cmd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Put a new command on the queue. </p>
<p>Pointer is returned so caller can evaluate the time command was actually sent. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cmd</td><td>Command to send to the PMAC </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00628">628</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                      {</div>
<div class="line">  <a class="code" href="structlspmac__cmd__queue__struct.html" title="PMAC command queue item.">pmac_cmd_queue_t</a> *rtn;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#acc1bb77b9bcbc4d970f841a41fd274b3" title="manage access to the pmac command queue">pmac_queue_mutex</a>);</div>
<div class="line">  rtn = &amp;(<a class="code" href="lspmac_8c.html#a69e569a833fe7f202b92e860d1548f2b" title="PMAC command queue.">ethCmdQueue</a>[(<a class="code" href="lspmac_8c.html#ad62b1f9e907acc3de9f3d6a05d55829e" title="points to next empty PMAC command queue position">ethCmdOn</a>++) % <a class="code" href="lspmac_8c.html#a3fae557baafab24b7518dc84f5ef5a9b" title="Size of the PMAC command queue.">PMAC_CMD_QUEUE_LENGTH</a>]);</div>
<div class="line">  memcpy( rtn, cmd, <span class="keyword">sizeof</span>( <a class="code" href="structlspmac__cmd__queue__struct.html" title="PMAC command queue item.">pmac_cmd_queue_t</a>));</div>
<div class="line">  rtn-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a276ebc4b35c2554e4cb7377b60fd89b7" title="time this item was dequeued and sent to the pmac">time_sent</a>.tv_sec  = 0;</div>
<div class="line">  rtn-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a276ebc4b35c2554e4cb7377b60fd89b7" title="time this item was dequeued and sent to the pmac">time_sent</a>.tv_nsec = 0;</div>
<div class="line">  pthread_cond_signal( &amp;<a class="code" href="lspmac_8c.html#a8a25bd9c593c6985107f90f999ce0b08" title="wait for a command to be sent to PMAC before continuing">pmac_queue_cond</a>);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#acc1bb77b9bcbc4d970f841a41fd274b3" title="manage access to the pmac command queue">pmac_queue_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aaedae34bc18ac1742a232117c125d7b9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_Reset </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Clear the queue and put the PMAC into a known state. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00751">751</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                    {</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a37741af675425d61c876cc30ae6c99d0">LS_PMAC_STATE_IDLE</a>;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// clear queue</span></div>
<div class="line">  <a class="code" href="lspmac_8c.html#a7a78524ada402bb74759a3dfc5f8a571" title="Used like ethCmdOff only to deal with the pmac reply to a command.">ethCmdReply</a> = <a class="code" href="lspmac_8c.html#ad62b1f9e907acc3de9f3d6a05d55829e" title="points to next empty PMAC command queue position">ethCmdOn</a>;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ae85caec6f4ddb2fc52ca14a26549ab08" title="points to current command (or none if == ethCmdOn)">ethCmdOff</a>   = <a class="code" href="lspmac_8c.html#ad62b1f9e907acc3de9f3d6a05d55829e" title="points to next empty PMAC command queue position">ethCmdOn</a>;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#ac5745f25f242edf02f7b9b7c77ed6126" title="Reset the PMAC socket from the PMAC side.">lspmac_SockFlush</a>();</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a42a441a750044362f1d21bf9f08521cb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_reset_queue </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Clear the queue as part of PMAC reinitialization. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00615">615</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#acc1bb77b9bcbc4d970f841a41fd274b3" title="manage access to the pmac command queue">pmac_queue_mutex</a>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ad62b1f9e907acc3de9f3d6a05d55829e" title="points to next empty PMAC command queue position">ethCmdOn</a>    = 0;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ae85caec6f4ddb2fc52ca14a26549ab08" title="points to current command (or none if == ethCmdOn)">ethCmdOff</a>   = 0;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a7a78524ada402bb74759a3dfc5f8a571" title="Used like ethCmdOff only to deal with the pmac reply to a command.">ethCmdReply</a> = 0;</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#acc1bb77b9bcbc4d970f841a41fd274b3" title="manage access to the pmac command queue">pmac_queue_mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5afe5cd407b44f9c05ad4f1c4e4d5f6a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double lspmac_rlut </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nlut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>lut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>y</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">nlut</td><td>number of entries in lookup table </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">lut</td><td>our lookup table </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">y</td><td>the y value for which we need an x </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00436">436</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                     {</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>, foundone, up;</div>
<div class="line">  <span class="keywordtype">double</span> m;</div>
<div class="line">  <span class="keywordtype">double</span> y1, y2, x1, x2, <a class="code" href="namespacemk__pgpmac__redis.html#abc8696f6f2f3fd3edd30989d3c8ec301">x</a>;</div>
<div class="line"></div>
<div class="line">  foundone = 0;</div>
<div class="line">  <span class="keywordflow">if</span>( lut != NULL &amp;&amp; nlut &gt; 1) {</div>
<div class="line"></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// are the table values going up or down?</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">if</span>( lut[1] &lt; lut[2*nlut-1])</div>
<div class="line">      up = 1;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      up = 0;</div>
<div class="line"></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Linear search</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">for</span>( i=0; i &lt; 2*nlut; i += 2) {</div>
<div class="line">      x1 = lut[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>];</div>
<div class="line">      y1 = lut[i+1];</div>
<div class="line">      <span class="keywordflow">if</span>( i &lt; 2*nlut - 2) {</div>
<div class="line">        x2 = lut[i+2];</div>
<div class="line">        y2 = lut[i+3];</div>
<div class="line">      }</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// see if y is before the beginning of the table</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="keywordflow">if</span>( i==0 &amp;&amp; ( up ? y1 &gt; <a class="code" href="namespacemk__pgpmac__redis.html#a34220d58136fb95853f54ed51a130f79">y</a> : y1 &lt; <a class="code" href="namespacemk__pgpmac__redis.html#a34220d58136fb95853f54ed51a130f79">y</a>)) {</div>
<div class="line">        x = x1;</div>
<div class="line">        foundone = 1;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Did we, perhaps, nail it?</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="keywordflow">if</span>( y1 == <a class="code" href="namespacemk__pgpmac__redis.html#a34220d58136fb95853f54ed51a130f79">y</a>) {</div>
<div class="line">        x = x1;</div>
<div class="line">        foundone = 1;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line"></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Interpolate between the two values (if we&#39;ve not bumped our heads on the end of the table)</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="keywordflow">if</span>( (i &lt; 2*nlut-2) &amp;&amp; (up ? y &lt; y2 : y &gt; y2)) {</div>
<div class="line">        m = (x2 - x1) / (y2 - y1);</div>
<div class="line">        x = m * (<a class="code" href="namespacemk__pgpmac__redis.html#a34220d58136fb95853f54ed51a130f79">y</a> - y1) + x1;</div>
<div class="line">        foundone = 1;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// y is off the charts: just use the last value</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">if</span>( foundone == 0 ) {</div>
<div class="line">      x = lut[2*(nlut-1)];</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="namespacemk__pgpmac__redis.html#abc8696f6f2f3fd3edd30989d3c8ec301">x</a>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> 0.0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3a7fb93fb3fb9c4454613f30bfb0b1ee"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_run </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start up the lspmac thread. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l03454">3454</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                  {</div>
<div class="line">  <span class="keywordtype">char</span> **inits;</div>
<div class="line">  <a class="code" href="structlspmac__motor__struct.html" title="Motor information.">lspmac_motor_t</a> *mp;</div>
<div class="line">  <span class="keywordtype">char</span> evts[64];</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">  <span class="keywordtype">int</span> active;</div>
<div class="line"></div>
<div class="line">  pthread_create( &amp;<a class="code" href="lspmac_8c.html#a6b7011dd7d2c2d3afadff8d3e50e7677" title="our thread to manage access and communication to the pmac">pmac_thread</a>, NULL, <a class="code" href="lspmac_8c.html#abdec5883055967b1eda043670870f55f" title="Our lspmac worker thread.">lspmac_worker</a>, NULL);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lsevents_8c.html#ab0617d3f0594b51d10e34bf397096654" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;CryoSwitchChanged&quot;</span>,    <a class="code" href="lspmac_8c.html#afc00ddac633f8c8a3a699e3d22de2770">lspmac_cryoSwitchChanged_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#ab0617d3f0594b51d10e34bf397096654" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;scint In Position&quot;</span>,    <a class="code" href="lspmac_8c.html#a8707350625ca81a089a90f8b64ce6d28" title="Maybe start drying off the scintilator.">lspmac_scint_inPosition_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#ab0617d3f0594b51d10e34bf397096654" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;scintDried&quot;</span>,           <a class="code" href="lspmac_8c.html#a585676eb411025c7b44da958d4e98eb2" title="Turn off the dryer.">lspmac_scint_dried_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#ab0617d3f0594b51d10e34bf397096654" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;backLight 1&quot;</span>,          <a class="code" href="lspmac_8c.html#a094f66824c57b27c9dad2ca36bd75e44" title="Turn on the backlight whenever it goes up.">lspmac_backLight_up_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#ab0617d3f0594b51d10e34bf397096654" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;backLight 0&quot;</span>,          <a class="code" href="lspmac_8c.html#a571cf14b82b5aae163af5aec3201cd3e" title="Turn off the backlight whenever it goes down.">lspmac_backLight_down_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#ab0617d3f0594b51d10e34bf397096654" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;cam.zoom In Position&quot;</span>, <a class="code" href="lspmac_8c.html#a55791bd8a07e5ca1dd2aeedf3c23942c" title="Set the backlight intensity whenever the zoom is changed (and the backlight is up)">lspmac_light_zoom_cb</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;<a class="code" href="lspmac_8c.html#a56260f012c50a591ee7f97e500f16994" title="The number of motors we manage.">lspmac_nmotors</a>; i++) {</div>
<div class="line">    snprintf( evts, <span class="keyword">sizeof</span>( evts)-1, <span class="stringliteral">&quot;%s command accepted&quot;</span>, <a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[i].name);</div>
<div class="line">    evts[<span class="keyword">sizeof</span>(evts)-1] = 0;</div>
<div class="line">    <a class="code" href="lsevents_8c.html#ab0617d3f0594b51d10e34bf397096654" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( evts, <a class="code" href="lspmac_8c.html#a611168a1076b2de45c596ed95c68445a">lspmac_command_done_cb</a>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#a3816a9a1a3bb5bb89fcec8a30d863970" title="Set up lookup table for zoom.">lspmac_zoom_lut_setup</a>();</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ad52a5dbc2f06247eca7619195936b85f" title="Set up lookup table for flight.">lspmac_flight_lut_setup</a>();</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a4aa8c178a56276eb64138d52fe65dc8c" title="Set up lookup table for blight.">lspmac_blight_lut_setup</a>();</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a54ceac41b127ad8bbad07bd90c6729dc" title="Set up lookup table for fscint.">lspmac_fscint_lut_setup</a>();</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Clear the command interfaces</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <a class="code" href="lspmac_8c.html#a8707477f9799b4cc8c6f465ecfeee24b" title="Send a control character.">lspmac_SockSendControlCharPrint</a>( NULL, <span class="stringliteral">&#39;\x18&#39;</span>);</div>
<div class="line">  {</div>
<div class="line">    uint32_t cc;</div>
<div class="line">    cc = 0;</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>, <a class="code" href="lspmac_8c.html#ab79207cc3145740f8c070a24c91b11e0">VR_PMAC_SETMEM</a>, 0x0e9e, 0, 4, (<span class="keywordtype">char</span> *)&amp;cc, NULL, 1, NULL);</div>
<div class="line"></div>
<div class="line">    cc = 0x18;</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>, <a class="code" href="lspmac_8c.html#ab79207cc3145740f8c070a24c91b11e0">VR_PMAC_SETMEM</a>, 0x0e9e, 0, 4, (<span class="keywordtype">char</span> *)&amp;cc, NULL, 1, NULL);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Initialize the MD2 pmac (ie, turn on the right plcc&#39;s etc)</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">/*</span></div>
<div class="line"><span class="comment">  for( inits = lsredis_get_string_array(lspmac_md2_init); *inits != NULL; inits++) {</span></div>
<div class="line"><span class="comment">    lspmac_SockSendDPline( NULL, *inits);</span></div>
<div class="line"><span class="comment">  }</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Initialize the pmac&#39;s support for each motor</span></div>
<div class="line">  <span class="comment">// (ie, set the various flag for when a motor is active or not)</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;<a class="code" href="lspmac_8c.html#a56260f012c50a591ee7f97e500f16994" title="The number of motors we manage.">lspmac_nmotors</a>; i++) {</div>
<div class="line">    mp = &amp;(<a class="code" href="lspmac_8c.html#a894c709ddd0652583d6db22e86282503" title="All our motors.">lspmac_motors</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>]);</div>
<div class="line">    active = <a class="code" href="lsredis_8c.html#abbb4e5ece19ebd130e1be18036752a08">lsredis_getb</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aed4998885bcd5a2a30069637180f58e3" title="Use the motor (&quot;true&quot;) or not (&quot;false&quot;)">active</a>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// if there is a problem with &quot;active&quot; then don&#39;t do anything</span></div>
<div class="line">    <span class="comment">// On the other hand, various combinations of yes/no true/fals 1/0 should work</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">switch</span>( active) {</div>
<div class="line">    <span class="keywordflow">case</span> 1:</div>
<div class="line">      inits = <a class="code" href="lsredis_8c.html#abe31d0e11c41b2235307612c963bb652">lsredis_get_string_array</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ac2a02f137e4a35db816bc728290d3558" title="pmac commands to make this motor active">active_init</a>);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> 0:</div>
<div class="line">      inits = <a class="code" href="lsredis_8c.html#abe31d0e11c41b2235307612c963bb652">lsredis_get_string_array</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab329ce9b277eca9984c18417dece7bf7" title="pmac commands to inactivate the motor">inactive_init</a>);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_run: motor %s is neither active nor inactive (!?)&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">      inits = NULL;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span>( inits != NULL) {</div>
<div class="line">      <span class="keywordflow">while</span>( *inits != NULL) {</div>
<div class="line">        <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( NULL, *inits);</div>
<div class="line">        inits++;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a585676eb411025c7b44da958d4e98eb2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_scint_dried_cb </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Turn off the dryer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">event</td><td>required by protocol </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l03294">3294</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                         {</div>
<div class="line">  <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_scint_dried_cb: Stopping dryer&quot;</span>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a9d9c5030d817483ca9518027c91adac4" title="blow air on the scintilator to dry it off">dryer</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a38b6eee046c3ceff84f908af3335ebcf" title="function to move the motor">moveAbs</a>( <a class="code" href="lspmac_8c.html#a9d9c5030d817483ca9518027c91adac4" title="blow air on the scintilator to dry it off">dryer</a>, 0.0);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8707350625ca81a089a90f8b64ce6d28"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_scint_inPosition_cb </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Maybe start drying off the scintilator. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">event</td><td>required by protocol </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l03232">3232</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                              {</div>
<div class="line">  <span class="keywordtype">double</span> pos;</div>
<div class="line">  <span class="keywordtype">double</span> cover;</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspmac_8c.html#a589431b3a79c21c251fcb97cc9126991" title="Scintillator Z.">scint</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  pos = <a class="code" href="lspmac_8c.html#a589431b3a79c21c251fcb97cc9126991" title="Scintillator Z.">scint</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a>;</div>
<div class="line">  err = <a class="code" href="lsredis_8c.html#a1ad60526a09ca679f39174ce5d773abe">lsredis_find_preset</a>( <a class="code" href="lspmac_8c.html#a589431b3a79c21c251fcb97cc9126991" title="Scintillator Z.">scint</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, <span class="stringliteral">&quot;Cover&quot;</span>, &amp;cover);</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspmac_8c.html#a589431b3a79c21c251fcb97cc9126991" title="Scintillator Z.">scint</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_scint_inPosition_cb: pos %f, cover %f, diff %f, err %d&quot;</span>, pos, cover, fabs( pos-cover), err);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( err == 0)</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( fabs( pos - cover) &lt;= 0.1) {</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a9d9c5030d817483ca9518027c91adac4" title="blow air on the scintilator to dry it off">dryer</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a38b6eee046c3ceff84f908af3335ebcf" title="function to move the motor">moveAbs</a>( <a class="code" href="lspmac_8c.html#a9d9c5030d817483ca9518027c91adac4" title="blow air on the scintilator to dry it off">dryer</a>, 1.0);</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_scint_inPosition_cb: Starting dryer&quot;</span>);</div>
<div class="line">    <a class="code" href="lstimer_8c.html#a14f35a979ca0537d8180d90cbc56c577" title="Create a timer.">lstimer_add_timer</a>( <span class="stringliteral">&quot;scintDried&quot;</span>, 1, 120, 0);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac60f32e1ab6d81a60155e355db752726"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a>* lspmac_send_command </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rqType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>wValue</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>wIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>wLength</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(<a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *, int, char *)&#160;</td>
          <td class="paramname"><em>responseCB</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>no_reply</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Compose a packet and send it to the PMAC. </p>
<p>This is the meat of the PMAC communications routines. The queued command is returned. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">rqType</td><td>VR_UPLOAD or VR_DOWNLOAD </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rq</td><td>PMAC command (see PMAC User Manual </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">wValue</td><td>Command argument 1 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">wIndex</td><td>Command argument 2 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">wLength</td><td>Length of data array </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">data</td><td>Data array (or NULL) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">responseCB</td><td>Function to call when a response is read from the PMAC </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">no_reply</td><td>Flag, non-zero means no reply is expected </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">event</td><td>base name for events </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00690">690</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                        {</div>
<div class="line">  <span class="keyword">static</span> <a class="code" href="structlspmac__cmd__queue__struct.html" title="PMAC command queue item.">pmac_cmd_queue_t</a> cmd;</div>
<div class="line"></div>
<div class="line">  cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a6a155eb3ae546dd29369c4a33ddb3310" title="VR_UPLOAD or VR_DOWNLOAD.">RequestType</a> = rqType;</div>
<div class="line">  cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a0dc566e7edbb226f1a4ea443d93d56e2" title="The command to run (VR_PMAC_GETMEM, etc).">Request</a>     = rq;</div>
<div class="line">  cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#aec0ee9a5f6c7e3bc6e4bd98f1bd52783" title="Command parameter 1.">wValue</a>      = htons(wValue);</div>
<div class="line">  cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a92f5a374e87d4f496b64b4888850d6e6" title="Command parameter 2.">wIndex</a>      = htons(wIndex);</div>
<div class="line">  cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#af5df25ff13ca30fa33719d0df1ab7e97" title="Number of bytes in bData.">wLength</a>     = htons(wLength);</div>
<div class="line">  cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a08f734865cf7ba341b8666da35ba7d84" title="function to call when response is received. args are (int fd, nreturned, buffer)">onResponse</a>       = responseCB;</div>
<div class="line">  cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a33f70b45f8b7c27935cd3efe28748479" title="1 = no reply is expected, 0 = expect a reply">no_reply</a>         = no_reply;</div>
<div class="line">  cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#ace4d453ad6d6225e910dffb33cde866a" title="event name to send">event</a>            = event;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Setting the message buff bData requires a bit more care to avoid over filling it</span></div>
<div class="line">  <span class="comment">// or sending garbage in the unused bytes.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( wLength &gt; <span class="keyword">sizeof</span>( cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>)) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Bad things happen if we do not catch this case.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Message Length %d longer than maximum of %ld, aborting&quot;</span>, wLength, <span class="keyword">sizeof</span>( cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>));</div>
<div class="line">    exit( -1);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span>( data == NULL) {</div>
<div class="line">    memset( cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>, 0, <span class="keyword">sizeof</span>( cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>));</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// This could leave bData non-null terminated.  I do not know if this is a problem.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">if</span>( wLength &gt; 0)</div>
<div class="line">      memcpy( cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>, data, wLength);</div>
<div class="line">    <span class="keywordflow">if</span>( wLength &lt; <span class="keyword">sizeof</span>( cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>))</div>
<div class="line">      memset( cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a> + wLength, 0, <span class="keyword">sizeof</span>( cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>) - wLength);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="lspmac_8c.html#a84a6096d9bfff2bfb1506a216756ae28" title="Put a new command on the queue.">lspmac_push_queue</a>( &amp;cmd);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae3c6f12528ce940f73d44d8ddda245c6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_sendcmd </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(<a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *, int, char *)&#160;</td>
          <td class="paramname"><em>responseCB</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>PMAC command with call back. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">event</td><td>base name for events </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">responseCB</td><td>our callback routine </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fmt</td><td>printf style format string </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02102">2102</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">char</span> tmps[1024];</div>
<div class="line">  va_list arg_ptr;</div>
<div class="line"></div>
<div class="line">  va_start( arg_ptr, fmt);</div>
<div class="line">  vsnprintf( tmps, <span class="keyword">sizeof</span>(tmps)-1, fmt, arg_ptr);</div>
<div class="line">  tmps[<span class="keyword">sizeof</span>(tmps)-1]=0;</div>
<div class="line">  va_end( arg_ptr);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#af24ecdc10723dc8fd6320fef416ae514">VR_DOWNLOAD</a>, <a class="code" href="lspmac_8c.html#a772b2ea2ad93989ae4275c79a93525ee">VR_PMAC_SENDLINE</a>, 0, 0, strlen(tmps), tmps, responseCB, 0, event);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa9bbf5ae34ce793d3d72945c64c43948"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_sendcmd_nocb </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send a command that does not need to deal with the reply. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fmt</td><td>A printf style format string </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02083">2083</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                           {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">char</span> tmps[1024];</div>
<div class="line">  va_list arg_ptr;</div>
<div class="line"></div>
<div class="line">  va_start( arg_ptr, fmt);</div>
<div class="line">  vsnprintf( tmps, <span class="keyword">sizeof</span>(tmps)-1, fmt, arg_ptr);</div>
<div class="line">  tmps[<span class="keyword">sizeof</span>(tmps)-1]=0;</div>
<div class="line">  va_end( arg_ptr);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#af24ecdc10723dc8fd6320fef416ae514">VR_DOWNLOAD</a>, <a class="code" href="lspmac_8c.html#a772b2ea2ad93989ae4275c79a93525ee">VR_PMAC_SENDLINE</a>, 0, 0, strlen(tmps), tmps, NULL, 0, NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae2dd5e31cb4a69470b061aa56473be14"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_SendControlReplyPrintCB </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nreceived</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buff</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Receive a reply to a control character Print a "printable" version of the character to the terminal Followed by a hex dump of the response. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cmd</td><td>Queue item this is a reply to </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nreceived</td><td>Number of bytes received </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">buff</td><td>Buffer of bytes received </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01015">1015</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                      {</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);</div>
<div class="line">  wprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, <span class="stringliteral">&quot;control-%c: &quot;</span>, <span class="charliteral">&#39;@&#39;</span>+ ntohs(cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#aec0ee9a5f6c7e3bc6e4bd98f1bd52783" title="Command parameter 1.">wValue</a>));</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a1c3786f3a38724f497afc4fe6d82d8c4" title="Prints a hex dump of the given data.">hex_dump</a>( nreceived, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)buff);</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);</div>
<div class="line">  wnoutrefresh( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>);</div>
<div class="line">  wnoutrefresh( <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>);</div>
<div class="line">  doupdate();</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af3fa79868ba88f7c37f7b8f7d53149ff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_Service </td>
          <td>(</td>
          <td class="paramtype">struct pollfd *&#160;</td>
          <td class="paramname"><em>evt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Service routine for packet coming from the PMAC. </p>
<p>All communications is asynchronous so this is the only place incomming packets are handled </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">evt</td><td>pollfd object returned by poll </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00798">798</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                      {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">char</span> *receiveBuffer = NULL;    <span class="comment">// the buffer inwhich to stick our incomming characters</span></div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> receiveBufferSize = 0;             <span class="comment">// size of receiveBuffer</span></div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> receiveBufferIn = 0;               <span class="comment">// next location to write to in receiveBuffer</span></div>
<div class="line">  <a class="code" href="structlspmac__cmd__queue__struct.html" title="PMAC command queue item.">pmac_cmd_queue_t</a> *cmd;                        <span class="comment">// maybe the command we are servicing</span></div>
<div class="line">  ssize_t nsent, nread;                         <span class="comment">// nbytes dealt with</span></div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;                                        <span class="comment">// loop counter</span></div>
<div class="line">  <span class="keywordtype">int</span> foundEOCR;                                <span class="comment">// end of command response flag</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( evt-&gt;revents &amp; (POLLERR | POLLHUP | POLLNVAL)) {</div>
<div class="line">    <span class="keywordflow">if</span>( evt-&gt;fd != -1) {</div>
<div class="line">      close( evt-&gt;fd);</div>
<div class="line">      evt-&gt;fd = -1;</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a7eb86ecf0789ab9555de1e03a4c73567">LS_PMAC_STATE_DETACHED</a>;</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( evt-&gt;revents &amp; POLLOUT) {</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">switch</span>( <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a>) {</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a7eb86ecf0789ab9555de1e03a4c73567">LS_PMAC_STATE_DETACHED</a>:</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a37741af675425d61c876cc30ae6c99d0">LS_PMAC_STATE_IDLE</a>:</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a7d8f34fc599cc08c1a9d2cd62ccbb20a">LS_PMAC_STATE_SC</a>:</div>
<div class="line">      cmd = <a class="code" href="lspmac_8c.html#a9627f30135aa7007bc4ab8dde905739a" title="Remove the oldest queue item.">lspmac_pop_queue</a>();</div>
<div class="line">      <span class="keywordflow">if</span>( cmd == NULL)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">      <span class="keywordflow">if</span>( cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a0dc566e7edbb226f1a4ea443d93d56e2" title="The command to run (VR_PMAC_GETMEM, etc).">Request</a> == <a class="code" href="lspmac_8c.html#af9c53e7c5b2681a5ca1c5410a914a2dc">VR_PMAC_GETMEM</a>) {</div>
<div class="line">        nsent = send( evt-&gt;fd, cmd, <a class="code" href="lspmac_8c.html#abdc45e3f7106f84f688419e2da9b3627" title="PMAC command size in bytes.">pmac_cmd_size</a>, 0);</div>
<div class="line">        <span class="keywordflow">if</span>( nsent != <a class="code" href="lspmac_8c.html#abdc45e3f7106f84f688419e2da9b3627" title="PMAC command size in bytes.">pmac_cmd_size</a>) {</div>
<div class="line">          <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Could only send %d of %d bytes....Not good.&quot;</span>, (<span class="keywordtype">int</span>)nsent, (<span class="keywordtype">int</span>)(<a class="code" href="lspmac_8c.html#abdc45e3f7106f84f688419e2da9b3627" title="PMAC command size in bytes.">pmac_cmd_size</a>));</div>
<div class="line">        }</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        nsent = send( evt-&gt;fd, cmd, <a class="code" href="lspmac_8c.html#abdc45e3f7106f84f688419e2da9b3627" title="PMAC command size in bytes.">pmac_cmd_size</a> + ntohs(cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#af5df25ff13ca30fa33719d0df1ab7e97" title="Number of bytes in bData.">wLength</a>), 0);</div>
<div class="line">        gettimeofday( &amp;pmac_time_sent, NULL);</div>
<div class="line">        <span class="keywordflow">if</span>( nsent != <a class="code" href="lspmac_8c.html#abdc45e3f7106f84f688419e2da9b3627" title="PMAC command size in bytes.">pmac_cmd_size</a> + ntohs(cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#af5df25ff13ca30fa33719d0df1ab7e97" title="Number of bytes in bData.">wLength</a>)) {</div>
<div class="line">          <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Could only send %d of %d bytes....Not good.&quot;</span>, (<span class="keywordtype">int</span>)nsent, (<span class="keywordtype">int</span>)(<a class="code" href="lspmac_8c.html#abdc45e3f7106f84f688419e2da9b3627" title="PMAC command size in bytes.">pmac_cmd_size</a> + ntohs(cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#af5df25ff13ca30fa33719d0df1ab7e97" title="Number of bytes in bData.">wLength</a>)));</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line"></div>
<div class="line">      <span class="keywordflow">if</span>( cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a0dc566e7edbb226f1a4ea443d93d56e2" title="The command to run (VR_PMAC_GETMEM, etc).">Request</a> == <a class="code" href="lspmac_8c.html#a76c1c401354826ac2ba8906578be930f">VR_PMAC_SENDCTRLCHAR</a>)</div>
<div class="line">        <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#adef540911028fda73e8bbf0aa6ad39e9">LS_PMAC_STATE_WACK_CC</a>;</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span>( cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a0dc566e7edbb226f1a4ea443d93d56e2" title="The command to run (VR_PMAC_GETMEM, etc).">Request</a> == <a class="code" href="lspmac_8c.html#af9c53e7c5b2681a5ca1c5410a914a2dc">VR_PMAC_GETMEM</a>)</div>
<div class="line">        <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a220b39710719cfe8b500d51819e8efeb">LS_PMAC_STATE_GMR</a>;</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span>( cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a33f70b45f8b7c27935cd3efe28748479" title="1 = no reply is expected, 0 = expect a reply">no_reply</a> == 0)</div>
<div class="line">        <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a5eba9ef09d4316e803b9d75bd3104f43">LS_PMAC_STATE_WACK</a>;</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a63356b0c18fcb186f456c12c6e927d84">LS_PMAC_STATE_WACK_NFR</a>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#abbd709b56a71eb1fc6adc9063605d243">LS_PMAC_STATE_CR</a>:</div>
<div class="line">      nsent = send( evt-&gt;fd, &amp;<a class="code" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81" title="commands to send out &quot;readready&quot;, &quot;getbuffer&quot;, &quot;controlresponse&quot; (initialized in main)">cr_cmd</a>, <a class="code" href="lspmac_8c.html#abdc45e3f7106f84f688419e2da9b3627" title="PMAC command size in bytes.">pmac_cmd_size</a>, 0);</div>
<div class="line">      gettimeofday( &amp;pmac_time_sent, NULL);</div>
<div class="line">      <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a27ee6c39d58604c8aa9bd6c249c4833f">LS_PMAC_STATE_WCR</a>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#add5325f4a84e4fe05f558880349485ea">LS_PMAC_STATE_RR</a>:</div>
<div class="line">      nsent = send( evt-&gt;fd, &amp;<a class="code" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a>, <a class="code" href="lspmac_8c.html#abdc45e3f7106f84f688419e2da9b3627" title="PMAC command size in bytes.">pmac_cmd_size</a>, 0);</div>
<div class="line">      gettimeofday( &amp;pmac_time_sent, NULL);</div>
<div class="line">      <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a3e0a62cd9a1212419ad3615c34bdc65a">LS_PMAC_STATE_WACK_RR</a>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a5f4ff8874677aac48a4c675f2c1ca4e9">LS_PMAC_STATE_GB</a>:</div>
<div class="line">      nsent = send( evt-&gt;fd, &amp;<a class="code" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a>, <a class="code" href="lspmac_8c.html#abdc45e3f7106f84f688419e2da9b3627" title="PMAC command size in bytes.">pmac_cmd_size</a>, 0);</div>
<div class="line">      gettimeofday( &amp;pmac_time_sent, NULL);</div>
<div class="line">      <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a591822cc92f76a39b293c2e90b322db2">LS_PMAC_STATE_WGB</a>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( evt-&gt;revents &amp; POLLIN) {</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( receiveBufferSize - receiveBufferIn &lt; 1400) {</div>
<div class="line">      <span class="keywordtype">char</span> *newbuff;</div>
<div class="line"></div>
<div class="line">      receiveBufferSize += 1400;</div>
<div class="line">      newbuff = calloc( receiveBufferSize, <span class="keyword">sizeof</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>));</div>
<div class="line">      <span class="keywordflow">if</span>( newbuff == NULL) {</div>
<div class="line">        <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_Service: Out of memory&quot;</span>);</div>
<div class="line">        exit( -1);</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">if</span>( receiveBuffer != NULL) {</div>
<div class="line">        memcpy( newbuff, receiveBuffer, receiveBufferIn);</div>
<div class="line">        free(receiveBuffer);</div>
<div class="line">      }</div>
<div class="line">      receiveBuffer = newbuff;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    nread = read( evt-&gt;fd, receiveBuffer + receiveBufferIn, 1400);</div>
<div class="line"></div>
<div class="line">    foundEOCR = 0;</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> == <a class="code" href="lspmac_8c.html#a220b39710719cfe8b500d51819e8efeb">LS_PMAC_STATE_GMR</a>) {</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// get memory returns binary stuff, don&#39;t try to parse it</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      receiveBufferIn += nread;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// other commands end in 6 if OK, 7 if not</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="keywordflow">for</span>( i=receiveBufferIn; i&lt;receiveBufferIn+nread; i++) {</div>
<div class="line">        <span class="keywordflow">if</span>( receiveBuffer[i] == 7) {</div>
<div class="line">          <span class="comment">//</span></div>
<div class="line">          <span class="comment">// Error condition</span></div>
<div class="line">          <span class="comment">//</span></div>
<div class="line">          <a class="code" href="lspmac_8c.html#a4748a88d1fe46aa3ab1beee55bcddf1b" title="The service routing detected an error condition.">lspmac_Error</a>( &amp;(receiveBuffer[i]));</div>
<div class="line">          receiveBufferIn = 0;</div>
<div class="line">          <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span>( receiveBuffer[i] == 6) {</div>
<div class="line">          <span class="comment">//</span></div>
<div class="line">          <span class="comment">// End of command response</span></div>
<div class="line">          <span class="comment">//</span></div>
<div class="line">          foundEOCR = 1;</div>
<div class="line">          receiveBuffer[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>] = 0;</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">      receiveBufferIn = <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    cmd = NULL;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">switch</span>( <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a>) {</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a63356b0c18fcb186f456c12c6e927d84">LS_PMAC_STATE_WACK_NFR</a>:</div>
<div class="line">      receiveBuffer[--receiveBufferIn] = 0;</div>
<div class="line">      cmd = <a class="code" href="lspmac_8c.html#a0f60f18dfe11c1c0299909521596be8f" title="Remove the next command queue item that is waiting for a reply.">lspmac_pop_reply</a>();</div>
<div class="line">      <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a37741af675425d61c876cc30ae6c99d0">LS_PMAC_STATE_IDLE</a>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a5eba9ef09d4316e803b9d75bd3104f43">LS_PMAC_STATE_WACK</a>:</div>
<div class="line">      receiveBuffer[--receiveBufferIn] = 0;</div>
<div class="line">      <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#add5325f4a84e4fe05f558880349485ea">LS_PMAC_STATE_RR</a>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#adef540911028fda73e8bbf0aa6ad39e9">LS_PMAC_STATE_WACK_CC</a>:</div>
<div class="line">      receiveBuffer[--receiveBufferIn] = 0;</div>
<div class="line">      <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#abbd709b56a71eb1fc6adc9063605d243">LS_PMAC_STATE_CR</a>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a3e0a62cd9a1212419ad3615c34bdc65a">LS_PMAC_STATE_WACK_RR</a>:</div>
<div class="line">      receiveBufferIn -= 2;</div>
<div class="line">      <span class="keywordflow">if</span>( receiveBuffer[receiveBufferIn])</div>
<div class="line">        <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a5f4ff8874677aac48a4c675f2c1ca4e9">LS_PMAC_STATE_GB</a>;</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#add5325f4a84e4fe05f558880349485ea">LS_PMAC_STATE_RR</a>;</div>
<div class="line">      receiveBuffer[receiveBufferIn] = 0;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a220b39710719cfe8b500d51819e8efeb">LS_PMAC_STATE_GMR</a>:</div>
<div class="line">      cmd = <a class="code" href="lspmac_8c.html#a0f60f18dfe11c1c0299909521596be8f" title="Remove the next command queue item that is waiting for a reply.">lspmac_pop_reply</a>();</div>
<div class="line">      <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a37741af675425d61c876cc30ae6c99d0">LS_PMAC_STATE_IDLE</a>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a27ee6c39d58604c8aa9bd6c249c4833f">LS_PMAC_STATE_WCR</a>:</div>
<div class="line">      cmd = <a class="code" href="lspmac_8c.html#a0f60f18dfe11c1c0299909521596be8f" title="Remove the next command queue item that is waiting for a reply.">lspmac_pop_reply</a>();</div>
<div class="line">      <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a37741af675425d61c876cc30ae6c99d0">LS_PMAC_STATE_IDLE</a>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a591822cc92f76a39b293c2e90b322db2">LS_PMAC_STATE_WGB</a>:</div>
<div class="line">      <span class="keywordflow">if</span>( foundEOCR) {</div>
<div class="line">        cmd = <a class="code" href="lspmac_8c.html#a0f60f18dfe11c1c0299909521596be8f" title="Remove the next command queue item that is waiting for a reply.">lspmac_pop_reply</a>();</div>
<div class="line">        <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a37741af675425d61c876cc30ae6c99d0">LS_PMAC_STATE_IDLE</a>;</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#add5325f4a84e4fe05f558880349485ea">LS_PMAC_STATE_RR</a>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( cmd != NULL &amp;&amp; cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a08f734865cf7ba341b8666da35ba7d84" title="function to call when response is received. args are (int fd, nreturned, buffer)">onResponse</a> != NULL) {</div>
<div class="line">      cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a08f734865cf7ba341b8666da35ba7d84" title="function to call when response is received. args are (int fd, nreturned, buffer)">onResponse</a>( cmd, receiveBufferIn, receiveBuffer);</div>
<div class="line">      receiveBufferIn = 0;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab81f07dea6bb0e88103a05a380de1034"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_shutter_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fast shutter read routine The shutter is mildly complicated in that we need to take into account the fact that the shutter can open and close again between status updates. </p>
<p>This means that we need to rely on a PCL program running in the PMAC to monitor the shutter state and let us know that this has happened. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>The motor object associated with the fast shutter </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01171">1171</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                           {</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// track the shutter state and signal if it has changed</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#a1b78a13c654409333569815e1c109d38" title="Coordinates threads reading shutter status.">lspmac_shutter_mutex</a>);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ab961c2ba24a1a8c95a88dec25319e712">fs_has_opened</a> &amp;&amp; !<a class="code" href="lspmac_8c.html#a396fbf06208de3ecbe1b0df549f1cd46" title="Indicates that the shutter had opened, perhaps briefly even if the state did not change.">lspmac_shutter_has_opened</a> &amp;&amp; !<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#aca3722c109e6646bd41fb269a32261f2">fs_is_open</a>) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Here the shutter opened and closed again before we got the memo</span></div>
<div class="line">    <span class="comment">// Treat it as a shutter closed event</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    pthread_cond_signal( &amp;<a class="code" href="lspmac_8c.html#afbd51c2cefcee87afe994c9e9f372241" title="Allows waiting for the shutter status to change.">lspmac_shutter_cond</a>);</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a396fbf06208de3ecbe1b0df549f1cd46" title="Indicates that the shutter had opened, perhaps briefly even if the state did not change.">lspmac_shutter_has_opened</a> = <a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ab961c2ba24a1a8c95a88dec25319e712">fs_has_opened</a>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#a112158e0cd50449a440ac55c7af7bea2" title="State of the shutter, used to detect changes.">lspmac_shutter_state</a> !=  <a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#aca3722c109e6646bd41fb269a32261f2">fs_is_open</a>) {</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a112158e0cd50449a440ac55c7af7bea2" title="State of the shutter, used to detect changes.">lspmac_shutter_state</a> = <a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#aca3722c109e6646bd41fb269a32261f2">fs_is_open</a>;</div>
<div class="line">    pthread_cond_signal( &amp;<a class="code" href="lspmac_8c.html#afbd51c2cefcee87afe994c9e9f372241" title="Allows waiting for the shutter status to change.">lspmac_shutter_cond</a>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#aca3722c109e6646bd41fb269a32261f2">fs_is_open</a>) {</div>
<div class="line">    mvwprintw( <a class="code" href="pgpmac_8c.html#ae2d7da3afeb756716e6e4ee9cab78f8a" title="shutter, lamp, air, etc status">term_status2</a>, 1, 1, <span class="stringliteral">&quot;Shutter Open  &quot;</span>);</div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a> = 1;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    mvwprintw( <a class="code" href="pgpmac_8c.html#ae2d7da3afeb756716e6e4ee9cab78f8a" title="shutter, lamp, air, etc status">term_status2</a>, 1, 1, <span class="stringliteral">&quot;Shutter Closed&quot;</span>);</div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a> = 0;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#a1b78a13c654409333569815e1c109d38" title="Coordinates threads reading shutter status.">lspmac_shutter_mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac5745f25f242edf02f7b9b7c77ed6126"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_SockFlush </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reset the PMAC socket from the PMAC side. </p>
<p>Puts the PMAC into a known communications state </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00744">744</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                        {</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#af24ecdc10723dc8fd6320fef416ae514">VR_DOWNLOAD</a>, <a class="code" href="lspmac_8c.html#ac0e5588681366b52589cd321eabf12ff">VR_PMAC_FLUSH</a>, 0, 0, 0, NULL, NULL, 1, NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0a56c777b1469ad8c3d29d825a71e300"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a>* lspmac_SockGetmem </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nbytes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Request a chunk of memory to be returned. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">offset</td><td>Offset in PMAC Double Buffer </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nbytes</td><td>Number of bytes to request </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01050">1050</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                       {</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>,   <a class="code" href="lspmac_8c.html#af9c53e7c5b2681a5ca1c5410a914a2dc">VR_PMAC_GETMEM</a>, offset, 0, nbytes, NULL, <a class="code" href="lspmac_8c.html#a5e4b7bbfb008acbbad98accf18492f0b" title="Service a reply to the getmem command.">lspmac_GetmemReplyCB</a>, 0, NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8707477f9799b4cc8c6f465ecfeee24b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a>* lspmac_SockSendControlCharPrint </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>c</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send a control character. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">event</td><td>base name for events </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">c</td><td>The control character to send </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01103">1103</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                    {</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#af24ecdc10723dc8fd6320fef416ae514">VR_DOWNLOAD</a>, <a class="code" href="lspmac_8c.html#a76c1c401354826ac2ba8906578be930f">VR_PMAC_SENDCTRLCHAR</a>, c, 0, 0, NULL, <a class="code" href="lspmac_8c.html#ae2dd5e31cb4a69470b061aa56473be14" title="Receive a reply to a control character Print a &quot;printable&quot; version of the character to the terminal F...">lspmac_SendControlReplyPrintCB</a>, 0, event);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0575fc751cecf35ffe8b290ab483ac21"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_SockSendDPControlChar </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>c</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>use dpram ascii interface to send a control character </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01976">1976</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                        {</div>
<div class="line">  uint16_t buff;</div>
<div class="line"></div>
<div class="line">  buff = 0x07 &amp; c;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>, <a class="code" href="lspmac_8c.html#ab79207cc3145740f8c070a24c91b11e0">VR_PMAC_SETMEM</a>, 0x0e9e, 0, 2, (<span class="keywordtype">char</span> *)&amp;buff, <a class="code" href="lspmac_8c.html#afb3caf2837d7bcb702c26fc8f08259b3">lspmac_SockSendDPControlCharCB</a>, 1, event);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s queued&quot;</span>, event);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="afb3caf2837d7bcb702c26fc8f08259b3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_SockSendDPControlCharCB </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nreceived</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01969">1969</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                                                      {</div>
<div class="line">  <span class="keywordflow">if</span>( cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#ace4d453ad6d6225e910dffb33cde866a" title="event name to send">event</a> != NULL &amp;&amp; *(cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#ace4d453ad6d6225e910dffb33cde866a" title="event name to send">event</a>))</div>
<div class="line">    <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s accepted&quot;</span>, cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#ace4d453ad6d6225e910dffb33cde866a" title="event name to send">event</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="afab9e8f0502a92ee5cf93209af710f81"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_SockSendDPline </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>prepare (queue up) a line to send the dpram ascii command interface </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01949">1949</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                         {</div>
<div class="line">  va_list arg_ptr;</div>
<div class="line">  uint32_t index;</div>
<div class="line">  <span class="keywordtype">char</span> *pl;</div>
<div class="line">  </div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#a2ff142105e17d933871d09759e7082f8" title="Keep too many processes from sending commands at once.">lspmac_ascii_mutex</a>);</div>
<div class="line">  index = <a class="code" href="lspmac_8c.html#a09701de0235acaeae5abf4e04268be33">lspmac_dpascii_on</a>++ % <a class="code" href="lspmac_8c.html#a3a407e2e4d57ac45ecd700f8bad3d3b5">LSPMAC_DPASCII_QUEUE_LENGTH</a>;</div>
<div class="line"></div>
<div class="line">  pl = <a class="code" href="lspmac_8c.html#a2bd5340143f40b5e6404a381fb438710">lspmac_dpascii_queue</a>[index].<a class="code" href="structlspmac__dpascii__queue__struct.html#a318d65317b14eba9e38efd0ab0133a5c">pl</a>;</div>
<div class="line"></div>
<div class="line">  va_start( arg_ptr, fmt);</div>
<div class="line">  vsnprintf( pl, 159, fmt, arg_ptr);</div>
<div class="line">  pl[159] = 0;</div>
<div class="line">  va_end( arg_ptr);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#a2bd5340143f40b5e6404a381fb438710">lspmac_dpascii_queue</a>[index].<a class="code" href="structlspmac__dpascii__queue__struct.html#a8775c09713a917f4ddd80a3a5a8a4668">event</a> = event;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#a2ff142105e17d933871d09759e7082f8" title="Keep too many processes from sending commands at once.">lspmac_ascii_mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad59af2883f1a6f2ee5daeebb7282f8a6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_SockSendDPqueue </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01985">1985</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                              {</div>
<div class="line">  <a class="code" href="structlspmac__dpascii__queue__struct.html">lspmac_dpascii_queue_t</a> *qp;</div>
<div class="line">  uint32_t mask;</div>
<div class="line">  uint32_t clrdata;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#a2ff142105e17d933871d09759e7082f8" title="Keep too many processes from sending commands at once.">lspmac_ascii_mutex</a>);</div>
<div class="line">  qp = &amp;(<a class="code" href="lspmac_8c.html#a2bd5340143f40b5e6404a381fb438710">lspmac_dpascii_queue</a>[(<a class="code" href="lspmac_8c.html#a9b0d9e2c858f6f0178be2bfdd96d4c05">lspmac_dpascii_off</a>++) % <a class="code" href="lspmac_8c.html#a3a407e2e4d57ac45ecd700f8bad3d3b5">LSPMAC_DPASCII_QUEUE_LENGTH</a>]);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#afb9e57459496c33e0da5cdb773113a61" title="flag for condition to wait for">lspmac_ascii_busy</a> = 1;</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#a2ff142105e17d933871d09759e7082f8" title="Keep too many processes from sending commands at once.">lspmac_ascii_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_SockSendDPqueue: %s&quot;</span>, qp-&gt;<a class="code" href="structlspmac__dpascii__queue__struct.html#a318d65317b14eba9e38efd0ab0133a5c">pl</a>);</div>
<div class="line"></div>
<div class="line">  clrdata = 0;          <span class="comment">// set the control word to zero</span></div>
<div class="line">  <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>, <a class="code" href="lspmac_8c.html#ab79207cc3145740f8c070a24c91b11e0">VR_PMAC_SETMEM</a>, 0x0f40, 0, 4, (<span class="keywordtype">char</span> *)&amp;clrdata, NULL, 1, NULL);</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>, <a class="code" href="lspmac_8c.html#ab79207cc3145740f8c070a24c91b11e0">VR_PMAC_SETMEM</a>, 0x0e9c, 0, 4, (<span class="keywordtype">char</span> *)&amp;clrdata, NULL, 1, NULL);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>, <a class="code" href="lspmac_8c.html#ab79207cc3145740f8c070a24c91b11e0">VR_PMAC_SETMEM</a>, 0x0ea0, 0, strlen(qp-&gt;<a class="code" href="structlspmac__dpascii__queue__struct.html#a318d65317b14eba9e38efd0ab0133a5c">pl</a>)+1, qp-&gt;<a class="code" href="structlspmac__dpascii__queue__struct.html#a318d65317b14eba9e38efd0ab0133a5c">pl</a>, NULL, 1, NULL);</div>
<div class="line"></div>
<div class="line">  mask = 0x0001;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>, <a class="code" href="lspmac_8c.html#aaed77195148c3d9fe10c6e82fc6b2ea7">VR_PMAC_SETBIT</a>, 0x0e9c, 1, <span class="keyword">sizeof</span>( mask), (<span class="keywordtype">char</span> *)&amp;mask,<a class="code" href="lspmac_8c.html#ae2136d97501e077e3d4b23237e7fe374" title="PMAC has received our ascii command request Now see when it is ready for the next one...">lspmac_asciicmdCB</a>, 1, qp-&gt;<a class="code" href="structlspmac__dpascii__queue__struct.html#a8775c09713a917f4ddd80a3a5a8a4668">event</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( qp-&gt;<a class="code" href="structlspmac__dpascii__queue__struct.html#a8775c09713a917f4ddd80a3a5a8a4668">event</a> != NULL &amp;&amp; *(qp-&gt;<a class="code" href="structlspmac__dpascii__queue__struct.html#a8775c09713a917f4ddd80a3a5a8a4668">event</a>) != 0)</div>
<div class="line">    <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s queued&quot;</span>, qp-&gt;<a class="code" href="structlspmac__dpascii__queue__struct.html#a8775c09713a917f4ddd80a3a5a8a4668">event</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adebcd9b5045d49112b704a7656a981c9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a>* lspmac_SockSendline </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send a one line command. </p>
<p>Uses printf style arguments. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">event</td><td>base name for events </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fmt</td><td>Printf style format string </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01060">1060</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                         {</div>
<div class="line">  va_list arg_ptr;</div>
<div class="line">  <span class="keywordtype">char</span> payload[1400];</div>
<div class="line"></div>
<div class="line">  va_start( arg_ptr, fmt);</div>
<div class="line">  vsnprintf( payload, <span class="keyword">sizeof</span>(payload)-1, fmt, arg_ptr);</div>
<div class="line">  payload[ <span class="keyword">sizeof</span>(payload)-1] = 0;</div>
<div class="line">  va_end( arg_ptr);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( payload);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#af24ecdc10723dc8fd6320fef416ae514">VR_DOWNLOAD</a>, <a class="code" href="lspmac_8c.html#a772b2ea2ad93989ae4275c79a93525ee">VR_PMAC_SENDLINE</a>, 0, 0, strlen( payload), payload, <a class="code" href="lspmac_8c.html#a81e8e315099cf9b6eef0335b01f97bfd" title="Receive a reply that does not require multiple buffers.">lspmac_GetShortReplyCB</a>, 0, event);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9d62df6a1f2245df8b6e549984c9b46f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a>* lspmac_SockSendline_nr </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send a command and ignore the response. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">event</td><td>base name for events </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fmt</td><td>Printf style format string </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01083">1083</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                           {</div>
<div class="line">  va_list arg_ptr;</div>
<div class="line">  <span class="keywordtype">char</span> s[512];</div>
<div class="line"></div>
<div class="line">  va_start( arg_ptr, fmt);</div>
<div class="line">  vsnprintf( s, <span class="keyword">sizeof</span>(s)-1, fmt, arg_ptr);</div>
<div class="line">  s[<span class="keyword">sizeof</span>(s)-1] = 0;</div>
<div class="line">  va_end( arg_ptr);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( s);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#af24ecdc10723dc8fd6320fef416ae514">VR_DOWNLOAD</a>, <a class="code" href="lspmac_8c.html#a772b2ea2ad93989ae4275c79a93525ee">VR_PMAC_SENDLINE</a>, 0, 0, strlen( s), s, NULL, 1, event);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a698719a7ce58e2052fa70ab87b1fb293"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* lspmac_soft_motor_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int(*)(<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *, double)&#160;</td>
          <td class="paramname"><em>moveAbs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l03044">3044</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                                                                                 {</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#afd005045e9cc3f4bb93d424fe50eb733" title="Helper funciton for the init calls.">_lspmac_motor_init</a>( d, name);</div>
<div class="line"></div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a38b6eee046c3ceff84f908af3335ebcf" title="function to move the motor">moveAbs</a>      = moveAbs;</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#ac62692eb939c04ca35e939d1c3acfe8f" title="method to read the motor status and position">read</a>         = <a class="code" href="lspmac_8c.html#a4504b147f551d86865a7e7ca1e795990" title="Dummy routine to read a soft motor.">lspmac_soft_motor_read</a>;</div>
<div class="line">  d-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a> = calloc( <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), 1);</div>
<div class="line">  *d-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a> = 0;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> d;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4504b147f551d86865a7e7ca1e795990"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_soft_motor_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Dummy routine to read a soft motor. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l03039">3039</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                {</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a37fc3302586bba36fa3b15c6f5e5b98a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_test_preset </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>preset_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>tolerance</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>see if the motor is within tolerance of the preset 1 means yes, it is 0 mean no it isn't or that the preset was not found </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02381">2381</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                                                 {</div>
<div class="line">  <span class="keywordtype">double</span> preset_position;</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line"></div>
<div class="line">  err = <a class="code" href="lsredis_8c.html#a1ad60526a09ca679f39174ce5d773abe">lsredis_find_preset</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, preset_name, &amp;preset_position);</div>
<div class="line">  <span class="keywordflow">if</span>( err == 0)</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( fabs( preset_position - <a class="code" href="lspmac_8c.html#acc46bdddee59bd8c5ad662b3fd445e9f" title="get the motor position (with locking)">lspmac_getPosition</a>( mp)) &lt;= tolerance)</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa8bf745a9ec388783009e2275a8b56f8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_video_rotate </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>secs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Special motion program to collect centering video. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02575">2575</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                       {</div>
<div class="line">  <span class="keywordtype">double</span> q10;           <span class="comment">// starting position (counts)</span></div>
<div class="line">  <span class="keywordtype">double</span> q11;           <span class="comment">// delta counts</span></div>
<div class="line">  <span class="keywordtype">double</span> q12;           <span class="comment">// milliseconds to run over delta</span></div>
<div class="line">  </div>
<div class="line">  <span class="keywordtype">double</span> u2c;</div>
<div class="line">  <span class="keywordtype">double</span> neutral_pos;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( secs &lt;= 0.0)</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#ae06d2291c1996ffb7dcf7d132e25b038" title="Indicate we&#39;d really like to know when omega crosses zero.">omega_zero_search</a> = 1;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspmac_8c.html#a8237e646ce032a840637a4ef7bff49b9" title="MD2 omega axis (the air bearing)">omega</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  u2c         = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( <a class="code" href="lspmac_8c.html#a8237e646ce032a840637a4ef7bff49b9" title="MD2 omega axis (the air bearing)">omega</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a8838915ebb6f9989944117c8197d5e86" title="conversion from counts to units: 0.0 means not loaded yet">u2c</a>);</div>
<div class="line">  neutral_pos = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( <a class="code" href="lspmac_8c.html#a8237e646ce032a840637a4ef7bff49b9" title="MD2 omega axis (the air bearing)">omega</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#ae931e9bc9fc2fa82ca649334fc052fbe" title="zero offset">neutral_pos</a>);</div>
<div class="line"></div>
<div class="line">  q10 = neutral_pos * u2c;</div>
<div class="line">  q11 = 360.0 * u2c;</div>
<div class="line">  q12 = 1000 * secs;</div>
<div class="line">  </div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#aea11895d2ec4a3324f4baa9d24cd192d" title="rate (cnts/sec) that omega was traveling when it crossed zero">omega_zero_velocity</a> = 360.0 * u2c / secs;     <span class="comment">// counts/second to back calculate zero crossing time</span></div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( <a class="code" href="lspmac_8c.html#a8237e646ce032a840637a4ef7bff49b9" title="MD2 omega axis (the air bearing)">omega</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, <span class="stringliteral">&quot;&amp;1 Q10=%.1f Q11=%.1f Q12=%.1f Q13=(I117) Q14=(I116) B240R&quot;</span>, q10, q11, q12);</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspmac_8c.html#a8237e646ce032a840637a4ef7bff49b9" title="MD2 omega axis (the air bearing)">omega</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="abdec5883055967b1eda043670870f55f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* lspmac_worker </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>dummy</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Our lspmac worker thread. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">dummy</td><td>Unused but required by pthread library </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02241">2241</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                      {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> disconnected_notify = 0;</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> old_state;</div>
<div class="line"></div>
<div class="line">  old_state = <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a>;</div>
<div class="line">  <span class="keywordflow">while</span>( 1) {</div>
<div class="line">    <span class="keywordtype">int</span> pollrtn;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lspmac_8c.html#a68886d1b658e7b1d996c07e9dbcd9c15" title="State machine logic.">lspmac_next_state</a>();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> != old_state) {</div>
<div class="line">      <span class="comment">//      lslogging_log_message( &quot;lspmac_worker: state = %d&quot;, ls_pmac_state);</span></div>
<div class="line">      old_state = <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba" title="our poll structure">pmacfd</a>.fd == -1) {</div>
<div class="line">      <span class="keywordflow">if</span>( disconnected_notify == 0)</div>
<div class="line">        <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_worker: PMAC not connected&quot;</span>);</div>
<div class="line">      disconnected_notify = 1;</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// At this point we assume we became disconnected due to something like a hard boot of the MD2 PMAC</span></div>
<div class="line">      <span class="comment">// and hence the entire system needs reinitialization.</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// It&#39;s possible to put in a test here (perhaps using I65) to see if we in fact suffered a reset</span></div>
<div class="line">      <span class="comment">// and need to clear the queue, reinitialize, etc.  Or if it was just a networking glitch and do not</span></div>
<div class="line">      <span class="comment">// need to clear the queue and should instead just charge ahead.</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <a class="code" href="lspmac_8c.html#a42a441a750044362f1d21bf9f08521cb" title="Clear the queue as part of PMAC reinitialization.">lspmac_reset_queue</a>();</div>
<div class="line">      sleep( 10);</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// This just puts us into a holding pattern until the pmac becomes connected again</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="keywordflow">continue</span>;</div>
<div class="line">    }</div>
<div class="line">    disconnected_notify = 0;</div>
<div class="line"></div>
<div class="line">    pollrtn = poll( &amp;<a class="code" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba" title="our poll structure">pmacfd</a>, 1, 10);</div>
<div class="line">    <span class="keywordflow">if</span>( pollrtn) {</div>
<div class="line">      <a class="code" href="lspmac_8c.html#af3fa79868ba88f7c37f7b8f7d53149ff" title="Service routine for packet coming from the PMAC.">lspmac_Service</a>( &amp;<a class="code" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba" title="our poll structure">pmacfd</a>);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3816a9a1a3bb5bb89fcec8a30d863970"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_zoom_lut_setup </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set up lookup table for zoom. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l03302">3302</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                             {</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">  <a class="code" href="structlsredis__obj__struct.html" title="Redis Object Basic object whose value is sychronized with our redis db.">lsredis_obj_t</a> *<a class="code" href="namespacemk__pgpmac__redis.html#a11daf2847f2dc94562b5b61b3f412574">p</a>;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#ad53a42cfaa04eff0336a44c8c9986333" title="Optical zoom.">zoom</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#ad53a42cfaa04eff0336a44c8c9986333" title="Optical zoom.">zoom</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a> = 10;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ad53a42cfaa04eff0336a44c8c9986333" title="Optical zoom.">zoom</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a> = calloc( 2 * <a class="code" href="lspmac_8c.html#ad53a42cfaa04eff0336a44c8c9986333" title="Optical zoom.">zoom</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a>, <span class="keyword">sizeof</span>( <span class="keywordtype">double</span>));</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#ad53a42cfaa04eff0336a44c8c9986333" title="Optical zoom.">zoom</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a> == NULL) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_zoom_lut_setup: out of memory&quot;</span>);</div>
<div class="line">    exit( -1);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i &lt; <a class="code" href="lspmac_8c.html#ad53a42cfaa04eff0336a44c8c9986333" title="Optical zoom.">zoom</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a>; i++) {</div>
<div class="line">    p = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;cam.zoom.%d.MotorPosition&quot;</span>, i+1);</div>
<div class="line">    <span class="keywordflow">if</span>( p==NULL || strlen( <a class="code" href="lsredis_8c.html#ac1994e56114b2315294527d76311f829" title="return a copy of the key&#39;s string value">lsredis_getstr</a>(p)) == 0) {</div>
<div class="line">      free( <a class="code" href="lspmac_8c.html#ad53a42cfaa04eff0336a44c8c9986333" title="Optical zoom.">zoom</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>);</div>
<div class="line">      <a class="code" href="lspmac_8c.html#ad53a42cfaa04eff0336a44c8c9986333" title="Optical zoom.">zoom</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>  = NULL;</div>
<div class="line">      <a class="code" href="lspmac_8c.html#ad53a42cfaa04eff0336a44c8c9986333" title="Optical zoom.">zoom</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a> = 0;</div>
<div class="line">      pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#ad53a42cfaa04eff0336a44c8c9986333" title="Optical zoom.">zoom</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>);</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_zoom_lut_setup: cannot find MotorPosition element for cam.zoom level %d&quot;</span>, i+1);</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ad53a42cfaa04eff0336a44c8c9986333" title="Optical zoom.">zoom</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>[2*<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>]   = i+1;</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ad53a42cfaa04eff0336a44c8c9986333" title="Optical zoom.">zoom</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>[2*i+1] = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( p);</div>
<div class="line">  }</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#ad53a42cfaa04eff0336a44c8c9986333" title="Optical zoom.">zoom</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a6cb218bdccfe5a93471c161f15a15cab"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* alignx</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Alignment stage X. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00090">90</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a737c246c3948e644a18d191a931e1acd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* aligny</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Alignment stage Y. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00091">91</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae7642b1da0f7c7f8448104c691d40a12"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* alignz</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Alignment stage X. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00092">92</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa90d2363b744acbd4d45133b7a716d8f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* anal</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Polaroid analyzer motor. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00093">93</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a139200ddaa9856a7ffcec0e6cbaa8f1b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* apery</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Aperture Y. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00095">95</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab93bd6ee850b285ca3a95e64d15e9477"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* aperz</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Aperture Z. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00096">96</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="afaff4fbb5f03b0d2469fc7a14f174d69"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* arm_parked</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>(whose arm? parked where?) </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00133">133</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a85d6eaa4b4a82bb3112574f458d1dc50"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* blight</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Back Light DAC. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00107">107</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac0d0bc95bcbcbd154b30c72a9645c8b2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* blight_down</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Backlight is down. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00123">123</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="af55c51d52c4586b647114f95d7ac1f42"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* blight_f</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Back light scale factor. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00116">116</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="af813a2eff0b7efa4c70633559054e84c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* blight_ud</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Back light Up/Down actuator. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00111">111</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7fba65f6555c5c7908852c6cf1ad0c94"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* blight_up</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Backlight is up. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00124">124</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a51358daaea8b5236f08414877d8af6c2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* capy</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Capillary Y. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00097">97</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa45f268d0af9f3d465acfab128919718"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* capz</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Capillary Z. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00098">98</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac940d950d9efeaf3f0ae67e9bf331188"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* cenx</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Centering Table X. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00100">100</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aaed18e738ba7bfb6c771a44f5d7ea827"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* ceny</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Centering Table Y. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00101">101</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8908812f4ff25c196679e00d330edd81"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a2d163436571135a457f4a4e2fbd09633">pmac_cmd_t</a> cr_cmd</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>commands to send out "readready", "getbuffer", "controlresponse" (initialized in main) </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00185">185</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae78d9a757d4c85419fff9c94b15e25d7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* cryo</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Move the cryostream towards or away from the crystal. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00112">112</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a871d4cdea0a1a8db85b8658a07655212"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* cryo_back</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>cryo is in the back position </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00125">125</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a28df32fd6be9160603aa1bb74a823574"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* cryo_switch</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>that little toggle switch for the cryo </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00122">122</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9da2795d11ccbc3a060c4811770ad04c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char dbmem[64 *1024]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>double buffered memory </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00174">174</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa0be2f26364c4d12c9c81c10913f0b26"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int dbmemIn = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>next location </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00175">175</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9d9c5030d817483ca9518027c91adac4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* dryer</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>blow air on the scintilator to dry it off </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00113">113</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1e690d4ad981d020ea2c850282dca3be"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* etel_init_ok</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ETEL initialized OK. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00130">130</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab48d4a2cf0225796db9aad49f034dc59"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* etel_on</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ETEL is on. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00129">129</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5538a6aa526eeed65ff237303da2d348"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* etel_ready</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ETEL is ready. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00128">128</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae85caec6f4ddb2fc52ca14a26549ab08"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int ethCmdOff = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>points to current command (or none if == ethCmdOn) </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00188">188</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad62b1f9e907acc3de9f3d6a05d55829e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int ethCmdOn = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>points to next empty PMAC command queue position </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00187">187</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a69e569a833fe7f202b92e860d1548f2b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> ethCmdQueue[<a class="el" href="lspmac_8c.html#a3fae557baafab24b7518dc84f5ef5a9b">PMAC_CMD_QUEUE_LENGTH</a>]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>PMAC command queue. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00186">186</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7a78524ada402bb74759a3dfc5f8a571"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int ethCmdReply = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Used like ethCmdOff only to deal with the pmac reply to a command. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00189">189</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aeb09895663eff333b7a75acb319a9fc1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* flight</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Front Light DAC. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00106">106</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aabf4ec595b5183c1777d029ca56134b0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* flight_f</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Front light scale factor. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00117">117</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6630442dc65ce8a30a24ed718b301971"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* flight_oo</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Turn front light on/off. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00115">115</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="addb26c80065506faa1de3c1b468fe03f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* fluo</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Move the fluorescence detector in/out. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00114">114</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a67092de6f3fcc0b245e4970437eaff6b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* fluor_back</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>fluor is in the back position </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00126">126</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8a3ca6fcf5e24dcc26170736843e53b2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* fscint</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Scintillator Piezo DAC. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00108">108</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a26dec4623af9beed912b8e7e6f99822c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* fshut</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fast shutter. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00105">105</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae7b21213b9c78b6745213409f1ef7320"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a2d163436571135a457f4a4e2fbd09633">pmac_cmd_t</a> gb_cmd</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00185">185</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a07b7b8254772075e6a4ced500b589c36"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int getivars = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>flag set at initialization to send i vars to db </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00081">81</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a50e9c0a06654fd81b3446a6e54ff12c3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int getmvars = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>flag set at initialization to send m vars to db </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00082">82</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="abb29b117ad38156ba16fcf44eeb427af"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* hp_air</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>High pressure air OK. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00121">121</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a0be79ccb7ebf3a665248fd856112b9fd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* kappa</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Kappa. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00102">102</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aade15098d213bb25522048e4a231941a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* lp_air</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Low pressure air OK. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00120">120</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6d9261680ee01b1e106d1ea1d7ffa390"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int ls_pmac_state = <a class="el" href="lspmac_8c.html#a7eb86ecf0789ab9555de1e03a4c73567">LS_PMAC_STATE_DETACHED</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Current state of the PMAC communications state machine. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00051">51</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a859f81d68defff3836a94afd5ef38e9a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lspmac_8c.html#a3f7d17365bd23c29c6f498210179d2c1">lspmac_ascii_buffers_t</a> lspmac_ascii_buffers</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00354">354</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3e7ae750b8988cd2eb93895e3ea1a49e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t lspmac_ascii_buffers_mutex</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00355">355</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="afb9e57459496c33e0da5cdb773113a61"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_ascii_busy = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>flag for condition to wait for </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00068">68</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2ff142105e17d933871d09759e7082f8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t lspmac_ascii_mutex</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Keep too many processes from sending commands at once. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00067">67</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a37c46609cb32aea5178c4d59d7892d13"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> lspmac_bis[32]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>array of binary inputs </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00084">84</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9b0d9e2c858f6f0178be2bfdd96d4c05"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t lspmac_dpascii_off = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00365">365</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a09701de0235acaeae5abf4e04268be33"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t lspmac_dpascii_on = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00364">364</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2bd5340143f40b5e6404a381fb438710"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lspmac_8c.html#a93786bb32f3e2ef44e7967210beeeca3">lspmac_dpascii_queue_t</a> lspmac_dpascii_queue[<a class="el" href="lspmac_8c.html#a3a407e2e4d57ac45ecd700f8bad3d3b5">LSPMAC_DPASCII_QUEUE_LENGTH</a>]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00363">363</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a894c709ddd0652583d6db22e86282503"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> lspmac_motors[48]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>All our motors. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00087">87</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a57547d211906c981ef20257eba99f8df"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_cond_t lspmac_moving_cond</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for motor(s) to finish moving condition. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00064">64</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7a32c617c183166308241e270959df56"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_moving_flags</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Flag used to implement motor moving condition. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00065">65</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a85679cac947e199c88794f8e5a12bf5f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t lspmac_moving_mutex</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Coordinate moving motors between threads. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00063">63</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a33c5ed169a5437cb59ab904ffa3e3ffe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_nbis = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>number of active binary inputs </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00085">85</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a56260f012c50a591ee7f97e500f16994"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_nmotors = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The number of motors we manage. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00088">88</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="afbd51c2cefcee87afe994c9e9f372241"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_cond_t lspmac_shutter_cond</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allows waiting for the shutter status to change. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00062">62</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a396fbf06208de3ecbe1b0df549f1cd46"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_shutter_has_opened</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Indicates that the shutter had opened, perhaps briefly even if the state did not change. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00060">60</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1b78a13c654409333569815e1c109d38"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t lspmac_shutter_mutex</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Coordinates threads reading shutter status. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00061">61</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a112158e0cd50449a440ac55c7af7bea2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_shutter_state</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>State of the shutter, used to detect changes. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00059">59</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9c950ade1e11ec8d4c859d7f1bf94864"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct timespec lspmac_status_last_time</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Time the status was read. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00074">74</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae3bf4c21e9e375862e5a955b539fb073"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct timespec lspmac_status_time</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Time the status was read. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00073">73</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad5bce7451d48127bace5af445d03b492"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lspmac_8c.html#a3495613b8b94cadc4205f19e1254ebeb">md2_status_t</a> md2_status</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Buffer for MD2 Status. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00340">340</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7a3e763682bd7f987d07f149e94b3bf8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t md2_status_mutex</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Synchronize reading/writting status buffer. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00341">341</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab552f2e28dd9cccefafe01f27717101b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* minikappa_ok</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Minikappa is OK (whatever that means) </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00131">131</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a4bed9053319d1d2cad5cc03d0549e17f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct timeval pmac_time_sent now</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00181">181</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8237e646ce032a840637a4ef7bff49b9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* omega</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>MD2 omega axis (the air bearing) </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00089">89</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae06d2291c1996ffb7dcf7d132e25b038"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int omega_zero_search = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Indicate we'd really like to know when omega crosses zero. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00070">70</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae6631a094accc469661805bdf80fc6d8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct timespec omega_zero_time</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Time we believe that omega crossed zero. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00072">72</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aea11895d2ec4a3324f4baa9d24cd192d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double omega_zero_velocity = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>rate (cnts/sec) that omega was traveling when it crossed zero </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00071">71</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac8070dc568ad974a3db42b51eca828cc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* phi</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Phi (not data collection axis) </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00103">103</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aab5a76f1ac64049314f9836e5c01fb7e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">char* pmac_error_strs[]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div>
<div class="line">  <span class="stringliteral">&quot;ERR000: Unknown error&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;ERR001: Command not allowed during program execution&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;ERR002: Password error&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;ERR003: Data error or unrecognized command&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;ERR004: Illegal character&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;ERR005: Command not allowed unless buffer is open&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;ERR006: No room in buffer for command&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;ERR007: Buffer already in use&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;ERR008: MACRO auziliary communication error&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;ERR009: Program structure error (e.g. ENDIF without IF)&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;ERR010: Both overtravel limits set for a motor in the C.S.&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;ERR011: Previous move not completed&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;ERR012: A motor in the coordinate system is open-loop&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;ERR013: A motor in the coordinate system is not activated&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;ERR014: No motors in the coordinate system&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;ERR015: Not pointer to valid program buffer&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;ERR016: Running improperly structure program (e.g. missing ENDWHILE)&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;ERR017: Trying to resume after H or Q with motors out of stopped position&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;ERR018: Attempt to perform phase reference during move, move during phase reference, or enabling with phase clock error&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;ERR019: Illegal position-chage command while moves stored in CCBUFFER&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;ERR020: FSAVE issued on Turbo PMAC with incompatible flash memory&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;ERR021: FSAVE issued while clearing old flash memory sector&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;ERR022: FREAD attempted but the flash memory is bad&quot;</span></div>
<div class="line">}</div>
</div><!-- fragment -->
<p>Decode the errors perhaps returned by the PMAC. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00192">192</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8a25bd9c593c6985107f90f999ce0b08"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_cond_t pmac_queue_cond</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>wait for a command to be sent to PMAC before continuing </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00078">78</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="acc1bb77b9bcbc4d970f841a41fd274b3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t pmac_queue_mutex</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>manage access to the pmac command queue </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00077">77</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6b7011dd7d2c2d3afadff8d3e50e7677"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pthread_t pmac_thread</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>our thread to manage access and communication to the pmac </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00076">76</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="adba7f5f4bbeabc4dac859221d4c684ba"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct pollfd pmacfd</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>our poll structure </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00079">79</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6fcbbe47fe9912533962601f5befdb29"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a2d163436571135a457f4a4e2fbd09633">pmac_cmd_t</a> rr_cmd</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00185">185</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac59ab990e48033a811aeb0281fb588fc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* sample_detected</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>smart magnet detected sample </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00127">127</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a589431b3a79c21c251fcb97cc9126991"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* scint</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Scintillator Z. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00099">99</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae98a0792d6b4b96a33df0a31bdec6342"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* shutter_open</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>shutter is open (note in pmc says this is a slow input) </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00134">134</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a37903ed8430ac4d9ead609a78eb62f32"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* smart_mag_err</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>smart magnet error (coil broken perhaps) </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00135">135</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a4892e918830dd12093d28c53a1c2df98"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* smart_mag_off</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>smart magnet is off </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00136">136</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2dc6fa78bb6313fe8b696d646eaa2443"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* smart_mag_on</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>smart magnet is on </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00132">132</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="abee73a0d9e5f3af9eb88d5cfd6b953c3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* smart_mag_oo</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Smart Magnet on/off. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00110">110</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad53a42cfaa04eff0336a44c8c9986333"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* zoom</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Optical zoom. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00094">94</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="lspmac_8c.html">lspmac.c</a></li>
    <li class="footer">Generated on Tue Jan 22 2013 22:41:06 for LS-CAT PGPMAC by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 </li>
  </ul>
</div>
</body>
</html>
