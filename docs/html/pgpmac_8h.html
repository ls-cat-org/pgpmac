<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LS-CAT PGPMAC: pgpmac.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LS-CAT PGPMAC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('pgpmac_8h.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">pgpmac.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Headers for the entire pgpmac project.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &lt;sys/types.h&gt;</code><br/>
<code>#include &lt;sys/socket.h&gt;</code><br/>
<code>#include &lt;netdb.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;netinet/in.h&gt;</code><br/>
<code>#include &lt;errno.h&gt;</code><br/>
<code>#include &lt;poll.h&gt;</code><br/>
<code>#include &lt;libpq-fe.h&gt;</code><br/>
<code>#include &lt;ncurses.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &lt;pthread.h&gt;</code><br/>
<code>#include &lt;signal.h&gt;</code><br/>
<code>#include &lt;sys/signalfd.h&gt;</code><br/>
<code>#include &lt;sys/time.h&gt;</code><br/>
<code>#include &lt;time.h&gt;</code><br/>
<code>#include &lt;getopt.h&gt;</code><br/>
<code>#include &lt;regex.h&gt;</code><br/>
<code>#include &lt;hiredis/hiredis.h&gt;</code><br/>
<code>#include &lt;hiredis/async.h&gt;</code><br/>
<code>#include &lt;search.h&gt;</code><br/>
<code>#include &lt;ctype.h&gt;</code><br/>
</div>
<p><a href="pgpmac_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlsredis__obj__struct.html">lsredis_obj_struct</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Redis Object Basic object whose value is sychronized with our redis db.  <a href="structlsredis__obj__struct.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structtagEthernetCmd.html">tagEthernetCmd</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">PMAC ethernet packet definition.  <a href="structtagEthernetCmd.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlspmac__cmd__queue__struct.html">lspmac_cmd_queue_struct</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">PMAC command queue item.  <a href="structlspmac__cmd__queue__struct.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_struct</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Motor information.  <a href="structlspmac__motor__struct.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlspmac__bi__struct.html">lspmac_bi_struct</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Storage for binary inputs.  <a href="structlspmac__bi__struct.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlspgQueryQueueStruct.html">lspgQueryQueueStruct</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Store each query along with it's callback function.  <a href="structlspgQueryQueueStruct.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlspg__waitcryo__struct.html">lspg_waitcryo_struct</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlspg__getcurrentsampleid__struct.html">lspg_getcurrentsampleid_struct</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlspg__demandairrights__struct.html">lspg_demandairrights_struct</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlspg__getcenter__struct.html">lspg_getcenter_struct</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Storage for getcenter query Used for the md2 ROTATE command that generates the centering movies.  <a href="structlspg__getcenter__struct.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlspg__starttransfer__struct.html">lspg_starttransfer_struct</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">returns 1 if transfer can continue 0 to abort  <a href="structlspg__starttransfer__struct.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlspg__nextsample__struct.html">lspg_nextsample_struct</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the next sample number Just a 32 bit int (Ha!, take that, nextshot!)  <a href="structlspg__nextsample__struct.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlspg__nextshot__struct.html">lspg_nextshot_struct</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Storage definition for nextshot query.  <a href="structlspg__nextshot__struct.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a369266c24eacffb87046522897a570d5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a369266c24eacffb87046522897a570d5">_GNU_SOURCE</a></td></tr>
<tr class="separator:a369266c24eacffb87046522897a570d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3bae94e8e4e4347dd5f87b6bda058de6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a3bae94e8e4e4347dd5f87b6bda058de6">LS_DISPLAY_WINDOW_HEIGHT</a>&#160;&#160;&#160;8</td></tr>
<tr class="memdesc:a3bae94e8e4e4347dd5f87b6bda058de6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of status box rows.  <a href="#a3bae94e8e4e4347dd5f87b6bda058de6"></a><br/></td></tr>
<tr class="separator:a3bae94e8e4e4347dd5f87b6bda058de6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f96754f00a1f82414cebc66f75ded78"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78">LS_DISPLAY_WINDOW_WIDTH</a>&#160;&#160;&#160;24</td></tr>
<tr class="memdesc:a1f96754f00a1f82414cebc66f75ded78"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of status box columns.  <a href="#a1f96754f00a1f82414cebc66f75ded78"></a><br/></td></tr>
<tr class="separator:a1f96754f00a1f82414cebc66f75ded78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a8ef1b4b5994d6dd12bf74454ea891b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a3a8ef1b4b5994d6dd12bf74454ea891b">LS_PG_QUERY_STRING_LENGTH</a>&#160;&#160;&#160;1024</td></tr>
<tr class="memdesc:a3a8ef1b4b5994d6dd12bf74454ea891b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fixed length postgresql query strings. Queries should all be function calls so this is not as weird as one might think.  <a href="#a3a8ef1b4b5994d6dd12bf74454ea891b"></a><br/></td></tr>
<tr class="separator:a3a8ef1b4b5994d6dd12bf74454ea891b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab61d790b5572f116e091babfda53627b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ab61d790b5572f116e091babfda53627b">LSEVENTS_EVENT_LENGTH</a>&#160;&#160;&#160;256</td></tr>
<tr class="memdesc:ab61d790b5572f116e091babfda53627b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fixed length for event names: simplifies string handling.  <a href="#ab61d790b5572f116e091babfda53627b"></a><br/></td></tr>
<tr class="separator:ab61d790b5572f116e091babfda53627b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe2a74d23400d8d8fe02dc407c242035"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#abe2a74d23400d8d8fe02dc407c242035">LSPMAC_MAGIC_NUMBER</a>&#160;&#160;&#160;0x9700436</td></tr>
<tr class="separator:abe2a74d23400d8d8fe02dc407c242035"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30f0f377b0f0695284145d420ea51846"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a30f0f377b0f0695284145d420ea51846">MD2CMDS_CMD_LENGTH</a>&#160;&#160;&#160;32</td></tr>
<tr class="separator:a30f0f377b0f0695284145d420ea51846"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ad449de06d02791adf2498d2a1e1f909c"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structlsredis__obj__struct.html">lsredis_obj_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a></td></tr>
<tr class="memdesc:ad449de06d02791adf2498d2a1e1f909c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Redis Object Basic object whose value is sychronized with our redis db.  <a href="#ad449de06d02791adf2498d2a1e1f909c"></a><br/></td></tr>
<tr class="separator:ad449de06d02791adf2498d2a1e1f909c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d163436571135a457f4a4e2fbd09633"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structtagEthernetCmd.html">tagEthernetCmd</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a2d163436571135a457f4a4e2fbd09633">pmac_cmd_t</a></td></tr>
<tr class="memdesc:a2d163436571135a457f4a4e2fbd09633"><td class="mdescLeft">&#160;</td><td class="mdescRight">PMAC ethernet packet definition.  <a href="#a2d163436571135a457f4a4e2fbd09633"></a><br/></td></tr>
<tr class="separator:a2d163436571135a457f4a4e2fbd09633"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99c275e32ad897dca34d196b91f038cb"><td class="memItemLeft" align="right" valign="top">typedef struct <br class="typebreak"/>
<a class="el" href="structlspmac__cmd__queue__struct.html">lspmac_cmd_queue_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a></td></tr>
<tr class="memdesc:a99c275e32ad897dca34d196b91f038cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">PMAC command queue item.  <a href="#a99c275e32ad897dca34d196b91f038cb"></a><br/></td></tr>
<tr class="separator:a99c275e32ad897dca34d196b91f038cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa5067fcbaabc5bbfdc52492495518c96"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structlspmac__motor__struct.html">lspmac_motor_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a></td></tr>
<tr class="memdesc:aa5067fcbaabc5bbfdc52492495518c96"><td class="mdescLeft">&#160;</td><td class="mdescRight">Motor information.  <a href="#aa5067fcbaabc5bbfdc52492495518c96"></a><br/></td></tr>
<tr class="separator:aa5067fcbaabc5bbfdc52492495518c96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac48984832ef73cf145e5f08bc65bd3a0"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structlspmac__bi__struct.html">lspmac_bi_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a></td></tr>
<tr class="memdesc:ac48984832ef73cf145e5f08bc65bd3a0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Storage for binary inputs.  <a href="#ac48984832ef73cf145e5f08bc65bd3a0"></a><br/></td></tr>
<tr class="separator:ac48984832ef73cf145e5f08bc65bd3a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae57432c0a6ac48a50457815dab2c5b4c"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structlspgQueryQueueStruct.html">lspgQueryQueueStruct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a></td></tr>
<tr class="memdesc:ae57432c0a6ac48a50457815dab2c5b4c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Store each query along with it's callback function.  <a href="#ae57432c0a6ac48a50457815dab2c5b4c"></a><br/></td></tr>
<tr class="separator:ae57432c0a6ac48a50457815dab2c5b4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a779e2acce8b5e748c184caf23ed0db57"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structlspg__waitcryo__struct.html">lspg_waitcryo_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a779e2acce8b5e748c184caf23ed0db57">lspg_waitcryo_t</a></td></tr>
<tr class="separator:a779e2acce8b5e748c184caf23ed0db57"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a794370785ff015d5ee035917e3bee8"><td class="memItemLeft" align="right" valign="top">typedef struct <br class="typebreak"/>
<a class="el" href="structlspg__getcurrentsampleid__struct.html">lspg_getcurrentsampleid_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a7a794370785ff015d5ee035917e3bee8">lspg_getcurrentsampleid_t</a></td></tr>
<tr class="separator:a7a794370785ff015d5ee035917e3bee8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f71abc6fdfd1839e2e3213d78aaf766"><td class="memItemLeft" align="right" valign="top">typedef struct <br class="typebreak"/>
<a class="el" href="structlspg__demandairrights__struct.html">lspg_demandairrights_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a7f71abc6fdfd1839e2e3213d78aaf766">lspg_demandairrights_t</a></td></tr>
<tr class="separator:a7f71abc6fdfd1839e2e3213d78aaf766"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48b627e412dd038c1f17cdb0501eec33"><td class="memItemLeft" align="right" valign="top">typedef struct <br class="typebreak"/>
<a class="el" href="structlspg__getcenter__struct.html">lspg_getcenter_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a48b627e412dd038c1f17cdb0501eec33">lspg_getcenter_t</a></td></tr>
<tr class="memdesc:a48b627e412dd038c1f17cdb0501eec33"><td class="mdescLeft">&#160;</td><td class="mdescRight">Storage for getcenter query Used for the md2 ROTATE command that generates the centering movies.  <a href="#a48b627e412dd038c1f17cdb0501eec33"></a><br/></td></tr>
<tr class="separator:a48b627e412dd038c1f17cdb0501eec33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1f0e602ae9509005c62fb2d73bc1c5a"><td class="memItemLeft" align="right" valign="top">typedef struct <br class="typebreak"/>
<a class="el" href="structlspg__starttransfer__struct.html">lspg_starttransfer_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#aa1f0e602ae9509005c62fb2d73bc1c5a">lspg_starttransfer_t</a></td></tr>
<tr class="memdesc:aa1f0e602ae9509005c62fb2d73bc1c5a"><td class="mdescLeft">&#160;</td><td class="mdescRight">returns 1 if transfer can continue 0 to abort  <a href="#aa1f0e602ae9509005c62fb2d73bc1c5a"></a><br/></td></tr>
<tr class="separator:aa1f0e602ae9509005c62fb2d73bc1c5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9dda9014cd0e39fba8d523e37cf9f982"><td class="memItemLeft" align="right" valign="top">typedef struct <br class="typebreak"/>
<a class="el" href="structlspg__nextsample__struct.html">lspg_nextsample_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a9dda9014cd0e39fba8d523e37cf9f982">lspg_nextsample_t</a></td></tr>
<tr class="memdesc:a9dda9014cd0e39fba8d523e37cf9f982"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the next sample number Just a 32 bit int (Ha!, take that, nextshot!)  <a href="#a9dda9014cd0e39fba8d523e37cf9f982"></a><br/></td></tr>
<tr class="separator:a9dda9014cd0e39fba8d523e37cf9f982"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17ea2bf07a0b3b892baa00bd392607b3"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structlspg__nextshot__struct.html">lspg_nextshot_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a17ea2bf07a0b3b892baa00bd392607b3">lspg_nextshot_t</a></td></tr>
<tr class="memdesc:a17ea2bf07a0b3b892baa00bd392607b3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Storage definition for nextshot query.  <a href="#a17ea2bf07a0b3b892baa00bd392607b3"></a><br/></td></tr>
<tr class="separator:a17ea2bf07a0b3b892baa00bd392607b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a6a1b639686b771c1213b6e23716a7898"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a6a1b639686b771c1213b6e23716a7898">lspmac_getPosition</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *)</td></tr>
<tr class="memdesc:a6a1b639686b771c1213b6e23716a7898"><td class="mdescLeft">&#160;</td><td class="mdescRight">get the motor position (with locking)  <a href="#a6a1b639686b771c1213b6e23716a7898"></a><br/></td></tr>
<tr class="separator:a6a1b639686b771c1213b6e23716a7898"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ee000bfeef9380d479464a9500af311"><td class="memItemLeft" align="right" valign="top">char **&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a4ee000bfeef9380d479464a9500af311">lspg_array2ptrs</a> (char *)</td></tr>
<tr class="memdesc:a4ee000bfeef9380d479464a9500af311"><td class="mdescLeft">&#160;</td><td class="mdescRight">returns a null terminated list of strings parsed from postgresql array  <a href="#a4ee000bfeef9380d479464a9500af311"></a><br/></td></tr>
<tr class="separator:a4ee000bfeef9380d479464a9500af311"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe31d0e11c41b2235307612c963bb652"><td class="memItemLeft" align="right" valign="top">char **&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#abe31d0e11c41b2235307612c963bb652">lsredis_get_string_array</a> (<a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *p)</td></tr>
<tr class="separator:abe31d0e11c41b2235307612c963bb652"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a49a53bb92535ca2b62208dce41760fbb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a49a53bb92535ca2b62208dce41760fbb">lspmac_SockSendDPline</a> (char *, char *fmt,...)</td></tr>
<tr class="memdesc:a49a53bb92535ca2b62208dce41760fbb"><td class="mdescLeft">&#160;</td><td class="mdescRight">prepare (queue up) a line to send the dpram ascii command interface  <a href="#a49a53bb92535ca2b62208dce41760fbb"></a><br/></td></tr>
<tr class="separator:a49a53bb92535ca2b62208dce41760fbb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79f86193e36c823157049061b94627a7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a79f86193e36c823157049061b94627a7">lspmac_SockSendline</a> (char *, char *,...)</td></tr>
<tr class="memdesc:a79f86193e36c823157049061b94627a7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a one line command.  <a href="#a79f86193e36c823157049061b94627a7"></a><br/></td></tr>
<tr class="separator:a79f86193e36c823157049061b94627a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d9f550b9ba36acd237925164abe3ffc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a6d9f550b9ba36acd237925164abe3ffc">lsredis_get_obj</a> (char *,...)</td></tr>
<tr class="separator:a6d9f550b9ba36acd237925164abe3ffc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac1994e56114b2315294527d76311f829"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ac1994e56114b2315294527d76311f829">lsredis_getstr</a> (<a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *p)</td></tr>
<tr class="memdesc:ac1994e56114b2315294527d76311f829"><td class="mdescLeft">&#160;</td><td class="mdescRight">return a copy of the key's string value be sure to free the result  <a href="#ac1994e56114b2315294527d76311f829"></a><br/></td></tr>
<tr class="separator:ac1994e56114b2315294527d76311f829"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76b11c62b122ee0fd8399435d4260681"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a76b11c62b122ee0fd8399435d4260681">PmacSockSendline</a> (char *s)</td></tr>
<tr class="separator:a76b11c62b122ee0fd8399435d4260681"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4cc866393eda0cf20276d035f6fbe206"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a4cc866393eda0cf20276d035f6fbe206">lspg_nextsample_all</a> (int *err)</td></tr>
<tr class="separator:a4cc866393eda0cf20276d035f6fbe206"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b7600b1c9a4550b32d4be019d25f941"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a0b7600b1c9a4550b32d4be019d25f941">lsredis_getc</a> (<a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *p)</td></tr>
<tr class="separator:a0b7600b1c9a4550b32d4be019d25f941"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1923f998441f4f451204dfd214d52218"><td class="memItemLeft" align="right" valign="top">long int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a> (<a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *p)</td></tr>
<tr class="separator:a1923f998441f4f451204dfd214d52218"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac89b916c1152c44042875feac35a9e4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#aac89b916c1152c44042875feac35a9e4">lsevents_add_listener</a> (char *, void(*cb)(char *))</td></tr>
<tr class="memdesc:aac89b916c1152c44042875feac35a9e4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add a callback routine to listen for a specific event.  <a href="#aac89b916c1152c44042875feac35a9e4"></a><br/></td></tr>
<tr class="separator:aac89b916c1152c44042875feac35a9e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af19a77187e7406fc87d36bd26e672e6d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#af19a77187e7406fc87d36bd26e672e6d">lsevents_init</a> ()</td></tr>
<tr class="memdesc:af19a77187e7406fc87d36bd26e672e6d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize this module.  <a href="#af19a77187e7406fc87d36bd26e672e6d"></a><br/></td></tr>
<tr class="separator:af19a77187e7406fc87d36bd26e672e6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a024b08c7820bb31c3d5b8f281e07f3e8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a024b08c7820bb31c3d5b8f281e07f3e8">lsevents_remove_listener</a> (char *, void(*cb)(char *))</td></tr>
<tr class="memdesc:a024b08c7820bb31c3d5b8f281e07f3e8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove a listener previously added with lsevents_add_listener.  <a href="#a024b08c7820bb31c3d5b8f281e07f3e8"></a><br/></td></tr>
<tr class="separator:a024b08c7820bb31c3d5b8f281e07f3e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f2ed970b1c3b340b79311e73c5f1e11"><td class="memItemLeft" align="right" valign="top">pthread_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a7f2ed970b1c3b340b79311e73c5f1e11">lsevents_run</a> ()</td></tr>
<tr class="memdesc:a7f2ed970b1c3b340b79311e73c5f1e11"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start up the thread and get out of the way.  <a href="#a7f2ed970b1c3b340b79311e73c5f1e11"></a><br/></td></tr>
<tr class="separator:a7f2ed970b1c3b340b79311e73c5f1e11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3661dfc51537c05b11f4fd184fdff07d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a3661dfc51537c05b11f4fd184fdff07d">lsevents_send_event</a> (char *,...)</td></tr>
<tr class="memdesc:a3661dfc51537c05b11f4fd184fdff07d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Call the callback routines for the given event.  <a href="#a3661dfc51537c05b11f4fd184fdff07d"></a><br/></td></tr>
<tr class="separator:a3661dfc51537c05b11f4fd184fdff07d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae09cfa92dba806d8f8808e5822ea713c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ae09cfa92dba806d8f8808e5822ea713c">lsevents_preregister_event</a> (char *fmt,...)</td></tr>
<tr class="separator:ae09cfa92dba806d8f8808e5822ea713c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3418b9ab57811d28632794236e056408"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a3418b9ab57811d28632794236e056408">lslogging_init</a> ()</td></tr>
<tr class="memdesc:a3418b9ab57811d28632794236e056408"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the lslogging objects.  <a href="#a3418b9ab57811d28632794236e056408"></a><br/></td></tr>
<tr class="separator:a3418b9ab57811d28632794236e056408"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e756b36671055ef02a8f04d2ba8a93b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a0e756b36671055ef02a8f04d2ba8a93b">lslogging_log_message</a> (char *fmt,...)</td></tr>
<tr class="memdesc:a0e756b36671055ef02a8f04d2ba8a93b"><td class="mdescLeft">&#160;</td><td class="mdescRight">The routine everyone will be talking about.  <a href="#a0e756b36671055ef02a8f04d2ba8a93b"></a><br/></td></tr>
<tr class="separator:a0e756b36671055ef02a8f04d2ba8a93b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a065d09eb6914c057383980d3d786affc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a065d09eb6914c057383980d3d786affc">lsredis_log</a> (char *fmt,...)</td></tr>
<tr class="memdesc:a065d09eb6914c057383980d3d786affc"><td class="mdescLeft">&#160;</td><td class="mdescRight">send log message to our redis log key  <a href="#a065d09eb6914c057383980d3d786affc"></a><br/></td></tr>
<tr class="separator:a065d09eb6914c057383980d3d786affc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5d6951193d8b2df1e4dd61c53de76cc"><td class="memItemLeft" align="right" valign="top">pthread_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ab5d6951193d8b2df1e4dd61c53de76cc">lslogging_run</a> ()</td></tr>
<tr class="memdesc:ab5d6951193d8b2df1e4dd61c53de76cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start up the worker thread.  <a href="#ab5d6951193d8b2df1e4dd61c53de76cc"></a><br/></td></tr>
<tr class="separator:ab5d6951193d8b2df1e4dd61c53de76cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4cad634cac645d0366acbb25cef7b96"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#aa4cad634cac645d0366acbb25cef7b96">lspg_demandairrights_all</a> ()</td></tr>
<tr class="memdesc:aa4cad634cac645d0366acbb25cef7b96"><td class="mdescLeft">&#160;</td><td class="mdescRight">do nothing until we get airrights  <a href="#aa4cad634cac645d0366acbb25cef7b96"></a><br/></td></tr>
<tr class="separator:aa4cad634cac645d0366acbb25cef7b96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f7cd0a06f6a266ef65b3604cf33d6c4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a6f7cd0a06f6a266ef65b3604cf33d6c4">lspg_getcenter_call</a> ()</td></tr>
<tr class="memdesc:a6f7cd0a06f6a266ef65b3604cf33d6c4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Request a getcenter query.  <a href="#a6f7cd0a06f6a266ef65b3604cf33d6c4"></a><br/></td></tr>
<tr class="separator:a6f7cd0a06f6a266ef65b3604cf33d6c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c678553b44c874d08ec9966ed7bb1c0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a7c678553b44c874d08ec9966ed7bb1c0">lspg_getcenter_done</a> ()</td></tr>
<tr class="memdesc:a7c678553b44c874d08ec9966ed7bb1c0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Done with getcenter query.  <a href="#a7c678553b44c874d08ec9966ed7bb1c0"></a><br/></td></tr>
<tr class="separator:a7c678553b44c874d08ec9966ed7bb1c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e0e4b3cb9fa03961ee0c104e0b06754"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a3e0e4b3cb9fa03961ee0c104e0b06754">lspg_getcenter_wait</a> ()</td></tr>
<tr class="memdesc:a3e0e4b3cb9fa03961ee0c104e0b06754"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for a getcenter query to return.  <a href="#a3e0e4b3cb9fa03961ee0c104e0b06754"></a><br/></td></tr>
<tr class="separator:a3e0e4b3cb9fa03961ee0c104e0b06754"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39ff432056655f9dbe0f0239668caf74"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a39ff432056655f9dbe0f0239668caf74">lspg_getcurrentsampleid_all</a> ()</td></tr>
<tr class="memdesc:a39ff432056655f9dbe0f0239668caf74"><td class="mdescLeft">&#160;</td><td class="mdescRight">return the current sampleid  <a href="#a39ff432056655f9dbe0f0239668caf74"></a><br/></td></tr>
<tr class="separator:a39ff432056655f9dbe0f0239668caf74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02d7dc2b8b8667b07b48d9147eb4621d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a02d7dc2b8b8667b07b48d9147eb4621d">lspg_getcurrentsampleid_wait_for_id</a> (unsigned int test)</td></tr>
<tr class="separator:a02d7dc2b8b8667b07b48d9147eb4621d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a77972df14166e05c94ed0792baa09b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a8a77972df14166e05c94ed0792baa09b">lspg_init</a> ()</td></tr>
<tr class="memdesc:a8a77972df14166e05c94ed0792baa09b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initiallize the lspg module.  <a href="#a8a77972df14166e05c94ed0792baa09b"></a><br/></td></tr>
<tr class="separator:a8a77972df14166e05c94ed0792baa09b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af17ef79544ca5d78fd477010fe90d538"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#af17ef79544ca5d78fd477010fe90d538">lspg_nextshot_call</a> ()</td></tr>
<tr class="memdesc:af17ef79544ca5d78fd477010fe90d538"><td class="mdescLeft">&#160;</td><td class="mdescRight">Queue up a nextshot query.  <a href="#af17ef79544ca5d78fd477010fe90d538"></a><br/></td></tr>
<tr class="separator:af17ef79544ca5d78fd477010fe90d538"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50458a014041a4118452802dfb303960"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a50458a014041a4118452802dfb303960">lspg_nextshot_done</a> ()</td></tr>
<tr class="memdesc:a50458a014041a4118452802dfb303960"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called when the next shot query has been processed.  <a href="#a50458a014041a4118452802dfb303960"></a><br/></td></tr>
<tr class="separator:a50458a014041a4118452802dfb303960"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a784a6de32a86fec9efb3ef3ae4b6e3ac"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a784a6de32a86fec9efb3ef3ae4b6e3ac">lspg_nextshot_wait</a> ()</td></tr>
<tr class="memdesc:a784a6de32a86fec9efb3ef3ae4b6e3ac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for the next shot query to get processed.  <a href="#a784a6de32a86fec9efb3ef3ae4b6e3ac"></a><br/></td></tr>
<tr class="separator:a784a6de32a86fec9efb3ef3ae4b6e3ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c9f2cdd05a9a7fc2c1e03ffebec9d9f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a5c9f2cdd05a9a7fc2c1e03ffebec9d9f">lspg_query_push</a> (void(*cb)(<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *, PGresult *), void(*ecb)(), char *fmt,...)</td></tr>
<tr class="memdesc:a5c9f2cdd05a9a7fc2c1e03ffebec9d9f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Place a query on the queue.  <a href="#a5c9f2cdd05a9a7fc2c1e03ffebec9d9f"></a><br/></td></tr>
<tr class="separator:a5c9f2cdd05a9a7fc2c1e03ffebec9d9f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a80df49750b61bb2526618db4253fc4ce"><td class="memItemLeft" align="right" valign="top">pthread_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a80df49750b61bb2526618db4253fc4ce">lspg_run</a> ()</td></tr>
<tr class="memdesc:a80df49750b61bb2526618db4253fc4ce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start 'er runnin'.  <a href="#a80df49750b61bb2526618db4253fc4ce"></a><br/></td></tr>
<tr class="separator:a80df49750b61bb2526618db4253fc4ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d3cf153b086f5252f248d17db824917"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a5d3cf153b086f5252f248d17db824917">lspg_seq_run_prep_all</a> (long long skey, double <a class="el" href="pgpmac_8h.html#a0be79ccb7ebf3a665248fd856112b9fd">kappa</a>, double <a class="el" href="pgpmac_8h.html#ac8070dc568ad974a3db42b51eca828cc">phi</a>, double cx, double cy, double ax, double ay, double az)</td></tr>
<tr class="memdesc:a5d3cf153b086f5252f248d17db824917"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convinence function to call seq run prep.  <a href="#a5d3cf153b086f5252f248d17db824917"></a><br/></td></tr>
<tr class="separator:a5d3cf153b086f5252f248d17db824917"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af72c4b037347737df09348ab703f6802"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#af72c4b037347737df09348ab703f6802">lspg_starttransfer_call</a> (unsigned int nextsample, int <a class="el" href="pgpmac_8h.html#ac59ab990e48033a811aeb0281fb588fc">sample_detected</a>, double ax, double ay, double az, double horz, double vert, double esttime)</td></tr>
<tr class="separator:af72c4b037347737df09348ab703f6802"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad989179281d8b65b940250a4580007d0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ad989179281d8b65b940250a4580007d0">lspg_starttransfer_done</a> ()</td></tr>
<tr class="separator:ad989179281d8b65b940250a4580007d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a189e9fd5cbc06dd09e5549f6e229fa5e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a189e9fd5cbc06dd09e5549f6e229fa5e">lspg_starttransfer_wait</a> ()</td></tr>
<tr class="separator:a189e9fd5cbc06dd09e5549f6e229fa5e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68d367d98c780a95b2c347d09e9ddec3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a68d367d98c780a95b2c347d09e9ddec3">lspg_waitcryo_all</a> ()</td></tr>
<tr class="memdesc:a68d367d98c780a95b2c347d09e9ddec3"><td class="mdescLeft">&#160;</td><td class="mdescRight">no need to get fancy with the wait cryo command It should not return until the robot is almost ready for air rights  <a href="#a68d367d98c780a95b2c347d09e9ddec3"></a><br/></td></tr>
<tr class="separator:a68d367d98c780a95b2c347d09e9ddec3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7497a7c924b31c727ea487a3efb77fb6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a7497a7c924b31c727ea487a3efb77fb6">lspg_waitcryo_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="separator:a7497a7c924b31c727ea487a3efb77fb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95e3fd7c1685d7e6ab6d0a295ab42f78"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a95e3fd7c1685d7e6ab6d0a295ab42f78">lspg_zoom_lut_call</a> ()</td></tr>
<tr class="separator:a95e3fd7c1685d7e6ab6d0a295ab42f78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4bf3a54deeaeb6e93dc3183388ad104"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ac4bf3a54deeaeb6e93dc3183388ad104">lspmac_getBIPosition</a> (<a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *)</td></tr>
<tr class="memdesc:ac4bf3a54deeaeb6e93dc3183388ad104"><td class="mdescLeft">&#160;</td><td class="mdescRight">get binary input value  <a href="#ac4bf3a54deeaeb6e93dc3183388ad104"></a><br/></td></tr>
<tr class="separator:ac4bf3a54deeaeb6e93dc3183388ad104"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fbadf816a842c8f131cf8ee47b54e29"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a9fbadf816a842c8f131cf8ee47b54e29">lspmac_home1_queue</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp)</td></tr>
<tr class="memdesc:a9fbadf816a842c8f131cf8ee47b54e29"><td class="mdescLeft">&#160;</td><td class="mdescRight">Home the motor.  <a href="#a9fbadf816a842c8f131cf8ee47b54e29"></a><br/></td></tr>
<tr class="separator:a9fbadf816a842c8f131cf8ee47b54e29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43e54631dc8de372854ebbb63ff28f70"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a43e54631dc8de372854ebbb63ff28f70">lspmac_home2_queue</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp)</td></tr>
<tr class="memdesc:a43e54631dc8de372854ebbb63ff28f70"><td class="mdescLeft">&#160;</td><td class="mdescRight">Second stage of homing.  <a href="#a43e54631dc8de372854ebbb63ff28f70"></a><br/></td></tr>
<tr class="separator:a43e54631dc8de372854ebbb63ff28f70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85f7a5e4d853b7a86ddde1006dd4dc1f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a85f7a5e4d853b7a86ddde1006dd4dc1f">lspmac_abort</a> ()</td></tr>
<tr class="memdesc:a85f7a5e4d853b7a86ddde1006dd4dc1f"><td class="mdescLeft">&#160;</td><td class="mdescRight">abort motion and try to recover  <a href="#a85f7a5e4d853b7a86ddde1006dd4dc1f"></a><br/></td></tr>
<tr class="separator:a85f7a5e4d853b7a86ddde1006dd4dc1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca5a35903f027178fd9698a5a10537e7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#aca5a35903f027178fd9698a5a10537e7">lspmac_spin</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *)</td></tr>
<tr class="separator:aca5a35903f027178fd9698a5a10537e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3e30b0ba9b5d5a291fa29b77ba920d8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ae3e30b0ba9b5d5a291fa29b77ba920d8">lspmac_init</a> (int, int)</td></tr>
<tr class="memdesc:ae3e30b0ba9b5d5a291fa29b77ba920d8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize this module.  <a href="#ae3e30b0ba9b5d5a291fa29b77ba920d8"></a><br/></td></tr>
<tr class="separator:ae3e30b0ba9b5d5a291fa29b77ba920d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2df697311878e1b93d1b26169ff06fc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ae2df697311878e1b93d1b26169ff06fc">lspmac_jogabs_queue</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *, double)</td></tr>
<tr class="memdesc:ae2df697311878e1b93d1b26169ff06fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Use jog to move motor to requested position.  <a href="#ae2df697311878e1b93d1b26169ff06fc"></a><br/></td></tr>
<tr class="separator:ae2df697311878e1b93d1b26169ff06fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a565d1106e02cd035deacf10395ddefb9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a565d1106e02cd035deacf10395ddefb9">lspmac_move_or_jog_abs_queue</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp, double requested_position, int use_jo)</td></tr>
<tr class="memdesc:a565d1106e02cd035deacf10395ddefb9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Move method for normal stepper and servo motor objects Returns non-zero on abort, zero if OK.  <a href="#a565d1106e02cd035deacf10395ddefb9"></a><br/></td></tr>
<tr class="separator:a565d1106e02cd035deacf10395ddefb9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a763ce40da7c28bc54a8b1a85199a7914"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a763ce40da7c28bc54a8b1a85199a7914">lspmac_move_or_jog_preset_queue</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *, char *, int)</td></tr>
<tr class="memdesc:a763ce40da7c28bc54a8b1a85199a7914"><td class="mdescLeft">&#160;</td><td class="mdescRight">move using a preset value returns 0 on success, non-zero on error  <a href="#a763ce40da7c28bc54a8b1a85199a7914"></a><br/></td></tr>
<tr class="separator:a763ce40da7c28bc54a8b1a85199a7914"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6809c317931c4af226e0a0217764afae"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a6809c317931c4af226e0a0217764afae">lspmac_move_or_jog_queue</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *, double, int)</td></tr>
<tr class="separator:a6809c317931c4af226e0a0217764afae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd26454acc150847b01717f60f956674"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#acd26454acc150847b01717f60f956674">lspmac_move_preset_queue</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp, char *preset_name)</td></tr>
<tr class="memdesc:acd26454acc150847b01717f60f956674"><td class="mdescLeft">&#160;</td><td class="mdescRight">Move a given motor to one of its preset positions.  <a href="#acd26454acc150847b01717f60f956674"></a><br/></td></tr>
<tr class="separator:acd26454acc150847b01717f60f956674"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24786013266b84cba5abae6503c77f02"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a24786013266b84cba5abae6503c77f02">lspmac_moveabs_queue</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *, double)</td></tr>
<tr class="memdesc:a24786013266b84cba5abae6503c77f02"><td class="mdescLeft">&#160;</td><td class="mdescRight">Use coordinate system motion program, if available, to move motor to requested position.  <a href="#a24786013266b84cba5abae6503c77f02"></a><br/></td></tr>
<tr class="separator:a24786013266b84cba5abae6503c77f02"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a750a7a4f3b02365877979e4f3e06ce7e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a750a7a4f3b02365877979e4f3e06ce7e">lspmac_moveabs_wait</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp, double timeout)</td></tr>
<tr class="memdesc:a750a7a4f3b02365877979e4f3e06ce7e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for motor to finish moving.  <a href="#a750a7a4f3b02365877979e4f3e06ce7e"></a><br/></td></tr>
<tr class="separator:a750a7a4f3b02365877979e4f3e06ce7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7101ae7b7aad35767a1d6a7093138bd4"><td class="memItemLeft" align="right" valign="top">pthread_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a7101ae7b7aad35767a1d6a7093138bd4">lspmac_run</a> ()</td></tr>
<tr class="memdesc:a7101ae7b7aad35767a1d6a7093138bd4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start up the lspmac thread.  <a href="#a7101ae7b7aad35767a1d6a7093138bd4"></a><br/></td></tr>
<tr class="separator:a7101ae7b7aad35767a1d6a7093138bd4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8bf745a9ec388783009e2275a8b56f8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#aa8bf745a9ec388783009e2275a8b56f8">lspmac_video_rotate</a> (double secs)</td></tr>
<tr class="memdesc:aa8bf745a9ec388783009e2275a8b56f8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Special motion program to collect centering video.  <a href="#aa8bf745a9ec388783009e2275a8b56f8"></a><br/></td></tr>
<tr class="separator:aa8bf745a9ec388783009e2275a8b56f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac356cd43e46799929242dcf5214df7f6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ac356cd43e46799929242dcf5214df7f6">lsredis_cmpnstr</a> (<a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *p, char *s, int n)</td></tr>
<tr class="separator:ac356cd43e46799929242dcf5214df7f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fc8fd0db4c71c5eae68682b43103078"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a9fc8fd0db4c71c5eae68682b43103078">lsredis_cmpstr</a> (<a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *p, char *s)</td></tr>
<tr class="separator:a9fc8fd0db4c71c5eae68682b43103078"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ad60526a09ca679f39174ce5d773abe"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a1ad60526a09ca679f39174ce5d773abe">lsredis_find_preset</a> (char *base, char *preset_name, double *dval)</td></tr>
<tr class="memdesc:a1ad60526a09ca679f39174ce5d773abe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the value of the given preset and return it in dval Returns 0 on error, non-zero on success;.  <a href="#a1ad60526a09ca679f39174ce5d773abe"></a><br/></td></tr>
<tr class="separator:a1ad60526a09ca679f39174ce5d773abe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abbb4e5ece19ebd130e1be18036752a08"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#abbb4e5ece19ebd130e1be18036752a08">lsredis_getb</a> (<a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *p)</td></tr>
<tr class="separator:abbb4e5ece19ebd130e1be18036752a08"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8daf63b794b6b6341018feec205cb7d"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a> (<a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *p)</td></tr>
<tr class="separator:aa8daf63b794b6b6341018feec205cb7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a7466a8c5b90df6dfc78aef625220f4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a4a7466a8c5b90df6dfc78aef625220f4">lsredis_init</a> ()</td></tr>
<tr class="memdesc:a4a7466a8c5b90df6dfc78aef625220f4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize this module, that is, set up the connections.  <a href="#a4a7466a8c5b90df6dfc78aef625220f4"></a><br/></td></tr>
<tr class="separator:a4a7466a8c5b90df6dfc78aef625220f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac58fca47533e695c8775e0d2b9128766"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ac58fca47533e695c8775e0d2b9128766">lsredis_regexec</a> (const regex_t *preg, <a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *p, size_t nmatch, regmatch_t *pmatch, int eflags)</td></tr>
<tr class="separator:ac58fca47533e695c8775e0d2b9128766"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3db3d5f91bf5723bd94748ce0d88731"><td class="memItemLeft" align="right" valign="top">pthread_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ac3db3d5f91bf5723bd94748ce0d88731">lsredis_run</a> ()</td></tr>
<tr class="separator:ac3db3d5f91bf5723bd94748ce0d88731"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b9c64f883c7ded60badfe89cb15fa78"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a9b9c64f883c7ded60badfe89cb15fa78">lsredis_setstr</a> (<a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *p, char *fmt,...)</td></tr>
<tr class="memdesc:a9b9c64f883c7ded60badfe89cb15fa78"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the value and update redis.  <a href="#a9b9c64f883c7ded60badfe89cb15fa78"></a><br/></td></tr>
<tr class="separator:a9b9c64f883c7ded60badfe89cb15fa78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a264897effdf49ed8d5aa34e8ed05c2d3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a264897effdf49ed8d5aa34e8ed05c2d3">lstimer_set_timer</a> (char *, int, unsigned long int, unsigned long int)</td></tr>
<tr class="memdesc:a264897effdf49ed8d5aa34e8ed05c2d3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a timer.  <a href="#a264897effdf49ed8d5aa34e8ed05c2d3"></a><br/></td></tr>
<tr class="separator:a264897effdf49ed8d5aa34e8ed05c2d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5738e4146b4691aad038b622b0381cac"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a5738e4146b4691aad038b622b0381cac">lstimer_unset_timer</a> (char *event)</td></tr>
<tr class="memdesc:a5738e4146b4691aad038b622b0381cac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unsets all timers for the given event.  <a href="#a5738e4146b4691aad038b622b0381cac"></a><br/></td></tr>
<tr class="separator:a5738e4146b4691aad038b622b0381cac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8cd37a8fb0f061456456a5d79bdd5189"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a8cd37a8fb0f061456456a5d79bdd5189">lstimer_init</a> ()</td></tr>
<tr class="memdesc:a8cd37a8fb0f061456456a5d79bdd5189"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the timer list and pthread stuff.  <a href="#a8cd37a8fb0f061456456a5d79bdd5189"></a><br/></td></tr>
<tr class="separator:a8cd37a8fb0f061456456a5d79bdd5189"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9fdc057e219c162d67c5cb77a2bf7a4"><td class="memItemLeft" align="right" valign="top">pthread_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#aa9fdc057e219c162d67c5cb77a2bf7a4">lstimer_run</a> ()</td></tr>
<tr class="memdesc:aa9fdc057e219c162d67c5cb77a2bf7a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start up our thread.  <a href="#aa9fdc057e219c162d67c5cb77a2bf7a4"></a><br/></td></tr>
<tr class="separator:aa9fdc057e219c162d67c5cb77a2bf7a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf63440ffbc65024fef87ea6a11ea8b0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#adf63440ffbc65024fef87ea6a11ea8b0">lsupdate_init</a> ()</td></tr>
<tr class="separator:adf63440ffbc65024fef87ea6a11ea8b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aebca330b67b5150d8fd5ae57bec80bf6"><td class="memItemLeft" align="right" valign="top">pthread_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#aebca330b67b5150d8fd5ae57bec80bf6">lsupdate_run</a> ()</td></tr>
<tr class="separator:aebca330b67b5150d8fd5ae57bec80bf6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0851b1baecda6a67993efde41d77b1c1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a0851b1baecda6a67993efde41d77b1c1">md2cmds_init</a> ()</td></tr>
<tr class="memdesc:a0851b1baecda6a67993efde41d77b1c1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the md2cmds module.  <a href="#a0851b1baecda6a67993efde41d77b1c1"></a><br/></td></tr>
<tr class="separator:a0851b1baecda6a67993efde41d77b1c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc5270ece18fe48a49947378438049cf"><td class="memItemLeft" align="right" valign="top">pthread_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#abc5270ece18fe48a49947378438049cf">md2cmds_run</a> ()</td></tr>
<tr class="memdesc:abc5270ece18fe48a49947378438049cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start up the thread.  <a href="#abc5270ece18fe48a49947378438049cf"></a><br/></td></tr>
<tr class="separator:abc5270ece18fe48a49947378438049cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7762ca7b97b44b979e23ce88ca3b4249"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a7762ca7b97b44b979e23ce88ca3b4249">pgpmac_printf</a> (char *fmt,...)</td></tr>
<tr class="memdesc:a7762ca7b97b44b979e23ce88ca3b4249"><td class="mdescLeft">&#160;</td><td class="mdescRight">Terminal output routine ala printf.  <a href="#a7762ca7b97b44b979e23ce88ca3b4249"></a><br/></td></tr>
<tr class="separator:a7762ca7b97b44b979e23ce88ca3b4249"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b84b6a923167d84c1aefbd2241864c3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a7b84b6a923167d84c1aefbd2241864c3">lstest_main</a> ()</td></tr>
<tr class="separator:a7b84b6a923167d84c1aefbd2241864c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83ba40e81c04ecc11009be6cbed0c5e1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a83ba40e81c04ecc11009be6cbed0c5e1">lspmac_est_move_time</a> (double *est_time, int *mmask, <a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp_1, int jog_1, char *preset_1, double end_point_1,...)</td></tr>
<tr class="memdesc:a83ba40e81c04ecc11009be6cbed0c5e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Move the motors and estimate the time it'll take to finish the job.  <a href="#a83ba40e81c04ecc11009be6cbed0c5e1"></a><br/></td></tr>
<tr class="separator:a83ba40e81c04ecc11009be6cbed0c5e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a570b4a359adc4da4ab80d53506d06963"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a570b4a359adc4da4ab80d53506d06963">lspmac_est_move_time_wait</a> (double move_time, int cmask, <a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp_1,...)</td></tr>
<tr class="memdesc:a570b4a359adc4da4ab80d53506d06963"><td class="mdescLeft">&#160;</td><td class="mdescRight">wait for motion to stop returns non-zero if the wait timed out  <a href="#a570b4a359adc4da4ab80d53506d06963"></a><br/></td></tr>
<tr class="separator:a570b4a359adc4da4ab80d53506d06963"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4c059ab8209b87131b5c94883a05f39"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ad4c059ab8209b87131b5c94883a05f39">lsredis_set_preset</a> (char *base, char *preset_name, double dval)</td></tr>
<tr class="memdesc:ad4c059ab8209b87131b5c94883a05f39"><td class="mdescLeft">&#160;</td><td class="mdescRight">set the given preset to the given value create a new preset if we can't find it  <a href="#ad4c059ab8209b87131b5c94883a05f39"></a><br/></td></tr>
<tr class="separator:ad4c059ab8209b87131b5c94883a05f39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3fb8589e280bfa18ecbca6619fea637"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ac3fb8589e280bfa18ecbca6619fea637">_lsredis_get_obj</a> (char *key)</td></tr>
<tr class="memdesc:ac3fb8589e280bfa18ecbca6619fea637"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maybe add a new object Used internally for this module Must be called with lsredis_mutex locked.  <a href="#ac3fb8589e280bfa18ecbca6619fea637"></a><br/></td></tr>
<tr class="separator:ac3fb8589e280bfa18ecbca6619fea637"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22ef36819bdee963712691e660cfc101"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a22ef36819bdee963712691e660cfc101">lspmac_find_motor_by_name</a> (char *name)</td></tr>
<tr class="separator:a22ef36819bdee963712691e660cfc101"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adfe823e3ccec7e37ac4697179bd65b10"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#adfe823e3ccec7e37ac4697179bd65b10">lsredis_find_preset_index_by_position</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp)</td></tr>
<tr class="memdesc:adfe823e3ccec7e37ac4697179bd65b10"><td class="mdescLeft">&#160;</td><td class="mdescRight">For the given motor object return the index of the current preset or -1 if we are not at a preset position.  <a href="#adfe823e3ccec7e37ac4697179bd65b10"></a><br/></td></tr>
<tr class="separator:adfe823e3ccec7e37ac4697179bd65b10"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0575fc751cecf35ffe8b290ab483ac21"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a0575fc751cecf35ffe8b290ab483ac21">lspmac_SockSendDPControlChar</a> (char *event, char c)</td></tr>
<tr class="memdesc:a0575fc751cecf35ffe8b290ab483ac21"><td class="mdescLeft">&#160;</td><td class="mdescRight">use dpram ascii interface to send a control character  <a href="#a0575fc751cecf35ffe8b290ab483ac21"></a><br/></td></tr>
<tr class="separator:a0575fc751cecf35ffe8b290ab483ac21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7cd6c8e4ea1132ac4a4b90e6468e2d6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ad7cd6c8e4ea1132ac4a4b90e6468e2d6">lspmac_set_motion_flags</a> (int *mmaskp, <a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp_1,...)</td></tr>
<tr class="memdesc:ad7cd6c8e4ea1132ac4a4b90e6468e2d6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the coordinate system motion flags (m5075) for the null terminated list of motors that we are planning on running a motion program with.  <a href="#ad7cd6c8e4ea1132ac4a4b90e6468e2d6"></a><br/></td></tr>
<tr class="separator:ad7cd6c8e4ea1132ac4a4b90e6468e2d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af48b297b5679750a131fa1e982a078b7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#af48b297b5679750a131fa1e982a078b7">lsredis_load_presets</a> (char *motor_name)</td></tr>
<tr class="memdesc:af48b297b5679750a131fa1e982a078b7"><td class="mdescLeft">&#160;</td><td class="mdescRight">update the presets hash table for the named motor  <a href="#af48b297b5679750a131fa1e982a078b7"></a><br/></td></tr>
<tr class="separator:af48b297b5679750a131fa1e982a078b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6168e3ced6ec5fc80862d27002e4cd5b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a6168e3ced6ec5fc80862d27002e4cd5b">pgpmac_request_stay_of_execution</a> (int secs)</td></tr>
<tr class="memdesc:a6168e3ced6ec5fc80862d27002e4cd5b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Postpone the day of reckoning This assumes the quit_cb routine is called once a second.  <a href="#a6168e3ced6ec5fc80862d27002e4cd5b"></a><br/></td></tr>
<tr class="separator:a6168e3ced6ec5fc80862d27002e4cd5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2ecf1ddb756452728eba479f36b486b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ae2ecf1ddb756452728eba479f36b486b">md2cmds_push_queue</a> (char *action)</td></tr>
<tr class="separator:ae2ecf1ddb756452728eba479f36b486b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8707477f9799b4cc8c6f465ecfeee24b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a8707477f9799b4cc8c6f465ecfeee24b">lspmac_SockSendControlCharPrint</a> (char *event, char c)</td></tr>
<tr class="memdesc:a8707477f9799b4cc8c6f465ecfeee24b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a control character.  <a href="#a8707477f9799b4cc8c6f465ecfeee24b"></a><br/></td></tr>
<tr class="separator:a8707477f9799b4cc8c6f465ecfeee24b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaabcee808dcf48a60898798a45516b68"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#aaabcee808dcf48a60898798a45516b68">lsredis_config</a> ()</td></tr>
<tr class="separator:aaabcee808dcf48a60898798a45516b68"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a5f699604dcc5d3d64fd6cb5c363d29c9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#a779e2acce8b5e748c184caf23ed0db57">lspg_waitcryo_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a5f699604dcc5d3d64fd6cb5c363d29c9">lspg_waitcryo</a></td></tr>
<tr class="memdesc:a5f699604dcc5d3d64fd6cb5c363d29c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">signal the robot  <a href="#a5f699604dcc5d3d64fd6cb5c363d29c9"></a><br/></td></tr>
<tr class="separator:a5f699604dcc5d3d64fd6cb5c363d29c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c50804e6019d47d91f3f1cb3ebd1f00"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#a7a794370785ff015d5ee035917e3bee8">lspg_getcurrentsampleid_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a5c50804e6019d47d91f3f1cb3ebd1f00">lspg_getcurrentsampleid</a></td></tr>
<tr class="memdesc:a5c50804e6019d47d91f3f1cb3ebd1f00"><td class="mdescLeft">&#160;</td><td class="mdescRight">our currentsample id  <a href="#a5c50804e6019d47d91f3f1cb3ebd1f00"></a><br/></td></tr>
<tr class="separator:a5c50804e6019d47d91f3f1cb3ebd1f00"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf89a0299edd6a99992b95dff8992eba"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#a7f71abc6fdfd1839e2e3213d78aaf766">lspg_demandairrights_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#adf89a0299edd6a99992b95dff8992eba">lspg_demandairrights</a></td></tr>
<tr class="memdesc:adf89a0299edd6a99992b95dff8992eba"><td class="mdescLeft">&#160;</td><td class="mdescRight">our demandairrights object  <a href="#adf89a0299edd6a99992b95dff8992eba"></a><br/></td></tr>
<tr class="separator:adf89a0299edd6a99992b95dff8992eba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ef8a09203117578c9b2ce4719519f36"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#a48b627e412dd038c1f17cdb0501eec33">lspg_getcenter_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a7ef8a09203117578c9b2ce4719519f36">lspg_getcenter</a></td></tr>
<tr class="memdesc:a7ef8a09203117578c9b2ce4719519f36"><td class="mdescLeft">&#160;</td><td class="mdescRight">the getcenter object  <a href="#a7ef8a09203117578c9b2ce4719519f36"></a><br/></td></tr>
<tr class="separator:a7ef8a09203117578c9b2ce4719519f36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af18499d17171eff473cfc49d4a0a5562"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa1f0e602ae9509005c62fb2d73bc1c5a">lspg_starttransfer_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#af18499d17171eff473cfc49d4a0a5562">lspg_starttransfer</a></td></tr>
<tr class="memdesc:af18499d17171eff473cfc49d4a0a5562"><td class="mdescLeft">&#160;</td><td class="mdescRight">start a sample transfer  <a href="#af18499d17171eff473cfc49d4a0a5562"></a><br/></td></tr>
<tr class="separator:af18499d17171eff473cfc49d4a0a5562"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbf70f382e469e02dce77833981f9547"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#a9dda9014cd0e39fba8d523e37cf9f982">lspg_nextsample_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#adbf70f382e469e02dce77833981f9547">lspg_nextsample</a></td></tr>
<tr class="memdesc:adbf70f382e469e02dce77833981f9547"><td class="mdescLeft">&#160;</td><td class="mdescRight">the very next sample  <a href="#adbf70f382e469e02dce77833981f9547"></a><br/></td></tr>
<tr class="separator:adbf70f382e469e02dce77833981f9547"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae002f31c03cce9bf96cf0e0c2907cb2b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ae002f31c03cce9bf96cf0e0c2907cb2b">pgpmac_use_pg</a></td></tr>
<tr class="memdesc:ae002f31c03cce9bf96cf0e0c2907cb2b"><td class="mdescLeft">&#160;</td><td class="mdescRight">non-zero to start up lspg thread, 0 to not (reids hash PG in config.HOSTNAME sets this)  <a href="#ae002f31c03cce9bf96cf0e0c2907cb2b"></a><br/></td></tr>
<tr class="separator:ae002f31c03cce9bf96cf0e0c2907cb2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad163e2bc6ebe322058c113dee76c11ff"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ad163e2bc6ebe322058c113dee76c11ff">pgpmac_use_autoscint</a></td></tr>
<tr class="memdesc:ad163e2bc6ebe322058c113dee76c11ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">non-zero to automatically move the alignment stage when the scintillator moves (redis hash AUTOSCINT in config.HOSTNAME sets this)  <a href="#ad163e2bc6ebe322058c113dee76c11ff"></a><br/></td></tr>
<tr class="separator:ad163e2bc6ebe322058c113dee76c11ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8d8e2f578ca79189a80c1fd5b60cefd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#a17ea2bf07a0b3b892baa00bd392607b3">lspg_nextshot_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ad8d8e2f578ca79189a80c1fd5b60cefd">lspg_nextshot</a></td></tr>
<tr class="memdesc:ad8d8e2f578ca79189a80c1fd5b60cefd"><td class="mdescLeft">&#160;</td><td class="mdescRight">the nextshot object  <a href="#ad8d8e2f578ca79189a80c1fd5b60cefd"></a><br/></td></tr>
<tr class="separator:ad8d8e2f578ca79189a80c1fd5b60cefd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aebfce5f9cbc8ba7bd4e2ee4880f303e8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#aebfce5f9cbc8ba7bd4e2ee4880f303e8">lspmac_motors</a> []</td></tr>
<tr class="memdesc:aebfce5f9cbc8ba7bd4e2ee4880f303e8"><td class="mdescLeft">&#160;</td><td class="mdescRight">All our motors.  <a href="#aebfce5f9cbc8ba7bd4e2ee4880f303e8"></a><br/></td></tr>
<tr class="separator:aebfce5f9cbc8ba7bd4e2ee4880f303e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8237e646ce032a840637a4ef7bff49b9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a8237e646ce032a840637a4ef7bff49b9">omega</a></td></tr>
<tr class="memdesc:a8237e646ce032a840637a4ef7bff49b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">MD2 omega axis (the air bearing)  <a href="#a8237e646ce032a840637a4ef7bff49b9"></a><br/></td></tr>
<tr class="separator:a8237e646ce032a840637a4ef7bff49b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6cb218bdccfe5a93471c161f15a15cab"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a6cb218bdccfe5a93471c161f15a15cab">alignx</a></td></tr>
<tr class="memdesc:a6cb218bdccfe5a93471c161f15a15cab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Alignment stage X.  <a href="#a6cb218bdccfe5a93471c161f15a15cab"></a><br/></td></tr>
<tr class="separator:a6cb218bdccfe5a93471c161f15a15cab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a737c246c3948e644a18d191a931e1acd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a737c246c3948e644a18d191a931e1acd">aligny</a></td></tr>
<tr class="memdesc:a737c246c3948e644a18d191a931e1acd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Alignment stage Y.  <a href="#a737c246c3948e644a18d191a931e1acd"></a><br/></td></tr>
<tr class="separator:a737c246c3948e644a18d191a931e1acd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7642b1da0f7c7f8448104c691d40a12"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ae7642b1da0f7c7f8448104c691d40a12">alignz</a></td></tr>
<tr class="memdesc:ae7642b1da0f7c7f8448104c691d40a12"><td class="mdescLeft">&#160;</td><td class="mdescRight">Alignment stage X.  <a href="#ae7642b1da0f7c7f8448104c691d40a12"></a><br/></td></tr>
<tr class="separator:ae7642b1da0f7c7f8448104c691d40a12"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa90d2363b744acbd4d45133b7a716d8f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#aa90d2363b744acbd4d45133b7a716d8f">anal</a></td></tr>
<tr class="memdesc:aa90d2363b744acbd4d45133b7a716d8f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Polaroid analyzer motor.  <a href="#aa90d2363b744acbd4d45133b7a716d8f"></a><br/></td></tr>
<tr class="separator:aa90d2363b744acbd4d45133b7a716d8f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad53a42cfaa04eff0336a44c8c9986333"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ad53a42cfaa04eff0336a44c8c9986333">zoom</a></td></tr>
<tr class="memdesc:ad53a42cfaa04eff0336a44c8c9986333"><td class="mdescLeft">&#160;</td><td class="mdescRight">Optical zoom.  <a href="#ad53a42cfaa04eff0336a44c8c9986333"></a><br/></td></tr>
<tr class="separator:ad53a42cfaa04eff0336a44c8c9986333"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a139200ddaa9856a7ffcec0e6cbaa8f1b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a139200ddaa9856a7ffcec0e6cbaa8f1b">apery</a></td></tr>
<tr class="memdesc:a139200ddaa9856a7ffcec0e6cbaa8f1b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Aperture Y.  <a href="#a139200ddaa9856a7ffcec0e6cbaa8f1b"></a><br/></td></tr>
<tr class="separator:a139200ddaa9856a7ffcec0e6cbaa8f1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab93bd6ee850b285ca3a95e64d15e9477"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ab93bd6ee850b285ca3a95e64d15e9477">aperz</a></td></tr>
<tr class="memdesc:ab93bd6ee850b285ca3a95e64d15e9477"><td class="mdescLeft">&#160;</td><td class="mdescRight">Aperture Z.  <a href="#ab93bd6ee850b285ca3a95e64d15e9477"></a><br/></td></tr>
<tr class="separator:ab93bd6ee850b285ca3a95e64d15e9477"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51358daaea8b5236f08414877d8af6c2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a51358daaea8b5236f08414877d8af6c2">capy</a></td></tr>
<tr class="memdesc:a51358daaea8b5236f08414877d8af6c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Capillary Y.  <a href="#a51358daaea8b5236f08414877d8af6c2"></a><br/></td></tr>
<tr class="separator:a51358daaea8b5236f08414877d8af6c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa45f268d0af9f3d465acfab128919718"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#aa45f268d0af9f3d465acfab128919718">capz</a></td></tr>
<tr class="memdesc:aa45f268d0af9f3d465acfab128919718"><td class="mdescLeft">&#160;</td><td class="mdescRight">Capillary Z.  <a href="#aa45f268d0af9f3d465acfab128919718"></a><br/></td></tr>
<tr class="separator:aa45f268d0af9f3d465acfab128919718"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a589431b3a79c21c251fcb97cc9126991"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a589431b3a79c21c251fcb97cc9126991">scint</a></td></tr>
<tr class="memdesc:a589431b3a79c21c251fcb97cc9126991"><td class="mdescLeft">&#160;</td><td class="mdescRight">Scintillator Z.  <a href="#a589431b3a79c21c251fcb97cc9126991"></a><br/></td></tr>
<tr class="separator:a589431b3a79c21c251fcb97cc9126991"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac940d950d9efeaf3f0ae67e9bf331188"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ac940d950d9efeaf3f0ae67e9bf331188">cenx</a></td></tr>
<tr class="memdesc:ac940d950d9efeaf3f0ae67e9bf331188"><td class="mdescLeft">&#160;</td><td class="mdescRight">Centering Table X.  <a href="#ac940d950d9efeaf3f0ae67e9bf331188"></a><br/></td></tr>
<tr class="separator:ac940d950d9efeaf3f0ae67e9bf331188"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaed18e738ba7bfb6c771a44f5d7ea827"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#aaed18e738ba7bfb6c771a44f5d7ea827">ceny</a></td></tr>
<tr class="memdesc:aaed18e738ba7bfb6c771a44f5d7ea827"><td class="mdescLeft">&#160;</td><td class="mdescRight">Centering Table Y.  <a href="#aaed18e738ba7bfb6c771a44f5d7ea827"></a><br/></td></tr>
<tr class="separator:aaed18e738ba7bfb6c771a44f5d7ea827"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0be79ccb7ebf3a665248fd856112b9fd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a0be79ccb7ebf3a665248fd856112b9fd">kappa</a></td></tr>
<tr class="memdesc:a0be79ccb7ebf3a665248fd856112b9fd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Kappa.  <a href="#a0be79ccb7ebf3a665248fd856112b9fd"></a><br/></td></tr>
<tr class="separator:a0be79ccb7ebf3a665248fd856112b9fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8070dc568ad974a3db42b51eca828cc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ac8070dc568ad974a3db42b51eca828cc">phi</a></td></tr>
<tr class="memdesc:ac8070dc568ad974a3db42b51eca828cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Phi (not data collection axis)  <a href="#ac8070dc568ad974a3db42b51eca828cc"></a><br/></td></tr>
<tr class="separator:ac8070dc568ad974a3db42b51eca828cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26dec4623af9beed912b8e7e6f99822c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a26dec4623af9beed912b8e7e6f99822c">fshut</a></td></tr>
<tr class="memdesc:a26dec4623af9beed912b8e7e6f99822c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fast shutter.  <a href="#a26dec4623af9beed912b8e7e6f99822c"></a><br/></td></tr>
<tr class="separator:a26dec4623af9beed912b8e7e6f99822c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb09895663eff333b7a75acb319a9fc1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#aeb09895663eff333b7a75acb319a9fc1">flight</a></td></tr>
<tr class="memdesc:aeb09895663eff333b7a75acb319a9fc1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Front Light DAC.  <a href="#aeb09895663eff333b7a75acb319a9fc1"></a><br/></td></tr>
<tr class="separator:aeb09895663eff333b7a75acb319a9fc1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85d6eaa4b4a82bb3112574f458d1dc50"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a85d6eaa4b4a82bb3112574f458d1dc50">blight</a></td></tr>
<tr class="memdesc:a85d6eaa4b4a82bb3112574f458d1dc50"><td class="mdescLeft">&#160;</td><td class="mdescRight">Back Light DAC.  <a href="#a85d6eaa4b4a82bb3112574f458d1dc50"></a><br/></td></tr>
<tr class="separator:a85d6eaa4b4a82bb3112574f458d1dc50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a3ca6fcf5e24dcc26170736843e53b2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a8a3ca6fcf5e24dcc26170736843e53b2">fscint</a></td></tr>
<tr class="memdesc:a8a3ca6fcf5e24dcc26170736843e53b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Scintillator Piezo DAC.  <a href="#a8a3ca6fcf5e24dcc26170736843e53b2"></a><br/></td></tr>
<tr class="separator:a8a3ca6fcf5e24dcc26170736843e53b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abee73a0d9e5f3af9eb88d5cfd6b953c3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#abee73a0d9e5f3af9eb88d5cfd6b953c3">smart_mag_oo</a></td></tr>
<tr class="memdesc:abee73a0d9e5f3af9eb88d5cfd6b953c3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Smart Magnet on/off.  <a href="#abee73a0d9e5f3af9eb88d5cfd6b953c3"></a><br/></td></tr>
<tr class="separator:abee73a0d9e5f3af9eb88d5cfd6b953c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af813a2eff0b7efa4c70633559054e84c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#af813a2eff0b7efa4c70633559054e84c">blight_ud</a></td></tr>
<tr class="memdesc:af813a2eff0b7efa4c70633559054e84c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Back light Up/Down actuator.  <a href="#af813a2eff0b7efa4c70633559054e84c"></a><br/></td></tr>
<tr class="separator:af813a2eff0b7efa4c70633559054e84c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae78d9a757d4c85419fff9c94b15e25d7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ae78d9a757d4c85419fff9c94b15e25d7">cryo</a></td></tr>
<tr class="memdesc:ae78d9a757d4c85419fff9c94b15e25d7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Move the cryostream towards or away from the crystal.  <a href="#ae78d9a757d4c85419fff9c94b15e25d7"></a><br/></td></tr>
<tr class="separator:ae78d9a757d4c85419fff9c94b15e25d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d9c5030d817483ca9518027c91adac4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a9d9c5030d817483ca9518027c91adac4">dryer</a></td></tr>
<tr class="memdesc:a9d9c5030d817483ca9518027c91adac4"><td class="mdescLeft">&#160;</td><td class="mdescRight">blow air on the scintilator to dry it off  <a href="#a9d9c5030d817483ca9518027c91adac4"></a><br/></td></tr>
<tr class="separator:a9d9c5030d817483ca9518027c91adac4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:addb26c80065506faa1de3c1b468fe03f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#addb26c80065506faa1de3c1b468fe03f">fluo</a></td></tr>
<tr class="memdesc:addb26c80065506faa1de3c1b468fe03f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Move the fluorescence detector in/out.  <a href="#addb26c80065506faa1de3c1b468fe03f"></a><br/></td></tr>
<tr class="separator:addb26c80065506faa1de3c1b468fe03f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6630442dc65ce8a30a24ed718b301971"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a6630442dc65ce8a30a24ed718b301971">flight_oo</a></td></tr>
<tr class="memdesc:a6630442dc65ce8a30a24ed718b301971"><td class="mdescLeft">&#160;</td><td class="mdescRight">Turn front light on/off.  <a href="#a6630442dc65ce8a30a24ed718b301971"></a><br/></td></tr>
<tr class="separator:a6630442dc65ce8a30a24ed718b301971"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af55c51d52c4586b647114f95d7ac1f42"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#af55c51d52c4586b647114f95d7ac1f42">blight_f</a></td></tr>
<tr class="memdesc:af55c51d52c4586b647114f95d7ac1f42"><td class="mdescLeft">&#160;</td><td class="mdescRight">Back light scale factor.  <a href="#af55c51d52c4586b647114f95d7ac1f42"></a><br/></td></tr>
<tr class="separator:af55c51d52c4586b647114f95d7ac1f42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabf4ec595b5183c1777d029ca56134b0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#aabf4ec595b5183c1777d029ca56134b0">flight_f</a></td></tr>
<tr class="memdesc:aabf4ec595b5183c1777d029ca56134b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Front light scale factor.  <a href="#aabf4ec595b5183c1777d029ca56134b0"></a><br/></td></tr>
<tr class="separator:aabf4ec595b5183c1777d029ca56134b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a56260f012c50a591ee7f97e500f16994"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a56260f012c50a591ee7f97e500f16994">lspmac_nmotors</a></td></tr>
<tr class="memdesc:a56260f012c50a591ee7f97e500f16994"><td class="mdescLeft">&#160;</td><td class="mdescRight">The number of motors we manage.  <a href="#a56260f012c50a591ee7f97e500f16994"></a><br/></td></tr>
<tr class="separator:a56260f012c50a591ee7f97e500f16994"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aade15098d213bb25522048e4a231941a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#aade15098d213bb25522048e4a231941a">lp_air</a></td></tr>
<tr class="memdesc:aade15098d213bb25522048e4a231941a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Low pressure air OK.  <a href="#aade15098d213bb25522048e4a231941a"></a><br/></td></tr>
<tr class="separator:aade15098d213bb25522048e4a231941a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb29b117ad38156ba16fcf44eeb427af"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#abb29b117ad38156ba16fcf44eeb427af">hp_air</a></td></tr>
<tr class="memdesc:abb29b117ad38156ba16fcf44eeb427af"><td class="mdescLeft">&#160;</td><td class="mdescRight">High pressure air OK.  <a href="#abb29b117ad38156ba16fcf44eeb427af"></a><br/></td></tr>
<tr class="separator:abb29b117ad38156ba16fcf44eeb427af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28df32fd6be9160603aa1bb74a823574"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a28df32fd6be9160603aa1bb74a823574">cryo_switch</a></td></tr>
<tr class="memdesc:a28df32fd6be9160603aa1bb74a823574"><td class="mdescLeft">&#160;</td><td class="mdescRight">that little toggle switch for the cryo  <a href="#a28df32fd6be9160603aa1bb74a823574"></a><br/></td></tr>
<tr class="separator:a28df32fd6be9160603aa1bb74a823574"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0d0bc95bcbcbd154b30c72a9645c8b2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ac0d0bc95bcbcbd154b30c72a9645c8b2">blight_down</a></td></tr>
<tr class="memdesc:ac0d0bc95bcbcbd154b30c72a9645c8b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Backlight is down.  <a href="#ac0d0bc95bcbcbd154b30c72a9645c8b2"></a><br/></td></tr>
<tr class="separator:ac0d0bc95bcbcbd154b30c72a9645c8b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fba65f6555c5c7908852c6cf1ad0c94"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a7fba65f6555c5c7908852c6cf1ad0c94">blight_up</a></td></tr>
<tr class="memdesc:a7fba65f6555c5c7908852c6cf1ad0c94"><td class="mdescLeft">&#160;</td><td class="mdescRight">Backlight is up.  <a href="#a7fba65f6555c5c7908852c6cf1ad0c94"></a><br/></td></tr>
<tr class="separator:a7fba65f6555c5c7908852c6cf1ad0c94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a871d4cdea0a1a8db85b8658a07655212"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a871d4cdea0a1a8db85b8658a07655212">cryo_back</a></td></tr>
<tr class="memdesc:a871d4cdea0a1a8db85b8658a07655212"><td class="mdescLeft">&#160;</td><td class="mdescRight">cryo is in the back position  <a href="#a871d4cdea0a1a8db85b8658a07655212"></a><br/></td></tr>
<tr class="separator:a871d4cdea0a1a8db85b8658a07655212"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a67092de6f3fcc0b245e4970437eaff6b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a67092de6f3fcc0b245e4970437eaff6b">fluor_back</a></td></tr>
<tr class="memdesc:a67092de6f3fcc0b245e4970437eaff6b"><td class="mdescLeft">&#160;</td><td class="mdescRight">fluor is in the back position  <a href="#a67092de6f3fcc0b245e4970437eaff6b"></a><br/></td></tr>
<tr class="separator:a67092de6f3fcc0b245e4970437eaff6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac59ab990e48033a811aeb0281fb588fc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ac59ab990e48033a811aeb0281fb588fc">sample_detected</a></td></tr>
<tr class="memdesc:ac59ab990e48033a811aeb0281fb588fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">smart magnet detected sample  <a href="#ac59ab990e48033a811aeb0281fb588fc"></a><br/></td></tr>
<tr class="separator:ac59ab990e48033a811aeb0281fb588fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5538a6aa526eeed65ff237303da2d348"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a5538a6aa526eeed65ff237303da2d348">etel_ready</a></td></tr>
<tr class="memdesc:a5538a6aa526eeed65ff237303da2d348"><td class="mdescLeft">&#160;</td><td class="mdescRight">ETEL is ready.  <a href="#a5538a6aa526eeed65ff237303da2d348"></a><br/></td></tr>
<tr class="separator:a5538a6aa526eeed65ff237303da2d348"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab48d4a2cf0225796db9aad49f034dc59"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ab48d4a2cf0225796db9aad49f034dc59">etel_on</a></td></tr>
<tr class="memdesc:ab48d4a2cf0225796db9aad49f034dc59"><td class="mdescLeft">&#160;</td><td class="mdescRight">ETEL is on.  <a href="#ab48d4a2cf0225796db9aad49f034dc59"></a><br/></td></tr>
<tr class="separator:ab48d4a2cf0225796db9aad49f034dc59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e690d4ad981d020ea2c850282dca3be"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a1e690d4ad981d020ea2c850282dca3be">etel_init_ok</a></td></tr>
<tr class="memdesc:a1e690d4ad981d020ea2c850282dca3be"><td class="mdescLeft">&#160;</td><td class="mdescRight">ETEL initialized OK.  <a href="#a1e690d4ad981d020ea2c850282dca3be"></a><br/></td></tr>
<tr class="separator:a1e690d4ad981d020ea2c850282dca3be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab552f2e28dd9cccefafe01f27717101b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ab552f2e28dd9cccefafe01f27717101b">minikappa_ok</a></td></tr>
<tr class="memdesc:ab552f2e28dd9cccefafe01f27717101b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Minikappa is OK (whatever that means)  <a href="#ab552f2e28dd9cccefafe01f27717101b"></a><br/></td></tr>
<tr class="separator:ab552f2e28dd9cccefafe01f27717101b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2dc6fa78bb6313fe8b696d646eaa2443"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a2dc6fa78bb6313fe8b696d646eaa2443">smart_mag_on</a></td></tr>
<tr class="memdesc:a2dc6fa78bb6313fe8b696d646eaa2443"><td class="mdescLeft">&#160;</td><td class="mdescRight">smart magnet is on  <a href="#a2dc6fa78bb6313fe8b696d646eaa2443"></a><br/></td></tr>
<tr class="separator:a2dc6fa78bb6313fe8b696d646eaa2443"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afaff4fbb5f03b0d2469fc7a14f174d69"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#afaff4fbb5f03b0d2469fc7a14f174d69">arm_parked</a></td></tr>
<tr class="memdesc:afaff4fbb5f03b0d2469fc7a14f174d69"><td class="mdescLeft">&#160;</td><td class="mdescRight">(whose arm? parked where?)  <a href="#afaff4fbb5f03b0d2469fc7a14f174d69"></a><br/></td></tr>
<tr class="separator:afaff4fbb5f03b0d2469fc7a14f174d69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae98a0792d6b4b96a33df0a31bdec6342"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ae98a0792d6b4b96a33df0a31bdec6342">shutter_open</a></td></tr>
<tr class="memdesc:ae98a0792d6b4b96a33df0a31bdec6342"><td class="mdescLeft">&#160;</td><td class="mdescRight">shutter is open (note in pmc says this is a slow input)  <a href="#ae98a0792d6b4b96a33df0a31bdec6342"></a><br/></td></tr>
<tr class="separator:ae98a0792d6b4b96a33df0a31bdec6342"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4892e918830dd12093d28c53a1c2df98"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a4892e918830dd12093d28c53a1c2df98">smart_mag_off</a></td></tr>
<tr class="memdesc:a4892e918830dd12093d28c53a1c2df98"><td class="mdescLeft">&#160;</td><td class="mdescRight">smart magnet is off  <a href="#a4892e918830dd12093d28c53a1c2df98"></a><br/></td></tr>
<tr class="separator:a4892e918830dd12093d28c53a1c2df98"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37903ed8430ac4d9ead609a78eb62f32"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a37903ed8430ac4d9ead609a78eb62f32">smart_mag_err</a></td></tr>
<tr class="memdesc:a37903ed8430ac4d9ead609a78eb62f32"><td class="mdescLeft">&#160;</td><td class="mdescRight">smart magnet error (coil broken perhaps)  <a href="#a37903ed8430ac4d9ead609a78eb62f32"></a><br/></td></tr>
<tr class="separator:a37903ed8430ac4d9ead609a78eb62f32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6631a094accc469661805bdf80fc6d8"><td class="memItemLeft" align="right" valign="top">struct timespec&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ae6631a094accc469661805bdf80fc6d8">omega_zero_time</a></td></tr>
<tr class="memdesc:ae6631a094accc469661805bdf80fc6d8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Time we believe that omega crossed zero.  <a href="#ae6631a094accc469661805bdf80fc6d8"></a><br/></td></tr>
<tr class="separator:ae6631a094accc469661805bdf80fc6d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65daf0f4a5bc6def23a9df98ff5ca57e"><td class="memItemLeft" align="right" valign="top">WINDOW *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a65daf0f4a5bc6def23a9df98ff5ca57e">term_output</a></td></tr>
<tr class="memdesc:a65daf0f4a5bc6def23a9df98ff5ca57e"><td class="mdescLeft">&#160;</td><td class="mdescRight">place to print stuff out  <a href="#a65daf0f4a5bc6def23a9df98ff5ca57e"></a><br/></td></tr>
<tr class="separator:a65daf0f4a5bc6def23a9df98ff5ca57e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0487111dbe3c05d0bd835eb2fb9a3f7"><td class="memItemLeft" align="right" valign="top">WINDOW *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ab0487111dbe3c05d0bd835eb2fb9a3f7">term_input</a></td></tr>
<tr class="memdesc:ab0487111dbe3c05d0bd835eb2fb9a3f7"><td class="mdescLeft">&#160;</td><td class="mdescRight">place to put the cursor  <a href="#ab0487111dbe3c05d0bd835eb2fb9a3f7"></a><br/></td></tr>
<tr class="separator:ab0487111dbe3c05d0bd835eb2fb9a3f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae746a6903fb8a4ea216def88eccedc3c"><td class="memItemLeft" align="right" valign="top">WINDOW *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ae746a6903fb8a4ea216def88eccedc3c">term_status</a></td></tr>
<tr class="memdesc:ae746a6903fb8a4ea216def88eccedc3c"><td class="mdescLeft">&#160;</td><td class="mdescRight">shutter, lamp, air, etc status  <a href="#ae746a6903fb8a4ea216def88eccedc3c"></a><br/></td></tr>
<tr class="separator:ae746a6903fb8a4ea216def88eccedc3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2d7da3afeb756716e6e4ee9cab78f8a"><td class="memItemLeft" align="right" valign="top">WINDOW *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ae2d7da3afeb756716e6e4ee9cab78f8a">term_status2</a></td></tr>
<tr class="memdesc:ae2d7da3afeb756716e6e4ee9cab78f8a"><td class="mdescLeft">&#160;</td><td class="mdescRight">shutter, lamp, air, etc status  <a href="#ae2d7da3afeb756716e6e4ee9cab78f8a"></a><br/></td></tr>
<tr class="separator:ae2d7da3afeb756716e6e4ee9cab78f8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad128c64890c7c0d4f836d9ec6e99216a"><td class="memItemLeft" align="right" valign="top">pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ad128c64890c7c0d4f836d9ec6e99216a">ncurses_mutex</a></td></tr>
<tr class="memdesc:ad128c64890c7c0d4f836d9ec6e99216a"><td class="mdescLeft">&#160;</td><td class="mdescRight">allow more than one thread access to the screen  <a href="#ad128c64890c7c0d4f836d9ec6e99216a"></a><br/></td></tr>
<tr class="separator:ad128c64890c7c0d4f836d9ec6e99216a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08d5b18ec9478d753c46a3e28d1f2126"><td class="memItemLeft" align="right" valign="top">pthread_cond_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a08d5b18ec9478d753c46a3e28d1f2126">md2cmds_cond</a></td></tr>
<tr class="memdesc:a08d5b18ec9478d753c46a3e28d1f2126"><td class="mdescLeft">&#160;</td><td class="mdescRight">condition to signal when it's time to run an md2 command  <a href="#a08d5b18ec9478d753c46a3e28d1f2126"></a><br/></td></tr>
<tr class="separator:a08d5b18ec9478d753c46a3e28d1f2126"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad67304bb851dc6268b0cda2f40fc5aa8"><td class="memItemLeft" align="right" valign="top">pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ad67304bb851dc6268b0cda2f40fc5aa8">md2cmds_mutex</a></td></tr>
<tr class="memdesc:ad67304bb851dc6268b0cda2f40fc5aa8"><td class="mdescLeft">&#160;</td><td class="mdescRight">mutex for the condition  <a href="#ad67304bb851dc6268b0cda2f40fc5aa8"></a><br/></td></tr>
<tr class="separator:ad67304bb851dc6268b0cda2f40fc5aa8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab517a930528e2b7d0993e11087765b03"><td class="memItemLeft" align="right" valign="top">pthread_cond_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#ab517a930528e2b7d0993e11087765b03">md2cmds_pg_cond</a></td></tr>
<tr class="separator:ab517a930528e2b7d0993e11087765b03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d2c3ac81d4b13eb21f4ddcdda8c7308"><td class="memItemLeft" align="right" valign="top">pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a4d2c3ac81d4b13eb21f4ddcdda8c7308">md2cmds_pg_mutex</a></td></tr>
<tr class="separator:a4d2c3ac81d4b13eb21f4ddcdda8c7308"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc1bb77b9bcbc4d970f841a41fd274b3"><td class="memItemLeft" align="right" valign="top">pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#acc1bb77b9bcbc4d970f841a41fd274b3">pmac_queue_mutex</a></td></tr>
<tr class="memdesc:acc1bb77b9bcbc4d970f841a41fd274b3"><td class="mdescLeft">&#160;</td><td class="mdescRight">manage access to the pmac command queue  <a href="#acc1bb77b9bcbc4d970f841a41fd274b3"></a><br/></td></tr>
<tr class="separator:acc1bb77b9bcbc4d970f841a41fd274b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a25bd9c593c6985107f90f999ce0b08"><td class="memItemLeft" align="right" valign="top">pthread_cond_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a8a25bd9c593c6985107f90f999ce0b08">pmac_queue_cond</a></td></tr>
<tr class="memdesc:a8a25bd9c593c6985107f90f999ce0b08"><td class="mdescLeft">&#160;</td><td class="mdescRight">wait for a command to be sent to PMAC before continuing  <a href="#a8a25bd9c593c6985107f90f999ce0b08"></a><br/></td></tr>
<tr class="separator:a8a25bd9c593c6985107f90f999ce0b08"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b78a13c654409333569815e1c109d38"><td class="memItemLeft" align="right" valign="top">pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a1b78a13c654409333569815e1c109d38">lspmac_shutter_mutex</a></td></tr>
<tr class="memdesc:a1b78a13c654409333569815e1c109d38"><td class="mdescLeft">&#160;</td><td class="mdescRight">Coordinates threads reading shutter status.  <a href="#a1b78a13c654409333569815e1c109d38"></a><br/></td></tr>
<tr class="separator:a1b78a13c654409333569815e1c109d38"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afbd51c2cefcee87afe994c9e9f372241"><td class="memItemLeft" align="right" valign="top">pthread_cond_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#afbd51c2cefcee87afe994c9e9f372241">lspmac_shutter_cond</a></td></tr>
<tr class="memdesc:afbd51c2cefcee87afe994c9e9f372241"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allows waiting for the shutter status to change.  <a href="#afbd51c2cefcee87afe994c9e9f372241"></a><br/></td></tr>
<tr class="separator:afbd51c2cefcee87afe994c9e9f372241"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a112158e0cd50449a440ac55c7af7bea2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a112158e0cd50449a440ac55c7af7bea2">lspmac_shutter_state</a></td></tr>
<tr class="memdesc:a112158e0cd50449a440ac55c7af7bea2"><td class="mdescLeft">&#160;</td><td class="mdescRight">State of the shutter, used to detect changes.  <a href="#a112158e0cd50449a440ac55c7af7bea2"></a><br/></td></tr>
<tr class="separator:a112158e0cd50449a440ac55c7af7bea2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a396fbf06208de3ecbe1b0df549f1cd46"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a396fbf06208de3ecbe1b0df549f1cd46">lspmac_shutter_has_opened</a></td></tr>
<tr class="memdesc:a396fbf06208de3ecbe1b0df549f1cd46"><td class="mdescLeft">&#160;</td><td class="mdescRight">Indicates that the shutter had opened, perhaps briefly even if the state did not change.  <a href="#a396fbf06208de3ecbe1b0df549f1cd46"></a><br/></td></tr>
<tr class="separator:a396fbf06208de3ecbe1b0df549f1cd46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85679cac947e199c88794f8e5a12bf5f"><td class="memItemLeft" align="right" valign="top">pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a85679cac947e199c88794f8e5a12bf5f">lspmac_moving_mutex</a></td></tr>
<tr class="memdesc:a85679cac947e199c88794f8e5a12bf5f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Coordinate moving motors between threads.  <a href="#a85679cac947e199c88794f8e5a12bf5f"></a><br/></td></tr>
<tr class="separator:a85679cac947e199c88794f8e5a12bf5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57547d211906c981ef20257eba99f8df"><td class="memItemLeft" align="right" valign="top">pthread_cond_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a57547d211906c981ef20257eba99f8df">lspmac_moving_cond</a></td></tr>
<tr class="memdesc:a57547d211906c981ef20257eba99f8df"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for motor(s) to finish moving condition.  <a href="#a57547d211906c981ef20257eba99f8df"></a><br/></td></tr>
<tr class="separator:a57547d211906c981ef20257eba99f8df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a32c617c183166308241e270959df56"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a7a32c617c183166308241e270959df56">lspmac_moving_flags</a></td></tr>
<tr class="memdesc:a7a32c617c183166308241e270959df56"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flag used to implement motor moving condition.  <a href="#a7a32c617c183166308241e270959df56"></a><br/></td></tr>
<tr class="separator:a7a32c617c183166308241e270959df56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a3e763682bd7f987d07f149e94b3bf8"><td class="memItemLeft" align="right" valign="top">pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a7a3e763682bd7f987d07f149e94b3bf8">md2_status_mutex</a></td></tr>
<tr class="memdesc:a7a3e763682bd7f987d07f149e94b3bf8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Synchronize reading/writting status buffer.  <a href="#a7a3e763682bd7f987d07f149e94b3bf8"></a><br/></td></tr>
<tr class="separator:a7a3e763682bd7f987d07f149e94b3bf8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ccf455563dc8d828558b6a230e164a6"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a1ccf455563dc8d828558b6a230e164a6">md2cmds_cmd</a> []</td></tr>
<tr class="memdesc:a1ccf455563dc8d828558b6a230e164a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">our command;  <a href="#a1ccf455563dc8d828558b6a230e164a6"></a><br/></td></tr>
<tr class="separator:a1ccf455563dc8d828558b6a230e164a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a34fb6876abbd580629d3708c805e7f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a6a34fb6876abbd580629d3708c805e7f">md2cmds_md_status_code</a></td></tr>
<tr class="separator:a6a34fb6876abbd580629d3708c805e7f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a390e8acf789b0fa41b43a794dd27e28f"><td class="memItemLeft" align="right" valign="top">pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a></td></tr>
<tr class="separator:a390e8acf789b0fa41b43a794dd27e28f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f63408d16b5603541b124a78f36a5a8"><td class="memItemLeft" align="right" valign="top">pthread_cond_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a2f63408d16b5603541b124a78f36a5a8">lsredis_cond</a></td></tr>
<tr class="separator:a2f63408d16b5603541b124a78f36a5a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7461eb2b5974a2ffac2189007d39193c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pgpmac_8h.html#a7461eb2b5974a2ffac2189007d39193c">lsredis_running</a></td></tr>
<tr class="separator:a7461eb2b5974a2ffac2189007d39193c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Headers for the entire pgpmac project. </p>
<dl class="section date"><dt>Date</dt><dd>2012 </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Keith Brister </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>All Rights Reserved </dd></dl>

<p>Definition in file <a class="el" href="pgpmac_8h_source.html">pgpmac.h</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a369266c24eacffb87046522897a570d5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _GNU_SOURCE</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="pgpmac_8h_source.html#l00007">7</a> of file <a class="el" href="pgpmac_8h_source.html">pgpmac.h</a>.</p>

</div>
</div>
<a class="anchor" id="a3bae94e8e4e4347dd5f87b6bda058de6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_DISPLAY_WINDOW_HEIGHT&#160;&#160;&#160;8</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Number of status box rows. </p>

<p>Definition at line <a class="el" href="pgpmac_8h_source.html#l00058">58</a> of file <a class="el" href="pgpmac_8h_source.html">pgpmac.h</a>.</p>

</div>
</div>
<a class="anchor" id="a1f96754f00a1f82414cebc66f75ded78"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_DISPLAY_WINDOW_WIDTH&#160;&#160;&#160;24</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Number of status box columns. </p>

<p>Definition at line <a class="el" href="pgpmac_8h_source.html#l00062">62</a> of file <a class="el" href="pgpmac_8h_source.html">pgpmac.h</a>.</p>

</div>
</div>
<a class="anchor" id="a3a8ef1b4b5994d6dd12bf74454ea891b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_QUERY_STRING_LENGTH&#160;&#160;&#160;1024</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fixed length postgresql query strings. Queries should all be function calls so this is not as weird as one might think. </p>

<p>Definition at line <a class="el" href="pgpmac_8h_source.html#l00065">65</a> of file <a class="el" href="pgpmac_8h_source.html">pgpmac.h</a>.</p>

</div>
</div>
<a class="anchor" id="ab61d790b5572f116e091babfda53627b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LSEVENTS_EVENT_LENGTH&#160;&#160;&#160;256</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fixed length for event names: simplifies string handling. </p>

<p>Definition at line <a class="el" href="pgpmac_8h_source.html#l00068">68</a> of file <a class="el" href="pgpmac_8h_source.html">pgpmac.h</a>.</p>

</div>
</div>
<a class="anchor" id="abe2a74d23400d8d8fe02dc407c242035"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LSPMAC_MAGIC_NUMBER&#160;&#160;&#160;0x9700436</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="pgpmac_8h_source.html#l00097">97</a> of file <a class="el" href="pgpmac_8h_source.html">pgpmac.h</a>.</p>

</div>
</div>
<a class="anchor" id="a30f0f377b0f0695284145d420ea51846"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MD2CMDS_CMD_LENGTH&#160;&#160;&#160;32</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="pgpmac_8h_source.html#l00508">508</a> of file <a class="el" href="pgpmac_8h_source.html">pgpmac.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="a7f71abc6fdfd1839e2e3213d78aaf766"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlspg__demandairrights__struct.html">lspg_demandairrights_struct</a>  <a class="el" href="pgpmac_8h.html#a7f71abc6fdfd1839e2e3213d78aaf766">lspg_demandairrights_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a48b627e412dd038c1f17cdb0501eec33"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlspg__getcenter__struct.html">lspg_getcenter_struct</a>  <a class="el" href="pgpmac_8h.html#a48b627e412dd038c1f17cdb0501eec33">lspg_getcenter_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Storage for getcenter query Used for the md2 ROTATE command that generates the centering movies. </p>

</div>
</div>
<a class="anchor" id="a7a794370785ff015d5ee035917e3bee8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlspg__getcurrentsampleid__struct.html">lspg_getcurrentsampleid_struct</a>  <a class="el" href="pgpmac_8h.html#a7a794370785ff015d5ee035917e3bee8">lspg_getcurrentsampleid_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a9dda9014cd0e39fba8d523e37cf9f982"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlspg__nextsample__struct.html">lspg_nextsample_struct</a>  <a class="el" href="pgpmac_8h.html#a9dda9014cd0e39fba8d523e37cf9f982">lspg_nextsample_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the next sample number Just a 32 bit int (Ha!, take that, nextshot!) </p>

</div>
</div>
<a class="anchor" id="a17ea2bf07a0b3b892baa00bd392607b3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlspg__nextshot__struct.html">lspg_nextshot_struct</a>  <a class="el" href="pgpmac_8h.html#a17ea2bf07a0b3b892baa00bd392607b3">lspg_nextshot_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Storage definition for nextshot query. </p>
<p>The next shot query returns all the information needed to collect the next data frame. Since SQL allows for null fields independently from blank strings a separate integer is used as a flag for this case. This adds to the program complexity but allows for some important cases. Suck it up.definition of the next image to be taken (and the one after that, too!) </p>

</div>
</div>
<a class="anchor" id="ae57432c0a6ac48a50457815dab2c5b4c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlspgQueryQueueStruct.html">lspgQueryQueueStruct</a>  <a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Store each query along with it's callback function. </p>
<p>All calls are asynchronous </p>

</div>
</div>
<a class="anchor" id="aa1f0e602ae9509005c62fb2d73bc1c5a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlspg__starttransfer__struct.html">lspg_starttransfer_struct</a>  <a class="el" href="pgpmac_8h.html#aa1f0e602ae9509005c62fb2d73bc1c5a">lspg_starttransfer_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>returns 1 if transfer can continue 0 to abort </p>

</div>
</div>
<a class="anchor" id="a779e2acce8b5e748c184caf23ed0db57"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlspg__waitcryo__struct.html">lspg_waitcryo_struct</a>  <a class="el" href="pgpmac_8h.html#a779e2acce8b5e748c184caf23ed0db57">lspg_waitcryo_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ac48984832ef73cf145e5f08bc65bd3a0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlspmac__bi__struct.html">lspmac_bi_struct</a>  <a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Storage for binary inputs. </p>

</div>
</div>
<a class="anchor" id="aa5067fcbaabc5bbfdc52492495518c96"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlspmac__motor__struct.html">lspmac_motor_struct</a>  <a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Motor information. </p>
<p>A catchall for motors and motor like objects. Not all members are used by all objects. </p>

</div>
</div>
<a class="anchor" id="ad449de06d02791adf2498d2a1e1f909c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlsredis__obj__struct.html">lsredis_obj_struct</a>  <a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Redis Object Basic object whose value is sychronized with our redis db. </p>

</div>
</div>
<a class="anchor" id="a99c275e32ad897dca34d196b91f038cb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlspmac__cmd__queue__struct.html">lspmac_cmd_queue_struct</a>  <a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>PMAC command queue item. </p>
<p>Command queue items are fixed length to simplify memory management. </p>

</div>
</div>
<a class="anchor" id="a2d163436571135a457f4a4e2fbd09633"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structtagEthernetCmd.html">tagEthernetCmd</a>  <a class="el" href="pgpmac_8h.html#a2d163436571135a457f4a4e2fbd09633">pmac_cmd_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>PMAC ethernet packet definition. </p>
<p>Taken directly from the Delta Tau documentation. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ac3fb8589e280bfa18ecbca6619fea637"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a>* _lsredis_get_obj </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>key</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Maybe add a new object Used internally for this module Must be called with lsredis_mutex locked. </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00544">544</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                            {</div>
<div class="line">  <a class="code" href="structlsredis__obj__struct.html" title="Redis Object Basic object whose value is sychronized with our redis db.">lsredis_obj_t</a> *<a class="code" href="namespacemk__pgpmac__redis.html#a11daf2847f2dc94562b5b61b3f412574">p</a>;</div>
<div class="line">  regmatch_t pmatch[2];</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line">  ENTRY htab_input, *htab_output;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Dispense with obviously bad keys straight away</span></div>
<div class="line">  <span class="comment">// unless p-&gt;valid == 0 in which case we call HGET first</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// TODO: review logic: is there ever a time when valid is zero for a preexisting p and HGET has not been called?</span></div>
<div class="line">  <span class="comment">//       If not then we should just return p without checking for validity.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( key == NULL || *key == 0 || strchr( key, <span class="charliteral">&#39; &#39;</span>) != NULL) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;_lsredis_get_obj: bad key &#39;%s&#39;&quot;</span>, key == NULL ? <span class="stringliteral">&quot;&lt;NULL&gt;&quot;</span> : key);</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// If the key is already there then just return it</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  htab_input.key  = key;</div>
<div class="line">  htab_input.data = NULL;</div>
<div class="line">  errno = 0;</div>
<div class="line">  err = hsearch_r( htab_input, FIND, &amp;htab_output, &amp;<a class="code" href="lsredis_8c.html#a42aec6aa74072797ec0344847b0e9e39">lsredis_htab</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( err == 0)</div>
<div class="line">    p = NULL;</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    p = htab_output-&gt;data;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( p != NULL) {</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="namespacemk__pgpmac__redis.html#a11daf2847f2dc94562b5b61b3f412574">p</a>;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="comment">// make a new one.</span></div>
<div class="line">    p = calloc( 1, <span class="keyword">sizeof</span>( <a class="code" href="structlsredis__obj__struct.html" title="Redis Object Basic object whose value is sychronized with our redis db.">lsredis_obj_t</a>));</div>
<div class="line">    <span class="keywordflow">if</span>( p == NULL) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;_lsredis_get_obj: Out of memory&quot;</span>);</div>
<div class="line">      exit( -1);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    err = regexec( &amp;<a class="code" href="lsredis_8c.html#abee04898347f9b2551fa0435b1cc597e">lsredis_key_select_regex</a>, key, 2, pmatch, 0);</div>
<div class="line">    <span class="keywordflow">if</span>( err == 0 &amp;&amp; pmatch[1].rm_so != -1) {</div>
<div class="line">      p-&gt;<a class="code" href="structlsredis__obj__struct.html#ad0a987a011b580eab739cda831f78fbb" title="Name used to generate events (normally key without the station id)">events_name</a> = strndup( key+pmatch[1].rm_so, pmatch[1].rm_eo - pmatch[1].rm_so);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      p-&gt;<a class="code" href="structlsredis__obj__struct.html#ad0a987a011b580eab739cda831f78fbb" title="Name used to generate events (normally key without the station id)">events_name</a> = strdup( key);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#ad0a987a011b580eab739cda831f78fbb" title="Name used to generate events (normally key without the station id)">events_name</a> == NULL) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;_lsredis_get_obj: Out of memory (events_name)&quot;</span>);</div>
<div class="line">      exit( -1);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    pthread_mutex_init( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>, &amp;<a class="code" href="lsredis_8c.html#a71c9f418904364d65c22d786f4dc5d39">mutex_initializer</a>);</div>
<div class="line">    pthread_cond_init(  &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>, NULL);</div>
<div class="line">    p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0465c65288e8101805a6f91049164517" title="our value">value</a> = NULL;</div>
<div class="line">    p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> = 0;</div>
<div class="line">    <span class="comment">// lsevents_send_event( &quot;%s Invalid&quot;, p-&gt;events_name);</span></div>
<div class="line">    p-&gt;<a class="code" href="structlsredis__obj__struct.html#a8bc1a536b7155a1e2a749c7c434b898b" title="Number of times we need to see our publication before we start accepting new values.">wait_for_me</a> = 0;</div>
<div class="line">    p-&gt;<a class="code" href="structlsredis__obj__struct.html#aa8c5a453b9424e5666320b8675a42f5c" title="The redis key for this object.">key</a> = strdup( key);</div>
<div class="line">    p-&gt;<a class="code" href="structlsredis__obj__struct.html#a43fcbff584654ab086d973ce34cb6ddc" title="number of times we&#39;ve searched for this key">hits</a> = 0;</div>
<div class="line">  </div>
<div class="line">    htab_input.key  = p-&gt;<a class="code" href="structlsredis__obj__struct.html#aa8c5a453b9424e5666320b8675a42f5c" title="The redis key for this object.">key</a>;</div>
<div class="line">    htab_input.data = <a class="code" href="namespacemk__pgpmac__redis.html#a11daf2847f2dc94562b5b61b3f412574">p</a>;</div>
<div class="line"></div>
<div class="line">    errno = 0;</div>
<div class="line">    err = hsearch_r( htab_input, ENTER, &amp;htab_output, &amp;<a class="code" href="lsredis_8c.html#a42aec6aa74072797ec0344847b0e9e39">lsredis_htab</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( err == 0) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;_lsredis_get_obj: hseach error on enter.  errno=%d&quot;</span>, errno);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Shouldn&#39;t need the linked list unless we need to rebuild the hash table when, for example, we run out of room.</span></div>
<div class="line">    <span class="comment">// TODO: resize hash table when needed.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    p-&gt;<a class="code" href="structlsredis__obj__struct.html#afb7259e8c3c1c83ccc234b2b2894f2b0" title="the next in our list (I guess this is going to be a linked list)">next</a> = <a class="code" href="lsredis_8c.html#a3d206e1c119f1408a7cf1078139f8189">lsredis_objs</a>;</div>
<div class="line">    <a class="code" href="lsredis_8c.html#a3d206e1c119f1408a7cf1078139f8189">lsredis_objs</a> = <a class="code" href="namespacemk__pgpmac__redis.html#a11daf2847f2dc94562b5b61b3f412574">p</a>;</div>
<div class="line">  }</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// We arrive here with the valid flag lowered.  Go ahead and request the latest value.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  redisAsyncCommand( <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>, <a class="code" href="lsredis_8c.html#a8d9719b362d1b38275d734971b7988af">lsredis_hgetCB</a>, p, <span class="stringliteral">&quot;HGET %s VALUE&quot;</span>, key);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="namespacemk__pgpmac__redis.html#a11daf2847f2dc94562b5b61b3f412574">p</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aac89b916c1152c44042875feac35a9e4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsevents_add_listener </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>raw_regexp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(char *)&#160;</td>
          <td class="paramname"><em>cb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add a callback routine to listen for a specific event. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">raw_regexp</td><td>String value of regular expression to listen to </td></tr>
    <tr><td class="paramname">cb</td><td>the routine to call </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lsevents_8c_source.html#l00099">99</a> of file <a class="el" href="lsevents_8c_source.html">lsevents.c</a>.</p>
<div class="fragment"><div class="line">                                                                  {</div>
<div class="line">  <a class="code" href="structlsevents__listener__struct.html" title="Linked list of event listeners.">lsevents_listener_t</a>    *<span class="keyword">new</span>;</div>
<div class="line">  <a class="code" href="structlsevents__event__names__struct.html" title="linked list of all the event names used to regenerate the hash table">lsevents_event_names_t</a> *enp;</div>
<div class="line">  <a class="code" href="structlsevents__callbacks__struct.html" title="lsevents linked list of callbacks for each event">lsevents_callbacks_t</a>   *cbp;</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line">  <span class="keywordtype">char</span> *errbuf;</div>
<div class="line">  <span class="keywordtype">int</span> nerrbuf;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="keyword">new</span> = calloc( 1, <span class="keyword">sizeof</span>( <a class="code" href="structlsevents__listener__struct.html" title="Linked list of event listeners.">lsevents_listener_t</a>));</div>
<div class="line">  <span class="keywordflow">if</span>( <span class="keyword">new</span> == NULL) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsevents_add_listener: out of memory&quot;</span>);</div>
<div class="line">    exit( -1);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  err = regcomp( &amp;new-&gt;re, raw_regexp, REG_EXTENDED | REG_NOSUB);</div>
<div class="line">  <span class="keywordflow">if</span>( err != 0) {</div>
<div class="line">    nerrbuf = regerror( err, &amp;new-&gt;re, NULL, 0);</div>
<div class="line">    errbuf = calloc( nerrbuf, <span class="keyword">sizeof</span>( <span class="keywordtype">char</span>));</div>
<div class="line">    <span class="keywordflow">if</span>( errbuf == NULL) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsevents_add_listener: out of memory (re)&quot;</span>);</div>
<div class="line">      exit( -1);</div>
<div class="line">    }</div>
<div class="line">    regerror( err, &amp;new-&gt;re, errbuf, nerrbuf);</div>
<div class="line">    free( errbuf);</div>
<div class="line">    free( <span class="keyword">new</span>);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keyword">new</span>-&gt;raw_regexp = strdup( raw_regexp);</div>
<div class="line">  <span class="keyword">new</span>-&gt;cb   = cb;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lsevents_8c.html#a70bba59930a1c7d7d181aa03cdfb6c00" title="mutex to protect the listener linked list">lsevents_listener_mutex</a>);</div>
<div class="line">  <span class="keyword">new</span>-&gt;next = <a class="code" href="lsevents_8c.html#a300dc3edfa8546d75e9f8bab8fa06c5c" title="Pointer to the first item in the link list of listeners.">lsevents_listeners_p</a>;</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a300dc3edfa8546d75e9f8bab8fa06c5c" title="Pointer to the first item in the link list of listeners.">lsevents_listeners_p</a> = <span class="keyword">new</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span>( enp = <a class="code" href="lsevents_8c.html#abec6bcf8613a6268e59e6c5409ee344c">lsevents_event_names</a>; enp != NULL; enp = enp-&gt;<a class="code" href="structlsevents__event__names__struct.html#a748e63bd8825f239936c5bf165ca869e">next</a>) {</div>
<div class="line">    <span class="keywordflow">if</span>( regexec( &amp;new-&gt;re, enp-&gt;<a class="code" href="structlsevents__event__names__struct.html#a07e5a0f2b74c08f388626f18b37cd1b0">event</a>, 0, NULL, 0) == 0) {</div>
<div class="line">      cbp       = calloc( 1, <span class="keyword">sizeof</span>( <a class="code" href="structlsevents__callbacks__struct.html" title="lsevents linked list of callbacks for each event">lsevents_callbacks_t</a>));</div>
<div class="line">      cbp-&gt;<a class="code" href="structlsevents__callbacks__struct.html#a523024faf274afe9056748ddbe6def5c">cb</a>   = cb;</div>
<div class="line">      cbp-&gt;<a class="code" href="structlsevents__callbacks__struct.html#a6d673746e36b16df34d53e143c1ba881">next</a> = enp-&gt;<a class="code" href="structlsevents__event__names__struct.html#afdd17d4d473fcf095a279953ea5e0f1c">cbl</a>;</div>
<div class="line">      enp-&gt;<a class="code" href="structlsevents__event__names__struct.html#afdd17d4d473fcf095a279953ea5e0f1c">cbl</a>  = cbp;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lsevents_8c.html#a70bba59930a1c7d7d181aa03cdfb6c00" title="mutex to protect the listener linked list">lsevents_listener_mutex</a>);</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af19a77187e7406fc87d36bd26e672e6d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsevents_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize this module. </p>

<p>Definition at line <a class="el" href="lsevents_8c_source.html#l00367">367</a> of file <a class="el" href="lsevents_8c_source.html">lsevents.c</a>.</p>
<div class="fragment"><div class="line">                     {</div>
<div class="line">  pthread_mutexattr_t <a class="code" href="lsredis_8c.html#a71c9f418904364d65c22d786f4dc5d39">mutex_initializer</a>;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Use recursive mutexs</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  pthread_mutexattr_init( &amp;mutex_initializer);</div>
<div class="line">  pthread_mutexattr_settype( &amp;mutex_initializer, PTHREAD_MUTEX_RECURSIVE);</div>
<div class="line"></div>
<div class="line">  pthread_mutex_init( &amp;<a class="code" href="lsevents_8c.html#ab46f4ebda5e926a213faedac1a545ec1" title="mutex to protect the event queue">lsevents_queue_mutex</a>,    &amp;mutex_initializer);</div>
<div class="line">  pthread_cond_init(  &amp;<a class="code" href="lsevents_8c.html#a8079d9fb8c35db3ca5f83be5aeb2a747" title="condition to pause the queue if needed">lsevents_queue_cond</a>,     NULL);</div>
<div class="line">  pthread_mutex_init( &amp;<a class="code" href="lsevents_8c.html#a70bba59930a1c7d7d181aa03cdfb6c00" title="mutex to protect the listener linked list">lsevents_listener_mutex</a>, &amp;mutex_initializer);</div>
<div class="line"></div>
<div class="line">  hcreate_r( 2*<a class="code" href="lsevents_8c.html#ad09b507c9a79282374a0474470454bb8">lsevents_max_events</a>, &amp;<a class="code" href="lsevents_8c.html#a274c60d870a1b91ab606dcf024be1bf7">lsevents_event_name_ht</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae09cfa92dba806d8f8808e5822ea713c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsevents_preregister_event </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsevents_8c_source.html#l00308">308</a> of file <a class="el" href="lsevents_8c_source.html">lsevents.c</a>.</p>
<div class="fragment"><div class="line">                                                 {</div>
<div class="line">  <span class="keywordtype">char</span>  s[128];</div>
<div class="line">  va_list arg_ptr;</div>
<div class="line"></div>
<div class="line">  va_start( arg_ptr, fmt);</div>
<div class="line">  vsnprintf( s, <span class="keyword">sizeof</span>( s) - 1, fmt, arg_ptr);</div>
<div class="line">  s[<span class="keyword">sizeof</span>(s)-1] = 0;</div>
<div class="line">  va_end( arg_ptr);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lsevents_8c.html#a5e3fd5e3c6d11f8a74d79978e00f8835" title="Add a new event name and find matching callbacks as a returned linked list.">lsevents_register_event</a>( s);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a024b08c7820bb31c3d5b8f281e07f3e8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsevents_remove_listener </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(char *)&#160;</td>
          <td class="paramname"><em>cb</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove a listener previously added with lsevents_add_listener. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">event</td><td>The name of the event (possibly a regular expression string) </td></tr>
    <tr><td class="paramname">cb</td><td>The callback routine to remove </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lsevents_8c_source.html#l00154">154</a> of file <a class="el" href="lsevents_8c_source.html">lsevents.c</a>.</p>
<div class="fragment"><div class="line">                                                                {</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="structlsevents__listener__struct.html" title="Linked list of event listeners.">lsevents_listener_t</a> *last, *current;</div>
<div class="line">  <a class="code" href="structlsevents__event__names__struct.html" title="linked list of all the event names used to regenerate the hash table">lsevents_event_names_t</a> *enp;</div>
<div class="line">  <a class="code" href="structlsevents__callbacks__struct.html" title="lsevents linked list of callbacks for each event">lsevents_callbacks_t</a>   *cbp, *last_cbp;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Find the listener to remove</span></div>
<div class="line">  <span class="comment">// and unlink it from the list</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lsevents_8c.html#a70bba59930a1c7d7d181aa03cdfb6c00" title="mutex to protect the listener linked list">lsevents_listener_mutex</a>);</div>
<div class="line">  last = NULL;</div>
<div class="line">  <span class="keywordflow">for</span>( current = <a class="code" href="lsevents_8c.html#a300dc3edfa8546d75e9f8bab8fa06c5c" title="Pointer to the first item in the link list of listeners.">lsevents_listeners_p</a>; current != NULL; current = current-&gt;<a class="code" href="structlsevents__listener__struct.html#a8aed9196b0deab84e018b96c0cc59305" title="Next listener.">next</a>) {</div>
<div class="line">    <span class="keywordflow">if</span>( strcmp( last-&gt;<a class="code" href="structlsevents__listener__struct.html#afffe7a6889fda47a3a7a91beefed9168" title="the original string sent to us">raw_regexp</a>, event) == 0 &amp;&amp; last-&gt;<a class="code" href="structlsevents__listener__struct.html#a005906c1c9f0647e6ed1fb4592d8c5d0" title="call back function">cb</a> == cb) {</div>
<div class="line">      <span class="keywordflow">if</span>( last == NULL) {</div>
<div class="line">        <a class="code" href="lsevents_8c.html#a300dc3edfa8546d75e9f8bab8fa06c5c" title="Pointer to the first item in the link list of listeners.">lsevents_listeners_p</a> = current-&gt;<a class="code" href="structlsevents__listener__struct.html#a8aed9196b0deab84e018b96c0cc59305" title="Next listener.">next</a>;</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        last-&gt;<a class="code" href="structlsevents__listener__struct.html#a8aed9196b0deab84e018b96c0cc59305" title="Next listener.">next</a> = current-&gt;<a class="code" href="structlsevents__listener__struct.html#a8aed9196b0deab84e018b96c0cc59305" title="Next listener.">next</a>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">    last = current;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( current == NULL) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsevents_remove_listener: Could not find this listener for event &#39;%s&#39;&quot;</span>, event);</div>
<div class="line">    pthread_mutex_unlock( &amp;<a class="code" href="lsevents_8c.html#a70bba59930a1c7d7d181aa03cdfb6c00" title="mutex to protect the listener linked list">lsevents_listener_mutex</a>);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Remove callback from lists of event names</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">for</span>( enp = <a class="code" href="lsevents_8c.html#abec6bcf8613a6268e59e6c5409ee344c">lsevents_event_names</a>; enp != NULL; enp = enp-&gt;<a class="code" href="structlsevents__event__names__struct.html#a748e63bd8825f239936c5bf165ca869e">next</a>) {</div>
<div class="line">    <span class="keywordflow">if</span>( regexec( &amp;current-&gt;<a class="code" href="structlsevents__listener__struct.html#a60b0f9e188a08e6101c494af89052d3f" title="regular expression representing listened for events">re</a>, enp-&gt;<a class="code" href="structlsevents__event__names__struct.html#a07e5a0f2b74c08f388626f18b37cd1b0">event</a>, 0, NULL, 0) == 0) {</div>
<div class="line">      last_cbp = NULL;</div>
<div class="line">      <span class="keywordflow">for</span>( cbp = enp-&gt;<a class="code" href="structlsevents__event__names__struct.html#afdd17d4d473fcf095a279953ea5e0f1c">cbl</a>; cbp != NULL; cbp = cbp-&gt;<a class="code" href="structlsevents__callbacks__struct.html#a6d673746e36b16df34d53e143c1ba881">next</a>) {</div>
<div class="line">        <span class="keywordflow">if</span>( cbp-&gt;<a class="code" href="structlsevents__callbacks__struct.html#a523024faf274afe9056748ddbe6def5c">cb</a> == cb) {</div>
<div class="line">          <span class="keywordflow">if</span>( last_cbp == NULL)</div>
<div class="line">            enp-&gt;<a class="code" href="structlsevents__event__names__struct.html#afdd17d4d473fcf095a279953ea5e0f1c">cbl</a> = NULL;</div>
<div class="line">          <span class="keywordflow">else</span></div>
<div class="line">            last_cbp-&gt;<a class="code" href="structlsevents__callbacks__struct.html#a6d673746e36b16df34d53e143c1ba881">next</a> = cbp-&gt;<a class="code" href="structlsevents__callbacks__struct.html#a6d673746e36b16df34d53e143c1ba881">next</a>;</div>
<div class="line">          free( cbp);</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lsevents_8c.html#a70bba59930a1c7d7d181aa03cdfb6c00" title="mutex to protect the listener linked list">lsevents_listener_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Now remove it</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( current-&gt;<a class="code" href="structlsevents__listener__struct.html#afffe7a6889fda47a3a7a91beefed9168" title="the original string sent to us">raw_regexp</a> != NULL)</div>
<div class="line">    free( current-&gt;<a class="code" href="structlsevents__listener__struct.html#afffe7a6889fda47a3a7a91beefed9168" title="the original string sent to us">raw_regexp</a>);</div>
<div class="line">  free(current);</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7f2ed970b1c3b340b79311e73c5f1e11"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_t* lsevents_run </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start up the thread and get out of the way. </p>

<p>Definition at line <a class="el" href="lsevents_8c_source.html#l00384">384</a> of file <a class="el" href="lsevents_8c_source.html">lsevents.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  pthread_create( &amp;<a class="code" href="lsevents_8c.html#a314640d7c3cb4fa90823ab2418fbac9b" title="thread to run the event queue">lsevents_thread</a>, NULL, <a class="code" href="lsevents_8c.html#a48e8f9dee00710bbe293b4bbded37a39" title="Our worker.">lsevents_worker</a>, NULL);</div>
<div class="line">  <span class="keywordflow">return</span> &amp;<a class="code" href="lsevents_8c.html#a314640d7c3cb4fa90823ab2418fbac9b" title="thread to run the event queue">lsevents_thread</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3661dfc51537c05b11f4fd184fdff07d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsevents_send_event </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Call the callback routines for the given event. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fmt</td><td>a printf style formating string </td></tr>
    <tr><td class="paramname">...</td><td>list of arguments specified by the format string </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lsevents_8c_source.html#l00073">73</a> of file <a class="el" href="lsevents_8c_source.html">lsevents.c</a>.</p>
<div class="fragment"><div class="line">                                          {</div>
<div class="line">  <span class="keywordtype">char</span> <span class="keyword">event</span>[<a class="code" href="pgpmac_8h.html#ab61d790b5572f116e091babfda53627b" title="Fixed length for event names: simplifies string handling.">LSEVENTS_EVENT_LENGTH</a>];</div>
<div class="line">  va_list arg_ptr;</div>
<div class="line"></div>
<div class="line">  va_start( arg_ptr, fmt);</div>
<div class="line">  vsnprintf( event, <span class="keyword">sizeof</span>(event)-1, fmt, arg_ptr);</div>
<div class="line">  <span class="keyword">event</span>[<span class="keyword">sizeof</span>(event)-1]=0;</div>
<div class="line">  va_end( arg_ptr);</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lsevents_8c.html#ab46f4ebda5e926a213faedac1a545ec1" title="mutex to protect the event queue">lsevents_queue_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// maybe wait for room on the queue</span></div>
<div class="line">  <span class="keywordflow">while</span>( (<a class="code" href="lsevents_8c.html#a3bccf603d56d5b2f4a92fad341d37e2c" title="next queue location to write">lsevents_queue_on</a> + 1) % <a class="code" href="lsevents_8c.html#a75469307c70790f04b9b2bfcb1473a48">LSEVENTS_QUEUE_LENGTH</a> == <a class="code" href="lsevents_8c.html#a50ad47e12cc4fc2d88659230b2fd44ff" title="next queue location to read">lsevents_queue_off</a> % <a class="code" href="lsevents_8c.html#a75469307c70790f04b9b2bfcb1473a48">LSEVENTS_QUEUE_LENGTH</a>)</div>
<div class="line">    pthread_cond_wait( &amp;<a class="code" href="lsevents_8c.html#a8079d9fb8c35db3ca5f83be5aeb2a747" title="condition to pause the queue if needed">lsevents_queue_cond</a>, &amp;<a class="code" href="lsevents_8c.html#ab46f4ebda5e926a213faedac1a545ec1" title="mutex to protect the event queue">lsevents_queue_mutex</a>);</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="lsevents_8c.html#ad1ff5e895b4016113c8414d9a5daa2f2" title="simple list of events">lsevents_queue</a>[(<a class="code" href="lsevents_8c.html#a3bccf603d56d5b2f4a92fad341d37e2c" title="next queue location to write">lsevents_queue_on</a>++) % LSEVENTS_QUEUE_LENGTH].evp = strdup(event);</div>
<div class="line"></div>
<div class="line">  pthread_cond_signal(  &amp;<a class="code" href="lsevents_8c.html#a8079d9fb8c35db3ca5f83be5aeb2a747" title="condition to pause the queue if needed">lsevents_queue_cond</a>);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lsevents_8c.html#ab46f4ebda5e926a213faedac1a545ec1" title="mutex to protect the event queue">lsevents_queue_mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3418b9ab57811d28632794236e056408"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lslogging_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the lslogging objects. </p>

<p>Definition at line <a class="el" href="lslogging_8c_source.html#l00037">37</a> of file <a class="el" href="lslogging_8c_source.html">lslogging.c</a>.</p>
<div class="fragment"><div class="line">                      {</div>
<div class="line">  pthread_mutex_init( &amp;<a class="code" href="lslogging_8c.html#a4a97ffe8731ae437f014ada051301be3" title="mutex to keep the various threads from adding to the queue at the exact same time">lslogging_mutex</a>, NULL);</div>
<div class="line">  pthread_cond_init(  &amp;<a class="code" href="lslogging_8c.html#afa5f05c4337683edc3c88ab56aa5ea6f" title="We&#39;ll spend most of our time waiting for this condition&#39;s signal.">lslogging_cond</a>, NULL);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lslogging_8c.html#a5709d6eb68a8eebf78ba58bb78da0649" title="our log file object">lslogging_file</a> = fopen( <a class="code" href="lslogging_8c.html#ade1e95a32a49f0fd1b3e635c4d15ccd3" title="Full name of the log file.">LSLOGGING_FILE_NAME</a>, <span class="stringliteral">&quot;w&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0e756b36671055ef02a8f04d2ba8a93b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lslogging_log_message </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The routine everyone will be talking about. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fmt</td><td>A printf style formating string. </td></tr>
    <tr><td class="paramname">...</td><td>The arguments specified by fmt </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lslogging_8c_source.html#l00048">48</a> of file <a class="el" href="lslogging_8c_source.html">lslogging.c</a>.</p>
<div class="fragment"><div class="line">                                            {</div>
<div class="line">  <span class="keywordtype">char</span> msg[<a class="code" href="lslogging_8c.html#a0526e4aa12fbaf357fe315d6b3209c54" title="Fixed maximum length messages to keep some form of sanity.">LSLOGGING_MSG_LENGTH</a>];</div>
<div class="line">  <span class="keyword">struct </span>timespec theTime;</div>
<div class="line">  va_list arg_ptr;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> on;</div>
<div class="line"></div>
<div class="line">  clock_gettime( CLOCK_REALTIME, &amp;theTime);</div>
<div class="line"></div>
<div class="line">  va_start( arg_ptr, fmt);</div>
<div class="line">  vsnprintf( msg, <span class="keyword">sizeof</span>(msg)-1, fmt, arg_ptr);</div>
<div class="line">  va_end( arg_ptr);</div>
<div class="line">  msg[<span class="keyword">sizeof</span>(msg)-1]=0;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lslogging_8c.html#a4a97ffe8731ae437f014ada051301be3" title="mutex to keep the various threads from adding to the queue at the exact same time">lslogging_mutex</a>);</div>
<div class="line">  </div>
<div class="line">  on = (<a class="code" href="lslogging_8c.html#a1f6e69ade57a17755e6b74a6286505df" title="next location to add to the queue">lslogging_on</a>++) % <a class="code" href="lslogging_8c.html#a5b1cb610bee26b000a2d64caa7d77a8d" title="Modest length queue.">LSLOGGING_QUEUE_LENGTH</a>;</div>
<div class="line">  strncpy( <a class="code" href="lslogging_8c.html#af98f94aec3e4501328da1b71f706c652" title="Our entire queue. Right here. Every message we&#39;ll ever write.">lslogging_queue</a>[on].lmsg, msg, <a class="code" href="lslogging_8c.html#a0526e4aa12fbaf357fe315d6b3209c54" title="Fixed maximum length messages to keep some form of sanity.">LSLOGGING_MSG_LENGTH</a> - 1);</div>
<div class="line">  <a class="code" href="lslogging_8c.html#af98f94aec3e4501328da1b71f706c652" title="Our entire queue. Right here. Every message we&#39;ll ever write.">lslogging_queue</a>[on].<a class="code" href="structlslogging__queue__struct.html#a5e83db0116b1289a84683ce48626d99d" title="our message, truncated if too long">lmsg</a>[<a class="code" href="lslogging_8c.html#a0526e4aa12fbaf357fe315d6b3209c54" title="Fixed maximum length messages to keep some form of sanity.">LSLOGGING_MSG_LENGTH</a>-1] = 0;</div>
<div class="line">  </div>
<div class="line">  memcpy( &amp;(<a class="code" href="lslogging_8c.html#af98f94aec3e4501328da1b71f706c652" title="Our entire queue. Right here. Every message we&#39;ll ever write.">lslogging_queue</a>[on].ltime), &amp;theTime, <span class="keyword">sizeof</span>(theTime));</div>
<div class="line"></div>
<div class="line">  pthread_cond_signal(  &amp;<a class="code" href="lslogging_8c.html#afa5f05c4337683edc3c88ab56aa5ea6f" title="We&#39;ll spend most of our time waiting for this condition&#39;s signal.">lslogging_cond</a>);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lslogging_8c.html#a4a97ffe8731ae437f014ada051301be3" title="mutex to keep the various threads from adding to the queue at the exact same time">lslogging_mutex</a>);</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab5d6951193d8b2df1e4dd61c53de76cc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_t* lslogging_run </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start up the worker thread. </p>

<p>Definition at line <a class="el" href="lslogging_8c_source.html#l00123">123</a> of file <a class="el" href="lslogging_8c_source.html">lslogging.c</a>.</p>
<div class="fragment"><div class="line">                           {</div>
<div class="line">  pthread_create( &amp;<a class="code" href="lslogging_8c.html#ad7629be92d1bec1c621b5cc0800f497f" title="our thread">lslogging_thread</a>, NULL, &amp;<a class="code" href="lslogging_8c.html#a33ec49aea69b5e4b1b551a34e7bacfca" title="Service the queue, write to the file.">lslogging_worker</a>, NULL);</div>
<div class="line">  <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Start up&quot;</span>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;.+&quot;</span>, <a class="code" href="lslogging_8c.html#a775318b2753a8b5be9f235589a78797b" title="Log most events.">lslogging_event_cb</a>);</div>
<div class="line">  <span class="keywordflow">return</span> &amp;<a class="code" href="lslogging_8c.html#ad7629be92d1bec1c621b5cc0800f497f" title="our thread">lslogging_thread</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4ee000bfeef9380d479464a9500af311"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char** lspg_array2ptrs </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>returns a null terminated list of strings parsed from postgresql array </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00165">165</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                 {</div>
<div class="line">  <span class="keywordtype">char</span> **rtn, *sp, *acums;</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>, n, inquote, havebackslash, rtni;;</div>
<div class="line">  <span class="keywordtype">int</span> mxsz;</div>
<div class="line">  </div>
<div class="line">  inquote       = 0;</div>
<div class="line">  havebackslash = 0;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Despense with the null input condition before we complicate the code below</span></div>
<div class="line">  <span class="keywordflow">if</span>( a == NULL || a[0] != <span class="charliteral">&#39;{&#39;</span> || a[strlen(a)-1] != <span class="charliteral">&#39;}&#39;</span>)</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Count the maximum number of strings</span></div>
<div class="line">  <span class="comment">// Actual number will be less if there are quoted commas</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  n = 1;</div>
<div class="line">  <span class="keywordflow">for</span>( i=0; a[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>]; i++) {</div>
<div class="line">    <span class="keywordflow">if</span>( a[i] == <span class="charliteral">&#39;,&#39;</span>)</div>
<div class="line">      n++;</div>
<div class="line">  }</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// The maximum size of any string is the length of a (+1)</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  mxsz = strlen(a) + 1;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// This is the accumulation string to make up the array elements</span></div>
<div class="line">  acums = (<span class="keywordtype">char</span> *)calloc( mxsz, <span class="keyword">sizeof</span>( <span class="keywordtype">char</span>));</div>
<div class="line">  <span class="keywordflow">if</span>( acums == NULL) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspg_array2ptrs: out of memory (acums)&quot;</span>);</div>
<div class="line">    exit( 1);</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// allocate storage for the pointer array and the null terminator</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  rtn = (<span class="keywordtype">char</span> **)calloc( n+1, <span class="keyword">sizeof</span>( <span class="keywordtype">char</span> *));</div>
<div class="line">  <span class="keywordflow">if</span>( rtn == NULL) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspg_array2ptrs: out of memory (rtn)&quot;</span>);</div>
<div class="line">    exit( 1);</div>
<div class="line">  }</div>
<div class="line">  rtni = 0;</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Go through and create the individual strings</span></div>
<div class="line">  sp = acums;</div>
<div class="line">  *sp = 0;</div>
<div class="line"></div>
<div class="line">  inquote = 0;</div>
<div class="line">  havebackslash = 0;</div>
<div class="line">  <span class="keywordflow">for</span>( i=1; a[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>] != 0; i++) {</div>
<div class="line">    <span class="keywordflow">switch</span>( a[i]) {</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;&quot;&#39;</span>:</div>
<div class="line">      <span class="keywordflow">if</span>( havebackslash) {</div>
<div class="line">        <span class="comment">// a quoted quote.  Cool</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        *(sp++) = a[i];</div>
<div class="line">        *sp = 0;</div>
<div class="line">        havebackslash = 0;</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">// Toggle the flag</span></div>
<div class="line">        inquote = 1 - inquote;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;\\&#39;</span>:</div>
<div class="line">      <span class="keywordflow">if</span>( havebackslash) {</div>
<div class="line">        *(sp++) = a[i];</div>
<div class="line">        *sp = 0;</div>
<div class="line">        havebackslash = 0;</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        havebackslash = 1;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;,&#39;</span>:</div>
<div class="line">      <span class="keywordflow">if</span>( inquote || havebackslash) {</div>
<div class="line">        *(sp++) = a[i];</div>
<div class="line">        *sp = 0;</div>
<div class="line">        havebackslash = 0;</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        rtn[rtni++] = strdup( acums);</div>
<div class="line">        sp = acums;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">      </div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;}&#39;</span>:</div>
<div class="line">      <span class="keywordflow">if</span>( inquote || havebackslash) {</div>
<div class="line">        *(sp++) = a[i];</div>
<div class="line">        *sp = 0;</div>
<div class="line">        havebackslash = 0;</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        rtn[rtni++] = strdup( acums);</div>
<div class="line">        rtn[rtni]   = NULL;</div>
<div class="line">        free( acums);</div>
<div class="line">        <span class="keywordflow">return</span>( rtn);</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">      *(sp++) = a[i];</div>
<div class="line">      *sp = 0;</div>
<div class="line">      havebackslash = 0;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Getting here means the final &#39;}&#39; was missing</span></div>
<div class="line">  <span class="comment">// Probably we should throw an error or log it or something.</span></div>
<div class="line">  <span class="comment">// Through out the last entry since this there is not resonable expectation that</span></div>
<div class="line">  <span class="comment">// we should be parsing it anyway.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  rtn[rtni]   = NULL;</div>
<div class="line">  free( acums);</div>
<div class="line">  <span class="keywordflow">return</span>( rtn);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa4cad634cac645d0366acbb25cef7b96"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspg_demandairrights_all </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>do nothing until we get airrights </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00724">724</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                               {</div>
<div class="line">  <a class="code" href="lspg_8c.html#ae3f3ae783042eb1f5f2c37b517b7404a" title="call for airrights">lspg_demandairrights_call</a>();</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="lspg_8c.html#a79cc363874905f76f5607cca5dc9773a" title="wait for the air rights request to return">lspg_demandairrights_wait</a>();</div>
<div class="line">  <span class="comment">// there is no &quot;done&quot; version</span></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6f7cd0a06f6a266ef65b3604cf33d6c4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_getcenter_call </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Request a getcenter query. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01424">1424</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                           {</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a214bb7e88b137162f13f41f2c43002a9" title="don&#39;t let the threads collide!">mutex</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a4b350f11f1e375b9e9e839caaffbcb6b" title="used with condition">new_value_ready</a> = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a0d1be4b8199bc5ec781c3df2211335aa" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a>     = 0;</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a214bb7e88b137162f13f41f2c43002a9" title="don&#39;t let the threads collide!">mutex</a>);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#a8184824f2b71b1d35141d7922ca69cd7" title="Retrieve the data to center the crystal.">lspg_getcenter_cb</a>, <a class="code" href="lspg_8c.html#a42a5e614dc36938e4897ea3c038d4dc2" title="getcenter query error callback">lspg_getcenter_error_cb</a>, <span class="stringliteral">&quot;SELECT * FROM px.getcenter2()&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7c678553b44c874d08ec9966ed7bb1c0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_getcenter_done </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Done with getcenter query. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01443">1443</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                           {</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a214bb7e88b137162f13f41f2c43002a9" title="don&#39;t let the threads collide!">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3e0e4b3cb9fa03961ee0c104e0b06754"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_getcenter_wait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for a getcenter query to return. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01435">1435</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                           {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a214bb7e88b137162f13f41f2c43002a9" title="don&#39;t let the threads collide!">mutex</a>));</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a4b350f11f1e375b9e9e839caaffbcb6b" title="used with condition">new_value_ready</a> == 0 &amp;&amp; <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a0d1be4b8199bc5ec781c3df2211335aa" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#ae0db0ff2608ab5ba3e7c1b4ad3fc0e91" title="provides signaling for when the query is done">cond</a>), &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a214bb7e88b137162f13f41f2c43002a9" title="don&#39;t let the threads collide!">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a39ff432056655f9dbe0f0239668caf74"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int lspg_getcurrentsampleid_all </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>return the current sampleid </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00510">510</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                           {</div>
<div class="line">  <a class="code" href="lspg_8c.html#acf98a9e2adec05a69847045f444a5c77">lspg_getcurrentsampleid_call</a>();</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="lspg_8c.html#a7b070b4891f485b7f74c95e0e60471f3">lspg_getcurrentsampleid_read</a>();</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a02d7dc2b8b8667b07b48d9147eb4621d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspg_getcurrentsampleid_wait_for_id </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>test</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00517">517</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                                            {</div>
<div class="line">  <span class="keywordtype">int</span> rtn;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ace54acbdcbce620437962858ba04e256" title="practice safe threading">mutex</a>);</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#af629de1e076fd6763bccea3547ef24e7" title="the sample we think is mounted on the diffractometer">getcurrentsampleid</a> != test &amp;&amp; <a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ac81d3b649befe470ef32453c9b83d334" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;<a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#a289960e45fdc9339a05dc8607f1b7563" title="for signaling">cond</a>, &amp;<a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ace54acbdcbce620437962858ba04e256" title="practice safe threading">mutex</a>);</div>
<div class="line">  </div>
<div class="line">  rtn = <a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ac81d3b649befe470ef32453c9b83d334" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a>;</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ace54acbdcbce620437962858ba04e256" title="practice safe threading">mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8a77972df14166e05c94ed0792baa09b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initiallize the lspg module. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l02161">2161</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                 {</div>
<div class="line">  pthread_mutex_init( &amp;<a class="code" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4" title="keep the queue from getting tangled">lspg_queue_mutex</a>, NULL);</div>
<div class="line">  pthread_cond_init( &amp;<a class="code" href="lspg_8c.html#a61a308b6a37afd645beb422653b95baa" title="keeps the queue from overflowing">lspg_queue_cond</a>, NULL);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#a61e47be0d5d7154700e7e5edb889852e" title="initialize the demandairrights structure">lspg_demandairrights_init</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad31db17587a02302ac4e40fb7d260b1b" title="Initialize getcenter object.">lspg_getcenter_init</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a5d6f6c4733629fc14e4f0bc128a1ffb7">lspg_getcurrentsampleid_init</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a0e9bbf847dadfe0d10830d67824d9be8" title="Initialize detector lock object.">lspg_lock_detector_init</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a39bb94f8e0d47702b2b920a3dee61ebc" title="initialize the diffractometer locking object">lspg_lock_diffractometer_init</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a2faa901ea0a8ef00cfd93a893b34b446" title="Initialize the nextsample variable, mutex, and condition.">lspg_nextsample_init</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#aff91db7d60e6c832684c023813e36dbf" title="Initialize the nextshot variable, mutex, and condition.">lspg_nextshot_init</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a31823ecb2b44d4a6674f804059a27bce" title="Initialize the data collection object.">lspg_seq_run_prep_init</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#ab98f7d254fa0f5f4826f9427ca8b4f03">lspg_starttransfer_init</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a3517f8fbed91c998f6036284f9bd0c48" title="initialize the detector timing object">lspg_wait_for_detector_init</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a32b2bf00d66ee5fca130ee616a09cf7b">lspg_waitcryo_init</a>();</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4cc866393eda0cf20276d035f6fbe206"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int lspg_nextsample_all </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>err</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00608">608</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                            {</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rtn;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#aab1c441d22126ea4334b3c61b7e4b4c2" title="Queue up a nextsample query.">lspg_nextsample_call</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a32878d3d29f4595d1d2b861d7e871726" title="Wait for the nextsample query to get processed.">lspg_nextsample_wait</a>();</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#aeee8110133db9f1895237ed9b54dd873" title="just in case, though this query should always return an integer, perhaps 0">no_rows_returned</a> || <a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#ade2772532d53709c5144d07332966a4a" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a>) {</div>
<div class="line">    rtn = 0;</div>
<div class="line">    *err = <a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#ade2772532d53709c5144d07332966a4a" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a> ? 2 : 1;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#a2ca6e2a667c9fe7f1a54329de04d2a3c" title="shouldn&#39;t ever be set, but if we change the logic of this call in PG then we are ready for it here...">nextsample_isnull</a>) {</div>
<div class="line">      rtn = 0;</div>
<div class="line">      *err = 1;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      rtn = <a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#aecd82b329462ae06bc2f0d162985a086" title="sample number (4 8-bit segments: station, dewar (lid), puck, and position in the puck)">nextsample</a>;</div>
<div class="line">      *err = 0;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="lspg_8c.html#ac52207cc8f4c14494ae6f4972b6a3b23" title="Called when the next shot query has been processed.">lspg_nextsample_done</a>();</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af17ef79544ca5d78fd477010fe90d538"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_nextshot_call </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Queue up a nextshot query. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01001">1001</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a38b657155fbee9b73278f76912cf2333" title="Our mutex for sanity in the multi-threaded program.">mutex</a>));</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#adb8da14444b98f556dba9420dd4666dc" title="Our flag for the condition to wait for.">new_value_ready</a> = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#aa50fbe34bd93ccc3762a804e95f8fd10" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a>     = 0;</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a38b657155fbee9b73278f76912cf2333" title="Our mutex for sanity in the multi-threaded program.">mutex</a>));</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#a9e92a204f606761d368ac7e06ef0f09c" title="Next Shot Callback.">lspg_nextshot_cb</a>, <a class="code" href="lspg_8c.html#a83677bfe7aab92df2d6d93fdf8cd2280" title="next shot query error callback">lspg_nextshot_error_cb</a>, <span class="stringliteral">&quot;SELECT * FROM px.nextshot2()&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a50458a014041a4118452802dfb303960"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_nextshot_done </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Called when the next shot query has been processed. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01020">1020</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a38b657155fbee9b73278f76912cf2333" title="Our mutex for sanity in the multi-threaded program.">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a784a6de32a86fec9efb3ef3ae4b6e3ac"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_nextshot_wait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for the next shot query to get processed. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01012">1012</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a38b657155fbee9b73278f76912cf2333" title="Our mutex for sanity in the multi-threaded program.">mutex</a>));</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#adb8da14444b98f556dba9420dd4666dc" title="Our flag for the condition to wait for.">new_value_ready</a> == 0 &amp;&amp; <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#aa50fbe34bd93ccc3762a804e95f8fd10" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#afc773a9eefc173aa98d5c2889e1d7669" title="Condition to wait for a response from our postgresql server.">cond</a>), &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a38b657155fbee9b73278f76912cf2333" title="Our mutex for sanity in the multi-threaded program.">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5c9f2cdd05a9a7fc2c1e03ffebec9d9f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_query_push </td>
          <td>(</td>
          <td class="paramtype">void(*)(<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *, PGresult *)&#160;</td>
          <td class="paramname"><em>cb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)()&#160;</td>
          <td class="paramname"><em>ecb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Place a query on the queue. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cb</td><td>Our callback function that deals with the response </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ecb</td><td>error response </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fmt</td><td>Printf style function to generate the query </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00130">130</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                       {</div>
<div class="line">  <span class="keywordtype">int</span> idx;</div>
<div class="line">  va_list arg_ptr;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4" title="keep the queue from getting tangled">lspg_queue_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Pause the thread while we service the queue</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">while</span>( (<a class="code" href="lspg_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6" title="Next position to add something to the queue.">lspg_query_queue_on</a> + 1) % <a class="code" href="lspg_8c.html#a08fe83fe8226002ee8b80ce0a914fd11" title="Queue length should be long enough that we do not ordinarly bump into the end We should be safe as lo...">LS_PG_QUERY_QUEUE_LENGTH</a> == <a class="code" href="lspg_8c.html#aca86bb77d6cecfae9251743f4171bafb" title="The last item still being used (on == off means nothing in queue)">lspg_query_queue_off</a> % <a class="code" href="lspg_8c.html#a08fe83fe8226002ee8b80ce0a914fd11" title="Queue length should be long enough that we do not ordinarly bump into the end We should be safe as lo...">LS_PG_QUERY_QUEUE_LENGTH</a>) {</div>
<div class="line">    pthread_cond_wait( &amp;<a class="code" href="lspg_8c.html#a61a308b6a37afd645beb422653b95baa" title="keeps the queue from overflowing">lspg_queue_cond</a>, &amp;<a class="code" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4" title="keep the queue from getting tangled">lspg_queue_mutex</a>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  idx = <a class="code" href="lspg_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6" title="Next position to add something to the queue.">lspg_query_queue_on</a> % <a class="code" href="lspg_8c.html#a08fe83fe8226002ee8b80ce0a914fd11" title="Queue length should be long enough that we do not ordinarly bump into the end We should be safe as lo...">LS_PG_QUERY_QUEUE_LENGTH</a>;</div>
<div class="line"></div>
<div class="line">  va_start( arg_ptr, fmt);</div>
<div class="line">  vsnprintf( <a class="code" href="lspg_8c.html#a357d9d98f0b8c9625ccebcebfcdce955" title="Our query queue.">lspg_query_queue</a>[idx].qs, <a class="code" href="kvredis_8c.html#a3a8ef1b4b5994d6dd12bf74454ea891b">LS_PG_QUERY_STRING_LENGTH</a>-1, fmt, arg_ptr);</div>
<div class="line">  va_end( arg_ptr);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#a357d9d98f0b8c9625ccebcebfcdce955" title="Our query queue.">lspg_query_queue</a>[idx].<a class="code" href="structlspgQueryQueueStruct.html#a1389b3ec4ddf9ed5cc0344d229a7ff9e" title="our queries should all be pretty short as we&#39;ll just be calling functions: fixed length here simplifi...">qs</a>[<a class="code" href="kvredis_8c.html#a3a8ef1b4b5994d6dd12bf74454ea891b">LS_PG_QUERY_STRING_LENGTH</a> - 1] = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#a357d9d98f0b8c9625ccebcebfcdce955" title="Our query queue.">lspg_query_queue</a>[idx].<a class="code" href="structlspgQueryQueueStruct.html#a53bac5ae4cab775423940bff5092a831" title="Callback function for when a query returns a result.">onResponse</a> = cb;</div>
<div class="line">  <a class="code" href="lspg_8c.html#a357d9d98f0b8c9625ccebcebfcdce955" title="Our query queue.">lspg_query_queue</a>[idx].<a class="code" href="structlspgQueryQueueStruct.html#ac7e4b4a8c59d7c814670ed1004154c2c" title="Perhaps the caller wants to clean up or recover.">onError</a>    = er;</div>
<div class="line">  <a class="code" href="lspg_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6" title="Next position to add something to the queue.">lspg_query_queue_on</a>++;</div>
<div class="line"></div>
<div class="line">  pthread_kill( <a class="code" href="lspg_8c.html#a04eb0cda0d5e5afeae7c393b51689765" title="our worker thread">lspg_thread</a>, SIGUSR1);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4" title="keep the queue from getting tangled">lspg_queue_mutex</a>);</div>
<div class="line">};</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a80df49750b61bb2526618db4253fc4ce"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_t* lspg_run </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start 'er runnin'. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l02180">2180</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                      {</div>
<div class="line"></div>
<div class="line">  pthread_create( &amp;<a class="code" href="lspg_8c.html#a04eb0cda0d5e5afeae7c393b51689765" title="our worker thread">lspg_thread</a>, NULL, <a class="code" href="lspg_8c.html#aaf4fadd2943fa3a2ecb5d840e84d68fa" title="The main loop for the lspg thread.">lspg_worker</a>, NULL);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^(appy|appz|capy|capz|scint) In Position$&quot;</span>, <a class="code" href="lspg_8c.html#a4710c50945fce26b4ac5dc01ed61459d">lspg_check_preset_in_position_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^(appy|appz|capy|capz|scint) Moving$&quot;</span>,      <a class="code" href="lspg_8c.html#abcdcee6ef5ed0865056d42a6cf9da8bd">lspg_unset_current_preset_moving_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^Preset Changed (.+)&quot;</span>,                      <a class="code" href="lspg_8c.html#a69a792e1981af00b2818bcda89bdaa02">lspg_preset_changed_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^Sample(Detected|Absent)$&quot;</span>,                 <a class="code" href="lspg_8c.html#a14546bac5695b536cd348d5e0a1661fa" title="log magnet state">lspg_sample_detector_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^Timer Update KVs$&quot;</span>,                        <a class="code" href="lspg_8c.html#ad503cefdaee8112ea2129d33db2ec7fa" title="Perhaps update the px.kvs table in postgresql Should be triggered by a timer event.">lspg_update_kvs_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^cam.zoom In Position$&quot;</span>,                    <a class="code" href="lspg_8c.html#af61ae1cf46d67e29dfc690b9a98b1b4d" title="Fix up xscale and yscale when zoom changes.">lspg_set_scale_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^Quitting Program$&quot;</span>,                        <a class="code" href="lspg_8c.html#a91e910f7ab9b340bea598b01450e9c6b" title="Prepare to exit the program in a couple of seconds.">lspg_quitting_cb</a>);</div>
<div class="line">  <a class="code" href="lstimer_8c.html#a7b3e725fbe1bb3cc9f8465941cf1e381" title="Create a timer.">lstimer_set_timer</a>(     <span class="stringliteral">&quot;Timer Update KVs&quot;</span>, -1, 0, 500000000);</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Make sure we own the airrights</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <a class="code" href="lspg_8c.html#aa4cad634cac645d0366acbb25cef7b96" title="do nothing until we get airrights">lspg_demandairrights_all</a>();</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span>( &amp;<a class="code" href="lspg_8c.html#a04eb0cda0d5e5afeae7c393b51689765" title="our worker thread">lspg_thread</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5d3cf153b086f5252f248d17db824917"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspg_seq_run_prep_all </td>
          <td>(</td>
          <td class="paramtype">long long&#160;</td>
          <td class="paramname"><em>skey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>kappa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>phi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>cx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>cy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>ax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>ay</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>az</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convinence function to call seq run prep. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">skey</td><td>px.shots key for this image </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">kappa</td><td>current kappa postion </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phi</td><td>current phi postition </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cx</td><td>current center table x </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cy</td><td>current center table y </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ax</td><td>current alignment table x </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ay</td><td>current alignment table y </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">az</td><td>current alignment table z </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01324">1324</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                             {</div>
<div class="line">  <span class="keywordtype">int</span> rtn;</div>
<div class="line">  <a class="code" href="lspg_8c.html#af7d6efd861b152a371442791deb42bd3" title="queue up the seq_run_prep query">lspg_seq_run_prep_call</a>( skey, <a class="code" href="lspmac_8c.html#a0be79ccb7ebf3a665248fd856112b9fd" title="Kappa.">kappa</a>, <a class="code" href="lspmac_8c.html#ac8070dc568ad974a3db42b51eca828cc" title="Phi (not data collection axis)">phi</a>, cx, cy, ax, ay, az);</div>
<div class="line">  <a class="code" href="lspg_8c.html#ac0b01f501322432a8fa37f31898c3499" title="Wait for seq run prep query to return.">lspg_seq_run_prep_wait</a>();</div>
<div class="line">  rtn = <a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#af7ff6fa6075cabb2bf51ce63afaeee25">query_error</a>;</div>
<div class="line">  <a class="code" href="lspg_8c.html#a472b09ddf716c80207f97e2bb5d37d66" title="Indicate we are done waiting.">lspg_seq_run_prep_done</a>();</div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af72c4b037347737df09348ab703f6802"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_starttransfer_call </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>nextsample</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sample_detected</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>ax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>ay</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>az</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>horz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>vert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>esttime</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00405">405</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                                                                                                                                       {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a47824bb2701a699d43a7a916e2010705" title="Our mutex.">mutex</a>));</div>
<div class="line">  <a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#ad3a6356e5ccce15c982ddecf9634999f" title="flag for our condition">new_value_ready</a> = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a5ef1d5a6708b3872761b86aef34d7aeb" title="1 if the query failed for any reason">query_error</a>     = 0;</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a47824bb2701a699d43a7a916e2010705" title="Our mutex.">mutex</a>));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#a289005bed571909f5ce4de2ff4e70e36">lspg_starttransfer_cb</a>, <a class="code" href="lspg_8c.html#aed6571a457cde0cd7c1ef1250d8f0a75">lspg_starttransfer_error_cb</a>,</div>
<div class="line">                   <span class="stringliteral">&quot;SELECT px.starttransfer( %d, %s, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f)&quot;</span>,</div>
<div class="line">                   nextsample, <a class="code" href="lspmac_8c.html#ac59ab990e48033a811aeb0281fb588fc" title="smart magnet detected sample">sample_detected</a> ? <span class="stringliteral">&quot;True&quot;</span> : <span class="stringliteral">&quot;False&quot;</span>, ax, ay, az, horz, vert, esttime);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad989179281d8b65b940250a4580007d0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_starttransfer_done </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00422">422</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                               {</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a47824bb2701a699d43a7a916e2010705" title="Our mutex.">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a189e9fd5cbc06dd09e5549f6e229fa5e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_starttransfer_wait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00416">416</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                               {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a47824bb2701a699d43a7a916e2010705" title="Our mutex.">mutex</a>));</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#ad3a6356e5ccce15c982ddecf9634999f" title="flag for our condition">new_value_ready</a> == 0 &amp;&amp; <a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a5ef1d5a6708b3872761b86aef34d7aeb" title="1 if the query failed for any reason">query_error</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;(<a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a1a569a2afabd7910219ff9d2d48c1b38" title="Our condition.">cond</a>), &amp;(<a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a47824bb2701a699d43a7a916e2010705" title="Our mutex.">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a68d367d98c780a95b2c347d09e9ddec3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspg_waitcryo_all </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>no need to get fancy with the wait cryo command It should not return until the robot is almost ready for air rights </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00655">655</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                        {</div>
<div class="line">  <span class="keywordtype">int</span> rtn;</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a62b50ead380fc8a6be35956eba384ba6" title="practice safe threading">mutex</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a97298b773fd8c1f2ef20159093a08246" title="OK, there is never a value, we need a variable for the conditional wait and this is what we call it e...">new_value_ready</a> = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a562f641a86142566aa67dc41f2676fb7" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a>     = 0;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#a7497a7c924b31c727ea487a3efb77fb6">lspg_waitcryo_cb</a>, <a class="code" href="lspg_8c.html#a21393baf18a3934474b40e0006d93d50">lspg_waitcryo_error_cb</a>, <span class="stringliteral">&quot;SELECT px.waitcryo()&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a97298b773fd8c1f2ef20159093a08246" title="OK, there is never a value, we need a variable for the conditional wait and this is what we call it e...">new_value_ready</a> == 0 &amp;&amp; <a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a562f641a86142566aa67dc41f2676fb7" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;<a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a54c275159d9f096e0d1884e64d099298" title="for signaling">cond</a>, &amp;<a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a62b50ead380fc8a6be35956eba384ba6" title="practice safe threading">mutex</a>);</div>
<div class="line"></div>
<div class="line">  rtn = <a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a562f641a86142566aa67dc41f2676fb7" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a>;</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a62b50ead380fc8a6be35956eba384ba6" title="practice safe threading">mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7497a7c924b31c727ea487a3efb77fb6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_waitcryo_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00638">638</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                                               {</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a62b50ead380fc8a6be35956eba384ba6" title="practice safe threading">mutex</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a97298b773fd8c1f2ef20159093a08246" title="OK, there is never a value, we need a variable for the conditional wait and this is what we call it e...">new_value_ready</a> = 1;</div>
<div class="line">  pthread_cond_signal( &amp;<a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a54c275159d9f096e0d1884e64d099298" title="for signaling">cond</a>);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a62b50ead380fc8a6be35956eba384ba6" title="practice safe threading">mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a95e3fd7c1685d7e6ab6d0a295ab42f78"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_zoom_lut_call </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a85f7a5e4d853b7a86ddde1006dd4dc1f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_abort </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>abort motion and try to recover </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02115">2115</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                    {</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Stop everything!  (consider ^O instead of ^A)</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <a class="code" href="lspmac_8c.html#a0575fc751cecf35ffe8b290ab483ac21" title="use dpram ascii interface to send a control character">lspmac_SockSendDPControlChar</a>( <span class="stringliteral">&quot;Abort Request&quot;</span>, 0x01);</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// and reset motion flag</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( <span class="stringliteral">&quot;Reset&quot;</span>, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;M5075=0&quot;</span>);</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a83ba40e81c04ecc11009be6cbed0c5e1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_est_move_time </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>est_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>mmaskp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp_1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>jog_1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>preset_1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>end_point_1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Move the motors and estimate the time it'll take to finish the job. </p>
<p>Returns the estimate time and the coordinate system mask to waite for </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">est_time</td><td>Returns number of seconds we estimate the move(s) will take </td></tr>
    <tr><td class="paramname">mmaskp</td><td>Mask of coordinate systems we are trying to move, excluding jogs. Used to wait for motions to complete </td></tr>
    <tr><td class="paramname">mp_1</td><td>Pointer to first motor </td></tr>
    <tr><td class="paramname">jog_1</td><td>1 to force a jog, 0 to try a motion program DO NOT MIX JOGS AND MOTION PROGRAMS IN THE SAME COORDINATE SYSTEM! </td></tr>
    <tr><td class="paramname">preset_1</td><td>Name of preset we'd like to move to or NULL if end_point_1 should be used instead </td></tr>
    <tr><td class="paramname">end_point_1</td><td>End point for the first motor. Ignored if preset_1 is non null and identifies a valid preset for this motor </td></tr>
    <tr><td class="paramname">...</td><td>Perhaps more quads of motors, jog flags, preset names, and end points. End is a NULL motor pointer MUST END ARG LIST WITH NULL </td></tr>
  </table>
  </dd>
</dl>
<p>&lt; units to counts</p>
<p>&lt; The total distance we need to go</p>
<p>&lt; Our maximum velocity</p>
<p>&lt; Our maximum acceleration</p>
<p>&lt; Total time for this motor</p>
<p>&lt; coordinate system motion flags </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02840">2840</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                                                                                                   {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">char</span> axes[] = <span class="stringliteral">&quot;XYZUVWABC&quot;</span>;</div>
<div class="line">  <span class="keywordtype">int</span> qs[9];</div>
<div class="line">  <a class="code" href="structlspmac__combined__move__struct.html">lspmac_combined_move_t</a> motions[32];</div>
<div class="line">  <span class="keywordtype">char</span> s[256];</div>
<div class="line">  <span class="keywordtype">int</span> foundone;</div>
<div class="line">  <span class="keywordtype">int</span> moving_flags;</div>
<div class="line">  <span class="keyword">struct </span>timespec timeout;</div>
<div class="line">  <span class="keywordtype">int</span> j;</div>
<div class="line">  va_list arg_ptr;</div>
<div class="line">  <a class="code" href="structlspmac__motor__struct.html" title="Motor information.">lspmac_motor_t</a> *mp;</div>
<div class="line">  <span class="keywordtype">double</span> ep, maybe_ep;</div>
<div class="line">  <span class="keywordtype">char</span> *ps;</div>
<div class="line">  <span class="keywordtype">double</span></div>
<div class="line">    min_pos,</div>
<div class="line">    max_pos,</div>
<div class="line">    neutral_pos,</div>
<div class="line">    u2c,                </div>
<div class="line">    D,                  </div>
<div class="line">    V,                  </div>
<div class="line">    A,                  </div>
<div class="line">    Tt;                 </div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line">  <span class="keywordtype">int</span> jog;</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">  uint32_t m5075;               </div>
<div class="line"></div>
<div class="line">  <span class="comment">// reset our coordinate flags and command strings</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;32; i++) {</div>
<div class="line">    motions[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>].<a class="code" href="structlspmac__combined__move__struct.html#a650f35e534bd22bdb45d5361f75eaae8">moveme</a> = 0;</div>
<div class="line">  }</div>
<div class="line">  m5075  = 0;</div>
<div class="line">  <span class="keywordflow">if</span>( mmaskp != NULL)</div>
<div class="line">    *mmaskp = 0;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Initialze first iteration</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  *est_time = 0.0;</div>
<div class="line">  mp  = mp_1;</div>
<div class="line">  ps  = preset_1;</div>
<div class="line">  ep  = end_point_1;</div>
<div class="line">  jog = jog_1;</div>
<div class="line"></div>
<div class="line">  va_start( arg_ptr, end_point_1);</div>
<div class="line">  <span class="keywordflow">while</span>( 1) {</div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     *    :                  |       Constant       |</span></div>
<div class="line"><span class="comment">     *    :                  |&lt;---   Velocity   ---&gt;|</span></div>
<div class="line"><span class="comment">     *    :                  |       Time (Ct)      |</span></div>
<div class="line"><span class="comment">     *  V :                   ----------------------              ---------</span></div>
<div class="line"><span class="comment">     *  e :                 /                        \               ^</span></div>
<div class="line"><span class="comment">     *  l :                /                          \              |</span></div>
<div class="line"><span class="comment">     *  o :               /                            \             |</span></div>
<div class="line"><span class="comment">     *  c :              /                              \            V</span></div>
<div class="line"><span class="comment">     *  i :             /                                \           |</span></div>
<div class="line"><span class="comment">     *  t :            /                                  \          |</span></div>
<div class="line"><span class="comment">     *  y :___________/....................................\_________v___________</span></div>
<div class="line"><span class="comment">     *                |      |         Time              </span></div>
<div class="line"><span class="comment">     *                |      |</span></div>
<div class="line"><span class="comment">     *             --&gt;|      |&lt;-- Acceleration Time  (At)</span></div>
<div class="line"><span class="comment">     *                |</span></div>
<div class="line"><span class="comment">     *                |&lt;-----    Total  Time (Tt)  -------&gt;|</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *      Assumption 1: We can replace S curve acceleration with linear acceleration</span></div>
<div class="line"><span class="comment">     *      for the purposes of distance and time calculations for the timeout</span></div>
<div class="line"><span class="comment">     *      period that we are attempting to calculate here.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *      Ct  = Constant Velocity Time.  The time spent at constant velocity.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *      At  = Acceleration Time.  Time spent accelerating at either end of the ramp, that is,</span></div>
<div class="line"><span class="comment">     *      1/2 the total time spent accelerating and decelerating.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *      D   = the total distance we need to travel</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *      V   = constant velocity.  Here we use the motor&#39;s maximum velocity.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *      A   = the motor acceleration, Here it&#39;s the maximum acceleration.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *      V = A * At   </span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *      or  At = V/A</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *      The Total Time (Tt) is</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *      Tt = Ct + 2 * At</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *      If we had infinite acceleration the total time would be D/V.  To account for finite acceleration we just need to</span></div>
<div class="line"><span class="comment">     *      adjust this for the average velocity while accelerating (0.5 V).  This neatly adds a single V/A term:</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *      (1)     Tt = D/V  + V/A</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *      When the distance is short, we need a different calculation:</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *      D = 0.5 * A * T1^2  + 0.5 * A * T2^2  (T1 = acceleration time and T2 = deceleration time)</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *      or, since total time  Tt = T1 + T2 and T1 = T2,</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *      D = A * (0.5*Tt)^2</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *      or</span></div>
<div class="line"><span class="comment">     *      </span></div>
<div class="line"><span class="comment">     *      (2)    Tt = 2 * sqrt( D/A)</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *      When we accelerate to the maximum speed the time it takes is V/A so the distance we travel (Da) is</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *      Da = 0.5 * A * (V/A)^2</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *      or</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *      Da = 0.5 * V^2 / A</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *      So when D &gt; 2 * Da, or</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *      D &gt; V^2 / A</span></div>
<div class="line"><span class="comment">     *         </span></div>
<div class="line"><span class="comment">     *      we need to use equation (1) otherwise we need to use equation (2)</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a3342670c97c0b2646409f2ef28f63d1c" title="magic number identifying this as a motor structure">magic</a> != <a class="code" href="pgpmac_8h.html#abe2a74d23400d8d8fe02dc407c242035">LSPMAC_MAGIC_NUMBER</a>) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_est_move_time: WARNING: bad motor structure.  Check that your motor list is NULL terminated.&quot;</span>);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">//lslogging_log_message( &quot;lspmac_est_move_time: find motor %s, jog %d, preset %s, endpoint %f&quot;,</span></div>
<div class="line">    <span class="comment">//mp-&gt;name, jog, ps == NULL ? &quot;NULL&quot; : ps, ep);</span></div>
<div class="line"></div>
<div class="line">    Tt = 0.0;</div>
<div class="line">    <span class="keywordflow">if</span>( mp != NULL &amp;&amp; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a69e49769a1001665377efc7193d88a0a" title="our maximum speed (cts/msec)">max_speed</a> != NULL &amp;&amp; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a50cf4c0711cea164e332bc34705a1a68" title="our maximum acceleration (cts/msec^2)">max_accel</a> != NULL &amp;&amp; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a8838915ebb6f9989944117c8197d5e86" title="conversion from counts to units: 0.0 means not loaded yet">u2c</a> != NULL) {</div>
<div class="line"></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// get the real endpoint if a preset was mentioned</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="keywordflow">if</span>( ps != NULL &amp;&amp; *ps != 0) {</div>
<div class="line">        err = <a class="code" href="lsredis_8c.html#a87d7bb0ade6f247edfbb7803aac9e694" title="Get the value of the given preset and return it in dval Returns 0 on error, non-zero on success;...">lsredis_find_preset</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, ps, &amp;maybe_ep);</div>
<div class="line">        <span class="keywordflow">if</span>( err != 0)</div>
<div class="line">          ep = maybe_ep;</div>
<div class="line">      }</div>
<div class="line"></div>
<div class="line">      u2c = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a8838915ebb6f9989944117c8197d5e86" title="conversion from counts to units: 0.0 means not loaded yet">u2c</a>);</div>
<div class="line"></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// For look up tables user units are (or should be) counts and u2c should be 1</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a> &gt; 0 &amp;&amp; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a> != NULL) {</div>
<div class="line">        u2c = 1.0;</div>
<div class="line">        D = <a class="code" href="lspmac_8c.html#a55b882be15d56a2a777f2b1f92901b7d" title="Look up table support for motor positions (think x=zoom, y=light intensity) use a lookup table to fin...">lspmac_lut</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>, ep) - <a class="code" href="lspmac_8c.html#a55b882be15d56a2a777f2b1f92901b7d" title="Look up table support for motor positions (think x=zoom, y=light intensity) use a lookup table to fin...">lspmac_lut</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>, <a class="code" href="lspmac_8c.html#acc46bdddee59bd8c5ad662b3fd445e9f" title="get the motor position (with locking)">lspmac_getPosition</a>( mp));</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        D = ep - <a class="code" href="lspmac_8c.html#acc46bdddee59bd8c5ad662b3fd445e9f" title="get the motor position (with locking)">lspmac_getPosition</a>( mp);                               <span class="comment">// User units</span></div>
<div class="line">      }</div>
<div class="line"></div>
<div class="line">      V = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a69e49769a1001665377efc7193d88a0a" title="our maximum speed (cts/msec)">max_speed</a>) / u2c * 1000.;           <span class="comment">// User units per second</span></div>
<div class="line">      A = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a50cf4c0711cea164e332bc34705a1a68" title="our maximum acceleration (cts/msec^2)">max_accel</a>) / u2c * 1000. * 1000;    <span class="comment">// User units per second per second</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">      neutral_pos = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae931e9bc9fc2fa82ca649334fc052fbe" title="zero offset">neutral_pos</a>);</div>
<div class="line">      min_pos     = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7c1f2f67c64d26b12d6bb0d681797d8d" title="our minimum position (soft limit)">min_pos</a>) - neutral_pos;</div>
<div class="line">      max_pos     = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aac8c31a857910cdcbb409331e128e766" title="our maximum position (soft limit)">max_pos</a>) - neutral_pos;</div>
<div class="line"></div>
<div class="line">      <span class="keywordflow">if</span>( ep &lt; min_pos || ep &gt; max_pos) {</div>
<div class="line">        <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_est_move_time: Motor %s Requested position %f out of range: min=%f, max=%f&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, ep, min_pos, max_pos);</div>
<div class="line">        <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s Move Aborted&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">      }</div>
<div class="line"></div>
<div class="line">      mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8cdc94c6e2478b12ce942d4cf1d7499" title="The position as requested by the user.">requested_position</a> = ep;</div>
<div class="line">      mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a> = u2c * (mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8cdc94c6e2478b12ce942d4cf1d7499" title="The position as requested by the user.">requested_position</a> + neutral_pos);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Don&#39;t bother with motors without velocity or acceleration defined</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="keywordflow">if</span>( V &gt; 0.0 &amp;&amp; A &gt; 0.0) {</div>
<div class="line">        <span class="keywordflow">if</span>( fabs(D) &gt; V*V/A) {</div>
<div class="line">          <span class="comment">//</span></div>
<div class="line">          <span class="comment">// Normal ramp up, constant velocity, and ramp down</span></div>
<div class="line">          <span class="comment">//</span></div>
<div class="line">          Tt = fabs(D)/V + V/A;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">          <span class="comment">//</span></div>
<div class="line">          <span class="comment">// Never reach constantant velocity, just ramp up a bit and back down</span></div>
<div class="line">          <span class="comment">//</span></div>
<div class="line">          Tt = 2.0 * sqrt( fabs(D)/A);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_est_move_time: Motor: %s  D: %f  VV/A: %f  Tt: %f&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, D, V*V/A, Tt);</div>
<div class="line">      }  <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// TODO: insert move time based for DAC or BO motor like objects;</span></div>
<div class="line">        <span class="comment">// For now assume 100 msec;</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        Tt = 0.1;</div>
<div class="line">      }</div>
<div class="line"></div>
<div class="line">      <span class="comment">// Perhaps flag a coordinate system</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// We can move a motor that&#39;s not in a coordinate system but we cannot move a motor that is but does not</span></div>
<div class="line">      <span class="comment">// have an axis defined if we are also moving one that does.  It&#39;s a limitation, I guess.</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="keywordflow">if</span>( jog != 1 &amp;&amp;</div>
<div class="line">          mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a5614e003272e8323f8809bf7b6559532" title="coordinate system this motor belongs to (0 if none)">coord_num</a> != NULL &amp;&amp; <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a5614e003272e8323f8809bf7b6559532" title="coordinate system this motor belongs to (0 if none)">coord_num</a>) &gt; 0 &amp;&amp; <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a5614e003272e8323f8809bf7b6559532" title="coordinate system this motor belongs to (0 if none)">coord_num</a>) &lt;= 16 &amp;&amp;</div>
<div class="line">          mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ad6a51cca3c7e5f79168e5c33fd9e736b" title="pmac motor number">motor_num</a> != NULL &amp;&amp; <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ad6a51cca3c7e5f79168e5c33fd9e736b" title="pmac motor number">motor_num</a>) &gt; 0 &amp;&amp; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7437ef16c2dce65bde4dda1ea00e9df3" title="the axis (X, Y, Z, etc) or null if not in a coordinate system">axis</a> != NULL &amp;&amp; <a class="code" href="lsredis_8c.html#a0b7600b1c9a4550b32d4be019d25f941">lsredis_getc</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7437ef16c2dce65bde4dda1ea00e9df3" title="the axis (X, Y, Z, etc) or null if not in a coordinate system">axis</a>) != 0) {</div>
<div class="line">        <span class="keywordtype">int</span> axis;</div>
<div class="line">        <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#a292515b2acabb0dcade5b16584cdb011">motor_num</a>;</div>
<div class="line"></div>
<div class="line">        motor_num = <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ad6a51cca3c7e5f79168e5c33fd9e736b" title="pmac motor number">motor_num</a>);</div>
<div class="line"></div>
<div class="line">        axis = <a class="code" href="lsredis_8c.html#a0b7600b1c9a4550b32d4be019d25f941">lsredis_getc</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7437ef16c2dce65bde4dda1ea00e9df3" title="the axis (X, Y, Z, etc) or null if not in a coordinate system">axis</a>);</div>
<div class="line">        <span class="keywordflow">for</span>( j=0; j&lt;<span class="keyword">sizeof</span>(axes); j++) {</div>
<div class="line">          <span class="keywordflow">if</span>( axis == axes[j])</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>( j &lt; <span class="keyword">sizeof</span>( axes)) {</div>
<div class="line">          <span class="comment">//</span></div>
<div class="line">          <span class="comment">// Store the motion request for a normal PMAC motor</span></div>
<div class="line">          <span class="comment">//</span></div>
<div class="line">          <span class="keywordtype">int</span> cn;</div>
<div class="line">          <span class="keywordtype">int</span> in_position_band;</div>
<div class="line"></div>
<div class="line">          cn = <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a5614e003272e8323f8809bf7b6559532" title="coordinate system this motor belongs to (0 if none)">coord_num</a>);</div>
<div class="line">          in_position_band = <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a48de72c2442bd5aa9420fcfe6b4f265f" title="moves within this amount are ignored UNITS ARE 1/16 COUNT">in_position_band</a>);</div>
<div class="line"></div>
<div class="line">          motions[motor_num - 1].<a class="code" href="structlspmac__combined__move__struct.html#a2ae011832de3009f7a08b3081b51b7a3">coord_num</a> = cn;</div>
<div class="line">          motions[motor_num - 1].<a class="code" href="structlspmac__combined__move__struct.html#afedb95467295e8a6aa535974f5ad6300">axis</a>      = j;</div>
<div class="line">          motions[motor_num - 1].<a class="code" href="structlspmac__combined__move__struct.html#a5389f07fcf2b24b0e912aefb4141001d">Delta</a>     = D * u2c;</div>
<div class="line">          <span class="comment">//</span></div>
<div class="line">          <span class="comment">// Don&#39;t ask to run a motion program if we are already where we want to be</span></div>
<div class="line">          <span class="comment">//</span></div>
<div class="line">          <span class="comment">// Deadband is 10 counts except for zoom which is 100.</span></div>
<div class="line">          <span class="comment">// We use Ixx28 In-Position Band which has units of 1/16 count</span></div>
<div class="line">          <span class="comment">//</span></div>
<div class="line">          <span class="comment">//</span></div>
<div class="line">          <span class="keywordflow">if</span>( abs(motions[motor_num - 1].Delta)*16 &gt;= in_position_band) {</div>
<div class="line">            m5075 |= (1 &lt;&lt; (cn - 1));</div>
<div class="line">            motions[motor_num - 1].<a class="code" href="structlspmac__combined__move__struct.html#a650f35e534bd22bdb45d5361f75eaae8">moveme</a>    = 1;</div>
<div class="line">          }       </div>
<div class="line">          <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_est_move_time: moveme=%d  motor &#39;%s&#39; motions index=%d coord_num=%d axis=%d Delta=%d   m5075=%u&quot;</span>,</div>
<div class="line">                                 motions[motor_num-1].moveme,  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, motor_num -1, motions[motor_num-1].<a class="code" href="structlspmac__combined__move__struct.html#a2ae011832de3009f7a08b3081b51b7a3">coord_num</a>, motions[motor_num-1].<a class="code" href="structlspmac__combined__move__struct.html#afedb95467295e8a6aa535974f5ad6300">axis</a>, motions[motor_num-1].<a class="code" href="structlspmac__combined__move__struct.html#a5389f07fcf2b24b0e912aefb4141001d">Delta</a>,</div>
<div class="line">                                 m5075);</div>
<div class="line">        }</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// Here we are dealing with a DAC or BO motor or just want to jog.</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a86380d221e4b17eb8cf87a5ac656b669" title="function to move the motor">jogAbs</a>( mp, ep)) {</div>
<div class="line">          <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_est_move_time: motor %s failed to queue move of distance %f from %f&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, D, <a class="code" href="lspmac_8c.html#acc46bdddee59bd8c5ad662b3fd445e9f" title="get the motor position (with locking)">lspmac_getPosition</a>(mp));</div>
<div class="line">          <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;Move Aborted&quot;</span>);</div>
<div class="line">          <span class="keywordflow">return</span> 1;</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Update the estimated time</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      *est_time = *est_time &lt; Tt ? Tt : *est_time;</div>
<div class="line">      </div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_est_move_time: est_time=%f&quot;</span>, *est_time);</div>
<div class="line"></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    mp = va_arg( arg_ptr, <a class="code" href="structlspmac__motor__struct.html" title="Motor information.">lspmac_motor_t</a> *);</div>
<div class="line">    <span class="keywordflow">if</span>( mp == NULL)</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    jog = va_arg( arg_ptr, <span class="keywordtype">int</span>);</div>
<div class="line">    ps  = va_arg( arg_ptr, <span class="keywordtype">char</span> *);</div>
<div class="line">    ep  = va_arg( arg_ptr, <span class="keywordtype">double</span>);</div>
<div class="line"></div>
<div class="line">  }</div>
<div class="line">  va_end( arg_ptr);</div>
<div class="line"></div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Set the motion program flags</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( m5075 != 0) {</div>
<div class="line">    <span class="keywordflow">if</span>( mmaskp != NULL)</div>
<div class="line">      *mmaskp |= m5075; <span class="comment">// Tell the caller about our new mask</span></div>
<div class="line"></div>
<div class="line">    </div>
<div class="line">    pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>);</div>
<div class="line">    moving_flags = <a class="code" href="lspmac_8c.html#a7a32c617c183166308241e270959df56" title="Flag used to implement motor moving condition.">lspmac_moving_flags</a>;</div>
<div class="line">    pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( (moving_flags &amp; m5075) != m5075) {</div>
<div class="line">      <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( NULL, <span class="stringliteral">&quot;M5075=(M5075 | %d)&quot;</span>, m5075);</div>
<div class="line">    </div>
<div class="line"></div>
<div class="line">      pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>);</div>
<div class="line">      clock_gettime( CLOCK_REALTIME, &amp;timeout);</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      timeout.tv_sec += 2;      <span class="comment">// 2 seconds should be more than enough time to set the flags</span></div>
<div class="line">      err = 0;</div>
<div class="line">      <span class="keywordflow">while</span>( err == 0 &amp;&amp; ((<a class="code" href="lspmac_8c.html#a7a32c617c183166308241e270959df56" title="Flag used to implement motor moving condition.">lspmac_moving_flags</a> &amp; m5075) != m5075))</div>
<div class="line">        err = pthread_cond_timedwait( &amp;<a class="code" href="lspmac_8c.html#a57547d211906c981ef20257eba99f8df" title="Wait for motor(s) to finish moving condition.">lspmac_moving_cond</a>, &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>, &amp;timeout);</div>
<div class="line">      moving_flags = <a class="code" href="lspmac_8c.html#a7a32c617c183166308241e270959df56" title="Flag used to implement motor moving condition.">lspmac_moving_flags</a>;</div>
<div class="line">      pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>);</div>
<div class="line">    </div>
<div class="line">      <span class="keywordflow">if</span>( ((moving_flags &amp; m5075) != m5075) &amp;&amp; err == ETIMEDOUT) {</div>
<div class="line">        <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_est_move_time: Timed out waiting for moving flags.  lspmac_moving_flags = 0x%0x, looking for 0x%0x  test exp: 0x%0x  test: %d&quot;</span>,</div>
<div class="line">                               moving_flags, m5075, (moving_flags &amp; m5075), (moving_flags &amp; m5075) != m5075);</div>
<div class="line">        <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;Combined Move Aborted&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span>( i=1; i&lt;=16; i++) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Loop over coordinate systems</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    foundone = 0;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">for</span>( j=0; j&lt;9; j++)</div>
<div class="line">      qs[j] = 0;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">for</span>( j=0; j&lt;31; j++) {</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Loop over motors</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="keywordflow">if</span>( motions[j].moveme &amp;&amp; motions[j].coord_num == i) {</div>
<div class="line">        <span class="keywordflow">if</span>( abs(motions[j].Delta) &gt; 0) {</div>
<div class="line">          qs[(int)(motions[j].axis)] = motions[j].<a class="code" href="structlspmac__combined__move__struct.html#a5389f07fcf2b24b0e912aefb4141001d">Delta</a>;</div>
<div class="line">          foundone=1;</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span>( foundone) {</div>
<div class="line">      sprintf( s, <span class="stringliteral">&quot;&amp;%d Q40=%d Q41=%d Q42=%d Q43=%d Q44=%d Q45=%d Q46=%d Q47=%d Q48=%d Q49=%.1f Q100=%d B180R&quot;</span>,</div>
<div class="line">               i, qs[0], qs[1], qs[2], qs[3], qs[4], qs[5], qs[6], qs[7], qs[8], *est_time * 1000., 1 &lt;&lt; (i-1));</div>
<div class="line">      </div>
<div class="line">      <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( NULL, s);</div>
<div class="line">      </div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a570b4a359adc4da4ab80d53506d06963"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_est_move_time_wait </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>move_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>cmask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp_1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>wait for motion to stop returns non-zero if the wait timed out </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">move_time</td><td>The time out in seconds </td></tr>
    <tr><td class="paramname">cmask</td><td>A coordinate system mask to wait for </td></tr>
    <tr><td class="paramname">mp_1</td><td>NULL terminated list of individual motors to wait for</td></tr>
  </table>
  </dd>
</dl>
<p>Both values are returned from lspmac_est_move_time </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l03195">3195</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                                                       {</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line">  <span class="keywordtype">double</span> isecs, fsecs;</div>
<div class="line">  <span class="keyword">struct </span>timespec timeout;</div>
<div class="line">  va_list arg_ptr;</div>
<div class="line">  <a class="code" href="structlspmac__motor__struct.html" title="Motor information.">lspmac_motor_t</a> *mp;</div>
<div class="line"></div>
<div class="line">  clock_gettime( CLOCK_REALTIME, &amp;timeout);</div>
<div class="line">  fsecs = modf( move_time, &amp;isecs);</div>
<div class="line">  timeout.tv_sec  += (long)floor(isecs);</div>
<div class="line">  timeout.tv_nsec += (long)floor(fsecs * 1.e9);</div>
<div class="line">  timeout.tv_sec  += timeout.tv_nsec / 1000000000;</div>
<div class="line">  timeout.tv_nsec %= 1000000000;</div>
<div class="line"></div>
<div class="line">  err = 0;</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>);</div>
<div class="line">  <span class="keywordflow">while</span>( err == 0 &amp;&amp; (<a class="code" href="lspmac_8c.html#a7a32c617c183166308241e270959df56" title="Flag used to implement motor moving condition.">lspmac_moving_flags</a> &amp; cmask) != 0)</div>
<div class="line">    err = pthread_cond_timedwait( &amp;<a class="code" href="lspmac_8c.html#a57547d211906c981ef20257eba99f8df" title="Wait for motor(s) to finish moving condition.">lspmac_moving_cond</a>, &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>, &amp;timeout);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( err != 0) {</div>
<div class="line">    <span class="keywordflow">if</span>( err == ETIMEDOUT) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lstest_lspmac_est_move_time_wait: timed out waiting %f seconds, cmask = 0x%0x&quot;</span>, move_time, cmask);</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a85f7a5e4d853b7a86ddde1006dd4dc1f" title="abort motion and try to recover">lspmac_abort</a>();</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  va_start( arg_ptr, mp_1);</div>
<div class="line">  <span class="keywordflow">for</span>( mp = mp_1; mp != NULL; mp = va_arg( arg_ptr, <a class="code" href="structlspmac__motor__struct.html" title="Motor information.">lspmac_motor_t</a> *)) {</div>
<div class="line">    <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a3342670c97c0b2646409f2ef28f63d1c" title="magic number identifying this as a motor structure">magic</a> != <a class="code" href="pgpmac_8h.html#abe2a74d23400d8d8fe02dc407c242035">LSPMAC_MAGIC_NUMBER</a>) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_est_move_time_wait: WARNING: motor list must be NULL terminated.  Check your call to lspmac_est_move_time_wait.&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#a55ffe2b135854f75079ecd39d507d3b4" title="Wait for motor to finish moving.">lspmac_moveabs_wait</a>( mp, move_time)) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_est_move_time_wait: timed out waiting %f seconds for motor %s&quot;</span>, move_time, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  va_end( arg_ptr);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a22ef36819bdee963712691e660cfc101"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* lspmac_find_motor_by_name </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l04353">4353</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                       {</div>
<div class="line">  <a class="code" href="structlspmac__motor__struct.html" title="Motor information.">lspmac_motor_t</a> *rtn;</div>
<div class="line">  ENTRY entry_in, *entry_outp;</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line">  </div>
<div class="line">  entry_in.key  = name;</div>
<div class="line">  entry_in.data = NULL;</div>
<div class="line">  err = hsearch_r( entry_in, FIND, &amp;entry_outp, &amp;<a class="code" href="lspmac_8c.html#af12c92fd31b325808127fcd14bb1b329" title="A hash table to find motors by name.">motors_ht</a>);</div>
<div class="line">  <span class="keywordflow">if</span>( err == 0) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_find_motor_by_name: hsearch_r failed for motor &#39;%s&#39;: %s&quot;</span>, name, strerror( errno));</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }    </div>
<div class="line">  rtn = entry_outp-&gt;data;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac4bf3a54deeaeb6e93dc3183388ad104"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_getBIPosition </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a> *&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>get binary input value </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01649">1649</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                            {</div>
<div class="line">  <span class="keywordtype">int</span> rtn;</div>
<div class="line">  pthread_mutex_lock( &amp;bip-&gt;mutex);</div>
<div class="line">  rtn = bip-&gt;position;</div>
<div class="line">  pthread_mutex_unlock( &amp;bip-&gt;mutex);</div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6a1b639686b771c1213b6e23716a7898"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double lspmac_getPosition </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>get the motor position (with locking) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mp</td><td>the motor object </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01402">1402</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                               {</div>
<div class="line">  <span class="keywordtype">double</span> rtn;</div>
<div class="line">  pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  rtn = mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a>;</div>
<div class="line">  pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9fbadf816a842c8f131cf8ee47b54e29"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_home1_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Home the motor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>motor we are concerned about </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01272">1272</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#a292515b2acabb0dcade5b16584cdb011">motor_num</a>;</div>
<div class="line">  <span class="keywordtype">int</span> coord_num;</div>
<div class="line">  <span class="keywordtype">char</span> **home;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  motor_num = <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ad6a51cca3c7e5f79168e5c33fd9e736b" title="pmac motor number">motor_num</a>);</div>
<div class="line">  coord_num = <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a5614e003272e8323f8809bf7b6559532" title="coordinate system this motor belongs to (0 if none)">coord_num</a>);</div>
<div class="line">  home      = <a class="code" href="lsredis_8c.html#abe31d0e11c41b2235307612c963bb652">lsredis_get_string_array</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6dc1ceab86687f741d4c4a574501959c" title="pmac commands to home motor">home</a>);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Each of the motors should have this defined</span></div>
<div class="line">  <span class="comment">// but let&#39;s not seg fault if home is missing</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( home == NULL || *home == NULL) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Note we are already initialized</span></div>
<div class="line">    <span class="comment">// so if we are here there is something wrong.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_home1_queue: null or empty home strings for motor %s&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">    pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// We&#39;ve already been called.  Don&#39;t home again until</span></div>
<div class="line">  <span class="comment">// we&#39;re finish with the last time.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa74108855693f94fc2ff76333c9fb6ac" title="Homing routine started.">homing</a>) {</div>
<div class="line">    pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }    </div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Don&#39;t go on if any other motors in this coordinate system are homing.</span></div>
<div class="line">  <span class="comment">// It&#39;s possible to write the homing program to home all the motors in the coordinate</span></div>
<div class="line">  <span class="comment">// system.  TODO  (hint hint)</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( coord_num &gt; 0) {</div>
<div class="line">    <span class="keywordflow">for</span>( i=0; i&lt;<a class="code" href="lspmac_8c.html#a56260f012c50a591ee7f97e500f16994" title="The number of motors we manage.">lspmac_nmotors</a>; i++) {</div>
<div class="line">      <span class="keywordflow">if</span>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[i]) == mp)</div>
<div class="line">        <span class="keywordflow">continue</span>;</div>
<div class="line">      <span class="keywordflow">if</span>( <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[i].coord_num) == coord_num) {</div>
<div class="line">        <span class="keywordtype">int</span> nogo;</div>
<div class="line">        nogo = 0;</div>
<div class="line">        pthread_mutex_lock( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[i].mutex));</div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">//  Don&#39;t go on if</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">//    we are homing         or      ( not in position                while     in open loop)</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[i].homing || (((<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[i].status2 &amp; 0x01)==0) &amp;&amp; ((<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[i].status1 &amp; 0x040000) != 0)))</div>
<div class="line">          nogo = 1;</div>
<div class="line">        pthread_mutex_unlock( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[i].mutex));</div>
<div class="line">        <span class="keywordflow">if</span>( nogo) {</div>
<div class="line">          pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">          <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa74108855693f94fc2ff76333c9fb6ac" title="Homing routine started.">homing</a>   = 1;</div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a> = 1;     <span class="comment">// set up waiting for cond</span></div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a68c471836f52707fa8582f7860cf500f" title="set to 1 when motion has been verified to have started">motion_seen</a> = 0;</div>
<div class="line">  <span class="comment">// This opens the control loop.</span></div>
<div class="line">  <span class="comment">// The status routine should notice this and the fact that</span></div>
<div class="line">  <span class="comment">// the homing flag is set and call on the home2 routine</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Only send the open loop command if we are not in</span></div>
<div class="line">  <span class="comment">// open loop mode already.  This test might prevent a race condition</span></div>
<div class="line">  <span class="comment">// where we&#39;ve already moved the home2 routine (and queue the homing program motion)</span></div>
<div class="line">  <span class="comment">// before the open loop command is dequeued and acted on.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( ~(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#acb52b612b9237e8eec0b97fb1e76a35d" title="local copy of status1">status1</a>) &amp; 0x040000) {</div>
<div class="line">    <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, <span class="stringliteral">&quot;#%d$*&quot;</span>, motor_num);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s Homing&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a43e54631dc8de372854ebbb63ff28f70"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_home2_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Second stage of homing. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>motor we are concerned about </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01360">1360</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">char</span> **spp;</div>
<div class="line">  <span class="keywordtype">char</span> **home;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// At this point we are in open loop.</span></div>
<div class="line">  <span class="comment">// Run the motor specific commands</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  home = <a class="code" href="lsredis_8c.html#abe31d0e11c41b2235307612c963bb652">lsredis_get_string_array</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6dc1ceab86687f741d4c4a574501959c" title="pmac commands to home motor">home</a>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// We don&#39;t have any motors that have a null home text array so </span></div>
<div class="line">  <span class="comment">// there is currently no need to worry about this case other than</span></div>
<div class="line">  <span class="comment">// not to seg fault</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Also, Only go on if the first homing phase has been started</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( home == NULL || mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa74108855693f94fc2ff76333c9fb6ac" title="Homing routine started.">homing</a> != 1) {</div>
<div class="line">    pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span>( spp = home; *spp != NULL; spp++) {</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;home2 is queuing &#39;%s&#39;\n&quot;</span>, *spp);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, *spp);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa74108855693f94fc2ff76333c9fb6ac" title="Homing routine started.">homing</a> = 2;</div>
<div class="line">  pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae3e30b0ba9b5d5a291fa29b77ba920d8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_init </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize this module. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l03843">3843</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                   {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> first_time = 1;</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line">  ENTRY entry_in, *entry_outp;</div>
<div class="line">  <a class="code" href="structmd2StatusStruct.html" title="The block of memory retrieved in a status request.">md2_status_t</a> *<a class="code" href="namespacemk__pgpmac__redis.html#a11daf2847f2dc94562b5b61b3f412574">p</a>;</div>
<div class="line">  pthread_mutexattr_t <a class="code" href="lsredis_8c.html#a71c9f418904364d65c22d786f4dc5d39">mutex_initializer</a>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( first_time) {</div>
<div class="line">    <span class="comment">// Set our global harvest flags</span></div>
<div class="line">    <a class="code" href="lspmac_8c.html#a07b7b8254772075e6a4ced500b589c36" title="flag set at initialization to send i vars to db">getivars</a> = ivarsflag;</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a50e9c0a06654fd81b3446a6e54ff12c3" title="flag set at initialization to send m vars to db">getmvars</a> = mvarsflag;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Use recursive mutexs</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    pthread_mutexattr_init( &amp;mutex_initializer);</div>
<div class="line">    pthread_mutexattr_settype( &amp;mutex_initializer, PTHREAD_MUTEX_RECURSIVE);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// All important status mutex</span></div>
<div class="line">    pthread_mutex_init( &amp;<a class="code" href="lspmac_8c.html#a7a3e763682bd7f987d07f149e94b3bf8" title="Synchronize reading/writting status buffer.">md2_status_mutex</a>, &amp;mutex_initializer);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Initialize the motor objects</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">    p = &amp;<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lspmac_8c.html#a8237e646ce032a840637a4ef7bff49b9" title="MD2 omega axis (the air bearing)">omega</a>  = <a class="code" href="lspmac_8c.html#a38a28b74c706dcdbee2a5968e2c1f539" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[ 0]), 0, 0, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a6ce303bec89082cae1e9b1fddf6b6c10">omega_act_pos</a>,     &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#af6cf3cd65b9ef205685a0d970f168907">omega_status_1</a>,     &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a8577c9df7b663b548b2759ac3db721cd">omega_status_2</a>,     <span class="stringliteral">&quot;Omega   #1 &amp;1 X&quot;</span>, <span class="stringliteral">&quot;omega&quot;</span>,       <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>, <a class="code" href="lspmac_8c.html#a51216d824b3693de350f3be1ab30a7e0" title="Use jog to move motor to requested position.">lspmac_jogabs_queue</a>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a6cb218bdccfe5a93471c161f15a15cab" title="Alignment stage X.">alignx</a> = <a class="code" href="lspmac_8c.html#a38a28b74c706dcdbee2a5968e2c1f539" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[ 1]), 0, 1, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a9653a75bc0b66c5f86d8b0206dc39b4f">alignx_act_pos</a>,    &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a56accf8cb00c59bff87ed75df7dafbbe">alignx_status_1</a>,    &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a2feb35ceab8129fd2cc34d1104af8b8f">alignx_status_2</a>,    <span class="stringliteral">&quot;Align X #2 &amp;3 X&quot;</span>, <span class="stringliteral">&quot;align.x&quot;</span>,     <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>, <a class="code" href="lspmac_8c.html#a51216d824b3693de350f3be1ab30a7e0" title="Use jog to move motor to requested position.">lspmac_jogabs_queue</a>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a737c246c3948e644a18d191a931e1acd" title="Alignment stage Y.">aligny</a> = <a class="code" href="lspmac_8c.html#a38a28b74c706dcdbee2a5968e2c1f539" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[ 2]), 0, 2, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a0d40a01d2aa93c443526e826440f77fc">aligny_act_pos</a>,    &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a2f2a11fe2fc7a446323def2be465185a">aligny_status_1</a>,    &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a1f98d8b9831e32d77129f9b0f1d7d255">aligny_status_2</a>,    <span class="stringliteral">&quot;Align Y #3 &amp;3 Y&quot;</span>, <span class="stringliteral">&quot;align.y&quot;</span>,     <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>, <a class="code" href="lspmac_8c.html#a51216d824b3693de350f3be1ab30a7e0" title="Use jog to move motor to requested position.">lspmac_jogabs_queue</a>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ae7642b1da0f7c7f8448104c691d40a12" title="Alignment stage X.">alignz</a> = <a class="code" href="lspmac_8c.html#a38a28b74c706dcdbee2a5968e2c1f539" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[ 3]), 0, 3, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a480f892fe91b05b2980fb00064807e2b">alignz_act_pos</a>,    &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#aadbfac5709de57e449a37e2937d6ade7">alignz_status_1</a>,    &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ac378da16eeaab2bc47f3f8f88f7411ed">alignz_status_2</a>,    <span class="stringliteral">&quot;Align Z #4 &amp;3 Z&quot;</span>, <span class="stringliteral">&quot;align.z&quot;</span>,     <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>, <a class="code" href="lspmac_8c.html#a51216d824b3693de350f3be1ab30a7e0" title="Use jog to move motor to requested position.">lspmac_jogabs_queue</a>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#aa90d2363b744acbd4d45133b7a716d8f" title="Polaroid analyzer motor.">anal</a>   = <a class="code" href="lspmac_8c.html#a38a28b74c706dcdbee2a5968e2c1f539" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[ 4]), 0, 4, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a49d1151b0e819646587be0ca9c9d612a">analyzer_act_pos</a>,  &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ab876b484f55bcce576fcd89dcc3f7267">analyzer_status_1</a>,  &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a4f88bb778e4e18f1fbf7672ac11e7433">analyzer_status_2</a>,  <span class="stringliteral">&quot;Anal    #5&quot;</span>,      <span class="stringliteral">&quot;lightPolar&quot;</span>,  <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>, <a class="code" href="lspmac_8c.html#a51216d824b3693de350f3be1ab30a7e0" title="Use jog to move motor to requested position.">lspmac_jogabs_queue</a>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ad53a42cfaa04eff0336a44c8c9986333" title="Optical zoom.">zoom</a>   = <a class="code" href="lspmac_8c.html#a38a28b74c706dcdbee2a5968e2c1f539" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[ 5]), 1, 0, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a920b80e9f5f08aedac3ad541d5ffc8ae">zoom_act_pos</a>,      &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#af28e978b761dc07eefed3971547cfd4d">zoom_status_1</a>,      &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a34e4200315a083deb8a970e21bbbe277">zoom_status_2</a>,      <span class="stringliteral">&quot;Zoom    #6 &amp;4 Z&quot;</span>, <span class="stringliteral">&quot;cam.zoom&quot;</span>,    <a class="code" href="lspmac_8c.html#a82cf6576d41c31fce48a59db2d22188b" title="Move method for the zoom motor.">lspmac_movezoom_queue</a>, <a class="code" href="lspmac_8c.html#a82cf6576d41c31fce48a59db2d22188b" title="Move method for the zoom motor.">lspmac_movezoom_queue</a>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a139200ddaa9856a7ffcec0e6cbaa8f1b" title="Aperture Y.">apery</a>  = <a class="code" href="lspmac_8c.html#a38a28b74c706dcdbee2a5968e2c1f539" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[ 6]), 1, 1, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a2a434d2b57dbb669de0765486a1516ff">aperturey_act_pos</a>, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a2ef953eaddf7058bf4276585e6ff066b">aperturey_status_1</a>, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a0a7738f13a0fa80626cafc2299b104b4">aperturey_status_2</a>, <span class="stringliteral">&quot;Aper Y  #7 &amp;5 Y&quot;</span>, <span class="stringliteral">&quot;appy&quot;</span>,        <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>, <a class="code" href="lspmac_8c.html#a51216d824b3693de350f3be1ab30a7e0" title="Use jog to move motor to requested position.">lspmac_jogabs_queue</a>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ab93bd6ee850b285ca3a95e64d15e9477" title="Aperture Z.">aperz</a>  = <a class="code" href="lspmac_8c.html#a38a28b74c706dcdbee2a5968e2c1f539" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[ 7]), 1, 2, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a62d584ce23cfd9aa626d3c03649b455c">aperturez_act_pos</a>, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a27880dd795e1ba4fea4870c64ee3aa84">aperturez_status_1</a>, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ae407a99e428d9f4a7444a02c8bc3414e">aperturez_status_2</a>, <span class="stringliteral">&quot;Aper Z  #8 &amp;5 Z&quot;</span>, <span class="stringliteral">&quot;appz&quot;</span>,        <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>, <a class="code" href="lspmac_8c.html#a51216d824b3693de350f3be1ab30a7e0" title="Use jog to move motor to requested position.">lspmac_jogabs_queue</a>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a51358daaea8b5236f08414877d8af6c2" title="Capillary Y.">capy</a>   = <a class="code" href="lspmac_8c.html#a38a28b74c706dcdbee2a5968e2c1f539" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[ 8]), 1, 3, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ae25122a6db146501b51609b9cb59b044">capy_act_pos</a>,      &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a7f4e945e80b1980b9e69366a69ad79cc">capy_status_1</a>,      &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a5d7c10d9a16ebcc53ac4a0770ab2ef62">capy_status_2</a>,      <span class="stringliteral">&quot;Cap Y   #9 &amp;5 U&quot;</span>, <span class="stringliteral">&quot;capy&quot;</span>,        <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>, <a class="code" href="lspmac_8c.html#a51216d824b3693de350f3be1ab30a7e0" title="Use jog to move motor to requested position.">lspmac_jogabs_queue</a>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#aa45f268d0af9f3d465acfab128919718" title="Capillary Z.">capz</a>   = <a class="code" href="lspmac_8c.html#a38a28b74c706dcdbee2a5968e2c1f539" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[ 9]), 1, 4, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a257c04efac3a33d5d34b21d64c6f1266">capz_act_pos</a>,      &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a719db4477f35331eaa8b7b44150e88a2">capz_status_1</a>,      &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a3abb998bb89433aed16121d0dae6275a">capz_status_2</a>,      <span class="stringliteral">&quot;Cap Z  #10 &amp;5 V&quot;</span>, <span class="stringliteral">&quot;capz&quot;</span>,        <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>, <a class="code" href="lspmac_8c.html#a51216d824b3693de350f3be1ab30a7e0" title="Use jog to move motor to requested position.">lspmac_jogabs_queue</a>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a589431b3a79c21c251fcb97cc9126991" title="Scintillator Z.">scint</a>  = <a class="code" href="lspmac_8c.html#a38a28b74c706dcdbee2a5968e2c1f539" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[10]), 2, 0, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a1c146fc792c4285eed5b2c446c214f98">scint_act_pos</a>,     &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a1723870357f428ac5c2758a2c9a475c7">scint_status_1</a>,     &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a4e5bc72e2f4007370f1c29ea272c952f">scint_status_2</a>,     <span class="stringliteral">&quot;Scin Z #11 &amp;5 W&quot;</span>, <span class="stringliteral">&quot;scint&quot;</span>,       <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>, <a class="code" href="lspmac_8c.html#a51216d824b3693de350f3be1ab30a7e0" title="Use jog to move motor to requested position.">lspmac_jogabs_queue</a>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ac940d950d9efeaf3f0ae67e9bf331188" title="Centering Table X.">cenx</a>   = <a class="code" href="lspmac_8c.html#a38a28b74c706dcdbee2a5968e2c1f539" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[11]), 2, 1, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ae7924b6e91e1de82f6f7910cb3a9c9bd">centerx_act_pos</a>,   &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#aa619cdbd7a563408c6b825ddc4f74ebb">centerx_status_1</a>,   &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ae4fad6debe138ed7815d463e83f8d0f6">centerx_status_2</a>,   <span class="stringliteral">&quot;Cen X  #17 &amp;2 X&quot;</span>, <span class="stringliteral">&quot;centering.x&quot;</span>, <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>, <a class="code" href="lspmac_8c.html#a51216d824b3693de350f3be1ab30a7e0" title="Use jog to move motor to requested position.">lspmac_jogabs_queue</a>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#aaed18e738ba7bfb6c771a44f5d7ea827" title="Centering Table Y.">ceny</a>   = <a class="code" href="lspmac_8c.html#a38a28b74c706dcdbee2a5968e2c1f539" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[12]), 2, 2, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a6be71a92a599d490ca808af8c7e7faa0">centery_act_pos</a>,   &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a57f65ebe28ef88f1c632d9f35d9167eb">centery_status_1</a>,   &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#aa242098c185cce8f852cd6e081ef0b1d">centery_status_2</a>,   <span class="stringliteral">&quot;Cen Y  #18 &amp;2 Y&quot;</span>, <span class="stringliteral">&quot;centering.y&quot;</span>, <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>, <a class="code" href="lspmac_8c.html#a51216d824b3693de350f3be1ab30a7e0" title="Use jog to move motor to requested position.">lspmac_jogabs_queue</a>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a0be79ccb7ebf3a665248fd856112b9fd" title="Kappa.">kappa</a>  = <a class="code" href="lspmac_8c.html#a38a28b74c706dcdbee2a5968e2c1f539" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[13]), 2, 3, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ac384fb7073387dd5dcb2e85a00ec8a77">kappa_act_pos</a>,     &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ab152694bc32d37c1d180f55e8d282020">kappa_status_1</a>,     &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#af6891f5f8dcfc62668f64c583042c6bc">kappa_status_2</a>,     <span class="stringliteral">&quot;Kappa  #19 &amp;7 X&quot;</span>, <span class="stringliteral">&quot;kappa&quot;</span>,       <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>, <a class="code" href="lspmac_8c.html#a51216d824b3693de350f3be1ab30a7e0" title="Use jog to move motor to requested position.">lspmac_jogabs_queue</a>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ac8070dc568ad974a3db42b51eca828cc" title="Phi (not data collection axis)">phi</a>    = <a class="code" href="lspmac_8c.html#a38a28b74c706dcdbee2a5968e2c1f539" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[14]), 2, 4, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a4de22995a72ff6e72a1a9ccab6d00620">phi_act_pos</a>,       &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ad8b8fd90ffff43016e2adaab5ccbfa02">phi_status_1</a>,       &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a0e6cea4c32cb34e602b9ac3d21259219">phi_status_2</a>,       <span class="stringliteral">&quot;Phi    #20 &amp;7 Y&quot;</span>, <span class="stringliteral">&quot;phi&quot;</span>,         <a class="code" href="lspmac_8c.html#a1ef1fd07d6dfe8071eb0f696945bcab5" title="Use coordinate system motion program, if available, to move motor to requested position.">lspmac_moveabs_queue</a>, <a class="code" href="lspmac_8c.html#a51216d824b3693de350f3be1ab30a7e0" title="Use jog to move motor to requested position.">lspmac_jogabs_queue</a>);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lspmac_8c.html#a26dec4623af9beed912b8e7e6f99822c" title="Fast shutter.">fshut</a>  = <a class="code" href="lspmac_8c.html#a40aa4aeb5c799a6a3a089137da4fd6a8" title="Initalize the fast shutter motor.">lspmac_fshut_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[15]));</div>
<div class="line">    <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a> = <a class="code" href="lspmac_8c.html#acea9dfc6367bbcf16f49e664e0fc3774" title="Initialize DAC motor Note that some motors require further initialization from a database query...">lspmac_dac_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[16]), &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a3be73c48b09190241a2bcb801af5b97c">front_dac</a>,   <span class="stringliteral">&quot;M1200&quot;</span>, <span class="stringliteral">&quot;frontLight.intensity&quot;</span>, <a class="code" href="lspmac_8c.html#a98ad3d807b8826439b710e97bf53b478" title="Move method for dac motor objects (ie, lights)">lspmac_movedac_queue</a>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a> = <a class="code" href="lspmac_8c.html#acea9dfc6367bbcf16f49e664e0fc3774" title="Initialize DAC motor Note that some motors require further initialization from a database query...">lspmac_dac_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[17]), &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a33ce490348c8de255cf49b96469d3d4e">back_dac</a>,    <span class="stringliteral">&quot;M1201&quot;</span>, <span class="stringliteral">&quot;backLight.intensity&quot;</span>,  <a class="code" href="lspmac_8c.html#a98ad3d807b8826439b710e97bf53b478" title="Move method for dac motor objects (ie, lights)">lspmac_movedac_queue</a>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a8a3ca6fcf5e24dcc26170736843e53b2" title="Scintillator Piezo DAC.">fscint</a> = <a class="code" href="lspmac_8c.html#acea9dfc6367bbcf16f49e664e0fc3774" title="Initialize DAC motor Note that some motors require further initialization from a database query...">lspmac_dac_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[18]), &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a031be48adfa016c637d6eae49054c435">scint_piezo</a>, <span class="stringliteral">&quot;M1203&quot;</span>, <span class="stringliteral">&quot;scint.focus&quot;</span>,          <a class="code" href="lspmac_8c.html#a98ad3d807b8826439b710e97bf53b478" title="Move method for dac motor objects (ie, lights)">lspmac_movedac_queue</a>);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lspmac_8c.html#abee73a0d9e5f3af9eb88d5cfd6b953c3" title="Smart Magnet on/off.">smart_mag_oo</a>  = <a class="code" href="lspmac_8c.html#aeaa263af25d139f249d8b825a058d0ce" title="Initialize binary i/o motor.">lspmac_bo_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[19]), <span class="stringliteral">&quot;smartMagnet&quot;</span>,<span class="stringliteral">&quot;M1100=%d&quot;</span>, &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ab09c1342dc12052b8f5b35f78ef95000">acc11c_5</a>), 0x01);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#af813a2eff0b7efa4c70633559054e84c" title="Back light Up/Down actuator.">blight_ud</a>     = <a class="code" href="lspmac_8c.html#aeaa263af25d139f249d8b825a058d0ce" title="Initialize binary i/o motor.">lspmac_bo_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[20]), <span class="stringliteral">&quot;backLight&quot;</span>,  <span class="stringliteral">&quot;M1101=%d&quot;</span>, &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ab09c1342dc12052b8f5b35f78ef95000">acc11c_5</a>), 0x02);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ae78d9a757d4c85419fff9c94b15e25d7" title="Move the cryostream towards or away from the crystal.">cryo</a>          = <a class="code" href="lspmac_8c.html#aeaa263af25d139f249d8b825a058d0ce" title="Initialize binary i/o motor.">lspmac_bo_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[21]), <span class="stringliteral">&quot;cryo&quot;</span>,       <span class="stringliteral">&quot;M1102=%d&quot;</span>, &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ab09c1342dc12052b8f5b35f78ef95000">acc11c_5</a>), 0x04);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a9d9c5030d817483ca9518027c91adac4" title="blow air on the scintilator to dry it off">dryer</a>         = <a class="code" href="lspmac_8c.html#aeaa263af25d139f249d8b825a058d0ce" title="Initialize binary i/o motor.">lspmac_bo_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[22]), <span class="stringliteral">&quot;dryer&quot;</span>,      <span class="stringliteral">&quot;M1103=%d&quot;</span>, &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ab09c1342dc12052b8f5b35f78ef95000">acc11c_5</a>), 0x08);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#addb26c80065506faa1de3c1b468fe03f" title="Move the fluorescence detector in/out.">fluo</a>          = <a class="code" href="lspmac_8c.html#aeaa263af25d139f249d8b825a058d0ce" title="Initialize binary i/o motor.">lspmac_bo_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[23]), <span class="stringliteral">&quot;fluo&quot;</span>,       <span class="stringliteral">&quot;M1104=%d&quot;</span>, &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ab09c1342dc12052b8f5b35f78ef95000">acc11c_5</a>), 0x10);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a6630442dc65ce8a30a24ed718b301971" title="Turn front light on/off.">flight_oo</a>     = <a class="code" href="lspmac_8c.html#a698719a7ce58e2052fa70ab87b1fb293">lspmac_soft_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[24]), <span class="stringliteral">&quot;frontLight&quot;</span>,        <a class="code" href="lspmac_8c.html#aa3c75b8bbde4b8b8ff2b416eabe45552" title="&quot;move&quot; frontlight on/off">lspmac_moveabs_frontlight_oo_queue</a>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#af55c51d52c4586b647114f95d7ac1f42" title="Back light scale factor.">blight_f</a>      = <a class="code" href="lspmac_8c.html#a698719a7ce58e2052fa70ab87b1fb293">lspmac_soft_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[25]), <span class="stringliteral">&quot;backLight.factor&quot;</span>,  <a class="code" href="lspmac_8c.html#a4c4e5e996755d21603e0afdd41ab9cd4">lspmac_moveabs_blight_factor_queue</a>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#aabf4ec595b5183c1777d029ca56134b0" title="Front light scale factor.">flight_f</a>      = <a class="code" href="lspmac_8c.html#a698719a7ce58e2052fa70ab87b1fb293">lspmac_soft_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[26]), <span class="stringliteral">&quot;frontLight.factor&quot;</span>, <a class="code" href="lspmac_8c.html#acbe3a8e54208048506e77b365b4c0f58">lspmac_moveabs_flight_factor_queue</a>);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lspmac_8c.html#aade15098d213bb25522048e4a231941a" title="Low pressure air OK.">lp_air</a>          = <a class="code" href="lspmac_8c.html#a98e729f27252bcbe803e020d5d3d1845" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[ 0]), <span class="stringliteral">&quot;lowpressureair&quot;</span>,   &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a69fc2e30a5de0a11c992d133e7a761cd">acc11c_1</a>),  0x01, <span class="stringliteral">&quot;Low Pressure Air OK&quot;</span>,  <span class="stringliteral">&quot;Low Pressure Air Failed&quot;</span>,  <span class="stringliteral">&quot;OK&quot;</span>,      <span class="stringliteral">&quot;Failed&quot;</span>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#abb29b117ad38156ba16fcf44eeb427af" title="High pressure air OK.">hp_air</a>          = <a class="code" href="lspmac_8c.html#a98e729f27252bcbe803e020d5d3d1845" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[ 1]), <span class="stringliteral">&quot;highpressureair&quot;</span>,  &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a69fc2e30a5de0a11c992d133e7a761cd">acc11c_1</a>),  0x02, <span class="stringliteral">&quot;High Pressure Air OK&quot;</span>, <span class="stringliteral">&quot;High Pressure Air Failed&quot;</span>, <span class="stringliteral">&quot;OK&quot;</span>,      <span class="stringliteral">&quot;Failed&quot;</span>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a28df32fd6be9160603aa1bb74a823574" title="that little toggle switch for the cryo">cryo_switch</a>     = <a class="code" href="lspmac_8c.html#a98e729f27252bcbe803e020d5d3d1845" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[ 2]), <span class="stringliteral">&quot;cryoswitch&quot;</span>,       &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a69fc2e30a5de0a11c992d133e7a761cd">acc11c_1</a>),  0x04, <span class="stringliteral">&quot;CryoSwitchChanged&quot;</span>,    <span class="stringliteral">&quot;CryoSwitchChanged&quot;</span>,        <span class="stringliteral">&quot;On&quot;</span>,      <span class="stringliteral">&quot;Off&quot;</span>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ac0d0bc95bcbcbd154b30c72a9645c8b2" title="Backlight is down.">blight_down</a>     = <a class="code" href="lspmac_8c.html#a98e729f27252bcbe803e020d5d3d1845" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[ 3]), <span class="stringliteral">&quot;backLightDown&quot;</span>,    &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a69fc2e30a5de0a11c992d133e7a761cd">acc11c_1</a>),  0x08, <span class="stringliteral">&quot;Backlight Down&quot;</span>,       <span class="stringliteral">&quot;Backlight Not Down&quot;</span>,       <span class="stringliteral">&quot;Down&quot;</span>,    <span class="stringliteral">&quot;Not Down&quot;</span>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a7fba65f6555c5c7908852c6cf1ad0c94" title="Backlight is up.">blight_up</a>       = <a class="code" href="lspmac_8c.html#a98e729f27252bcbe803e020d5d3d1845" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[ 4]), <span class="stringliteral">&quot;backLightUp&quot;</span>,      &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a69fc2e30a5de0a11c992d133e7a761cd">acc11c_1</a>),  0x10, <span class="stringliteral">&quot;Backlight Up&quot;</span>,         <span class="stringliteral">&quot;Backlight Not Up&quot;</span>,         <span class="stringliteral">&quot;Up&quot;</span>,      <span class="stringliteral">&quot;Not Up&quot;</span>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a871d4cdea0a1a8db85b8658a07655212" title="cryo is in the back position">cryo_back</a>       = <a class="code" href="lspmac_8c.html#a98e729f27252bcbe803e020d5d3d1845" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[ 5]), <span class="stringliteral">&quot;cryoBack&quot;</span>,         &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a69fc2e30a5de0a11c992d133e7a761cd">acc11c_1</a>),  0x40, <span class="stringliteral">&quot;Cryo Back&quot;</span>,            <span class="stringliteral">&quot;Cryo Not Back&quot;</span>,            <span class="stringliteral">&quot;Back&quot;</span>,    <span class="stringliteral">&quot;Not Back&quot;</span>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a67092de6f3fcc0b245e4970437eaff6b" title="fluor is in the back position">fluor_back</a>      = <a class="code" href="lspmac_8c.html#a98e729f27252bcbe803e020d5d3d1845" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[ 6]), <span class="stringliteral">&quot;detectorParked&quot;</span>,   &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ad186f06cb4670b00b8af8264d1da66a4">acc11c_2</a>),  0x01, <span class="stringliteral">&quot;Fluor. Det. Parked&quot;</span>,   <span class="stringliteral">&quot;Fluor. Det. Not Parked&quot;</span>,   <span class="stringliteral">&quot;Parked&quot;</span>,  <span class="stringliteral">&quot;Not Parked&quot;</span>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ac59ab990e48033a811aeb0281fb588fc" title="smart magnet detected sample">sample_detected</a> = <a class="code" href="lspmac_8c.html#a98e729f27252bcbe803e020d5d3d1845" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[ 7]), <span class="stringliteral">&quot;sampleDetector&quot;</span>,   &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ad186f06cb4670b00b8af8264d1da66a4">acc11c_2</a>),  0x02, <span class="stringliteral">&quot;SamplePresent&quot;</span>,        <span class="stringliteral">&quot;SampleAbsent&quot;</span>,             <span class="stringliteral">&quot;Present&quot;</span>, <span class="stringliteral">&quot;Absent&quot;</span> );</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a5538a6aa526eeed65ff237303da2d348" title="ETEL is ready.">etel_ready</a>      = <a class="code" href="lspmac_8c.html#a98e729f27252bcbe803e020d5d3d1845" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[ 8]), <span class="stringliteral">&quot;etelReady&quot;</span>,        &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ad186f06cb4670b00b8af8264d1da66a4">acc11c_2</a>),  0x20, <span class="stringliteral">&quot;ETEL Ready&quot;</span>,           <span class="stringliteral">&quot;ETEL Not Ready&quot;</span>,           <span class="stringliteral">&quot;Ready&quot;</span>,   <span class="stringliteral">&quot;Not Ready&quot;</span>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ab48d4a2cf0225796db9aad49f034dc59" title="ETEL is on.">etel_on</a>         = <a class="code" href="lspmac_8c.html#a98e729f27252bcbe803e020d5d3d1845" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[ 9]), <span class="stringliteral">&quot;etelOn&quot;</span>,           &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ad186f06cb4670b00b8af8264d1da66a4">acc11c_2</a>),  0x40, <span class="stringliteral">&quot;ETEL On&quot;</span>,              <span class="stringliteral">&quot;ETEL Off&quot;</span>,                 <span class="stringliteral">&quot;On&quot;</span>,      <span class="stringliteral">&quot;Off&quot;</span>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a1e690d4ad981d020ea2c850282dca3be" title="ETEL initialized OK.">etel_init_ok</a>    = <a class="code" href="lspmac_8c.html#a98e729f27252bcbe803e020d5d3d1845" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[10]), <span class="stringliteral">&quot;etelOk&quot;</span>,           &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ad186f06cb4670b00b8af8264d1da66a4">acc11c_2</a>),  0x80, <span class="stringliteral">&quot;ETEL Init OK&quot;</span>,         <span class="stringliteral">&quot;ETEL Init Not OK&quot;</span>,         <span class="stringliteral">&quot;OK&quot;</span>,      <span class="stringliteral">&quot;Not OK&quot;</span>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ab552f2e28dd9cccefafe01f27717101b" title="Minikappa is OK (whatever that means)">minikappa_ok</a>    = <a class="code" href="lspmac_8c.html#a98e729f27252bcbe803e020d5d3d1845" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[11]), <span class="stringliteral">&quot;miniKappaOk&quot;</span>,      &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a20a15620e12888f61c0aed1e47e97932">acc11c_3</a>),  0x01, <span class="stringliteral">&quot;Minikappa OK&quot;</span>,         <span class="stringliteral">&quot;Minikappa Not OK&quot;</span>,         <span class="stringliteral">&quot;OK&quot;</span>,      <span class="stringliteral">&quot;Not OK&quot;</span>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a2dc6fa78bb6313fe8b696d646eaa2443" title="smart magnet is on">smart_mag_on</a>    = <a class="code" href="lspmac_8c.html#a98e729f27252bcbe803e020d5d3d1845" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[12]), <span class="stringliteral">&quot;smartMagnetOn&quot;</span>,    &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a20a15620e12888f61c0aed1e47e97932">acc11c_3</a>),  0x04, <span class="stringliteral">&quot;Smart Magnet On&quot;</span>,      <span class="stringliteral">&quot;Smart Magnet Not On&quot;</span>,      <span class="stringliteral">&quot;On&quot;</span>,      <span class="stringliteral">&quot;Not On&quot;</span>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#afaff4fbb5f03b0d2469fc7a14f174d69" title="(whose arm? parked where?)">arm_parked</a>      = <a class="code" href="lspmac_8c.html#a98e729f27252bcbe803e020d5d3d1845" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[13]), <span class="stringliteral">&quot;armParked&quot;</span>,        &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a20a15620e12888f61c0aed1e47e97932">acc11c_3</a>),  0x08, <span class="stringliteral">&quot;Arm Parked&quot;</span>,           <span class="stringliteral">&quot;Arm Not Parked&quot;</span>,           <span class="stringliteral">&quot;Parked&quot;</span>,  <span class="stringliteral">&quot;Not Parked&quot;</span>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a37903ed8430ac4d9ead609a78eb62f32" title="smart magnet error (coil broken perhaps)">smart_mag_err</a>   = <a class="code" href="lspmac_8c.html#a98e729f27252bcbe803e020d5d3d1845" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[14]), <span class="stringliteral">&quot;smartMagnetError&quot;</span>, &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a20a15620e12888f61c0aed1e47e97932">acc11c_3</a>),  0x10, <span class="stringliteral">&quot;Smart Magnet Error&quot;</span>,   <span class="stringliteral">&quot;Smart Magnet OK&quot;</span>,          <span class="stringliteral">&quot;Error&quot;</span>,   <span class="stringliteral">&quot;OK&quot;</span>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ae98a0792d6b4b96a33df0a31bdec6342" title="shutter is open (note in pmc says this is a slow input)">shutter_open</a>    = <a class="code" href="lspmac_8c.html#a98e729f27252bcbe803e020d5d3d1845" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[15]), <span class="stringliteral">&quot;shutterOpen&quot;</span>,      &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a20a15620e12888f61c0aed1e47e97932">acc11c_3</a>), 0x100, <span class="stringliteral">&quot;Shutter Open&quot;</span>,         <span class="stringliteral">&quot;Shutter Not Open&quot;</span>,         <span class="stringliteral">&quot;Open&quot;</span>,    <span class="stringliteral">&quot;Not Open&quot;</span>);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a4892e918830dd12093d28c53a1c2df98" title="smart magnet is off">smart_mag_off</a>   = <a class="code" href="lspmac_8c.html#a98e729f27252bcbe803e020d5d3d1845" title="Initialize binary input.">lspmac_bi_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a37c46609cb32aea5178c4d59d7892d13" title="array of binary inputs">lspmac_bis</a>[16]), <span class="stringliteral">&quot;smartMagnetOff&quot;</span>,   &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ab09c1342dc12052b8f5b35f78ef95000">acc11c_5</a>),  0x01, <span class="stringliteral">&quot;Smart Magnet Off&quot;</span>,     <span class="stringliteral">&quot;Smart Magnet Not Off&quot;</span>,     <span class="stringliteral">&quot;Off&quot;</span>,     <span class="stringliteral">&quot;Not Off&quot;</span>);</div>
<div class="line">  </div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Set up hash table</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    err = hcreate_r( <a class="code" href="lspmac_8c.html#a633db3afda918c8cd29f9728d45b9f73">LSPMAC_MAX_MOTORS</a> * 2, &amp;<a class="code" href="lspmac_8c.html#af12c92fd31b325808127fcd14bb1b329" title="A hash table to find motors by name.">motors_ht</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( err == 0) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_init: hcreate_r failed: &#39;%s&#39;&quot;</span>, strerror( errno));</div>
<div class="line">      exit( -1);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">for</span>( i=0; i&lt;<a class="code" href="lspmac_8c.html#a56260f012c50a591ee7f97e500f16994" title="The number of motors we manage.">lspmac_nmotors</a>; i++) {</div>
<div class="line">      entry_in.key   = <a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>].<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>;</div>
<div class="line">      entry_in.data  = &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>]);</div>
<div class="line">      err = hsearch_r( entry_in, ENTER, &amp;entry_outp, &amp;<a class="code" href="lspmac_8c.html#af12c92fd31b325808127fcd14bb1b329" title="A hash table to find motors by name.">motors_ht</a>);</div>
<div class="line">      <span class="keywordflow">if</span>( err == 0) {</div>
<div class="line">        <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_init: hsearch_r failed for motor %s: &#39;%s&#39;&quot;</span>, <a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[i].name, strerror( errno));</div>
<div class="line">        exit( -1);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Initialize several commands that get called, perhaps, alot</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a6a155eb3ae546dd29369c4a33ddb3310" title="VR_UPLOAD or VR_DOWNLOAD.">RequestType</a> = <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>;</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a0dc566e7edbb226f1a4ea443d93d56e2" title="The command to run (VR_PMAC_GETMEM, etc).">Request</a>     = <a class="code" href="lspmac_8c.html#aad3c7b4a9403e56c09eceadcf21252c0">VR_PMAC_READREADY</a>;</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#aec0ee9a5f6c7e3bc6e4bd98f1bd52783" title="Command parameter 1.">wValue</a>      = 0;</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a92f5a374e87d4f496b64b4888850d6e6" title="Command parameter 2.">wIndex</a>      = 0;</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#af5df25ff13ca30fa33719d0df1ab7e97" title="Number of bytes in bData.">wLength</a>     = htons(2);</div>
<div class="line">    memset( <a class="code" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>));</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a6a155eb3ae546dd29369c4a33ddb3310" title="VR_UPLOAD or VR_DOWNLOAD.">RequestType</a> = <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>;</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a0dc566e7edbb226f1a4ea443d93d56e2" title="The command to run (VR_PMAC_GETMEM, etc).">Request</a>     = <a class="code" href="lspmac_8c.html#a50e444b5ceb6d62a1be43c88c55c549c">VR_PMAC_GETBUFFER</a>;</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a>.<a class="code" href="structtagEthernetCmd.html#aec0ee9a5f6c7e3bc6e4bd98f1bd52783" title="Command parameter 1.">wValue</a>      = 0;</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a92f5a374e87d4f496b64b4888850d6e6" title="Command parameter 2.">wIndex</a>      = 0;</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a>.<a class="code" href="structtagEthernetCmd.html#af5df25ff13ca30fa33719d0df1ab7e97" title="Number of bytes in bData.">wLength</a>     = htons(1400);</div>
<div class="line">    memset( <a class="code" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>));</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81" title="commands to send out &quot;readready&quot;, &quot;getbuffer&quot;, &quot;controlresponse&quot; (initialized in main)">cr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a6a155eb3ae546dd29369c4a33ddb3310" title="VR_UPLOAD or VR_DOWNLOAD.">RequestType</a> = <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>;</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81" title="commands to send out &quot;readready&quot;, &quot;getbuffer&quot;, &quot;controlresponse&quot; (initialized in main)">cr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a0dc566e7edbb226f1a4ea443d93d56e2" title="The command to run (VR_PMAC_GETMEM, etc).">Request</a>     = <a class="code" href="lspmac_8c.html#a8f4ce4666a23a3fb153d680bd1cb6556">VR_CTRL_RESPONSE</a>;</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81" title="commands to send out &quot;readready&quot;, &quot;getbuffer&quot;, &quot;controlresponse&quot; (initialized in main)">cr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#aec0ee9a5f6c7e3bc6e4bd98f1bd52783" title="Command parameter 1.">wValue</a>      = 0;</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81" title="commands to send out &quot;readready&quot;, &quot;getbuffer&quot;, &quot;controlresponse&quot; (initialized in main)">cr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a92f5a374e87d4f496b64b4888850d6e6" title="Command parameter 2.">wIndex</a>      = 0;</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81" title="commands to send out &quot;readready&quot;, &quot;getbuffer&quot;, &quot;controlresponse&quot; (initialized in main)">cr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#af5df25ff13ca30fa33719d0df1ab7e97" title="Number of bytes in bData.">wLength</a>     = htons(1400);</div>
<div class="line">    memset( <a class="code" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81" title="commands to send out &quot;readready&quot;, &quot;getbuffer&quot;, &quot;controlresponse&quot; (initialized in main)">cr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81" title="commands to send out &quot;readready&quot;, &quot;getbuffer&quot;, &quot;controlresponse&quot; (initialized in main)">cr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>));</div>
<div class="line"></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Initialize some mutexs and conditions</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">    pthread_mutex_init( &amp;<a class="code" href="lspmac_8c.html#acc1bb77b9bcbc4d970f841a41fd274b3" title="manage access to the pmac command queue">pmac_queue_mutex</a>, &amp;mutex_initializer);</div>
<div class="line">    pthread_cond_init(  &amp;<a class="code" href="lspmac_8c.html#a8a25bd9c593c6985107f90f999ce0b08" title="wait for a command to be sent to PMAC before continuing">pmac_queue_cond</a>, NULL);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lspmac_8c.html#a112158e0cd50449a440ac55c7af7bea2" title="State of the shutter, used to detect changes.">lspmac_shutter_state</a> = 0;                           <span class="comment">// assume the shutter is now closed: not a big deal if we are wrong</span></div>
<div class="line">    pthread_mutex_init( &amp;<a class="code" href="lspmac_8c.html#a1b78a13c654409333569815e1c109d38" title="Coordinates threads reading shutter status.">lspmac_shutter_mutex</a>, &amp;mutex_initializer);</div>
<div class="line">    pthread_cond_init(  &amp;<a class="code" href="lspmac_8c.html#afbd51c2cefcee87afe994c9e9f372241" title="Allows waiting for the shutter status to change.">lspmac_shutter_cond</a>, NULL);</div>
<div class="line">    <a class="code" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba" title="our poll structure">pmacfd</a>.fd = -1;</div>
<div class="line"></div>
<div class="line">    pthread_mutex_init( &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>, &amp;mutex_initializer);</div>
<div class="line">    pthread_cond_init(  &amp;<a class="code" href="lspmac_8c.html#a57547d211906c981ef20257eba99f8df" title="Wait for motor(s) to finish moving condition.">lspmac_moving_cond</a>, NULL);</div>
<div class="line"></div>
<div class="line">    pthread_mutex_init( &amp;<a class="code" href="lspmac_8c.html#a2ff142105e17d933871d09759e7082f8" title="Keep too many processes from sending commands at once.">lspmac_ascii_mutex</a>, &amp;mutex_initializer);</div>
<div class="line"></div>
<div class="line">    pthread_mutex_init( &amp;<a class="code" href="lspmac_8c.html#a3e7ae750b8988cd2eb93895e3ea1a49e">lspmac_ascii_buffers_mutex</a>, &amp;mutex_initializer);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lsevents_8c.html#ae09cfa92dba806d8f8808e5822ea713c">lsevents_preregister_event</a>( <span class="stringliteral">&quot;omega crossed zero&quot;</span>);</div>
<div class="line">    <a class="code" href="lsevents_8c.html#ae09cfa92dba806d8f8808e5822ea713c">lsevents_preregister_event</a>( <span class="stringliteral">&quot;Move Aborted&quot;</span>);</div>
<div class="line">    <a class="code" href="lsevents_8c.html#ae09cfa92dba806d8f8808e5822ea713c">lsevents_preregister_event</a>( <span class="stringliteral">&quot;Combined Move Aborted&quot;</span>);</div>
<div class="line">    <a class="code" href="lsevents_8c.html#ae09cfa92dba806d8f8808e5822ea713c">lsevents_preregister_event</a>( <span class="stringliteral">&quot;Abort Request queued&quot;</span>);</div>
<div class="line">    <a class="code" href="lsevents_8c.html#ae09cfa92dba806d8f8808e5822ea713c">lsevents_preregister_event</a>( <span class="stringliteral">&quot;Abort Request accepted&quot;</span>);</div>
<div class="line">    <a class="code" href="lsevents_8c.html#ae09cfa92dba806d8f8808e5822ea713c">lsevents_preregister_event</a>( <span class="stringliteral">&quot;Reset queued&quot;</span>);</div>
<div class="line">    <a class="code" href="lsevents_8c.html#ae09cfa92dba806d8f8808e5822ea713c">lsevents_preregister_event</a>( <span class="stringliteral">&quot;Reset command accepted&quot;</span>);</div>
<div class="line">  </div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>( i=1; i&lt;=16; i++) {</div>
<div class="line">      <a class="code" href="lsevents_8c.html#ae09cfa92dba806d8f8808e5822ea713c">lsevents_preregister_event</a>( <span class="stringliteral">&quot;Coordsys %d Stopped&quot;</span>, i);</div>
<div class="line">    }</div>
<div class="line">    first_time = 0;</div>
<div class="line">  }</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// clear the ascii communications buffers</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  {</div>
<div class="line">    uint32_t cc;</div>
<div class="line">    cc = 0;</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>, <a class="code" href="lspmac_8c.html#ab79207cc3145740f8c070a24c91b11e0">VR_PMAC_SETMEM</a>, 0x0e9e, 0, 4, (<span class="keywordtype">char</span> *)&amp;cc, NULL, 1, NULL);</div>
<div class="line"></div>
<div class="line">    cc = 0x18;</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>, <a class="code" href="lspmac_8c.html#ab79207cc3145740f8c070a24c91b11e0">VR_PMAC_SETMEM</a>, 0x0e9e, 0, 4, (<span class="keywordtype">char</span> *)&amp;cc, NULL, 1, NULL);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( NULL, <span class="stringliteral">&quot;I5=0&quot;</span>);                 <span class="comment">// disable plcc&#39;s</span></div>
<div class="line">  <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( NULL, <span class="stringliteral">&quot;P2100=0&quot;</span>);              <span class="comment">// Don&#39;t let plcc0 control the shutter</span></div>
<div class="line">  <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( NULL, <span class="stringliteral">&quot;I36=1&quot;</span>);                <span class="comment">// Don&#39;t let ^A put a disabled motor into closed loop mode</span></div>
<div class="line">  <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( NULL, <span class="stringliteral">&quot;ENABLE PLCC 0,2&quot;</span>);      <span class="comment">// use plcc0 (Probably not needed but allows easy reset with M2000=0) plcc2 is ours used to fill db memory with status</span></div>
<div class="line">  <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( NULL, <span class="stringliteral">&quot;DISABLE PLCC 1&quot;</span>);       <span class="comment">// Don&#39;t use plcc 1, it&#39;s embl&#39;s status routine for old md2 code</span></div>
<div class="line">  <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( NULL, <span class="stringliteral">&quot;I5=3&quot;</span>);                 <span class="comment">// allow the enabled plcc&#39;s to run</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae2df697311878e1b93d1b26169ff06fc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_jogabs_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Use jog to move motor to requested position. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l03523">3523</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                            {</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="lspmac_8c.html#a2ab30559739e0232331f53d16c0cb5ac" title="Move method for normal stepper and servo motor objects Returns non-zero on abort, zero if OK...">lspmac_move_or_jog_abs_queue</a>( mp, requested_position, 1);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a565d1106e02cd035deacf10395ddefb9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_move_or_jog_abs_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>requested_position</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>use_jo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Move method for normal stepper and servo motor objects Returns non-zero on abort, zero if OK. </p>
<p>&lt; format string for coordinate system move</p>
<p>&lt; coordinate system bit</p>
<p>&lt; the requested position in units of "counts"</p>
<p>&lt; motor and coordinate system;</p>
<p>&lt; 0= don't use this motor, 1= do use it</p>
<p>&lt; our axis </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mp</td><td>The motor to move </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">requested_position</td><td>Where to move it </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">use_jo</td><td>1 to force jog, 0 for motion prog </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l03246">3246</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                   {</div>
<div class="line">  <span class="keywordtype">char</span> *fmt;                    </div>
<div class="line">  <span class="keywordtype">int</span> q100;                     </div>
<div class="line">  <span class="keywordtype">int</span> requested_pos_cnts;       </div>
<div class="line">  <span class="keywordtype">int</span> coord_num, <a class="code" href="namespacemk__pgpmac__redis.html#a292515b2acabb0dcade5b16584cdb011">motor_num</a>;     </div>
<div class="line">  <span class="keywordtype">int</span> active;                   </div>
<div class="line">  <span class="keywordtype">char</span> *axis;                   </div>
<div class="line">  <span class="keywordtype">double</span> u2c;</div>
<div class="line">  <span class="keywordtype">double</span> neutral_pos;</div>
<div class="line">  <span class="keywordtype">double</span> min_pos, max_pos;</div>
<div class="line">  <span class="keywordtype">int</span> pos_limit_hit, neg_limit_hit, in_position_band;</div>
<div class="line">  <span class="keyword">struct </span>timespec timeout, <a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands...">now</a>;</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  active           = <a class="code" href="lsredis_8c.html#abbb4e5ece19ebd130e1be18036752a08">lsredis_getb</a>(   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aed4998885bcd5a2a30069637180f58e3" title="Use the motor (&quot;true&quot;) or not (&quot;false&quot;)">active</a>);</div>
<div class="line">  u2c              = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>(   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a8838915ebb6f9989944117c8197d5e86" title="conversion from counts to units: 0.0 means not loaded yet">u2c</a>);</div>
<div class="line">  motor_num        = <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>(   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ad6a51cca3c7e5f79168e5c33fd9e736b" title="pmac motor number">motor_num</a>);</div>
<div class="line">  coord_num        = <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>(   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a5614e003272e8323f8809bf7b6559532" title="coordinate system this motor belongs to (0 if none)">coord_num</a>);</div>
<div class="line">  axis             = <a class="code" href="lsredis_8c.html#ac1994e56114b2315294527d76311f829" title="return a copy of the key&#39;s string value be sure to free the result">lsredis_getstr</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7437ef16c2dce65bde4dda1ea00e9df3" title="the axis (X, Y, Z, etc) or null if not in a coordinate system">axis</a>);</div>
<div class="line">  neutral_pos      = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>(   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae931e9bc9fc2fa82ca649334fc052fbe" title="zero offset">neutral_pos</a>);</div>
<div class="line">  min_pos          = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>(   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7c1f2f67c64d26b12d6bb0d681797d8d" title="our minimum position (soft limit)">min_pos</a>) - neutral_pos;</div>
<div class="line">  max_pos          = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>(   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aac8c31a857910cdcbb409331e128e766" title="our maximum position (soft limit)">max_pos</a>) - neutral_pos;</div>
<div class="line">  pos_limit_hit    = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>(   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af39d2e7a681d7c2fbdc39d53fab1a475" title="positive limit status">pos_limit_hit</a>);</div>
<div class="line">  neg_limit_hit    = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>(   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#afe13c86941928d20357f4f3e2a4d915a" title="negative limit status">neg_limit_hit</a>);</div>
<div class="line">  in_position_band = <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>(   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a48de72c2442bd5aa9420fcfe6b4f265f" title="moves within this amount are ignored UNITS ARE 1/16 COUNT">in_position_band</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( u2c == 0.0 || requested_position &lt; min_pos || requested_position &gt; max_pos) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Shouldn&#39;t try moving a motor that&#39;s in trouble</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_move_or_jog_abs_queue: %s  u2c=%f  requested position=%f  min allowed=%f  max allowed=%f&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, u2c, requested_position, min_pos, max_pos);</div>
<div class="line">    <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s Move Aborted&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( active != 1) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Don&#39;t really move this motor</span></div>
<div class="line">    <span class="comment">// although it&#39;s not an error to try</span></div>
<div class="line">    <span class="comment">// This is here since we want to check the soft limits (above) but ignore the hard limits (below)</span></div>
<div class="line">    <span class="comment">// We&#39;ll fake the move.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8cdc94c6e2478b12ce942d4cf1d7499" title="The position as requested by the user.">requested_position</a> = requested_position;</div>
<div class="line">    <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a> &gt; 0 &amp;&amp; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a> != NULL) {</div>
<div class="line">      mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a> = <a class="code" href="lspmac_8c.html#a55b882be15d56a2a777f2b1f92901b7d" title="Look up table support for motor positions (think x=zoom, y=light intensity) use a lookup table to fin...">lspmac_lut</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>, requested_position);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a> = u2c * (requested_position + neutral_pos);</div>
<div class="line">    }</div>
<div class="line">    requested_pos_cnts = mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a>;</div>
<div class="line"></div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a>     = 1;</div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a68c471836f52707fa8582f7860cf500f" title="set to 1 when motion has been verified to have started">motion_seen</a>  = 0;</div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a59a7f007476b2428fd3c5bd7f24440e8" title="Motion command verified sent to pmac.">command_sent</a> = 0;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s Moving&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line"></div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a>     = 0;</div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a68c471836f52707fa8582f7860cf500f" title="set to 1 when motion has been verified to have started">motion_seen</a>  = 1;</div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a59a7f007476b2428fd3c5bd7f24440e8" title="Motion command verified sent to pmac.">command_sent</a> = 1;</div>
<div class="line"></div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a> = requested_position;</div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae5c7aea45b9637a1817be246688fd980" title="local copy of actual counts so only our mutex is needed to read">actual_pos_cnts</a> = requested_pos_cnts;</div>
<div class="line"></div>
<div class="line">    pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s In Position&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line"></div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( (neg_limit_hit &amp;&amp; (requested_position &lt; mp-&gt;position)) || (pos_limit_hit &amp;&amp; (requested_position &gt; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a>))) {</div>
<div class="line">    pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_move_or_jog_abs_queue: %s Moving wrong way on limit: requested position=%f  current position=%f  low limit=%d high limit=%d&quot;</span>,</div>
<div class="line">                           mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, requested_position, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a>, neg_limit_hit, pos_limit_hit);</div>
<div class="line">    <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s Move Aborted&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">    <span class="keywordflow">return</span> 2;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8cdc94c6e2478b12ce942d4cf1d7499" title="The position as requested by the user.">requested_position</a> = requested_position;</div>
<div class="line">  <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a> &gt; 0 &amp;&amp; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a> != NULL) {</div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a> = <a class="code" href="lspmac_8c.html#a55b882be15d56a2a777f2b1f92901b7d" title="Look up table support for motor positions (think x=zoom, y=light intensity) use a lookup table to fin...">lspmac_lut</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>, requested_position);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a> = u2c * (requested_position + neutral_pos);</div>
<div class="line">  }</div>
<div class="line">  requested_pos_cnts = mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a>;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Bluff if we are already there</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( (abs( requested_pos_cnts - mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae5c7aea45b9637a1817be246688fd980" title="local copy of actual counts so only our mutex is needed to read">actual_pos_cnts</a>) * 16 &lt; in_position_band)) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Lie and say we moved even though we didn&#39;t.  Who will know? We are within the deadband or not active.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a>     = 1;</div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a68c471836f52707fa8582f7860cf500f" title="set to 1 when motion has been verified to have started">motion_seen</a>  = 0;</div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a59a7f007476b2428fd3c5bd7f24440e8" title="Motion command verified sent to pmac.">command_sent</a> = 0;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s Moving&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line"></div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a>     = 0;</div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a68c471836f52707fa8582f7860cf500f" title="set to 1 when motion has been verified to have started">motion_seen</a>  = 1;</div>
<div class="line">    mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a59a7f007476b2428fd3c5bd7f24440e8" title="Motion command verified sent to pmac.">command_sent</a> = 1;</div>
<div class="line">    </div>
<div class="line">    pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s In Position&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a>     = 1;</div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a68c471836f52707fa8582f7860cf500f" title="set to 1 when motion has been verified to have started">motion_seen</a>  = 0;</div>
<div class="line">  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a59a7f007476b2428fd3c5bd7f24440e8" title="Motion command verified sent to pmac.">command_sent</a> = 0;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( use_jog || axis == NULL || *axis == 0) {</div>
<div class="line">    use_jog = 1;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    use_jog = 0;</div>
<div class="line">    q100 = 1 &lt;&lt; (coord_num -1);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( !use_jog) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Make sure the coordinate system is not moving something, wait if it is</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>);</div>
<div class="line"></div>
<div class="line">    clock_gettime( CLOCK_REALTIME, &amp;<a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands...">now</a>);</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// TODO: Have all moves estimate how long they&#39;ll take and use that here</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    timeout.tv_sec  = <a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands...">now</a>.tv_sec + 60.0;                <span class="comment">// a long timeout, but we might really be moving something that takes this long (or longer)</span></div>
<div class="line">    timeout.tv_nsec = <a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands...">now</a>.tv_nsec;</div>
<div class="line"></div>
<div class="line">    err = 0;</div>
<div class="line">    <span class="keywordflow">while</span>( err == 0 &amp;&amp;  (<a class="code" href="lspmac_8c.html#a7a32c617c183166308241e270959df56" title="Flag used to implement motor moving condition.">lspmac_moving_flags</a> &amp; q100) != 0)</div>
<div class="line">      err = pthread_cond_timedwait( &amp;<a class="code" href="lspmac_8c.html#a57547d211906c981ef20257eba99f8df" title="Wait for motor(s) to finish moving condition.">lspmac_moving_cond</a>, &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>, &amp;timeout);</div>
<div class="line">    </div>
<div class="line">    pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( err == ETIMEDOUT) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_move_or_jog_abs_queue: Timed Out.  lspmac_moving_flags = %0x&quot;</span>, <a class="code" href="lspmac_8c.html#a7a32c617c183166308241e270959df56" title="Flag used to implement motor moving condition.">lspmac_moving_flags</a>);</div>
<div class="line">      <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s Move Aborted&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Set the &quot;we are moving this coordinate system&quot; flag</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( NULL, <span class="stringliteral">&quot;M5075=(M5075 | %d)&quot;</span>, q100);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">switch</span>( *axis) {</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;A&#39;</span>:</div>
<div class="line">      fmt = <span class="stringliteral">&quot;&amp;%d Q16=%d Q100=%d B146R&quot;</span>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;B&#39;</span>:</div>
<div class="line">      fmt = <span class="stringliteral">&quot;&amp;%d Q17=%d Q100=%d B147R&quot;</span>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;C&#39;</span>:</div>
<div class="line">      fmt = <span class="stringliteral">&quot;&amp;%d Q18=%d Q100=%d B148R&quot;</span>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;X&#39;</span>:</div>
<div class="line">      fmt = <span class="stringliteral">&quot;&amp;%d Q10=%d Q100=%d B140R&quot;</span>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;Y&#39;</span>:</div>
<div class="line">      fmt = <span class="stringliteral">&quot;&amp;%d Q11=%d Q100=%d B141R&quot;</span>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;Z&#39;</span>:</div>
<div class="line">      fmt = <span class="stringliteral">&quot;&amp;%d Q12=%d Q100=%d B142R&quot;</span>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;U&#39;</span>:</div>
<div class="line">      fmt = <span class="stringliteral">&quot;&amp;%d Q13=%d Q100=%d B143R&quot;</span>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;V&#39;</span>:</div>
<div class="line">      fmt = <span class="stringliteral">&quot;&amp;%d Q14=%d Q100=%d B144R&quot;</span>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;W&#39;</span>:</div>
<div class="line">      fmt = <span class="stringliteral">&quot;&amp;%d Q15=%d Q100=%d B145R&quot;</span>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Make sure the flag has been seen</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">    clock_gettime( CLOCK_REALTIME, &amp;<a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands...">now</a>);</div>
<div class="line">    timeout.tv_sec  = <a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands...">now</a>.tv_sec + 4.0;         <span class="comment">// also a long timeout.  This should really only take a few milliseconds on a slow day</span></div>
<div class="line">    timeout.tv_nsec = <a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands...">now</a>.tv_nsec;</div>
<div class="line"></div>
<div class="line">    pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>);</div>
<div class="line"></div>
<div class="line">    err = 0;</div>
<div class="line">    <span class="keywordflow">while</span>( err == 0 &amp;&amp; (<a class="code" href="lspmac_8c.html#a7a32c617c183166308241e270959df56" title="Flag used to implement motor moving condition.">lspmac_moving_flags</a> &amp; q100) == 0)</div>
<div class="line">      err = pthread_cond_timedwait( &amp;<a class="code" href="lspmac_8c.html#a57547d211906c981ef20257eba99f8df" title="Wait for motor(s) to finish moving condition.">lspmac_moving_cond</a>, &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>, &amp;timeout);</div>
<div class="line">    pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( err == ETIMEDOUT) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_move_or_jog_abs_queue: Did not see flag propagate.  Move aborted.&quot;</span>);</div>
<div class="line">      <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s Move Aborted&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">      <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  <span class="keywordflow">if</span>( use_jog) {</div>
<div class="line">    <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, <span class="stringliteral">&quot;#%d j=%d&quot;</span>, motor_num, requested_pos_cnts);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, fmt, coord_num, requested_pos_cnts, q100);</div>
<div class="line">  }</div>
<div class="line">  pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line"></div>
<div class="line">  free( axis);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a763ce40da7c28bc54a8b1a85199a7914"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_move_or_jog_preset_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>move using a preset value returns 0 on success, non-zero on error </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l03484">3484</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                       {</div>
<div class="line">  <span class="keywordtype">double</span> pos;</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line">  <span class="keywordtype">int</span> rtn;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( preset == NULL || *preset == 0) {</div>
<div class="line">    <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s Move Aborted&quot;</span>, mp-&gt;name);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  err = <a class="code" href="lsredis_8c.html#a87d7bb0ade6f247edfbb7803aac9e694" title="Get the value of the given preset and return it in dval Returns 0 on error, non-zero on success;...">lsredis_find_preset</a>( mp-&gt;name, preset, &amp;pos);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( err != 0)</div>
<div class="line">    rtn = <a class="code" href="lspmac_8c.html#a2ab30559739e0232331f53d16c0cb5ac" title="Move method for normal stepper and servo motor objects Returns non-zero on abort, zero if OK...">lspmac_move_or_jog_abs_queue</a>( mp, pos, use_jog);</div>
<div class="line">  <span class="keywordflow">else</span> {</div>
<div class="line">    <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s Move Aborted&quot;</span>, mp-&gt;name);</div>
<div class="line">    rtn = 1;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6809c317931c4af226e0a0217764afae"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_move_or_jog_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="acd26454acc150847b01717f60f956674"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_move_preset_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>preset_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Move a given motor to one of its preset positions. </p>
<p>No movement if the preset is not found. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mp</td><td>lspmac motor pointer </td></tr>
    <tr><td class="paramname">preset_name</td><td>Name of the preset to use </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02484">2484</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                                     {</div>
<div class="line">  <span class="keywordtype">double</span> pos;</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//lslogging_log_message( &quot;lspmac_move_preset_queue: Called with motor %s and preset named &#39;%s&#39;&quot;, mp-&gt;name, preset_name);</span></div>
<div class="line"></div>
<div class="line">  err = <a class="code" href="lsredis_8c.html#a87d7bb0ade6f247edfbb7803aac9e694" title="Get the value of the given preset and return it in dval Returns 0 on error, non-zero on success;...">lsredis_find_preset</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, preset_name, &amp;pos);</div>
<div class="line">  <span class="keywordflow">if</span>( err == 0)</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line"></div>
<div class="line">  err = mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a86380d221e4b17eb8cf87a5ac656b669" title="function to move the motor">jogAbs</a>( mp, pos);</div>
<div class="line">  <span class="keywordflow">if</span>( !err)</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_move_preset_queue: moving %s to preset &#39;%s&#39; (%f)&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, preset_name, pos);</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// the abort event should have been sent in moveAbs</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">return</span> err;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a24786013266b84cba5abae6503c77f02"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_moveabs_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Use coordinate system motion program, if available, to move motor to requested position. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l03512">3512</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                            {</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="lspmac_8c.html#a2ab30559739e0232331f53d16c0cb5ac" title="Move method for normal stepper and servo motor objects Returns non-zero on abort, zero if OK...">lspmac_move_or_jog_abs_queue</a>( mp, requested_position, 0);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a750a7a4f3b02365877979e4f3e06ce7e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_moveabs_wait </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>timeout_secs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for motor to finish moving. </p>
<p>Assume motion already queued, now just wait</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mp</td><td>The motor object to wait for </td></tr>
    <tr><td class="paramname">timeout_secs</td><td>The number of seconds to wait for. Fractional values fine. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l03538">3538</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                                  {</div>
<div class="line">  <span class="keyword">struct </span>timespec timeout, <a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands...">now</a>;</div>
<div class="line">  <span class="keywordtype">double</span> isecs, fsecs;</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Copy the queue item for the most recent move request</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  clock_gettime( CLOCK_REALTIME, &amp;<a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands...">now</a>);</div>
<div class="line"></div>
<div class="line">  fsecs = modf( timeout_secs, &amp;isecs);</div>
<div class="line"></div>
<div class="line">  timeout.tv_sec  = <a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands...">now</a>.tv_sec  + (long)floor( isecs);</div>
<div class="line">  timeout.tv_nsec = <a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands...">now</a>.tv_nsec + (long)floor( fsecs * 1.0e9);</div>
<div class="line">  </div>
<div class="line">  timeout.tv_sec  += timeout.tv_nsec / 1000000000;</div>
<div class="line">  timeout.tv_nsec %= 1000000000;</div>
<div class="line"></div>
<div class="line">  err = 0;</div>
<div class="line">  pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">while</span>( err == 0 &amp;&amp; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a59a7f007476b2428fd3c5bd7f24440e8" title="Motion command verified sent to pmac.">command_sent</a> == 0)</div>
<div class="line">    err = pthread_cond_timedwait( &amp;mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa0ea4108b8fed5b41ff91ca7266f3d84" title="used to signal when a motor is done moving">cond</a>, &amp;mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>, &amp;timeout);</div>
<div class="line">  pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  <span class="keywordflow">if</span>( err != 0) {</div>
<div class="line">    <span class="keywordflow">if</span>( err != ETIMEDOUT) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_moveabs_wait: unexpected error from timedwait %d  tv_sec %ld   tv_nsec %ld&quot;</span>, err, timeout.tv_sec, timeout.tv_nsec);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// wait for the motion to have started</span></div>
<div class="line">  <span class="comment">// This will time out if the motion ends before we can read the status back</span></div>
<div class="line">  <span class="comment">// hence the added complication of time stamp of the sent packet.</span></div>
<div class="line"></div>
<div class="line">  err = 0;</div>
<div class="line">  pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  <span class="keywordflow">while</span>( err == 0 &amp;&amp; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a68c471836f52707fa8582f7860cf500f" title="set to 1 when motion has been verified to have started">motion_seen</a> == 0)</div>
<div class="line">    err = pthread_cond_timedwait( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa0ea4108b8fed5b41ff91ca7266f3d84" title="used to signal when a motor is done moving">cond</a>), &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>), &amp;timeout);</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">if</span>( err != 0) {</div>
<div class="line">    <span class="keywordflow">if</span>( err != ETIMEDOUT) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_moveabs_wait: unexpected error from timedwait: %d  tv_sec %ld   tv_nsec %ld&quot;</span>, err, timeout.tv_sec, timeout.tv_nsec);</div>
<div class="line">    }</div>
<div class="line">    pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// wait for the motion that we know has started to finish</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  err = 0;</div>
<div class="line">  <span class="keywordflow">while</span>( err == 0 &amp;&amp; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a>)</div>
<div class="line">    err = pthread_cond_timedwait( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa0ea4108b8fed5b41ff91ca7266f3d84" title="used to signal when a motor is done moving">cond</a>), &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>), &amp;timeout);</div>
<div class="line"></div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">if</span>( err != 0) {</div>
<div class="line">    <span class="keywordflow">if</span>( err != ETIMEDOUT) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_moveabs_wait: unexpected error from timedwait: %d  tv_sec %ld   tv_nsec %ld&quot;</span>, err, timeout.tv_sec, timeout.tv_nsec);</div>
<div class="line">    }</div>
<div class="line">    pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// if return code was not 0 then we know we shouldn&#39;t wait for not_done flag.</span></div>
<div class="line">  <span class="comment">// In this case the motion ended before we read the status registers</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7101ae7b7aad35767a1d6a7093138bd4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_t* lspmac_run </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start up the lspmac thread. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l04412">4412</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                        {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> first_time = 1;</div>
<div class="line">  <span class="keywordtype">char</span> **inits;</div>
<div class="line">  <a class="code" href="structlspmac__motor__struct.html" title="Motor information.">lspmac_motor_t</a> *mp;</div>
<div class="line">  <span class="keywordtype">char</span> evts[64];</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">  <span class="keywordtype">int</span> active;</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#a292515b2acabb0dcade5b16584cdb011">motor_num</a>;</div>
<div class="line"></div>
<div class="line">  pthread_create( &amp;<a class="code" href="lspmac_8c.html#a6b7011dd7d2c2d3afadff8d3e50e7677" title="our thread to manage access and communication to the pmac">pmac_thread</a>, NULL, <a class="code" href="lspmac_8c.html#abdec5883055967b1eda043670870f55f" title="Our lspmac worker thread.">lspmac_worker</a>, NULL);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( first_time) {</div>
<div class="line">    first_time = 0;</div>
<div class="line">    <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^CryoSwitchChanged$&quot;</span>,        <a class="code" href="lspmac_8c.html#afc00ddac633f8c8a3a699e3d22de2770">lspmac_cryoSwitchChanged_cb</a>);</div>
<div class="line">    <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^scint In Position$&quot;</span>,        <a class="code" href="lspmac_8c.html#af06c25c2ff55f63a621847a5d06f735f" title="Maybe start drying off the scintilator.">lspmac_scint_maybe_turn_on_dryer_cb</a>);</div>
<div class="line">    <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^scint Moving$&quot;</span>,             <a class="code" href="lspmac_8c.html#a107f77bf42c0f86eb29ddad9119e2b3b" title="Maybe stop drying off the scintilator.">lspmac_scint_maybe_turn_off_dryer_cb</a>);</div>
<div class="line">    <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^scintDried$&quot;</span>,               <a class="code" href="lspmac_8c.html#a585676eb411025c7b44da958d4e98eb2" title="Turn off the dryer.">lspmac_scint_dried_cb</a>);</div>
<div class="line">    <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^backLight 1$&quot;</span> ,           <a class="code" href="lspmac_8c.html#a094f66824c57b27c9dad2ca36bd75e44" title="Turn on the backlight whenever it goes up.">lspmac_backLight_up_cb</a>);</div>
<div class="line">    <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^backLight 0$&quot;</span> ,           <a class="code" href="lspmac_8c.html#a571cf14b82b5aae163af5aec3201cd3e" title="Turn off the backlight whenever it goes down.">lspmac_backLight_down_cb</a>);</div>
<div class="line">    <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^cam.zoom Moving$&quot;</span>,          <a class="code" href="lspmac_8c.html#a55791bd8a07e5ca1dd2aeedf3c23942c" title="Set the backlight intensity whenever the zoom is changed (and the backlight is up)">lspmac_light_zoom_cb</a>);</div>
<div class="line">    <span class="comment">//    lsevents_add_listener( &quot;^Quitting Program$&quot;,         lspmac_quitting_cb);</span></div>
<div class="line">    <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^Control-[BCFGV] accepted$&quot;</span>, <a class="code" href="lspmac_8c.html#a328ffc22db94e417645384ee2007bcf8">lspmac_request_control_response_cb</a>);</div>
<div class="line">    <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^Full Card Reset$&quot;</span>,          <a class="code" href="lspmac_8c.html#a4b398420dcf558e332a14f9dc54f59bd" title="reset and resetart">lspmac_full_card_reset_cb</a>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="pgpmac_8c.html#ad163e2bc6ebe322058c113dee76c11ff" title="non-zero to automatically move the alignment stage when the scintillator moves (redis hash AUTOSCINT ...">pgpmac_use_autoscint</a>) {</div>
<div class="line">      <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^scint In Position$&quot;</span>,        <a class="code" href="lspmac_8c.html#ac3da09d0a08834c22a20d907275ae403" title="Perhaps we need to return the sample to the beam.">lspmac_scint_maybe_return_sample_cb</a>);</div>
<div class="line">      <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^scint Moving$&quot;</span>,             <a class="code" href="lspmac_8c.html#a05d91f9bef2b669640935fa140a07934" title="Perhaps we need to move the sample out of the way.">lspmac_scint_maybe_move_sample_cb</a>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>( i=0; i&lt;<a class="code" href="lspmac_8c.html#a56260f012c50a591ee7f97e500f16994" title="The number of motors we manage.">lspmac_nmotors</a>; i++) {</div>
<div class="line">      snprintf( evts, <span class="keyword">sizeof</span>( evts)-1, <span class="stringliteral">&quot;^%s command accepted$&quot;</span>, <a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[i].name);</div>
<div class="line">      evts[<span class="keyword">sizeof</span>(evts)-1] = 0;</div>
<div class="line">      <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( evts, <a class="code" href="lspmac_8c.html#a611168a1076b2de45c596ed95c68445a">lspmac_command_done_cb</a>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <a class="code" href="lspmac_8c.html#a3816a9a1a3bb5bb89fcec8a30d863970" title="Set up lookup table for zoom.">lspmac_zoom_lut_setup</a>();</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ad52a5dbc2f06247eca7619195936b85f" title="Set up lookup table for flight.">lspmac_flight_lut_setup</a>();</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a4aa8c178a56276eb64138d52fe65dc8c" title="Set up lookup table for blight.">lspmac_blight_lut_setup</a>();</div>
<div class="line">    <a class="code" href="lspmac_8c.html#a54ceac41b127ad8bbad07bd90c6729dc" title="Set up lookup table for fscint.">lspmac_fscint_lut_setup</a>();</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Clear the command interfaces</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// lspmac_SockSendControlCharPrint( &quot;Control-X&quot;, &#39;\x18&#39;); // why does this kill the initialzation?</span></div>
<div class="line"></div>
<div class="line">  {</div>
<div class="line">    uint32_t cc;</div>
<div class="line">    cc = 0;</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>, <a class="code" href="lspmac_8c.html#ab79207cc3145740f8c070a24c91b11e0">VR_PMAC_SETMEM</a>, 0x0e9e, 0, 4, (<span class="keywordtype">char</span> *)&amp;cc, NULL, 1, NULL);</div>
<div class="line"></div>
<div class="line">    cc = 0x18;</div>
<div class="line">    <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>, <a class="code" href="lspmac_8c.html#ab79207cc3145740f8c070a24c91b11e0">VR_PMAC_SETMEM</a>, 0x0e9e, 0, 4, (<span class="keywordtype">char</span> *)&amp;cc, NULL, 1, NULL);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Initialize the pmac&#39;s support for each motor</span></div>
<div class="line">  <span class="comment">// (ie, set the various flag for when a motor is active or not)</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;<a class="code" href="lspmac_8c.html#a56260f012c50a591ee7f97e500f16994" title="The number of motors we manage.">lspmac_nmotors</a>; i++) {</div>
<div class="line">    mp        = &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>]);</div>
<div class="line">    active    = <a class="code" href="lsredis_8c.html#abbb4e5ece19ebd130e1be18036752a08">lsredis_getb</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aed4998885bcd5a2a30069637180f58e3" title="Use the motor (&quot;true&quot;) or not (&quot;false&quot;)">active</a>);</div>
<div class="line">    motor_num = <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ad6a51cca3c7e5f79168e5c33fd9e736b" title="pmac motor number">motor_num</a>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( motor_num &gt;= 1 &amp;&amp; motor_num &lt;= 32) {</div>
<div class="line">      </div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Set the PMAC to be consistant with redis</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( NULL, <span class="stringliteral">&quot;I%d16=%f I%d17=%f I%d28=%d&quot;</span>, motor_num, <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a69e49769a1001665377efc7193d88a0a" title="our maximum speed (cts/msec)">max_speed</a>), motor_num, <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a50cf4c0711cea164e332bc34705a1a68" title="our maximum acceleration (cts/msec^2)">max_accel</a>), motor_num, <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a48de72c2442bd5aa9420fcfe6b4f265f" title="moves within this amount are ignored UNITS ARE 1/16 COUNT">in_position_band</a>));</div>
<div class="line">    }    </div>
<div class="line"></div>
<div class="line">    <span class="comment">// if there is a problem with &quot;active&quot; then don&#39;t do anything</span></div>
<div class="line">    <span class="comment">// On the other hand, various combinations of yes/no true/fals 1/0 should work</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">switch</span>( active) {</div>
<div class="line">    <span class="keywordflow">case</span> 1:</div>
<div class="line">      inits = <a class="code" href="lsredis_8c.html#abe31d0e11c41b2235307612c963bb652">lsredis_get_string_array</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ac2a02f137e4a35db816bc728290d3558" title="pmac commands to make this motor active">active_init</a>);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> 0:</div>
<div class="line">      inits = <a class="code" href="lsredis_8c.html#abe31d0e11c41b2235307612c963bb652">lsredis_get_string_array</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab329ce9b277eca9984c18417dece7bf7" title="pmac commands to inactivate the motor">inactive_init</a>);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_run: motor %s is neither active nor inactive (!?)&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">      inits = NULL;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span>( inits != NULL) {</div>
<div class="line">      <span class="keywordflow">while</span>( *inits != NULL) {</div>
<div class="line">        <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( NULL, *inits);</div>
<div class="line">        inits++;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> &amp;<a class="code" href="lspmac_8c.html#a6b7011dd7d2c2d3afadff8d3e50e7677" title="our thread to manage access and communication to the pmac">pmac_thread</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad7cd6c8e4ea1132ac4a4b90e6468e2d6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_set_motion_flags </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>mmaskp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp_1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the coordinate system motion flags (m5075) for the null terminated list of motors that we are planning on running a motion program with. </p>
<p>Note that lspmac_est_move_time already takes care of this, use when calling a motion program directly</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mmaskp</td><td>Returned value of the mask generated. Ignored if null. </td></tr>
    <tr><td class="paramname">mp_1</td><td>start of null terminated list of motors. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02754">2754</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                                     {</div>
<div class="line">  va_list arg_ptr;</div>
<div class="line">  <span class="keyword">struct </span>timespec timeout;</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line">  <span class="keywordtype">int</span> cn;</div>
<div class="line">  <span class="keywordtype">int</span> need_flag;</div>
<div class="line">  <a class="code" href="structlspmac__motor__struct.html" title="Motor information.">lspmac_motor_t</a> *mp;</div>
<div class="line">  <span class="keywordtype">int</span> mmask;</div>
<div class="line"></div>
<div class="line">  mmask = 0;</div>
<div class="line">  <span class="keywordflow">if</span>( mmaskp != NULL)</div>
<div class="line">    *mmaskp = 0;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( mp_1==NULL)</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// add the coordinate system flags to mmask</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  va_start( arg_ptr, mp_1);</div>
<div class="line">  <span class="keywordflow">for</span>( mp = mp_1; mp!=NULL; mp = va_arg( arg_ptr, <a class="code" href="structlspmac__motor__struct.html" title="Motor information.">lspmac_motor_t</a> *)) {</div>
<div class="line">    <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a3342670c97c0b2646409f2ef28f63d1c" title="magic number identifying this as a motor structure">magic</a> != <a class="code" href="pgpmac_8h.html#abe2a74d23400d8d8fe02dc407c242035">LSPMAC_MAGIC_NUMBER</a>) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_set_motion_flags: WARNING: motor list must be NULL terminated.  Check your call to lspmac_set_motion_flags.&quot;</span>);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">    cn = <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a5614e003272e8323f8809bf7b6559532" title="coordinate system this motor belongs to (0 if none)">coord_num</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( cn &lt; 1 || cn &gt; 16)</div>
<div class="line">      <span class="keywordflow">continue</span>;</div>
<div class="line">    </div>
<div class="line">    mmask |= 1 &lt;&lt; (cn - 1);</div>
<div class="line">  }</div>
<div class="line">  va_end( arg_ptr);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( mmaskp != NULL)</div>
<div class="line">    *mmaskp = mmask;</div>
<div class="line">    </div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// It could be the flag is already what we want.  We might set up a race condition if we</span></div>
<div class="line">  <span class="comment">// try to set it again.  (so don&#39;t)</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( (<a class="code" href="lspmac_8c.html#a7a32c617c183166308241e270959df56" title="Flag used to implement motor moving condition.">lspmac_moving_flags</a> &amp; mmask) != 0)</div>
<div class="line">    need_flag = 0;</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    need_flag = 1;</div>
<div class="line">  </div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( !need_flag)</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  </div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Set m5075 and make sure it propagates</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( NULL, <span class="stringliteral">&quot;M5075=(M5075 | %d)&quot;</span>, mmask);</div>
<div class="line">  clock_gettime( CLOCK_REALTIME, &amp;timeout);</div>
<div class="line">  timeout.tv_sec += 2;</div>
<div class="line"></div>
<div class="line">  err = 0;</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>);</div>
<div class="line">  <span class="keywordflow">while</span>( err == 0 &amp;&amp; (<a class="code" href="lspmac_8c.html#a7a32c617c183166308241e270959df56" title="Flag used to implement motor moving condition.">lspmac_moving_flags</a> &amp; mmask) != mmask)</div>
<div class="line">    err = pthread_cond_timedwait( &amp;<a class="code" href="lspmac_8c.html#a57547d211906c981ef20257eba99f8df" title="Wait for motor(s) to finish moving condition.">lspmac_moving_cond</a>, &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>, &amp;timeout);</div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>);</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">if</span>( err == ETIMEDOUT) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspmac_set_motion_flags: timed out waiting for motion %d flag to be set&quot;</span>, mmask);</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8707477f9799b4cc8c6f465ecfeee24b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a>* lspmac_SockSendControlCharPrint </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>c</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send a control character. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">event</td><td>base name for events </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">c</td><td>The control character to send </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01133">1133</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                    {</div>
<div class="line">  <a class="code" href="lspmac_8c.html#a9fbc6333cfd364eff48202376e0f9862" title="The control character we&#39;ve sent.">lspmac_control_char</a> = c;</div>
<div class="line">  <span class="comment">//  return lspmac_send_command( VR_DOWNLOAD, VR_PMAC_SENDCTRLCHAR, c, 0, 1400, NULL, lspmac_SendControlReplyPrintCB, 0, event);</span></div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>, <a class="code" href="lspmac_8c.html#a8f4ce4666a23a3fb153d680bd1cb6556">VR_CTRL_RESPONSE</a>, c, 0, 1400, NULL, <a class="code" href="lspmac_8c.html#ae2dd5e31cb4a69470b061aa56473be14" title="Receive a reply to a control character Print a &quot;printable&quot; version of the character to the terminal F...">lspmac_SendControlReplyPrintCB</a>, 0, event);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0575fc751cecf35ffe8b290ab483ac21"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_SockSendDPControlChar </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>c</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>use dpram ascii interface to send a control character </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02078">2078</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                        {</div>
<div class="line">  uint16_t buff;</div>
<div class="line"></div>
<div class="line">  buff = 0x07 &amp; c;</div>
<div class="line">  <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>, <a class="code" href="lspmac_8c.html#ab79207cc3145740f8c070a24c91b11e0">VR_PMAC_SETMEM</a>, 0x0e9e, 0, 2, (<span class="keywordtype">char</span> *)&amp;buff, <a class="code" href="lspmac_8c.html#afb3caf2837d7bcb702c26fc8f08259b3">lspmac_SockSendDPControlCharCB</a>, 1, event);</div>
<div class="line">  <span class="keywordflow">if</span>( event != NULL)</div>
<div class="line">    <a class="code" href="lsevents_8c.html#a5c6f122382dea3dcc231b772e5e75b46" title="Call the callback routines for the given event.">lsevents_send_event</a>( <span class="stringliteral">&quot;%s queued&quot;</span>, event);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a49a53bb92535ca2b62208dce41760fbb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_SockSendDPline </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>prepare (queue up) a line to send the dpram ascii command interface </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02035">2035</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                                         {</div>
<div class="line">  va_list arg_ptr;</div>
<div class="line">  uint32_t index;</div>
<div class="line">  <span class="keywordtype">char</span> *pl;</div>
<div class="line">  </div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#a2ff142105e17d933871d09759e7082f8" title="Keep too many processes from sending commands at once.">lspmac_ascii_mutex</a>);</div>
<div class="line">  index = <a class="code" href="lspmac_8c.html#a09701de0235acaeae5abf4e04268be33">lspmac_dpascii_on</a>++ % <a class="code" href="lspmac_8c.html#a3a407e2e4d57ac45ecd700f8bad3d3b5">LSPMAC_DPASCII_QUEUE_LENGTH</a>;</div>
<div class="line"></div>
<div class="line">  pl = <a class="code" href="lspmac_8c.html#a2bd5340143f40b5e6404a381fb438710">lspmac_dpascii_queue</a>[index].<a class="code" href="structlspmac__dpascii__queue__struct.html#a318d65317b14eba9e38efd0ab0133a5c">pl</a>;</div>
<div class="line"></div>
<div class="line">  va_start( arg_ptr, fmt);</div>
<div class="line">  vsnprintf( pl, 159, fmt, arg_ptr);</div>
<div class="line">  pl[159] = 0;</div>
<div class="line">  va_end( arg_ptr);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#a2bd5340143f40b5e6404a381fb438710">lspmac_dpascii_queue</a>[index].<a class="code" href="structlspmac__dpascii__queue__struct.html#a8775c09713a917f4ddd80a3a5a8a4668">event</a> = event;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#a2ff142105e17d933871d09759e7082f8" title="Keep too many processes from sending commands at once.">lspmac_ascii_mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a79f86193e36c823157049061b94627a7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a99c275e32ad897dca34d196b91f038cb">pmac_cmd_queue_t</a>* lspmac_SockSendline </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send a one line command. </p>
<p>Uses printf style arguments. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">event</td><td>base name for events </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fmt</td><td>Printf style format string </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01090">1090</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                         {</div>
<div class="line">  va_list arg_ptr;</div>
<div class="line">  <span class="keywordtype">char</span> payload[1400];</div>
<div class="line"></div>
<div class="line">  va_start( arg_ptr, fmt);</div>
<div class="line">  vsnprintf( payload, <span class="keyword">sizeof</span>(payload)-1, fmt, arg_ptr);</div>
<div class="line">  payload[ <span class="keyword">sizeof</span>(payload)-1] = 0;</div>
<div class="line">  va_end( arg_ptr);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;%s&quot;</span>, payload);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="lspmac_8c.html#ac60f32e1ab6d81a60155e355db752726" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#af24ecdc10723dc8fd6320fef416ae514">VR_DOWNLOAD</a>, <a class="code" href="lspmac_8c.html#a772b2ea2ad93989ae4275c79a93525ee">VR_PMAC_SENDLINE</a>, 0, 0, strlen( payload), payload, <a class="code" href="lspmac_8c.html#a81e8e315099cf9b6eef0335b01f97bfd" title="Receive a reply that does not require multiple buffers.">lspmac_GetShortReplyCB</a>, 0, event);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aca5a35903f027178fd9698a5a10537e7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_spin </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l04400">4400</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                      {</div>
<div class="line">  <span class="keywordflow">if</span>( strcmp( mp-&gt;name, <span class="stringliteral">&quot;omega&quot;</span>)==0) {</div>
<div class="line">    <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( NULL, <span class="stringliteral">&quot;&amp;%d&quot;</span>, <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>( mp-&gt;coord_num));</div>
<div class="line">    <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( NULL, <span class="stringliteral">&quot;#%d&quot;</span>, <a class="code" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a>( mp-&gt;motor_num));</div>
<div class="line">    <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( NULL, <span class="stringliteral">&quot;j+&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa8bf745a9ec388783009e2275a8b56f8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_video_rotate </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>secs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Special motion program to collect centering video. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l02716">2716</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<div class="fragment"><div class="line">                                       {</div>
<div class="line">  <span class="keywordtype">double</span> q10;           <span class="comment">// starting position (counts)</span></div>
<div class="line">  <span class="keywordtype">double</span> q11;           <span class="comment">// delta counts</span></div>
<div class="line">  <span class="keywordtype">double</span> q12;           <span class="comment">// milliseconds to run over delta</span></div>
<div class="line">  </div>
<div class="line">  <span class="keywordtype">double</span> u2c;</div>
<div class="line">  <span class="keywordtype">double</span> neutral_pos;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( secs &lt;= 0.0)</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#ae06d2291c1996ffb7dcf7d132e25b038" title="Indicate we&#39;d really like to know when omega crosses zero.">omega_zero_search</a> = 1;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspmac_8c.html#a8237e646ce032a840637a4ef7bff49b9" title="MD2 omega axis (the air bearing)">omega</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">  u2c         = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( <a class="code" href="lspmac_8c.html#a8237e646ce032a840637a4ef7bff49b9" title="MD2 omega axis (the air bearing)">omega</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a8838915ebb6f9989944117c8197d5e86" title="conversion from counts to units: 0.0 means not loaded yet">u2c</a>);</div>
<div class="line">  neutral_pos = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( <a class="code" href="lspmac_8c.html#a8237e646ce032a840637a4ef7bff49b9" title="MD2 omega axis (the air bearing)">omega</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#ae931e9bc9fc2fa82ca649334fc052fbe" title="zero offset">neutral_pos</a>);</div>
<div class="line"></div>
<div class="line">  q10 = neutral_pos * u2c;</div>
<div class="line">  q11 = 360.0 * u2c;</div>
<div class="line">  q12 = 1000 * secs;</div>
<div class="line">  </div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#aea11895d2ec4a3324f4baa9d24cd192d" title="rate (cnts/sec) that omega was traveling when it crossed zero">omega_zero_velocity</a> = 360.0 * u2c / secs;     <span class="comment">// counts/second to back calculate zero crossing time</span></div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( <a class="code" href="lspmac_8c.html#a8237e646ce032a840637a4ef7bff49b9" title="MD2 omega axis (the air bearing)">omega</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, <span class="stringliteral">&quot;&amp;1 Q10=%.1f Q11=%.1f Q12=%.1f Q13=(I117) Q14=(I116) B240R&quot;</span>, q10, q11, q12);</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspmac_8c.html#a8237e646ce032a840637a4ef7bff49b9" title="MD2 omega axis (the air bearing)">omega</a>-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac356cd43e46799929242dcf5214df7f6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsredis_cmpnstr </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00254">254</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                       {</div>
<div class="line">  <span class="keywordtype">int</span> rtn;</div>
<div class="line">  pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <span class="keywordflow">while</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>, &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  </div>
<div class="line">  rtn = strncmp( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0465c65288e8101805a6f91049164517" title="our value">value</a>, s, n);</div>
<div class="line">  pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9fc8fd0db4c71c5eae68682b43103078"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsredis_cmpstr </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>s</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00243">243</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                               {</div>
<div class="line">  <span class="keywordtype">int</span> rtn;</div>
<div class="line">  pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <span class="keywordflow">while</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>, &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  </div>
<div class="line">  rtn = strcmp( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0465c65288e8101805a6f91049164517" title="our value">value</a>, s);</div>
<div class="line">  pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aaabcee808dcf48a60898798a45516b68"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_config </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l01188">1188</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                      {</div>
<div class="line">  <span class="keywordtype">char</span> hostname[128], lhostname[128];</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line"></div>
<div class="line">  pthread_mutexattr_init( &amp;<a class="code" href="lsredis_8c.html#a71c9f418904364d65c22d786f4dc5d39">mutex_initializer</a>);</div>
<div class="line">  pthread_mutexattr_settype( &amp;<a class="code" href="lsredis_8c.html#a71c9f418904364d65c22d786f4dc5d39">mutex_initializer</a>, PTHREAD_MUTEX_RECURSIVE);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( gethostname( hostname, <span class="keyword">sizeof</span>(hostname)-1)) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis_init: cannot get our own host name.  Cannot configure redis variables.&quot;</span>);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="keywordflow">for</span>( i=0; i&lt;strlen(hostname); i++) {</div>
<div class="line">      lhostname[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>] = tolower( hostname[i]);</div>
<div class="line">    }</div>
<div class="line">    lhostname[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>] = 0;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis_init: our host name is &#39;%s&#39;&quot;</span>, lhostname);</div>
<div class="line">    redisAsyncCommand( <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>, <a class="code" href="lsredis_8c.html#a75e500f4f9df969ca9994d6889944f47">lsredis_configCB</a>, NULL, <span class="stringliteral">&quot;hgetall config.%s&quot;</span>, lhostname);</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lsredis_8c.html#a0c5cbd80d59d69603f123621cc6ddc30">lsredis_config_mutex</a>);</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lsredis_8c.html#acdca9095c7a3288d7febe9f4c440a6e9">lsredis_head</a> == NULL)</div>
<div class="line">    pthread_cond_wait( &amp;<a class="code" href="lsredis_8c.html#a6fa076f1004c85a8a1dc400f45547f32">lsredis_config_cond</a>, &amp;<a class="code" href="lsredis_8c.html#a0c5cbd80d59d69603f123621cc6ddc30">lsredis_config_mutex</a>);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lsredis_8c.html#a0c5cbd80d59d69603f123621cc6ddc30">lsredis_config_mutex</a>);</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1ad60526a09ca679f39174ce5d773abe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsredis_find_preset </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>base</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>preset_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>dval</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the value of the given preset and return it in dval Returns 0 on error, non-zero on success;. </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00937">937</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                                            {</div>
<div class="line">  <span class="keywordtype">char</span> s[512];</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line">  ENTRY entry_in, *entry_outp;</div>
<div class="line">  <a class="code" href="structlsredis__preset__list__struct.html">lsredis_preset_list_t</a> *pl;</div>
<div class="line"></div>
<div class="line">  snprintf( s, <span class="keyword">sizeof</span>( s)-1, <span class="stringliteral">&quot;%s%s&quot;</span>, motor_name, preset_name);</div>
<div class="line">  s[<span class="keyword">sizeof</span>(s)-1] = 0;</div>
<div class="line"></div>
<div class="line">  entry_in.key  = s;</div>
<div class="line">  entry_in.data = NULL;</div>
<div class="line">  err = hsearch_r( entry_in, FIND, &amp;entry_outp, &amp;<a class="code" href="lsredis_8c.html#ade00a383533fdefb2af9f3f53f37cf97">lsredis_preset_ht</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( err == 0) {</div>
<div class="line">    <span class="comment">// not found (or some other problem that means we don&#39;t have an answer</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Maybe someone added a new preset and we don&#39;t know about it yet</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="lsredis_8c.html#af48b297b5679750a131fa1e982a078b7" title="update the presets hash table for the named motor">lsredis_load_presets</a>( motor_name);</div>
<div class="line">    err = hsearch_r( entry_in, FIND, &amp;entry_outp, &amp;<a class="code" href="lsredis_8c.html#ade00a383533fdefb2af9f3f53f37cf97">lsredis_preset_ht</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( err == 0) {</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Guess not.  Give up.  We tried</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      *dval = 0.0;</div>
<div class="line">      <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  pl = entry_outp-&gt;data;</div>
<div class="line">  *dval = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#ae365a576448adeccb66fbb85cfcf4b23">position</a>);</div>
<div class="line">  <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adfe823e3ccec7e37ac4697179bd65b10"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsredis_find_preset_index_by_position </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>For the given motor object return the index of the current preset or -1 if we are not at a preset position. </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l01035">1035</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                               {</div>
<div class="line">  <a class="code" href="structlsredis__obj__struct.html" title="Redis Object Basic object whose value is sychronized with our redis db.">lsredis_obj_t</a> *<a class="code" href="namespacemk__pgpmac__redis.html#a11daf2847f2dc94562b5b61b3f412574">p</a>;</div>
<div class="line">  <span class="keywordtype">int</span> plength;</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">  <span class="keywordtype">double</span> ur, pos;</div>
<div class="line"></div>
<div class="line">  p = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.presets.length&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">  plength = <a class="code" href="lsredis_8c.html#a71689006ffc015be6a0705a7c0aef1be">lsredis_get_or_set_l</a>( p, 0);</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">if</span>( plength &lt;= 0) {</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  ur = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aefa84c7592369090eec8b211caaa3a51" title="Change needs to be at least this big to report as a new position to the database.">update_resolution</a>);</div>
<div class="line">  pos = <a class="code" href="lspmac_8c.html#acc46bdddee59bd8c5ad662b3fd445e9f" title="get the motor position (with locking)">lspmac_getPosition</a>( mp);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;plength; i++) {</div>
<div class="line">    p = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.presets.%d.position&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, i);</div>
<div class="line">    <span class="keywordflow">if</span>( fabs( pos - <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( p)) &lt;= ur) {</div>
<div class="line">      <span class="keywordflow">return</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6d9f550b9ba36acd237925164abe3ffc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a>* lsredis_get_obj </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00630">630</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                {</div>
<div class="line">  <a class="code" href="structlsredis__obj__struct.html" title="Redis Object Basic object whose value is sychronized with our redis db.">lsredis_obj_t</a> *rtn;</div>
<div class="line">  va_list arg_ptr;</div>
<div class="line">  <span class="keywordtype">char</span> k[512];</div>
<div class="line">  <span class="keywordtype">char</span> *kp;</div>
<div class="line">  <span class="keywordtype">int</span> nkp;</div>
<div class="line"></div>
<div class="line">  va_start( arg_ptr, fmt);</div>
<div class="line">  vsnprintf( k, <span class="keyword">sizeof</span>(k)-1, fmt, arg_ptr);</div>
<div class="line">  k[<span class="keyword">sizeof</span>(k)-1] = 0;</div>
<div class="line">  va_end( arg_ptr);</div>
<div class="line"></div>
<div class="line">  nkp = strlen(k) + strlen( <a class="code" href="lsredis_8c.html#acdca9095c7a3288d7febe9f4c440a6e9">lsredis_head</a>) + 16;         <span class="comment">// 16 is overkill. I know. Get over it.</span></div>
<div class="line">  kp = calloc( nkp, <span class="keyword">sizeof</span>( <span class="keywordtype">char</span>));</div>
<div class="line">  <span class="keywordflow">if</span>( kp == NULL) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis_get_obj: Out of memory&quot;</span>);</div>
<div class="line">    exit( -1);</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  snprintf( kp, nkp-1, <span class="stringliteral">&quot;%s.%s&quot;</span>, <a class="code" href="lsredis_8c.html#acdca9095c7a3288d7febe9f4c440a6e9">lsredis_head</a>, k);</div>
<div class="line">  kp[nkp-1] = 0;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>);</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lsredis_8c.html#a7461eb2b5974a2ffac2189007d39193c">lsredis_running</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;<a class="code" href="lsredis_8c.html#a2f63408d16b5603541b124a78f36a5a8">lsredis_cond</a>, &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>);</div>
<div class="line"></div>
<div class="line">  rtn = <a class="code" href="lsredis_8c.html#ac3fb8589e280bfa18ecbca6619fea637" title="Maybe add a new object Used internally for this module Must be called with lsredis_mutex locked...">_lsredis_get_obj</a>( kp);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>);</div>
<div class="line"></div>
<div class="line">  free( kp);</div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="abe31d0e11c41b2235307612c963bb652"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char** lsredis_get_string_array </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00448">448</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                   {</div>
<div class="line">  <span class="keywordtype">char</span> **rtn;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <span class="keywordflow">if</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#ae0aa00ad745ee5bbc598c23ab794ed8a" title="1 if this key does not exist and we haven&#39;t set it yet: read will create and set an empty string valu...">creating</a> != 0) {</div>
<div class="line">    pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">    <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( p, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">    pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>, &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line"></div>
<div class="line">  rtn = p-&gt;<a class="code" href="structlsredis__obj__struct.html#ac065eeede0e08f25bcfedd45022fe593" title="our value as an array of strings">avalue</a>;</div>
<div class="line">  pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="abbb4e5ece19ebd130e1be18036752a08"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsredis_getb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00467">467</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                    {</div>
<div class="line">  <span class="keywordtype">int</span> rtn;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <span class="keywordflow">if</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#ae0aa00ad745ee5bbc598c23ab794ed8a" title="1 if this key does not exist and we haven&#39;t set it yet: read will create and set an empty string valu...">creating</a> != 0) {</div>
<div class="line">    pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">    <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( p, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">    pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">while</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>, &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line"></div>
<div class="line">  rtn = p-&gt;<a class="code" href="structlsredis__obj__struct.html#ac3df3eaa275c1e8e333024c1fa8353af" title="our value as a boolean (1 or 0) -1 means we couldn&#39;t figure it out">bvalue</a>;</div>
<div class="line">  pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}  </div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0b7600b1c9a4550b32d4be019d25f941"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char lsredis_getc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00485">485</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                     {</div>
<div class="line">  <span class="keywordtype">int</span> rtn;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <span class="keywordflow">if</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#ae0aa00ad745ee5bbc598c23ab794ed8a" title="1 if this key does not exist and we haven&#39;t set it yet: read will create and set an empty string valu...">creating</a> != 0) {</div>
<div class="line">    pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">    <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( p, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">    pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">while</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>, &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line"></div>
<div class="line">  rtn = p-&gt;<a class="code" href="structlsredis__obj__struct.html#a4a5933dbd44d33d9f594f6020a443b69" title="just the first character of our value">cvalue</a>;</div>
<div class="line">  pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}  </div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa8daf63b794b6b6341018feec205cb7d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double lsredis_getd </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00384">384</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                       {</div>
<div class="line">  <span class="keywordtype">double</span> rtn;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <span class="keywordflow">if</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#ae0aa00ad745ee5bbc598c23ab794ed8a" title="1 if this key does not exist and we haven&#39;t set it yet: read will create and set an empty string valu...">creating</a> != 0) {</div>
<div class="line">    pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">    <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( p, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">    pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>, &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line"></div>
<div class="line">  rtn = p-&gt;<a class="code" href="structlsredis__obj__struct.html#ab60d0a71cabad6b921b6edb5a8f68996" title="our value as a double">dvalue</a>;</div>
<div class="line">  pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1923f998441f4f451204dfd214d52218"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">long int lsredis_getl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00403">403</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                         {</div>
<div class="line">  <span class="keywordtype">long</span> <span class="keywordtype">int</span> rtn;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <span class="keywordflow">if</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#ae0aa00ad745ee5bbc598c23ab794ed8a" title="1 if this key does not exist and we haven&#39;t set it yet: read will create and set an empty string valu...">creating</a> != 0) {</div>
<div class="line">    pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">    <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( p, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">    pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>, &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line"></div>
<div class="line">  rtn = p-&gt;<a class="code" href="structlsredis__obj__struct.html#a26211a0ab3fc02e7776e24dbc1f1256c" title="our value as a long">lvalue</a>;</div>
<div class="line">  pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}  </div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac1994e56114b2315294527d76311f829"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* lsredis_getstr </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>return a copy of the key's string value be sure to free the result </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00282">282</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                        {</div>
<div class="line">  <span class="keywordtype">char</span> *rtn;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Have to use strdup since we cannot guarantee that p-&gt;value won&#39;t be freed while the caller is still using it</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <span class="keywordflow">while</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>, &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line"></div>
<div class="line">  rtn = strdup(p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0465c65288e8101805a6f91049164517" title="our value">value</a>);</div>
<div class="line">  pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4a7466a8c5b90df6dfc78aef625220f4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize this module, that is, set up the connections. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pub</td><td>Publish under this (unique) name </td></tr>
    <tr><td class="paramname">re</td><td>Regular expression to select keys we want to mirror </td></tr>
    <tr><td class="paramname">head</td><td>Prepend this (+ a dot) to the beginning of requested objects </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l01220">1220</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                    {</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// set up hash map to store redis objects</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  err = hcreate_r( 8192, &amp;<a class="code" href="lsredis_8c.html#a42aec6aa74072797ec0344847b0e9e39">lsredis_htab</a>);</div>
<div class="line">  <span class="keywordflow">if</span>( err == 0) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis_init: Cannot create hash table.  Really bad things are going to happen.  hcreate_r returned %d&quot;</span>, err);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  pthread_cond_init( &amp;<a class="code" href="lsredis_8c.html#a2f63408d16b5603541b124a78f36a5a8">lsredis_cond</a>, NULL);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lsredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a> = redisAsyncConnect(<span class="stringliteral">&quot;127.0.0.1&quot;</span>, 6379);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lsredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;err) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Error: %s&quot;</span>, <a class="code" href="lsredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;errstr);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lsredis_8c.html#a0cd3bdc79d035eb1595371c845d14367">subfd</a>.fd           = <a class="code" href="lsredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;c.fd;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a0cd3bdc79d035eb1595371c845d14367">subfd</a>.events       = 0;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;ev.data     = &amp;<a class="code" href="lsredis_8c.html#a0cd3bdc79d035eb1595371c845d14367">subfd</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;ev.addRead  = <a class="code" href="lsredis_8c.html#adee3bccecc86dd531ac5f89491632439" title="hook to mange read events">lsredis_addRead</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;ev.delRead  = <a class="code" href="lsredis_8c.html#a2e1f2258b3cc864ce3eef4eda556e2a6" title="hook to manage &quot;don&#39;t need to read&quot; events">lsredis_delRead</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;ev.addWrite = <a class="code" href="lsredis_8c.html#a3cb6eda5c8ae80019e7a1c078940e9e9" title="hook to manage write events">lsredis_addWrite</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;ev.delWrite = <a class="code" href="lsredis_8c.html#a04f0119cfa1156dc34d35b237358822a" title="hook to manage &quot;don&#39;t need to write anymore&quot; events">lsredis_delWrite</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;ev.cleanup  = <a class="code" href="lsredis_8c.html#a45f946a5262c23b362be17c2cb0310c2" title="hook to clean up TODO: figure out what we are supposed to do here and do it">lsredis_cleanup</a>;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a> = redisAsyncConnect(<span class="stringliteral">&quot;127.0.0.1&quot;</span>, 6379);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>-&gt;err) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Error: %s&quot;</span>, <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>-&gt;errstr);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lsredis_8c.html#add819e43a356d0575ec64c346c6fed57">rofd</a>.fd           = <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>-&gt;c.fd;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#add819e43a356d0575ec64c346c6fed57">rofd</a>.events       = 0;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>-&gt;ev.data     = &amp;<a class="code" href="lsredis_8c.html#add819e43a356d0575ec64c346c6fed57">rofd</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>-&gt;ev.addRead  = <a class="code" href="lsredis_8c.html#adee3bccecc86dd531ac5f89491632439" title="hook to mange read events">lsredis_addRead</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>-&gt;ev.delRead  = <a class="code" href="lsredis_8c.html#a2e1f2258b3cc864ce3eef4eda556e2a6" title="hook to manage &quot;don&#39;t need to read&quot; events">lsredis_delRead</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>-&gt;ev.addWrite = <a class="code" href="lsredis_8c.html#a3cb6eda5c8ae80019e7a1c078940e9e9" title="hook to manage write events">lsredis_addWrite</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>-&gt;ev.delWrite = <a class="code" href="lsredis_8c.html#a04f0119cfa1156dc34d35b237358822a" title="hook to manage &quot;don&#39;t need to write anymore&quot; events">lsredis_delWrite</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>-&gt;ev.cleanup  = <a class="code" href="lsredis_8c.html#a45f946a5262c23b362be17c2cb0310c2" title="hook to clean up TODO: figure out what we are supposed to do here and do it">lsredis_cleanup</a>;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a> = redisAsyncConnect(<span class="stringliteral">&quot;127.0.0.1&quot;</span>, 6379);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>-&gt;err) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Error: %s&quot;</span>, <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>-&gt;errstr);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lsredis_8c.html#a13acbee14dbe8cdb98e238abb921d048">wrfd</a>.fd           = <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>-&gt;c.fd;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a13acbee14dbe8cdb98e238abb921d048">wrfd</a>.events       = 0;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>-&gt;ev.data     = &amp;<a class="code" href="lsredis_8c.html#a13acbee14dbe8cdb98e238abb921d048">wrfd</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>-&gt;ev.addRead  = <a class="code" href="lsredis_8c.html#adee3bccecc86dd531ac5f89491632439" title="hook to mange read events">lsredis_addRead</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>-&gt;ev.delRead  = <a class="code" href="lsredis_8c.html#a2e1f2258b3cc864ce3eef4eda556e2a6" title="hook to manage &quot;don&#39;t need to read&quot; events">lsredis_delRead</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>-&gt;ev.addWrite = <a class="code" href="lsredis_8c.html#a3cb6eda5c8ae80019e7a1c078940e9e9" title="hook to manage write events">lsredis_addWrite</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>-&gt;ev.delWrite = <a class="code" href="lsredis_8c.html#a04f0119cfa1156dc34d35b237358822a" title="hook to manage &quot;don&#39;t need to write anymore&quot; events">lsredis_delWrite</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>-&gt;ev.cleanup  = <a class="code" href="lsredis_8c.html#a45f946a5262c23b362be17c2cb0310c2" title="hook to clean up TODO: figure out what we are supposed to do here and do it">lsredis_cleanup</a>;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// separate hash table for the presets</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  hcreate_r( <a class="code" href="lsredis_8c.html#ace88a236f88278adaac5419a7281c490">lsredis_preset_max_n</a> * 2, &amp;<a class="code" href="lsredis_8c.html#ade00a383533fdefb2af9f3f53f37cf97">lsredis_preset_ht</a>);</div>
<div class="line"></div>
<div class="line">  pthread_mutex_init( &amp;<a class="code" href="lsredis_8c.html#a1d0b14b31b12d1b2a79dc50eac09de39">lsredis_preset_list_mutex</a>, &amp;<a class="code" href="lsredis_8c.html#a71c9f418904364d65c22d786f4dc5d39">mutex_initializer</a>);</div>
<div class="line">  pthread_mutex_init( &amp;<a class="code" href="lsredis_8c.html#a0c5cbd80d59d69603f123621cc6ddc30">lsredis_config_mutex</a>, &amp;<a class="code" href="lsredis_8c.html#a71c9f418904364d65c22d786f4dc5d39">mutex_initializer</a>);</div>
<div class="line">  pthread_cond_init(  &amp;<a class="code" href="lsredis_8c.html#a6fa076f1004c85a8a1dc400f45547f32">lsredis_config_cond</a>,  NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af48b297b5679750a131fa1e982a078b7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_load_presets </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>motor_name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>update the presets hash table for the named motor </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00864">864</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                             {</div>
<div class="line">  <a class="code" href="structlsredis__obj__struct.html" title="Redis Object Basic object whose value is sychronized with our redis db.">lsredis_obj_t</a> *<a class="code" href="namespacemk__pgpmac__redis.html#a11daf2847f2dc94562b5b61b3f412574">p</a>;</div>
<div class="line">  <a class="code" href="structlsredis__preset__list__struct.html">lsredis_preset_list_t</a> *pl;</div>
<div class="line">  <span class="keywordtype">int</span> plength;</div>
<div class="line">  <span class="keywordtype">char</span> *preset_name;</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">  <span class="keywordtype">int</span> key_length;</div>
<div class="line">  ENTRY entry_in, *entry_outp;</div>
<div class="line"></div>
<div class="line">  p = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.presets.length&quot;</span>, motor_name);</div>
<div class="line">  plength = <a class="code" href="lsredis_8c.html#a71689006ffc015be6a0705a7c0aef1be">lsredis_get_or_set_l</a>( p, 0);</div>
<div class="line">  <span class="keywordflow">if</span>( plength &lt;= 0)</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lsredis_8c.html#a1d0b14b31b12d1b2a79dc50eac09de39">lsredis_preset_list_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;plength; i++) {</div>
<div class="line">    pl = calloc( 1, <span class="keyword">sizeof</span>( <a class="code" href="structlsredis__preset__list__struct.html">lsredis_preset_list_t</a>));</div>
<div class="line">    pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#a285a79dd419ae70c5b75ef57914d3331">name</a>      = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.presets.%d.name&quot;</span>,     motor_name, i);</div>
<div class="line">    pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#ae365a576448adeccb66fbb85cfcf4b23">position</a>  = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.presets.%d.position&quot;</span>, motor_name, i);</div>
<div class="line">    pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#abadcee1d288db4b988946f62bb28d5df">index</a>     = <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">    </div>
<div class="line">    preset_name   = <a class="code" href="lsredis_8c.html#ac1994e56114b2315294527d76311f829" title="return a copy of the key&#39;s string value be sure to free the result">lsredis_getstr</a>( pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#a285a79dd419ae70c5b75ef57914d3331">name</a>);</div>
<div class="line">    key_length    = strlen( motor_name) + strlen( preset_name) + 1;</div>
<div class="line">    pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#ab3a50b52cf845fa70667d8be9ea7d73b">key</a>       = calloc( key_length, 1);</div>
<div class="line"></div>
<div class="line">    pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#a14422c8bfa270e5620c66be871091f67">next</a>            = <a class="code" href="lsredis_8c.html#a232f994f0d91ba8157cbcfe429fc90de">lsredis_preset_list</a>;</div>
<div class="line">    <a class="code" href="lsredis_8c.html#a232f994f0d91ba8157cbcfe429fc90de">lsredis_preset_list</a> = pl;</div>
<div class="line"></div>
<div class="line">    snprintf( pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#ab3a50b52cf845fa70667d8be9ea7d73b">key</a>, key_length, <span class="stringliteral">&quot;%s%s&quot;</span>, motor_name, preset_name);</div>
<div class="line"></div>
<div class="line">    entry_in.key  = pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#ab3a50b52cf845fa70667d8be9ea7d73b">key</a>;</div>
<div class="line">    entry_in.data = pl;</div>
<div class="line">    hsearch_r( entry_in, ENTER, &amp;entry_outp, &amp;<a class="code" href="lsredis_8c.html#ade00a383533fdefb2af9f3f53f37cf97">lsredis_preset_ht</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( entry_outp-&gt;data != pl) {</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// The key was already there or we couldn&#39;t add it</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="keywordflow">if</span>( entry_outp-&gt;data == NULL)</div>
<div class="line">        <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis_load_presets: could not add preset &#39;%s&#39; for motor &#39;%s&#39;&quot;</span>, preset_name, motor_name);</div>
<div class="line"></div>
<div class="line">      free( pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#ab3a50b52cf845fa70667d8be9ea7d73b">key</a>);</div>
<div class="line">      free( pl);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// We&#39;ve successfully added the new key</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <a class="code" href="lsredis_8c.html#adace74d8fa7d2dd58854fa09e66da807">lsredis_preset_n</a>++;</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Resize the hash table if we are starting to fill it up</span></div>
<div class="line">      <span class="comment">// Generally we prefer a sparse table</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="keywordflow">if</span>( <a class="code" href="lsredis_8c.html#adace74d8fa7d2dd58854fa09e66da807">lsredis_preset_n</a> &gt;= <a class="code" href="lsredis_8c.html#ace88a236f88278adaac5419a7281c490">lsredis_preset_max_n</a>) {</div>
<div class="line">        <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis_load_presets: increasing preset hash table size.  max now %d&quot;</span>, <a class="code" href="lsredis_8c.html#ace88a236f88278adaac5419a7281c490">lsredis_preset_max_n</a>);</div>
<div class="line">        hdestroy_r( &amp;<a class="code" href="lsredis_8c.html#ade00a383533fdefb2af9f3f53f37cf97">lsredis_preset_ht</a>);</div>
<div class="line">        <a class="code" href="lsredis_8c.html#ace88a236f88278adaac5419a7281c490">lsredis_preset_max_n</a> *= 2;</div>
<div class="line">        hcreate_r( 2 * <a class="code" href="lsredis_8c.html#ace88a236f88278adaac5419a7281c490">lsredis_preset_max_n</a>, &amp;<a class="code" href="lsredis_8c.html#ade00a383533fdefb2af9f3f53f37cf97">lsredis_preset_ht</a>);</div>
<div class="line">        <span class="keywordflow">for</span>( pl = <a class="code" href="lsredis_8c.html#a232f994f0d91ba8157cbcfe429fc90de">lsredis_preset_list</a>; pl != NULL; pl = pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#a14422c8bfa270e5620c66be871091f67">next</a>) {</div>
<div class="line">          entry_in.key  = pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#ab3a50b52cf845fa70667d8be9ea7d73b">key</a>;</div>
<div class="line">          entry_in.data = pl;</div>
<div class="line">          hsearch_r( entry_in, ENTER, &amp;entry_outp, &amp;<a class="code" href="lsredis_8c.html#ade00a383533fdefb2af9f3f53f37cf97">lsredis_preset_ht</a>);</div>
<div class="line">        }</div>
<div class="line">        <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis_load_presets: done increasing preset hash table size.&quot;</span>, <a class="code" href="lsredis_8c.html#ace88a236f88278adaac5419a7281c490">lsredis_preset_max_n</a>);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    free( preset_name);</div>
<div class="line">  }</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lsredis_8c.html#a1d0b14b31b12d1b2a79dc50eac09de39">lsredis_preset_list_mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a065d09eb6914c057383980d3d786affc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_log </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>send log message to our redis log key </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l01064">1064</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                  {</div>
<div class="line">  <span class="keyword">static</span> <a class="code" href="structlsredis__obj__struct.html" title="Redis Object Basic object whose value is sychronized with our redis db.">lsredis_obj_t</a> *loghashs[32];</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> firstTime = 1;</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> lhi = 0;</div>
<div class="line">  <span class="keywordtype">char</span> msg[2048+64];</div>
<div class="line">  va_list arg_ptr;</div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">if</span>( pthread_mutex_trylock( &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>) == 0) {</div>
<div class="line">    </div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lsredis_8c.html#acdca9095c7a3288d7febe9f4c440a6e9">lsredis_head</a> == NULL) {                 <span class="comment">// Ignore messages that come before redis is initiallized</span></div>
<div class="line">      pthread_mutex_unlock( &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>);</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span>( firstTime) {</div>
<div class="line">      <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">      <span class="keywordflow">for</span>( i=0; i&lt;<span class="keyword">sizeof</span>(loghashs)/<span class="keyword">sizeof</span>(loghashs[0]); i++) {</div>
<div class="line">        loghashs[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>] = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;log.message.%d&quot;</span>, i);</div>
<div class="line">      }</div>
<div class="line">      lhi = 0;</div>
<div class="line">      firstTime=0;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    va_start( arg_ptr, fmt);</div>
<div class="line">    vsnprintf( msg, <span class="keyword">sizeof</span>(msg)-1, fmt, arg_ptr);</div>
<div class="line">    va_end( arg_ptr);</div>
<div class="line">    msg[<span class="keyword">sizeof</span>(msg)-1]=0;</div>
<div class="line">    </div>
<div class="line">    <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( loghashs[lhi], <span class="stringliteral">&quot;%s&quot;</span>, msg);</div>
<div class="line">    lhi = (lhi+1) % (<span class="keyword">sizeof</span>(loghashs)/<span class="keyword">sizeof</span>(loghashs[0]));</div>
<div class="line">    pthread_mutex_unlock( &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>);</div>
<div class="line">    </div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac58fca47533e695c8775e0d2b9128766"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsredis_regexec </td>
          <td>(</td>
          <td class="paramtype">const regex_t *&#160;</td>
          <td class="paramname"><em>preg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>nmatch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">regmatch_t *&#160;</td>
          <td class="paramname"><em>pmatch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>eflags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00265">265</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                                                                           {</div>
<div class="line">  <span class="keywordtype">int</span> rtn;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <span class="keywordflow">while</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> == 0) </div>
<div class="line">    pthread_cond_wait( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>, &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line"></div>
<div class="line">  rtn = regexec( preg, p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0465c65288e8101805a6f91049164517" title="our value">value</a>, nmatch, pmatch, eflags);</div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac3db3d5f91bf5723bd94748ce0d88731"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_t* lsredis_run </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l01437">1437</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                         {</div>
<div class="line">  pthread_create( &amp;<a class="code" href="lsredis_8c.html#a79c33eb11ad6819247930ade3a25671f">lsredis_thread</a>, NULL, <a class="code" href="lsredis_8c.html#ade7b1ddfdc88c6964a4c90513e360f75" title="subscribe to changes and service sockets">lsredis_worker</a>, NULL);</div>
<div class="line">  <span class="keywordflow">return</span> &amp;<a class="code" href="lsredis_8c.html#a79c33eb11ad6819247930ade3a25671f">lsredis_thread</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad4c059ab8209b87131b5c94883a05f39"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_set_preset </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>base</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>preset_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>dval</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>set the given preset to the given value create a new preset if we can't find it </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00974">974</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                                           {</div>
<div class="line">  <span class="keywordtype">char</span> s[512];</div>
<div class="line">  <span class="keywordtype">int</span> plength;</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line">  ENTRY entry_in, *entry_outp;</div>
<div class="line">  <a class="code" href="structlsredis__obj__struct.html" title="Redis Object Basic object whose value is sychronized with our redis db.">lsredis_obj_t</a> *p1, *p2, *presets_length_p;</div>
<div class="line">  <a class="code" href="structlsredis__preset__list__struct.html">lsredis_preset_list_t</a> *pl;</div>
<div class="line">  <span class="keyword">struct </span>timespec timeout;</div>
<div class="line"></div>
<div class="line">  snprintf( s, <span class="keyword">sizeof</span>( s)-1, <span class="stringliteral">&quot;%s%s&quot;</span>, motor_name, preset_name);</div>
<div class="line">  s[<span class="keyword">sizeof</span>(s)-1] = 0;</div>
<div class="line"></div>
<div class="line">  entry_in.key  = s;</div>
<div class="line">  entry_in.data = NULL;</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lsredis_8c.html#a1d0b14b31b12d1b2a79dc50eac09de39">lsredis_preset_list_mutex</a>);</div>
<div class="line">  err = hsearch_r( entry_in, FIND, &amp;entry_outp, &amp;<a class="code" href="lsredis_8c.html#ade00a383533fdefb2af9f3f53f37cf97">lsredis_preset_ht</a>);</div>
<div class="line">  <span class="keywordflow">if</span>( err != 0) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Found it.  Things are simple.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    pthread_mutex_unlock( &amp;p1-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    pl = entry_outp-&gt;data;</div>
<div class="line">    <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#ae365a576448adeccb66fbb85cfcf4b23">position</a>, <span class="stringliteral">&quot;%.3f&quot;</span>, dval);</div>
<div class="line">    pthread_mutex_unlock( &amp;<a class="code" href="lsredis_8c.html#a1d0b14b31b12d1b2a79dc50eac09de39">lsredis_preset_list_mutex</a>);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// OK, our preset was not found, add it</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  presets_length_p = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>(  <span class="stringliteral">&quot;%s.presets.length&quot;</span>, motor_name);</div>
<div class="line">  plength = <a class="code" href="lsredis_8c.html#a71689006ffc015be6a0705a7c0aef1be">lsredis_get_or_set_l</a>( presets_length_p, 0);</div>
<div class="line">  plength += 1;</div>
<div class="line"></div>
<div class="line">  snprintf( s, <span class="keyword">sizeof</span>( s)-1, <span class="stringliteral">&quot;%s.%s.presets.%d.name&quot;</span>, <a class="code" href="lsredis_8c.html#acdca9095c7a3288d7febe9f4c440a6e9">lsredis_head</a>, motor_name, plength-1);</div>
<div class="line">  s[<span class="keyword">sizeof</span>(s)-1] = 0;</div>
<div class="line"></div>
<div class="line">  p1 = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.presets.%d.name&quot;</span>, motor_name, plength-1);</div>
<div class="line">  pthread_mutex_lock( &amp;p1-&gt;mutex);</div>
<div class="line">  err = 0;</div>
<div class="line">  <span class="keywordflow">while</span>( err == 0 &amp;&amp; p1-&gt;valid == 0)</div>
<div class="line">    err = pthread_cond_timedwait( &amp;p1-&gt;cond, &amp;p1-&gt;mutex, &amp;timeout);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( err == ETIMEDOUT) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis_set_preset: timed out waiting for name to become valid&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  pthread_mutex_unlock( &amp;p1-&gt;mutex);</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( p1, <span class="stringliteral">&quot;%s&quot;</span>, preset_name);</div>
<div class="line">  </div>
<div class="line">  p2 = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.presets.%d.position&quot;</span>, motor_name, plength-1);</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( p2, <span class="stringliteral">&quot;%.3f&quot;</span>, dval);</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( presets_length_p, <span class="stringliteral">&quot;%ld&quot;</span>, plength);</div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lsredis_8c.html#a1d0b14b31b12d1b2a79dc50eac09de39">lsredis_preset_list_mutex</a>);</div>
<div class="line">  <a class="code" href="lsredis_8c.html#af48b297b5679750a131fa1e982a078b7" title="update the presets hash table for the named motor">lsredis_load_presets</a>( motor_name);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9b9c64f883c7ded60badfe89cb15fa78"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_setstr </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the value and update redis. </p>
<p>Note that lsredis_set_value sets the value based on redis while here we set redis based on the value Arbitray maximum string length set here. TODO: Probably this limit should be removed at some point.</p>
<p>redisAsyncCommandArgv used instead of redisAsyncCommand 'cause it's easier (and possible) to deal with strings that would otherwise cause hiredis to emit a bad command, like those containing spaces. </p>
<p>&lt; up the count of times we need to see ourselves published before we start listening to others again</p>
<p>&lt; Unlock to prevent deadlock in case the service routine needs to set our value</p>
<p>&lt; redisAsyncCommandArgv shouldn't need to access this after it's made up it's packet (before it returns) so we should be OK with this location disappearing soon.</p>
<p>&lt; At this point the key is considered created </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00307">307</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                       {</div>
<div class="line">  va_list arg_ptr;</div>
<div class="line">  <span class="keywordtype">char</span> <a class="code" href="namespacemk__pgpmac__redis.html#ac732d49b0afca9a9951e3a252bae42fc">v</a>[512];</div>
<div class="line">  <span class="keywordtype">char</span> *argv[4];</div>
<div class="line"></div>
<div class="line">  va_start( arg_ptr, fmt);</div>
<div class="line">  vsnprintf( v, <span class="keyword">sizeof</span>(v)-1, fmt, arg_ptr);</div>
<div class="line">  v[<span class="keyword">sizeof</span>(<a class="code" href="namespacemk__pgpmac__redis.html#ac732d49b0afca9a9951e3a252bae42fc">v</a>)-1] = 0;</div>
<div class="line">  va_end( arg_ptr);</div>
<div class="line">  </div>
<div class="line">  pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Don&#39;t send an update if a good value has not changed</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#ae0aa00ad745ee5bbc598c23ab794ed8a" title="1 if this key does not exist and we haven&#39;t set it yet: read will create and set an empty string valu...">creating</a> != 0 &amp;&amp; p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> &amp;&amp; strcmp( v, p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0465c65288e8101805a6f91049164517" title="our value">value</a>) == 0) {</div>
<div class="line">    <span class="comment">// nothing to do</span></div>
<div class="line">    pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  p-&gt;<a class="code" href="structlsredis__obj__struct.html#a8bc1a536b7155a1e2a749c7c434b898b" title="Number of times we need to see our publication before we start accepting new values.">wait_for_me</a>++;                     </div>
<div class="line">  pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);     </div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  argv[0] = <span class="stringliteral">&quot;HSET&quot;</span>;</div>
<div class="line">  argv[1] = p-&gt;<a class="code" href="structlsredis__obj__struct.html#aa8c5a453b9424e5666320b8675a42f5c" title="The redis key for this object.">key</a>;</div>
<div class="line">  argv[2] = <span class="stringliteral">&quot;VALUE&quot;</span>;</div>
<div class="line">  argv[3] = <a class="code" href="namespacemk__pgpmac__redis.html#ac732d49b0afca9a9951e3a252bae42fc">v</a>;          </div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>);</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lsredis_8c.html#a7461eb2b5974a2ffac2189007d39193c">lsredis_running</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;<a class="code" href="lsredis_8c.html#a2f63408d16b5603541b124a78f36a5a8">lsredis_cond</a>, &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>);</div>
<div class="line"></div>
<div class="line">  redisAsyncCommand( <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>, NULL, NULL, <span class="stringliteral">&quot;MULTI&quot;</span>);</div>
<div class="line">  redisAsyncCommandArgv( <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>, NULL, NULL, 4, (<span class="keyword">const</span> <span class="keywordtype">char</span> **)argv, NULL);</div>
<div class="line"></div>
<div class="line">  redisAsyncCommand( <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>, NULL, NULL, <span class="stringliteral">&quot;PUBLISH %s %s&quot;</span>, <a class="code" href="lsredis_8c.html#a0c81dce2e75584eeb14ab7d9dd86c72e">lsredis_publisher</a>, p-&gt;<a class="code" href="structlsredis__obj__struct.html#aa8c5a453b9424e5666320b8675a42f5c" title="The redis key for this object.">key</a>);</div>
<div class="line">  redisAsyncCommand( <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>, NULL, NULL, <span class="stringliteral">&quot;EXEC&quot;</span>);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Assume redis will take exactly the value we sent it</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a05c7ed2bb1b5702a5c83ed3b51abb546" title="set_value and setstr helper funciton p-&gt;mutex must be locked before calling">_lsredis_set_value</a>( p, v);</div>
<div class="line">  p-&gt;<a class="code" href="structlsredis__obj__struct.html#ae0aa00ad745ee5bbc598c23ab794ed8a" title="1 if this key does not exist and we haven&#39;t set it yet: read will create and set an empty string valu...">creating</a> = 0;                      </div>
<div class="line">  pthread_cond_signal( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>);</div>
<div class="line">  pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7b84b6a923167d84c1aefbd2241864c3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lstest_main </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lstest_8c_source.html#l00092">92</a> of file <a class="el" href="lstest_8c_source.html">lstest.c</a>.</p>
<div class="fragment"><div class="line">                   {</div>
<div class="line">  <a class="code" href="lstest_8c.html#acaa27d0c837aa325ad6b6212e67b182d">lstest_lspmac_est_move_time</a>();</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8cd37a8fb0f061456456a5d79bdd5189"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lstimer_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the timer list and pthread stuff. </p>

<p>Definition at line <a class="el" href="lstimer_8c_source.html#l00270">270</a> of file <a class="el" href="lstimer_8c_source.html">lstimer.c</a>.</p>
<div class="fragment"><div class="line">                    {</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;<a class="code" href="lstimer_8c.html#af020a0f708e86162a32d2ca6373c96bb" title="We&#39;ll allow this many timers. This should be way more than enough.">LSTIMER_LIST_LENGTH</a>; i++) {</div>
<div class="line">    <a class="code" href="lstimer_8c.html#a35b456765fe2c955cef445768d12ca6c" title="Our timer list.">lstimer_list</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>].<a class="code" href="structlstimer__list__struct.html#ac7ab4cd1f3065156f95b49e66bf05283" title="run this many times: -1 means reload forever, 0 means we are done with this timer and it may be reuse...">shots</a> = 0;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  pthread_mutex_init( &amp;<a class="code" href="lstimer_8c.html#a170993cbed9b9ec8bc64b6642a3ed581" title="protect the timer list">lstimer_mutex</a>, NULL);</div>
<div class="line">  pthread_cond_init(  &amp;<a class="code" href="lstimer_8c.html#a96b7516e4a15c4b879de82a569cd5f0a" title="allows us to be idle when there is nothing to do">lstimer_cond</a>, NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa9fdc057e219c162d67c5cb77a2bf7a4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_t* lstimer_run </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start up our thread. </p>

<p>Definition at line <a class="el" href="lstimer_8c_source.html#l00284">284</a> of file <a class="el" href="lstimer_8c_source.html">lstimer.c</a>.</p>
<div class="fragment"><div class="line">                         {</div>
<div class="line">  pthread_create( &amp;<a class="code" href="lstimer_8c.html#a76660e8720b08f4adee2be9f44b5f419" title="the timer thread">lstimer_thread</a>, NULL, <a class="code" href="lstimer_8c.html#ab8b409bb2a7ff78da22d988cfb3b537a" title="Our worker.">lstimer_worker</a>, NULL);</div>
<div class="line">  <span class="keywordflow">return</span> &amp;<a class="code" href="lstimer_8c.html#a76660e8720b08f4adee2be9f44b5f419" title="the timer thread">lstimer_thread</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a264897effdf49ed8d5aa34e8ed05c2d3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lstimer_set_timer </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>shots</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long int&#160;</td>
          <td class="paramname"><em>secs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long int&#160;</td>
          <td class="paramname"><em>nsecs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a timer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">event</td><td>Name of the event to send when the timer goes off </td></tr>
    <tr><td class="paramname">shots</td><td>Number of times to run. 0 means never, -1 means forever </td></tr>
    <tr><td class="paramname">secs</td><td>Number of seconds to wait </td></tr>
    <tr><td class="paramname">nsecs</td><td>Number of nano-seconds to run in addition to secs </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lstimer_8c_source.html#l00063">63</a> of file <a class="el" href="lstimer_8c_source.html">lstimer.c</a>.</p>
<div class="fragment"><div class="line">                                                                                                 {</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">  <span class="keyword">struct </span>timespec <a class="code" href="kvredis_8c.html#ad40ac52086f6b774928af45b09d54c6e" title="used to ensure we do not inundate the db server with connection requests">now</a>;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Time we were called.  Delay is based on call time, not queued time</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  clock_gettime( CLOCK_REALTIME, &amp;<a class="code" href="kvredis_8c.html#ad40ac52086f6b774928af45b09d54c6e" title="used to ensure we do not inundate the db server with connection requests">now</a>);</div>
<div class="line">  </div>
<div class="line"></div>
<div class="line">  <span class="comment">// Make sure our event is registered (saves a tiny bit of time later)</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <a class="code" href="lsevents_8c.html#ae09cfa92dba806d8f8808e5822ea713c">lsevents_preregister_event</a>( event);</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lstimer_8c.html#a170993cbed9b9ec8bc64b6642a3ed581" title="protect the timer list">lstimer_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;<a class="code" href="lstimer_8c.html#af020a0f708e86162a32d2ca6373c96bb" title="We&#39;ll allow this many timers. This should be way more than enough.">LSTIMER_LIST_LENGTH</a>; i++) {</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lstimer_8c.html#a35b456765fe2c955cef445768d12ca6c" title="Our timer list.">lstimer_list</a>[i].shots == 0)</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( i == LSTIMER_LIST_LENGTH) {</div>
<div class="line">    pthread_mutex_unlock( &amp;<a class="code" href="lstimer_8c.html#a170993cbed9b9ec8bc64b6642a3ed581" title="protect the timer list">lstimer_mutex</a>);</div>
<div class="line">    </div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lstimer_set_timer: out of timers for event: %s, shots: %d,  secs: %u, nsecs: %u&quot;</span>,</div>
<div class="line">                          event, shots, secs, nsecs);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  strncpy( <a class="code" href="lstimer_8c.html#a35b456765fe2c955cef445768d12ca6c" title="Our timer list.">lstimer_list</a>[i].event, event, <a class="code" href="pgpmac_8h.html#ab61d790b5572f116e091babfda53627b" title="Fixed length for event names: simplifies string handling.">LSEVENTS_EVENT_LENGTH</a> - 1);</div>
<div class="line">  <a class="code" href="lstimer_8c.html#a35b456765fe2c955cef445768d12ca6c" title="Our timer list.">lstimer_list</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>].<a class="code" href="structlstimer__list__struct.html#a54d564e392315b2730278bb925803184" title="the event to send">event</a>[<a class="code" href="pgpmac_8h.html#ab61d790b5572f116e091babfda53627b" title="Fixed length for event names: simplifies string handling.">LSEVENTS_EVENT_LENGTH</a> - 1] = 0;</div>
<div class="line">  <a class="code" href="lstimer_8c.html#a35b456765fe2c955cef445768d12ca6c" title="Our timer list.">lstimer_list</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>].<a class="code" href="structlstimer__list__struct.html#ac7ab4cd1f3065156f95b49e66bf05283" title="run this many times: -1 means reload forever, 0 means we are done with this timer and it may be reuse...">shots</a>        = shots;</div>
<div class="line">  <a class="code" href="lstimer_8c.html#a35b456765fe2c955cef445768d12ca6c" title="Our timer list.">lstimer_list</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>].<a class="code" href="structlstimer__list__struct.html#aa5eac664fe8159916bc3cdfbf583f818" title="number of seconds for a periodic delay">delay_secs</a>   = secs;</div>
<div class="line">  <a class="code" href="lstimer_8c.html#a35b456765fe2c955cef445768d12ca6c" title="Our timer list.">lstimer_list</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>].<a class="code" href="structlstimer__list__struct.html#a45e9fc0b669a1b2831d46b465822344c" title="nano seconds of delay">delay_nsecs</a>  = nsecs;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lstimer_8c.html#a35b456765fe2c955cef445768d12ca6c" title="Our timer list.">lstimer_list</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>].<a class="code" href="structlstimer__list__struct.html#a6a7538fafa77c5769c8dd2bdd34500b7" title="epoch (seconds) of next alarm">next_secs</a>    = secs + <a class="code" href="kvredis_8c.html#ad40ac52086f6b774928af45b09d54c6e" title="used to ensure we do not inundate the db server with connection requests">now</a>.tv_sec + (<a class="code" href="kvredis_8c.html#ad40ac52086f6b774928af45b09d54c6e" title="used to ensure we do not inundate the db server with connection requests">now</a>.tv_nsec + nsecs) / 1000000000;</div>
<div class="line">  <a class="code" href="lstimer_8c.html#a35b456765fe2c955cef445768d12ca6c" title="Our timer list.">lstimer_list</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>].<a class="code" href="structlstimer__list__struct.html#acf993c87ab0ee8ffd74c3907022d6996" title="nano seconds of next alarm">next_nsecs</a>   = (<a class="code" href="kvredis_8c.html#ad40ac52086f6b774928af45b09d54c6e" title="used to ensure we do not inundate the db server with connection requests">now</a>.tv_nsec + nsecs) % 1000000000;</div>
<div class="line">  <a class="code" href="lstimer_8c.html#a35b456765fe2c955cef445768d12ca6c" title="Our timer list.">lstimer_list</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>].<a class="code" href="structlstimer__list__struct.html#a8f881e66431efbed84b6ad029757bc67" title="the last time this timer was triggered">last_secs</a>    = 0;</div>
<div class="line">  <a class="code" href="lstimer_8c.html#a35b456765fe2c955cef445768d12ca6c" title="Our timer list.">lstimer_list</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>].<a class="code" href="structlstimer__list__struct.html#a0b2ab04246481397116ac9770c3c6603" title="the last time this timer was triggered">last_nsecs</a>   = 0;</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="lstimer_8c.html#a35b456765fe2c955cef445768d12ca6c" title="Our timer list.">lstimer_list</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>].<a class="code" href="structlstimer__list__struct.html#aa56c5b8ce7fa0ae93132cb9908195836" title="track how many times we triggered a callback (like an unsigned long int is really needed)...">ncalls</a>       = 0;</div>
<div class="line">  <a class="code" href="lstimer_8c.html#a35b456765fe2c955cef445768d12ca6c" title="Our timer list.">lstimer_list</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>].<a class="code" href="structlstimer__list__struct.html#a9633d830ecdce7852530079bb09a6d3c" title="our initialization time">init_secs</a>    = <a class="code" href="kvredis_8c.html#ad40ac52086f6b774928af45b09d54c6e" title="used to ensure we do not inundate the db server with connection requests">now</a>.tv_sec;</div>
<div class="line">  <a class="code" href="lstimer_8c.html#a35b456765fe2c955cef445768d12ca6c" title="Our timer list.">lstimer_list</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>].<a class="code" href="structlstimer__list__struct.html#a72665e0a227b5ee0c82aee43dfaf440a" title="our initialization time">init_nsecs</a>   = <a class="code" href="kvredis_8c.html#ad40ac52086f6b774928af45b09d54c6e" title="used to ensure we do not inundate the db server with connection requests">now</a>.tv_nsec;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( shots != 0) {</div>
<div class="line">    <a class="code" href="lstimer_8c.html#a1a47dadbec1776920ab83409234c1833" title="count of the number timers we are tracking">lstimer_active_timers</a>++;</div>
<div class="line">    <a class="code" href="lstimer_8c.html#a5a3c6ef3507448d284d91958878d3f75" title="indicate that a new timer exists and a call to service_timers is required">new_timer</a>++;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  pthread_cond_signal(  &amp;<a class="code" href="lstimer_8c.html#a96b7516e4a15c4b879de82a569cd5f0a" title="allows us to be idle when there is nothing to do">lstimer_cond</a>);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lstimer_8c.html#a170993cbed9b9ec8bc64b6642a3ed581" title="protect the timer list">lstimer_mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5738e4146b4691aad038b622b0381cac"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lstimer_unset_timer </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unsets all timers for the given event. </p>

<p>Definition at line <a class="el" href="lstimer_8c_source.html#l00046">46</a> of file <a class="el" href="lstimer_8c_source.html">lstimer.c</a>.</p>
<div class="fragment"><div class="line">                                       {</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;<a class="code" href="lstimer_8c.html#af020a0f708e86162a32d2ca6373c96bb" title="We&#39;ll allow this many timers. This should be way more than enough.">LSTIMER_LIST_LENGTH</a>; i++) {</div>
<div class="line">    <span class="keywordflow">if</span>( strcmp( event, <a class="code" href="lstimer_8c.html#a35b456765fe2c955cef445768d12ca6c" title="Our timer list.">lstimer_list</a>[i].event) == 0) {</div>
<div class="line">      <a class="code" href="lstimer_8c.html#a35b456765fe2c955cef445768d12ca6c" title="Our timer list.">lstimer_list</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>].<a class="code" href="structlstimer__list__struct.html#ac7ab4cd1f3065156f95b49e66bf05283" title="run this many times: -1 means reload forever, 0 means we are done with this timer and it may be reuse...">shots</a> = 0;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adf63440ffbc65024fef87ea6a11ea8b0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsupdate_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="aebca330b67b5150d8fd5ae57bec80bf6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_t* lsupdate_run </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a0851b1baecda6a67993efde41d77b1c1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void md2cmds_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the md2cmds module. </p>

<p>Definition at line <a class="el" href="md2cmds_8c_source.html#l01984">1984</a> of file <a class="el" href="md2cmds_8c_source.html">md2cmds.c</a>.</p>
<div class="fragment"><div class="line">                    {</div>
<div class="line">  ENTRY hloader, *hrtnval;</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>, err;</div>
<div class="line">  <span class="keywordtype">int</span> ncmds;</div>
<div class="line"></div>
<div class="line">  pthread_mutexattr_t <a class="code" href="lsredis_8c.html#a71c9f418904364d65c22d786f4dc5d39">mutex_initializer</a>;</div>
<div class="line"></div>
<div class="line">  pthread_mutexattr_init( &amp;mutex_initializer);</div>
<div class="line">  pthread_mutexattr_settype( &amp;mutex_initializer, PTHREAD_MUTEX_RECURSIVE);</div>
<div class="line"></div>
<div class="line">  pthread_mutex_init( &amp;<a class="code" href="md2cmds_8c.html#ad67304bb851dc6268b0cda2f40fc5aa8" title="mutex for the condition">md2cmds_mutex</a>, &amp;mutex_initializer);</div>
<div class="line">  pthread_cond_init( &amp;<a class="code" href="md2cmds_8c.html#a08d5b18ec9478d753c46a3e28d1f2126" title="condition to signal when it&#39;s time to run an md2 command">md2cmds_cond</a>, NULL);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  pthread_mutex_init( &amp;<a class="code" href="md2cmds_8c.html#a4ea6e6bf63aefcd49f87c3921029451d" title="message passing between md2cmds and pg">md2cmds_moving_mutex</a>, &amp;mutex_initializer);</div>
<div class="line">  pthread_cond_init(  &amp;<a class="code" href="md2cmds_8c.html#adeebdb8f552bff14bd666c187505ee9e" title="wait for command to have been dequeued and run">md2cmds_moving_cond</a>, NULL);</div>
<div class="line"></div>
<div class="line">  pthread_mutex_init( &amp;<a class="code" href="md2cmds_8c.html#acb54710bbbc6ea638326e93071900d1b" title="our mutex;">md2cmds_homing_mutex</a>, &amp;mutex_initializer);</div>
<div class="line">  pthread_cond_init(  &amp;<a class="code" href="md2cmds_8c.html#ac8e45a64495062e32b7887651627f46d" title="coordinate homing and homed">md2cmds_homing_cond</a>, NULL);</div>
<div class="line"></div>
<div class="line">  err = regcomp( &amp;<a class="code" href="md2cmds_8c.html#ad07af354194cb9a8eac1f200257dcacd">md2cmds_cmd_regex</a>, <span class="stringliteral">&quot; *([^ ]+) (([^ ]+)\\.presets\\..)*([^ ]*) *([^ ]*)&quot;</span>, REG_EXTENDED);</div>
<div class="line">  <span class="keywordflow">if</span>( err != 0) {</div>
<div class="line">    <span class="keywordtype">int</span> nerrmsg;</div>
<div class="line">    <span class="keywordtype">char</span> *errmsg;</div>
<div class="line"></div>
<div class="line">    nerrmsg = regerror( err, &amp;<a class="code" href="md2cmds_8c.html#ad07af354194cb9a8eac1f200257dcacd">md2cmds_cmd_regex</a>, NULL, 0);</div>
<div class="line">    <span class="keywordflow">if</span>( nerrmsg &gt; 0) {</div>
<div class="line">      errmsg = calloc( nerrmsg, <span class="keyword">sizeof</span>( <span class="keywordtype">char</span>));</div>
<div class="line">      nerrmsg = regerror( err, &amp;<a class="code" href="md2cmds_8c.html#ad07af354194cb9a8eac1f200257dcacd">md2cmds_cmd_regex</a>, errmsg, nerrmsg);</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;md2cmds_init: %s&quot;</span>, errmsg);</div>
<div class="line">      free( errmsg);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="md2cmds_8c.html#a6a34fb6876abbd580629d3708c805e7f">md2cmds_md_status_code</a> = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;md2_status_code&quot;</span>);</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( <a class="code" href="md2cmds_8c.html#a6a34fb6876abbd580629d3708c805e7f">md2cmds_md_status_code</a>, <span class="stringliteral">&quot;7&quot;</span>);</div>
<div class="line"></div>
<div class="line">  ncmds = <span class="keyword">sizeof</span>(<a class="code" href="md2cmds_8c.html#a2bb0a14593ac87833ec2151282098d64">md2cmds_cmd_kvs</a>)/<span class="keyword">sizeof</span>(<a class="code" href="md2cmds_8c.html#a2bb0a14593ac87833ec2151282098d64">md2cmds_cmd_kvs</a>[0]);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="pgpmac_8c.html#ae002f31c03cce9bf96cf0e0c2907cb2b" title="non-zero to start up lspg thread, 0 to not (reids hash PG in config.HOSTNAME sets this)...">pgpmac_use_pg</a>) {</div>
<div class="line">    ncmds += <span class="keyword">sizeof</span>(<a class="code" href="md2cmds_8c.html#a536297b42e6510e136b202957da7244f">md2cmds_cmd_pg_kvs</a>)/<span class="keyword">sizeof</span>(<a class="code" href="md2cmds_8c.html#a536297b42e6510e136b202957da7244f">md2cmds_cmd_pg_kvs</a>[0]);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  hcreate_r( 2 * ncmds, &amp;<a class="code" href="md2cmds_8c.html#a625a7f2c3447a5ed7b6a1f9b0827d0c1">md2cmds_hmap</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;<span class="keyword">sizeof</span>(<a class="code" href="md2cmds_8c.html#a2bb0a14593ac87833ec2151282098d64">md2cmds_cmd_kvs</a>)/<span class="keyword">sizeof</span>(<a class="code" href="md2cmds_8c.html#a2bb0a14593ac87833ec2151282098d64">md2cmds_cmd_kvs</a>[0]); i++) {</div>
<div class="line">    hloader.key  = <a class="code" href="md2cmds_8c.html#a2bb0a14593ac87833ec2151282098d64">md2cmds_cmd_kvs</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>].<a class="code" href="structmd2cmds__cmd__kv__struct.html#a4cd5cce8339ed8cc9f0a5835a9bc5c69">k</a>;</div>
<div class="line">    hloader.data = <a class="code" href="md2cmds_8c.html#a2bb0a14593ac87833ec2151282098d64">md2cmds_cmd_kvs</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>].<a class="code" href="structmd2cmds__cmd__kv__struct.html#ab12171e8ea4148dedcb13673e05ca92c">v</a>;</div>
<div class="line">    err = hsearch_r( hloader, ENTER, &amp;hrtnval, &amp;<a class="code" href="md2cmds_8c.html#a625a7f2c3447a5ed7b6a1f9b0827d0c1">md2cmds_hmap</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( err == 0) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;md2cmds_init: hsearch_r returned an error for item %d: %s&quot;</span>, i, strerror( errno));</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="pgpmac_8c.html#ae002f31c03cce9bf96cf0e0c2907cb2b" title="non-zero to start up lspg thread, 0 to not (reids hash PG in config.HOSTNAME sets this)...">pgpmac_use_pg</a>) {</div>
<div class="line">    <span class="keywordflow">for</span>( i=0; i&lt;<span class="keyword">sizeof</span>(<a class="code" href="md2cmds_8c.html#a536297b42e6510e136b202957da7244f">md2cmds_cmd_pg_kvs</a>)/<span class="keyword">sizeof</span>(<a class="code" href="md2cmds_8c.html#a536297b42e6510e136b202957da7244f">md2cmds_cmd_pg_kvs</a>[0]); i++) {</div>
<div class="line">      hloader.key  = <a class="code" href="md2cmds_8c.html#a536297b42e6510e136b202957da7244f">md2cmds_cmd_pg_kvs</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>].<a class="code" href="structmd2cmds__cmd__kv__struct.html#a4cd5cce8339ed8cc9f0a5835a9bc5c69">k</a>;</div>
<div class="line">      hloader.data = <a class="code" href="md2cmds_8c.html#a536297b42e6510e136b202957da7244f">md2cmds_cmd_pg_kvs</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>].<a class="code" href="structmd2cmds__cmd__kv__struct.html#ab12171e8ea4148dedcb13673e05ca92c">v</a>;</div>
<div class="line">      err = hsearch_r( hloader, ENTER, &amp;hrtnval, &amp;<a class="code" href="md2cmds_8c.html#a625a7f2c3447a5ed7b6a1f9b0827d0c1">md2cmds_hmap</a>);</div>
<div class="line">      <span class="keywordflow">if</span>( err == 0) {</div>
<div class="line">        <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;md2cmds_init: hsearch_r returned an error for item %d: %s&quot;</span>, i, strerror( errno));</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae2ecf1ddb756452728eba479f36b486b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void md2cmds_push_queue </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>action</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="md2cmds_8c_source.html#l00079">79</a> of file <a class="el" href="md2cmds_8c_source.html">md2cmds.c</a>.</p>
<div class="fragment"><div class="line">                                       {</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( pthread_mutex_trylock( &amp;<a class="code" href="md2cmds_8c.html#ad67304bb851dc6268b0cda2f40fc5aa8" title="mutex for the condition">md2cmds_mutex</a>) == 0) {</div>
<div class="line">    strncpy( <a class="code" href="md2cmds_8c.html#a5f0fe1e2dfa92cf345b8c29134ab1ede" title="our command;">md2cmds_cmd</a>, action, <a class="code" href="pgpmac_8h.html#a30f0f377b0f0695284145d420ea51846">MD2CMDS_CMD_LENGTH</a>-1);</div>
<div class="line">    <a class="code" href="md2cmds_8c.html#a5f0fe1e2dfa92cf345b8c29134ab1ede" title="our command;">md2cmds_cmd</a>[<a class="code" href="pgpmac_8h.html#a30f0f377b0f0695284145d420ea51846">MD2CMDS_CMD_LENGTH</a>-1] = 0;</div>
<div class="line">    pthread_cond_signal( &amp;<a class="code" href="md2cmds_8c.html#a08d5b18ec9478d753c46a3e28d1f2126" title="condition to signal when it&#39;s time to run an md2 command">md2cmds_cond</a>);</div>
<div class="line">    pthread_mutex_unlock( &amp;<a class="code" href="md2cmds_8c.html#ad67304bb851dc6268b0cda2f40fc5aa8" title="mutex for the condition">md2cmds_mutex</a>);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;md2cmds_push_queue: MD2 command &#39;%s&#39; ignored.  Already running &#39;%s&#39;&quot;</span>, action, <a class="code" href="md2cmds_8c.html#a5f0fe1e2dfa92cf345b8c29134ab1ede" title="our command;">md2cmds_cmd</a>);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="abc5270ece18fe48a49947378438049cf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_t* md2cmds_run </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start up the thread. </p>

<p>Definition at line <a class="el" href="md2cmds_8c_source.html#l02051">2051</a> of file <a class="el" href="md2cmds_8c_source.html">md2cmds.c</a>.</p>
<div class="fragment"><div class="line">                         {</div>
<div class="line">  pthread_create( &amp;<a class="code" href="md2cmds_8c.html#aa230921945149692de98fff15c01962f">md2cmds_thread</a>, NULL,                <a class="code" href="md2cmds_8c.html#ae967e769d23555a631f615e630f25b00" title="Our worker thread.">md2cmds_worker</a>, NULL);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^omega crossed zero$&quot;</span>,        <a class="code" href="md2cmds_8c.html#aa43887b7c9799bc88d51df13745d0e5c" title="Tell the database about the time we went through omega=zero.">md2cmds_rotate_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^omega In Position$&quot;</span>,         <a class="code" href="md2cmds_8c.html#a136f278c9f5a2742b2e9b4987b063faa" title="Now that we are done with the 360 rotation lets rehome right quick.">md2cmds_maybe_rotate_done_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;.+ (Moving|In Position)$&quot;</span>,    <a class="code" href="md2cmds_8c.html#a3970ef1a233dabcc5c1408e9d3865f13" title="Track how many motors are moving.">md2cmds_maybe_done_moving_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;(.+) (Homing|Homed)$&quot;</span>,        <a class="code" href="md2cmds_8c.html#ad0618ee44e2e800c445d7d8726ec8ec2" title="Track motors homing.">md2cmds_maybe_done_homing_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^capz (Moving|In Position)$&quot;</span>, <a class="code" href="md2cmds_8c.html#aab9e2aa02903648acc342068f0664a96" title="Time the capillary motion for the transfer routine.">md2cmds_time_capz_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^Coordsys 1 Stopped$&quot;</span>,        <a class="code" href="md2cmds_8c.html#a4cf5215fdb88407144f582d829c03c7b">md2cmds_coordsys_1_stopped_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^Coordsys 2 Stopped$&quot;</span>,        <a class="code" href="md2cmds_8c.html#a1ab8f6d08c82ee2130202d65d44ef3fe">md2cmds_coordsys_2_stopped_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^Coordsys 3 Stopped$&quot;</span>,        <a class="code" href="md2cmds_8c.html#a3640785c2fc9cd2f27ce0bafd7959179">md2cmds_coordsys_3_stopped_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^Coordsys 4 Stopped$&quot;</span>,        <a class="code" href="md2cmds_8c.html#a6069cb2f6e9f662edd54e1aeb6e78370">md2cmds_coordsys_4_stopped_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^Coordsys 5 Stopped$&quot;</span>,        <a class="code" href="md2cmds_8c.html#a846ed10de4e5ad48cfa429a93c853308">md2cmds_coordsys_5_stopped_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^Coordsys 7 Stopped$&quot;</span>,        <a class="code" href="md2cmds_8c.html#ab172a83eaf3e74799159e6720e4f5268">md2cmds_coordsys_7_stopped_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^cam.zoom Moving$&quot;</span>,           <a class="code" href="md2cmds_8c.html#a4eb608d012f8a471671e10fb19b366d6" title="Fix up xscale and yscale when zoom changes xscale and yscale have units of microns per pixel...">md2cmds_set_scale_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^(align\\.(x|y|z)|centering.(x|y)) In Position$&quot;</span>, <a class="code" href="md2cmds_8c.html#ad6a28dfbe2ca3180364be779a461ae1d" title="Save centering and alignment stage positions to restore on restart.">md2cmds_ca_last_cb</a>);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> &amp;<a class="code" href="md2cmds_8c.html#aa230921945149692de98fff15c01962f">md2cmds_thread</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7762ca7b97b44b979e23ce88ca3b4249"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pgpmac_printf </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Terminal output routine ala printf. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fmt</td><td>Printf style formating string </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pgpmac_8c_source.html#l00477">477</a> of file <a class="el" href="pgpmac_8c_source.html">pgpmac.c</a>.</p>
<div class="fragment"><div class="line">                     {</div>
<div class="line">  va_list arg_ptr;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);</div>
<div class="line"></div>
<div class="line">  va_start( arg_ptr, fmt);</div>
<div class="line">  vwprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, fmt, arg_ptr);</div>
<div class="line">  va_end( arg_ptr);</div>
<div class="line"></div>
<div class="line">  wnoutrefresh( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>);</div>
<div class="line">  doupdate();</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6168e3ced6ec5fc80862d27002e4cd5b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pgpmac_request_stay_of_execution </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>secs</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Postpone the day of reckoning This assumes the quit_cb routine is called once a second. </p>

<p>Definition at line <a class="el" href="pgpmac_8c_source.html#l00498">498</a> of file <a class="el" href="pgpmac_8c_source.html">pgpmac.c</a>.</p>
<div class="fragment"><div class="line">                                                 {</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#a75c9d50c347e9021784ee2529a0a1a70" title="avoid thread collision while resetting the doomsday clock">doomsday_mutex</a>);</div>
<div class="line">  <span class="keywordflow">if</span>( secs &gt; <a class="code" href="pgpmac_8c.html#aa687f0df65c1d87ffd5635742c1eab94" title="Countdown to quitting time: cleanout routines can request a few more heartbeats.">doomsday_count</a>)</div>
<div class="line">    <a class="code" href="pgpmac_8c.html#aa687f0df65c1d87ffd5635742c1eab94" title="Countdown to quitting time: cleanout routines can request a few more heartbeats.">doomsday_count</a> = secs;</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#a75c9d50c347e9021784ee2529a0a1a70" title="avoid thread collision while resetting the doomsday clock">doomsday_mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a76b11c62b122ee0fd8399435d4260681"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PmacSockSendline </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a6cb218bdccfe5a93471c161f15a15cab"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* alignx</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Alignment stage X. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00101">101</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a737c246c3948e644a18d191a931e1acd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* aligny</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Alignment stage Y. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00102">102</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae7642b1da0f7c7f8448104c691d40a12"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* alignz</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Alignment stage X. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00103">103</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa90d2363b744acbd4d45133b7a716d8f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* anal</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Polaroid analyzer motor. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00104">104</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a139200ddaa9856a7ffcec0e6cbaa8f1b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* apery</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Aperture Y. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00106">106</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab93bd6ee850b285ca3a95e64d15e9477"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* aperz</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Aperture Z. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00107">107</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="afaff4fbb5f03b0d2469fc7a14f174d69"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* arm_parked</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>(whose arm? parked where?) </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00144">144</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a85d6eaa4b4a82bb3112574f458d1dc50"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* blight</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Back Light DAC. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00118">118</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac0d0bc95bcbcbd154b30c72a9645c8b2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* blight_down</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Backlight is down. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00134">134</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="af55c51d52c4586b647114f95d7ac1f42"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* blight_f</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Back light scale factor. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00127">127</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="af813a2eff0b7efa4c70633559054e84c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* blight_ud</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Back light Up/Down actuator. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00122">122</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7fba65f6555c5c7908852c6cf1ad0c94"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* blight_up</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Backlight is up. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00135">135</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a51358daaea8b5236f08414877d8af6c2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* capy</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Capillary Y. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00108">108</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa45f268d0af9f3d465acfab128919718"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* capz</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Capillary Z. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00109">109</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac940d950d9efeaf3f0ae67e9bf331188"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* cenx</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Centering Table X. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00111">111</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aaed18e738ba7bfb6c771a44f5d7ea827"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* ceny</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Centering Table Y. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00112">112</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae78d9a757d4c85419fff9c94b15e25d7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* cryo</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Move the cryostream towards or away from the crystal. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00123">123</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a871d4cdea0a1a8db85b8658a07655212"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* cryo_back</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>cryo is in the back position </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00136">136</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a28df32fd6be9160603aa1bb74a823574"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* cryo_switch</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>that little toggle switch for the cryo </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00133">133</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9d9c5030d817483ca9518027c91adac4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* dryer</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>blow air on the scintilator to dry it off </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00124">124</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1e690d4ad981d020ea2c850282dca3be"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* etel_init_ok</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ETEL initialized OK. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00141">141</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab48d4a2cf0225796db9aad49f034dc59"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* etel_on</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ETEL is on. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00140">140</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5538a6aa526eeed65ff237303da2d348"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* etel_ready</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ETEL is ready. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00139">139</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aeb09895663eff333b7a75acb319a9fc1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* flight</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Front Light DAC. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00117">117</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aabf4ec595b5183c1777d029ca56134b0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* flight_f</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Front light scale factor. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00128">128</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6630442dc65ce8a30a24ed718b301971"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* flight_oo</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Turn front light on/off. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00126">126</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="addb26c80065506faa1de3c1b468fe03f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* fluo</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Move the fluorescence detector in/out. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00125">125</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a67092de6f3fcc0b245e4970437eaff6b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* fluor_back</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>fluor is in the back position </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00137">137</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8a3ca6fcf5e24dcc26170736843e53b2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* fscint</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Scintillator Piezo DAC. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00119">119</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a26dec4623af9beed912b8e7e6f99822c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* fshut</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fast shutter. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00116">116</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="abb29b117ad38156ba16fcf44eeb427af"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* hp_air</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>High pressure air OK. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00132">132</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a0be79ccb7ebf3a665248fd856112b9fd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* kappa</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Kappa. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00113">113</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aade15098d213bb25522048e4a231941a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* lp_air</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Low pressure air OK. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00131">131</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="adf89a0299edd6a99992b95dff8992eba"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a7f71abc6fdfd1839e2e3213d78aaf766">lspg_demandairrights_t</a> lspg_demandairrights</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>our demandairrights object </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00068">68</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7ef8a09203117578c9b2ce4719519f36"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a48b627e412dd038c1f17cdb0501eec33">lspg_getcenter_t</a> lspg_getcenter</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>the getcenter object </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00067">67</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5c50804e6019d47d91f3f1cb3ebd1f00"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a7a794370785ff015d5ee035917e3bee8">lspg_getcurrentsampleid_t</a> lspg_getcurrentsampleid</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>our currentsample id </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00069">69</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="adbf70f382e469e02dce77833981f9547"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a9dda9014cd0e39fba8d523e37cf9f982">lspg_nextsample_t</a> lspg_nextsample</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>the very next sample </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00065">65</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad8d8e2f578ca79189a80c1fd5b60cefd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a17ea2bf07a0b3b892baa00bd392607b3">lspg_nextshot_t</a> lspg_nextshot</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>the nextshot object </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00066">66</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="af18499d17171eff473cfc49d4a0a5562"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa1f0e602ae9509005c62fb2d73bc1c5a">lspg_starttransfer_t</a> lspg_starttransfer</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>start a sample transfer </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00070">70</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5f699604dcc5d3d64fd6cb5c363d29c9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a779e2acce8b5e748c184caf23ed0db57">lspg_waitcryo_t</a> lspg_waitcryo</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>signal the robot </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00071">71</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="aebfce5f9cbc8ba7bd4e2ee4880f303e8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> lspmac_motors[]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>All our motors. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00096">96</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a57547d211906c981ef20257eba99f8df"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_cond_t lspmac_moving_cond</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for motor(s) to finish moving condition. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00070">70</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7a32c617c183166308241e270959df56"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_moving_flags</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Flag used to implement motor moving condition. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00071">71</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a85679cac947e199c88794f8e5a12bf5f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t lspmac_moving_mutex</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Coordinate moving motors between threads. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00069">69</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a56260f012c50a591ee7f97e500f16994"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_nmotors</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The number of motors we manage. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00097">97</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="afbd51c2cefcee87afe994c9e9f372241"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_cond_t lspmac_shutter_cond</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allows waiting for the shutter status to change. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00068">68</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a396fbf06208de3ecbe1b0df549f1cd46"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_shutter_has_opened</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Indicates that the shutter had opened, perhaps briefly even if the state did not change. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00066">66</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1b78a13c654409333569815e1c109d38"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t lspmac_shutter_mutex</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Coordinates threads reading shutter status. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00067">67</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a112158e0cd50449a440ac55c7af7bea2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspmac_shutter_state</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>State of the shutter, used to detect changes. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00065">65</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2f63408d16b5603541b124a78f36a5a8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_cond_t lsredis_cond</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00075">75</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a390e8acf789b0fa41b43a794dd27e28f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t lsredis_mutex</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00074">74</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7461eb2b5974a2ffac2189007d39193c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsredis_running</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00076">76</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7a3e763682bd7f987d07f149e94b3bf8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t md2_status_mutex</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Synchronize reading/writting status buffer. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00352">352</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1ccf455563dc8d828558b6a230e164a6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char md2cmds_cmd[]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>our command; </p>

<p>Definition at line <a class="el" href="md2cmds_8c_source.html#l00024">24</a> of file <a class="el" href="md2cmds_8c_source.html">md2cmds.c</a>.</p>

</div>
</div>
<a class="anchor" id="a08d5b18ec9478d753c46a3e28d1f2126"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_cond_t md2cmds_cond</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>condition to signal when it's time to run an md2 command </p>

<p>Definition at line <a class="el" href="md2cmds_8c_source.html#l00010">10</a> of file <a class="el" href="md2cmds_8c_source.html">md2cmds.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6a34fb6876abbd580629d3708c805e7f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a>* md2cmds_md_status_code</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="md2cmds_8c_source.html#l00026">26</a> of file <a class="el" href="md2cmds_8c_source.html">md2cmds.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad67304bb851dc6268b0cda2f40fc5aa8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t md2cmds_mutex</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>mutex for the condition </p>

<p>Definition at line <a class="el" href="md2cmds_8c_source.html#l00011">11</a> of file <a class="el" href="md2cmds_8c_source.html">md2cmds.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab517a930528e2b7d0993e11087765b03"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_cond_t md2cmds_pg_cond</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a4d2c3ac81d4b13eb21f4ddcdda8c7308"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t md2cmds_pg_mutex</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ab552f2e28dd9cccefafe01f27717101b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* minikappa_ok</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Minikappa is OK (whatever that means) </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00142">142</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad128c64890c7c0d4f836d9ec6e99216a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t ncurses_mutex</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>allow more than one thread access to the screen </p>

<p>Definition at line <a class="el" href="pgpmac_8c_source.html#l00242">242</a> of file <a class="el" href="pgpmac_8c_source.html">pgpmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8237e646ce032a840637a4ef7bff49b9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* omega</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>MD2 omega axis (the air bearing) </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00100">100</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae6631a094accc469661805bdf80fc6d8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct timespec omega_zero_time</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Time we believe that omega crossed zero. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00080">80</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad163e2bc6ebe322058c113dee76c11ff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pgpmac_use_autoscint</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>non-zero to automatically move the alignment stage when the scintillator moves (redis hash AUTOSCINT in config.HOSTNAME sets this) </p>

<p>Definition at line <a class="el" href="pgpmac_8c_source.html#l00247">247</a> of file <a class="el" href="pgpmac_8c_source.html">pgpmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae002f31c03cce9bf96cf0e0c2907cb2b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pgpmac_use_pg</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>non-zero to start up lspg thread, 0 to not (reids hash PG in config.HOSTNAME sets this) </p>

<p>Definition at line <a class="el" href="pgpmac_8c_source.html#l00246">246</a> of file <a class="el" href="pgpmac_8c_source.html">pgpmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac8070dc568ad974a3db42b51eca828cc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* phi</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Phi (not data collection axis) </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00114">114</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8a25bd9c593c6985107f90f999ce0b08"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_cond_t pmac_queue_cond</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>wait for a command to be sent to PMAC before continuing </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00086">86</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="acc1bb77b9bcbc4d970f841a41fd274b3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t pmac_queue_mutex</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>manage access to the pmac command queue </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00085">85</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac59ab990e48033a811aeb0281fb588fc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* sample_detected</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>smart magnet detected sample </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00138">138</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a589431b3a79c21c251fcb97cc9126991"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* scint</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Scintillator Z. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00110">110</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae98a0792d6b4b96a33df0a31bdec6342"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* shutter_open</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>shutter is open (note in pmc says this is a slow input) </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00145">145</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a37903ed8430ac4d9ead609a78eb62f32"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* smart_mag_err</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>smart magnet error (coil broken perhaps) </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00146">146</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a4892e918830dd12093d28c53a1c2df98"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* smart_mag_off</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>smart magnet is off </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00147">147</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2dc6fa78bb6313fe8b696d646eaa2443"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ac48984832ef73cf145e5f08bc65bd3a0">lspmac_bi_t</a>* smart_mag_on</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>smart magnet is on </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00143">143</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="abee73a0d9e5f3af9eb88d5cfd6b953c3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* smart_mag_oo</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Smart Magnet on/off. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00121">121</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab0487111dbe3c05d0bd835eb2fb9a3f7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">WINDOW* term_input</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>place to put the cursor </p>

<p>Definition at line <a class="el" href="pgpmac_8c_source.html#l00238">238</a> of file <a class="el" href="pgpmac_8c_source.html">pgpmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a65daf0f4a5bc6def23a9df98ff5ca57e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">WINDOW* term_output</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>place to print stuff out </p>

<p>Definition at line <a class="el" href="pgpmac_8c_source.html#l00237">237</a> of file <a class="el" href="pgpmac_8c_source.html">pgpmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae746a6903fb8a4ea216def88eccedc3c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">WINDOW* term_status</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>shutter, lamp, air, etc status </p>

<p>Definition at line <a class="el" href="pgpmac_8c_source.html#l00239">239</a> of file <a class="el" href="pgpmac_8c_source.html">pgpmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae2d7da3afeb756716e6e4ee9cab78f8a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">WINDOW* term_status2</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>shutter, lamp, air, etc status </p>

<p>Definition at line <a class="el" href="pgpmac_8c_source.html#l00240">240</a> of file <a class="el" href="pgpmac_8c_source.html">pgpmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad53a42cfaa04eff0336a44c8c9986333"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a>* zoom</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Optical zoom. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00105">105</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="pgpmac_8h.html">pgpmac.h</a></li>
    <li class="footer">Generated on Fri May 23 2014 09:07:06 for LS-CAT PGPMAC by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 </li>
  </ul>
</div>
</body>
</html>
