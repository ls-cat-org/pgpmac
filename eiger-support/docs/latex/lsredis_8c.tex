\hypertarget{lsredis_8c}{\section{lsredis.\-c File Reference}
\label{lsredis_8c}\index{lsredis.\-c@{lsredis.\-c}}
}


Support redis hash synchronization.  


{\ttfamily \#include \char`\"{}pgpmac.\-h\char`\"{}}\\*
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structlsredis__preset__list__struct}{lsredis\-\_\-preset\-\_\-list\-\_\-struct}
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef struct \\*
\hyperlink{structlsredis__preset__list__struct}{lsredis\-\_\-preset\-\_\-list\-\_\-struct} \hyperlink{lsredis_8c_a8eac570b2b69ea0b7948b6c581cf6002}{lsredis\-\_\-preset\-\_\-list\-\_\-t}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{lsredis_8c_a8268fd06bda0e2c327b057a880b97b59}{lsredis\-\_\-debug\-C\-B} (redis\-Async\-Context $\ast$ac, void $\ast$reply, void $\ast$privdata)
\begin{DoxyCompactList}\small\item\em Log the reply. \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_a05c7ed2bb1b5702a5c83ed3b51abb546}{\-\_\-lsredis\-\_\-set\-\_\-value} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p, char $\ast$v)
\begin{DoxyCompactList}\small\item\em set\-\_\-value and setstr helper funciton p-\/$>$mutex must be locked before calling \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_ac3c27bda1c9b10e6db14665951746da8}{lsredis\-\_\-set\-\_\-value} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p, char $\ast$fmt,...)
\begin{DoxyCompactList}\small\item\em Set the value of a redis object and make it valid. \end{DoxyCompactList}\item 
int \hyperlink{lsredis_8c_a9fc8fd0db4c71c5eae68682b43103078}{lsredis\-\_\-cmpstr} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p, char $\ast$s)
\item 
int \hyperlink{lsredis_8c_ac356cd43e46799929242dcf5214df7f6}{lsredis\-\_\-cmpnstr} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p, char $\ast$s, int n)
\item 
int \hyperlink{lsredis_8c_ac58fca47533e695c8775e0d2b9128766}{lsredis\-\_\-regexec} (const regex\-\_\-t $\ast$preg, \hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p, size\-\_\-t nmatch, regmatch\-\_\-t $\ast$pmatch, int eflags)
\item 
char $\ast$ \hyperlink{lsredis_8c_ac1994e56114b2315294527d76311f829}{lsredis\-\_\-getstr} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p)
\begin{DoxyCompactList}\small\item\em return a copy of the key's string value be sure to free the result \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\-\_\-setstr} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p, char $\ast$fmt,...)
\begin{DoxyCompactList}\small\item\em Set the value and update redis. \end{DoxyCompactList}\item 
double \hyperlink{lsredis_8c_a51c33bec2c54f2d468bf8d93d981914a}{lsredis\-\_\-get\-\_\-or\-\_\-set\-\_\-d} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p, double val, int prec)
\item 
double \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\-\_\-getd} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p)
\item 
long int \hyperlink{lsredis_8c_a1923f998441f4f451204dfd214d52218}{lsredis\-\_\-getl} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p)
\item 
long int \hyperlink{lsredis_8c_a71689006ffc015be6a0705a7c0aef1be}{lsredis\-\_\-get\-\_\-or\-\_\-set\-\_\-l} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p, long int val)
\item 
char $\ast$$\ast$ \hyperlink{lsredis_8c_abe31d0e11c41b2235307612c963bb652}{lsredis\-\_\-get\-\_\-string\-\_\-array} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p)
\item 
int \hyperlink{lsredis_8c_abbb4e5ece19ebd130e1be18036752a08}{lsredis\-\_\-getb} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p)
\item 
char \hyperlink{lsredis_8c_a0b7600b1c9a4550b32d4be019d25f941}{lsredis\-\_\-getc} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p)
\item 
void \hyperlink{lsredis_8c_a8d9719b362d1b38275d734971b7988af}{lsredis\-\_\-hget\-C\-B} (redis\-Async\-Context $\ast$ac, void $\ast$reply, void $\ast$privdata)
\item 
\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$ \hyperlink{lsredis_8c_ac3fb8589e280bfa18ecbca6619fea637}{\-\_\-lsredis\-\_\-get\-\_\-obj} (char $\ast$key)
\begin{DoxyCompactList}\small\item\em Maybe add a new object Used internally for this module Must be called with lsredis\-\_\-mutex locked. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$ \hyperlink{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{lsredis\-\_\-get\-\_\-obj} (char $\ast$fmt,...)
\item 
void \hyperlink{lsredis_8c_aa1941e6515a254f76cfd1f18d3c8fac3}{redis\-Disconnect\-C\-B} (const redis\-Async\-Context $\ast$ac, int status)
\begin{DoxyCompactList}\small\item\em call back in case a redis server becomes disconnected T\-O\-D\-O\-: reconnect \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_adee3bccecc86dd531ac5f89491632439}{lsredis\-\_\-add\-Read} (void $\ast$data)
\begin{DoxyCompactList}\small\item\em hook to mange read events \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_a2e1f2258b3cc864ce3eef4eda556e2a6}{lsredis\-\_\-del\-Read} (void $\ast$data)
\begin{DoxyCompactList}\small\item\em hook to manage \char`\"{}don't need to read\char`\"{} events \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_a3cb6eda5c8ae80019e7a1c078940e9e9}{lsredis\-\_\-add\-Write} (void $\ast$data)
\begin{DoxyCompactList}\small\item\em hook to manage write events \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_a04f0119cfa1156dc34d35b237358822a}{lsredis\-\_\-del\-Write} (void $\ast$data)
\begin{DoxyCompactList}\small\item\em hook to manage \char`\"{}don't need to write anymore\char`\"{} events \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_a45f946a5262c23b362be17c2cb0310c2}{lsredis\-\_\-cleanup} (void $\ast$data)
\begin{DoxyCompactList}\small\item\em hook to clean up T\-O\-D\-O\-: figure out what we are supposed to do here and do it \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_a84611531459bf3d92c45b86308b4a300}{lsredis\-\_\-sub\-C\-B} (redis\-Async\-Context $\ast$ac, void $\ast$reply, void $\ast$privdata)
\begin{DoxyCompactList}\small\item\em Use the publication to request the new value. \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_ad3189a7329ca92efab0054921f608b97}{lsredis\-\_\-maybe\-\_\-add\-\_\-key} (char $\ast$k)
\item 
void \hyperlink{lsredis_8c_ace75c15c5308a0fcdafcb82c7506872a}{lsredis\-\_\-keys\-C\-B} (redis\-Async\-Context $\ast$ac, void $\ast$reply, void $\ast$privdata)
\begin{DoxyCompactList}\small\item\em Sift through the keys to find ones we like. \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_af48b297b5679750a131fa1e982a078b7}{lsredis\-\_\-load\-\_\-presets} (char $\ast$motor\-\_\-name)
\begin{DoxyCompactList}\small\item\em update the presets hash table for the named motor \end{DoxyCompactList}\item 
int \hyperlink{lsredis_8c_a87d7bb0ade6f247edfbb7803aac9e694}{lsredis\-\_\-find\-\_\-preset} (char $\ast$motor\-\_\-name, char $\ast$preset\-\_\-name, double $\ast$dval)
\begin{DoxyCompactList}\small\item\em Get the value of the given preset and return it in dval Returns 0 on error, non-\/zero on success;. \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_a2b48f29f489bcbdaf4fb29e7fbf1d4d2}{lsredis\-\_\-set\-\_\-preset} (char $\ast$motor\-\_\-name, char $\ast$preset\-\_\-name, double dval)
\begin{DoxyCompactList}\small\item\em set the given preset to the given value create a new preset if we can't find it \end{DoxyCompactList}\item 
int \hyperlink{lsredis_8c_adfe823e3ccec7e37ac4697179bd65b10}{lsredis\-\_\-find\-\_\-preset\-\_\-index\-\_\-by\-\_\-position} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$mp)
\begin{DoxyCompactList}\small\item\em For the given motor object return the index of the current preset or -\/1 if we are not at a preset position. \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_a065d09eb6914c057383980d3d786affc}{lsredis\-\_\-log} (char $\ast$fmt,...)
\begin{DoxyCompactList}\small\item\em send log message to our redis log key \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_a75e500f4f9df969ca9994d6889944f47}{lsredis\-\_\-config\-C\-B} (redis\-Async\-Context $\ast$ac, void $\ast$reply, void $\ast$privdata)
\item 
void \hyperlink{lsredis_8c_a4a7466a8c5b90df6dfc78aef625220f4}{lsredis\-\_\-init} ()
\begin{DoxyCompactList}\small\item\em Initialize this module, that is, set up the connections. \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_aaabcee808dcf48a60898798a45516b68}{lsredis\-\_\-config} ()
\item 
void \hyperlink{lsredis_8c_ae1478efc852fef71550e0f58d602fa2b}{lsredis\-\_\-fd\-\_\-service} (struct pollfd $\ast$evt)
\begin{DoxyCompactList}\small\item\em service the socket requests \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_aa060eb807fbecb6e6430d2cbae2c9673}{lsredis\-\_\-sig\-\_\-service} (struct pollfd $\ast$evt)
\item 
void \hyperlink{lsredis_8c_acd9cb833103e57da756d152ecdd4f840}{lsredis\-\_\-heartbeat\-\_\-cb} (char $\ast$event)
\item 
void $\ast$ \hyperlink{lsredis_8c_ade7b1ddfdc88c6964a4c90513e360f75}{lsredis\-\_\-worker} (void $\ast$dummy)
\begin{DoxyCompactList}\small\item\em subscribe to changes and service sockets \end{DoxyCompactList}\item 
pthread\-\_\-t $\ast$ \hyperlink{lsredis_8c_ac3db3d5f91bf5723bd94748ce0d88731}{lsredis\-\_\-run} ()
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static pthread\-\_\-t \hyperlink{lsredis_8c_a79c33eb11ad6819247930ade3a25671f}{lsredis\-\_\-thread}
\item 
pthread\-\_\-mutex\-\_\-t \hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\-\_\-mutex}
\item 
pthread\-\_\-cond\-\_\-t \hyperlink{lsredis_8c_a2f63408d16b5603541b124a78f36a5a8}{lsredis\-\_\-cond}
\item 
int \hyperlink{lsredis_8c_a7461eb2b5974a2ffac2189007d39193c}{lsredis\-\_\-running} = 0
\item 
static pthread\-\_\-mutexattr\-\_\-t \hyperlink{lsredis_8c_a71c9f418904364d65c22d786f4dc5d39}{mutex\-\_\-initializer}
\item 
static \hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$ \hyperlink{lsredis_8c_a3d206e1c119f1408a7cf1078139f8189}{lsredis\-\_\-objs} = N\-U\-L\-L
\item 
static struct hsearch\-\_\-data \hyperlink{lsredis_8c_a42aec6aa74072797ec0344847b0e9e39}{lsredis\-\_\-htab}
\item 
static redis\-Async\-Context $\ast$ \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}
\item 
static redis\-Async\-Context $\ast$ \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}
\item 
static redis\-Async\-Context $\ast$ \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}
\item 
static char $\ast$ \hyperlink{lsredis_8c_a0c81dce2e75584eeb14ab7d9dd86c72e}{lsredis\-\_\-publisher} = N\-U\-L\-L
\item 
static regex\-\_\-t \hyperlink{lsredis_8c_abee04898347f9b2551fa0435b1cc597e}{lsredis\-\_\-key\-\_\-select\-\_\-regex}
\item 
static char $\ast$ \hyperlink{lsredis_8c_acdca9095c7a3288d7febe9f4c440a6e9}{lsredis\-\_\-head} = N\-U\-L\-L
\item 
static pthread\-\_\-mutex\-\_\-t \hyperlink{lsredis_8c_a0c5cbd80d59d69603f123621cc6ddc30}{lsredis\-\_\-config\-\_\-mutex}
\item 
static pthread\-\_\-cond\-\_\-t \hyperlink{lsredis_8c_a6fa076f1004c85a8a1dc400f45547f32}{lsredis\-\_\-config\-\_\-cond}
\item 
static struct pollfd \hyperlink{lsredis_8c_a0cd3bdc79d035eb1595371c845d14367}{subfd}
\item 
static struct pollfd \hyperlink{lsredis_8c_add819e43a356d0575ec64c346c6fed57}{rofd}
\item 
static struct pollfd \hyperlink{lsredis_8c_a13acbee14dbe8cdb98e238abb921d048}{wrfd}
\item 
static \hyperlink{lsredis_8c_a8eac570b2b69ea0b7948b6c581cf6002}{lsredis\-\_\-preset\-\_\-list\-\_\-t} $\ast$ \hyperlink{lsredis_8c_a232f994f0d91ba8157cbcfe429fc90de}{lsredis\-\_\-preset\-\_\-list} = N\-U\-L\-L
\item 
static struct hsearch\-\_\-data \hyperlink{lsredis_8c_ade00a383533fdefb2af9f3f53f37cf97}{lsredis\-\_\-preset\-\_\-ht}
\item 
static int \hyperlink{lsredis_8c_adace74d8fa7d2dd58854fa09e66da807}{lsredis\-\_\-preset\-\_\-n} = 0
\item 
static int \hyperlink{lsredis_8c_ace88a236f88278adaac5419a7281c490}{lsredis\-\_\-preset\-\_\-max\-\_\-n} = 1024
\item 
static pthread\-\_\-mutex\-\_\-t \hyperlink{lsredis_8c_a1d0b14b31b12d1b2a79dc50eac09de39}{lsredis\-\_\-preset\-\_\-list\-\_\-mutex}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Support redis hash synchronization. \begin{DoxyVerb}\date 2012
\author Keith Brister
\copyright All Rights Reserved
\end{DoxyVerb}


Redis support for redis in pgpmac.

Values in redis are assumed to be hashs with at list one field \char`\"{}\-V\-A\-L\-U\-E\char`\"{}. At startup the initialization routine is passed a regular expression to select which keys we'd like to duplicate locally as a lsredis\-\_\-obj\-\_\-t. It is assumed that the following construct in redis is used to change a value\-:


\begin{DoxyPre}
    MULTI
    HSET key VALUE value
    PUBLISH publisher key
    EXEC
\end{DoxyPre}


Where \char`\"{}publisher\char`\"{} is a unique name in the following format\-: 
\begin{DoxyPre}
         MD2-*
   or    UI-*
   or    REDIS\_KV\_CONNECTOR
   or    \hyperlink{namespacemk__pgpmac__redis}{mk\_pgpmac\_redis}
\end{DoxyPre}
 (this last value is used to support the now depreciated px.\-kvs table in the L\-S-\/\-C\-A\-T postgresql server). We assume that all publishers that we are listening to O\-N\-L\-Y publish key names that have changed.

When someone else changes a value we invalidate our internal copy and issue a \char`\"{}\-H\-G\-E\-T key V\-A\-L\-U\-E\char`\"{} command. Other threads that request the value of our lsredis\-\_\-obj\-\_\-t will pause until the new value has been received and processed.

When a value changes locally this module changes it in redis as shown above. At this point we refuse other publishers attempt to change the value until we've seen all of our P\-U\-B\-L\-I\-S\-H messages. That is, we ignore changes that in redis happened before our change.

You'll need an lsredis\-\_\-obj\-\_\-t to do anything with redis in the pgpmac project\-: 
\begin{DoxyPre}
   lsredis\_obj\_t *lsredis\_get\_obj( char *fmt, ...)  where fmt is a printf style formatting string to interpret the rest of the arguments (if any)
                                                    During initialization a "head" string is passed that is prepended to form the redis key.
                                                    For example, "omega.position" might refer to the key "stns.2.omega.position" at LS-CAT.
   \end{DoxyPre}


To set a redis value use 
\begin{DoxyPre}
    void lsredis\_setstr( lsredis\_obj\_t *p, char *fmt, ...)  where fmt is a printf style formatting string to interpret the rest of the arguments (if any)
   \end{DoxyPre}


When a new value is seen we immediately parse it and make it available through the following functions\-: 
\begin{DoxyPre}\end{DoxyPre}



\begin{DoxyPre}     char    *lsredis\_getstr( lsredis\_obj\_t *p)            Returns a copy of the VALUE field.  Use "free" on the retured value when done using it.\end{DoxyPre}



\begin{DoxyPre}     double   \hyperlink{pgpmac_8h_aa8daf63b794b6b6341018feec205cb7d}{lsredis\_getd( lsredis\_obj\_t *p)}              Returns a double.  If the value was not a number it returns 0.\end{DoxyPre}



\begin{DoxyPre}     long int \hyperlink{pgpmac_8h_a1923f998441f4f451204dfd214d52218}{lsredis\_getl( lsredis\_obj\_t *p)}              Returns a long int.  If the value was not a number it returns 0.\end{DoxyPre}



\begin{DoxyPre}     char   **lsredis\_get\_string\_array( lsredis\_obj\_t *p)  Returns an array of string pointers.  Value is assumed formated as a postgresql array, ie, \{here,"I am","for example"\}.
                                                  or NULL if the value could not be parsed\end{DoxyPre}



\begin{DoxyPre}     int      \hyperlink{pgpmac_8h_abbb4e5ece19ebd130e1be18036752a08}{lsredis\_getb( lsredis\_obj\_t *p)}              Returns 1, 0, or -1 based on the fist character of the string. 1 for T,t,Y,y, or 1, 0 for F,f,N,n or 0, -1 for anything else.\end{DoxyPre}



\begin{DoxyPre}     char     \hyperlink{pgpmac_8h_a0b7600b1c9a4550b32d4be019d25f941}{lsredis\_getc( lsredis\_obj\_t *p)}              Returns the first character of VALUE\end{DoxyPre}



\begin{DoxyPre}   \end{DoxyPre}
 

Definition in file \hyperlink{lsredis_8c_source}{lsredis.\-c}.



\subsection{Typedef Documentation}
\hypertarget{lsredis_8c_a8eac570b2b69ea0b7948b6c581cf6002}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-preset\-\_\-list\-\_\-t@{lsredis\-\_\-preset\-\_\-list\-\_\-t}}
\index{lsredis\-\_\-preset\-\_\-list\-\_\-t@{lsredis\-\_\-preset\-\_\-list\-\_\-t}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-preset\-\_\-list\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf lsredis\-\_\-preset\-\_\-list\-\_\-struct}  {\bf lsredis\-\_\-preset\-\_\-list\-\_\-t}}}\label{lsredis_8c_a8eac570b2b69ea0b7948b6c581cf6002}


\subsection{Function Documentation}
\hypertarget{lsredis_8c_ac3fb8589e280bfa18ecbca6619fea637}{\index{lsredis.\-c@{lsredis.\-c}!\-\_\-lsredis\-\_\-get\-\_\-obj@{\-\_\-lsredis\-\_\-get\-\_\-obj}}
\index{\-\_\-lsredis\-\_\-get\-\_\-obj@{\-\_\-lsredis\-\_\-get\-\_\-obj}!lsredis.c@{lsredis.\-c}}
\subsubsection[{\-\_\-lsredis\-\_\-get\-\_\-obj}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lsredis\-\_\-obj\-\_\-t}$\ast$ \-\_\-lsredis\-\_\-get\-\_\-obj (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{key}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_ac3fb8589e280bfa18ecbca6619fea637}


Maybe add a new object Used internally for this module Must be called with lsredis\-\_\-mutex locked. 



Definition at line 544 of file lsredis.\-c.


\begin{DoxyCode}
                                            \{
  \hyperlink{structlsredis__obj__struct}{lsredis\_obj\_t} *\hyperlink{namespacemk__pgpmac__redis_a11daf2847f2dc94562b5b61b3f412574}{p};
  regmatch\_t pmatch[2];
  \textcolor{keywordtype}{int} err;
  ENTRY htab\_input, *htab\_output;

  \textcolor{comment}{// Dispense with obviously bad keys straight away}
  \textcolor{comment}{// unless p->valid == 0 in which case we call HGET first}
  \textcolor{comment}{//}
  \textcolor{comment}{// TODO: review logic: is there ever a time when valid is zero for a
       preexisting p and HGET has not been called?}
  \textcolor{comment}{//       If not then we should just return p without checking for validity.}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( key == NULL || *key == 0 || strchr( key, \textcolor{charliteral}{' '}) != NULL) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"\_lsredis\_get\_obj: bad key '%s'
      "}, key == NULL ? \textcolor{stringliteral}{"<NULL>"} : key);
    \textcolor{keywordflow}{return} NULL;
  \}

  \textcolor{comment}{// If the key is already there then just return it}
  \textcolor{comment}{//}

  htab\_input.key  = key;
  htab\_input.data = NULL;
  errno = 0;
  err = hsearch\_r( htab\_input, FIND, &htab\_output, &\hyperlink{lsredis_8c_a42aec6aa74072797ec0344847b0e9e39}{lsredis\_htab});

  \textcolor{keywordflow}{if}( err == 0)
    p = NULL;
  \textcolor{keywordflow}{else}
    p = htab\_output->data;


  \textcolor{keywordflow}{if}( p != NULL) \{
    \textcolor{keywordflow}{return} \hyperlink{namespacemk__pgpmac__redis_a11daf2847f2dc94562b5b61b3f412574}{p};
  \} \textcolor{keywordflow}{else} \{
    \textcolor{comment}{// make a new one.}
    p = calloc( 1, \textcolor{keyword}{sizeof}( \hyperlink{structlsredis__obj__struct}{lsredis\_obj\_t}));
    \textcolor{keywordflow}{if}( p == NULL) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"\_lsredis\_get\_obj: Out of
       memory"});
      exit( -1);
    \}
    
    err = regexec( &\hyperlink{lsredis_8c_abee04898347f9b2551fa0435b1cc597e}{lsredis\_key\_select\_regex}, key, 2, 
      pmatch, 0);
    \textcolor{keywordflow}{if}( err == 0 && pmatch[1].rm\_so != -1) \{
      p->\hyperlink{structlsredis__obj__struct_ad0a987a011b580eab739cda831f78fbb}{events\_name} = strndup( key+pmatch[1].rm\_so, pmatch[1].rm\_eo
       - pmatch[1].rm\_so);
    \} \textcolor{keywordflow}{else} \{
      p->\hyperlink{structlsredis__obj__struct_ad0a987a011b580eab739cda831f78fbb}{events\_name} = strdup( key);
    \}
    \textcolor{keywordflow}{if}( p->\hyperlink{structlsredis__obj__struct_ad0a987a011b580eab739cda831f78fbb}{events\_name} == NULL) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"\_lsredis\_get\_obj: Out of
       memory (events\_name)"});
      exit( -1);
    \}

    pthread\_mutex\_init( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex}, &\hyperlink{lsredis_8c_a71c9f418904364d65c22d786f4dc5d39}{mutex\_initializer});
    pthread\_cond\_init(  &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, NULL);
    p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value} = NULL;
    p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} = 0;
    \textcolor{comment}{// lsevents\_send\_event( "%s Invalid", p->events\_name);}
    p->\hyperlink{structlsredis__obj__struct_a8bc1a536b7155a1e2a749c7c434b898b}{wait\_for\_me} = 0;
    p->\hyperlink{structlsredis__obj__struct_aa8c5a453b9424e5666320b8675a42f5c}{key} = strdup( key);
    p->\hyperlink{structlsredis__obj__struct_a43fcbff584654ab086d973ce34cb6ddc}{hits} = 0;
  
    htab\_input.key  = p->\hyperlink{structlsredis__obj__struct_aa8c5a453b9424e5666320b8675a42f5c}{key};
    htab\_input.data = \hyperlink{namespacemk__pgpmac__redis_a11daf2847f2dc94562b5b61b3f412574}{p};

    errno = 0;
    err = hsearch\_r( htab\_input, ENTER, &htab\_output, &\hyperlink{lsredis_8c_a42aec6aa74072797ec0344847b0e9e39}{lsredis\_htab}
      );
    \textcolor{keywordflow}{if}( err == 0) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"\_lsredis\_get\_obj: hseach
       error on enter.  errno=%d"}, errno);
    \}

    \textcolor{comment}{//}
    \textcolor{comment}{// Shouldn't need the linked list unless we need to rebuild the hash table
       when, for example, we run out of room.}
    \textcolor{comment}{// TODO: resize hash table when needed.}
    \textcolor{comment}{//}
    p->\hyperlink{structlsredis__obj__struct_afb7259e8c3c1c83ccc234b2b2894f2b0}{next} = \hyperlink{lsredis_8c_a3d206e1c119f1408a7cf1078139f8189}{lsredis\_objs};
    \hyperlink{lsredis_8c_a3d206e1c119f1408a7cf1078139f8189}{lsredis\_objs} = \hyperlink{namespacemk__pgpmac__redis_a11daf2847f2dc94562b5b61b3f412574}{p};
  \}
  \textcolor{comment}{//}
  \textcolor{comment}{// We arrive here with the valid flag lowered.  Go ahead and request the
       latest value.}
  \textcolor{comment}{//}
  redisAsyncCommand( \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}, \hyperlink{lsredis_8c_a8d9719b362d1b38275d734971b7988af}{lsredis\_hgetCB}, p, \textcolor{stringliteral}{"HGET %s VALUE"}
      , key);

  \textcolor{keywordflow}{return} \hyperlink{namespacemk__pgpmac__redis_a11daf2847f2dc94562b5b61b3f412574}{p};
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a05c7ed2bb1b5702a5c83ed3b51abb546}{\index{lsredis.\-c@{lsredis.\-c}!\-\_\-lsredis\-\_\-set\-\_\-value@{\-\_\-lsredis\-\_\-set\-\_\-value}}
\index{\-\_\-lsredis\-\_\-set\-\_\-value@{\-\_\-lsredis\-\_\-set\-\_\-value}!lsredis.c@{lsredis.\-c}}
\subsubsection[{\-\_\-lsredis\-\_\-set\-\_\-value}]{\setlength{\rightskip}{0pt plus 5cm}void \-\_\-lsredis\-\_\-set\-\_\-value (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p, }
\item[{char $\ast$}]{v}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a05c7ed2bb1b5702a5c83ed3b51abb546}


set\-\_\-value and setstr helper funciton p-\/$>$mutex must be locked before calling 

$<$ We can consider this value valid

$<$ At this point the key is considered created 

Definition at line 166 of file lsredis.\-c.


\begin{DoxyCode}
                                                    \{

  \textcolor{keywordflow}{if}( strlen(\hyperlink{namespacemk__pgpmac__redis_ac732d49b0afca9a9951e3a252bae42fc}{v}) >= (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) p->\hyperlink{structlsredis__obj__struct_a664f0eaafb8dffc0dbde126e0340efb9}{value\_length}) \{
    \textcolor{keywordflow}{if}( p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value} != NULL)
      free( p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value});
    p->\hyperlink{structlsredis__obj__struct_a664f0eaafb8dffc0dbde126e0340efb9}{value\_length} = strlen(\hyperlink{namespacemk__pgpmac__redis_ac732d49b0afca9a9951e3a252bae42fc}{v}) + 256;
    p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value} = calloc( p->\hyperlink{structlsredis__obj__struct_a664f0eaafb8dffc0dbde126e0340efb9}{value\_length}, \textcolor{keyword}{sizeof}( \textcolor{keywordtype}{char}));
    \textcolor{keywordflow}{if}( p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value} == NULL) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"\_lsredis\_set\_value: out of
       memory"});
      exit( -1);
    \}
  \}
  strncpy( p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value}, \hyperlink{namespacemk__pgpmac__redis_ac732d49b0afca9a9951e3a252bae42fc}{v}, p->\hyperlink{structlsredis__obj__struct_a664f0eaafb8dffc0dbde126e0340efb9}{value\_length} - 1);
  p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value}[p->\hyperlink{structlsredis__obj__struct_a664f0eaafb8dffc0dbde126e0340efb9}{value\_length}-1] = 0;
  p->\hyperlink{structlsredis__obj__struct_ab60d0a71cabad6b921b6edb5a8f68996}{dvalue} = strtod( p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value}, NULL);
  p->\hyperlink{structlsredis__obj__struct_a26211a0ab3fc02e7776e24dbc1f1256c}{lvalue} = p->\hyperlink{structlsredis__obj__struct_ab60d0a71cabad6b921b6edb5a8f68996}{dvalue};

  \textcolor{keywordflow}{if}( p->\hyperlink{structlsredis__obj__struct_ac065eeede0e08f25bcfedd45022fe593}{avalue} != NULL) \{
    \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};
    \textcolor{keywordflow}{for}( i=0; (p->\hyperlink{structlsredis__obj__struct_ac065eeede0e08f25bcfedd45022fe593}{avalue})[i] != NULL; i++)
      free( (p->\hyperlink{structlsredis__obj__struct_ac065eeede0e08f25bcfedd45022fe593}{avalue})[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}]);
    free( p->\hyperlink{structlsredis__obj__struct_ac065eeede0e08f25bcfedd45022fe593}{avalue});
    p->\hyperlink{structlsredis__obj__struct_ac065eeede0e08f25bcfedd45022fe593}{avalue} = NULL;
  \}

  p->\hyperlink{structlsredis__obj__struct_ac065eeede0e08f25bcfedd45022fe593}{avalue} = \hyperlink{lspg_8c_a46f23ae999129d6fd5712d7975b99aed}{lspg\_array2ptrs}( p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value});

  \textcolor{keywordflow}{switch}( *(p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value})) \{
      \textcolor{keywordflow}{case} \textcolor{charliteral}{'T'}:
      \textcolor{keywordflow}{case} \textcolor{charliteral}{'t'}:
      \textcolor{keywordflow}{case} \textcolor{charliteral}{'Y'}:
      \textcolor{keywordflow}{case} \textcolor{charliteral}{'y'}:
      \textcolor{keywordflow}{case} \textcolor{charliteral}{'1'}:
        p->\hyperlink{structlsredis__obj__struct_ac3df3eaa275c1e8e333024c1fa8353af}{bvalue} = 1;
      \textcolor{keywordflow}{break};

      \textcolor{keywordflow}{case} \textcolor{charliteral}{'F'}:
      \textcolor{keywordflow}{case} \textcolor{charliteral}{'f'}:
      \textcolor{keywordflow}{case} \textcolor{charliteral}{'N'}:
      \textcolor{keywordflow}{case} \textcolor{charliteral}{'n'}:
      \textcolor{keywordflow}{case} \textcolor{charliteral}{'0'}:
        p->\hyperlink{structlsredis__obj__struct_ac3df3eaa275c1e8e333024c1fa8353af}{bvalue} = 0;
      \textcolor{keywordflow}{break};

      \textcolor{keywordflow}{default}:
        p->\hyperlink{structlsredis__obj__struct_ac3df3eaa275c1e8e333024c1fa8353af}{bvalue} = -1;           \textcolor{comment}{// nil is -1 here in our world}
    \}

  p->\hyperlink{structlsredis__obj__struct_a4a5933dbd44d33d9f594f6020a443b69}{cvalue} = *(p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value});

  p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} = 1;                            
  p->\hyperlink{structlsredis__obj__struct_ae0aa00ad745ee5bbc598c23ab794ed8a}{creating} = 0;                      
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_adee3bccecc86dd531ac5f89491632439}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-add\-Read@{lsredis\-\_\-add\-Read}}
\index{lsredis\-\_\-add\-Read@{lsredis\-\_\-add\-Read}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-add\-Read}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-add\-Read (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{data}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_adee3bccecc86dd531ac5f89491632439}


hook to mange read events 



Definition at line 674 of file lsredis.\-c.


\begin{DoxyCode}
                                  \{
  \textcolor{keyword}{struct }pollfd *pfd;
  pfd = (\textcolor{keyword}{struct }pollfd *)data;

  \textcolor{keywordflow}{if}( (pfd->events & POLLIN) == 0) \{
    pfd->events |= POLLIN;
    pthread\_kill( \hyperlink{lsredis_8c_a79c33eb11ad6819247930ade3a25671f}{lsredis\_thread}, SIGUSR1);
  \}
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a3cb6eda5c8ae80019e7a1c078940e9e9}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-add\-Write@{lsredis\-\_\-add\-Write}}
\index{lsredis\-\_\-add\-Write@{lsredis\-\_\-add\-Write}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-add\-Write}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-add\-Write (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{data}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a3cb6eda5c8ae80019e7a1c078940e9e9}


hook to manage write events 



Definition at line 698 of file lsredis.\-c.


\begin{DoxyCode}
                                   \{
  \textcolor{keyword}{struct }pollfd *pfd;
  pfd = (\textcolor{keyword}{struct }pollfd *)data;

  \textcolor{keywordflow}{if}( (pfd->events & POLLOUT) == 0) \{
    pfd->events |= POLLOUT;
    pthread\_kill( \hyperlink{lsredis_8c_a79c33eb11ad6819247930ade3a25671f}{lsredis\_thread}, SIGUSR1);
  \}
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a45f946a5262c23b362be17c2cb0310c2}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-cleanup@{lsredis\-\_\-cleanup}}
\index{lsredis\-\_\-cleanup@{lsredis\-\_\-cleanup}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-cleanup}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-cleanup (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{data}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a45f946a5262c23b362be17c2cb0310c2}


hook to clean up T\-O\-D\-O\-: figure out what we are supposed to do here and do it 



Definition at line 723 of file lsredis.\-c.


\begin{DoxyCode}
                                  \{
  \textcolor{keyword}{struct }pollfd *pfd;
  pfd = (\textcolor{keyword}{struct }pollfd *)data;

  pfd->fd = -1;

  \textcolor{keywordflow}{if}( (pfd->events & (POLLOUT | POLLIN)) != 0) \{
    pfd->events &= ~(POLLOUT | POLLIN);
    pthread\_kill( \hyperlink{lsredis_8c_a79c33eb11ad6819247930ade3a25671f}{lsredis\_thread}, SIGUSR1);
  \}
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_ac356cd43e46799929242dcf5214df7f6}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-cmpnstr@{lsredis\-\_\-cmpnstr}}
\index{lsredis\-\_\-cmpnstr@{lsredis\-\_\-cmpnstr}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-cmpnstr}]{\setlength{\rightskip}{0pt plus 5cm}int lsredis\-\_\-cmpnstr (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p, }
\item[{char $\ast$}]{s, }
\item[{int}]{n}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_ac356cd43e46799929242dcf5214df7f6}


Definition at line 254 of file lsredis.\-c.


\begin{DoxyCode}
                                                       \{
  \textcolor{keywordtype}{int} rtn;
  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{while}( p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} == 0)
    pthread\_cond\_wait( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  
  rtn = strncmp( p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value}, s, n);
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a9fc8fd0db4c71c5eae68682b43103078}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-cmpstr@{lsredis\-\_\-cmpstr}}
\index{lsredis\-\_\-cmpstr@{lsredis\-\_\-cmpstr}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-cmpstr}]{\setlength{\rightskip}{0pt plus 5cm}int lsredis\-\_\-cmpstr (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p, }
\item[{char $\ast$}]{s}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a9fc8fd0db4c71c5eae68682b43103078}


Definition at line 243 of file lsredis.\-c.


\begin{DoxyCode}
                                               \{
  \textcolor{keywordtype}{int} rtn;
  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{while}( p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} == 0)
    pthread\_cond\_wait( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  
  rtn = strcmp( p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value}, s);
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_aaabcee808dcf48a60898798a45516b68}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-config@{lsredis\-\_\-config}}
\index{lsredis\-\_\-config@{lsredis\-\_\-config}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-config}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-config (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_aaabcee808dcf48a60898798a45516b68}


Definition at line 1264 of file lsredis.\-c.


\begin{DoxyCode}
                      \{
  \textcolor{keywordtype}{char} hostname[128], lhostname[128];
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};

  \textcolor{keywordflow}{if}( gethostname( hostname, \textcolor{keyword}{sizeof}(hostname)-1)) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_init: cannot get our
       own host name.  Cannot configure redis variables."});
  \} \textcolor{keywordflow}{else} \{
    \textcolor{keywordflow}{for}( i=0; i<strlen(hostname); i++) \{
      lhostname[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}] = tolower( hostname[i]);
    \}
    lhostname[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}] = 0;

    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_init: our host name is
       '%s'"}, lhostname);
    redisAsyncCommand( \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}, \hyperlink{lsredis_8c_a75e500f4f9df969ca9994d6889944f47}{lsredis\_configCB}, NULL, \textcolor{stringliteral}{"
      hgetall config.%s"}, lhostname);
  \}
  
  pthread\_mutex\_lock( &\hyperlink{lsredis_8c_a0c5cbd80d59d69603f123621cc6ddc30}{lsredis\_config\_mutex});
  \textcolor{keywordflow}{while}( \hyperlink{lsredis_8c_acdca9095c7a3288d7febe9f4c440a6e9}{lsredis\_head} == NULL)
    pthread\_cond\_wait( &\hyperlink{lsredis_8c_a6fa076f1004c85a8a1dc400f45547f32}{lsredis\_config\_cond}, &
      \hyperlink{lsredis_8c_a0c5cbd80d59d69603f123621cc6ddc30}{lsredis\_config\_mutex});
  pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_a0c5cbd80d59d69603f123621cc6ddc30}{lsredis\_config\_mutex});

\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a75e500f4f9df969ca9994d6889944f47}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-config\-C\-B@{lsredis\-\_\-config\-C\-B}}
\index{lsredis\-\_\-config\-C\-B@{lsredis\-\_\-config\-C\-B}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-config\-C\-B}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-config\-C\-B (
\begin{DoxyParamCaption}
\item[{redis\-Async\-Context $\ast$}]{ac, }
\item[{void $\ast$}]{reply, }
\item[{void $\ast$}]{privdata}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a75e500f4f9df969ca9994d6889944f47}


Definition at line 1103 of file lsredis.\-c.


\begin{DoxyCode}
                                                                           \{
  redisReply *r, *r2, *r3;
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};
  \textcolor{keywordtype}{char} *errmsg;
  \textcolor{keywordtype}{int} err, nerrmsg;

  r = reply;

  \textcolor{keywordflow}{if}( r == NULL) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_configCB: null reply,
       cannot configure, bad things will happen"});
    \textcolor{keywordflow}{return};
  \}

  \textcolor{keywordflow}{if}( r->type != REDIS\_REPLY\_ARRAY || (r->elements % 2) != 0) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_configCB: could not
       understand config reply.  Bad things will happen."});
    \textcolor{keywordflow}{return};
  \}

  pthread\_mutex\_lock( &\hyperlink{lsredis_8c_a0c5cbd80d59d69603f123621cc6ddc30}{lsredis\_config\_mutex});

  \textcolor{keywordflow}{for}( i=0; i<r->elements; i += 2) \{
    r2 = r->element[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}];
    r3 = r->element[i+1];
    \textcolor{keywordflow}{if}( r2->type != REDIS\_REPLY\_STRING || r2->type != REDIS\_REPLY\_STRING)
      \textcolor{keywordflow}{continue};
    \textcolor{comment}{//}
    \textcolor{comment}{// the LHS of the redis keys for this station}
    \textcolor{comment}{//}
    \textcolor{keywordflow}{if}( strcmp( r2->str, \textcolor{stringliteral}{"HEAD"})==0) \{
      \hyperlink{lsredis_8c_acdca9095c7a3288d7febe9f4c440a6e9}{lsredis\_head} = strdup( r3->str);
    \}
    \textcolor{comment}{//}
    \textcolor{comment}{// Publish changes to keys with this name as the publisher}
    \textcolor{comment}{//}
    \textcolor{keywordflow}{if}( strcmp( r2->str, \textcolor{stringliteral}{"PUB"})==0) \{
      \hyperlink{lsredis_8c_a0c81dce2e75584eeb14ab7d9dd86c72e}{lsredis\_publisher} = strdup( r3->str);
    \}

    \textcolor{keywordflow}{if}( strcmp( r2->str, \textcolor{stringliteral}{"PG"})==0) \{
      \hyperlink{pgpmac_8c_ae002f31c03cce9bf96cf0e0c2907cb2b}{pgpmac\_use\_pg} = r3->str[0] == \textcolor{charliteral}{'0'} ? 0 : 1;
    \}

    \textcolor{keywordflow}{if}( strcmp( r2->str, \textcolor{stringliteral}{"AUTOSCINT"})==0) \{
      \hyperlink{pgpmac_8c_ad163e2bc6ebe322058c113dee76c11ff}{pgpmac\_use\_autoscint} = r3->str[0] == \textcolor{charliteral}{'0'} ? 0 : 1;
    \}

    \textcolor{comment}{//}
    \textcolor{comment}{// reg expression to select keys we will be keeping a local copy of}
    \textcolor{comment}{//}
    \textcolor{keywordflow}{if}( strcmp( r2->str, \textcolor{stringliteral}{"RE"})==0) \{
      err = regcomp( &\hyperlink{lsredis_8c_abee04898347f9b2551fa0435b1cc597e}{lsredis\_key\_select\_regex}, r3->str
      , REG\_EXTENDED);
      \textcolor{keywordflow}{if}( err != 0) \{
        nerrmsg = regerror( err, &\hyperlink{lsredis_8c_abee04898347f9b2551fa0435b1cc597e}{lsredis\_key\_select\_regex}
      , NULL, 0);
        \textcolor{keywordflow}{if}( nerrmsg > 0) \{
          errmsg = calloc( nerrmsg, \textcolor{keyword}{sizeof}( \textcolor{keywordtype}{char}));
          nerrmsg = regerror( err, &\hyperlink{lsredis_8c_abee04898347f9b2551fa0435b1cc597e}{lsredis\_key\_select\_regex}
      , errmsg, nerrmsg);
          \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_configCB: %s"}, 
      errmsg);
          free( errmsg);
        \}
        exit( 1);
      \}
    \}
  \}

  \textcolor{comment}{/*}
\textcolor{comment}{    2013-02-16 12:03:20.669342  ARRAY of 6 elements}
\textcolor{comment}{    2013-02-16 12:03:20.669351      STRING: HEAD}
\textcolor{comment}{    2013-02-16 12:03:20.669354      STRING: stns.2}
\textcolor{comment}{    2013-02-16 12:03:20.669355      STRING: RE}
\textcolor{comment}{    2013-02-16 12:03:20.669361      STRING: redis\(\backslash\).kvseq|stns\(\backslash\).2\(\backslash\).(.+)}
\textcolor{comment}{    2013-02-16 12:03:20.669362      STRING: PUB}
\textcolor{comment}{    2013-02-16 12:03:20.669364      STRING: MD2-21-ID-E}
\textcolor{comment}{  */}


  \textcolor{keywordflow}{if}( redisAsyncCommand( \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}, \hyperlink{lsredis_8c_a84611531459bf3d92c45b86308b4a300}{lsredis\_subCB}, NULL, \textcolor{stringliteral}{"
      PSUBSCRIBE REDIS\_NODE\_CONNECTOR mk\_pgpmac\_redis UI* MD2-*"}) == REDIS\_ERR) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Error sending PSUBSCRIBE
       command"});
  \}
  redisAsyncCommand( \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}, \hyperlink{lsredis_8c_ace75c15c5308a0fcdafcb82c7506872a}{lsredis\_keysCB}, NULL, \textcolor{stringliteral}{"KEYS *"});

  pthread\_cond\_signal( &\hyperlink{lsredis_8c_a6fa076f1004c85a8a1dc400f45547f32}{lsredis\_config\_cond});
  pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_a0c5cbd80d59d69603f123621cc6ddc30}{lsredis\_config\_mutex});
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a8268fd06bda0e2c327b057a880b97b59}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-debug\-C\-B@{lsredis\-\_\-debug\-C\-B}}
\index{lsredis\-\_\-debug\-C\-B@{lsredis\-\_\-debug\-C\-B}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-debug\-C\-B}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-debug\-C\-B (
\begin{DoxyParamCaption}
\item[{redis\-Async\-Context $\ast$}]{ac, }
\item[{void $\ast$}]{reply, }
\item[{void $\ast$}]{privdata}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a8268fd06bda0e2c327b057a880b97b59}


Log the reply. 



Definition at line 116 of file lsredis.\-c.


\begin{DoxyCode}
                                                                          \{
  \textcolor{keyword}{static} \textcolor{keywordtype}{int} indentlevel = 0;
  redisReply *r;
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};

  r = (redisReply *)reply;

  \textcolor{keywordflow}{if}( r == NULL) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Null reply.  Odd"});
    \textcolor{keywordflow}{return};
  \}

  \textcolor{keywordflow}{switch}( r->type) \{
  \textcolor{keywordflow}{case} REDIS\_REPLY\_STATUS:
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"%*sSTATUS: %s"}, indentlevel*4,\textcolor{stringliteral}{
      ""}, r->str);
    \textcolor{keywordflow}{break};

  \textcolor{keywordflow}{case} REDIS\_REPLY\_ERROR:
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"%*sERROR: %s"}, indentlevel*4, \textcolor{stringliteral}{
      ""}, r->str);
    \textcolor{keywordflow}{break};

  \textcolor{keywordflow}{case} REDIS\_REPLY\_INTEGER:
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"%*sInteger: %lld"}, indentlevel
      *4, \textcolor{stringliteral}{""}, r->integer);
    \textcolor{keywordflow}{break};

  \textcolor{keywordflow}{case} REDIS\_REPLY\_NIL:
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"%*s(nil)"}, indentlevel*4, \textcolor{stringliteral}{""});
    \textcolor{keywordflow}{break};

  \textcolor{keywordflow}{case} REDIS\_REPLY\_STRING:
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"%*sSTRING: %s"}, indentlevel*4,
       \textcolor{stringliteral}{""}, r->str);
    \textcolor{keywordflow}{break};

  \textcolor{keywordflow}{case} REDIS\_REPLY\_ARRAY:
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"%*sARRAY of %d elements"}, 
      indentlevel*4, \textcolor{stringliteral}{""}, (\textcolor{keywordtype}{int})r->elements);
    indentlevel++;
    \textcolor{keywordflow}{for}( i=0; i<(int)r->elements; i++)
      \hyperlink{lsredis_8c_a8268fd06bda0e2c327b057a880b97b59}{lsredis\_debugCB}( ac, r->element[i], NULL);
    indentlevel--;
    \textcolor{keywordflow}{break};

  \textcolor{keywordflow}{default}:
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"%*sUnknown type %d"}, 
      indentlevel*4,\textcolor{stringliteral}{""}, r->type);

  \}
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a2e1f2258b3cc864ce3eef4eda556e2a6}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-del\-Read@{lsredis\-\_\-del\-Read}}
\index{lsredis\-\_\-del\-Read@{lsredis\-\_\-del\-Read}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-del\-Read}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-del\-Read (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{data}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a2e1f2258b3cc864ce3eef4eda556e2a6}


hook to manage \char`\"{}don't need to read\char`\"{} events 



Definition at line 686 of file lsredis.\-c.


\begin{DoxyCode}
                                  \{
  \textcolor{keyword}{struct }pollfd *pfd;
  pfd = (\textcolor{keyword}{struct }pollfd *)data;

  \textcolor{keywordflow}{if}( (pfd->events & POLLIN) != 0) \{
    pfd->events &= ~POLLIN;
    pthread\_kill( \hyperlink{lsredis_8c_a79c33eb11ad6819247930ade3a25671f}{lsredis\_thread}, SIGUSR1);
  \}
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a04f0119cfa1156dc34d35b237358822a}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-del\-Write@{lsredis\-\_\-del\-Write}}
\index{lsredis\-\_\-del\-Write@{lsredis\-\_\-del\-Write}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-del\-Write}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-del\-Write (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{data}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a04f0119cfa1156dc34d35b237358822a}


hook to manage \char`\"{}don't need to write anymore\char`\"{} events 



Definition at line 710 of file lsredis.\-c.


\begin{DoxyCode}
                                   \{
  \textcolor{keyword}{struct }pollfd *pfd;
  pfd = (\textcolor{keyword}{struct }pollfd *)data;

  \textcolor{keywordflow}{if}( (pfd->events & POLLOUT) != 0) \{
    pfd->events &= ~POLLOUT;
    pthread\_kill( \hyperlink{lsredis_8c_a79c33eb11ad6819247930ade3a25671f}{lsredis\_thread}, SIGUSR1);
  \}
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_ae1478efc852fef71550e0f58d602fa2b}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-fd\-\_\-service@{lsredis\-\_\-fd\-\_\-service}}
\index{lsredis\-\_\-fd\-\_\-service@{lsredis\-\_\-fd\-\_\-service}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-fd\-\_\-service}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-fd\-\_\-service (
\begin{DoxyParamCaption}
\item[{struct pollfd $\ast$}]{evt}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_ae1478efc852fef71550e0f58d602fa2b}


service the socket requests 



Definition at line 1293 of file lsredis.\-c.


\begin{DoxyCode}
                                             \{
  pthread\_mutex\_lock( &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex});
  \textcolor{keywordflow}{if}( evt->fd == \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->c.fd) \{
    \textcolor{keywordflow}{if}( evt->revents & POLLIN)
      redisAsyncHandleRead( \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac});
    \textcolor{keywordflow}{if}( evt->revents & POLLOUT)
      redisAsyncHandleWrite( \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac});
  \}
  \textcolor{keywordflow}{if}( evt->fd == \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->c.fd) \{
    \textcolor{keywordflow}{if}( evt->revents & POLLIN)
      redisAsyncHandleRead( \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac});
    \textcolor{keywordflow}{if}( evt->revents & POLLOUT)
      redisAsyncHandleWrite( \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac});
  \}
  \textcolor{keywordflow}{if}( evt->fd == \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->c.fd) \{
    \textcolor{keywordflow}{if}( evt->revents & POLLIN)
      redisAsyncHandleRead( \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac});
    \textcolor{keywordflow}{if}( evt->revents & POLLOUT)
      redisAsyncHandleWrite( \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac});
  \}
  pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex});
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a87d7bb0ade6f247edfbb7803aac9e694}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-find\-\_\-preset@{lsredis\-\_\-find\-\_\-preset}}
\index{lsredis\-\_\-find\-\_\-preset@{lsredis\-\_\-find\-\_\-preset}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-find\-\_\-preset}]{\setlength{\rightskip}{0pt plus 5cm}int lsredis\-\_\-find\-\_\-preset (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{motor\-\_\-name, }
\item[{char $\ast$}]{preset\-\_\-name, }
\item[{double $\ast$}]{dval}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a87d7bb0ade6f247edfbb7803aac9e694}


Get the value of the given preset and return it in dval Returns 0 on error, non-\/zero on success;. 



Definition at line 937 of file lsredis.\-c.


\begin{DoxyCode}
                                                                            \{
  \textcolor{keywordtype}{char} s[512];
  \textcolor{keywordtype}{int} err;
  ENTRY entry\_in, *entry\_outp;
  \hyperlink{structlsredis__preset__list__struct}{lsredis\_preset\_list\_t} *pl;

  snprintf( s, \textcolor{keyword}{sizeof}( s)-1, \textcolor{stringliteral}{"%s%s"}, motor\_name, preset\_name);
  s[\textcolor{keyword}{sizeof}(s)-1] = 0;

  entry\_in.key  = s;
  entry\_in.data = NULL;
  err = hsearch\_r( entry\_in, FIND, &entry\_outp, &\hyperlink{lsredis_8c_ade00a383533fdefb2af9f3f53f37cf97}{lsredis\_preset\_ht}
      );

  \textcolor{keywordflow}{if}( err == 0) \{
    \textcolor{comment}{// not found (or some other problem that means we don't have an answer}
    \textcolor{comment}{//}
    \textcolor{comment}{// Maybe someone added a new preset and we don't know about it yet}
    \textcolor{comment}{//}
    \hyperlink{lsredis_8c_af48b297b5679750a131fa1e982a078b7}{lsredis\_load\_presets}( motor\_name);
    err = hsearch\_r( entry\_in, FIND, &entry\_outp, &\hyperlink{lsredis_8c_ade00a383533fdefb2af9f3f53f37cf97}{lsredis\_preset\_ht}
      );
    \textcolor{keywordflow}{if}( err == 0) \{
      \textcolor{comment}{//}
      \textcolor{comment}{// Guess not.  Give up.  We tried}
      \textcolor{comment}{//}
      *dval = 0.0;
      \textcolor{keywordflow}{return} 0;
    \}
  \}
  pl = entry\_outp->data;
  *dval = \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\_getd}( pl->\hyperlink{structlsredis__preset__list__struct_ae365a576448adeccb66fbb85cfcf4b23}{position});
  \textcolor{keywordflow}{return} 1;
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_adfe823e3ccec7e37ac4697179bd65b10}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-find\-\_\-preset\-\_\-index\-\_\-by\-\_\-position@{lsredis\-\_\-find\-\_\-preset\-\_\-index\-\_\-by\-\_\-position}}
\index{lsredis\-\_\-find\-\_\-preset\-\_\-index\-\_\-by\-\_\-position@{lsredis\-\_\-find\-\_\-preset\-\_\-index\-\_\-by\-\_\-position}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-find\-\_\-preset\-\_\-index\-\_\-by\-\_\-position}]{\setlength{\rightskip}{0pt plus 5cm}int lsredis\-\_\-find\-\_\-preset\-\_\-index\-\_\-by\-\_\-position (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{mp}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_adfe823e3ccec7e37ac4697179bd65b10}


For the given motor object return the index of the current preset or -\/1 if we are not at a preset position. 



Definition at line 1035 of file lsredis.\-c.


\begin{DoxyCode}
                                                               \{
  \hyperlink{structlsredis__obj__struct}{lsredis\_obj\_t} *\hyperlink{namespacemk__pgpmac__redis_a11daf2847f2dc94562b5b61b3f412574}{p};
  \textcolor{keywordtype}{int} plength;
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};
  \textcolor{keywordtype}{double} ur, pos;

  p = \hyperlink{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{lsredis\_get\_obj}( \textcolor{stringliteral}{"%s.presets.length"}, mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name});
  plength = \hyperlink{lsredis_8c_a71689006ffc015be6a0705a7c0aef1be}{lsredis\_get\_or\_set\_l}( p, 0);
  
  \textcolor{keywordflow}{if}( plength <= 0) \{
    \textcolor{keywordflow}{return} -1;
  \}

  ur = \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\_getd}( mp->\hyperlink{structlspmac__motor__struct_aefa84c7592369090eec8b211caaa3a51}{update\_resolution});
  pos = \hyperlink{lspmac_8c_acc46bdddee59bd8c5ad662b3fd445e9f}{lspmac\_getPosition}( mp);

  \textcolor{keywordflow}{for}( i=0; i<plength; i++) \{
    p = \hyperlink{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{lsredis\_get\_obj}( \textcolor{stringliteral}{"%s.presets.%d.position"}, mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name},
       i);
    \textcolor{keywordflow}{if}( fabs( pos - \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\_getd}( p)) <= ur) \{
      \textcolor{keywordflow}{return} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};
    \}
  \}
  \textcolor{keywordflow}{return} -1;
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-get\-\_\-obj@{lsredis\-\_\-get\-\_\-obj}}
\index{lsredis\-\_\-get\-\_\-obj@{lsredis\-\_\-get\-\_\-obj}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-get\-\_\-obj}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lsredis\-\_\-obj\-\_\-t}$\ast$ lsredis\-\_\-get\-\_\-obj (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{fmt, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}


Definition at line 630 of file lsredis.\-c.


\begin{DoxyCode}
                                                \{
  \hyperlink{structlsredis__obj__struct}{lsredis\_obj\_t} *rtn;
  va\_list arg\_ptr;
  \textcolor{keywordtype}{char} k[512];
  \textcolor{keywordtype}{char} *kp;
  \textcolor{keywordtype}{int} nkp;

  va\_start( arg\_ptr, fmt);
  vsnprintf( k, \textcolor{keyword}{sizeof}(k)-1, fmt, arg\_ptr);
  k[\textcolor{keyword}{sizeof}(k)-1] = 0;
  va\_end( arg\_ptr);

  nkp = strlen(k) + strlen( \hyperlink{lsredis_8c_acdca9095c7a3288d7febe9f4c440a6e9}{lsredis\_head}) + 16;             \textcolor{comment}{// 16
       is overkill. I know. Get over it.}
  kp = calloc( nkp, \textcolor{keyword}{sizeof}( \textcolor{keywordtype}{char}));
  \textcolor{keywordflow}{if}( kp == NULL) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_get\_obj: Out of memory
      "});
    exit( -1);
  \}
  
  snprintf( kp, nkp-1, \textcolor{stringliteral}{"%s.%s"}, \hyperlink{lsredis_8c_acdca9095c7a3288d7febe9f4c440a6e9}{lsredis\_head}, k);
  kp[nkp-1] = 0;

  pthread\_mutex\_lock( &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex});
  \textcolor{keywordflow}{while}( \hyperlink{lsredis_8c_a7461eb2b5974a2ffac2189007d39193c}{lsredis\_running} == 0)
    pthread\_cond\_wait( &\hyperlink{lsredis_8c_a2f63408d16b5603541b124a78f36a5a8}{lsredis\_cond}, &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex});

  rtn = \hyperlink{lsredis_8c_ac3fb8589e280bfa18ecbca6619fea637}{\_lsredis\_get\_obj}( kp);
  pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex});

  free( kp);
  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a51c33bec2c54f2d468bf8d93d981914a}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-get\-\_\-or\-\_\-set\-\_\-d@{lsredis\-\_\-get\-\_\-or\-\_\-set\-\_\-d}}
\index{lsredis\-\_\-get\-\_\-or\-\_\-set\-\_\-d@{lsredis\-\_\-get\-\_\-or\-\_\-set\-\_\-d}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-get\-\_\-or\-\_\-set\-\_\-d}]{\setlength{\rightskip}{0pt plus 5cm}double lsredis\-\_\-get\-\_\-or\-\_\-set\-\_\-d (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p, }
\item[{double}]{val, }
\item[{int}]{prec}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a51c33bec2c54f2d468bf8d93d981914a}


Definition at line 359 of file lsredis.\-c.


\begin{DoxyCode}
                                                                     \{
  \textcolor{keywordtype}{long} \textcolor{keywordtype}{int} rtn;
  \textcolor{keywordtype}{int} err;
  \textcolor{keyword}{struct }timespec timeout;

  clock\_gettime( CLOCK\_REALTIME, &timeout);
  timeout.tv\_sec += 2;

  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  err = 0;
  \textcolor{keywordflow}{while}( err == 0 && p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} == 0)
    err = pthread\_cond\_timedwait( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex}, &timeout);

  \textcolor{keywordflow}{if}( err == ETIMEDOUT) \{
    rtn = val;
    pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
    \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\_setstr}( p, \textcolor{stringliteral}{"%.*f"}, prec, val);
  \} \textcolor{keywordflow}{else} \{
    rtn = p->\hyperlink{structlsredis__obj__struct_a26211a0ab3fc02e7776e24dbc1f1256c}{lvalue};
    pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \}
  
  \textcolor{keywordflow}{return} rtn;
\}  
\end{DoxyCode}
\hypertarget{lsredis_8c_a71689006ffc015be6a0705a7c0aef1be}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-get\-\_\-or\-\_\-set\-\_\-l@{lsredis\-\_\-get\-\_\-or\-\_\-set\-\_\-l}}
\index{lsredis\-\_\-get\-\_\-or\-\_\-set\-\_\-l@{lsredis\-\_\-get\-\_\-or\-\_\-set\-\_\-l}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-get\-\_\-or\-\_\-set\-\_\-l}]{\setlength{\rightskip}{0pt plus 5cm}long int lsredis\-\_\-get\-\_\-or\-\_\-set\-\_\-l (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p, }
\item[{long int}]{val}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a71689006ffc015be6a0705a7c0aef1be}


Definition at line 422 of file lsredis.\-c.


\begin{DoxyCode}
                                                               \{
  \textcolor{keywordtype}{long} \textcolor{keywordtype}{int} rtn;
  \textcolor{keywordtype}{int} err;
  \textcolor{keyword}{struct }timespec timeout;

  clock\_gettime( CLOCK\_REALTIME, &timeout);
  timeout.tv\_sec += 2;

  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  err = 0;
  \textcolor{keywordflow}{while}( err == 0 && p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} == 0)
    err = pthread\_cond\_timedwait( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex}, &timeout);

  \textcolor{keywordflow}{if}( err == ETIMEDOUT) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_get\_or\_set\_l: using
       default value of %ld for redis variable %s"}, val, p->\hyperlink{structlsredis__obj__struct_aa8c5a453b9424e5666320b8675a42f5c}{key});
    rtn = val;
    pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
    \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\_setstr}( p, \textcolor{stringliteral}{"%ld"}, val);
  \} \textcolor{keywordflow}{else} \{
    rtn = p->\hyperlink{structlsredis__obj__struct_a26211a0ab3fc02e7776e24dbc1f1256c}{lvalue};
    pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \}
  
  \textcolor{keywordflow}{return} rtn;
\}  
\end{DoxyCode}
\hypertarget{lsredis_8c_abe31d0e11c41b2235307612c963bb652}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-get\-\_\-string\-\_\-array@{lsredis\-\_\-get\-\_\-string\-\_\-array}}
\index{lsredis\-\_\-get\-\_\-string\-\_\-array@{lsredis\-\_\-get\-\_\-string\-\_\-array}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-get\-\_\-string\-\_\-array}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$$\ast$ lsredis\-\_\-get\-\_\-string\-\_\-array (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_abe31d0e11c41b2235307612c963bb652}


Definition at line 448 of file lsredis.\-c.


\begin{DoxyCode}
                                                   \{
  \textcolor{keywordtype}{char} **rtn;

  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{if}( p->\hyperlink{structlsredis__obj__struct_ae0aa00ad745ee5bbc598c23ab794ed8a}{creating} != 0) \{
    pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
    \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\_setstr}( p, \textcolor{stringliteral}{""});
    pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \}

  \textcolor{keywordflow}{while}( p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} == 0)
    pthread\_cond\_wait( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

  rtn = p->\hyperlink{structlsredis__obj__struct_ac065eeede0e08f25bcfedd45022fe593}{avalue};
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  
  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_abbb4e5ece19ebd130e1be18036752a08}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-getb@{lsredis\-\_\-getb}}
\index{lsredis\-\_\-getb@{lsredis\-\_\-getb}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-getb}]{\setlength{\rightskip}{0pt plus 5cm}int lsredis\-\_\-getb (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_abbb4e5ece19ebd130e1be18036752a08}


Definition at line 467 of file lsredis.\-c.


\begin{DoxyCode}
                                    \{
  \textcolor{keywordtype}{int} rtn;

  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{if}( p->\hyperlink{structlsredis__obj__struct_ae0aa00ad745ee5bbc598c23ab794ed8a}{creating} != 0) \{
    pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
    \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\_setstr}( p, \textcolor{stringliteral}{""});
    pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \}
  \textcolor{keywordflow}{while}( p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} == 0)
    pthread\_cond\_wait( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

  rtn = p->\hyperlink{structlsredis__obj__struct_ac3df3eaa275c1e8e333024c1fa8353af}{bvalue};
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  
  \textcolor{keywordflow}{return} rtn;
\}  
\end{DoxyCode}
\hypertarget{lsredis_8c_a0b7600b1c9a4550b32d4be019d25f941}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-getc@{lsredis\-\_\-getc}}
\index{lsredis\-\_\-getc@{lsredis\-\_\-getc}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-getc}]{\setlength{\rightskip}{0pt plus 5cm}char lsredis\-\_\-getc (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a0b7600b1c9a4550b32d4be019d25f941}


Definition at line 485 of file lsredis.\-c.


\begin{DoxyCode}
                                     \{
  \textcolor{keywordtype}{int} rtn;

  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{if}( p->\hyperlink{structlsredis__obj__struct_ae0aa00ad745ee5bbc598c23ab794ed8a}{creating} != 0) \{
    pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
    \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\_setstr}( p, \textcolor{stringliteral}{""});
    pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \}
  \textcolor{keywordflow}{while}( p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} == 0)
    pthread\_cond\_wait( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

  rtn = p->\hyperlink{structlsredis__obj__struct_a4a5933dbd44d33d9f594f6020a443b69}{cvalue};
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  
  \textcolor{keywordflow}{return} rtn;
\}  
\end{DoxyCode}
\hypertarget{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-getd@{lsredis\-\_\-getd}}
\index{lsredis\-\_\-getd@{lsredis\-\_\-getd}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-getd}]{\setlength{\rightskip}{0pt plus 5cm}double lsredis\-\_\-getd (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}


Definition at line 384 of file lsredis.\-c.


\begin{DoxyCode}
                                       \{
  \textcolor{keywordtype}{double} rtn;

  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{if}( p->\hyperlink{structlsredis__obj__struct_ae0aa00ad745ee5bbc598c23ab794ed8a}{creating} != 0) \{
    pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
    \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\_setstr}( p, \textcolor{stringliteral}{""});
    pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \}

  \textcolor{keywordflow}{while}( p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} == 0)
    pthread\_cond\_wait( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

  rtn = p->\hyperlink{structlsredis__obj__struct_ab60d0a71cabad6b921b6edb5a8f68996}{dvalue};
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  
  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a1923f998441f4f451204dfd214d52218}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-getl@{lsredis\-\_\-getl}}
\index{lsredis\-\_\-getl@{lsredis\-\_\-getl}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-getl}]{\setlength{\rightskip}{0pt plus 5cm}long int lsredis\-\_\-getl (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a1923f998441f4f451204dfd214d52218}


Definition at line 403 of file lsredis.\-c.


\begin{DoxyCode}
                                         \{
  \textcolor{keywordtype}{long} \textcolor{keywordtype}{int} rtn;

  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{if}( p->\hyperlink{structlsredis__obj__struct_ae0aa00ad745ee5bbc598c23ab794ed8a}{creating} != 0) \{
    pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
    \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\_setstr}( p, \textcolor{stringliteral}{""});
    pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \}

  \textcolor{keywordflow}{while}( p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} == 0)
    pthread\_cond\_wait( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

  rtn = p->\hyperlink{structlsredis__obj__struct_a26211a0ab3fc02e7776e24dbc1f1256c}{lvalue};
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  
  \textcolor{keywordflow}{return} rtn;
\}  
\end{DoxyCode}
\hypertarget{lsredis_8c_ac1994e56114b2315294527d76311f829}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-getstr@{lsredis\-\_\-getstr}}
\index{lsredis\-\_\-getstr@{lsredis\-\_\-getstr}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-getstr}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ lsredis\-\_\-getstr (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_ac1994e56114b2315294527d76311f829}


return a copy of the key's string value be sure to free the result 



Definition at line 282 of file lsredis.\-c.


\begin{DoxyCode}
                                        \{
  \textcolor{keywordtype}{char} *rtn;

  \textcolor{comment}{//}
  \textcolor{comment}{// Have to use strdup since we cannot guarantee that p->value won't be freed
       while the caller is still using it}
  \textcolor{comment}{//}
  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{while}( p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} == 0)
    pthread\_cond\_wait( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

  rtn = strdup(p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value});
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_acd9cb833103e57da756d152ecdd4f840}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-heartbeat\-\_\-cb@{lsredis\-\_\-heartbeat\-\_\-cb}}
\index{lsredis\-\_\-heartbeat\-\_\-cb@{lsredis\-\_\-heartbeat\-\_\-cb}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-heartbeat\-\_\-cb}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-heartbeat\-\_\-cb (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{event}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_acd9cb833103e57da756d152ecdd4f840}


Definition at line 1334 of file lsredis.\-c.


\begin{DoxyCode}
                                        \{
  \textcolor{keyword}{static} \hyperlink{structlsredis__obj__struct}{lsredis\_obj\_t} *hb\_time = NULL;
  \textcolor{keyword}{struct }timespec \hyperlink{kvredis_8c_ad40ac52086f6b774928af45b09d54c6e}{now};
  \textcolor{keyword}{struct }tm lnow;
  \textcolor{keywordtype}{char} snow[64];
  \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} msecs;

  \textcolor{keywordflow}{if}( hb\_time == NULL) \{
    hb\_time = \hyperlink{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{lsredis\_get\_obj}( \textcolor{stringliteral}{"time"});
  \}

  \textcolor{keywordflow}{if}( hb\_time == NULL) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_heartbeat\_cb: null
       redis object.  Why?"});
    \textcolor{keywordflow}{return};
  \}

  clock\_gettime( CLOCK\_REALTIME, &\hyperlink{kvredis_8c_ad40ac52086f6b774928af45b09d54c6e}{now});
  localtime\_r( &\hyperlink{kvredis_8c_ad40ac52086f6b774928af45b09d54c6e}{now}.tv\_sec, &lnow);
  msecs = \hyperlink{kvredis_8c_ad40ac52086f6b774928af45b09d54c6e}{now}.tv\_nsec / 1000;
  strftime( snow, \textcolor{keyword}{sizeof}(snow)-1, \textcolor{stringliteral}{"%Y-%m-%d %H:%M:%S"}, &lnow);
  \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\_setstr}( hb\_time, \textcolor{stringliteral}{"%s.%.06u"}, snow, msecs);
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a8d9719b362d1b38275d734971b7988af}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-hget\-C\-B@{lsredis\-\_\-hget\-C\-B}}
\index{lsredis\-\_\-hget\-C\-B@{lsredis\-\_\-hget\-C\-B}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-hget\-C\-B}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-hget\-C\-B (
\begin{DoxyParamCaption}
\item[{redis\-Async\-Context $\ast$}]{ac, }
\item[{void $\ast$}]{reply, }
\item[{void $\ast$}]{privdata}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a8d9719b362d1b38275d734971b7988af}


Definition at line 503 of file lsredis.\-c.


\begin{DoxyCode}
                                                                         \{
  redisReply *r;
  \hyperlink{structlsredis__obj__struct}{lsredis\_obj\_t} *\hyperlink{namespacemk__pgpmac__redis_a11daf2847f2dc94562b5b61b3f412574}{p};

  r = reply;
  p =  privdata;

  \textcolor{comment}{//  lslogging\_log\_message( "hgetCB: %s %s", p == NULL ? "<NULL>" : p->key,
       r->type == REDIS\_REPLY\_STRING ? r->str : "Non-string value.  Why?");}

  \textcolor{comment}{//}
  \textcolor{comment}{// Apparently this item does not exist}
  \textcolor{comment}{// Just set it to an empty string so at least other apps will have the same
       behaviour as us}
  \textcolor{comment}{// TODO: figure out a better way to deal with missing key/values}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( p != NULL && r->type == REDIS\_REPLY\_NIL) \{
    \textcolor{comment}{//}
    \textcolor{comment}{// Show that we are creating this new key}
    \textcolor{comment}{// if the next request is a read we'll create an empty string value and
       return it}
    \textcolor{comment}{// if the next request is a write then we'll create that value and return
       it}
    \textcolor{comment}{//}
    pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
    p->\hyperlink{structlsredis__obj__struct_ae0aa00ad745ee5bbc598c23ab794ed8a}{creating} = 1;
    pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
    \textcolor{keywordflow}{return};
  \}

  \textcolor{keywordflow}{if}( p != NULL && r->type == REDIS\_REPLY\_STRING && r->str != NULL) \{
    pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

    \hyperlink{lsredis_8c_a05c7ed2bb1b5702a5c83ed3b51abb546}{\_lsredis\_set\_value}( p, r->str);

    pthread\_cond\_signal( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond});
    pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \}
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a4a7466a8c5b90df6dfc78aef625220f4}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-init@{lsredis\-\_\-init}}
\index{lsredis\-\_\-init@{lsredis\-\_\-init}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a4a7466a8c5b90df6dfc78aef625220f4}


Initialize this module, that is, set up the connections. 


\begin{DoxyParams}{Parameters}
{\em pub} & Publish under this (unique) name \\
\hline
{\em re} & Regular expression to select keys we want to mirror \\
\hline
{\em head} & Prepend this (+ a dot) to the beginning of requested objects \\
\hline
\end{DoxyParams}


Definition at line 1193 of file lsredis.\-c.


\begin{DoxyCode}
                    \{
  \textcolor{keywordtype}{int} err;


  \textcolor{comment}{//}
  \textcolor{comment}{// set up hash map to store redis objects}
  \textcolor{comment}{//}
  err = hcreate\_r( 8192, &\hyperlink{lsredis_8c_a42aec6aa74072797ec0344847b0e9e39}{lsredis\_htab});
  \textcolor{keywordflow}{if}( err == 0) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_init: Cannot create
       hash table.  Really bad things are going to happen.  hcreate\_r returned %d"}, err);
  \}

  pthread\_cond\_init( &\hyperlink{lsredis_8c_a2f63408d16b5603541b124a78f36a5a8}{lsredis\_cond}, NULL);

  \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac} = redisAsyncConnect(\textcolor{stringliteral}{"127.0.0.1"}, 6379);
  \textcolor{keywordflow}{if}( \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->err) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Error: %s"}, \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->errstr
      );
  \}

  \hyperlink{lsredis_8c_a0cd3bdc79d035eb1595371c845d14367}{subfd}.fd           = \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->c.fd;
  \hyperlink{lsredis_8c_a0cd3bdc79d035eb1595371c845d14367}{subfd}.events       = 0;
  \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->ev.data     = &\hyperlink{lsredis_8c_a0cd3bdc79d035eb1595371c845d14367}{subfd};
  \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->ev.addRead  = \hyperlink{lsredis_8c_adee3bccecc86dd531ac5f89491632439}{lsredis\_addRead};
  \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->ev.delRead  = \hyperlink{lsredis_8c_a2e1f2258b3cc864ce3eef4eda556e2a6}{lsredis\_delRead};
  \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->ev.addWrite = \hyperlink{lsredis_8c_a3cb6eda5c8ae80019e7a1c078940e9e9}{lsredis\_addWrite};
  \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->ev.delWrite = \hyperlink{lsredis_8c_a04f0119cfa1156dc34d35b237358822a}{lsredis\_delWrite};
  \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->ev.cleanup  = \hyperlink{lsredis_8c_a45f946a5262c23b362be17c2cb0310c2}{lsredis\_cleanup};

  \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac} = redisAsyncConnect(\textcolor{stringliteral}{"127.0.0.1"}, 6379);
  \textcolor{keywordflow}{if}( \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->err) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Error: %s"}, \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->errstr);
  \}

  \hyperlink{lsredis_8c_add819e43a356d0575ec64c346c6fed57}{rofd}.fd           = \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->c.fd;
  \hyperlink{lsredis_8c_add819e43a356d0575ec64c346c6fed57}{rofd}.events       = 0;
  \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->ev.data     = &\hyperlink{lsredis_8c_add819e43a356d0575ec64c346c6fed57}{rofd};
  \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->ev.addRead  = \hyperlink{lsredis_8c_adee3bccecc86dd531ac5f89491632439}{lsredis\_addRead};
  \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->ev.delRead  = \hyperlink{lsredis_8c_a2e1f2258b3cc864ce3eef4eda556e2a6}{lsredis\_delRead};
  \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->ev.addWrite = \hyperlink{lsredis_8c_a3cb6eda5c8ae80019e7a1c078940e9e9}{lsredis\_addWrite};
  \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->ev.delWrite = \hyperlink{lsredis_8c_a04f0119cfa1156dc34d35b237358822a}{lsredis\_delWrite};
  \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->ev.cleanup  = \hyperlink{lsredis_8c_a45f946a5262c23b362be17c2cb0310c2}{lsredis\_cleanup};

  \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac} = redisAsyncConnect(\textcolor{stringliteral}{"127.0.0.1"}, 6379);
  \textcolor{keywordflow}{if}( \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->err) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Error: %s"}, \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->errstr);
  \}

  \hyperlink{lsredis_8c_a13acbee14dbe8cdb98e238abb921d048}{wrfd}.fd           = \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->c.fd;
  \hyperlink{lsredis_8c_a13acbee14dbe8cdb98e238abb921d048}{wrfd}.events       = 0;
  \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->ev.data     = &\hyperlink{lsredis_8c_a13acbee14dbe8cdb98e238abb921d048}{wrfd};
  \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->ev.addRead  = \hyperlink{lsredis_8c_adee3bccecc86dd531ac5f89491632439}{lsredis\_addRead};
  \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->ev.delRead  = \hyperlink{lsredis_8c_a2e1f2258b3cc864ce3eef4eda556e2a6}{lsredis\_delRead};
  \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->ev.addWrite = \hyperlink{lsredis_8c_a3cb6eda5c8ae80019e7a1c078940e9e9}{lsredis\_addWrite};
  \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->ev.delWrite = \hyperlink{lsredis_8c_a04f0119cfa1156dc34d35b237358822a}{lsredis\_delWrite};
  \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->ev.cleanup  = \hyperlink{lsredis_8c_a45f946a5262c23b362be17c2cb0310c2}{lsredis\_cleanup};


  \textcolor{comment}{// separate hash table for the presets}
  \textcolor{comment}{//}
  hcreate\_r( \hyperlink{lsredis_8c_ace88a236f88278adaac5419a7281c490}{lsredis\_preset\_max\_n} * 2, &\hyperlink{lsredis_8c_ade00a383533fdefb2af9f3f53f37cf97}{lsredis\_preset\_ht}
      );

  pthread\_mutexattr\_init( &\hyperlink{lsredis_8c_a71c9f418904364d65c22d786f4dc5d39}{mutex\_initializer});
  pthread\_mutexattr\_settype( &\hyperlink{lsredis_8c_a71c9f418904364d65c22d786f4dc5d39}{mutex\_initializer}, 
      PTHREAD\_MUTEX\_RECURSIVE);

  pthread\_mutex\_init( &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex}, &\hyperlink{lsredis_8c_a71c9f418904364d65c22d786f4dc5d39}{mutex\_initializer}
      );
  pthread\_mutex\_init( &\hyperlink{lsredis_8c_a1d0b14b31b12d1b2a79dc50eac09de39}{lsredis\_preset\_list\_mutex}, &
      \hyperlink{lsredis_8c_a71c9f418904364d65c22d786f4dc5d39}{mutex\_initializer});
  pthread\_mutex\_init( &\hyperlink{lsredis_8c_a0c5cbd80d59d69603f123621cc6ddc30}{lsredis\_config\_mutex}, &
      \hyperlink{lsredis_8c_a71c9f418904364d65c22d786f4dc5d39}{mutex\_initializer});
  pthread\_cond\_init(  &\hyperlink{lsredis_8c_a6fa076f1004c85a8a1dc400f45547f32}{lsredis\_config\_cond},  NULL);

\}
\end{DoxyCode}
\hypertarget{lsredis_8c_ace75c15c5308a0fcdafcb82c7506872a}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-keys\-C\-B@{lsredis\-\_\-keys\-C\-B}}
\index{lsredis\-\_\-keys\-C\-B@{lsredis\-\_\-keys\-C\-B}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-keys\-C\-B}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-keys\-C\-B (
\begin{DoxyParamCaption}
\item[{redis\-Async\-Context $\ast$}]{ac, }
\item[{void $\ast$}]{reply, }
\item[{void $\ast$}]{privdata}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_ace75c15c5308a0fcdafcb82c7506872a}


Sift through the keys to find ones we like. 

Add them to our list of followed objects 

Definition at line 841 of file lsredis.\-c.


\begin{DoxyCode}
                                                                         \{
  redisReply *r;
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};
  
  r = reply;
  \textcolor{keywordflow}{if}( r->type != REDIS\_REPLY\_ARRAY) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_keysCB: exepected
       array..."});
    \hyperlink{lsredis_8c_a8268fd06bda0e2c327b057a880b97b59}{lsredis\_debugCB}( ac, reply, privdata);
    \textcolor{keywordflow}{return};
  \}
  
  \textcolor{keywordflow}{for}( i=0; i< (int)r->elements; i++) \{
    \textcolor{keywordflow}{if}( r->element[i]->type != REDIS\_REPLY\_STRING) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_keysCB: exepected
       string..."});
      \hyperlink{lsredis_8c_a8268fd06bda0e2c327b057a880b97b59}{lsredis\_debugCB}( ac, r->element[i], privdata);
    \} \textcolor{keywordflow}{else} \{
      \hyperlink{lsredis_8c_ad3189a7329ca92efab0054921f608b97}{lsredis\_maybe\_add\_key}( r->element[i]->str);
    \}
  \}
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_af48b297b5679750a131fa1e982a078b7}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-load\-\_\-presets@{lsredis\-\_\-load\-\_\-presets}}
\index{lsredis\-\_\-load\-\_\-presets@{lsredis\-\_\-load\-\_\-presets}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-load\-\_\-presets}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-load\-\_\-presets (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{motor\-\_\-name}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_af48b297b5679750a131fa1e982a078b7}


update the presets hash table for the named motor 



Definition at line 864 of file lsredis.\-c.


\begin{DoxyCode}
                                             \{
  \hyperlink{structlsredis__obj__struct}{lsredis\_obj\_t} *\hyperlink{namespacemk__pgpmac__redis_a11daf2847f2dc94562b5b61b3f412574}{p};
  \hyperlink{structlsredis__preset__list__struct}{lsredis\_preset\_list\_t} *pl;
  \textcolor{keywordtype}{int} plength;
  \textcolor{keywordtype}{char} *preset\_name;
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};
  \textcolor{keywordtype}{int} key\_length;
  ENTRY entry\_in, *entry\_outp;

  p = \hyperlink{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{lsredis\_get\_obj}( \textcolor{stringliteral}{"%s.presets.length"}, motor\_name);
  plength = \hyperlink{lsredis_8c_a71689006ffc015be6a0705a7c0aef1be}{lsredis\_get\_or\_set\_l}( p, 0);
  \textcolor{keywordflow}{if}( plength <= 0)
    \textcolor{keywordflow}{return};

  pthread\_mutex\_lock( &\hyperlink{lsredis_8c_a1d0b14b31b12d1b2a79dc50eac09de39}{lsredis\_preset\_list\_mutex});

  \textcolor{keywordflow}{for}( i=0; i<plength; i++) \{
    pl = calloc( 1, \textcolor{keyword}{sizeof}( \hyperlink{structlsredis__preset__list__struct}{lsredis\_preset\_list\_t}));
    pl->\hyperlink{structlsredis__preset__list__struct_a285a79dd419ae70c5b75ef57914d3331}{name}      = \hyperlink{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{lsredis\_get\_obj}( \textcolor{stringliteral}{"%s.presets.%d.name"},  
         motor\_name, i);
    pl->\hyperlink{structlsredis__preset__list__struct_ae365a576448adeccb66fbb85cfcf4b23}{position}  = \hyperlink{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{lsredis\_get\_obj}( \textcolor{stringliteral}{"
      %s.presets.%d.position"}, motor\_name, i);
    pl->\hyperlink{structlsredis__preset__list__struct_abadcee1d288db4b988946f62bb28d5df}{index}     = \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};
    
    preset\_name   = \hyperlink{lsredis_8c_ac1994e56114b2315294527d76311f829}{lsredis\_getstr}( pl->\hyperlink{structlsredis__preset__list__struct_a285a79dd419ae70c5b75ef57914d3331}{name});
    key\_length    = strlen( motor\_name) + strlen( preset\_name) + 1;
    pl->\hyperlink{structlsredis__preset__list__struct_ab3a50b52cf845fa70667d8be9ea7d73b}{key}       = calloc( key\_length, 1);

    pl->\hyperlink{structlsredis__preset__list__struct_a14422c8bfa270e5620c66be871091f67}{next}            = \hyperlink{lsredis_8c_a232f994f0d91ba8157cbcfe429fc90de}{lsredis\_preset\_list};
    \hyperlink{lsredis_8c_a232f994f0d91ba8157cbcfe429fc90de}{lsredis\_preset\_list} = pl;

    snprintf( pl->\hyperlink{structlsredis__preset__list__struct_ab3a50b52cf845fa70667d8be9ea7d73b}{key}, key\_length, \textcolor{stringliteral}{"%s%s"}, motor\_name, preset\_name);

    entry\_in.key  = pl->\hyperlink{structlsredis__preset__list__struct_ab3a50b52cf845fa70667d8be9ea7d73b}{key};
    entry\_in.data = pl;
    hsearch\_r( entry\_in, ENTER, &entry\_outp, &\hyperlink{lsredis_8c_ade00a383533fdefb2af9f3f53f37cf97}{lsredis\_preset\_ht}
      );
    \textcolor{keywordflow}{if}( entry\_outp->data != pl) \{
      \textcolor{comment}{//}
      \textcolor{comment}{// The key was already there or we couldn't add it}
      \textcolor{comment}{//}
      \textcolor{keywordflow}{if}( entry\_outp->data == NULL)
        \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_load\_presets:
       could not add preset '%s' for motor '%s'"}, preset\_name, motor\_name);

      free( pl->\hyperlink{structlsredis__preset__list__struct_ab3a50b52cf845fa70667d8be9ea7d73b}{key});
      free( pl);
    \} \textcolor{keywordflow}{else} \{
      \textcolor{comment}{//}
      \textcolor{comment}{// We've successfully added the new key}
      \textcolor{comment}{//}
      \hyperlink{lsredis_8c_adace74d8fa7d2dd58854fa09e66da807}{lsredis\_preset\_n}++;
      \textcolor{comment}{//}
      \textcolor{comment}{// Resize the hash table if we are starting to fill it up}
      \textcolor{comment}{// Generally we prefer a sparse table}
      \textcolor{comment}{//}
      \textcolor{keywordflow}{if}( \hyperlink{lsredis_8c_adace74d8fa7d2dd58854fa09e66da807}{lsredis\_preset\_n} >= \hyperlink{lsredis_8c_ace88a236f88278adaac5419a7281c490}{lsredis\_preset\_max\_n}
      ) \{
        \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_load\_presets:
       increasing preset hash table size.  max now %d"}, \hyperlink{lsredis_8c_ace88a236f88278adaac5419a7281c490}{lsredis\_preset\_max\_n}
      );
        hdestroy\_r( &\hyperlink{lsredis_8c_ade00a383533fdefb2af9f3f53f37cf97}{lsredis\_preset\_ht});
        \hyperlink{lsredis_8c_ace88a236f88278adaac5419a7281c490}{lsredis\_preset\_max\_n} *= 2;
        hcreate\_r( 2 * \hyperlink{lsredis_8c_ace88a236f88278adaac5419a7281c490}{lsredis\_preset\_max\_n}, &
      \hyperlink{lsredis_8c_ade00a383533fdefb2af9f3f53f37cf97}{lsredis\_preset\_ht});
        \textcolor{keywordflow}{for}( pl = \hyperlink{lsredis_8c_a232f994f0d91ba8157cbcfe429fc90de}{lsredis\_preset\_list}; pl != NULL; pl = pl->
      \hyperlink{structlsredis__preset__list__struct_a14422c8bfa270e5620c66be871091f67}{next}) \{
          entry\_in.key  = pl->\hyperlink{structlsredis__preset__list__struct_ab3a50b52cf845fa70667d8be9ea7d73b}{key};
          entry\_in.data = pl;
          hsearch\_r( entry\_in, ENTER, &entry\_outp, &\hyperlink{lsredis_8c_ade00a383533fdefb2af9f3f53f37cf97}{lsredis\_preset\_ht}
      );
        \}
        \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_load\_presets: done
       increasing preset hash table size."}, \hyperlink{lsredis_8c_ace88a236f88278adaac5419a7281c490}{lsredis\_preset\_max\_n});
      \}
    \}
    free( preset\_name);
  \}
  pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_a1d0b14b31b12d1b2a79dc50eac09de39}{lsredis\_preset\_list\_mutex});
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a065d09eb6914c057383980d3d786affc}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-log@{lsredis\-\_\-log}}
\index{lsredis\-\_\-log@{lsredis\-\_\-log}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-log}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-log (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{fmt, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a065d09eb6914c057383980d3d786affc}


send log message to our redis log key 



Definition at line 1064 of file lsredis.\-c.


\begin{DoxyCode}
                                  \{
  \textcolor{keyword}{static} \hyperlink{structlsredis__obj__struct}{lsredis\_obj\_t} *loghashs[32];
  \textcolor{keyword}{static} \textcolor{keywordtype}{int} firstTime = 1;
  \textcolor{keyword}{static} \textcolor{keywordtype}{int} lhi = 0;
  \textcolor{keywordtype}{char} msg[2048+64];
  va\_list arg\_ptr;
  
  
  
  \textcolor{keywordflow}{if}( pthread\_mutex\_trylock( &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex}) == 0) \{
    
    
    \textcolor{keywordflow}{if}( \hyperlink{lsredis_8c_acdca9095c7a3288d7febe9f4c440a6e9}{lsredis\_head} == NULL) \{                     \textcolor{comment}{// Ignore
       messages that come before redis is initiallized}
      pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex});
      \textcolor{keywordflow}{return};
    \}
    
    \textcolor{keywordflow}{if}( firstTime) \{
      \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};
      \textcolor{keywordflow}{for}( i=0; i<\textcolor{keyword}{sizeof}(loghashs)/\textcolor{keyword}{sizeof}(loghashs[0]); i++) \{
        loghashs[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}] = \hyperlink{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{lsredis\_get\_obj}( \textcolor{stringliteral}{"log.message.%d"}, i);
      \}
      lhi = 0;
      firstTime=0;
    \}
    
    va\_start( arg\_ptr, fmt);
    vsnprintf( msg, \textcolor{keyword}{sizeof}(msg)-1, fmt, arg\_ptr);
    va\_end( arg\_ptr);
    msg[\textcolor{keyword}{sizeof}(msg)-1]=0;
    
    \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\_setstr}( loghashs[lhi], \textcolor{stringliteral}{"%s"}, msg);
    lhi = (lhi+1) % (\textcolor{keyword}{sizeof}(loghashs)/\textcolor{keyword}{sizeof}(loghashs[0]));
    pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex});
    
  \}
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_ad3189a7329ca92efab0054921f608b97}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-maybe\-\_\-add\-\_\-key@{lsredis\-\_\-maybe\-\_\-add\-\_\-key}}
\index{lsredis\-\_\-maybe\-\_\-add\-\_\-key@{lsredis\-\_\-maybe\-\_\-add\-\_\-key}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-maybe\-\_\-add\-\_\-key}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-maybe\-\_\-add\-\_\-key (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{k}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_ad3189a7329ca92efab0054921f608b97}


Definition at line 833 of file lsredis.\-c.


\begin{DoxyCode}
                                     \{
  \textcolor{keywordflow}{if}( regexec( &\hyperlink{lsredis_8c_abee04898347f9b2551fa0435b1cc597e}{lsredis\_key\_select\_regex}, k, 0, NULL, 0
      ) == 0) \{
    \hyperlink{lsredis_8c_ac3fb8589e280bfa18ecbca6619fea637}{\_lsredis\_get\_obj}( k);
  \}
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_ac58fca47533e695c8775e0d2b9128766}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-regexec@{lsredis\-\_\-regexec}}
\index{lsredis\-\_\-regexec@{lsredis\-\_\-regexec}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-regexec}]{\setlength{\rightskip}{0pt plus 5cm}int lsredis\-\_\-regexec (
\begin{DoxyParamCaption}
\item[{const regex\-\_\-t $\ast$}]{preg, }
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p, }
\item[{size\-\_\-t}]{nmatch, }
\item[{regmatch\-\_\-t $\ast$}]{pmatch, }
\item[{int}]{eflags}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_ac58fca47533e695c8775e0d2b9128766}


Definition at line 265 of file lsredis.\-c.


\begin{DoxyCode}
                                                                               
                                  \{
  \textcolor{keywordtype}{int} rtn;

  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{while}( p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} == 0) 
    pthread\_cond\_wait( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

  rtn = regexec( preg, p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value}, nmatch, pmatch, eflags);

  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_ac3db3d5f91bf5723bd94748ce0d88731}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-run@{lsredis\-\_\-run}}
\index{lsredis\-\_\-run@{lsredis\-\_\-run}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-run}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-t$\ast$ lsredis\-\_\-run (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_ac3db3d5f91bf5723bd94748ce0d88731}


Definition at line 1440 of file lsredis.\-c.


\begin{DoxyCode}
                         \{
  pthread\_create( &\hyperlink{lsredis_8c_a79c33eb11ad6819247930ade3a25671f}{lsredis\_thread}, NULL, \hyperlink{lsredis_8c_ade7b1ddfdc88c6964a4c90513e360f75}{lsredis\_worker}
      , NULL);
  \textcolor{keywordflow}{return} &\hyperlink{lsredis_8c_a79c33eb11ad6819247930ade3a25671f}{lsredis\_thread};
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a2b48f29f489bcbdaf4fb29e7fbf1d4d2}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-set\-\_\-preset@{lsredis\-\_\-set\-\_\-preset}}
\index{lsredis\-\_\-set\-\_\-preset@{lsredis\-\_\-set\-\_\-preset}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-set\-\_\-preset}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-set\-\_\-preset (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{motor\-\_\-name, }
\item[{char $\ast$}]{preset\-\_\-name, }
\item[{double}]{dval}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a2b48f29f489bcbdaf4fb29e7fbf1d4d2}


set the given preset to the given value create a new preset if we can't find it 



Definition at line 974 of file lsredis.\-c.


\begin{DoxyCode}
                                                                           \{
  \textcolor{keywordtype}{char} s[512];
  \textcolor{keywordtype}{int} plength;
  \textcolor{keywordtype}{int} err;
  ENTRY entry\_in, *entry\_outp;
  \hyperlink{structlsredis__obj__struct}{lsredis\_obj\_t} *p1, *p2, *presets\_length\_p;
  \hyperlink{structlsredis__preset__list__struct}{lsredis\_preset\_list\_t} *pl;
  \textcolor{keyword}{struct }timespec timeout;

  snprintf( s, \textcolor{keyword}{sizeof}( s)-1, \textcolor{stringliteral}{"%s%s"}, motor\_name, preset\_name);
  s[\textcolor{keyword}{sizeof}(s)-1] = 0;

  entry\_in.key  = s;
  entry\_in.data = NULL;
  pthread\_mutex\_lock( &\hyperlink{lsredis_8c_a1d0b14b31b12d1b2a79dc50eac09de39}{lsredis\_preset\_list\_mutex});
  err = hsearch\_r( entry\_in, FIND, &entry\_outp, &\hyperlink{lsredis_8c_ade00a383533fdefb2af9f3f53f37cf97}{lsredis\_preset\_ht}
      );
  \textcolor{keywordflow}{if}( err != 0) \{
    \textcolor{comment}{//}
    \textcolor{comment}{// Found it.  Things are simple.}
    \textcolor{comment}{//}
    pthread\_mutex\_unlock( &p1->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});


    pl = entry\_outp->data;
    \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\_setstr}( pl->\hyperlink{structlsredis__preset__list__struct_ae365a576448adeccb66fbb85cfcf4b23}{position}, \textcolor{stringliteral}{"%.3f"}, dval);
    pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_a1d0b14b31b12d1b2a79dc50eac09de39}{lsredis\_preset\_list\_mutex});
    \textcolor{keywordflow}{return};
  \}
  \textcolor{comment}{//}
  \textcolor{comment}{// OK, our preset was not found, add it}
  \textcolor{comment}{//}
  presets\_length\_p = \hyperlink{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{lsredis\_get\_obj}(  \textcolor{stringliteral}{"%s.presets.length"}, 
      motor\_name);
  plength = \hyperlink{lsredis_8c_a71689006ffc015be6a0705a7c0aef1be}{lsredis\_get\_or\_set\_l}( presets\_length\_p, 0);
  plength += 1;

  snprintf( s, \textcolor{keyword}{sizeof}( s)-1, \textcolor{stringliteral}{"%s.%s.presets.%d.name"}, \hyperlink{lsredis_8c_acdca9095c7a3288d7febe9f4c440a6e9}{lsredis\_head},
       motor\_name, plength-1);
  s[\textcolor{keyword}{sizeof}(s)-1] = 0;

  p1 = \hyperlink{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{lsredis\_get\_obj}( \textcolor{stringliteral}{"%s.presets.%d.name"}, motor\_name, 
      plength-1);
  pthread\_mutex\_lock( &p1->mutex);
  err = 0;
  \textcolor{keywordflow}{while}( err == 0 && p1->valid == 0)
    err = pthread\_cond\_timedwait( &p1->cond, &p1->mutex, &timeout);

  \textcolor{keywordflow}{if}( err == ETIMEDOUT) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_set\_preset: timed out
       waiting for name to become valid"});
  \}
  pthread\_mutex\_unlock( &p1->mutex);
  \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\_setstr}( p1, \textcolor{stringliteral}{"%s"}, preset\_name);
  
  p2 = \hyperlink{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{lsredis\_get\_obj}( \textcolor{stringliteral}{"%s.presets.%d.position"}, motor\_name, 
      plength-1);
  \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\_setstr}( p2, \textcolor{stringliteral}{"%.3f"}, dval);
  
  \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\_setstr}( presets\_length\_p, \textcolor{stringliteral}{"%ld"}, plength);

  pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_a1d0b14b31b12d1b2a79dc50eac09de39}{lsredis\_preset\_list\_mutex});
  \hyperlink{lsredis_8c_af48b297b5679750a131fa1e982a078b7}{lsredis\_load\_presets}( motor\_name);
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_ac3c27bda1c9b10e6db14665951746da8}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-set\-\_\-value@{lsredis\-\_\-set\-\_\-value}}
\index{lsredis\-\_\-set\-\_\-value@{lsredis\-\_\-set\-\_\-value}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-set\-\_\-value}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-set\-\_\-value (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p, }
\item[{char $\ast$}]{fmt, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_ac3c27bda1c9b10e6db14665951746da8}


Set the value of a redis object and make it valid. 

Called by mget\-C\-B to set the value as it is in redis Maybe T\-O\-D\-O\-: we've arbitrarily set the maximum size of a value here. Although I cannot imagine needed bigger values it would not be a big deal to enable it. 

Definition at line 225 of file lsredis.\-c.


\begin{DoxyCode}
                                                          \{
  va\_list arg\_ptr;
  \textcolor{keywordtype}{char} \hyperlink{namespacemk__pgpmac__redis_ac732d49b0afca9a9951e3a252bae42fc}{v}[512];
  
  va\_start( arg\_ptr, fmt);
  vsnprintf( v, \textcolor{keyword}{sizeof}(v)-1, fmt, arg\_ptr);
  va\_end( arg\_ptr);

  v[\textcolor{keyword}{sizeof}(\hyperlink{namespacemk__pgpmac__redis_ac732d49b0afca9a9951e3a252bae42fc}{v})-1] = 0;

  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

  \hyperlink{lsredis_8c_a05c7ed2bb1b5702a5c83ed3b51abb546}{\_lsredis\_set\_value}( p, v);

  pthread\_cond\_signal( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond});
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-setstr@{lsredis\-\_\-setstr}}
\index{lsredis\-\_\-setstr@{lsredis\-\_\-setstr}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-setstr}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-setstr (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p, }
\item[{char $\ast$}]{fmt, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}


Set the value and update redis. 

Note that lsredis\-\_\-set\-\_\-value sets the value based on redis while here we set redis based on the value Arbitray maximum string length set here. T\-O\-D\-O\-: Probably this limit should be removed at some point.

redis\-Async\-Command\-Argv used instead of redis\-Async\-Command 'cause it's easier (and possible) to deal with strings that would otherwise cause hiredis to emit a bad command, like those containing spaces. $<$ up the count of times we need to see ourselves published before we start listening to others again

$<$ Unlock to prevent deadlock in case the service routine needs to set our value

$<$ redis\-Async\-Command\-Argv shouldn't need to access this after it's made up it's packet (before it returns) so we should be O\-K with this location disappearing soon.

$<$ At this point the key is considered created 

Definition at line 307 of file lsredis.\-c.


\begin{DoxyCode}
                                                       \{
  va\_list arg\_ptr;
  \textcolor{keywordtype}{char} \hyperlink{namespacemk__pgpmac__redis_ac732d49b0afca9a9951e3a252bae42fc}{v}[512];
  \textcolor{keywordtype}{char} *argv[4];

  va\_start( arg\_ptr, fmt);
  vsnprintf( v, \textcolor{keyword}{sizeof}(v)-1, fmt, arg\_ptr);
  v[\textcolor{keyword}{sizeof}(\hyperlink{namespacemk__pgpmac__redis_ac732d49b0afca9a9951e3a252bae42fc}{v})-1] = 0;
  va\_end( arg\_ptr);
  
  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

  \textcolor{comment}{//}
  \textcolor{comment}{// Don't send an update if a good value has not changed}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( p->\hyperlink{structlsredis__obj__struct_ae0aa00ad745ee5bbc598c23ab794ed8a}{creating} == 0 && p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} && strcmp( v, p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value}) ==
       0) \{
    \textcolor{comment}{// nothing to do}
    pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
    \textcolor{keywordflow}{return};
  \}

  p->\hyperlink{structlsredis__obj__struct_a8bc1a536b7155a1e2a749c7c434b898b}{wait\_for\_me}++;                  
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});        


  argv[0] = \textcolor{stringliteral}{"HSET"};
  argv[1] = p->\hyperlink{structlsredis__obj__struct_aa8c5a453b9424e5666320b8675a42f5c}{key};
  argv[2] = \textcolor{stringliteral}{"VALUE"};
  argv[3] = \hyperlink{namespacemk__pgpmac__redis_ac732d49b0afca9a9951e3a252bae42fc}{v};         


  pthread\_mutex\_lock( &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex});
  \textcolor{keywordflow}{while}( \hyperlink{lsredis_8c_a7461eb2b5974a2ffac2189007d39193c}{lsredis\_running} == 0)
    pthread\_cond\_wait( &\hyperlink{lsredis_8c_a2f63408d16b5603541b124a78f36a5a8}{lsredis\_cond}, &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex});

  redisAsyncCommand( \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}, NULL, NULL, \textcolor{stringliteral}{"MULTI"});
  redisAsyncCommandArgv( \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}, NULL, NULL, 4, (\textcolor{keyword}{const} \textcolor{keywordtype}{char} **)argv, NULL);

  redisAsyncCommand( \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}, NULL, NULL, \textcolor{stringliteral}{"PUBLISH %s %s"}, \hyperlink{lsredis_8c_a0c81dce2e75584eeb14ab7d9dd86c72e}{lsredis\_publisher}
      , p->\hyperlink{structlsredis__obj__struct_aa8c5a453b9424e5666320b8675a42f5c}{key});
  redisAsyncCommand( \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}, NULL, NULL, \textcolor{stringliteral}{"EXEC"});
  pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex});

  \textcolor{comment}{// Assume redis will take exactly the value we sent it}
  \textcolor{comment}{//}
  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \hyperlink{lsredis_8c_a05c7ed2bb1b5702a5c83ed3b51abb546}{\_lsredis\_set\_value}( p, v);
  p->\hyperlink{structlsredis__obj__struct_ae0aa00ad745ee5bbc598c23ab794ed8a}{creating} = 0;                      
  pthread\_cond\_signal( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond});
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_aa060eb807fbecb6e6430d2cbae2c9673}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-sig\-\_\-service@{lsredis\-\_\-sig\-\_\-service}}
\index{lsredis\-\_\-sig\-\_\-service@{lsredis\-\_\-sig\-\_\-service}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-sig\-\_\-service}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-sig\-\_\-service (
\begin{DoxyParamCaption}
\item[{struct pollfd $\ast$}]{evt}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_aa060eb807fbecb6e6430d2cbae2c9673}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em evt} & The pollfd object that triggered this call \\
\hline
\end{DoxyParams}


Definition at line 1317 of file lsredis.\-c.


\begin{DoxyCode}
                        \{
  \textcolor{keyword}{struct }signalfd\_siginfo fdsi;

  \textcolor{comment}{//}
  \textcolor{comment}{// Really, we don't care about the signal,}
  \textcolor{comment}{// it's just used to drop out of the poll}
  \textcolor{comment}{// function when there is something for us}
  \textcolor{comment}{// to do.}
  \textcolor{comment}{//}


  read( evt->fd, &fdsi, \textcolor{keyword}{sizeof}( \textcolor{keyword}{struct} signalfd\_siginfo));

\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a84611531459bf3d92c45b86308b4a300}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-sub\-C\-B@{lsredis\-\_\-sub\-C\-B}}
\index{lsredis\-\_\-sub\-C\-B@{lsredis\-\_\-sub\-C\-B}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-sub\-C\-B}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-sub\-C\-B (
\begin{DoxyParamCaption}
\item[{redis\-Async\-Context $\ast$}]{ac, }
\item[{void $\ast$}]{reply, }
\item[{void $\ast$}]{privdata}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a84611531459bf3d92c45b86308b4a300}


Use the publication to request the new value. 



Definition at line 741 of file lsredis.\-c.


\begin{DoxyCode}
                                                                        \{
  redisReply *r;
  \hyperlink{structlsredis__obj__struct}{lsredis\_obj\_t} *\hyperlink{namespacemk__pgpmac__redis_a11daf2847f2dc94562b5b61b3f412574}{p};
  \textcolor{keywordtype}{char} *k;
  \textcolor{keywordtype}{char} *publisher;
  ENTRY htab\_input, *htab\_output;
  \textcolor{keywordtype}{int} err;

  r = (redisReply *)reply;

  \textcolor{comment}{// Ignore our psubscribe reply}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( r->type == REDIS\_REPLY\_ARRAY && r->elements == 3 && r->element[0]->type 
      == REDIS\_REPLY\_STRING && strcmp( r->element[0]->str, \textcolor{stringliteral}{"psubscribe"})==0)
    \textcolor{keywordflow}{return};

  \textcolor{comment}{// But log other stuff we don't understand}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( r->type != REDIS\_REPLY\_ARRAY ||
      r->elements != 4 ||
      r->element[3]->type != REDIS\_REPLY\_STRING ||
      r->element[2]->type != REDIS\_REPLY\_STRING) \{

    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_subCB: unexpected
       reply"});
    \hyperlink{lsredis_8c_a8268fd06bda0e2c327b057a880b97b59}{lsredis\_debugCB}( ac, reply, privdata);
    \textcolor{keywordflow}{return};
  \}

  \textcolor{comment}{//}
  \textcolor{comment}{// Ignore obvious junk}
  \textcolor{comment}{//}
  k = r->element[3]->str;

  \textcolor{keywordflow}{if}( k == NULL || *k == 0)
    \textcolor{keywordflow}{return};
  
  \textcolor{comment}{//}
  \textcolor{comment}{// see if we care}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( regexec( &\hyperlink{lsredis_8c_abee04898347f9b2551fa0435b1cc597e}{lsredis\_key\_select\_regex}, k, 0, NULL, 0
      ) == 0) \{
    \textcolor{comment}{//}
    \textcolor{comment}{// We should know about this one}
    \textcolor{comment}{//}
    
    htab\_input.key  = k;
    htab\_input.data = NULL;

    errno = 0;
    err = hsearch\_r( htab\_input, FIND, &htab\_output, &\hyperlink{lsredis_8c_a42aec6aa74072797ec0344847b0e9e39}{lsredis\_htab})
      ;
    \textcolor{keywordflow}{if}( err == 0 && errno == ESRCH)
      p = NULL;
    \textcolor{keywordflow}{else}
      p = htab\_output->data;
      

    \textcolor{keywordflow}{if}( p == NULL) \{
      \hyperlink{lsredis_8c_ac3fb8589e280bfa18ecbca6619fea637}{\_lsredis\_get\_obj}( k);
    \} \textcolor{keywordflow}{else} \{
      \textcolor{comment}{// Look who's talk'n}
      publisher = r->element[2]->str;

      pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
      \textcolor{keywordflow}{if}( p->\hyperlink{structlsredis__obj__struct_a8bc1a536b7155a1e2a749c7c434b898b}{wait\_for\_me}) \{
        \textcolor{comment}{//}
        \textcolor{comment}{// see if we are done waiting}
        \textcolor{comment}{//}
        \textcolor{keywordflow}{if}( strcmp( publisher, \hyperlink{lsredis_8c_a0c81dce2e75584eeb14ab7d9dd86c72e}{lsredis\_publisher})==0)
          p->\hyperlink{structlsredis__obj__struct_a8bc1a536b7155a1e2a749c7c434b898b}{wait\_for\_me}--;

        pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
        \textcolor{comment}{//}
        \textcolor{comment}{// Don't get a new value, either we set it last or we are still waiting
       for redis to report}
        \textcolor{comment}{// our publication}
        \textcolor{comment}{//}
        \textcolor{keywordflow}{return};
      \}

      \textcolor{comment}{// Here we know our value is out of date}
      \textcolor{comment}{//}
      p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} = 0;
      \textcolor{comment}{//lsevents\_send\_event( "%s Invalid", p->events\_name);}
      pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

      \textcolor{comment}{//}
      \textcolor{comment}{// We shouldn't get here if wait\_for\_me is zero and we are the publisher.}
      \textcolor{comment}{// If somehow we did (ie we did an hset with out incrementing wait\_for\_me
       or if we published too many times), it shouldn't hurt to get the value again.}
      \textcolor{comment}{//}
      redisAsyncCommand( \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}, \hyperlink{lsredis_8c_a8d9719b362d1b38275d734971b7988af}{lsredis\_hgetCB}, p, \textcolor{stringliteral}{"HGET %s
       VALUE"}, k);
    \}
  \}
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_ade7b1ddfdc88c6964a4c90513e360f75}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-worker@{lsredis\-\_\-worker}}
\index{lsredis\-\_\-worker@{lsredis\-\_\-worker}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-worker}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ lsredis\-\_\-worker (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{dummy}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_ade7b1ddfdc88c6964a4c90513e360f75}


subscribe to changes and service sockets 

$<$ poll timeout, in millisecs (of course)

$<$ array of pollfd's for the poll function, one entry per connection

$<$ number of active elements in fda 

Definition at line 1360 of file lsredis.\-c.


\begin{DoxyCode}
                                    \{
  \textcolor{keyword}{static} \textcolor{keywordtype}{int} poll\_timeout\_ms = -1;      
  \textcolor{keyword}{static} \textcolor{keyword}{struct }pollfd fda[4];          
  \textcolor{keyword}{static} \textcolor{keywordtype}{int} nfda = 0;                  
  \textcolor{keyword}{static} sigset\_t \hyperlink{pgpmac_8c_a76042459b23ade6d59ce9698d890ea89}{our\_sigset};
  \textcolor{keywordtype}{int} pollrtn;
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};


  pthread\_mutex\_lock( &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex});
  \textcolor{comment}{//}
  \textcolor{comment}{// block ordinary signal mechanism}
  \textcolor{comment}{//}
  sigemptyset( &our\_sigset);
  sigaddset( &our\_sigset, SIGUSR1);
  pthread\_sigmask( SIG\_BLOCK, &our\_sigset, NULL);

  \textcolor{comment}{// Set up fd mechanism}
  \textcolor{comment}{//}
  fda[0].fd = signalfd( -1, &our\_sigset, SFD\_NONBLOCK);
  \textcolor{keywordflow}{if}( fda[0].fd == -1) \{
    \textcolor{keywordtype}{char} *es;

    es = strerror( errno);
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_worker: Signalfd
       trouble '%s'"}, es);
  \}
  fda[0].events = POLLIN;
  nfda = 1;

  \hyperlink{lsredis_8c_a7461eb2b5974a2ffac2189007d39193c}{lsredis\_running} = 1;

  pthread\_cond\_signal( &\hyperlink{lsredis_8c_a2f63408d16b5603541b124a78f36a5a8}{lsredis\_cond});
  pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex});

  \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^Heartbeat$"}, 
      \hyperlink{lsredis_8c_acd9cb833103e57da756d152ecdd4f840}{lsredis\_heartbeat\_cb});
  \hyperlink{lstimer_8c_a7b3e725fbe1bb3cc9f8465941cf1e381}{lstimer\_set\_timer}( \textcolor{stringliteral}{"Heartbeat"}, -1, 1, 0);


  \textcolor{keywordflow}{while}(1) \{
    nfda = 1;

    pthread\_mutex\_lock( &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex});
    \textcolor{keywordflow}{if}( \hyperlink{lsredis_8c_a0cd3bdc79d035eb1595371c845d14367}{subfd}.fd != -1) \{
      fda[nfda].fd      = \hyperlink{lsredis_8c_a0cd3bdc79d035eb1595371c845d14367}{subfd}.fd;
      fda[nfda].events  = \hyperlink{lsredis_8c_a0cd3bdc79d035eb1595371c845d14367}{subfd}.events;
      fda[nfda].revents = 0;
      nfda++;
    \}

    \textcolor{keywordflow}{if}( \hyperlink{lsredis_8c_add819e43a356d0575ec64c346c6fed57}{rofd}.fd != -1) \{
      fda[nfda].fd      = \hyperlink{lsredis_8c_add819e43a356d0575ec64c346c6fed57}{rofd}.fd;
      fda[nfda].events  = \hyperlink{lsredis_8c_add819e43a356d0575ec64c346c6fed57}{rofd}.events;
      fda[nfda].revents = 0; 
     nfda++;
    \}

    \textcolor{keywordflow}{if}( \hyperlink{lsredis_8c_a13acbee14dbe8cdb98e238abb921d048}{wrfd}.fd != -1) \{
      fda[nfda].fd      = \hyperlink{lsredis_8c_a13acbee14dbe8cdb98e238abb921d048}{wrfd}.fd;
      fda[nfda].events  = \hyperlink{lsredis_8c_a13acbee14dbe8cdb98e238abb921d048}{wrfd}.events;
      fda[nfda].revents = 0;
      nfda++;
    \}
    pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex});

    pollrtn = poll( fda, nfda, poll\_timeout\_ms);

    \textcolor{keywordflow}{if}( pollrtn && fda[0].revents) \{
      \hyperlink{lsredis_8c_aa060eb807fbecb6e6430d2cbae2c9673}{lsredis\_sig\_service}( &(fda[0]));
      pollrtn--;
    \} 

    \textcolor{keywordflow}{for}( i=1; i<nfda; i++) \{
      \textcolor{keywordflow}{if}( fda[i].revents) \{
        \hyperlink{lsredis_8c_ae1478efc852fef71550e0f58d602fa2b}{lsredis\_fd\_service}( &(fda[i]));
      \}
    \}
  \}
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_aa1941e6515a254f76cfd1f18d3c8fac3}{\index{lsredis.\-c@{lsredis.\-c}!redis\-Disconnect\-C\-B@{redis\-Disconnect\-C\-B}}
\index{redis\-Disconnect\-C\-B@{redis\-Disconnect\-C\-B}!lsredis.c@{lsredis.\-c}}
\subsubsection[{redis\-Disconnect\-C\-B}]{\setlength{\rightskip}{0pt plus 5cm}void redis\-Disconnect\-C\-B (
\begin{DoxyParamCaption}
\item[{const redis\-Async\-Context $\ast$}]{ac, }
\item[{int}]{status}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_aa1941e6515a254f76cfd1f18d3c8fac3}


call back in case a redis server becomes disconnected T\-O\-D\-O\-: reconnect 



Definition at line 666 of file lsredis.\-c.


\begin{DoxyCode}
                                                                \{
  \textcolor{keywordflow}{if}( status != REDIS\_OK) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis: Disconnected with
       status %d"}, status);
  \}
\}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{lsredis_8c_a2f63408d16b5603541b124a78f36a5a8}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-cond@{lsredis\-\_\-cond}}
\index{lsredis\-\_\-cond@{lsredis\-\_\-cond}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-cond}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-cond\-\_\-t lsredis\-\_\-cond}}\label{lsredis_8c_a2f63408d16b5603541b124a78f36a5a8}


Definition at line 75 of file lsredis.\-c.

\hypertarget{lsredis_8c_a6fa076f1004c85a8a1dc400f45547f32}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-config\-\_\-cond@{lsredis\-\_\-config\-\_\-cond}}
\index{lsredis\-\_\-config\-\_\-cond@{lsredis\-\_\-config\-\_\-cond}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-config\-\_\-cond}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-cond\-\_\-t lsredis\-\_\-config\-\_\-cond\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_a6fa076f1004c85a8a1dc400f45547f32}


Definition at line 91 of file lsredis.\-c.

\hypertarget{lsredis_8c_a0c5cbd80d59d69603f123621cc6ddc30}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-config\-\_\-mutex@{lsredis\-\_\-config\-\_\-mutex}}
\index{lsredis\-\_\-config\-\_\-mutex@{lsredis\-\_\-config\-\_\-mutex}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-config\-\_\-mutex}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-mutex\-\_\-t lsredis\-\_\-config\-\_\-mutex\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_a0c5cbd80d59d69603f123621cc6ddc30}


Definition at line 90 of file lsredis.\-c.

\hypertarget{lsredis_8c_acdca9095c7a3288d7febe9f4c440a6e9}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-head@{lsredis\-\_\-head}}
\index{lsredis\-\_\-head@{lsredis\-\_\-head}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-head}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ lsredis\-\_\-head = N\-U\-L\-L\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_acdca9095c7a3288d7febe9f4c440a6e9}


Definition at line 89 of file lsredis.\-c.

\hypertarget{lsredis_8c_a42aec6aa74072797ec0344847b0e9e39}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-htab@{lsredis\-\_\-htab}}
\index{lsredis\-\_\-htab@{lsredis\-\_\-htab}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-htab}]{\setlength{\rightskip}{0pt plus 5cm}struct hsearch\-\_\-data lsredis\-\_\-htab\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_a42aec6aa74072797ec0344847b0e9e39}


Definition at line 81 of file lsredis.\-c.

\hypertarget{lsredis_8c_abee04898347f9b2551fa0435b1cc597e}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-key\-\_\-select\-\_\-regex@{lsredis\-\_\-key\-\_\-select\-\_\-regex}}
\index{lsredis\-\_\-key\-\_\-select\-\_\-regex@{lsredis\-\_\-key\-\_\-select\-\_\-regex}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-key\-\_\-select\-\_\-regex}]{\setlength{\rightskip}{0pt plus 5cm}regex\-\_\-t lsredis\-\_\-key\-\_\-select\-\_\-regex\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_abee04898347f9b2551fa0435b1cc597e}


Definition at line 88 of file lsredis.\-c.

\hypertarget{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-mutex@{lsredis\-\_\-mutex}}
\index{lsredis\-\_\-mutex@{lsredis\-\_\-mutex}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-mutex}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-mutex\-\_\-t lsredis\-\_\-mutex}}\label{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}


Definition at line 74 of file lsredis.\-c.

\hypertarget{lsredis_8c_a3d206e1c119f1408a7cf1078139f8189}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-objs@{lsredis\-\_\-objs}}
\index{lsredis\-\_\-objs@{lsredis\-\_\-objs}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-objs}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lsredis\-\_\-obj\-\_\-t}$\ast$ lsredis\-\_\-objs = N\-U\-L\-L\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_a3d206e1c119f1408a7cf1078139f8189}


Definition at line 80 of file lsredis.\-c.

\hypertarget{lsredis_8c_ade00a383533fdefb2af9f3f53f37cf97}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-preset\-\_\-ht@{lsredis\-\_\-preset\-\_\-ht}}
\index{lsredis\-\_\-preset\-\_\-ht@{lsredis\-\_\-preset\-\_\-ht}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-preset\-\_\-ht}]{\setlength{\rightskip}{0pt plus 5cm}struct hsearch\-\_\-data lsredis\-\_\-preset\-\_\-ht\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_ade00a383533fdefb2af9f3f53f37cf97}


Definition at line 106 of file lsredis.\-c.

\hypertarget{lsredis_8c_a232f994f0d91ba8157cbcfe429fc90de}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-preset\-\_\-list@{lsredis\-\_\-preset\-\_\-list}}
\index{lsredis\-\_\-preset\-\_\-list@{lsredis\-\_\-preset\-\_\-list}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-preset\-\_\-list}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lsredis\-\_\-preset\-\_\-list\-\_\-t}$\ast$ lsredis\-\_\-preset\-\_\-list = N\-U\-L\-L\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_a232f994f0d91ba8157cbcfe429fc90de}


Definition at line 105 of file lsredis.\-c.

\hypertarget{lsredis_8c_a1d0b14b31b12d1b2a79dc50eac09de39}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-preset\-\_\-list\-\_\-mutex@{lsredis\-\_\-preset\-\_\-list\-\_\-mutex}}
\index{lsredis\-\_\-preset\-\_\-list\-\_\-mutex@{lsredis\-\_\-preset\-\_\-list\-\_\-mutex}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-preset\-\_\-list\-\_\-mutex}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-mutex\-\_\-t lsredis\-\_\-preset\-\_\-list\-\_\-mutex\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_a1d0b14b31b12d1b2a79dc50eac09de39}


Definition at line 109 of file lsredis.\-c.

\hypertarget{lsredis_8c_ace88a236f88278adaac5419a7281c490}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-preset\-\_\-max\-\_\-n@{lsredis\-\_\-preset\-\_\-max\-\_\-n}}
\index{lsredis\-\_\-preset\-\_\-max\-\_\-n@{lsredis\-\_\-preset\-\_\-max\-\_\-n}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-preset\-\_\-max\-\_\-n}]{\setlength{\rightskip}{0pt plus 5cm}int lsredis\-\_\-preset\-\_\-max\-\_\-n = 1024\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_ace88a236f88278adaac5419a7281c490}


Definition at line 108 of file lsredis.\-c.

\hypertarget{lsredis_8c_adace74d8fa7d2dd58854fa09e66da807}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-preset\-\_\-n@{lsredis\-\_\-preset\-\_\-n}}
\index{lsredis\-\_\-preset\-\_\-n@{lsredis\-\_\-preset\-\_\-n}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-preset\-\_\-n}]{\setlength{\rightskip}{0pt plus 5cm}int lsredis\-\_\-preset\-\_\-n = 0\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_adace74d8fa7d2dd58854fa09e66da807}


Definition at line 107 of file lsredis.\-c.

\hypertarget{lsredis_8c_a0c81dce2e75584eeb14ab7d9dd86c72e}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-publisher@{lsredis\-\_\-publisher}}
\index{lsredis\-\_\-publisher@{lsredis\-\_\-publisher}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-publisher}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ lsredis\-\_\-publisher = N\-U\-L\-L\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_a0c81dce2e75584eeb14ab7d9dd86c72e}


Definition at line 87 of file lsredis.\-c.

\hypertarget{lsredis_8c_a7461eb2b5974a2ffac2189007d39193c}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-running@{lsredis\-\_\-running}}
\index{lsredis\-\_\-running@{lsredis\-\_\-running}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-running}]{\setlength{\rightskip}{0pt plus 5cm}int lsredis\-\_\-running = 0}}\label{lsredis_8c_a7461eb2b5974a2ffac2189007d39193c}


Definition at line 76 of file lsredis.\-c.

\hypertarget{lsredis_8c_a79c33eb11ad6819247930ade3a25671f}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-thread@{lsredis\-\_\-thread}}
\index{lsredis\-\_\-thread@{lsredis\-\_\-thread}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-thread}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-t lsredis\-\_\-thread\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_a79c33eb11ad6819247930ade3a25671f}


Definition at line 72 of file lsredis.\-c.

\hypertarget{lsredis_8c_a71c9f418904364d65c22d786f4dc5d39}{\index{lsredis.\-c@{lsredis.\-c}!mutex\-\_\-initializer@{mutex\-\_\-initializer}}
\index{mutex\-\_\-initializer@{mutex\-\_\-initializer}!lsredis.c@{lsredis.\-c}}
\subsubsection[{mutex\-\_\-initializer}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-mutexattr\-\_\-t mutex\-\_\-initializer\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_a71c9f418904364d65c22d786f4dc5d39}


Definition at line 77 of file lsredis.\-c.

\hypertarget{lsredis_8c_afc92245910ec04f9a341c092def45564}{\index{lsredis.\-c@{lsredis.\-c}!roac@{roac}}
\index{roac@{roac}!lsredis.c@{lsredis.\-c}}
\subsubsection[{roac}]{\setlength{\rightskip}{0pt plus 5cm}redis\-Async\-Context$\ast$ roac\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_afc92245910ec04f9a341c092def45564}


Definition at line 84 of file lsredis.\-c.

\hypertarget{lsredis_8c_add819e43a356d0575ec64c346c6fed57}{\index{lsredis.\-c@{lsredis.\-c}!rofd@{rofd}}
\index{rofd@{rofd}!lsredis.c@{lsredis.\-c}}
\subsubsection[{rofd}]{\setlength{\rightskip}{0pt plus 5cm}struct pollfd rofd\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_add819e43a356d0575ec64c346c6fed57}


Definition at line 94 of file lsredis.\-c.

\hypertarget{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{\index{lsredis.\-c@{lsredis.\-c}!subac@{subac}}
\index{subac@{subac}!lsredis.c@{lsredis.\-c}}
\subsubsection[{subac}]{\setlength{\rightskip}{0pt plus 5cm}redis\-Async\-Context$\ast$ subac\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}


Definition at line 83 of file lsredis.\-c.

\hypertarget{lsredis_8c_a0cd3bdc79d035eb1595371c845d14367}{\index{lsredis.\-c@{lsredis.\-c}!subfd@{subfd}}
\index{subfd@{subfd}!lsredis.c@{lsredis.\-c}}
\subsubsection[{subfd}]{\setlength{\rightskip}{0pt plus 5cm}struct pollfd subfd\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_a0cd3bdc79d035eb1595371c845d14367}


Definition at line 93 of file lsredis.\-c.

\hypertarget{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{\index{lsredis.\-c@{lsredis.\-c}!wrac@{wrac}}
\index{wrac@{wrac}!lsredis.c@{lsredis.\-c}}
\subsubsection[{wrac}]{\setlength{\rightskip}{0pt plus 5cm}redis\-Async\-Context$\ast$ wrac\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}


Definition at line 85 of file lsredis.\-c.

\hypertarget{lsredis_8c_a13acbee14dbe8cdb98e238abb921d048}{\index{lsredis.\-c@{lsredis.\-c}!wrfd@{wrfd}}
\index{wrfd@{wrfd}!lsredis.c@{lsredis.\-c}}
\subsubsection[{wrfd}]{\setlength{\rightskip}{0pt plus 5cm}struct pollfd wrfd\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_a13acbee14dbe8cdb98e238abb921d048}


Definition at line 95 of file lsredis.\-c.

