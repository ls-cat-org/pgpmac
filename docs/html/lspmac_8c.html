<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>LS-CAT PGPMAC: lspmac.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>lspmac.c File Reference</h1>
<p>Routines concerned with communication with PMAC.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="pgpmac_8h_source.html">pgpmac.h</a>&quot;</code><br/>

<p><a href="lspmac_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmd2StatusStruct.html">md2StatusStruct</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The block of memory retrieved in a status request.  <a href="structmd2StatusStruct.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a7e1c68021b3dbb53ba1bac2afbd8fc20">LS_PMAC_STATE_RESET</a>&nbsp;&nbsp;&nbsp;-1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a7eb86ecf0789ab9555de1e03a4c73567">LS_PMAC_STATE_DETACHED</a>&nbsp;&nbsp;&nbsp;0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a37741af675425d61c876cc30ae6c99d0">LS_PMAC_STATE_IDLE</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a7d8f34fc599cc08c1a9d2cd62ccbb20a">LS_PMAC_STATE_SC</a>&nbsp;&nbsp;&nbsp;2</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a63356b0c18fcb186f456c12c6e927d84">LS_PMAC_STATE_WACK_NFR</a>&nbsp;&nbsp;&nbsp;3</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#adef540911028fda73e8bbf0aa6ad39e9">LS_PMAC_STATE_WACK_CC</a>&nbsp;&nbsp;&nbsp;4</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a5eba9ef09d4316e803b9d75bd3104f43">LS_PMAC_STATE_WACK</a>&nbsp;&nbsp;&nbsp;5</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a220b39710719cfe8b500d51819e8efeb">LS_PMAC_STATE_GMR</a>&nbsp;&nbsp;&nbsp;6</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#abbd709b56a71eb1fc6adc9063605d243">LS_PMAC_STATE_CR</a>&nbsp;&nbsp;&nbsp;7</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#add5325f4a84e4fe05f558880349485ea">LS_PMAC_STATE_RR</a>&nbsp;&nbsp;&nbsp;8</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a3e0a62cd9a1212419ad3615c34bdc65a">LS_PMAC_STATE_WACK_RR</a>&nbsp;&nbsp;&nbsp;9</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a5f4ff8874677aac48a4c675f2c1ca4e9">LS_PMAC_STATE_GB</a>&nbsp;&nbsp;&nbsp;10</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a27ee6c39d58604c8aa9bd6c249c4833f">LS_PMAC_STATE_WCR</a>&nbsp;&nbsp;&nbsp;11</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a591822cc92f76a39b293c2e90b322db2">LS_PMAC_STATE_WGB</a>&nbsp;&nbsp;&nbsp;12</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ac95886e84843b6b0bb6cc270e42043c4">PMACPORT</a>&nbsp;&nbsp;&nbsp;1025</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The PMAC (only) listens on this port.  <a href="#ac95886e84843b6b0bb6cc270e42043c4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#abdc45e3f7106f84f688419e2da9b3627">pmac_cmd_size</a>&nbsp;&nbsp;&nbsp;8</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">PMAC command size in bytes.  <a href="#abdc45e3f7106f84f688419e2da9b3627"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>&nbsp;&nbsp;&nbsp;0xc0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#af24ecdc10723dc8fd6320fef416ae514">VR_DOWNLOAD</a>&nbsp;&nbsp;&nbsp;0x40</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a772b2ea2ad93989ae4275c79a93525ee">VR_PMAC_SENDLINE</a>&nbsp;&nbsp;&nbsp;0xb0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#af3c7372a48fccf0458f266f4bc758a2c">VR_PMAC_GETLINE</a>&nbsp;&nbsp;&nbsp;0xb1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ac0e5588681366b52589cd321eabf12ff">VR_PMAC_FLUSH</a>&nbsp;&nbsp;&nbsp;0xb3</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#af9c53e7c5b2681a5ca1c5410a914a2dc">VR_PMAC_GETMEM</a>&nbsp;&nbsp;&nbsp;0xb4</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ab79207cc3145740f8c070a24c91b11e0">VR_PMAC_SETMEM</a>&nbsp;&nbsp;&nbsp;0xb5</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a76c1c401354826ac2ba8906578be930f">VR_PMAC_SENDCTRLCHAR</a>&nbsp;&nbsp;&nbsp;0xb6</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aaed77195148c3d9fe10c6e82fc6b2ea7">VR_PMAC_SETBIT</a>&nbsp;&nbsp;&nbsp;0xba</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a91a625425f6df7610f440231868a5cf1">VR_PMAC_SETBITS</a>&nbsp;&nbsp;&nbsp;0xbb</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a4cd95cb80b8da3962ebe9ec8afe844c8">VR_PMAC_PORT</a>&nbsp;&nbsp;&nbsp;0xbe</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aee7c46f33b9b6945c6b2b260810dc7f5">VR_PMAC_GETRESPONSE</a>&nbsp;&nbsp;&nbsp;0xbf</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aad3c7b4a9403e56c09eceadcf21252c0">VR_PMAC_READREADY</a>&nbsp;&nbsp;&nbsp;0xc2</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a8f4ce4666a23a3fb153d680bd1cb6556">VR_CTRL_RESPONSE</a>&nbsp;&nbsp;&nbsp;0xc4</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a50e444b5ceb6d62a1be43c88c55c549c">VR_PMAC_GETBUFFER</a>&nbsp;&nbsp;&nbsp;0xc5</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#af5e53c37c17cd06e42f7b0df211f96d8">VR_PMAC_WRITEBUFFER</a>&nbsp;&nbsp;&nbsp;0xc6</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ab8367c4c9247a96c6828418d87b8623b">VR_PMAC_WRITEERROR</a>&nbsp;&nbsp;&nbsp;0xc7</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a15e4dbce5615c285ec1755f01057b5fe">VR_FWDOWNLOAD</a>&nbsp;&nbsp;&nbsp;0xcb</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a34a2e0d5c1f48ba463ae5d98431d05f7">VR_IPADDRESS</a>&nbsp;&nbsp;&nbsp;0xe0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a59f5f5218e25332dbf64f216aec116e5">PMAC_MIN_CMD_TIME</a>&nbsp;&nbsp;&nbsp;20000.0</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Minimum time between commands to the pmac.  <a href="#a59f5f5218e25332dbf64f216aec116e5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a3fae557baafab24b7518dc84f5ef5a9b">PMAC_CMD_QUEUE_LENGTH</a>&nbsp;&nbsp;&nbsp;2048</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Size of the PMAC command queue.  <a href="#a3fae557baafab24b7518dc84f5ef5a9b"></a><br/></td></tr>
<tr><td colspan="2"><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structmd2StatusStruct.html">md2StatusStruct</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a3495613b8b94cadc4205f19e1254ebeb">md2_status_t</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The block of memory retrieved in a status request.  <a href="#a3495613b8b94cadc4205f19e1254ebeb"></a><br/></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a1c3786f3a38724f497afc4fe6d82d8c4">hex_dump</a> (int n, unsigned char *s)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prints a hex dump of the given data.  <a href="#a1c3786f3a38724f497afc4fe6d82d8c4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a8f9f1ad624350095075aa6b51423b02d">cleanstr</a> (char *s)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Replace  with <br/>
 in null terminated string and print result to terminal.  <a href="#a8f9f1ad624350095075aa6b51423b02d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aae020ea2478b41702ce8b7d20b2560be">lsConnect</a> (char *ipaddr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Connect to the PMAC socket.  <a href="#aae020ea2478b41702ce8b7d20b2560be"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a84a6096d9bfff2bfb1506a216756ae28">lspmac_push_queue</a> (<a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a> *cmd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Put a new command on the queue.  <a href="#a84a6096d9bfff2bfb1506a216756ae28"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a9627f30135aa7007bc4ab8dde905739a">lspmac_pop_queue</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Remove the oldest queue item.  <a href="#a9627f30135aa7007bc4ab8dde905739a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a0f60f18dfe11c1c0299909521596be8f">lspmac_pop_reply</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Remove the next command queue item that is waiting for a reply.  <a href="#a0f60f18dfe11c1c0299909521596be8f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a1e472a11df3765763c2fe92dd358bf0c">lspmac_send_command</a> (int rqType, int rq, int wValue, int wIndex, int wLength, unsigned char *data, void(*responseCB)(<a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a> *, int, unsigned char *), int no_reply)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Compose a packet and send it to the PMAC.  <a href="#a1e472a11df3765763c2fe92dd358bf0c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ac5745f25f242edf02f7b9b7c77ed6126">lspmac_SockFlush</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reset the PMAC socket from the PMAC side.  <a href="#ac5745f25f242edf02f7b9b7c77ed6126"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aaedae34bc18ac1742a232117c125d7b9">lspmac_Reset</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Clear the queue and put the PMAC into a known state.  <a href="#aaedae34bc18ac1742a232117c125d7b9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a2442c529b024e9c23c4acef8c1eb8689">lspmac_Error</a> (unsigned char *buff)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The service routing detected an error condition.  <a href="#a2442c529b024e9c23c4acef8c1eb8689"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#af3fa79868ba88f7c37f7b8f7d53149ff">lspmac_Service</a> (struct pollfd *evt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Service routine for packet coming from the PMAC.  <a href="#af3fa79868ba88f7c37f7b8f7d53149ff"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ac89b615b3ecb738c902c3c090d7c1dc3">lspmac_GetShortReplyCB</a> (<a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a> *cmd, int nreceived, unsigned char *buff)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Receive a reply that does not require multiple buffers.  <a href="#ac89b615b3ecb738c902c3c090d7c1dc3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ac23af52b8d3a8f2722d4804d5340fa6c">lspmac_SendControlReplyPrintCB</a> (<a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a> *cmd, int nreceived, unsigned char *buff)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Receive a reply to a control character Print a "printable" version of the character to the terminal Followed by a hex dump of the response.  <a href="#ac23af52b8d3a8f2722d4804d5340fa6c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aaa3323f952efd66e63ff864932da5ced">lspmac_GetmemReplyCB</a> (<a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a> *cmd, int nreceived, unsigned char *buff)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Service a reply to the getmem command.  <a href="#aaa3323f952efd66e63ff864932da5ced"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a0a56c777b1469ad8c3d29d825a71e300">lspmac_SockGetmem</a> (int offset, int nbytes)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Request a chunk of memory to be returned.  <a href="#a0a56c777b1469ad8c3d29d825a71e300"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aaa442d9bc7a3cdee39adea0724f0e18c">lspmac_SockSendline</a> (char *fmt,...)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send a one line command.  <a href="#aaa442d9bc7a3cdee39adea0724f0e18c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ac4cf3a79186859714d8a8293377526ba">lspmac_SockSendline_nr</a> (char *fmt,...)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send a command and ignore the response.  <a href="#ac4cf3a79186859714d8a8293377526ba"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a53ee9ff1a8ca316901babf8314b423de">lspmac_SockSendControlCharPrint</a> (char c)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send a control character.  <a href="#a53ee9ff1a8ca316901babf8314b423de"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a825ba2feb0108b977c34872e24a6c827">lspmac_Getmem</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Request a block of double buffer memory.  <a href="#a825ba2feb0108b977c34872e24a6c827"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a5945488310a5a8f616e6605782c7f1c9">lspmac_bio_read</a> (<a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *mp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read the state of a binary i/o motor This is the read method for the binary i/o motor class.  <a href="#a5945488310a5a8f616e6605782c7f1c9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a200bc9306d54fca566eb5e29d8e82308">lspmac_dac_read</a> (<a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *mp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read a DAC motor position.  <a href="#a200bc9306d54fca566eb5e29d8e82308"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ace8c4474ee2e91a06486e89edcb2acc1">lspmac_shutter_read</a> (<a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *mp) pthread_mutex_lock(&amp;<a class="el" href="pgpmac_8h.html#a1b78a13c654409333569815e1c109d38">lspmac_shutter_mutex</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Fast shutter read routine The shutter is mildly complicated in that we need to take into account the fact that the shutter can open and close again between status updates.  <a href="#ace8c4474ee2e91a06486e89edcb2acc1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a6c5e6e82b3c27cd2ab24d5e47100f912">if</a> (md2_status.fs_has_opened &amp;&amp;!<a class="el" href="pgpmac_8h.html#a396fbf06208de3ecbe1b0df549f1cd46">lspmac_shutter_has_opened</a> &amp;&amp;!md2_status.fs_is_open)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a92cb18ae39bf4ed55cdbb4d563c31416">if</a> (lspmac_shutter_state!=md2_status.fs_is_open)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a1b01e3cf8ebc36c00723e51e5652996d">if</a> (md2_status.fs_is_open)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a637fc023d1255f3519b2eee01913d64d">lspmac_pmacmotor_read</a> (<a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *mp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read the position and status of a normal PMAC motor.  <a href="#a637fc023d1255f3519b2eee01913d64d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ad060fd55c9e2411fd4fd4e946aff23c6">lspmac_get_status_cb</a> (<a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a> *cmd, int nreceived, unsigned char *buff)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Service routing for status upate This updates positions and status information.  <a href="#ad060fd55c9e2411fd4fd4e946aff23c6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a6dedca923b3a6904395ad02158e2e96f">lspmac_get_status</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Request a status update from the PMAC.  <a href="#a6dedca923b3a6904395ad02158e2e96f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#add86d60f9d192563fc9a357dc90f7f75">lspmac_GetAllIVarsCB</a> (<a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a> *cmd, int nreceived, unsigned char *buff)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Receive the values of all the I variables Update our Postgresql database with the results.  <a href="#add86d60f9d192563fc9a357dc90f7f75"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ac24bdffa893a9bf7c9cb084fe1417f6f">lspmac_GetAllIVars</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Request the values of all the I variables.  <a href="#ac24bdffa893a9bf7c9cb084fe1417f6f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ac585cd63a433c86843eb51b15017c3da">lspmac_GetAllMVarsCB</a> (<a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a> *cmd, int nreceived, unsigned char *buff)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Receive the values of all the M variables Update our database with the results.  <a href="#ac585cd63a433c86843eb51b15017c3da"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a983d291506dc387ba5d71a97766e8a25">lspmac_GetAllMVars</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Request the values of all the M variables.  <a href="#a983d291506dc387ba5d71a97766e8a25"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aa9bbf5ae34ce793d3d72945c64c43948">lspmac_sendcmd_nocb</a> (char *fmt,...)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send a command that does not need to deal with the reply.  <a href="#aa9bbf5ae34ce793d3d72945c64c43948"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a68886d1b658e7b1d996c07e9dbcd9c15">lspmac_next_state</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">State machine logic.  <a href="#a68886d1b658e7b1d996c07e9dbcd9c15"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#abdec5883055967b1eda043670870f55f">lspmac_worker</a> (void *dummy)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Our lspmac worker thread.  <a href="#abdec5883055967b1eda043670870f55f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a55b882be15d56a2a777f2b1f92901b7d">lspmac_lut</a> (int nlut, double *lut, double x)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Look up table support for motor positions (think x=zoom, y=light intensity) use a lookup table to find the "counts" to move the motor to the requested position The look up table is a simple one dimensional array with the x values as even indicies and the y values as odd indices.  <a href="#a55b882be15d56a2a777f2b1f92901b7d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a7d601716497857c2b5c072c1aed37b71">lspmac_movedac_queue</a> (<a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *mp, double requested_position)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Move method for dac motor objects (ie, lights).  <a href="#a7d601716497857c2b5c072c1aed37b71"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ad6ae1e37afd118f24ab1c6878da53878">lspmac_movezoom_queue</a> (<a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *mp, double requested_position)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Move method for the zoom motor.  <a href="#ad6ae1e37afd118f24ab1c6878da53878"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ab9f114bba58e685760a518bd5f115d74">lspmac_moveabs_fshut_queue</a> (<a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *mp, double requested_position)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Move method for the fast shutter.  <a href="#ab9f114bba58e685760a518bd5f115d74"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ad1167f01262cf6387e7e82a14d3e1a9d">lspmac_moveabs_bio_queue</a> (<a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *mp, double requested_position)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Move method for binary i/o motor objects.  <a href="#ad1167f01262cf6387e7e82a14d3e1a9d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aa4ea5a4c387ef167702c58eaddcb4151">lspmac_moveabs_queue</a> (<a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *mp, double requested_position)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Move method for normal stepper and servo motor objects.  <a href="#aa4ea5a4c387ef167702c58eaddcb4151"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aae2282edace621ee65c682d03b7ccc36">lspmac_moveabs_wait</a> (<a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *mp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Wait for motor to finish moving.  <a href="#aae2282edace621ee65c682d03b7ccc36"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a45becc46f46e5aea14a388d3ec1b8b13">lspmac_motor_init</a> (<a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *d, int motor_number, int wy, int wx, int *posp, int *stat1p, int *stat2p, char *wtitle, char *name, void(*moveAbs)(<a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *, double))</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize a pmac stepper or servo motor.  <a href="#a45becc46f46e5aea14a388d3ec1b8b13"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a40aa4aeb5c799a6a3a089137da4fd6a8">lspmac_fshut_init</a> (<a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *d)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initalize the fast shutter motor.  <a href="#a40aa4aeb5c799a6a3a089137da4fd6a8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a50e22adfb4d14499c1f5647458ca2ad9">lspmac_bio_init</a> (<a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *d, char *name, char *write_fmt, int *read_ptr, int read_mask)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize binary i/o motor.  <a href="#a50e22adfb4d14499c1f5647458ca2ad9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a6d88f6db90e4a7219a237b183d10a27d">lspmac_dac_init</a> (<a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *d, int *posp, double scale, char *mvar, char *name)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize DAC motor Note that some motors require further initialization from a database query.  <a href="#a6d88f6db90e4a7219a237b183d10a27d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a236945579e57dbb30c0b64f5b9184e9d">lspmac_init</a> (int ivarsflag, int mvarsflag)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize this module.  <a href="#a236945579e57dbb30c0b64f5b9184e9d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a3a7fb93fb3fb9c4454613f30bfb0b1ee">lspmac_run</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Start up the lspmac thread.  <a href="#a3a7fb93fb3fb9c4454613f30bfb0b1ee"></a><br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390">ls_pmac_state</a> = LS_PMAC_STATE_DETACHED</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Current state of the PMAC communications state machine.  <a href="#a6d9261680ee01b1e106d1ea1d7ffa390"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a112158e0cd50449a440ac55c7af7bea2">lspmac_shutter_state</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">State of the shutter, used to detect changes.  <a href="#a112158e0cd50449a440ac55c7af7bea2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a2ce5781f7f314dda6e6e9888fa7ba284">lspmac_shutter_has_opened</a> = md2_status.fs_has_opened</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Indicates that the shutter had opened, perhaps briefly even if the state did not change.  <a href="#a2ce5781f7f314dda6e6e9888fa7ba284"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">pthread_mutex_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a1b78a13c654409333569815e1c109d38">lspmac_shutter_mutex</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Coordinates threads reading shutter status.  <a href="#a1b78a13c654409333569815e1c109d38"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">pthread_cond_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#afbd51c2cefcee87afe994c9e9f372241">lspmac_shutter_cond</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Allows waiting for the shutter status to change.  <a href="#afbd51c2cefcee87afe994c9e9f372241"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">pthread_mutex_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f">lspmac_moving_mutex</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Coordinate moving motors between threads.  <a href="#a85679cac947e199c88794f8e5a12bf5f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">pthread_cond_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a57547d211906c981ef20257eba99f8df">lspmac_moving_cond</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Wait for motor(s) to finish moving condition.  <a href="#a57547d211906c981ef20257eba99f8df"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a7a32c617c183166308241e270959df56">lspmac_moving_flags</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Flag used to implement motor moving condition.  <a href="#a7a32c617c183166308241e270959df56"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static pthread_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a6b7011dd7d2c2d3afadff8d3e50e7677">pmac_thread</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">our thread to manage access and communication to the pmac  <a href="#a6b7011dd7d2c2d3afadff8d3e50e7677"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static pthread_mutex_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#acc1bb77b9bcbc4d970f841a41fd274b3">pmac_queue_mutex</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">manage access to the pmac command queue  <a href="#acc1bb77b9bcbc4d970f841a41fd274b3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static pthread_cond_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a8a25bd9c593c6985107f90f999ce0b08">pmac_queue_cond</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">wait for a command to be sent to PMAC before continuing  <a href="#a8a25bd9c593c6985107f90f999ce0b08"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct pollfd&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba">pmacfd</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">our poll structure  <a href="#adba7f5f4bbeabc4dac859221d4c684ba"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a07b7b8254772075e6a4ced500b589c36">getivars</a> = 0</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">flag set at initialization to send i vars to db  <a href="#a07b7b8254772075e6a4ced500b589c36"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a50e9c0a06654fd81b3446a6e54ff12c3">getmvars</a> = 0</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">flag set at initialization to send m vars to db  <a href="#a50e9c0a06654fd81b3446a6e54ff12c3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a9bffbf72495499b505543cd942f665da">lspmac_motors</a> [32]</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">All our motors.  <a href="#a9bffbf72495499b505543cd942f665da"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a56260f012c50a591ee7f97e500f16994">lspmac_nmotors</a> = 0</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The number of motors we manage.  <a href="#a56260f012c50a591ee7f97e500f16994"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a8237e646ce032a840637a4ef7bff49b9">omega</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">MD2 omega axis (the air bearing).  <a href="#a8237e646ce032a840637a4ef7bff49b9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a6cb218bdccfe5a93471c161f15a15cab">alignx</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Alignment stage X.  <a href="#a6cb218bdccfe5a93471c161f15a15cab"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a737c246c3948e644a18d191a931e1acd">aligny</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Alignment stage Y.  <a href="#a737c246c3948e644a18d191a931e1acd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ae7642b1da0f7c7f8448104c691d40a12">alignz</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Alignment stage X.  <a href="#ae7642b1da0f7c7f8448104c691d40a12"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aa90d2363b744acbd4d45133b7a716d8f">anal</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Polaroid analyzer motor.  <a href="#aa90d2363b744acbd4d45133b7a716d8f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ad53a42cfaa04eff0336a44c8c9986333">zoom</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Optical zoom.  <a href="#ad53a42cfaa04eff0336a44c8c9986333"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a139200ddaa9856a7ffcec0e6cbaa8f1b">apery</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Aperture Y.  <a href="#a139200ddaa9856a7ffcec0e6cbaa8f1b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ab93bd6ee850b285ca3a95e64d15e9477">aperz</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Aperture Z.  <a href="#ab93bd6ee850b285ca3a95e64d15e9477"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a51358daaea8b5236f08414877d8af6c2">capy</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Capillary Y.  <a href="#a51358daaea8b5236f08414877d8af6c2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aa45f268d0af9f3d465acfab128919718">capz</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Capillary Z.  <a href="#aa45f268d0af9f3d465acfab128919718"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ac0eeaffa0996271d8a38344a470d13d7">scinz</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Scintillator Z.  <a href="#ac0eeaffa0996271d8a38344a470d13d7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ac940d950d9efeaf3f0ae67e9bf331188">cenx</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Centering Table X.  <a href="#ac940d950d9efeaf3f0ae67e9bf331188"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aaed18e738ba7bfb6c771a44f5d7ea827">ceny</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Centering Table Y.  <a href="#aaed18e738ba7bfb6c771a44f5d7ea827"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a0be79ccb7ebf3a665248fd856112b9fd">kappa</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Kappa.  <a href="#a0be79ccb7ebf3a665248fd856112b9fd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ac8070dc568ad974a3db42b51eca828cc">phi</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Phi (not data collection axis).  <a href="#ac8070dc568ad974a3db42b51eca828cc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a26dec4623af9beed912b8e7e6f99822c">fshut</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Fast shutter.  <a href="#a26dec4623af9beed912b8e7e6f99822c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1">flight</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Front Light DAC.  <a href="#aeb09895663eff333b7a75acb319a9fc1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50">blight</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Back Light DAC.  <a href="#a85d6eaa4b4a82bb3112574f458d1dc50"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a8a3ca6fcf5e24dcc26170736843e53b2">fscint</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Scintillator Piezo DAC.  <a href="#a8a3ca6fcf5e24dcc26170736843e53b2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#af813a2eff0b7efa4c70633559054e84c">blight_ud</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Back Light Up/Down actuator.  <a href="#af813a2eff0b7efa4c70633559054e84c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a1de136a293a8e4bd306e692218a81587">linesReceived</a> = 0</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">current number of lines received  <a href="#a1de136a293a8e4bd306e692218a81587"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static unsigned char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a9da2795d11ccbc3a060c4811770ad04c">dbmem</a> [64 *1024]</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">double buffered memory  <a href="#a9da2795d11ccbc3a060c4811770ad04c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aa0be2f26364c4d12c9c81c10913f0b26">dbmemIn</a> = 0</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">next location  <a href="#aa0be2f26364c4d12c9c81c10913f0b26"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct timeval <br class="typebreak"/>
pmac_time_sent&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f">now</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands.  <a href="#a4bed9053319d1d2cad5cc03d0549e17f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structtagEthernetCmd.html">pmac_cmd_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structtagEthernetCmd.html">pmac_cmd_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structtagEthernetCmd.html">pmac_cmd_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81">cr_cmd</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">commands to send out "readready", "getbuffer", controlresponse (initialized in main)  <a href="#a8908812f4ff25c196679e00d330edd81"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a69e569a833fe7f202b92e860d1548f2b">ethCmdQueue</a> [PMAC_CMD_QUEUE_LENGTH]</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">PMAC command queue.  <a href="#a69e569a833fe7f202b92e860d1548f2b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ad62b1f9e907acc3de9f3d6a05d55829e">ethCmdOn</a> = 0</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">points to next empty PMAC command queue position  <a href="#ad62b1f9e907acc3de9f3d6a05d55829e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ae85caec6f4ddb2fc52ca14a26549ab08">ethCmdOff</a> = 0</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">points to current command (or none if == ethCmdOn)  <a href="#ae85caec6f4ddb2fc52ca14a26549ab08"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a7a78524ada402bb74759a3dfc5f8a571">ethCmdReply</a> = 0</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Used like ethCmdOff only to deal with the pmac reply to a command.  <a href="#a7a78524ada402bb74759a3dfc5f8a571"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#aab5a76f1ac64049314f9836e5c01fb7e">pmac_error_strs</a> []</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Decode the errors perhaps returned by the PMAC.  <a href="#aab5a76f1ac64049314f9836e5c01fb7e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structmd2StatusStruct.html">md2_status_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492">md2_status</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Buffer for MD2 Status.  <a href="#ad5bce7451d48127bace5af445d03b492"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">pthread_mutex_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspmac_8c.html#a7a3e763682bd7f987d07f149e94b3bf8">md2_status_mutex</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Synchronize reading/writting status buffer.  <a href="#a7a3e763682bd7f987d07f149e94b3bf8"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Routines concerned with communication with PMAC. </p>
<dl class="date"><dt><b>Date:</b></dt><dd>2012 </dd></dl>
<dl class="author"><dt><b>Author:</b></dt><dd>Keith Brister  All Rights Reserved</dd></dl>
<p>This is a state machine (surprise!) Lacking is support for writingbuffer, control writing and reading, as well as double buffered memory It looks like several different methods of managing PMAC communications are possible. Here is set up a queue of outgoing commands and deal completely with the result before sending the next. A full handshake of acknowledgements and "readready" is expected.</p>
<table border="1" cellspacing="3" cellpadding="3">
<tr>
<th><p>State </p>
</th><th><p>Description  </p>
</th></tr>
<tr>
<td><p>-1 </p>
</td><td><p>Reset the connection  </p>
</td></tr>
<tr>
<td><p>0 </p>
</td><td><p>Detached: need to connect to tcp port  </p>
</td></tr>
<tr>
<td><p>1 </p>
</td><td><p>Idle (waiting for a command to send to the pmac)  </p>
</td></tr>
<tr>
<td><p>2 </p>
</td><td><p>Send command  </p>
</td></tr>
<tr>
<td><p>3 </p>
</td><td><p>Waiting for command acknowledgement (no further response expected)  </p>
</td></tr>
<tr>
<td><p>4 </p>
</td><td><p>Waiting for control character acknowledgement (further response expected)  </p>
</td></tr>
<tr>
<td><p>5 </p>
</td><td><p>Waiting for command acknowledgement (further response expected)  </p>
</td></tr>
<tr>
<td><p>6 </p>
</td><td><p>Waiting for get memory response  </p>
</td></tr>
<tr>
<td><p>7 </p>
</td><td><p>Send controlresponse  </p>
</td></tr>
<tr>
<td><p>8 </p>
</td><td><p>Send readready  </p>
</td></tr>
<tr>
<td><p>9 </p>
</td><td><p>Waiting for acknowledgement of "readready"  </p>
</td></tr>
<tr>
<td><p>10 </p>
</td><td><p>Send readbuffer  </p>
</td></tr>
<tr>
<td><p>11 </p>
</td><td><p>Waiting for control response  </p>
</td></tr>
<tr>
<td><p>12 </p>
</td><td><p>Waiting for readbuffer response </p>
<p></p>
</td></tr>
</table>

<p>Definition in file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="abbd709b56a71eb1fc6adc9063605d243"></a><!-- doxytag: member="lspmac.c::LS_PMAC_STATE_CR" ref="abbd709b56a71eb1fc6adc9063605d243" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_CR&nbsp;&nbsp;&nbsp;7</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00045">45</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7eb86ecf0789ab9555de1e03a4c73567"></a><!-- doxytag: member="lspmac.c::LS_PMAC_STATE_DETACHED" ref="a7eb86ecf0789ab9555de1e03a4c73567" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_DETACHED&nbsp;&nbsp;&nbsp;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00038">38</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5f4ff8874677aac48a4c675f2c1ca4e9"></a><!-- doxytag: member="lspmac.c::LS_PMAC_STATE_GB" ref="a5f4ff8874677aac48a4c675f2c1ca4e9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_GB&nbsp;&nbsp;&nbsp;10</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00048">48</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a220b39710719cfe8b500d51819e8efeb"></a><!-- doxytag: member="lspmac.c::LS_PMAC_STATE_GMR" ref="a220b39710719cfe8b500d51819e8efeb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_GMR&nbsp;&nbsp;&nbsp;6</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00044">44</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a37741af675425d61c876cc30ae6c99d0"></a><!-- doxytag: member="lspmac.c::LS_PMAC_STATE_IDLE" ref="a37741af675425d61c876cc30ae6c99d0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_IDLE&nbsp;&nbsp;&nbsp;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00039">39</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7e1c68021b3dbb53ba1bac2afbd8fc20"></a><!-- doxytag: member="lspmac.c::LS_PMAC_STATE_RESET" ref="a7e1c68021b3dbb53ba1bac2afbd8fc20" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_RESET&nbsp;&nbsp;&nbsp;-1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00037">37</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="add5325f4a84e4fe05f558880349485ea"></a><!-- doxytag: member="lspmac.c::LS_PMAC_STATE_RR" ref="add5325f4a84e4fe05f558880349485ea" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_RR&nbsp;&nbsp;&nbsp;8</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00046">46</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7d8f34fc599cc08c1a9d2cd62ccbb20a"></a><!-- doxytag: member="lspmac.c::LS_PMAC_STATE_SC" ref="a7d8f34fc599cc08c1a9d2cd62ccbb20a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_SC&nbsp;&nbsp;&nbsp;2</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00040">40</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5eba9ef09d4316e803b9d75bd3104f43"></a><!-- doxytag: member="lspmac.c::LS_PMAC_STATE_WACK" ref="a5eba9ef09d4316e803b9d75bd3104f43" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_WACK&nbsp;&nbsp;&nbsp;5</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00043">43</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="adef540911028fda73e8bbf0aa6ad39e9"></a><!-- doxytag: member="lspmac.c::LS_PMAC_STATE_WACK_CC" ref="adef540911028fda73e8bbf0aa6ad39e9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_WACK_CC&nbsp;&nbsp;&nbsp;4</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00042">42</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a63356b0c18fcb186f456c12c6e927d84"></a><!-- doxytag: member="lspmac.c::LS_PMAC_STATE_WACK_NFR" ref="a63356b0c18fcb186f456c12c6e927d84" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_WACK_NFR&nbsp;&nbsp;&nbsp;3</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00041">41</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3e0a62cd9a1212419ad3615c34bdc65a"></a><!-- doxytag: member="lspmac.c::LS_PMAC_STATE_WACK_RR" ref="a3e0a62cd9a1212419ad3615c34bdc65a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_WACK_RR&nbsp;&nbsp;&nbsp;9</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00047">47</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a27ee6c39d58604c8aa9bd6c249c4833f"></a><!-- doxytag: member="lspmac.c::LS_PMAC_STATE_WCR" ref="a27ee6c39d58604c8aa9bd6c249c4833f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_WCR&nbsp;&nbsp;&nbsp;11</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00049">49</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a591822cc92f76a39b293c2e90b322db2"></a><!-- doxytag: member="lspmac.c::LS_PMAC_STATE_WGB" ref="a591822cc92f76a39b293c2e90b322db2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PMAC_STATE_WGB&nbsp;&nbsp;&nbsp;12</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00050">50</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3fae557baafab24b7518dc84f5ef5a9b"></a><!-- doxytag: member="lspmac.c::PMAC_CMD_QUEUE_LENGTH" ref="a3fae557baafab24b7518dc84f5ef5a9b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PMAC_CMD_QUEUE_LENGTH&nbsp;&nbsp;&nbsp;2048</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Size of the PMAC command queue. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00137">137</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="abdc45e3f7106f84f688419e2da9b3627"></a><!-- doxytag: member="lspmac.c::pmac_cmd_size" ref="abdc45e3f7106f84f688419e2da9b3627" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define pmac_cmd_size&nbsp;&nbsp;&nbsp;8</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>PMAC command size in bytes. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00103">103</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a59f5f5218e25332dbf64f216aec116e5"></a><!-- doxytag: member="lspmac.c::PMAC_MIN_CMD_TIME" ref="a59f5f5218e25332dbf64f216aec116e5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PMAC_MIN_CMD_TIME&nbsp;&nbsp;&nbsp;20000.0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Minimum time between commands to the pmac. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00133">133</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac95886e84843b6b0bb6cc270e42043c4"></a><!-- doxytag: member="lspmac.c::PMACPORT" ref="ac95886e84843b6b0bb6cc270e42043c4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PMACPORT&nbsp;&nbsp;&nbsp;1025</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The PMAC (only) listens on this port. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00097">97</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8f4ce4666a23a3fb153d680bd1cb6556"></a><!-- doxytag: member="lspmac.c::VR_CTRL_RESPONSE" ref="a8f4ce4666a23a3fb153d680bd1cb6556" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_CTRL_RESPONSE&nbsp;&nbsp;&nbsp;0xc4</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00119">119</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="af24ecdc10723dc8fd6320fef416ae514"></a><!-- doxytag: member="lspmac.c::VR_DOWNLOAD" ref="af24ecdc10723dc8fd6320fef416ae514" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_DOWNLOAD&nbsp;&nbsp;&nbsp;0x40</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00106">106</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a15e4dbce5615c285ec1755f01057b5fe"></a><!-- doxytag: member="lspmac.c::VR_FWDOWNLOAD" ref="a15e4dbce5615c285ec1755f01057b5fe" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_FWDOWNLOAD&nbsp;&nbsp;&nbsp;0xcb</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00123">123</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a34a2e0d5c1f48ba463ae5d98431d05f7"></a><!-- doxytag: member="lspmac.c::VR_IPADDRESS" ref="a34a2e0d5c1f48ba463ae5d98431d05f7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_IPADDRESS&nbsp;&nbsp;&nbsp;0xe0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00124">124</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac0e5588681366b52589cd321eabf12ff"></a><!-- doxytag: member="lspmac.c::VR_PMAC_FLUSH" ref="ac0e5588681366b52589cd321eabf12ff" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_FLUSH&nbsp;&nbsp;&nbsp;0xb3</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00110">110</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a50e444b5ceb6d62a1be43c88c55c549c"></a><!-- doxytag: member="lspmac.c::VR_PMAC_GETBUFFER" ref="a50e444b5ceb6d62a1be43c88c55c549c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_GETBUFFER&nbsp;&nbsp;&nbsp;0xc5</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00120">120</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="af3c7372a48fccf0458f266f4bc758a2c"></a><!-- doxytag: member="lspmac.c::VR_PMAC_GETLINE" ref="af3c7372a48fccf0458f266f4bc758a2c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_GETLINE&nbsp;&nbsp;&nbsp;0xb1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00109">109</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="af9c53e7c5b2681a5ca1c5410a914a2dc"></a><!-- doxytag: member="lspmac.c::VR_PMAC_GETMEM" ref="af9c53e7c5b2681a5ca1c5410a914a2dc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_GETMEM&nbsp;&nbsp;&nbsp;0xb4</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00111">111</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aee7c46f33b9b6945c6b2b260810dc7f5"></a><!-- doxytag: member="lspmac.c::VR_PMAC_GETRESPONSE" ref="aee7c46f33b9b6945c6b2b260810dc7f5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_GETRESPONSE&nbsp;&nbsp;&nbsp;0xbf</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00117">117</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a4cd95cb80b8da3962ebe9ec8afe844c8"></a><!-- doxytag: member="lspmac.c::VR_PMAC_PORT" ref="a4cd95cb80b8da3962ebe9ec8afe844c8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_PORT&nbsp;&nbsp;&nbsp;0xbe</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00116">116</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aad3c7b4a9403e56c09eceadcf21252c0"></a><!-- doxytag: member="lspmac.c::VR_PMAC_READREADY" ref="aad3c7b4a9403e56c09eceadcf21252c0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_READREADY&nbsp;&nbsp;&nbsp;0xc2</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00118">118</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a76c1c401354826ac2ba8906578be930f"></a><!-- doxytag: member="lspmac.c::VR_PMAC_SENDCTRLCHAR" ref="a76c1c401354826ac2ba8906578be930f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_SENDCTRLCHAR&nbsp;&nbsp;&nbsp;0xb6</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00113">113</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a772b2ea2ad93989ae4275c79a93525ee"></a><!-- doxytag: member="lspmac.c::VR_PMAC_SENDLINE" ref="a772b2ea2ad93989ae4275c79a93525ee" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_SENDLINE&nbsp;&nbsp;&nbsp;0xb0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00108">108</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aaed77195148c3d9fe10c6e82fc6b2ea7"></a><!-- doxytag: member="lspmac.c::VR_PMAC_SETBIT" ref="aaed77195148c3d9fe10c6e82fc6b2ea7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_SETBIT&nbsp;&nbsp;&nbsp;0xba</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00114">114</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a91a625425f6df7610f440231868a5cf1"></a><!-- doxytag: member="lspmac.c::VR_PMAC_SETBITS" ref="a91a625425f6df7610f440231868a5cf1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_SETBITS&nbsp;&nbsp;&nbsp;0xbb</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00115">115</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab79207cc3145740f8c070a24c91b11e0"></a><!-- doxytag: member="lspmac.c::VR_PMAC_SETMEM" ref="ab79207cc3145740f8c070a24c91b11e0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_SETMEM&nbsp;&nbsp;&nbsp;0xb5</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00112">112</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="af5e53c37c17cd06e42f7b0df211f96d8"></a><!-- doxytag: member="lspmac.c::VR_PMAC_WRITEBUFFER" ref="af5e53c37c17cd06e42f7b0df211f96d8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_WRITEBUFFER&nbsp;&nbsp;&nbsp;0xc6</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00121">121</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab8367c4c9247a96c6828418d87b8623b"></a><!-- doxytag: member="lspmac.c::VR_PMAC_WRITEERROR" ref="ab8367c4c9247a96c6828418d87b8623b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_PMAC_WRITEERROR&nbsp;&nbsp;&nbsp;0xc7</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00122">122</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5485d08fdc80533b5cebadff63696ed2"></a><!-- doxytag: member="lspmac.c::VR_UPLOAD" ref="a5485d08fdc80533b5cebadff63696ed2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VR_UPLOAD&nbsp;&nbsp;&nbsp;0xc0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00105">105</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="a3495613b8b94cadc4205f19e1254ebeb"></a><!-- doxytag: member="lspmac.c::md2_status_t" ref="a3495613b8b94cadc4205f19e1254ebeb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structmd2StatusStruct.html">md2StatusStruct</a>  <a class="el" href="structmd2StatusStruct.html">md2_status_t</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The block of memory retrieved in a status request. </p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a8f9f1ad624350095075aa6b51423b02d"></a><!-- doxytag: member="lspmac.c::cleanstr" ref="a8f9f1ad624350095075aa6b51423b02d" args="(char *s)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cleanstr </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>s</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Replace  with <br/>
 in null terminated string and print result to terminal. </p>
<p>Needed to turn PMAC messages into something printable. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>s</em>&nbsp;</td><td>String to print to terminal. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00312">312</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00314"></a>00314                 {
<a name="l00315"></a>00315   <span class="keywordtype">int</span> i;
<a name="l00316"></a>00316 
<a name="l00317"></a>00317   pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00318"></a>00318 
<a name="l00319"></a>00319   <span class="keywordflow">for</span>( i=0; i&lt;strlen( s); i++) {
<a name="l00320"></a>00320     <span class="keywordflow">if</span>( s[i] == <span class="charliteral">&apos;\r&apos;</span>)
<a name="l00321"></a>00321       wprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00322"></a>00322     <span class="keywordflow">else</span>
<a name="l00323"></a>00323       wprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, <span class="stringliteral">&quot;%c&quot;</span>, s[i]);
<a name="l00324"></a>00324   }
<a name="l00325"></a>00325 
<a name="l00326"></a>00326   pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00327"></a>00327 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1c3786f3a38724f497afc4fe6d82d8c4"></a><!-- doxytag: member="lspmac.c::hex_dump" ref="a1c3786f3a38724f497afc4fe6d82d8c4" args="(int n, unsigned char *s)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void hex_dump </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>s</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Prints a hex dump of the given data. </p>
<p>Used to debug packet data. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>n</em>&nbsp;</td><td>Number of bytes passed in s </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>s</em>&nbsp;</td><td>Data to dump </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00284">284</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00287"></a>00287                 {
<a name="l00288"></a>00288 
<a name="l00289"></a>00289   <span class="keywordtype">int</span> i;        <span class="comment">// row counter</span>
<a name="l00290"></a>00290   <span class="keywordtype">int</span> j;        <span class="comment">// column counter</span>
<a name="l00291"></a>00291 
<a name="l00292"></a>00292   pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00293"></a>00293 
<a name="l00294"></a>00294   <span class="keywordflow">for</span>( i=0; n &gt; 0; i++) {
<a name="l00295"></a>00295     <span class="keywordflow">for</span>( j=0; j&lt;16 &amp;&amp; n &gt; 0; j++) {
<a name="l00296"></a>00296       <span class="keywordflow">if</span>( j==8)
<a name="l00297"></a>00297         wprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, <span class="stringliteral">&quot;  &quot;</span>);
<a name="l00298"></a>00298       wprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, <span class="stringliteral">&quot; %02x&quot;</span>, *(s + 16*i + j));
<a name="l00299"></a>00299       n--;
<a name="l00300"></a>00300     }
<a name="l00301"></a>00301     wprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00302"></a>00302   }
<a name="l00303"></a>00303   wprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00304"></a>00304 
<a name="l00305"></a>00305   pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00306"></a>00306 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1b01e3cf8ebc36c00723e51e5652996d"></a><!-- doxytag: member="lspmac.c::if" ref="a1b01e3cf8ebc36c00723e51e5652996d" args="(md2_status.fs_is_open)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">if </td>
          <td>(</td>
          <td class="paramtype">md2_status.&nbsp;</td>
          <td class="paramname"> <em>fs_is_open</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00968">968</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00968"></a>00968                              {
<a name="l00969"></a>00969     mvwprintw( <a class="code" href="pgpmac_8c.html#ae2d7da3afeb756716e6e4ee9cab78f8a" title="shutter, lamp, air, etc status">term_status2</a>, 1, 1, <span class="stringliteral">&quot;Shutter Open  &quot;</span>);
<a name="l00970"></a>00970     mp-&gt;position = 1;
<a name="l00971"></a>00971   } <span class="keywordflow">else</span> {
</pre></div></p>

</div>
</div>
<a class="anchor" id="a92cb18ae39bf4ed55cdbb4d563c31416"></a><!-- doxytag: member="lspmac.c::if" ref="a92cb18ae39bf4ed55cdbb4d563c31416" args="(lspmac_shutter_state!=md2_status.fs_is_open)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">if </td>
          <td>(</td>
          <td class="paramtype">lspmac_shutter_state!&nbsp;</td>
          <td class="paramname"> = <code>md2_status.fs_is_open</code></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00963">963</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00963"></a>00963                                                       {
<a name="l00964"></a>00964     <a class="code" href="lspmac_8c.html#a112158e0cd50449a440ac55c7af7bea2" title="State of the shutter, used to detect changes.">lspmac_shutter_state</a> = <a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#aca3722c109e6646bd41fb269a32261f2">fs_is_open</a>;
<a name="l00965"></a>00965     pthread_cond_signal( &amp;<a class="code" href="lspmac_8c.html#afbd51c2cefcee87afe994c9e9f372241" title="Allows waiting for the shutter status to change.">lspmac_shutter_cond</a>);
<a name="l00966"></a>00966   }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6c5e6e82b3c27cd2ab24d5e47100f912"></a><!-- doxytag: member="lspmac.c::if" ref="a6c5e6e82b3c27cd2ab24d5e47100f912" args="(md2_status.fs_has_opened &amp;&amp;!lspmac_shutter_has_opened &amp;&amp;!md2_status.fs_is_open)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">if </td>
          <td>(</td>
          <td class="paramtype">md2_status.fs_has_opened &amp;&amp;!<a class="el" href="pgpmac_8h.html#a396fbf06208de3ecbe1b0df549f1cd46">lspmac_shutter_has_opened</a> &amp;&amp;!md2_status.&nbsp;</td>
          <td class="paramname"> <em>fs_is_open</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00954">954</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00954"></a>00954                                                                                         {
<a name="l00955"></a>00955     <span class="comment">//</span>
<a name="l00956"></a>00956     <span class="comment">// Here the shutter opened and closed again before we got the memo</span>
<a name="l00957"></a>00957     <span class="comment">// Treat it as a shutter closed event</span>
<a name="l00958"></a>00958     <span class="comment">//</span>
<a name="l00959"></a>00959     pthread_cond_signal( &amp;<a class="code" href="lspmac_8c.html#afbd51c2cefcee87afe994c9e9f372241" title="Allows waiting for the shutter status to change.">lspmac_shutter_cond</a>);
<a name="l00960"></a>00960   }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aae020ea2478b41702ce8b7d20b2560be"></a><!-- doxytag: member="lspmac.c::lsConnect" ref="aae020ea2478b41702ce8b7d20b2560be" args="(char *ipaddr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsConnect </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>ipaddr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Connect to the PMAC socket. </p>
<p>Establish or reestablish communications. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ipaddr</em>&nbsp;</td><td>String representation of the IP address (dot quad or FQN) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00333">333</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00335"></a>00335                  {
<a name="l00336"></a>00336   <span class="keywordtype">int</span> psock;                    <span class="comment">// our socket: value stored in pmacfda.fd</span>
<a name="l00337"></a>00337   <span class="keywordtype">int</span> err;                      <span class="comment">// error code from some system calls</span>
<a name="l00338"></a>00338   <span class="keyword">struct </span>sockaddr_in *addrP;    <span class="comment">// our address structure to connect to</span>
<a name="l00339"></a>00339   <span class="keyword">struct </span>addrinfo ai_hints;     <span class="comment">// required for getaddrinfo</span>
<a name="l00340"></a>00340   <span class="keyword">struct </span>addrinfo *ai_resultP;  <span class="comment">// linked list of address structures (we&apos;ll always pick the first)</span>
<a name="l00341"></a>00341 
<a name="l00342"></a>00342   <a class="code" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba" title="our poll structure">pmacfd</a>.fd     = -1;
<a name="l00343"></a>00343   <a class="code" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba" title="our poll structure">pmacfd</a>.events = 0;
<a name="l00344"></a>00344 
<a name="l00345"></a>00345   <span class="comment">// Initial buffer(s)</span>
<a name="l00346"></a>00346   memset( &amp;ai_hints,  0, <span class="keyword">sizeof</span>( ai_hints));
<a name="l00347"></a>00347 
<a name="l00348"></a>00348   ai_hints.ai_family   = AF_INET;
<a name="l00349"></a>00349   ai_hints.ai_socktype = SOCK_STREAM;
<a name="l00350"></a>00350 
<a name="l00351"></a>00351 
<a name="l00352"></a>00352   <span class="comment">//</span>
<a name="l00353"></a>00353   <span class="comment">// get address</span>
<a name="l00354"></a>00354   <span class="comment">//</span>
<a name="l00355"></a>00355   err = getaddrinfo( ipaddr, NULL, &amp;ai_hints, &amp;ai_resultP);
<a name="l00356"></a>00356   <span class="keywordflow">if</span>( err != 0) {
<a name="l00357"></a>00357 
<a name="l00358"></a>00358     pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00359"></a>00359 
<a name="l00360"></a>00360     wprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, <span class="stringliteral">&quot;Could not find address: %s\n&quot;</span>, gai_strerror( err));
<a name="l00361"></a>00361 
<a name="l00362"></a>00362     wnoutrefresh( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>);
<a name="l00363"></a>00363     wnoutrefresh( <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>);
<a name="l00364"></a>00364     doupdate();
<a name="l00365"></a>00365 
<a name="l00366"></a>00366     pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00367"></a>00367 
<a name="l00368"></a>00368     <span class="keywordflow">return</span>;
<a name="l00369"></a>00369   }
<a name="l00370"></a>00370 
<a name="l00371"></a>00371 
<a name="l00372"></a>00372   addrP = (<span class="keyword">struct </span>sockaddr_in *)ai_resultP-&gt;ai_addr;
<a name="l00373"></a>00373   addrP-&gt;sin_port = htons( <a class="code" href="lspmac_8c.html#ac95886e84843b6b0bb6cc270e42043c4" title="The PMAC (only) listens on this port.">PMACPORT</a>);
<a name="l00374"></a>00374 
<a name="l00375"></a>00375 
<a name="l00376"></a>00376   psock = socket( PF_INET, SOCK_STREAM, 0);
<a name="l00377"></a>00377   <span class="keywordflow">if</span>( psock == -1) {
<a name="l00378"></a>00378 
<a name="l00379"></a>00379     pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00380"></a>00380     wprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, <span class="stringliteral">&quot;Could not create socket\n&quot;</span>);
<a name="l00381"></a>00381 
<a name="l00382"></a>00382     wnoutrefresh( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>);
<a name="l00383"></a>00383     wnoutrefresh( <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>);
<a name="l00384"></a>00384     doupdate();
<a name="l00385"></a>00385     pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00386"></a>00386     <span class="keywordflow">return</span>;
<a name="l00387"></a>00387   }
<a name="l00388"></a>00388 
<a name="l00389"></a>00389   err = connect( psock, (<span class="keyword">const</span> <span class="keyword">struct</span> sockaddr *)addrP, <span class="keyword">sizeof</span>( *addrP));
<a name="l00390"></a>00390   <span class="keywordflow">if</span>( err != 0) {
<a name="l00391"></a>00391     pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00392"></a>00392     wprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, <span class="stringliteral">&quot;Could not connect socket: %s\n&quot;</span>, strerror( errno));
<a name="l00393"></a>00393 
<a name="l00394"></a>00394     wnoutrefresh( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>);
<a name="l00395"></a>00395     wnoutrefresh( <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>);
<a name="l00396"></a>00396     doupdate();
<a name="l00397"></a>00397     pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00398"></a>00398     <span class="keywordflow">return</span>;
<a name="l00399"></a>00399   }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401   <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a37741af675425d61c876cc30ae6c99d0">LS_PMAC_STATE_IDLE</a>;
<a name="l00402"></a>00402   <a class="code" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba" title="our poll structure">pmacfd</a>.fd     = psock;
<a name="l00403"></a>00403   <a class="code" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba" title="our poll structure">pmacfd</a>.events = POLLIN;
<a name="l00404"></a>00404 
<a name="l00405"></a>00405 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a50e22adfb4d14499c1f5647458ca2ad9"></a><!-- doxytag: member="lspmac.c::lspmac_bio_init" ref="a50e22adfb4d14499c1f5647458ca2ad9" args="(lspmac_motor_t *d, char *name, char *write_fmt, int *read_ptr, int read_mask)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a>* lspmac_bio_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td>
          <td class="paramname"> <em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>write_fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>read_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>read_mask</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize binary i/o motor. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>d</em>&nbsp;</td><td>Our uninitialized motor object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>name</em>&nbsp;</td><td>Name of motor to coordinate with DB </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>write_fmt</em>&nbsp;</td><td>Format string used to generate PMAC command to move motor </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>read_ptr</em>&nbsp;</td><td>Pointer to byte in md2_status to find position </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>read_mask</em>&nbsp;</td><td>Bitmask to find position in *read_ptr </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01722">1722</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01728"></a>01728                                   {
<a name="l01729"></a>01729   <a class="code" href="lspmac_8c.html#a56260f012c50a591ee7f97e500f16994" title="The number of motors we manage.">lspmac_nmotors</a>++;
<a name="l01730"></a>01730 
<a name="l01731"></a>01731   d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>              = strdup( name);
<a name="l01732"></a>01732   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a20db3de86854b627815b3d940555ea75" title="function to move the motor">moveAbs</a>           = <a class="code" href="lspmac_8c.html#ad1167f01262cf6387e7e82a14d3e1a9d" title="Move method for binary i/o motor objects.">lspmac_moveabs_bio_queue</a>;
<a name="l01733"></a>01733   d-&gt;<a class="code" href="structlspmac__motor__struct.html#ac62692eb939c04ca35e939d1c3acfe8f" title="function to read the motor status and position">read</a>              = <a class="code" href="lspmac_8c.html#a5945488310a5a8f616e6605782c7f1c9" title="Read the state of a binary i/o motor This is the read method for the binary i/o motor...">lspmac_bio_read</a>;
<a name="l01734"></a>01734   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>               = NULL;
<a name="l01735"></a>01735   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a>              = 0;
<a name="l01736"></a>01736   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a> = NULL;
<a name="l01737"></a>01737   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a17e0953d269d53137c508e391cb16e47" title="First 24 bit PMAC motor status word.">status1</a>           = NULL;
<a name="l01738"></a>01738   d-&gt;<a class="code" href="structlspmac__motor__struct.html#ac16fec220714218334764a1038f3813a" title="Sectond 24 bit PMAC motor status word.">status2</a>           = NULL;
<a name="l01739"></a>01739   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a45fae17618f0c0827e97060dc04f79cb" title="pmac motor number">motor_num</a>         = -1;
<a name="l01740"></a>01740   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a05dff021221abbc1bf656039fffb3275" title="controlling mvariable as a string">dac_mvar</a>          = NULL;
<a name="l01741"></a>01741   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>               = NULL;
<a name="l01742"></a>01742   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a70291ddfe7994c0bec7fc2287cb6dd89" title="Format string to write requested position to PMAC used for binary io.">write_fmt</a>         = strdup( write_fmt);
<a name="l01743"></a>01743   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a844b28ccabab5048ca216db074fb9704" title="With read_mask finds bit to read for binary i/o.">read_ptr</a>          = read_ptr;
<a name="l01744"></a>01744   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a3c24ed30c5a3ad490c6139b2780b2af7" title="WIth read_ptr find bit to read for binary i/o.">read_mask</a>         = read_mask;
<a name="l01745"></a>01745   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>               = NULL;
<a name="l01746"></a>01746   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a61415627ab2dc0f438b190d117e532db" title="conversion from counts to units: 0.0 means not loaded yet">u2c</a>               = 1.0;
<a name="l01747"></a>01747 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5945488310a5a8f616e6605782c7f1c9"></a><!-- doxytag: member="lspmac.c::lspmac_bio_read" ref="a5945488310a5a8f616e6605782c7f1c9" args="(lspmac_motor_t *mp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_bio_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td>
          <td class="paramname"> <em>mp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Read the state of a binary i/o motor This is the read method for the binary i/o motor class. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>mp</em>&nbsp;</td><td>The motor </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00911">911</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00913"></a>00913                        {
<a name="l00914"></a>00914   <span class="keywordtype">char</span> s[512];
<a name="l00915"></a>00915   <span class="keywordtype">int</span> pos;
<a name="l00916"></a>00916 
<a name="l00917"></a>00917   pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));
<a name="l00918"></a>00918 
<a name="l00919"></a>00919   pos = (*(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a844b28ccabab5048ca216db074fb9704" title="With read_mask finds bit to read for binary i/o.">read_ptr</a>) &amp; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a3c24ed30c5a3ad490c6139b2780b2af7" title="WIth read_ptr find bit to read for binary i/o.">read_mask</a>) == 0 ? 0 : 1;
<a name="l00920"></a>00920   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a> = pos;
<a name="l00921"></a>00921 
<a name="l00922"></a>00922   <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a61415627ab2dc0f438b190d117e532db" title="conversion from counts to units: 0.0 means not loaded yet">u2c</a> != 0.0) {
<a name="l00923"></a>00923     mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a> = *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a>/mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a61415627ab2dc0f438b190d117e532db" title="conversion from counts to units: 0.0 means not loaded yet">u2c</a>;
<a name="l00924"></a>00924     snprintf( s, <span class="keyword">sizeof</span>(s)-1, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aba3d9d00271187128506bbbb1d77da19" title="printf format">format</a>, 8, pos/mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a61415627ab2dc0f438b190d117e532db" title="conversion from counts to units: 0.0 means not loaded yet">u2c</a>);
<a name="l00925"></a>00925   } <span class="keywordflow">else</span> {
<a name="l00926"></a>00926     mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a> = 1.0* (*mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a>);
<a name="l00927"></a>00927     snprintf( s, <span class="keyword">sizeof</span>(s)-1, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aba3d9d00271187128506bbbb1d77da19" title="printf format">format</a>, 8, 1.0* (pos));
<a name="l00928"></a>00928   }
<a name="l00929"></a>00929 
<a name="l00930"></a>00930   pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));
<a name="l00931"></a>00931 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6d88f6db90e4a7219a237b183d10a27d"></a><!-- doxytag: member="lspmac.c::lspmac_dac_init" ref="a6d88f6db90e4a7219a237b183d10a27d" args="(lspmac_motor_t *d, int *posp, double scale, char *mvar, char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a>* lspmac_dac_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td>
          <td class="paramname"> <em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>posp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>scale</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>mvar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize DAC motor Note that some motors require further initialization from a database query. </p>
<p>For this reason this initialzation code must be run before the database queue is allowed to be processed. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>d</em>&nbsp;</td><td>Returns the (almost) initialized motor object [in,out] unitintialized motor </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>posp</em>&nbsp;</td><td>Location of current position </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>scale</em>&nbsp;</td><td>Scale factor (units) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>mvar</em>&nbsp;</td><td>M variable, ie, "M1200" </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>name</em>&nbsp;</td><td>name to coordinate with DB </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01756">1756</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01763"></a>01763                                   {
<a name="l01764"></a>01764   <a class="code" href="lspmac_8c.html#a56260f012c50a591ee7f97e500f16994" title="The number of motors we manage.">lspmac_nmotors</a>++;
<a name="l01765"></a>01765   d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>     = strdup( name);
<a name="l01766"></a>01766   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a20db3de86854b627815b3d940555ea75" title="function to move the motor">moveAbs</a>  = <a class="code" href="lspmac_8c.html#a7d601716497857c2b5c072c1aed37b71" title="Move method for dac motor objects (ie, lights).">lspmac_movedac_queue</a>;
<a name="l01767"></a>01767   d-&gt;<a class="code" href="structlspmac__motor__struct.html#ac62692eb939c04ca35e939d1c3acfe8f" title="function to read the motor status and position">read</a>     = <a class="code" href="lspmac_8c.html#a200bc9306d54fca566eb5e29d8e82308" title="Read a DAC motor position.">lspmac_dac_read</a>;
<a name="l01768"></a>01768   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>      = NULL;
<a name="l01769"></a>01769   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a>     = 0;
<a name="l01770"></a>01770   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a> = posp;
<a name="l01771"></a>01771   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a17e0953d269d53137c508e391cb16e47" title="First 24 bit PMAC motor status word.">status1</a>           = NULL;
<a name="l01772"></a>01772   d-&gt;<a class="code" href="structlspmac__motor__struct.html#ac16fec220714218334764a1038f3813a" title="Sectond 24 bit PMAC motor status word.">status2</a>           = NULL;
<a name="l01773"></a>01773   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a45fae17618f0c0827e97060dc04f79cb" title="pmac motor number">motor_num</a>         = -1;
<a name="l01774"></a>01774   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a05dff021221abbc1bf656039fffb3275" title="controlling mvariable as a string">dac_mvar</a>          = strdup(mvar);
<a name="l01775"></a>01775   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a61415627ab2dc0f438b190d117e532db" title="conversion from counts to units: 0.0 means not loaded yet">u2c</a>               = scale;
<a name="l01776"></a>01776   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>               = NULL;
<a name="l01777"></a>01777 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a200bc9306d54fca566eb5e29d8e82308"></a><!-- doxytag: member="lspmac.c::lspmac_dac_read" ref="a200bc9306d54fca566eb5e29d8e82308" args="(lspmac_motor_t *mp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_dac_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td>
          <td class="paramname"> <em>mp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Read a DAC motor position. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>mp</em>&nbsp;</td><td>The motor </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00935">935</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00937"></a>00937                        {
<a name="l00938"></a>00938   <span class="comment">// TODO: impliement</span>
<a name="l00939"></a>00939 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2442c529b024e9c23c4acef8c1eb8689"></a><!-- doxytag: member="lspmac.c::lspmac_Error" ref="a2442c529b024e9c23c4acef8c1eb8689" args="(unsigned char *buff)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_Error </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>buff</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The service routing detected an error condition. </p>
<p>Scan the response buffer for an error code and print it out. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>buff</em>&nbsp;</td><td>Buffer returned by PMAC perhaps containing a NULL terminated message. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00557">557</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00559"></a>00559                     {
<a name="l00560"></a>00560   <span class="keywordtype">int</span> err;
<a name="l00561"></a>00561   <span class="comment">//</span>
<a name="l00562"></a>00562   <span class="comment">// assume buff points to a 1400 byte array of stuff read from the pmac</span>
<a name="l00563"></a>00563   <span class="comment">//</span>
<a name="l00564"></a>00564 
<a name="l00565"></a>00565   <span class="keywordflow">if</span>( buff[0] == 7 &amp;&amp; buff[1] == <span class="charliteral">&apos;E&apos;</span> &amp;&amp; buff[2] == <span class="charliteral">&apos;R&apos;</span> &amp;&amp; buff[3] == <span class="charliteral">&apos;R&apos;</span>) {
<a name="l00566"></a>00566     buff[7] = 0;  <span class="comment">// For null termination</span>
<a name="l00567"></a>00567     err = atoi( &amp;(buff[4]));
<a name="l00568"></a>00568     <span class="keywordflow">if</span>( err &gt; 0 &amp;&amp; err &lt; 20) {
<a name="l00569"></a>00569       pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00570"></a>00570       wprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, <span class="stringliteral">&quot;\n%s\n&quot;</span>, <a class="code" href="lspmac_8c.html#aab5a76f1ac64049314f9836e5c01fb7e" title="Decode the errors perhaps returned by the PMAC.">pmac_error_strs</a>[err]);
<a name="l00571"></a>00571       wnoutrefresh( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>);
<a name="l00572"></a>00572       wnoutrefresh( <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>);
<a name="l00573"></a>00573       doupdate();
<a name="l00574"></a>00574       pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00575"></a>00575     }
<a name="l00576"></a>00576   }
<a name="l00577"></a>00577   <a class="code" href="lspmac_8c.html#aaedae34bc18ac1742a232117c125d7b9" title="Clear the queue and put the PMAC into a known state.">lspmac_Reset</a>();
<a name="l00578"></a>00578 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a40aa4aeb5c799a6a3a089137da4fd6a8"></a><!-- doxytag: member="lspmac.c::lspmac_fshut_init" ref="a40aa4aeb5c799a6a3a089137da4fd6a8" args="(lspmac_motor_t *d)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a>* lspmac_fshut_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td>
          <td class="paramname"> <em>d</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initalize the fast shutter motor. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>d</em>&nbsp;</td><td>Our uninitialized motor object </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01698">1698</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01700"></a>01700                                     {
<a name="l01701"></a>01701   <a class="code" href="lspmac_8c.html#a56260f012c50a591ee7f97e500f16994" title="The number of motors we manage.">lspmac_nmotors</a>++;
<a name="l01702"></a>01702   d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>           = strdup(<span class="stringliteral">&quot;fastShutter&quot;</span>);
<a name="l01703"></a>01703   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a20db3de86854b627815b3d940555ea75" title="function to move the motor">moveAbs</a>        = <a class="code" href="lspmac_8c.html#ab9f114bba58e685760a518bd5f115d74" title="Move method for the fast shutter.">lspmac_moveabs_fshut_queue</a>;
<a name="l01704"></a>01704   d-&gt;<a class="code" href="structlspmac__motor__struct.html#ac62692eb939c04ca35e939d1c3acfe8f" title="function to read the motor status and position">read</a>           = <a class="code" href="lspmac_8c.html#ace8c4474ee2e91a06486e89edcb2acc1" title="Fast shutter read routine The shutter is mildly complicated in that we need to take...">lspmac_shutter_read</a>;
<a name="l01705"></a>01705   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>            = NULL;
<a name="l01706"></a>01706   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a>           = 0;
<a name="l01707"></a>01707   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a> = NULL;
<a name="l01708"></a>01708   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a17e0953d269d53137c508e391cb16e47" title="First 24 bit PMAC motor status word.">status1</a>           = NULL;
<a name="l01709"></a>01709   d-&gt;<a class="code" href="structlspmac__motor__struct.html#ac16fec220714218334764a1038f3813a" title="Sectond 24 bit PMAC motor status word.">status2</a>           = NULL;
<a name="l01710"></a>01710   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a45fae17618f0c0827e97060dc04f79cb" title="pmac motor number">motor_num</a>         = -1;
<a name="l01711"></a>01711   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a05dff021221abbc1bf656039fffb3275" title="controlling mvariable as a string">dac_mvar</a>          = NULL;
<a name="l01712"></a>01712   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>               = NULL;
<a name="l01713"></a>01713 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6dedca923b3a6904395ad02158e2e96f"></a><!-- doxytag: member="lspmac.c::lspmac_get_status" ref="a6dedca923b3a6904395ad02158e2e96f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_get_status </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Request a status update from the PMAC. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01179">1179</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01179"></a>01179                          {
<a name="l01180"></a>01180   <a class="code" href="lspmac_8c.html#a1e472a11df3765763c2fe92dd358bf0c" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>, <a class="code" href="lspmac_8c.html#af9c53e7c5b2681a5ca1c5410a914a2dc">VR_PMAC_GETMEM</a>, 0x400, 0, <span class="keyword">sizeof</span>(<a class="code" href="structmd2StatusStruct.html" title="The block of memory retrieved in a status request.">md2_status_t</a>), NULL, <a class="code" href="lspmac_8c.html#ad060fd55c9e2411fd4fd4e946aff23c6" title="Service routing for status upate This updates positions and status information.">lspmac_get_status_cb</a>, 0);
<a name="l01181"></a>01181 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad060fd55c9e2411fd4fd4e946aff23c6"></a><!-- doxytag: member="lspmac.c::lspmac_get_status_cb" ref="ad060fd55c9e2411fd4fd4e946aff23c6" args="(pmac_cmd_queue_t *cmd, int nreceived, unsigned char *buff)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_get_status_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a> *&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nreceived</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>buff</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Service routing for status upate This updates positions and status information. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>cmd</em>&nbsp;</td><td>The command that generated this reply </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>nreceived</em>&nbsp;</td><td>Number of bytes received </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>buff</em>&nbsp;</td><td>The Big Byte Buffer </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01057">1057</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01061"></a>01061                             {
<a name="l01062"></a>01062   <span class="keyword">static</span> <span class="keywordtype">int</span> cnt = 0;
<a name="l01063"></a>01063   <span class="keyword">static</span> <span class="keywordtype">char</span> s[256];
<a name="l01064"></a>01064 
<a name="l01065"></a>01065   <span class="keywordtype">char</span> *sp;
<a name="l01066"></a>01066   <span class="keywordtype">int</span> i, pos;
<a name="l01067"></a>01067   <a class="code" href="structlspmac__motor__struct.html" title="Motor information.">lspmac_motor_t</a> *mp;
<a name="l01068"></a>01068 
<a name="l01069"></a>01069   pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#a7a3e763682bd7f987d07f149e94b3bf8" title="Synchronize reading/writting status buffer.">md2_status_mutex</a>);
<a name="l01070"></a>01070   memcpy( &amp;<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>, buff, <span class="keyword">sizeof</span>(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>));
<a name="l01071"></a>01071   pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#a7a3e763682bd7f987d07f149e94b3bf8" title="Synchronize reading/writting status buffer.">md2_status_mutex</a>);
<a name="l01072"></a>01072 
<a name="l01073"></a>01073 
<a name="l01074"></a>01074   <span class="comment">//</span>
<a name="l01075"></a>01075   <span class="comment">// track the coordinate system moving flags</span>
<a name="l01076"></a>01076   <span class="comment">//</span>
<a name="l01077"></a>01077   pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>);
<a name="l01078"></a>01078   <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#aac82f8e97fa39ea9be7823dd1d308986">moving_flags</a> != <a class="code" href="lspmac_8c.html#a7a32c617c183166308241e270959df56" title="Flag used to implement motor moving condition.">lspmac_moving_flags</a>) {
<a name="l01079"></a>01079     <a class="code" href="lspmac_8c.html#a7a32c617c183166308241e270959df56" title="Flag used to implement motor moving condition.">lspmac_moving_flags</a> = <a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#aac82f8e97fa39ea9be7823dd1d308986">moving_flags</a>;
<a name="l01080"></a>01080     pthread_cond_signal( &amp;<a class="code" href="lspmac_8c.html#a57547d211906c981ef20257eba99f8df" title="Wait for motor(s) to finish moving condition.">lspmac_moving_cond</a>);
<a name="l01081"></a>01081   }
<a name="l01082"></a>01082   pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>);
<a name="l01083"></a>01083 
<a name="l01084"></a>01084 
<a name="l01085"></a>01085   pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l01086"></a>01086 
<a name="l01087"></a>01087   <span class="keywordflow">for</span>( i=0; i&lt;<a class="code" href="lspmac_8c.html#a56260f012c50a591ee7f97e500f16994" title="The number of motors we manage.">lspmac_nmotors</a>; i++) {
<a name="l01088"></a>01088     <a class="code" href="lspmac_8c.html#a9bffbf72495499b505543cd942f665da" title="All our motors.">lspmac_motors</a>[i].<a class="code" href="structlspmac__motor__struct.html#ac62692eb939c04ca35e939d1c3acfe8f" title="function to read the motor status and position">read</a>(&amp;(<a class="code" href="lspmac_8c.html#a9bffbf72495499b505543cd942f665da" title="All our motors.">lspmac_motors</a>[i]));
<a name="l01089"></a>01089   }
<a name="l01090"></a>01090 
<a name="l01091"></a>01091   <span class="comment">// acc11c_1</span>
<a name="l01092"></a>01092   <span class="comment">// mask  bit</span>
<a name="l01093"></a>01093   <span class="comment">// 0x01  0    Air pressure OK</span>
<a name="l01094"></a>01094   <span class="comment">// 0x02  1    Air bearing OK</span>
<a name="l01095"></a>01095   <span class="comment">// 0x04  2    Cryo switch</span>
<a name="l01096"></a>01096   <span class="comment">// 0x08  3</span>
<a name="l01097"></a>01097   <span class="comment">// 0x10  4</span>
<a name="l01098"></a>01098   <span class="comment">// 0x20  5</span>
<a name="l01099"></a>01099   <span class="comment">// 0x40  6    Cryo is back</span>
<a name="l01100"></a>01100 
<a name="l01101"></a>01101   <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a69fc2e30a5de0a11c992d133e7a761cd">acc11c_1</a> &amp; 0x40)
<a name="l01102"></a>01102     mvwprintw( <a class="code" href="pgpmac_8c.html#ae2d7da3afeb756716e6e4ee9cab78f8a" title="shutter, lamp, air, etc status">term_status2</a>, 3, 1, <span class="stringliteral">&quot;%*s&quot;</span>, -8, <span class="stringliteral">&quot;Cryo Out&quot;</span>);
<a name="l01103"></a>01103   <span class="keywordflow">else</span>
<a name="l01104"></a>01104     mvwprintw( <a class="code" href="pgpmac_8c.html#ae2d7da3afeb756716e6e4ee9cab78f8a" title="shutter, lamp, air, etc status">term_status2</a>, 3, 1, <span class="stringliteral">&quot;%*s&quot;</span>, -8, <span class="stringliteral">&quot;Cryo In &quot;</span>);
<a name="l01105"></a>01105 
<a name="l01106"></a>01106   <span class="comment">//</span>
<a name="l01107"></a>01107   <span class="comment">// acc11c_2</span>
<a name="l01108"></a>01108   <span class="comment">// mask  bit</span>
<a name="l01109"></a>01109   <span class="comment">// 0x01  0    Fluor Dector back</span>
<a name="l01110"></a>01110   <span class="comment">// 0x02  1    Sample Detected</span>
<a name="l01111"></a>01111   <span class="comment">// 0x04  2</span>
<a name="l01112"></a>01112   <span class="comment">// 0x08  3</span>
<a name="l01113"></a>01113   <span class="comment">// 0x10  4</span>
<a name="l01114"></a>01114   <span class="comment">// 0x20  5    Etel Ready</span>
<a name="l01115"></a>01115   <span class="comment">// 0x40  6    Etel On</span>
<a name="l01116"></a>01116   <span class="comment">// 0x80  7    Etel Init OK</span>
<a name="l01117"></a>01117 
<a name="l01118"></a>01118   <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ad186f06cb4670b00b8af8264d1da66a4">acc11c_2</a> &amp; 0x01)
<a name="l01119"></a>01119     mvwprintw( <a class="code" href="pgpmac_8c.html#ae2d7da3afeb756716e6e4ee9cab78f8a" title="shutter, lamp, air, etc status">term_status2</a>, 3, 10, <span class="stringliteral">&quot;%*s&quot;</span>, -8, <span class="stringliteral">&quot;Fluor Out&quot;</span>);
<a name="l01120"></a>01120   <span class="keywordflow">else</span>
<a name="l01121"></a>01121     mvwprintw( <a class="code" href="pgpmac_8c.html#ae2d7da3afeb756716e6e4ee9cab78f8a" title="shutter, lamp, air, etc status">term_status2</a>, 3, 10, <span class="stringliteral">&quot;%*s&quot;</span>, -8, <span class="stringliteral">&quot;Fluor In&quot;</span>);
<a name="l01122"></a>01122 
<a name="l01123"></a>01123   <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ab09c1342dc12052b8f5b35f78ef95000">acc11c_5</a> &amp; 0x08)
<a name="l01124"></a>01124     mvwprintw( <a class="code" href="pgpmac_8c.html#ae2d7da3afeb756716e6e4ee9cab78f8a" title="shutter, lamp, air, etc status">term_status2</a>, 4, 1, <span class="stringliteral">&quot;%*s&quot;</span>, -(<a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2), <span class="stringliteral">&quot;Dryer On&quot;</span>);
<a name="l01125"></a>01125   <span class="keywordflow">else</span>
<a name="l01126"></a>01126     mvwprintw( <a class="code" href="pgpmac_8c.html#ae2d7da3afeb756716e6e4ee9cab78f8a" title="shutter, lamp, air, etc status">term_status2</a>, 4, 1, <span class="stringliteral">&quot;%*s&quot;</span>, -(<a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2), <span class="stringliteral">&quot;Dryer Off&quot;</span>);
<a name="l01127"></a>01127 
<a name="l01128"></a>01128   <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ad186f06cb4670b00b8af8264d1da66a4">acc11c_2</a> &amp; 0x02)
<a name="l01129"></a>01129     mvwprintw( <a class="code" href="pgpmac_8c.html#ae2d7da3afeb756716e6e4ee9cab78f8a" title="shutter, lamp, air, etc status">term_status2</a>, 2, 1, <span class="stringliteral">&quot;%*s&quot;</span>, -(<a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2), <span class="stringliteral">&quot;Cap Dectected&quot;</span>);
<a name="l01130"></a>01130   <span class="keywordflow">else</span>
<a name="l01131"></a>01131     mvwprintw( <a class="code" href="pgpmac_8c.html#ae2d7da3afeb756716e6e4ee9cab78f8a" title="shutter, lamp, air, etc status">term_status2</a>, 2, 1, <span class="stringliteral">&quot;%*s&quot;</span>, -(<a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2), <span class="stringliteral">&quot;Cap Not Dectected&quot;</span>);
<a name="l01132"></a>01132   wnoutrefresh( <a class="code" href="pgpmac_8c.html#ae2d7da3afeb756716e6e4ee9cab78f8a" title="shutter, lamp, air, etc status">term_status2</a>);
<a name="l01133"></a>01133 
<a name="l01134"></a>01134 
<a name="l01135"></a>01135   <span class="comment">// acc11c_3</span>
<a name="l01136"></a>01136   <span class="comment">// mask  bit</span>
<a name="l01137"></a>01137   <span class="comment">// 0x01  0    Minikappa OK</span>
<a name="l01138"></a>01138   <span class="comment">// 0x02  1</span>
<a name="l01139"></a>01139   <span class="comment">// 0x04  2</span>
<a name="l01140"></a>01140   <span class="comment">// 0x08  3    Arm Parked</span>
<a name="l01141"></a>01141 
<a name="l01142"></a>01142   <span class="comment">// acc11c_5</span>
<a name="l01143"></a>01143   <span class="comment">// mask  bit</span>
<a name="l01144"></a>01144   <span class="comment">// 0x01  0    Mag Off</span>
<a name="l01145"></a>01145   <span class="comment">// 0x02  1    Condenser Out</span>
<a name="l01146"></a>01146   <span class="comment">// 0x04  2    Cryo Back</span>
<a name="l01147"></a>01147   <span class="comment">// 0x08  3    Dryer On</span>
<a name="l01148"></a>01148   <span class="comment">// 0x10  4    FluoDet Out</span>
<a name="l01149"></a>01149   <span class="comment">// 0x20  5</span>
<a name="l01150"></a>01150   <span class="comment">// 0x40  6    1=SmartMag, 0=Permanent Mag</span>
<a name="l01151"></a>01151   <span class="comment">//</span>
<a name="l01152"></a>01152 
<a name="l01153"></a>01153   <span class="comment">// acc11c_6</span>
<a name="l01154"></a>01154   <span class="comment">// mask   bit</span>
<a name="l01155"></a>01155   <span class="comment">// 0x0080   7   Etel Enable</span>
<a name="l01156"></a>01156   <span class="comment">// 0x0100   8   Fast Shutter Enable</span>
<a name="l01157"></a>01157   <span class="comment">// 0x0200   9   Fast Shutter Manual Enable</span>
<a name="l01158"></a>01158   <span class="comment">// 0x0400  10   Fast Shutter On</span>
<a name="l01159"></a>01159 
<a name="l01160"></a>01160 
<a name="l01161"></a>01161 
<a name="l01162"></a>01162   <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ab09c1342dc12052b8f5b35f78ef95000">acc11c_5</a> &amp; 0x02)
<a name="l01163"></a>01163     mvwprintw( <a class="code" href="pgpmac_8c.html#ae746a6903fb8a4ea216def88eccedc3c" title="shutter, lamp, air, etc status">term_status</a>,  3, 1, <span class="stringliteral">&quot;%*s&quot;</span>, -(<a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2), <span class="stringliteral">&quot;Backlight Up&quot;</span>);
<a name="l01164"></a>01164   <span class="keywordflow">else</span>
<a name="l01165"></a>01165     mvwprintw( <a class="code" href="pgpmac_8c.html#ae746a6903fb8a4ea216def88eccedc3c" title="shutter, lamp, air, etc status">term_status</a>,  3, 1, <span class="stringliteral">&quot;%*s&quot;</span>, -(<a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2), <span class="stringliteral">&quot;Backlight Down&quot;</span>);
<a name="l01166"></a>01166 
<a name="l01167"></a>01167   mvwprintw( <a class="code" href="pgpmac_8c.html#ae746a6903fb8a4ea216def88eccedc3c" title="shutter, lamp, air, etc status">term_status</a>, 4, 1, <span class="stringliteral">&quot;Front: %*d&quot;</span>, <a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2-8, <a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a3be73c48b09190241a2bcb801af5b97c">front_dac</a>);
<a name="l01168"></a>01168   mvwprintw( <a class="code" href="pgpmac_8c.html#ae746a6903fb8a4ea216def88eccedc3c" title="shutter, lamp, air, etc status">term_status</a>, 5, 1, <span class="stringliteral">&quot;Back: %*d&quot;</span>, <a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2-7, <a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a33ce490348c8de255cf49b96469d3d4e">back_dac</a>);
<a name="l01169"></a>01169   mvwprintw( <a class="code" href="pgpmac_8c.html#ae746a6903fb8a4ea216def88eccedc3c" title="shutter, lamp, air, etc status">term_status</a>, 6, 1, <span class="stringliteral">&quot;Piezo: %*d&quot;</span>, <a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2-8, <a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#a031be48adfa016c637d6eae49054c435">scint_piezo</a>);
<a name="l01170"></a>01170   wnoutrefresh( <a class="code" href="pgpmac_8c.html#ae746a6903fb8a4ea216def88eccedc3c" title="shutter, lamp, air, etc status">term_status</a>);
<a name="l01171"></a>01171 
<a name="l01172"></a>01172   wnoutrefresh( <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>);
<a name="l01173"></a>01173   doupdate();
<a name="l01174"></a>01174   pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l01175"></a>01175 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac24bdffa893a9bf7c9cb084fe1417f6f"></a><!-- doxytag: member="lspmac.c::lspmac_GetAllIVars" ref="ac24bdffa893a9bf7c9cb084fe1417f6f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_GetAllIVars </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Request the values of all the I variables. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01204">1204</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01204"></a>01204                           {
<a name="l01205"></a>01205   <span class="keyword">static</span> <span class="keywordtype">char</span> *cmds = <span class="stringliteral">&quot;I0..8191&quot;</span>;
<a name="l01206"></a>01206   <a class="code" href="lspmac_8c.html#a1e472a11df3765763c2fe92dd358bf0c" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#af24ecdc10723dc8fd6320fef416ae514">VR_DOWNLOAD</a>, <a class="code" href="lspmac_8c.html#a772b2ea2ad93989ae4275c79a93525ee">VR_PMAC_SENDLINE</a>, 0, 0, strlen( cmds), cmds, <a class="code" href="lspmac_8c.html#add86d60f9d192563fc9a357dc90f7f75" title="Receive the values of all the I variables Update our Postgresql database with the...">lspmac_GetAllIVarsCB</a>, 0);
<a name="l01207"></a>01207 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="add86d60f9d192563fc9a357dc90f7f75"></a><!-- doxytag: member="lspmac.c::lspmac_GetAllIVarsCB" ref="add86d60f9d192563fc9a357dc90f7f75" args="(pmac_cmd_queue_t *cmd, int nreceived, unsigned char *buff)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_GetAllIVarsCB </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a> *&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nreceived</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>buff</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Receive the values of all the I variables Update our Postgresql database with the results. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>cmd</em>&nbsp;</td><td>The command that gave this response </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>nreceived</em>&nbsp;</td><td>Number of bytes received </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>buff</em>&nbsp;</td><td>The byte buffer </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01187">1187</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01191"></a>01191                             {
<a name="l01192"></a>01192   <span class="keyword">static</span> <span class="keywordtype">char</span> qs[<a class="code" href="pgpmac_8h.html#a3a8ef1b4b5994d6dd12bf74454ea891b" title="Fixed length postgresql query strings. Queries should all be function calls so this...">LS_PG_QUERY_STRING_LENGTH</a>];
<a name="l01193"></a>01193   <span class="keywordtype">char</span> *sp;
<a name="l01194"></a>01194   <span class="keywordtype">int</span> i;
<a name="l01195"></a>01195   <span class="keywordflow">for</span>( i=0, sp=strtok(buff, <span class="stringliteral">&quot;\r&quot;</span>); sp != NULL; sp=strtok( NULL, <span class="stringliteral">&quot;\r&quot;</span>), i++) {
<a name="l01196"></a>01196     snprintf( qs, <span class="keyword">sizeof</span>( qs)-1, <span class="stringliteral">&quot;SELECT pmac.md2_ivar_set( %d, &apos;%s&apos;)&quot;</span>, i, sp);
<a name="l01197"></a>01197     qs[<span class="keyword">sizeof</span>( qs)-1]=0;
<a name="l01198"></a>01198     <a class="code" href="lspg_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( NULL, qs);
<a name="l01199"></a>01199   }
<a name="l01200"></a>01200 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a983d291506dc387ba5d71a97766e8a25"></a><!-- doxytag: member="lspmac.c::lspmac_GetAllMVars" ref="a983d291506dc387ba5d71a97766e8a25" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_GetAllMVars </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Request the values of all the M variables. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01229">1229</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01229"></a>01229                           {
<a name="l01230"></a>01230   <span class="keyword">static</span> <span class="keywordtype">char</span> *cmds = <span class="stringliteral">&quot;M0..8191-&gt;&quot;</span>;
<a name="l01231"></a>01231   <a class="code" href="lspmac_8c.html#a1e472a11df3765763c2fe92dd358bf0c" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#af24ecdc10723dc8fd6320fef416ae514">VR_DOWNLOAD</a>, <a class="code" href="lspmac_8c.html#a772b2ea2ad93989ae4275c79a93525ee">VR_PMAC_SENDLINE</a>, 0, 0, strlen( cmds), cmds, <a class="code" href="lspmac_8c.html#ac585cd63a433c86843eb51b15017c3da" title="Receive the values of all the M variables Update our database with the results.">lspmac_GetAllMVarsCB</a>, 0);
<a name="l01232"></a>01232 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac585cd63a433c86843eb51b15017c3da"></a><!-- doxytag: member="lspmac.c::lspmac_GetAllMVarsCB" ref="ac585cd63a433c86843eb51b15017c3da" args="(pmac_cmd_queue_t *cmd, int nreceived, unsigned char *buff)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_GetAllMVarsCB </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a> *&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nreceived</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>buff</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Receive the values of all the M variables Update our database with the results. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>cmd</em>&nbsp;</td><td>The command that started this </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>nreceived</em>&nbsp;</td><td>Number of bytes received </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>buff</em>&nbsp;</td><td>Our byte buffer </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01212">1212</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01216"></a>01216                             {
<a name="l01217"></a>01217   <span class="keyword">static</span> <span class="keywordtype">char</span> qs[<a class="code" href="pgpmac_8h.html#a3a8ef1b4b5994d6dd12bf74454ea891b" title="Fixed length postgresql query strings. Queries should all be function calls so this...">LS_PG_QUERY_STRING_LENGTH</a>];
<a name="l01218"></a>01218   <span class="keywordtype">char</span> *sp;
<a name="l01219"></a>01219   <span class="keywordtype">int</span> i;
<a name="l01220"></a>01220   <span class="keywordflow">for</span>( i=0, sp=strtok(buff, <span class="stringliteral">&quot;\r&quot;</span>); sp != NULL; sp=strtok( NULL, <span class="stringliteral">&quot;\r&quot;</span>), i++) {
<a name="l01221"></a>01221     snprintf( qs, <span class="keyword">sizeof</span>( qs)-1, <span class="stringliteral">&quot;SELECT pmac.md2_mvar_set( %d, &apos;%s&apos;)&quot;</span>, i, sp);
<a name="l01222"></a>01222     qs[<span class="keyword">sizeof</span>( qs)-1]=0;
<a name="l01223"></a>01223     <a class="code" href="lspg_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( NULL, qs);
<a name="l01224"></a>01224   }
<a name="l01225"></a>01225 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a825ba2feb0108b977c34872e24a6c827"></a><!-- doxytag: member="lspmac.c::lspmac_Getmem" ref="a825ba2feb0108b977c34872e24a6c827" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_Getmem </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Request a block of double buffer memory. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00902">902</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00902"></a>00902                      {
<a name="l00903"></a>00903   <span class="keywordtype">int</span> nbytes;
<a name="l00904"></a>00904   nbytes = (<a class="code" href="lspmac_8c.html#aa0be2f26364c4d12c9c81c10913f0b26" title="next location">dbmemIn</a> + 1400 &gt; <span class="keyword">sizeof</span>( <a class="code" href="lspmac_8c.html#a9da2795d11ccbc3a060c4811770ad04c" title="double buffered memory">dbmem</a>)) ? <span class="keyword">sizeof</span>( <a class="code" href="lspmac_8c.html#a9da2795d11ccbc3a060c4811770ad04c" title="double buffered memory">dbmem</a>) - <a class="code" href="lspmac_8c.html#aa0be2f26364c4d12c9c81c10913f0b26" title="next location">dbmemIn</a> : 1400;
<a name="l00905"></a>00905   <a class="code" href="lspmac_8c.html#a0a56c777b1469ad8c3d29d825a71e300" title="Request a chunk of memory to be returned.">lspmac_SockGetmem</a>( <a class="code" href="lspmac_8c.html#aa0be2f26364c4d12c9c81c10913f0b26" title="next location">dbmemIn</a>, nbytes);
<a name="l00906"></a>00906 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aaa3323f952efd66e63ff864932da5ced"></a><!-- doxytag: member="lspmac.c::lspmac_GetmemReplyCB" ref="aaa3323f952efd66e63ff864932da5ced" args="(pmac_cmd_queue_t *cmd, int nreceived, unsigned char *buff)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_GetmemReplyCB </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a> *&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nreceived</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>buff</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Service a reply to the getmem command. </p>
<p>Not currently used. </p>

<p><p>&lt; [in] Buffer of bytes received </p>
</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>cmd</em>&nbsp;</td><td>Queue item this is a reply to </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>nreceived</em>&nbsp;</td><td>Number of bytes received </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00834">834</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00837"></a>00837                                                {                
<a name="l00839"></a>00839   memcpy( &amp;(<a class="code" href="lspmac_8c.html#a9da2795d11ccbc3a060c4811770ad04c" title="double buffered memory">dbmem</a>[ntohs(cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#aec0ee9a5f6c7e3bc6e4bd98f1bd52783" title="Command parameter 1.">wValue</a>)]), buff, nreceived);
<a name="l00840"></a>00840 
<a name="l00841"></a>00841   <a class="code" href="lspmac_8c.html#aa0be2f26364c4d12c9c81c10913f0b26" title="next location">dbmemIn</a> += nreceived;
<a name="l00842"></a>00842   <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#aa0be2f26364c4d12c9c81c10913f0b26" title="next location">dbmemIn</a> &gt;= <span class="keyword">sizeof</span>( <a class="code" href="lspmac_8c.html#a9da2795d11ccbc3a060c4811770ad04c" title="double buffered memory">dbmem</a>)) {
<a name="l00843"></a>00843     <a class="code" href="lspmac_8c.html#aa0be2f26364c4d12c9c81c10913f0b26" title="next location">dbmemIn</a> = 0;
<a name="l00844"></a>00844   }
<a name="l00845"></a>00845 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac89b615b3ecb738c902c3c090d7c1dc3"></a><!-- doxytag: member="lspmac.c::lspmac_GetShortReplyCB" ref="ac89b615b3ecb738c902c3c090d7c1dc3" args="(pmac_cmd_queue_t *cmd, int nreceived, unsigned char *buff)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_GetShortReplyCB </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a> *&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nreceived</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>buff</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Receive a reply that does not require multiple buffers. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>cmd</em>&nbsp;</td><td>Queue item this is a reply to </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>nreceived</em>&nbsp;</td><td>Number of bytes received </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>buff</em>&nbsp;</td><td>The buffer of bytes </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00779">779</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00783"></a>00783                               {
<a name="l00784"></a>00784 
<a name="l00785"></a>00785   <span class="keywordtype">char</span> *sp;     <span class="comment">// pointer to the command this is a reply to</span>
<a name="l00786"></a>00786 
<a name="l00787"></a>00787   <span class="keywordflow">if</span>( nreceived &lt; 1400)
<a name="l00788"></a>00788     buff[nreceived]=0;
<a name="l00789"></a>00789 
<a name="l00790"></a>00790   sp = (<span class="keywordtype">char</span> *)(cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>);
<a name="l00791"></a>00791 
<a name="l00792"></a>00792   <span class="keywordflow">if</span>( *buff == 0) {
<a name="l00793"></a>00793     pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00794"></a>00794     wprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, <span class="stringliteral">&quot;%s\n&quot;</span>, sp);
<a name="l00795"></a>00795     pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00796"></a>00796   } <span class="keywordflow">else</span> {
<a name="l00797"></a>00797     pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00798"></a>00798     wprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, <span class="stringliteral">&quot;%s: &quot;</span>, sp);
<a name="l00799"></a>00799     pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00800"></a>00800     <a class="code" href="lspmac_8c.html#a8f9f1ad624350095075aa6b51423b02d" title="Replace  with   in null terminated string and print result to terminal.">cleanstr</a>( buff);
<a name="l00801"></a>00801   }
<a name="l00802"></a>00802   wnoutrefresh( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>);
<a name="l00803"></a>00803   wnoutrefresh( <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>);
<a name="l00804"></a>00804   doupdate();
<a name="l00805"></a>00805 
<a name="l00806"></a>00806   memset( cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>, 0, <span class="keyword">sizeof</span>( cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>));
<a name="l00807"></a>00807 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a236945579e57dbb30c0b64f5b9184e9d"></a><!-- doxytag: member="lspmac.c::lspmac_init" ref="a236945579e57dbb30c0b64f5b9184e9d" args="(int ivarsflag, int mvarsflag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_init </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ivarsflag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>mvarsflag</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize this module. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ivarsflag</em>&nbsp;</td><td>Set global flag to harvest i variables </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>mvarsflag</em>&nbsp;</td><td>Set global flag to harvest m variables </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01782">1782</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01785"></a>01785                    {
<a name="l01786"></a>01786   <a class="code" href="structmd2StatusStruct.html" title="The block of memory retrieved in a status request.">md2_status_t</a> *p;
<a name="l01787"></a>01787 
<a name="l01788"></a>01788   <span class="comment">// Set our global harvest flags</span>
<a name="l01789"></a>01789   <a class="code" href="lspmac_8c.html#a07b7b8254772075e6a4ced500b589c36" title="flag set at initialization to send i vars to db">getivars</a> = ivarsflag;
<a name="l01790"></a>01790   <a class="code" href="lspmac_8c.html#a50e9c0a06654fd81b3446a6e54ff12c3" title="flag set at initialization to send m vars to db">getmvars</a> = mvarsflag;
<a name="l01791"></a>01791 
<a name="l01792"></a>01792   <span class="comment">// All important status mutex</span>
<a name="l01793"></a>01793   pthread_mutex_init( &amp;<a class="code" href="lspmac_8c.html#a7a3e763682bd7f987d07f149e94b3bf8" title="Synchronize reading/writting status buffer.">md2_status_mutex</a>, NULL);
<a name="l01794"></a>01794 
<a name="l01795"></a>01795   <span class="comment">//</span>
<a name="l01796"></a>01796   <span class="comment">// Initialize the motor objects</span>
<a name="l01797"></a>01797   <span class="comment">//</span>
<a name="l01798"></a>01798 
<a name="l01799"></a>01799   p = &amp;<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>;
<a name="l01800"></a>01800 
<a name="l01801"></a>01801   <a class="code" href="lspmac_8c.html#a8237e646ce032a840637a4ef7bff49b9" title="MD2 omega axis (the air bearing).">omega</a>  = <a class="code" href="lspmac_8c.html#a45becc46f46e5aea14a388d3ec1b8b13" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a9bffbf72495499b505543cd942f665da" title="All our motors.">lspmac_motors</a>[ 0]),  1, 0, 0, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a6ce303bec89082cae1e9b1fddf6b6c10">omega_act_pos</a>,     &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#af6cf3cd65b9ef205685a0d970f168907">omega_status_1</a>,     &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a8577c9df7b663b548b2759ac3db721cd">omega_status_2</a>,     <span class="stringliteral">&quot;Omega   #1 &amp;1 X&quot;</span>, <span class="stringliteral">&quot;omega&quot;</span>,       <a class="code" href="lspmac_8c.html#aa4ea5a4c387ef167702c58eaddcb4151" title="Move method for normal stepper and servo motor objects.">lspmac_moveabs_queue</a>);
<a name="l01802"></a>01802   <a class="code" href="lspmac_8c.html#a6cb218bdccfe5a93471c161f15a15cab" title="Alignment stage X.">alignx</a> = <a class="code" href="lspmac_8c.html#a45becc46f46e5aea14a388d3ec1b8b13" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a9bffbf72495499b505543cd942f665da" title="All our motors.">lspmac_motors</a>[ 1]),  2, 0, 1, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a9653a75bc0b66c5f86d8b0206dc39b4f">alignx_act_pos</a>,    &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a56accf8cb00c59bff87ed75df7dafbbe">alignx_status_1</a>,    &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a2feb35ceab8129fd2cc34d1104af8b8f">alignx_status_2</a>,    <span class="stringliteral">&quot;Align X #2 &amp;3 X&quot;</span>, <span class="stringliteral">&quot;align.x&quot;</span>,     <a class="code" href="lspmac_8c.html#aa4ea5a4c387ef167702c58eaddcb4151" title="Move method for normal stepper and servo motor objects.">lspmac_moveabs_queue</a>);
<a name="l01803"></a>01803   <a class="code" href="lspmac_8c.html#a737c246c3948e644a18d191a931e1acd" title="Alignment stage Y.">aligny</a> = <a class="code" href="lspmac_8c.html#a45becc46f46e5aea14a388d3ec1b8b13" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a9bffbf72495499b505543cd942f665da" title="All our motors.">lspmac_motors</a>[ 2]),  3, 0, 2, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a0d40a01d2aa93c443526e826440f77fc">aligny_act_pos</a>,    &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a2f2a11fe2fc7a446323def2be465185a">aligny_status_1</a>,    &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a1f98d8b9831e32d77129f9b0f1d7d255">aligny_status_2</a>,    <span class="stringliteral">&quot;Align Y #3 &amp;3 Y&quot;</span>, <span class="stringliteral">&quot;align.y&quot;</span>,     <a class="code" href="lspmac_8c.html#aa4ea5a4c387ef167702c58eaddcb4151" title="Move method for normal stepper and servo motor objects.">lspmac_moveabs_queue</a>);
<a name="l01804"></a>01804   <a class="code" href="lspmac_8c.html#ae7642b1da0f7c7f8448104c691d40a12" title="Alignment stage X.">alignz</a> = <a class="code" href="lspmac_8c.html#a45becc46f46e5aea14a388d3ec1b8b13" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a9bffbf72495499b505543cd942f665da" title="All our motors.">lspmac_motors</a>[ 3]),  4, 0, 3, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a480f892fe91b05b2980fb00064807e2b">alignz_act_pos</a>,    &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#aadbfac5709de57e449a37e2937d6ade7">alignz_status_1</a>,    &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ac378da16eeaab2bc47f3f8f88f7411ed">alignz_status_2</a>,    <span class="stringliteral">&quot;Align Z #4 &amp;3 Z&quot;</span>, <span class="stringliteral">&quot;align.z&quot;</span>,     <a class="code" href="lspmac_8c.html#aa4ea5a4c387ef167702c58eaddcb4151" title="Move method for normal stepper and servo motor objects.">lspmac_moveabs_queue</a>);
<a name="l01805"></a>01805   <a class="code" href="lspmac_8c.html#aa90d2363b744acbd4d45133b7a716d8f" title="Polaroid analyzer motor.">anal</a>   = <a class="code" href="lspmac_8c.html#a45becc46f46e5aea14a388d3ec1b8b13" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a9bffbf72495499b505543cd942f665da" title="All our motors.">lspmac_motors</a>[ 4]),  5, 0, 4, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a49d1151b0e819646587be0ca9c9d612a">analyzer_act_pos</a>,  &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ab876b484f55bcce576fcd89dcc3f7267">analyzer_status_1</a>,  &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a4f88bb778e4e18f1fbf7672ac11e7433">analyzer_status_2</a>,  <span class="stringliteral">&quot;Anal    #5&quot;</span>,      <span class="stringliteral">&quot;lightPolar&quot;</span>,  <a class="code" href="lspmac_8c.html#aa4ea5a4c387ef167702c58eaddcb4151" title="Move method for normal stepper and servo motor objects.">lspmac_moveabs_queue</a>);
<a name="l01806"></a>01806   <a class="code" href="lspmac_8c.html#ad53a42cfaa04eff0336a44c8c9986333" title="Optical zoom.">zoom</a>   = <a class="code" href="lspmac_8c.html#a45becc46f46e5aea14a388d3ec1b8b13" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a9bffbf72495499b505543cd942f665da" title="All our motors.">lspmac_motors</a>[ 5]),  6, 1, 0, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a920b80e9f5f08aedac3ad541d5ffc8ae">zoom_act_pos</a>,      &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#af28e978b761dc07eefed3971547cfd4d">zoom_status_1</a>,      &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a34e4200315a083deb8a970e21bbbe277">zoom_status_2</a>,      <span class="stringliteral">&quot;Zoom    #6 &amp;4 Z&quot;</span>, <span class="stringliteral">&quot;zoom&quot;</span>,        <a class="code" href="lspmac_8c.html#ad6ae1e37afd118f24ab1c6878da53878" title="Move method for the zoom motor.">lspmac_movezoom_queue</a>);
<a name="l01807"></a>01807   <a class="code" href="lspmac_8c.html#a139200ddaa9856a7ffcec0e6cbaa8f1b" title="Aperture Y.">apery</a>  = <a class="code" href="lspmac_8c.html#a45becc46f46e5aea14a388d3ec1b8b13" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a9bffbf72495499b505543cd942f665da" title="All our motors.">lspmac_motors</a>[ 6]),  7, 1, 1, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a2a434d2b57dbb669de0765486a1516ff">aperturey_act_pos</a>, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a2ef953eaddf7058bf4276585e6ff066b">aperturey_status_1</a>, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a0a7738f13a0fa80626cafc2299b104b4">aperturey_status_2</a>, <span class="stringliteral">&quot;Aper Y  #7 &amp;5 Y&quot;</span>, <span class="stringliteral">&quot;appy&quot;</span>,        <a class="code" href="lspmac_8c.html#aa4ea5a4c387ef167702c58eaddcb4151" title="Move method for normal stepper and servo motor objects.">lspmac_moveabs_queue</a>);
<a name="l01808"></a>01808   <a class="code" href="lspmac_8c.html#ab93bd6ee850b285ca3a95e64d15e9477" title="Aperture Z.">aperz</a>  = <a class="code" href="lspmac_8c.html#a45becc46f46e5aea14a388d3ec1b8b13" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a9bffbf72495499b505543cd942f665da" title="All our motors.">lspmac_motors</a>[ 7]),  8, 1, 2, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a62d584ce23cfd9aa626d3c03649b455c">aperturez_act_pos</a>, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a27880dd795e1ba4fea4870c64ee3aa84">aperturez_status_1</a>, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ae407a99e428d9f4a7444a02c8bc3414e">aperturez_status_2</a>, <span class="stringliteral">&quot;Aper Z  #8 &amp;5 Z&quot;</span>, <span class="stringliteral">&quot;appz&quot;</span>,        <a class="code" href="lspmac_8c.html#aa4ea5a4c387ef167702c58eaddcb4151" title="Move method for normal stepper and servo motor objects.">lspmac_moveabs_queue</a>);
<a name="l01809"></a>01809   <a class="code" href="lspmac_8c.html#a51358daaea8b5236f08414877d8af6c2" title="Capillary Y.">capy</a>   = <a class="code" href="lspmac_8c.html#a45becc46f46e5aea14a388d3ec1b8b13" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a9bffbf72495499b505543cd942f665da" title="All our motors.">lspmac_motors</a>[ 8]),  9, 1, 3, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ae25122a6db146501b51609b9cb59b044">capy_act_pos</a>,      &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a7f4e945e80b1980b9e69366a69ad79cc">capy_status_1</a>,      &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a5d7c10d9a16ebcc53ac4a0770ab2ef62">capy_status_2</a>,      <span class="stringliteral">&quot;Cap Y   #9 &amp;5 U&quot;</span>, <span class="stringliteral">&quot;capy&quot;</span>,        <a class="code" href="lspmac_8c.html#aa4ea5a4c387ef167702c58eaddcb4151" title="Move method for normal stepper and servo motor objects.">lspmac_moveabs_queue</a>);
<a name="l01810"></a>01810   <a class="code" href="lspmac_8c.html#aa45f268d0af9f3d465acfab128919718" title="Capillary Z.">capz</a>   = <a class="code" href="lspmac_8c.html#a45becc46f46e5aea14a388d3ec1b8b13" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a9bffbf72495499b505543cd942f665da" title="All our motors.">lspmac_motors</a>[ 9]), 10, 1, 4, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a257c04efac3a33d5d34b21d64c6f1266">capz_act_pos</a>,      &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a719db4477f35331eaa8b7b44150e88a2">capz_status_1</a>,      &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a3abb998bb89433aed16121d0dae6275a">capz_status_2</a>,      <span class="stringliteral">&quot;Cap Z  #10 &amp;5 V&quot;</span>, <span class="stringliteral">&quot;capz&quot;</span>,        <a class="code" href="lspmac_8c.html#aa4ea5a4c387ef167702c58eaddcb4151" title="Move method for normal stepper and servo motor objects.">lspmac_moveabs_queue</a>);
<a name="l01811"></a>01811   <a class="code" href="lspmac_8c.html#ac0eeaffa0996271d8a38344a470d13d7" title="Scintillator Z.">scinz</a>  = <a class="code" href="lspmac_8c.html#a45becc46f46e5aea14a388d3ec1b8b13" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a9bffbf72495499b505543cd942f665da" title="All our motors.">lspmac_motors</a>[10]), 11, 2, 0, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a1c146fc792c4285eed5b2c446c214f98">scint_act_pos</a>,     &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a1723870357f428ac5c2758a2c9a475c7">scint_status_1</a>,     &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a4e5bc72e2f4007370f1c29ea272c952f">scint_status_2</a>,     <span class="stringliteral">&quot;Scin Z #11 &amp;5 W&quot;</span>, <span class="stringliteral">&quot;scint&quot;</span>,       <a class="code" href="lspmac_8c.html#aa4ea5a4c387ef167702c58eaddcb4151" title="Move method for normal stepper and servo motor objects.">lspmac_moveabs_queue</a>);
<a name="l01812"></a>01812   <a class="code" href="lspmac_8c.html#ac940d950d9efeaf3f0ae67e9bf331188" title="Centering Table X.">cenx</a>   = <a class="code" href="lspmac_8c.html#a45becc46f46e5aea14a388d3ec1b8b13" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a9bffbf72495499b505543cd942f665da" title="All our motors.">lspmac_motors</a>[11]), 17, 2, 1, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ae7924b6e91e1de82f6f7910cb3a9c9bd">centerx_act_pos</a>,   &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#aa619cdbd7a563408c6b825ddc4f74ebb">centerx_status_1</a>,   &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ae4fad6debe138ed7815d463e83f8d0f6">centerx_status_2</a>,   <span class="stringliteral">&quot;Cen X  #17 &amp;2 X&quot;</span>, <span class="stringliteral">&quot;centering.x&quot;</span>, <a class="code" href="lspmac_8c.html#aa4ea5a4c387ef167702c58eaddcb4151" title="Move method for normal stepper and servo motor objects.">lspmac_moveabs_queue</a>);
<a name="l01813"></a>01813   <a class="code" href="lspmac_8c.html#aaed18e738ba7bfb6c771a44f5d7ea827" title="Centering Table Y.">ceny</a>   = <a class="code" href="lspmac_8c.html#a45becc46f46e5aea14a388d3ec1b8b13" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a9bffbf72495499b505543cd942f665da" title="All our motors.">lspmac_motors</a>[12]), 18, 2, 2, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a6be71a92a599d490ca808af8c7e7faa0">centery_act_pos</a>,   &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a57f65ebe28ef88f1c632d9f35d9167eb">centery_status_1</a>,   &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#aa242098c185cce8f852cd6e081ef0b1d">centery_status_2</a>,   <span class="stringliteral">&quot;Cen Y  #18 &amp;2 Y&quot;</span>, <span class="stringliteral">&quot;centering.y&quot;</span>, <a class="code" href="lspmac_8c.html#aa4ea5a4c387ef167702c58eaddcb4151" title="Move method for normal stepper and servo motor objects.">lspmac_moveabs_queue</a>);
<a name="l01814"></a>01814   <a class="code" href="lspmac_8c.html#a0be79ccb7ebf3a665248fd856112b9fd" title="Kappa.">kappa</a>  = <a class="code" href="lspmac_8c.html#a45becc46f46e5aea14a388d3ec1b8b13" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a9bffbf72495499b505543cd942f665da" title="All our motors.">lspmac_motors</a>[13]), 19, 2, 3, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ac384fb7073387dd5dcb2e85a00ec8a77">kappa_act_pos</a>,     &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ab152694bc32d37c1d180f55e8d282020">kappa_status_1</a>,     &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#af6891f5f8dcfc62668f64c583042c6bc">kappa_status_2</a>,     <span class="stringliteral">&quot;Kappa  #19 &amp;7 X&quot;</span>, <span class="stringliteral">&quot;kappa&quot;</span>,       <a class="code" href="lspmac_8c.html#aa4ea5a4c387ef167702c58eaddcb4151" title="Move method for normal stepper and servo motor objects.">lspmac_moveabs_queue</a>);
<a name="l01815"></a>01815   <a class="code" href="lspmac_8c.html#ac8070dc568ad974a3db42b51eca828cc" title="Phi (not data collection axis).">phi</a>    = <a class="code" href="lspmac_8c.html#a45becc46f46e5aea14a388d3ec1b8b13" title="Initialize a pmac stepper or servo motor.">lspmac_motor_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a9bffbf72495499b505543cd942f665da" title="All our motors.">lspmac_motors</a>[14]), 20, 2, 4, &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a4de22995a72ff6e72a1a9ccab6d00620">phi_act_pos</a>,       &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#ad8b8fd90ffff43016e2adaab5ccbfa02">phi_status_1</a>,       &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a0e6cea4c32cb34e602b9ac3d21259219">phi_status_2</a>,       <span class="stringliteral">&quot;Phi    #20 &amp;7 Y&quot;</span>, <span class="stringliteral">&quot;phi&quot;</span>,         <a class="code" href="lspmac_8c.html#aa4ea5a4c387ef167702c58eaddcb4151" title="Move method for normal stepper and servo motor objects.">lspmac_moveabs_queue</a>);
<a name="l01816"></a>01816 
<a name="l01817"></a>01817   <a class="code" href="lspmac_8c.html#a26dec4623af9beed912b8e7e6f99822c" title="Fast shutter.">fshut</a>  = <a class="code" href="lspmac_8c.html#a40aa4aeb5c799a6a3a089137da4fd6a8" title="Initalize the fast shutter motor.">lspmac_fshut_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a9bffbf72495499b505543cd942f665da" title="All our motors.">lspmac_motors</a>[15]));
<a name="l01818"></a>01818   <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a> = <a class="code" href="lspmac_8c.html#a6d88f6db90e4a7219a237b183d10a27d" title="Initialize DAC motor Note that some motors require further initialization from a...">lspmac_dac_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a9bffbf72495499b505543cd942f665da" title="All our motors.">lspmac_motors</a>[16]), &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a3be73c48b09190241a2bcb801af5b97c">front_dac</a>,   160.0, <span class="stringliteral">&quot;M1200&quot;</span>, <span class="stringliteral">&quot;frontLight.intensity&quot;</span>);
<a name="l01819"></a>01819   <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a> = <a class="code" href="lspmac_8c.html#a6d88f6db90e4a7219a237b183d10a27d" title="Initialize DAC motor Note that some motors require further initialization from a...">lspmac_dac_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a9bffbf72495499b505543cd942f665da" title="All our motors.">lspmac_motors</a>[17]), &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a33ce490348c8de255cf49b96469d3d4e">back_dac</a>,    160.0, <span class="stringliteral">&quot;M1201&quot;</span>, <span class="stringliteral">&quot;backLight.intensity&quot;</span>);
<a name="l01820"></a>01820   <a class="code" href="lspmac_8c.html#a8a3ca6fcf5e24dcc26170736843e53b2" title="Scintillator Piezo DAC.">fscint</a> = <a class="code" href="lspmac_8c.html#a6d88f6db90e4a7219a237b183d10a27d" title="Initialize DAC motor Note that some motors require further initialization from a...">lspmac_dac_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a9bffbf72495499b505543cd942f665da" title="All our motors.">lspmac_motors</a>[18]), &amp;p-&gt;<a class="code" href="structmd2StatusStruct.html#a031be48adfa016c637d6eae49054c435">scint_piezo</a>, 320.0, <span class="stringliteral">&quot;M1203&quot;</span>, <span class="stringliteral">&quot;scint.focus&quot;</span>);
<a name="l01821"></a>01821 
<a name="l01822"></a>01822   <a class="code" href="lspmac_8c.html#af813a2eff0b7efa4c70633559054e84c" title="Back Light Up/Down actuator.">blight_ud</a> = <a class="code" href="lspmac_8c.html#a50e22adfb4d14499c1f5647458ca2ad9" title="Initialize binary i/o motor.">lspmac_bio_init</a>( &amp;(<a class="code" href="lspmac_8c.html#a9bffbf72495499b505543cd942f665da" title="All our motors.">lspmac_motors</a>[19]), <span class="stringliteral">&quot;backLight&quot;</span>, <span class="stringliteral">&quot;M1101=%d&quot;</span>, &amp;(<a class="code" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492" title="Buffer for MD2 Status.">md2_status</a>.<a class="code" href="structmd2StatusStruct.html#ab09c1342dc12052b8f5b35f78ef95000">acc11c_5</a>), 0x02);
<a name="l01823"></a>01823 
<a name="l01824"></a>01824 
<a name="l01825"></a>01825 
<a name="l01826"></a>01826 
<a name="l01827"></a>01827   <span class="comment">//</span>
<a name="l01828"></a>01828   <span class="comment">// Initialize several commands that get called, perhaps, alot</span>
<a name="l01829"></a>01829   <span class="comment">//</span>
<a name="l01830"></a>01830   <a class="code" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a6a155eb3ae546dd29369c4a33ddb3310" title="VR_UPLOAD or VR_DOWNLOAD.">RequestType</a> = <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>;
<a name="l01831"></a>01831   <a class="code" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a0dc566e7edbb226f1a4ea443d93d56e2" title="The command to run (VR_PMAC_GETMEM, etc).">Request</a>     = <a class="code" href="lspmac_8c.html#aad3c7b4a9403e56c09eceadcf21252c0">VR_PMAC_READREADY</a>;
<a name="l01832"></a>01832   <a class="code" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#aec0ee9a5f6c7e3bc6e4bd98f1bd52783" title="Command parameter 1.">wValue</a>      = 0;
<a name="l01833"></a>01833   <a class="code" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a92f5a374e87d4f496b64b4888850d6e6" title="Command parameter 2.">wIndex</a>      = 0;
<a name="l01834"></a>01834   <a class="code" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#af5df25ff13ca30fa33719d0df1ab7e97" title="Number of bytes in bData.">wLength</a>     = htons(2);
<a name="l01835"></a>01835   memset( <a class="code" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>));
<a name="l01836"></a>01836 
<a name="l01837"></a>01837   <a class="code" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a6a155eb3ae546dd29369c4a33ddb3310" title="VR_UPLOAD or VR_DOWNLOAD.">RequestType</a> = <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>;
<a name="l01838"></a>01838   <a class="code" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a0dc566e7edbb226f1a4ea443d93d56e2" title="The command to run (VR_PMAC_GETMEM, etc).">Request</a>     = <a class="code" href="lspmac_8c.html#a50e444b5ceb6d62a1be43c88c55c549c">VR_PMAC_GETBUFFER</a>;
<a name="l01839"></a>01839   <a class="code" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a>.<a class="code" href="structtagEthernetCmd.html#aec0ee9a5f6c7e3bc6e4bd98f1bd52783" title="Command parameter 1.">wValue</a>      = 0;
<a name="l01840"></a>01840   <a class="code" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a92f5a374e87d4f496b64b4888850d6e6" title="Command parameter 2.">wIndex</a>      = 0;
<a name="l01841"></a>01841   <a class="code" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a>.<a class="code" href="structtagEthernetCmd.html#af5df25ff13ca30fa33719d0df1ab7e97" title="Number of bytes in bData.">wLength</a>     = htons(1400);
<a name="l01842"></a>01842   memset( <a class="code" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>));
<a name="l01843"></a>01843 
<a name="l01844"></a>01844   <a class="code" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81" title="commands to send out &amp;quot;readready&amp;quot;, &amp;quot;getbuffer&amp;quot;, controlresponse...">cr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a6a155eb3ae546dd29369c4a33ddb3310" title="VR_UPLOAD or VR_DOWNLOAD.">RequestType</a> = <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>;
<a name="l01845"></a>01845   <a class="code" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81" title="commands to send out &amp;quot;readready&amp;quot;, &amp;quot;getbuffer&amp;quot;, controlresponse...">cr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a0dc566e7edbb226f1a4ea443d93d56e2" title="The command to run (VR_PMAC_GETMEM, etc).">Request</a>     = <a class="code" href="lspmac_8c.html#a8f4ce4666a23a3fb153d680bd1cb6556">VR_CTRL_RESPONSE</a>;
<a name="l01846"></a>01846   <a class="code" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81" title="commands to send out &amp;quot;readready&amp;quot;, &amp;quot;getbuffer&amp;quot;, controlresponse...">cr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#aec0ee9a5f6c7e3bc6e4bd98f1bd52783" title="Command parameter 1.">wValue</a>      = 0;
<a name="l01847"></a>01847   <a class="code" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81" title="commands to send out &amp;quot;readready&amp;quot;, &amp;quot;getbuffer&amp;quot;, controlresponse...">cr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a92f5a374e87d4f496b64b4888850d6e6" title="Command parameter 2.">wIndex</a>      = 0;
<a name="l01848"></a>01848   <a class="code" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81" title="commands to send out &amp;quot;readready&amp;quot;, &amp;quot;getbuffer&amp;quot;, controlresponse...">cr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#af5df25ff13ca30fa33719d0df1ab7e97" title="Number of bytes in bData.">wLength</a>     = htons(1400);
<a name="l01849"></a>01849   memset( <a class="code" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81" title="commands to send out &amp;quot;readready&amp;quot;, &amp;quot;getbuffer&amp;quot;, controlresponse...">cr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81" title="commands to send out &amp;quot;readready&amp;quot;, &amp;quot;getbuffer&amp;quot;, controlresponse...">cr_cmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>));
<a name="l01850"></a>01850 
<a name="l01851"></a>01851   <span class="comment">//</span>
<a name="l01852"></a>01852   <span class="comment">// Initialize some mutexs and conditions</span>
<a name="l01853"></a>01853   <span class="comment">//</span>
<a name="l01854"></a>01854 
<a name="l01855"></a>01855   pthread_mutex_init( &amp;<a class="code" href="lspmac_8c.html#acc1bb77b9bcbc4d970f841a41fd274b3" title="manage access to the pmac command queue">pmac_queue_mutex</a>, NULL);
<a name="l01856"></a>01856   pthread_cond_init(  &amp;<a class="code" href="lspmac_8c.html#a8a25bd9c593c6985107f90f999ce0b08" title="wait for a command to be sent to PMAC before continuing">pmac_queue_cond</a>, NULL);
<a name="l01857"></a>01857 
<a name="l01858"></a>01858   <a class="code" href="lspmac_8c.html#a112158e0cd50449a440ac55c7af7bea2" title="State of the shutter, used to detect changes.">lspmac_shutter_state</a> = 0;                             <span class="comment">// assume the shutter is now closed: not a big deal if we are wrong</span>
<a name="l01859"></a>01859   pthread_mutex_init( &amp;<a class="code" href="lspmac_8c.html#a1b78a13c654409333569815e1c109d38" title="Coordinates threads reading shutter status.">lspmac_shutter_mutex</a>, NULL);
<a name="l01860"></a>01860   pthread_cond_init(  &amp;<a class="code" href="lspmac_8c.html#afbd51c2cefcee87afe994c9e9f372241" title="Allows waiting for the shutter status to change.">lspmac_shutter_cond</a>, NULL);
<a name="l01861"></a>01861   <a class="code" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba" title="our poll structure">pmacfd</a>.fd = -1;
<a name="l01862"></a>01862 
<a name="l01863"></a>01863   pthread_mutex_init( &amp;<a class="code" href="lspmac_8c.html#a85679cac947e199c88794f8e5a12bf5f" title="Coordinate moving motors between threads.">lspmac_moving_mutex</a>, NULL);
<a name="l01864"></a>01864   pthread_cond_init(  &amp;<a class="code" href="lspmac_8c.html#a57547d211906c981ef20257eba99f8df" title="Wait for motor(s) to finish moving condition.">lspmac_moving_cond</a>, NULL);
<a name="l01865"></a>01865 
<a name="l01866"></a>01866 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a55b882be15d56a2a777f2b1f92901b7d"></a><!-- doxytag: member="lspmac.c::lspmac_lut" ref="a55b882be15d56a2a777f2b1f92901b7d" args="(int nlut, double *lut, double x)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double lspmac_lut </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nlut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&nbsp;</td>
          <td class="paramname"> <em>lut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>x</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Look up table support for motor positions (think x=zoom, y=light intensity) use a lookup table to find the "counts" to move the motor to the requested position The look up table is a simple one dimensional array with the x values as even indicies and the y values as odd indices. </p>
<p>Returns: y value </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>nlut</em>&nbsp;</td><td>number of entries in lookup table </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>lut</em>&nbsp;</td><td>The lookup table: even indicies are the x values, odd are the y's </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>x</em>&nbsp;</td><td>The x value we are looking up. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01401">1401</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01403"></a>01403                                                                   : even indicies are the x values, odd are the y<span class="stringliteral">&apos;s     */</span>
<a name="l01404"></a>01404 <span class="stringliteral">                  double x              /**&lt; [in] The x value we are looking up.                                        */</span>
<a name="l01405"></a>01405 <span class="stringliteral">                  ) {</span>
<a name="l01406"></a>01406 <span class="stringliteral">  int i, foundone;</span>
<a name="l01407"></a>01407 <span class="stringliteral">  double m;</span>
<a name="l01408"></a>01408 <span class="stringliteral">  double y1, y2, x1, x2, y;</span>
<a name="l01409"></a>01409 <span class="stringliteral"></span>
<a name="l01410"></a>01410 <span class="stringliteral"></span>
<a name="l01411"></a>01411 <span class="stringliteral">  foundone = 0;</span>
<a name="l01412"></a>01412 <span class="stringliteral">  if( lut != NULL &amp;&amp; nlut &gt; 1) {</span>
<a name="l01413"></a>01413 <span class="stringliteral"></span>
<a name="l01414"></a>01414 <span class="stringliteral">    for( i=0; i &lt; 2*nlut; i += 2) {</span>
<a name="l01415"></a>01415 <span class="stringliteral"></span>
<a name="l01416"></a>01416 <span class="stringliteral">      x1 = lut[i];</span>
<a name="l01417"></a>01417 <span class="stringliteral">      y1 = lut[i+1];</span>
<a name="l01418"></a>01418 <span class="stringliteral">      if( i &lt; 2*nlut - 2) {</span>
<a name="l01419"></a>01419 <span class="stringliteral">        x2 = lut[i+2];</span>
<a name="l01420"></a>01420 <span class="stringliteral">        y2 = lut[i+3];</span>
<a name="l01421"></a>01421 <span class="stringliteral">      }</span>
<a name="l01422"></a>01422 <span class="stringliteral"></span>
<a name="l01423"></a>01423 <span class="stringliteral">      //</span>
<a name="l01424"></a>01424 <span class="stringliteral">      // First one too big?  Use the y value of the first element</span>
<a name="l01425"></a>01425 <span class="stringliteral">      //</span>
<a name="l01426"></a>01426 <span class="stringliteral">      if( i == 0 &amp;&amp; x1 &gt; x) {</span>
<a name="l01427"></a>01427 <span class="stringliteral">        y = y1;</span>
<a name="l01428"></a>01428 <span class="stringliteral">        foundone = 1;</span>
<a name="l01429"></a>01429 <span class="stringliteral">        break;</span>
<a name="l01430"></a>01430 <span class="stringliteral">      }</span>
<a name="l01431"></a>01431 <span class="stringliteral"></span>
<a name="l01432"></a>01432 <span class="stringliteral">      //</span>
<a name="l01433"></a>01433 <span class="stringliteral">      // Look for equality</span>
<a name="l01434"></a>01434 <span class="stringliteral">      //</span>
<a name="l01435"></a>01435 <span class="stringliteral">      if( x1 == x) {</span>
<a name="l01436"></a>01436 <span class="stringliteral">        y = y1;</span>
<a name="l01437"></a>01437 <span class="stringliteral">        foundone = 1;</span>
<a name="l01438"></a>01438 <span class="stringliteral">        break;</span>
<a name="l01439"></a>01439 <span class="stringliteral">      }</span>
<a name="l01440"></a>01440 <span class="stringliteral"></span>
<a name="l01441"></a>01441 <span class="stringliteral">      //</span>
<a name="l01442"></a>01442 <span class="stringliteral">      // Maybe interpolate</span>
<a name="l01443"></a>01443 <span class="stringliteral">      //</span>
<a name="l01444"></a>01444 <span class="stringliteral">      if( (i &lt; 2*nlut-2) &amp;&amp; x &lt; x2) {</span>
<a name="l01445"></a>01445 <span class="stringliteral">        m = (y2 - y1) / (x2 - x1);</span>
<a name="l01446"></a>01446 <span class="stringliteral">        y = m*(x - x1) + y1;</span>
<a name="l01447"></a>01447 <span class="stringliteral">        foundone = 1;</span>
<a name="l01448"></a>01448 <span class="stringliteral">        break;</span>
<a name="l01449"></a>01449 <span class="stringliteral">      }</span>
<a name="l01450"></a>01450 <span class="stringliteral">    }</span>
<a name="l01451"></a>01451 <span class="stringliteral">    if( foundone == 0) {</span>
<a name="l01452"></a>01452 <span class="stringliteral">      // must be bigger than the last entry</span>
<a name="l01453"></a>01453 <span class="stringliteral">      //</span>
<a name="l01454"></a>01454 <span class="stringliteral">      //</span>
<a name="l01455"></a>01455 <span class="stringliteral">      y = lut[2*(nlut-1) + 1];</span>
<a name="l01456"></a>01456 <span class="stringliteral">    }</span>
<a name="l01457"></a>01457 <span class="stringliteral">    return y;</span>
<a name="l01458"></a>01458 <span class="stringliteral">  }</span>
<a name="l01459"></a>01459 <span class="stringliteral">}</span>
</pre></div></p>

</div>
</div>
<a class="anchor" id="a45becc46f46e5aea14a388d3ec1b8b13"></a><!-- doxytag: member="lspmac.c::lspmac_motor_init" ref="a45becc46f46e5aea14a388d3ec1b8b13" args="(lspmac_motor_t *d, int motor_number, int wy, int wx, int *posp, int *stat1p, int *stat2p, char *wtitle, char *name, void(*moveAbs)(lspmac_motor_t *, double))" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a>* lspmac_motor_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td>
          <td class="paramname"> <em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>motor_number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>wy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>wx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>posp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>stat1p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>stat2p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>wtitle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(<a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *, double)&nbsp;</td>
          <td class="paramname"> <em>moveAbs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize a pmac stepper or servo motor. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>d</em>&nbsp;</td><td>An uninitialize motor object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>motor_number</em>&nbsp;</td><td>The PMAC motor number </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>wy</em>&nbsp;</td><td>Curses status window row index </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>wx</em>&nbsp;</td><td>Curses status window column index </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>posp</em>&nbsp;</td><td>Pointer to position status </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>stat1p</em>&nbsp;</td><td>Pointer to 1st status word </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>stat2p</em>&nbsp;</td><td>Pointer to 2nd status word </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>wtitle</em>&nbsp;</td><td>Title for this motor (to display) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>name</em>&nbsp;</td><td>Name of this motor (to match database) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>moveAbs</em>&nbsp;</td><td>Method to use to move this motor </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01661">1661</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01672"></a>01672                                     {
<a name="l01673"></a>01673   <a class="code" href="lspmac_8c.html#a56260f012c50a591ee7f97e500f16994" title="The number of motors we manage.">lspmac_nmotors</a>++;
<a name="l01674"></a>01674 
<a name="l01675"></a>01675   pthread_mutex_init( &amp;(d-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>), NULL);
<a name="l01676"></a>01676   pthread_cond_init(  &amp;(d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa0ea4108b8fed5b41ff91ca7266f3d84">cond</a>), NULL);
<a name="l01677"></a>01677 
<a name="l01678"></a>01678   d-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a> = strdup(name);
<a name="l01679"></a>01679   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a20db3de86854b627815b3d940555ea75" title="function to move the motor">moveAbs</a> = moveAbs;
<a name="l01680"></a>01680   d-&gt;<a class="code" href="structlspmac__motor__struct.html#ac62692eb939c04ca35e939d1c3acfe8f" title="function to read the motor status and position">read</a> = <a class="code" href="lspmac_8c.html#a637fc023d1255f3519b2eee01913d64d" title="Read the position and status of a normal PMAC motor.">lspmac_pmacmotor_read</a>;
<a name="l01681"></a>01681   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a> = NULL;
<a name="l01682"></a>01682   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a> = 0;
<a name="l01683"></a>01683   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a> = posp;
<a name="l01684"></a>01684   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a17e0953d269d53137c508e391cb16e47" title="First 24 bit PMAC motor status word.">status1</a>           = stat1p;
<a name="l01685"></a>01685   d-&gt;<a class="code" href="structlspmac__motor__struct.html#ac16fec220714218334764a1038f3813a" title="Sectond 24 bit PMAC motor status word.">status2</a>           = stat2p;
<a name="l01686"></a>01686   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a45fae17618f0c0827e97060dc04f79cb" title="pmac motor number">motor_num</a> = motor_number;
<a name="l01687"></a>01687   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a05dff021221abbc1bf656039fffb3275" title="controlling mvariable as a string">dac_mvar</a>          = NULL;
<a name="l01688"></a>01688   d-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a> = newwin( <a class="code" href="pgpmac_8h.html#a3bae94e8e4e4347dd5f87b6bda058de6" title="Number of status box rows.">LS_DISPLAY_WINDOW_HEIGHT</a>, <a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>, wy*<a class="code" href="pgpmac_8h.html#a3bae94e8e4e4347dd5f87b6bda058de6" title="Number of status box rows.">LS_DISPLAY_WINDOW_HEIGHT</a>, wx*<a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>);
<a name="l01689"></a>01689   box( d-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>, 0, 0);
<a name="l01690"></a>01690   mvwprintw( d-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>, 1, 1, <span class="stringliteral">&quot;%s&quot;</span>, wtitle);
<a name="l01691"></a>01691   wnoutrefresh( d-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>);
<a name="l01692"></a>01692 
<a name="l01693"></a>01693   <span class="keywordflow">return</span> d;
<a name="l01694"></a>01694 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad1167f01262cf6387e7e82a14d3e1a9d"></a><!-- doxytag: member="lspmac.c::lspmac_moveabs_bio_queue" ref="ad1167f01262cf6387e7e82a14d3e1a9d" args="(lspmac_motor_t *mp, double requested_position)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_moveabs_bio_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td>
          <td class="paramname"> <em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>requested_position</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Move method for binary i/o motor objects. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>mp</em>&nbsp;</td><td>A binary i/o motor object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>requested_position</em>&nbsp;</td><td>a 1 or a 0 request to move </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01562">1562</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01565"></a>01565                                 {
<a name="l01566"></a>01566   pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));
<a name="l01567"></a>01567   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8cdc94c6e2478b12ce942d4cf1d7499" title="The position as requested by the user.">requested_position</a> = requested_position;
<a name="l01568"></a>01568   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a>    = 1;
<a name="l01569"></a>01569   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a68c471836f52707fa8582f7860cf500f" title="set to 1 when motion has been verified to have started">motion_seen</a> = 0;
<a name="l01570"></a>01570   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a> = requested_position;
<a name="l01571"></a>01571   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae0a0c9264f49f51bf72168c3b62f8723" title="the queue item requesting motion. Used to check time request was made">pq</a> = <a class="code" href="lspmac_8c.html#ac4cf3a79186859714d8a8293377526ba" title="Send a command and ignore the response.">lspmac_SockSendline_nr</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a70291ddfe7994c0bec7fc2287cb6dd89" title="Format string to write requested position to PMAC used for binary io.">write_fmt</a>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a>);
<a name="l01572"></a>01572   pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));
<a name="l01573"></a>01573 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab9f114bba58e685760a518bd5f115d74"></a><!-- doxytag: member="lspmac.c::lspmac_moveabs_fshut_queue" ref="ab9f114bba58e685760a518bd5f115d74" args="(lspmac_motor_t *mp, double requested_position)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_moveabs_fshut_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td>
          <td class="paramname"> <em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>requested_position</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Move method for the fast shutter. </p>
<p>Slightly more complicated than a binary io as some flags need to be set up. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mp</em>&nbsp;</td><td>The fast shutter motor instance </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>requested_position</em>&nbsp;</td><td>1 (open) or 0 (close), really </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01535">1535</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01538"></a>01538                                   {
<a name="l01539"></a>01539   pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));
<a name="l01540"></a>01540 
<a name="l01541"></a>01541   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8cdc94c6e2478b12ce942d4cf1d7499" title="The position as requested by the user.">requested_position</a> = requested_position;
<a name="l01542"></a>01542   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a>    = 1;
<a name="l01543"></a>01543   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a68c471836f52707fa8582f7860cf500f" title="set to 1 when motion has been verified to have started">motion_seen</a> = 0;
<a name="l01544"></a>01544   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a> = requested_position;
<a name="l01545"></a>01545   <span class="keywordflow">if</span>( requested_position != 0) {
<a name="l01546"></a>01546     <span class="comment">//</span>
<a name="l01547"></a>01547     <span class="comment">// ScanEnable=0, ManualEnable=1, ManualOn=1</span>
<a name="l01548"></a>01548     <span class="comment">//</span>
<a name="l01549"></a>01549     mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae0a0c9264f49f51bf72168c3b62f8723" title="the queue item requesting motion. Used to check time request was made">pq</a> = <a class="code" href="lspmac_8c.html#ac4cf3a79186859714d8a8293377526ba" title="Send a command and ignore the response.">lspmac_SockSendline_nr</a>( <span class="stringliteral">&quot;M1124=0 M1125=1 M1126=1&quot;</span>);
<a name="l01550"></a>01550   } <span class="keywordflow">else</span> {
<a name="l01551"></a>01551     <span class="comment">//</span>
<a name="l01552"></a>01552     <span class="comment">// ManualOn=0, ManualEnable=0, ScanEnable=1</span>
<a name="l01553"></a>01553     <span class="comment">//</span>
<a name="l01554"></a>01554     mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae0a0c9264f49f51bf72168c3b62f8723" title="the queue item requesting motion. Used to check time request was made">pq</a> = <a class="code" href="lspmac_8c.html#ac4cf3a79186859714d8a8293377526ba" title="Send a command and ignore the response.">lspmac_SockSendline_nr</a>( <span class="stringliteral">&quot;M1126=0 M1125=0 M1124=1&quot;</span>);
<a name="l01555"></a>01555   }
<a name="l01556"></a>01556 
<a name="l01557"></a>01557   pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));
<a name="l01558"></a>01558 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa4ea5a4c387ef167702c58eaddcb4151"></a><!-- doxytag: member="lspmac.c::lspmac_moveabs_queue" ref="aa4ea5a4c387ef167702c58eaddcb4151" args="(lspmac_motor_t *mp, double requested_position)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_moveabs_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td>
          <td class="paramname"> <em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>requested_position</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Move method for normal stepper and servo motor objects. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>mp</em>&nbsp;</td><td>The motor to move </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>requested_position</em>&nbsp;</td><td>Where to move it </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01577">1577</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01580"></a>01580                             {
<a name="l01581"></a>01581   <span class="keywordtype">char</span> s[512];
<a name="l01582"></a>01582 
<a name="l01583"></a>01583   pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));
<a name="l01584"></a>01584   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8cdc94c6e2478b12ce942d4cf1d7499" title="The position as requested by the user.">requested_position</a> = requested_position;
<a name="l01585"></a>01585   <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a61415627ab2dc0f438b190d117e532db" title="conversion from counts to units: 0.0 means not loaded yet">u2c</a> != 0.0) {
<a name="l01586"></a>01586     mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a>    = 1;
<a name="l01587"></a>01587     mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a68c471836f52707fa8582f7860cf500f" title="set to 1 when motion has been verified to have started">motion_seen</a> = 0;
<a name="l01588"></a>01588     mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a> = mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a61415627ab2dc0f438b190d117e532db" title="conversion from counts to units: 0.0 means not loaded yet">u2c</a> * requested_position;
<a name="l01589"></a>01589     snprintf( s, <span class="keyword">sizeof</span>(s)-1, <span class="stringliteral">&quot;#%d j=%d&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a45fae17618f0c0827e97060dc04f79cb" title="pmac motor number">motor_num</a>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a>);
<a name="l01590"></a>01590     mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae0a0c9264f49f51bf72168c3b62f8723" title="the queue item requesting motion. Used to check time request was made">pq</a> = <a class="code" href="lspmac_8c.html#ac4cf3a79186859714d8a8293377526ba" title="Send a command and ignore the response.">lspmac_SockSendline_nr</a>( s);
<a name="l01591"></a>01591   }
<a name="l01592"></a>01592   pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));
<a name="l01593"></a>01593 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aae2282edace621ee65c682d03b7ccc36"></a><!-- doxytag: member="lspmac.c::lspmac_moveabs_wait" ref="aae2282edace621ee65c682d03b7ccc36" args="(lspmac_motor_t *mp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_moveabs_wait </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td>
          <td class="paramname"> <em>mp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Wait for motor to finish moving. </p>
<p>Assume motion already queued, now just wait </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>mp</em>&nbsp;</td><td>The motor object to wait for </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01600">1600</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01602"></a>01602                            {
<a name="l01603"></a>01603   <span class="keyword">struct </span>timespec wt;
<a name="l01604"></a>01604   <span class="keywordtype">int</span> return_code;
<a name="l01605"></a>01605 
<a name="l01606"></a>01606   pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#acc1bb77b9bcbc4d970f841a41fd274b3" title="manage access to the pmac command queue">pmac_queue_mutex</a>);
<a name="l01607"></a>01607 
<a name="l01608"></a>01608   <span class="comment">//</span>
<a name="l01609"></a>01609   <span class="comment">// wait for the command to be sent</span>
<a name="l01610"></a>01610   <span class="comment">//</span>
<a name="l01611"></a>01611   <span class="keywordflow">while</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae0a0c9264f49f51bf72168c3b62f8723" title="the queue item requesting motion. Used to check time request was made">pq</a>-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a276ebc4b35c2554e4cb7377b60fd89b7" title="time this item was dequeued and sent to the pmac">time_sent</a>.tv_sec==0)
<a name="l01612"></a>01612     pthread_cond_wait( &amp;<a class="code" href="lspmac_8c.html#a8a25bd9c593c6985107f90f999ce0b08" title="wait for a command to be sent to PMAC before continuing">pmac_queue_cond</a>, &amp;<a class="code" href="lspmac_8c.html#acc1bb77b9bcbc4d970f841a41fd274b3" title="manage access to the pmac command queue">pmac_queue_mutex</a>);
<a name="l01613"></a>01613 
<a name="l01614"></a>01614   <span class="comment">//</span>
<a name="l01615"></a>01615   <span class="comment">// set the timeout to be long enough after we sent the motion request to ensure that</span>
<a name="l01616"></a>01616   <span class="comment">// we will have read back the motor moving status but not so long that the timeout causes</span>
<a name="l01617"></a>01617   <span class="comment">// problems;</span>
<a name="l01618"></a>01618   <span class="comment">//</span>
<a name="l01619"></a>01619   wt.tv_sec  = mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae0a0c9264f49f51bf72168c3b62f8723" title="the queue item requesting motion. Used to check time request was made">pq</a>-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a276ebc4b35c2554e4cb7377b60fd89b7" title="time this item was dequeued and sent to the pmac">time_sent</a>.tv_sec;
<a name="l01620"></a>01620   wt.tv_nsec = mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae0a0c9264f49f51bf72168c3b62f8723" title="the queue item requesting motion. Used to check time request was made">pq</a>-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a276ebc4b35c2554e4cb7377b60fd89b7" title="time this item was dequeued and sent to the pmac">time_sent</a>.tv_nsec + 500000000;
<a name="l01621"></a>01621 
<a name="l01622"></a>01622   pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#acc1bb77b9bcbc4d970f841a41fd274b3" title="manage access to the pmac command queue">pmac_queue_mutex</a>);
<a name="l01623"></a>01623 
<a name="l01624"></a>01624   <span class="keywordflow">if</span>( wt.tv_nsec &gt;= 1000000000) {
<a name="l01625"></a>01625     wt.tv_nsec -= 1000000000;
<a name="l01626"></a>01626     wt.tv_sec += 1;
<a name="l01627"></a>01627   }
<a name="l01628"></a>01628 
<a name="l01629"></a>01629   <span class="comment">//</span>
<a name="l01630"></a>01630   <span class="comment">// wait for the motion to have started</span>
<a name="l01631"></a>01631   <span class="comment">// This will time out if the motion ends before we can read the status back</span>
<a name="l01632"></a>01632   <span class="comment">// hence the added complication of time stamp of the sent packet.</span>
<a name="l01633"></a>01633   <span class="comment">//</span>
<a name="l01634"></a>01634 
<a name="l01635"></a>01635   return_code=0;
<a name="l01636"></a>01636 
<a name="l01637"></a>01637   pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));
<a name="l01638"></a>01638   <span class="keywordflow">while</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a68c471836f52707fa8582f7860cf500f" title="set to 1 when motion has been verified to have started">motion_seen</a> == 0 &amp;&amp; return_code == 0)
<a name="l01639"></a>01639     return_code = pthread_cond_timedwait( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa0ea4108b8fed5b41ff91ca7266f3d84">cond</a>), &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>), &amp;wt);
<a name="l01640"></a>01640 
<a name="l01641"></a>01641   <span class="keywordflow">if</span>( return_code == 0) {
<a name="l01642"></a>01642     <span class="comment">//</span>
<a name="l01643"></a>01643     <span class="comment">// wait for the motion that we know has started to finish</span>
<a name="l01644"></a>01644     <span class="comment">//</span>
<a name="l01645"></a>01645     <span class="keywordflow">while</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a>)
<a name="l01646"></a>01646       pthread_cond_wait( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa0ea4108b8fed5b41ff91ca7266f3d84">cond</a>), &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));
<a name="l01647"></a>01647 
<a name="l01648"></a>01648   }
<a name="l01649"></a>01649 
<a name="l01650"></a>01650   <span class="comment">//</span>
<a name="l01651"></a>01651   <span class="comment">// if return code was not 0 then we know we shouldn&apos;t wait for not_done flag.</span>
<a name="l01652"></a>01652   <span class="comment">// In this case the motion ended before we read the status that should the motor moving.</span>
<a name="l01653"></a>01653   <span class="comment">//</span>
<a name="l01654"></a>01654   pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));
<a name="l01655"></a>01655 
<a name="l01656"></a>01656 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7d601716497857c2b5c072c1aed37b71"></a><!-- doxytag: member="lspmac.c::lspmac_movedac_queue" ref="a7d601716497857c2b5c072c1aed37b71" args="(lspmac_motor_t *mp, double requested_position)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_movedac_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td>
          <td class="paramname"> <em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>requested_position</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Move method for dac motor objects (ie, lights). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>mp</em>&nbsp;</td><td>Our motor </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>requested_position</em>&nbsp;</td><td>Desired x postion (look up and send y position) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01464">1464</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01467"></a>01467                             {
<a name="l01468"></a>01468   <span class="keywordtype">char</span> s[512];
<a name="l01469"></a>01469   <span class="keywordtype">double</span> y;
<a name="l01470"></a>01470 
<a name="l01471"></a>01471   pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));
<a name="l01472"></a>01472 
<a name="l01473"></a>01473   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8cdc94c6e2478b12ce942d4cf1d7499" title="The position as requested by the user.">requested_position</a> = requested_position;
<a name="l01474"></a>01474 
<a name="l01475"></a>01475   <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a> &gt; 0 &amp;&amp; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a> != NULL) {
<a name="l01476"></a>01476     y = <a class="code" href="lspmac_8c.html#a55b882be15d56a2a777f2b1f92901b7d" title="Look up table support for motor positions (think x=zoom, y=light intensity) use a...">lspmac_lut</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>, requested_position);
<a name="l01477"></a>01477 
<a name="l01478"></a>01478     mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a> = (int)y * mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a61415627ab2dc0f438b190d117e532db" title="conversion from counts to units: 0.0 means not loaded yet">u2c</a>;
<a name="l01479"></a>01479     mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a>    = 1;
<a name="l01480"></a>01480     mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a68c471836f52707fa8582f7860cf500f" title="set to 1 when motion has been verified to have started">motion_seen</a> = 0;
<a name="l01481"></a>01481 
<a name="l01482"></a>01482 
<a name="l01483"></a>01483     <span class="comment">//</span>
<a name="l01484"></a>01484     <span class="comment">//  By convension requested_pos_cnts scales from 0 to 100</span>
<a name="l01485"></a>01485     <span class="comment">//  for the lights u2c converts this to 0 to 16,000</span>
<a name="l01486"></a>01486     <span class="comment">//  for the scintilator focus this is   0 to 32,000</span>
<a name="l01487"></a>01487     <span class="comment">//</span>
<a name="l01488"></a>01488     snprintf( s, <span class="keyword">sizeof</span>(s)-1, <span class="stringliteral">&quot;%s=%d&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a05dff021221abbc1bf656039fffb3275" title="controlling mvariable as a string">dac_mvar</a>, (int)mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a>);
<a name="l01489"></a>01489     mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae0a0c9264f49f51bf72168c3b62f8723" title="the queue item requesting motion. Used to check time request was made">pq</a> = <a class="code" href="lspmac_8c.html#ac4cf3a79186859714d8a8293377526ba" title="Send a command and ignore the response.">lspmac_SockSendline_nr</a>( s);
<a name="l01490"></a>01490 
<a name="l01491"></a>01491   }
<a name="l01492"></a>01492 
<a name="l01493"></a>01493   pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));
<a name="l01494"></a>01494 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad6ae1e37afd118f24ab1c6878da53878"></a><!-- doxytag: member="lspmac.c::lspmac_movezoom_queue" ref="ad6ae1e37afd118f24ab1c6878da53878" args="(lspmac_motor_t *mp, double requested_position)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_movezoom_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td>
          <td class="paramname"> <em>mp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>requested_position</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Move method for the zoom motor. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>mp</em>&nbsp;</td><td>the zoom motor </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>requested_position</em>&nbsp;</td><td>our desired zoom </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01499">1499</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01502"></a>01502                              {
<a name="l01503"></a>01503   <span class="keywordtype">char</span> s[512];
<a name="l01504"></a>01504   <span class="keywordtype">double</span> y;
<a name="l01505"></a>01505   pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));
<a name="l01506"></a>01506 
<a name="l01507"></a>01507   mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8cdc94c6e2478b12ce942d4cf1d7499" title="The position as requested by the user.">requested_position</a> = requested_position;
<a name="l01508"></a>01508 
<a name="l01509"></a>01509   <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a> &gt; 0 &amp;&amp; mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a> != NULL) {
<a name="l01510"></a>01510     y = <a class="code" href="lspmac_8c.html#a55b882be15d56a2a777f2b1f92901b7d" title="Look up table support for motor positions (think x=zoom, y=light intensity) use a...">lspmac_lut</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a11cbc6f50c150ed446e9a901cf7cc12b" title="length of lut">nlut</a>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a7b43671f7f3e06521f6cf91fb9ac707d" title="lookup table (instead of u2c)">lut</a>, requested_position);
<a name="l01511"></a>01511 
<a name="l01512"></a>01512     mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a> = (int)y;
<a name="l01513"></a>01513     mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a>    = 1;
<a name="l01514"></a>01514     mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a68c471836f52707fa8582f7860cf500f" title="set to 1 when motion has been verified to have started">motion_seen</a> = 0;
<a name="l01515"></a>01515 
<a name="l01516"></a>01516 
<a name="l01517"></a>01517     snprintf( s, <span class="keyword">sizeof</span>(s)-1, <span class="stringliteral">&quot;#%d j=%d&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a45fae17618f0c0827e97060dc04f79cb" title="pmac motor number">motor_num</a>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a6e8dc9c11dc52a439fe9837230f93ce2" title="requested position">requested_pos_cnts</a>);
<a name="l01518"></a>01518     mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ae0a0c9264f49f51bf72168c3b62f8723" title="the queue item requesting motion. Used to check time request was made">pq</a> = <a class="code" href="lspmac_8c.html#ac4cf3a79186859714d8a8293377526ba" title="Send a command and ignore the response.">lspmac_SockSendline_nr</a>( s);
<a name="l01519"></a>01519 
<a name="l01520"></a>01520   }
<a name="l01521"></a>01521   pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));
<a name="l01522"></a>01522 
<a name="l01523"></a>01523   <span class="comment">//</span>
<a name="l01524"></a>01524   <span class="comment">// the lights should &quot;move&quot; with the zoom motor</span>
<a name="l01525"></a>01525   <span class="comment">//</span>
<a name="l01526"></a>01526   <a class="code" href="lspmac_8c.html#a7d601716497857c2b5c072c1aed37b71" title="Move method for dac motor objects (ie, lights).">lspmac_movedac_queue</a>( <a class="code" href="lspmac_8c.html#aeb09895663eff333b7a75acb319a9fc1" title="Front Light DAC.">flight</a>, requested_position);
<a name="l01527"></a>01527   <a class="code" href="lspmac_8c.html#a7d601716497857c2b5c072c1aed37b71" title="Move method for dac motor objects (ie, lights).">lspmac_movedac_queue</a>( <a class="code" href="lspmac_8c.html#a85d6eaa4b4a82bb3112574f458d1dc50" title="Back Light DAC.">blight</a>, requested_position);
<a name="l01528"></a>01528 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a68886d1b658e7b1d996c07e9dbcd9c15"></a><!-- doxytag: member="lspmac.c::lspmac_next_state" ref="a68886d1b658e7b1d996c07e9dbcd9c15" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_next_state </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>State machine logic. </p>
<p>Given the current state, generate the next one </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01258">1258</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01258"></a>01258                          {
<a name="l01259"></a>01259 
<a name="l01260"></a>01260   <span class="comment">//</span>
<a name="l01261"></a>01261   <span class="comment">// Connect to the pmac and perhaps initialize it.</span>
<a name="l01262"></a>01262   <span class="comment">// OK, this is slightly more than just the state</span>
<a name="l01263"></a>01263   <span class="comment">// machine logic...</span>
<a name="l01264"></a>01264   <span class="comment">//</span>
<a name="l01265"></a>01265   <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> == <a class="code" href="lspmac_8c.html#a7eb86ecf0789ab9555de1e03a4c73567">LS_PMAC_STATE_DETACHED</a>) {
<a name="l01266"></a>01266     <span class="comment">//</span>
<a name="l01267"></a>01267     <span class="comment">// TODO (eventually)</span>
<a name="l01268"></a>01268     <span class="comment">// This ip address wont change in a single PMAC installation</span>
<a name="l01269"></a>01269     <span class="comment">// We&apos;ll need to audit the code if we decide to implement</span>
<a name="l01270"></a>01270     <span class="comment">// multiple PMACs so might as well wait til then.</span>
<a name="l01271"></a>01271     <span class="comment">//</span>
<a name="l01272"></a>01272     <a class="code" href="lspmac_8c.html#aae020ea2478b41702ce8b7d20b2560be" title="Connect to the PMAC socket.">lsConnect</a>( <span class="stringliteral">&quot;192.6.94.5&quot;</span>);
<a name="l01273"></a>01273 
<a name="l01274"></a>01274     <span class="comment">//</span>
<a name="l01275"></a>01275     <span class="comment">// If the connect was successful we can proceed with the initialization</span>
<a name="l01276"></a>01276     <span class="comment">//</span>
<a name="l01277"></a>01277     <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> != <a class="code" href="lspmac_8c.html#a7eb86ecf0789ab9555de1e03a4c73567">LS_PMAC_STATE_DETACHED</a>) {
<a name="l01278"></a>01278       <a class="code" href="lspmac_8c.html#ac5745f25f242edf02f7b9b7c77ed6126" title="Reset the PMAC socket from the PMAC side.">lspmac_SockFlush</a>();
<a name="l01279"></a>01279       
<a name="l01280"></a>01280       <span class="comment">//</span>
<a name="l01281"></a>01281       <span class="comment">// Harvest the I and M variables in case we need them</span>
<a name="l01282"></a>01282       <span class="comment">// one day.</span>
<a name="l01283"></a>01283       <span class="comment">//</span>
<a name="l01284"></a>01284       <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#a50e9c0a06654fd81b3446a6e54ff12c3" title="flag set at initialization to send m vars to db">getmvars</a>) {
<a name="l01285"></a>01285         <a class="code" href="lspmac_8c.html#a983d291506dc387ba5d71a97766e8a25" title="Request the values of all the M variables.">lspmac_GetAllMVars</a>();
<a name="l01286"></a>01286         <a class="code" href="lspmac_8c.html#a50e9c0a06654fd81b3446a6e54ff12c3" title="flag set at initialization to send m vars to db">getmvars</a> = 0;
<a name="l01287"></a>01287       }
<a name="l01288"></a>01288       
<a name="l01289"></a>01289       <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#a07b7b8254772075e6a4ced500b589c36" title="flag set at initialization to send i vars to db">getivars</a>) {
<a name="l01290"></a>01290         <a class="code" href="lspmac_8c.html#ac24bdffa893a9bf7c9cb084fe1417f6f" title="Request the values of all the I variables.">lspmac_GetAllIVars</a>();
<a name="l01291"></a>01291         <a class="code" href="lspmac_8c.html#a07b7b8254772075e6a4ced500b589c36" title="flag set at initialization to send i vars to db">getivars</a> = 0;
<a name="l01292"></a>01292       }
<a name="l01293"></a>01293     }
<a name="l01294"></a>01294   }
<a name="l01295"></a>01295 
<a name="l01296"></a>01296   <span class="comment">//</span>
<a name="l01297"></a>01297   <span class="comment">// Check the command queue and perhaps go to the &quot;Send Command&quot; state.</span>
<a name="l01298"></a>01298   <span class="comment">//</span>
<a name="l01299"></a>01299   <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> == <a class="code" href="lspmac_8c.html#a37741af675425d61c876cc30ae6c99d0">LS_PMAC_STATE_IDLE</a> &amp;&amp; <a class="code" href="lspmac_8c.html#ad62b1f9e907acc3de9f3d6a05d55829e" title="points to next empty PMAC command queue position">ethCmdOn</a> != <a class="code" href="lspmac_8c.html#ae85caec6f4ddb2fc52ca14a26549ab08" title="points to current command (or none if == ethCmdOn)">ethCmdOff</a>)
<a name="l01300"></a>01300     <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a7d8f34fc599cc08c1a9d2cd62ccbb20a">LS_PMAC_STATE_SC</a>;
<a name="l01301"></a>01301 
<a name="l01302"></a>01302 
<a name="l01303"></a>01303   <span class="comment">//</span>
<a name="l01304"></a>01304   <span class="comment">// Set the events flag</span>
<a name="l01305"></a>01305   <span class="comment">// to tell poll what we are waiting for.</span>
<a name="l01306"></a>01306   <span class="comment">//</span>
<a name="l01307"></a>01307   <span class="keywordflow">switch</span>( <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a>) {
<a name="l01308"></a>01308   <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a7eb86ecf0789ab9555de1e03a4c73567">LS_PMAC_STATE_DETACHED</a>:
<a name="l01309"></a>01309     <span class="comment">//</span>
<a name="l01310"></a>01310     <span class="comment">// there shouldn&apos;t be a valid fd, so ignore the events</span>
<a name="l01311"></a>01311     <span class="comment">//</span>
<a name="l01312"></a>01312     <a class="code" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba" title="our poll structure">pmacfd</a>.events = 0;
<a name="l01313"></a>01313     <span class="keywordflow">break</span>;
<a name="l01314"></a>01314 
<a name="l01315"></a>01315   <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a37741af675425d61c876cc30ae6c99d0">LS_PMAC_STATE_IDLE</a>:
<a name="l01316"></a>01316     <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#ad62b1f9e907acc3de9f3d6a05d55829e" title="points to next empty PMAC command queue position">ethCmdOn</a> == <a class="code" href="lspmac_8c.html#ae85caec6f4ddb2fc52ca14a26549ab08" title="points to current command (or none if == ethCmdOn)">ethCmdOff</a>)
<a name="l01317"></a>01317       <span class="comment">//</span>
<a name="l01318"></a>01318       <span class="comment">// Anytime we are idle we want to</span>
<a name="l01319"></a>01319       <span class="comment">// get the status of the PMAC</span>
<a name="l01320"></a>01320       <span class="comment">//</span>
<a name="l01321"></a>01321       <a class="code" href="lspmac_8c.html#a6dedca923b3a6904395ad02158e2e96f" title="Request a status update from the PMAC.">lspmac_get_status</a>();
<a name="l01322"></a>01322     
<a name="l01323"></a>01323 
<a name="l01324"></a>01324 
<a name="l01325"></a>01325   <span class="comment">//</span>
<a name="l01326"></a>01326   <span class="comment">// These state require that we listen for packets</span>
<a name="l01327"></a>01327   <span class="comment">//</span>
<a name="l01328"></a>01328   <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a63356b0c18fcb186f456c12c6e927d84">LS_PMAC_STATE_WACK_NFR</a>:
<a name="l01329"></a>01329   <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a5eba9ef09d4316e803b9d75bd3104f43">LS_PMAC_STATE_WACK</a>:
<a name="l01330"></a>01330   <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#adef540911028fda73e8bbf0aa6ad39e9">LS_PMAC_STATE_WACK_CC</a>:
<a name="l01331"></a>01331   <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a3e0a62cd9a1212419ad3615c34bdc65a">LS_PMAC_STATE_WACK_RR</a>:
<a name="l01332"></a>01332   <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a27ee6c39d58604c8aa9bd6c249c4833f">LS_PMAC_STATE_WCR</a>:
<a name="l01333"></a>01333   <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a591822cc92f76a39b293c2e90b322db2">LS_PMAC_STATE_WGB</a>:
<a name="l01334"></a>01334   <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a220b39710719cfe8b500d51819e8efeb">LS_PMAC_STATE_GMR</a>:
<a name="l01335"></a>01335     <a class="code" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba" title="our poll structure">pmacfd</a>.events = POLLIN;
<a name="l01336"></a>01336     <span class="keywordflow">break</span>;
<a name="l01337"></a>01337     
<a name="l01338"></a>01338   <span class="comment">//</span>
<a name="l01339"></a>01339   <span class="comment">// These state require that we send packets out.</span>
<a name="l01340"></a>01340   <span class="comment">//</span>
<a name="l01341"></a>01341   <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a7d8f34fc599cc08c1a9d2cd62ccbb20a">LS_PMAC_STATE_SC</a>:
<a name="l01342"></a>01342   <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#abbd709b56a71eb1fc6adc9063605d243">LS_PMAC_STATE_CR</a>:
<a name="l01343"></a>01343   <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#add5325f4a84e4fe05f558880349485ea">LS_PMAC_STATE_RR</a>:
<a name="l01344"></a>01344   <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a5f4ff8874677aac48a4c675f2c1ca4e9">LS_PMAC_STATE_GB</a>:
<a name="l01345"></a>01345     <span class="comment">//</span>
<a name="l01346"></a>01346     <span class="comment">// Sad fact: PMAC will fail to process commands if we send them too quickly.</span>
<a name="l01347"></a>01347     <span class="comment">// We deal with that by waiting a tad before we let poll tell us the PMAC socket is ready to write.</span>
<a name="l01348"></a>01348     <span class="comment">//</span>
<a name="l01349"></a>01349     gettimeofday( &amp;<a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB...">now</a>, NULL);
<a name="l01350"></a>01350     <span class="keywordflow">if</span>(  ((<a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB...">now</a>.tv_sec * 1000000. + <a class="code" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f" title="used to ensure we do not send commands to the pmac too often. Only needed for non-DB...">now</a>.tv_usec) - (pmac_time_sent.tv_sec * 1000000. + pmac_time_sent.tv_usec)) &lt; <a class="code" href="lspmac_8c.html#a59f5f5218e25332dbf64f216aec116e5" title="Minimum time between commands to the pmac.">PMAC_MIN_CMD_TIME</a>) {
<a name="l01351"></a>01351       <a class="code" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba" title="our poll structure">pmacfd</a>.events = 0;
<a name="l01352"></a>01352     } <span class="keywordflow">else</span> {
<a name="l01353"></a>01353       <a class="code" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba" title="our poll structure">pmacfd</a>.events = POLLOUT;
<a name="l01354"></a>01354     }
<a name="l01355"></a>01355     <span class="keywordflow">break</span>;
<a name="l01356"></a>01356   }
<a name="l01357"></a>01357 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a637fc023d1255f3519b2eee01913d64d"></a><!-- doxytag: member="lspmac.c::lspmac_pmacmotor_read" ref="a637fc023d1255f3519b2eee01913d64d" args="(lspmac_motor_t *mp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_pmacmotor_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td>
          <td class="paramname"> <em>mp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Read the position and status of a normal PMAC motor. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>mp</em>&nbsp;</td><td>Our motor </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00981">981</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00983"></a>00983                              {
<a name="l00984"></a>00984   <span class="keywordtype">char</span> s[512], *sp;
<a name="l00985"></a>00985 
<a name="l00986"></a>00986   <span class="keywordflow">if</span>( *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ac16fec220714218334764a1038f3813a" title="Sectond 24 bit PMAC motor status word.">status2</a> &amp; 0x000001) {
<a name="l00987"></a>00987     <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a>) {
<a name="l00988"></a>00988       pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));
<a name="l00989"></a>00989       mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a> = 0;
<a name="l00990"></a>00990       pthread_cond_signal( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa0ea4108b8fed5b41ff91ca7266f3d84">cond</a>));
<a name="l00991"></a>00991       pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));
<a name="l00992"></a>00992     }
<a name="l00993"></a>00993   } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a> == 0) {
<a name="l00994"></a>00994     mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ab7bd8bff48953ce05c758598d75877ac" title="set to 1 when request is queued, zero after motion has toggled">not_done</a> = 1;
<a name="l00995"></a>00995   }
<a name="l00996"></a>00996 
<a name="l00997"></a>00997   <span class="keywordflow">if</span>( (*mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a17e0953d269d53137c508e391cb16e47" title="First 24 bit PMAC motor status word.">status1</a> &amp; 0x020000) || (*mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a17e0953d269d53137c508e391cb16e47" title="First 24 bit PMAC motor status word.">status1</a> &amp; 0x000400)) {
<a name="l00998"></a>00998     <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a68c471836f52707fa8582f7860cf500f" title="set to 1 when motion has been verified to have started">motion_seen</a> == 0) {
<a name="l00999"></a>00999       pthread_mutex_lock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));
<a name="l01000"></a>01000       mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a68c471836f52707fa8582f7860cf500f" title="set to 1 when motion has been verified to have started">motion_seen</a> = 1;
<a name="l01001"></a>01001       pthread_cond_signal( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa0ea4108b8fed5b41ff91ca7266f3d84">cond</a>));
<a name="l01002"></a>01002       pthread_mutex_unlock( &amp;(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>));
<a name="l01003"></a>01003     }
<a name="l01004"></a>01004   }
<a name="l01005"></a>01005 
<a name="l01006"></a>01006   mvwprintw( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>, 2, 1, <span class="stringliteral">&quot;%*s&quot;</span>, <a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2, <span class="stringliteral">&quot; &quot;</span>);
<a name="l01007"></a>01007   mvwprintw( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>, 2, 1, <span class="stringliteral">&quot;%*d cts&quot;</span>, <a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-6, *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a>);
<a name="l01008"></a>01008   mvwprintw( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>, 3, 1, <span class="stringliteral">&quot;%*s&quot;</span>, <a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2, <span class="stringliteral">&quot; &quot;</span>);
<a name="l01009"></a>01009 
<a name="l01010"></a>01010   <span class="keywordflow">if</span>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a61415627ab2dc0f438b190d117e532db" title="conversion from counts to units: 0.0 means not loaded yet">u2c</a> != 0.0) {
<a name="l01011"></a>01011     mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a> = *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a>/mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a61415627ab2dc0f438b190d117e532db" title="conversion from counts to units: 0.0 means not loaded yet">u2c</a>;
<a name="l01012"></a>01012     snprintf( s, <span class="keyword">sizeof</span>(s)-1, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aba3d9d00271187128506bbbb1d77da19" title="printf format">format</a>, 8, *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a>/mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a61415627ab2dc0f438b190d117e532db" title="conversion from counts to units: 0.0 means not loaded yet">u2c</a>);
<a name="l01013"></a>01013   } <span class="keywordflow">else</span> {
<a name="l01014"></a>01014     mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a> = 1.0* (*mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a>);
<a name="l01015"></a>01015     snprintf( s, <span class="keyword">sizeof</span>(s)-1, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aba3d9d00271187128506bbbb1d77da19" title="printf format">format</a>, 8, 1.0* (*mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a312047bb71def5cd2443fecd875eaea5" title="pointer to the md2_status structure to the actual position">actual_pos_cnts_p</a>));
<a name="l01016"></a>01016   }
<a name="l01017"></a>01017   s[<span class="keyword">sizeof</span>(s)-1] = 0;
<a name="l01018"></a>01018   mvwprintw( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>, 3, 1, <span class="stringliteral">&quot;%*s&quot;</span>, <a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-6, s);
<a name="l01019"></a>01019 
<a name="l01020"></a>01020   mvwprintw( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>, 4, 1, <span class="stringliteral">&quot;%*u&quot;</span>, <a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2, *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a17e0953d269d53137c508e391cb16e47" title="First 24 bit PMAC motor status word.">status1</a>);
<a name="l01021"></a>01021   mvwprintw( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>, 5, 1, <span class="stringliteral">&quot;%*u&quot;</span>, <a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2, *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ac16fec220714218334764a1038f3813a" title="Sectond 24 bit PMAC motor status word.">status2</a>);
<a name="l01022"></a>01022   sp = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01023"></a>01023   <span class="keywordflow">if</span>( *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ac16fec220714218334764a1038f3813a" title="Sectond 24 bit PMAC motor status word.">status2</a> &amp; 0x000002)
<a name="l01024"></a>01024     sp = <span class="stringliteral">&quot;Following Warning&quot;</span>;
<a name="l01025"></a>01025   <span class="keywordflow">else</span> <span class="keywordflow">if</span>( *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ac16fec220714218334764a1038f3813a" title="Sectond 24 bit PMAC motor status word.">status2</a> &amp; 0x000004)
<a name="l01026"></a>01026     sp = <span class="stringliteral">&quot;Following Error&quot;</span>;
<a name="l01027"></a>01027   <span class="keywordflow">else</span> <span class="keywordflow">if</span>( *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ac16fec220714218334764a1038f3813a" title="Sectond 24 bit PMAC motor status word.">status2</a> &amp; 0x000020)
<a name="l01028"></a>01028     sp = <span class="stringliteral">&quot;I2T Amp Fault&quot;</span>;
<a name="l01029"></a>01029   <span class="keywordflow">else</span> <span class="keywordflow">if</span>( *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ac16fec220714218334764a1038f3813a" title="Sectond 24 bit PMAC motor status word.">status2</a> &amp; 0x000008)
<a name="l01030"></a>01030     sp = <span class="stringliteral">&quot;Amp. Fault&quot;</span>;
<a name="l01031"></a>01031   <span class="keywordflow">else</span> <span class="keywordflow">if</span>( *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ac16fec220714218334764a1038f3813a" title="Sectond 24 bit PMAC motor status word.">status2</a> &amp; 0x000800)
<a name="l01032"></a>01032     sp = <span class="stringliteral">&quot;Stopped on Limit&quot;</span>;
<a name="l01033"></a>01033   <span class="keywordflow">else</span> <span class="keywordflow">if</span>( *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a17e0953d269d53137c508e391cb16e47" title="First 24 bit PMAC motor status word.">status1</a> &amp; 0x040000)
<a name="l01034"></a>01034     sp = <span class="stringliteral">&quot;Open Loop&quot;</span>;
<a name="l01035"></a>01035   <span class="keywordflow">else</span> <span class="keywordflow">if</span>( ~(*mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a17e0953d269d53137c508e391cb16e47" title="First 24 bit PMAC motor status word.">status1</a>) &amp; 0x080000)
<a name="l01036"></a>01036     sp = <span class="stringliteral">&quot;Motor Disabled&quot;</span>;
<a name="l01037"></a>01037   <span class="keywordflow">else</span> <span class="keywordflow">if</span>( *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a17e0953d269d53137c508e391cb16e47" title="First 24 bit PMAC motor status word.">status1</a> &amp; 0x000400)
<a name="l01038"></a>01038     sp = <span class="stringliteral">&quot;Homing&quot;</span>;
<a name="l01039"></a>01039   <span class="keywordflow">else</span> <span class="keywordflow">if</span>( (*mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a17e0953d269d53137c508e391cb16e47" title="First 24 bit PMAC motor status word.">status1</a> &amp; 0x600000) == 0x600000)
<a name="l01040"></a>01040     sp = <span class="stringliteral">&quot;Both Limits Tripped&quot;</span>;
<a name="l01041"></a>01041   <span class="keywordflow">else</span> <span class="keywordflow">if</span>( *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a17e0953d269d53137c508e391cb16e47" title="First 24 bit PMAC motor status word.">status1</a> &amp; 0x200000)
<a name="l01042"></a>01042     sp = <span class="stringliteral">&quot;Positive Limit&quot;</span>;
<a name="l01043"></a>01043   <span class="keywordflow">else</span> <span class="keywordflow">if</span>( *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a17e0953d269d53137c508e391cb16e47" title="First 24 bit PMAC motor status word.">status1</a> &amp; 0x400000)
<a name="l01044"></a>01044     sp = <span class="stringliteral">&quot;Negative Limit&quot;</span>;
<a name="l01045"></a>01045   <span class="keywordflow">else</span> <span class="keywordflow">if</span>( ~(*mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ac16fec220714218334764a1038f3813a" title="Sectond 24 bit PMAC motor status word.">status2</a>) &amp; 0x000400)
<a name="l01046"></a>01046     sp = <span class="stringliteral">&quot;Not Homed&quot;</span>;
<a name="l01047"></a>01047   <span class="keywordflow">else</span> <span class="keywordflow">if</span>( *mp-&gt;<a class="code" href="structlspmac__motor__struct.html#ac16fec220714218334764a1038f3813a" title="Sectond 24 bit PMAC motor status word.">status2</a> &amp; 0x000001)
<a name="l01048"></a>01048     sp = <span class="stringliteral">&quot;In Position&quot;</span>;
<a name="l01049"></a>01049 
<a name="l01050"></a>01050   mvwprintw( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>, 6, 1, <span class="stringliteral">&quot;%*s&quot;</span>, <a class="code" href="pgpmac_8h.html#a1f96754f00a1f82414cebc66f75ded78" title="Number of status box columns.">LS_DISPLAY_WINDOW_WIDTH</a>-2, sp);
<a name="l01051"></a>01051   wnoutrefresh( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a133775154b0e008f3a2fde6f53bc0eff" title="our ncurses window">win</a>);
<a name="l01052"></a>01052 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9627f30135aa7007bc4ab8dde905739a"></a><!-- doxytag: member="lspmac.c::lspmac_pop_queue" ref="a9627f30135aa7007bc4ab8dde905739a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a>* lspmac_pop_queue </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Remove the oldest queue item. </p>
<p>Used to send command to PMAC. Note that there is a separate reply index to ensure we've know to what command a reply is refering. Returns the item. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00438">438</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00438"></a>00438                                      {
<a name="l00439"></a>00439   <a class="code" href="structlspmac__cmd__queue__struct.html" title="PMAC command queue item.">pmac_cmd_queue_t</a> *rtn;
<a name="l00440"></a>00440 
<a name="l00441"></a>00441   pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#acc1bb77b9bcbc4d970f841a41fd274b3" title="manage access to the pmac command queue">pmac_queue_mutex</a>);
<a name="l00442"></a>00442 
<a name="l00443"></a>00443   <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#ad62b1f9e907acc3de9f3d6a05d55829e" title="points to next empty PMAC command queue position">ethCmdOn</a> == <a class="code" href="lspmac_8c.html#ae85caec6f4ddb2fc52ca14a26549ab08" title="points to current command (or none if == ethCmdOn)">ethCmdOff</a>)
<a name="l00444"></a>00444     rtn = NULL;
<a name="l00445"></a>00445   <span class="keywordflow">else</span> {
<a name="l00446"></a>00446     rtn = &amp;(<a class="code" href="lspmac_8c.html#a69e569a833fe7f202b92e860d1548f2b" title="PMAC command queue.">ethCmdQueue</a>[(<a class="code" href="lspmac_8c.html#ae85caec6f4ddb2fc52ca14a26549ab08" title="points to current command (or none if == ethCmdOn)">ethCmdOff</a>++) % <a class="code" href="lspmac_8c.html#a3fae557baafab24b7518dc84f5ef5a9b" title="Size of the PMAC command queue.">PMAC_CMD_QUEUE_LENGTH</a>]);
<a name="l00447"></a>00447     clock_gettime( CLOCK_REALTIME, &amp;(rtn-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a276ebc4b35c2554e4cb7377b60fd89b7" title="time this item was dequeued and sent to the pmac">time_sent</a>));
<a name="l00448"></a>00448   }
<a name="l00449"></a>00449   pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#acc1bb77b9bcbc4d970f841a41fd274b3" title="manage access to the pmac command queue">pmac_queue_mutex</a>);
<a name="l00450"></a>00450   <span class="keywordflow">return</span> rtn;
<a name="l00451"></a>00451 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0f60f18dfe11c1c0299909521596be8f"></a><!-- doxytag: member="lspmac.c::lspmac_pop_reply" ref="a0f60f18dfe11c1c0299909521596be8f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a>* lspmac_pop_reply </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Remove the next command queue item that is waiting for a reply. </p>
<p>We always need a reply to know we are done with a given command. Returns the item. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00458">458</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00458"></a>00458                                      {
<a name="l00459"></a>00459   <a class="code" href="structlspmac__cmd__queue__struct.html" title="PMAC command queue item.">pmac_cmd_queue_t</a> *rtn;
<a name="l00460"></a>00460 
<a name="l00461"></a>00461   pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#acc1bb77b9bcbc4d970f841a41fd274b3" title="manage access to the pmac command queue">pmac_queue_mutex</a>);
<a name="l00462"></a>00462 
<a name="l00463"></a>00463   <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#ad62b1f9e907acc3de9f3d6a05d55829e" title="points to next empty PMAC command queue position">ethCmdOn</a> == <a class="code" href="lspmac_8c.html#a7a78524ada402bb74759a3dfc5f8a571" title="Used like ethCmdOff only to deal with the pmac reply to a command.">ethCmdReply</a>)
<a name="l00464"></a>00464     rtn = NULL;
<a name="l00465"></a>00465   <span class="keywordflow">else</span>
<a name="l00466"></a>00466     rtn = &amp;(<a class="code" href="lspmac_8c.html#a69e569a833fe7f202b92e860d1548f2b" title="PMAC command queue.">ethCmdQueue</a>[(<a class="code" href="lspmac_8c.html#a7a78524ada402bb74759a3dfc5f8a571" title="Used like ethCmdOff only to deal with the pmac reply to a command.">ethCmdReply</a>++) % <a class="code" href="lspmac_8c.html#a3fae557baafab24b7518dc84f5ef5a9b" title="Size of the PMAC command queue.">PMAC_CMD_QUEUE_LENGTH</a>]);
<a name="l00467"></a>00467 
<a name="l00468"></a>00468   pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#acc1bb77b9bcbc4d970f841a41fd274b3" title="manage access to the pmac command queue">pmac_queue_mutex</a>);
<a name="l00469"></a>00469   <span class="keywordflow">return</span> rtn;
<a name="l00470"></a>00470 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a84a6096d9bfff2bfb1506a216756ae28"></a><!-- doxytag: member="lspmac.c::lspmac_push_queue" ref="a84a6096d9bfff2bfb1506a216756ae28" args="(pmac_cmd_queue_t *cmd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a>* lspmac_push_queue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a> *&nbsp;</td>
          <td class="paramname"> <em>cmd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Put a new command on the queue. </p>
<p>Pointer is returned so caller can evaluate the time command was actually sent. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cmd</em>&nbsp;</td><td>Command to send to the PMAC </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00414">414</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00416"></a>00416                                       {
<a name="l00417"></a>00417   <a class="code" href="structlspmac__cmd__queue__struct.html" title="PMAC command queue item.">pmac_cmd_queue_t</a> *rtn;
<a name="l00418"></a>00418 
<a name="l00419"></a>00419   pthread_mutex_lock( &amp;<a class="code" href="lspmac_8c.html#acc1bb77b9bcbc4d970f841a41fd274b3" title="manage access to the pmac command queue">pmac_queue_mutex</a>);
<a name="l00420"></a>00420   rtn = &amp;(<a class="code" href="lspmac_8c.html#a69e569a833fe7f202b92e860d1548f2b" title="PMAC command queue.">ethCmdQueue</a>[(<a class="code" href="lspmac_8c.html#ad62b1f9e907acc3de9f3d6a05d55829e" title="points to next empty PMAC command queue position">ethCmdOn</a>++) % <a class="code" href="lspmac_8c.html#a3fae557baafab24b7518dc84f5ef5a9b" title="Size of the PMAC command queue.">PMAC_CMD_QUEUE_LENGTH</a>]);
<a name="l00421"></a>00421   memcpy( rtn, cmd, <span class="keyword">sizeof</span>( <a class="code" href="structlspmac__cmd__queue__struct.html" title="PMAC command queue item.">pmac_cmd_queue_t</a>));
<a name="l00422"></a>00422   rtn-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a276ebc4b35c2554e4cb7377b60fd89b7" title="time this item was dequeued and sent to the pmac">time_sent</a>.tv_sec  = 0;
<a name="l00423"></a>00423   rtn-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a276ebc4b35c2554e4cb7377b60fd89b7" title="time this item was dequeued and sent to the pmac">time_sent</a>.tv_nsec = 0;
<a name="l00424"></a>00424   pthread_cond_signal( &amp;<a class="code" href="lspmac_8c.html#a8a25bd9c593c6985107f90f999ce0b08" title="wait for a command to be sent to PMAC before continuing">pmac_queue_cond</a>);
<a name="l00425"></a>00425   pthread_mutex_unlock( &amp;<a class="code" href="lspmac_8c.html#acc1bb77b9bcbc4d970f841a41fd274b3" title="manage access to the pmac command queue">pmac_queue_mutex</a>);
<a name="l00426"></a>00426 
<a name="l00427"></a>00427   <span class="keywordflow">return</span> rtn;
<a name="l00428"></a>00428 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aaedae34bc18ac1742a232117c125d7b9"></a><!-- doxytag: member="lspmac.c::lspmac_Reset" ref="aaedae34bc18ac1742a232117c125d7b9" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_Reset </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Clear the queue and put the PMAC into a known state. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00541">541</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00541"></a>00541                     {
<a name="l00542"></a>00542   <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a37741af675425d61c876cc30ae6c99d0">LS_PMAC_STATE_IDLE</a>;
<a name="l00543"></a>00543 
<a name="l00544"></a>00544   <span class="comment">// clear queue</span>
<a name="l00545"></a>00545   <a class="code" href="lspmac_8c.html#a7a78524ada402bb74759a3dfc5f8a571" title="Used like ethCmdOff only to deal with the pmac reply to a command.">ethCmdReply</a> = <a class="code" href="lspmac_8c.html#ad62b1f9e907acc3de9f3d6a05d55829e" title="points to next empty PMAC command queue position">ethCmdOn</a>;
<a name="l00546"></a>00546   <a class="code" href="lspmac_8c.html#ae85caec6f4ddb2fc52ca14a26549ab08" title="points to current command (or none if == ethCmdOn)">ethCmdOff</a>   = <a class="code" href="lspmac_8c.html#ad62b1f9e907acc3de9f3d6a05d55829e" title="points to next empty PMAC command queue position">ethCmdOn</a>;
<a name="l00547"></a>00547 
<a name="l00548"></a>00548   <a class="code" href="lspmac_8c.html#ac5745f25f242edf02f7b9b7c77ed6126" title="Reset the PMAC socket from the PMAC side.">lspmac_SockFlush</a>();
<a name="l00549"></a>00549 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3a7fb93fb3fb9c4454613f30bfb0b1ee"></a><!-- doxytag: member="lspmac.c::lspmac_run" ref="a3a7fb93fb3fb9c4454613f30bfb0b1ee" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_run </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Start up the lspmac thread. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01870">1870</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01870"></a>01870                   {
<a name="l01871"></a>01871   pthread_create( &amp;<a class="code" href="lspmac_8c.html#a6b7011dd7d2c2d3afadff8d3e50e7677" title="our thread to manage access and communication to the pmac">pmac_thread</a>, NULL, <a class="code" href="lspmac_8c.html#abdec5883055967b1eda043670870f55f" title="Our lspmac worker thread.">lspmac_worker</a>, NULL);
<a name="l01872"></a>01872 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1e472a11df3765763c2fe92dd358bf0c"></a><!-- doxytag: member="lspmac.c::lspmac_send_command" ref="a1e472a11df3765763c2fe92dd358bf0c" args="(int rqType, int rq, int wValue, int wIndex, int wLength, unsigned char *data, void(*responseCB)(pmac_cmd_queue_t *, int, unsigned char *), int no_reply)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a>* lspmac_send_command </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rqType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>wValue</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>wIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>wLength</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(<a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a> *, int, unsigned char *)&nbsp;</td>
          <td class="paramname"> <em>responseCB</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>no_reply</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Compose a packet and send it to the PMAC. </p>
<p>This is the meat of the PMAC communications routines. The queued command is returned. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rqType</em>&nbsp;</td><td>VR_UPLOAD or VR_DOWNLOAD </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rq</em>&nbsp;</td><td>PMAC command (see PMAC User Manual </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>wValue</em>&nbsp;</td><td>Command argument 1 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>wIndex</em>&nbsp;</td><td>Command argument 2 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>wLength</em>&nbsp;</td><td>Length of data array </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>data</em>&nbsp;</td><td>Data array (or NULL) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>responseCB</em>&nbsp;</td><td>Function to call when a response is read from the PMAC </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>no_reply</em>&nbsp;</td><td>Flag, non-zero means no reply is expected </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00476">476</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00486"></a>00486                                         {
<a name="l00487"></a>00487   <span class="keyword">static</span> <a class="code" href="structlspmac__cmd__queue__struct.html" title="PMAC command queue item.">pmac_cmd_queue_t</a> cmd;
<a name="l00488"></a>00488 
<a name="l00489"></a>00489   cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a6a155eb3ae546dd29369c4a33ddb3310" title="VR_UPLOAD or VR_DOWNLOAD.">RequestType</a> = rqType;
<a name="l00490"></a>00490   cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a0dc566e7edbb226f1a4ea443d93d56e2" title="The command to run (VR_PMAC_GETMEM, etc).">Request</a>     = rq;
<a name="l00491"></a>00491   cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#aec0ee9a5f6c7e3bc6e4bd98f1bd52783" title="Command parameter 1.">wValue</a>      = htons(wValue);
<a name="l00492"></a>00492   cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a92f5a374e87d4f496b64b4888850d6e6" title="Command parameter 2.">wIndex</a>      = htons(wIndex);
<a name="l00493"></a>00493   cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#af5df25ff13ca30fa33719d0df1ab7e97" title="Number of bytes in bData.">wLength</a>     = htons(wLength);
<a name="l00494"></a>00494   cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#afe92c0bab9f124314a6f3d8104c94364" title="function to call when response is received. args are (int fd, nreturned, buffer)">onResponse</a>       = responseCB;
<a name="l00495"></a>00495   cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a33f70b45f8b7c27935cd3efe28748479" title="1 = no reply is expected, 0 = expect a reply">no_reply</a>         = no_reply;
<a name="l00496"></a>00496 
<a name="l00497"></a>00497   <span class="comment">//</span>
<a name="l00498"></a>00498   <span class="comment">// Setting the message buff bData requires a bit more care to avoid over filling it</span>
<a name="l00499"></a>00499   <span class="comment">// or sending garbage in the unused bytes.</span>
<a name="l00500"></a>00500   <span class="comment">//</span>
<a name="l00501"></a>00501 
<a name="l00502"></a>00502   <span class="keywordflow">if</span>( wLength &gt; <span class="keyword">sizeof</span>( cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>)) {
<a name="l00503"></a>00503     <span class="comment">//</span>
<a name="l00504"></a>00504     <span class="comment">// Bad things happen if we do not catch this case.</span>
<a name="l00505"></a>00505     <span class="comment">//</span>
<a name="l00506"></a>00506     pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00507"></a>00507     wprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, <span class="stringliteral">&quot;Message Length %d longer than maximum of %ld, aborting\n&quot;</span>, wLength, <span class="keyword">sizeof</span>( cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>));
<a name="l00508"></a>00508 
<a name="l00509"></a>00509     wnoutrefresh( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>);
<a name="l00510"></a>00510     wnoutrefresh( <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>);
<a name="l00511"></a>00511     doupdate();
<a name="l00512"></a>00512     pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00513"></a>00513     exit( -1);
<a name="l00514"></a>00514   }
<a name="l00515"></a>00515   <span class="keywordflow">if</span>( data == NULL) {
<a name="l00516"></a>00516     memset( cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>, 0, <span class="keyword">sizeof</span>( cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>));
<a name="l00517"></a>00517   } <span class="keywordflow">else</span> {
<a name="l00518"></a>00518     <span class="comment">//</span>
<a name="l00519"></a>00519     <span class="comment">// This could leave bData non-null terminated.  I do not know if this is a problem.</span>
<a name="l00520"></a>00520     <span class="comment">//</span>
<a name="l00521"></a>00521     <span class="keywordflow">if</span>( wLength &gt; 0)
<a name="l00522"></a>00522       memcpy( cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>, data, wLength);
<a name="l00523"></a>00523     <span class="keywordflow">if</span>( wLength &lt; <span class="keyword">sizeof</span>( cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>))
<a name="l00524"></a>00524       memset( cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a> + wLength, 0, <span class="keyword">sizeof</span>( cmd.<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a872dab798127d6f589974a79c5d0aef1" title="The data buffer, if required.">bData</a>) - wLength);
<a name="l00525"></a>00525   }
<a name="l00526"></a>00526 
<a name="l00527"></a>00527   <span class="keywordflow">return</span> <a class="code" href="lspmac_8c.html#a84a6096d9bfff2bfb1506a216756ae28" title="Put a new command on the queue.">lspmac_push_queue</a>( &amp;cmd);
<a name="l00528"></a>00528 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa9bbf5ae34ce793d3d72945c64c43948"></a><!-- doxytag: member="lspmac.c::lspmac_sendcmd_nocb" ref="aa9bbf5ae34ce793d3d72945c64c43948" args="(char *fmt,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_sendcmd_nocb </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Send a command that does not need to deal with the reply. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fmt</em>&nbsp;</td><td>A printf style format string </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01238">1238</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01241"></a>01241                            {
<a name="l01242"></a>01242   <span class="keyword">static</span> <span class="keywordtype">char</span> tmps[1024];
<a name="l01243"></a>01243   va_list arg_ptr;
<a name="l01244"></a>01244 
<a name="l01245"></a>01245   va_start( arg_ptr, fmt);
<a name="l01246"></a>01246   vsnprintf( tmps, <span class="keyword">sizeof</span>(tmps)-1, fmt, arg_ptr);
<a name="l01247"></a>01247   tmps[<span class="keyword">sizeof</span>(tmps)-1]=0;
<a name="l01248"></a>01248   va_end( arg_ptr);
<a name="l01249"></a>01249 
<a name="l01250"></a>01250   <a class="code" href="lspmac_8c.html#a1e472a11df3765763c2fe92dd358bf0c" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#af24ecdc10723dc8fd6320fef416ae514">VR_DOWNLOAD</a>, <a class="code" href="lspmac_8c.html#a772b2ea2ad93989ae4275c79a93525ee">VR_PMAC_SENDLINE</a>, 0, 0, strlen(tmps), tmps, NULL, 0);
<a name="l01251"></a>01251 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac23af52b8d3a8f2722d4804d5340fa6c"></a><!-- doxytag: member="lspmac.c::lspmac_SendControlReplyPrintCB" ref="ac23af52b8d3a8f2722d4804d5340fa6c" args="(pmac_cmd_queue_t *cmd, int nreceived, unsigned char *buff)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_SendControlReplyPrintCB </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a> *&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nreceived</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>buff</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Receive a reply to a control character Print a "printable" version of the character to the terminal Followed by a hex dump of the response. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>cmd</em>&nbsp;</td><td>Queue item this is a reply to </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>nreceived</em>&nbsp;</td><td>Number of bytes received </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>buff</em>&nbsp;</td><td>Buffer of bytes received </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00813">813</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00817"></a>00817                                       {
<a name="l00818"></a>00818     pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00819"></a>00819     wprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, <span class="stringliteral">&quot;control-%c: &quot;</span>, <span class="charliteral">&apos;@&apos;</span>+ ntohs(cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#aec0ee9a5f6c7e3bc6e4bd98f1bd52783" title="Command parameter 1.">wValue</a>));
<a name="l00820"></a>00820     pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00821"></a>00821     <a class="code" href="lspmac_8c.html#a1c3786f3a38724f497afc4fe6d82d8c4" title="Prints a hex dump of the given data.">hex_dump</a>( nreceived, buff);
<a name="l00822"></a>00822     pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00823"></a>00823     wnoutrefresh( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>);
<a name="l00824"></a>00824     wnoutrefresh( <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>);
<a name="l00825"></a>00825     doupdate();
<a name="l00826"></a>00826     pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00827"></a>00827 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af3fa79868ba88f7c37f7b8f7d53149ff"></a><!-- doxytag: member="lspmac.c::lspmac_Service" ref="af3fa79868ba88f7c37f7b8f7d53149ff" args="(struct pollfd *evt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_Service </td>
          <td>(</td>
          <td class="paramtype">struct pollfd *&nbsp;</td>
          <td class="paramname"> <em>evt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Service routine for packet coming from the PMAC. </p>
<p>All communications is asynchronous so this is the only place incomming packets are handled </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>evt</em>&nbsp;</td><td>pollfd object returned by poll </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00586">586</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00588"></a>00588                       {
<a name="l00589"></a>00589   <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *receiveBuffer = NULL;   <span class="comment">// the buffer inwhich to stick our incomming characters</span>
<a name="l00590"></a>00590   <span class="keyword">static</span> <span class="keywordtype">int</span> receiveBufferSize = 0;             <span class="comment">// size of receiveBuffer</span>
<a name="l00591"></a>00591   <span class="keyword">static</span> <span class="keywordtype">int</span> receiveBufferIn = 0;               <span class="comment">// next location to write to in receiveBuffer</span>
<a name="l00592"></a>00592   <a class="code" href="structlspmac__cmd__queue__struct.html" title="PMAC command queue item.">pmac_cmd_queue_t</a> *cmd;                        <span class="comment">// maybe the command we are servicing</span>
<a name="l00593"></a>00593   ssize_t nsent, nread;                         <span class="comment">// nbytes dealt with</span>
<a name="l00594"></a>00594   <span class="keywordtype">int</span> i;                                        <span class="comment">// loop counter</span>
<a name="l00595"></a>00595   <span class="keywordtype">int</span> foundEOCR;                                <span class="comment">// end of command response flag</span>
<a name="l00596"></a>00596 
<a name="l00597"></a>00597   <span class="keywordflow">if</span>( evt-&gt;revents &amp; (POLLERR | POLLHUP | POLLNVAL)) {
<a name="l00598"></a>00598     <span class="keywordflow">if</span>( evt-&gt;fd != -1) {
<a name="l00599"></a>00599       close( evt-&gt;fd);
<a name="l00600"></a>00600       evt-&gt;fd = -1;
<a name="l00601"></a>00601     }
<a name="l00602"></a>00602     <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a7eb86ecf0789ab9555de1e03a4c73567">LS_PMAC_STATE_DETACHED</a>;
<a name="l00603"></a>00603     <span class="keywordflow">return</span>;
<a name="l00604"></a>00604   }
<a name="l00605"></a>00605 
<a name="l00606"></a>00606 
<a name="l00607"></a>00607   <span class="keywordflow">if</span>( evt-&gt;revents &amp; POLLOUT) {
<a name="l00608"></a>00608 
<a name="l00609"></a>00609     <span class="keywordflow">switch</span>( <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a>) {
<a name="l00610"></a>00610     <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a7eb86ecf0789ab9555de1e03a4c73567">LS_PMAC_STATE_DETACHED</a>:
<a name="l00611"></a>00611       <span class="keywordflow">break</span>;
<a name="l00612"></a>00612     <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a37741af675425d61c876cc30ae6c99d0">LS_PMAC_STATE_IDLE</a>:
<a name="l00613"></a>00613       <span class="keywordflow">break</span>;
<a name="l00614"></a>00614 
<a name="l00615"></a>00615     <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a7d8f34fc599cc08c1a9d2cd62ccbb20a">LS_PMAC_STATE_SC</a>:
<a name="l00616"></a>00616       cmd = <a class="code" href="lspmac_8c.html#a9627f30135aa7007bc4ab8dde905739a" title="Remove the oldest queue item.">lspmac_pop_queue</a>();
<a name="l00617"></a>00617       <span class="keywordflow">if</span>( cmd != NULL) {
<a name="l00618"></a>00618         <span class="keywordflow">if</span>( cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a0dc566e7edbb226f1a4ea443d93d56e2" title="The command to run (VR_PMAC_GETMEM, etc).">Request</a> == <a class="code" href="lspmac_8c.html#af9c53e7c5b2681a5ca1c5410a914a2dc">VR_PMAC_GETMEM</a>) {
<a name="l00619"></a>00619           nsent = send( evt-&gt;fd, cmd, <a class="code" href="lspmac_8c.html#abdc45e3f7106f84f688419e2da9b3627" title="PMAC command size in bytes.">pmac_cmd_size</a>, 0);
<a name="l00620"></a>00620           <span class="keywordflow">if</span>( nsent != <a class="code" href="lspmac_8c.html#abdc45e3f7106f84f688419e2da9b3627" title="PMAC command size in bytes.">pmac_cmd_size</a>) {
<a name="l00621"></a>00621             pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00622"></a>00622             wprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, <span class="stringliteral">&quot;\nCould only send %d of %d bytes....Not good.&quot;</span>, (<span class="keywordtype">int</span>)nsent, (<span class="keywordtype">int</span>)(<a class="code" href="lspmac_8c.html#abdc45e3f7106f84f688419e2da9b3627" title="PMAC command size in bytes.">pmac_cmd_size</a>));
<a name="l00623"></a>00623             wnoutrefresh( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>);
<a name="l00624"></a>00624             wnoutrefresh( <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>);
<a name="l00625"></a>00625             doupdate();
<a name="l00626"></a>00626             pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00627"></a>00627           }
<a name="l00628"></a>00628         } <span class="keywordflow">else</span> {
<a name="l00629"></a>00629           nsent = send( evt-&gt;fd, cmd, <a class="code" href="lspmac_8c.html#abdc45e3f7106f84f688419e2da9b3627" title="PMAC command size in bytes.">pmac_cmd_size</a> + ntohs(cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#af5df25ff13ca30fa33719d0df1ab7e97" title="Number of bytes in bData.">wLength</a>), 0);
<a name="l00630"></a>00630           gettimeofday( &amp;pmac_time_sent, NULL);
<a name="l00631"></a>00631           <span class="keywordflow">if</span>( nsent != <a class="code" href="lspmac_8c.html#abdc45e3f7106f84f688419e2da9b3627" title="PMAC command size in bytes.">pmac_cmd_size</a> + ntohs(cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#af5df25ff13ca30fa33719d0df1ab7e97" title="Number of bytes in bData.">wLength</a>)) {
<a name="l00632"></a>00632             pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00633"></a>00633             wprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, <span class="stringliteral">&quot;\nCould only send %d of %d bytes....Not good.&quot;</span>, (<span class="keywordtype">int</span>)nsent, (<span class="keywordtype">int</span>)(<a class="code" href="lspmac_8c.html#abdc45e3f7106f84f688419e2da9b3627" title="PMAC command size in bytes.">pmac_cmd_size</a> + ntohs(cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#af5df25ff13ca30fa33719d0df1ab7e97" title="Number of bytes in bData.">wLength</a>)));
<a name="l00634"></a>00634             wnoutrefresh( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>);
<a name="l00635"></a>00635             wnoutrefresh( <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>);
<a name="l00636"></a>00636             doupdate();
<a name="l00637"></a>00637             pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00638"></a>00638           }
<a name="l00639"></a>00639         }
<a name="l00640"></a>00640       }
<a name="l00641"></a>00641       <span class="keywordflow">if</span>( cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a0dc566e7edbb226f1a4ea443d93d56e2" title="The command to run (VR_PMAC_GETMEM, etc).">Request</a> == <a class="code" href="lspmac_8c.html#a76c1c401354826ac2ba8906578be930f">VR_PMAC_SENDCTRLCHAR</a>)
<a name="l00642"></a>00642         <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#adef540911028fda73e8bbf0aa6ad39e9">LS_PMAC_STATE_WACK_CC</a>;
<a name="l00643"></a>00643       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a9ac7618bbe0faa3001e8efeb1d89010d" title="the pmac command to send">pcmd</a>.<a class="code" href="structtagEthernetCmd.html#a0dc566e7edbb226f1a4ea443d93d56e2" title="The command to run (VR_PMAC_GETMEM, etc).">Request</a> == <a class="code" href="lspmac_8c.html#af9c53e7c5b2681a5ca1c5410a914a2dc">VR_PMAC_GETMEM</a>)
<a name="l00644"></a>00644         <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a220b39710719cfe8b500d51819e8efeb">LS_PMAC_STATE_GMR</a>;
<a name="l00645"></a>00645       <span class="keywordflow">else</span> <span class="keywordflow">if</span>( cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#a33f70b45f8b7c27935cd3efe28748479" title="1 = no reply is expected, 0 = expect a reply">no_reply</a> == 0)
<a name="l00646"></a>00646         <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a5eba9ef09d4316e803b9d75bd3104f43">LS_PMAC_STATE_WACK</a>;
<a name="l00647"></a>00647       <span class="keywordflow">else</span>
<a name="l00648"></a>00648         <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a63356b0c18fcb186f456c12c6e927d84">LS_PMAC_STATE_WACK_NFR</a>;
<a name="l00649"></a>00649       <span class="keywordflow">break</span>;
<a name="l00650"></a>00650 
<a name="l00651"></a>00651     <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#abbd709b56a71eb1fc6adc9063605d243">LS_PMAC_STATE_CR</a>:
<a name="l00652"></a>00652       nsent = send( evt-&gt;fd, &amp;<a class="code" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81" title="commands to send out &amp;quot;readready&amp;quot;, &amp;quot;getbuffer&amp;quot;, controlresponse...">cr_cmd</a>, <a class="code" href="lspmac_8c.html#abdc45e3f7106f84f688419e2da9b3627" title="PMAC command size in bytes.">pmac_cmd_size</a>, 0);
<a name="l00653"></a>00653       gettimeofday( &amp;pmac_time_sent, NULL);
<a name="l00654"></a>00654       <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a27ee6c39d58604c8aa9bd6c249c4833f">LS_PMAC_STATE_WCR</a>;
<a name="l00655"></a>00655       <span class="keywordflow">break</span>;
<a name="l00656"></a>00656 
<a name="l00657"></a>00657     <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#add5325f4a84e4fe05f558880349485ea">LS_PMAC_STATE_RR</a>:
<a name="l00658"></a>00658       nsent = send( evt-&gt;fd, &amp;<a class="code" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a>, <a class="code" href="lspmac_8c.html#abdc45e3f7106f84f688419e2da9b3627" title="PMAC command size in bytes.">pmac_cmd_size</a>, 0);
<a name="l00659"></a>00659       gettimeofday( &amp;pmac_time_sent, NULL);
<a name="l00660"></a>00660       <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a3e0a62cd9a1212419ad3615c34bdc65a">LS_PMAC_STATE_WACK_RR</a>;
<a name="l00661"></a>00661       <span class="keywordflow">break</span>;
<a name="l00662"></a>00662 
<a name="l00663"></a>00663     <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a5f4ff8874677aac48a4c675f2c1ca4e9">LS_PMAC_STATE_GB</a>:
<a name="l00664"></a>00664       nsent = send( evt-&gt;fd, &amp;<a class="code" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a>, <a class="code" href="lspmac_8c.html#abdc45e3f7106f84f688419e2da9b3627" title="PMAC command size in bytes.">pmac_cmd_size</a>, 0);
<a name="l00665"></a>00665       gettimeofday( &amp;pmac_time_sent, NULL);
<a name="l00666"></a>00666       <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a591822cc92f76a39b293c2e90b322db2">LS_PMAC_STATE_WGB</a>;
<a name="l00667"></a>00667       <span class="keywordflow">break</span>;
<a name="l00668"></a>00668     }
<a name="l00669"></a>00669   }
<a name="l00670"></a>00670 
<a name="l00671"></a>00671   <span class="keywordflow">if</span>( evt-&gt;revents &amp; POLLIN) {
<a name="l00672"></a>00672 
<a name="l00673"></a>00673     <span class="keywordflow">if</span>( receiveBufferSize - receiveBufferIn &lt; 1400) {
<a name="l00674"></a>00674       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *newbuff;
<a name="l00675"></a>00675 
<a name="l00676"></a>00676       receiveBufferSize += 1400;
<a name="l00677"></a>00677       newbuff = calloc( receiveBufferSize, <span class="keyword">sizeof</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>));
<a name="l00678"></a>00678       <span class="keywordflow">if</span>( newbuff == NULL) {
<a name="l00679"></a>00679         pthread_mutex_lock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00680"></a>00680         wprintw( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>, <span class="stringliteral">&quot;\nOut of memory\n&quot;</span>);
<a name="l00681"></a>00681         wnoutrefresh( <a class="code" href="pgpmac_8c.html#a65daf0f4a5bc6def23a9df98ff5ca57e" title="place to print stuff out">term_output</a>);
<a name="l00682"></a>00682         wnoutrefresh( <a class="code" href="pgpmac_8c.html#ab0487111dbe3c05d0bd835eb2fb9a3f7" title="place to put the cursor">term_input</a>);
<a name="l00683"></a>00683         doupdate();
<a name="l00684"></a>00684         pthread_mutex_unlock( &amp;<a class="code" href="pgpmac_8c.html#ad128c64890c7c0d4f836d9ec6e99216a" title="allow more than one thread access to the screen">ncurses_mutex</a>);
<a name="l00685"></a>00685         exit( -1);
<a name="l00686"></a>00686       }
<a name="l00687"></a>00687       memcpy( newbuff, receiveBuffer, receiveBufferIn);
<a name="l00688"></a>00688       receiveBuffer = newbuff;
<a name="l00689"></a>00689     }
<a name="l00690"></a>00690 
<a name="l00691"></a>00691     nread = read( evt-&gt;fd, receiveBuffer + receiveBufferIn, 1400);
<a name="l00692"></a>00692 
<a name="l00693"></a>00693     foundEOCR = 0;
<a name="l00694"></a>00694     <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> == <a class="code" href="lspmac_8c.html#a220b39710719cfe8b500d51819e8efeb">LS_PMAC_STATE_GMR</a>) {
<a name="l00695"></a>00695       <span class="comment">//</span>
<a name="l00696"></a>00696       <span class="comment">// get memory returns binary stuff, don&apos;t try to parse it</span>
<a name="l00697"></a>00697       <span class="comment">//</span>
<a name="l00698"></a>00698       receiveBufferIn += nread;
<a name="l00699"></a>00699     } <span class="keywordflow">else</span> {
<a name="l00700"></a>00700       <span class="comment">//</span>
<a name="l00701"></a>00701       <span class="comment">// other commands end in 6 if OK, 7 if not</span>
<a name="l00702"></a>00702       <span class="comment">//</span>
<a name="l00703"></a>00703       <span class="keywordflow">for</span>( i=receiveBufferIn; i&lt;receiveBufferIn+nread; i++) {
<a name="l00704"></a>00704         <span class="keywordflow">if</span>( receiveBuffer[i] == 7) {
<a name="l00705"></a>00705           <span class="comment">//</span>
<a name="l00706"></a>00706           <span class="comment">// Error condition</span>
<a name="l00707"></a>00707           <span class="comment">//</span>
<a name="l00708"></a>00708           <a class="code" href="lspmac_8c.html#a2442c529b024e9c23c4acef8c1eb8689" title="The service routing detected an error condition.">lspmac_Error</a>( &amp;(receiveBuffer[i]));
<a name="l00709"></a>00709           receiveBufferIn = 0;
<a name="l00710"></a>00710           <span class="keywordflow">return</span>;
<a name="l00711"></a>00711         }
<a name="l00712"></a>00712         <span class="keywordflow">if</span>( receiveBuffer[i] == 6) {
<a name="l00713"></a>00713           <span class="comment">//</span>
<a name="l00714"></a>00714           <span class="comment">// End of command response</span>
<a name="l00715"></a>00715           <span class="comment">//</span>
<a name="l00716"></a>00716           foundEOCR = 1;
<a name="l00717"></a>00717           receiveBuffer[i] = 0;
<a name="l00718"></a>00718           <span class="keywordflow">break</span>;
<a name="l00719"></a>00719         }
<a name="l00720"></a>00720       }
<a name="l00721"></a>00721       receiveBufferIn = i;
<a name="l00722"></a>00722     }
<a name="l00723"></a>00723 
<a name="l00724"></a>00724     cmd = NULL;
<a name="l00725"></a>00725 
<a name="l00726"></a>00726     <span class="keywordflow">switch</span>( <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a>) {
<a name="l00727"></a>00727     <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a63356b0c18fcb186f456c12c6e927d84">LS_PMAC_STATE_WACK_NFR</a>:
<a name="l00728"></a>00728       receiveBuffer[--receiveBufferIn] = 0;
<a name="l00729"></a>00729       cmd = <a class="code" href="lspmac_8c.html#a0f60f18dfe11c1c0299909521596be8f" title="Remove the next command queue item that is waiting for a reply.">lspmac_pop_reply</a>();
<a name="l00730"></a>00730       <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a37741af675425d61c876cc30ae6c99d0">LS_PMAC_STATE_IDLE</a>;
<a name="l00731"></a>00731       <span class="keywordflow">break</span>;
<a name="l00732"></a>00732     <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a5eba9ef09d4316e803b9d75bd3104f43">LS_PMAC_STATE_WACK</a>:
<a name="l00733"></a>00733       receiveBuffer[--receiveBufferIn] = 0;
<a name="l00734"></a>00734       <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#add5325f4a84e4fe05f558880349485ea">LS_PMAC_STATE_RR</a>;
<a name="l00735"></a>00735       <span class="keywordflow">break</span>;
<a name="l00736"></a>00736     <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#adef540911028fda73e8bbf0aa6ad39e9">LS_PMAC_STATE_WACK_CC</a>:
<a name="l00737"></a>00737       receiveBuffer[--receiveBufferIn] = 0;
<a name="l00738"></a>00738       <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#abbd709b56a71eb1fc6adc9063605d243">LS_PMAC_STATE_CR</a>;
<a name="l00739"></a>00739       <span class="keywordflow">break</span>;
<a name="l00740"></a>00740     <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a3e0a62cd9a1212419ad3615c34bdc65a">LS_PMAC_STATE_WACK_RR</a>:
<a name="l00741"></a>00741       receiveBufferIn -= 2;
<a name="l00742"></a>00742       <span class="keywordflow">if</span>( receiveBuffer[receiveBufferIn])
<a name="l00743"></a>00743         <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a5f4ff8874677aac48a4c675f2c1ca4e9">LS_PMAC_STATE_GB</a>;
<a name="l00744"></a>00744       <span class="keywordflow">else</span>
<a name="l00745"></a>00745         <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#add5325f4a84e4fe05f558880349485ea">LS_PMAC_STATE_RR</a>;
<a name="l00746"></a>00746       receiveBuffer[receiveBufferIn] = 0;
<a name="l00747"></a>00747       <span class="keywordflow">break</span>;
<a name="l00748"></a>00748     <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a220b39710719cfe8b500d51819e8efeb">LS_PMAC_STATE_GMR</a>:
<a name="l00749"></a>00749       cmd = <a class="code" href="lspmac_8c.html#a0f60f18dfe11c1c0299909521596be8f" title="Remove the next command queue item that is waiting for a reply.">lspmac_pop_reply</a>();
<a name="l00750"></a>00750       <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a37741af675425d61c876cc30ae6c99d0">LS_PMAC_STATE_IDLE</a>;
<a name="l00751"></a>00751       <span class="keywordflow">break</span>;
<a name="l00752"></a>00752 
<a name="l00753"></a>00753     <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a27ee6c39d58604c8aa9bd6c249c4833f">LS_PMAC_STATE_WCR</a>:
<a name="l00754"></a>00754       cmd = <a class="code" href="lspmac_8c.html#a0f60f18dfe11c1c0299909521596be8f" title="Remove the next command queue item that is waiting for a reply.">lspmac_pop_reply</a>();
<a name="l00755"></a>00755       <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a37741af675425d61c876cc30ae6c99d0">LS_PMAC_STATE_IDLE</a>;
<a name="l00756"></a>00756       <span class="keywordflow">break</span>;
<a name="l00757"></a>00757     <span class="keywordflow">case</span> <a class="code" href="lspmac_8c.html#a591822cc92f76a39b293c2e90b322db2">LS_PMAC_STATE_WGB</a>:
<a name="l00758"></a>00758       <span class="keywordflow">if</span>( foundEOCR) {
<a name="l00759"></a>00759         cmd = <a class="code" href="lspmac_8c.html#a0f60f18dfe11c1c0299909521596be8f" title="Remove the next command queue item that is waiting for a reply.">lspmac_pop_reply</a>();
<a name="l00760"></a>00760         <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#a37741af675425d61c876cc30ae6c99d0">LS_PMAC_STATE_IDLE</a>;
<a name="l00761"></a>00761       } <span class="keywordflow">else</span> {
<a name="l00762"></a>00762         <a class="code" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390" title="Current state of the PMAC communications state machine.">ls_pmac_state</a> = <a class="code" href="lspmac_8c.html#add5325f4a84e4fe05f558880349485ea">LS_PMAC_STATE_RR</a>;
<a name="l00763"></a>00763       }
<a name="l00764"></a>00764       <span class="keywordflow">break</span>;
<a name="l00765"></a>00765     }
<a name="l00766"></a>00766 
<a name="l00767"></a>00767 
<a name="l00768"></a>00768     <span class="keywordflow">if</span>( cmd != NULL &amp;&amp; cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#afe92c0bab9f124314a6f3d8104c94364" title="function to call when response is received. args are (int fd, nreturned, buffer)">onResponse</a> != NULL) {
<a name="l00769"></a>00769       cmd-&gt;<a class="code" href="structlspmac__cmd__queue__struct.html#afe92c0bab9f124314a6f3d8104c94364" title="function to call when response is received. args are (int fd, nreturned, buffer)">onResponse</a>( cmd, receiveBufferIn, receiveBuffer);
<a name="l00770"></a>00770       receiveBufferIn = 0;
<a name="l00771"></a>00771     }
<a name="l00772"></a>00772   }
<a name="l00773"></a>00773 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ace8c4474ee2e91a06486e89edcb2acc1"></a><!-- doxytag: member="lspmac.c::lspmac_shutter_read" ref="ace8c4474ee2e91a06486e89edcb2acc1" args="(lspmac_motor_t *mp) pthread_mutex_lock(&amp;lspmac_shutter_mutex)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_shutter_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> *&nbsp;</td>
          <td class="paramname"> <em>mp</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Fast shutter read routine The shutter is mildly complicated in that we need to take into account the fact that the shutter can open and close again between status updates. </p>
<p>This means that we need to rely on a PCL program running in the PMAC to monitor the shutter state and let us know that this has happened. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>mp</em>&nbsp;</td><td>The motor object associated with the fast shutter </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ac5745f25f242edf02f7b9b7c77ed6126"></a><!-- doxytag: member="lspmac.c::lspmac_SockFlush" ref="ac5745f25f242edf02f7b9b7c77ed6126" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspmac_SockFlush </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reset the PMAC socket from the PMAC side. </p>
<p>Puts the PMAC into a known communications state </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00534">534</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00534"></a>00534                         {
<a name="l00535"></a>00535   <a class="code" href="lspmac_8c.html#a1e472a11df3765763c2fe92dd358bf0c" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#af24ecdc10723dc8fd6320fef416ae514">VR_DOWNLOAD</a>, <a class="code" href="lspmac_8c.html#ac0e5588681366b52589cd321eabf12ff">VR_PMAC_FLUSH</a>, 0, 0, 0, NULL, NULL, 1);
<a name="l00536"></a>00536 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0a56c777b1469ad8c3d29d825a71e300"></a><!-- doxytag: member="lspmac.c::lspmac_SockGetmem" ref="a0a56c777b1469ad8c3d29d825a71e300" args="(int offset, int nbytes)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a>* lspmac_SockGetmem </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nbytes</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Request a chunk of memory to be returned. </p>
<p>Not currently used </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>offset</em>&nbsp;</td><td>Offset in PMAC Double Buffer </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>nbytes</em>&nbsp;</td><td>Number of bytes to request </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00850">850</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00853"></a>00853                                        {
<a name="l00854"></a>00854   <span class="keywordflow">return</span> <a class="code" href="lspmac_8c.html#a1e472a11df3765763c2fe92dd358bf0c" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#a5485d08fdc80533b5cebadff63696ed2">VR_UPLOAD</a>,   <a class="code" href="lspmac_8c.html#af9c53e7c5b2681a5ca1c5410a914a2dc">VR_PMAC_GETMEM</a>, offset, 0, nbytes, NULL, <a class="code" href="lspmac_8c.html#aaa3323f952efd66e63ff864932da5ced" title="Service a reply to the getmem command.">lspmac_GetmemReplyCB</a>, 0);
<a name="l00855"></a>00855 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a53ee9ff1a8ca316901babf8314b423de"></a><!-- doxytag: member="lspmac.c::lspmac_SockSendControlCharPrint" ref="a53ee9ff1a8ca316901babf8314b423de" args="(char c)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a>* lspmac_SockSendControlCharPrint </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>c</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Send a control character. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>The control character to send </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00894">894</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00896"></a>00896                                                     {
<a name="l00897"></a>00897   <span class="keywordflow">return</span> <a class="code" href="lspmac_8c.html#a1e472a11df3765763c2fe92dd358bf0c" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#af24ecdc10723dc8fd6320fef416ae514">VR_DOWNLOAD</a>, <a class="code" href="lspmac_8c.html#a76c1c401354826ac2ba8906578be930f">VR_PMAC_SENDCTRLCHAR</a>, c, 0, 0, NULL, <a class="code" href="lspmac_8c.html#ac23af52b8d3a8f2722d4804d5340fa6c" title="Receive a reply to a control character Print a &amp;quot;printable&amp;quot; version of the...">lspmac_SendControlReplyPrintCB</a>, 0);
<a name="l00898"></a>00898 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aaa442d9bc7a3cdee39adea0724f0e18c"></a><!-- doxytag: member="lspmac.c::lspmac_SockSendline" ref="aaa442d9bc7a3cdee39adea0724f0e18c" args="(char *fmt,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a>* lspmac_SockSendline </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Send a one line command. </p>
<p>Uses printf style arguments. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fmt</em>&nbsp;</td><td>Printf style format string </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00860">860</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00863"></a>00863                                          {
<a name="l00864"></a>00864   va_list arg_ptr;
<a name="l00865"></a>00865   <span class="keywordtype">char</span> payload[1400];
<a name="l00866"></a>00866 
<a name="l00867"></a>00867   va_start( arg_ptr, fmt);
<a name="l00868"></a>00868   vsnprintf( payload, <span class="keyword">sizeof</span>(payload)-1, fmt, arg_ptr);
<a name="l00869"></a>00869   payload[ <span class="keyword">sizeof</span>(payload)-1] = 0;
<a name="l00870"></a>00870   va_end( arg_ptr);
<a name="l00871"></a>00871 
<a name="l00872"></a>00872   <span class="keywordflow">return</span> <a class="code" href="lspmac_8c.html#a1e472a11df3765763c2fe92dd358bf0c" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#af24ecdc10723dc8fd6320fef416ae514">VR_DOWNLOAD</a>, <a class="code" href="lspmac_8c.html#a772b2ea2ad93989ae4275c79a93525ee">VR_PMAC_SENDLINE</a>, 0, 0, strlen( payload), payload, <a class="code" href="lspmac_8c.html#ac89b615b3ecb738c902c3c090d7c1dc3" title="Receive a reply that does not require multiple buffers.">lspmac_GetShortReplyCB</a>, 0);
<a name="l00873"></a>00873 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac4cf3a79186859714d8a8293377526ba"></a><!-- doxytag: member="lspmac.c::lspmac_SockSendline_nr" ref="ac4cf3a79186859714d8a8293377526ba" args="(char *fmt,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a>* lspmac_SockSendline_nr </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Send a command and ignore the response. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>fmt</em>&nbsp;</td><td>Printf style format string </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00877">877</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00880"></a>00880                                            {
<a name="l00881"></a>00881   va_list arg_ptr;
<a name="l00882"></a>00882   <span class="keywordtype">char</span> s[512];
<a name="l00883"></a>00883 
<a name="l00884"></a>00884   va_start( arg_ptr, fmt);
<a name="l00885"></a>00885   vsnprintf( s, <span class="keyword">sizeof</span>(s)-1, fmt, arg_ptr);
<a name="l00886"></a>00886   s[<span class="keyword">sizeof</span>(s)-1] = 0;
<a name="l00887"></a>00887   va_end( arg_ptr);
<a name="l00888"></a>00888 
<a name="l00889"></a>00889   <span class="keywordflow">return</span> <a class="code" href="lspmac_8c.html#a1e472a11df3765763c2fe92dd358bf0c" title="Compose a packet and send it to the PMAC.">lspmac_send_command</a>( <a class="code" href="lspmac_8c.html#af24ecdc10723dc8fd6320fef416ae514">VR_DOWNLOAD</a>, <a class="code" href="lspmac_8c.html#a772b2ea2ad93989ae4275c79a93525ee">VR_PMAC_SENDLINE</a>, 0, 0, strlen( s), s, NULL, 1);
<a name="l00890"></a>00890 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abdec5883055967b1eda043670870f55f"></a><!-- doxytag: member="lspmac.c::lspmac_worker" ref="abdec5883055967b1eda043670870f55f" args="(void *dummy)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* lspmac_worker </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>dummy</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Our lspmac worker thread. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dummy</em>&nbsp;</td><td>Unused but required by pthread library </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l01362">1362</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01364"></a>01364                       {
<a name="l01365"></a>01365 
<a name="l01366"></a>01366   <span class="keywordflow">while</span>( 1) {
<a name="l01367"></a>01367     <span class="keywordtype">int</span> pollrtn;
<a name="l01368"></a>01368 
<a name="l01369"></a>01369     <a class="code" href="lspmac_8c.html#a68886d1b658e7b1d996c07e9dbcd9c15" title="State machine logic.">lspmac_next_state</a>();
<a name="l01370"></a>01370 
<a name="l01371"></a>01371     <span class="keywordflow">if</span>( <a class="code" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba" title="our poll structure">pmacfd</a>.fd == -1) {
<a name="l01372"></a>01372       sleep( 10);       <span class="comment">// The pmac is not connected.  Should we warn someone?</span>
<a name="l01373"></a>01373       <span class="comment">//</span>
<a name="l01374"></a>01374       <span class="comment">// This just puts us into a holding pattern until the pmac becomes connected again</span>
<a name="l01375"></a>01375       <span class="comment">//</span>
<a name="l01376"></a>01376       <span class="comment">// TODO:</span>
<a name="l01377"></a>01377       <span class="comment">// Check PMAC initialization logic and our queues to ensure that it is sane to</span>
<a name="l01378"></a>01378       <span class="comment">// re-initialize things.  Probably bad things will happen.</span>
<a name="l01379"></a>01379       <span class="comment">//</span>
<a name="l01380"></a>01380       <span class="keywordflow">continue</span>;
<a name="l01381"></a>01381     }
<a name="l01382"></a>01382 
<a name="l01383"></a>01383     pollrtn = poll( &amp;<a class="code" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba" title="our poll structure">pmacfd</a>, 1, 10);
<a name="l01384"></a>01384     <span class="keywordflow">if</span>( pollrtn) {
<a name="l01385"></a>01385       <a class="code" href="lspmac_8c.html#af3fa79868ba88f7c37f7b8f7d53149ff" title="Service routine for packet coming from the PMAC.">lspmac_Service</a>( &amp;<a class="code" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba" title="our poll structure">pmacfd</a>);
<a name="l01386"></a>01386     }
<a name="l01387"></a>01387   }
<a name="l01388"></a>01388 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a6cb218bdccfe5a93471c161f15a15cab"></a><!-- doxytag: member="lspmac.c::alignx" ref="a6cb218bdccfe5a93471c161f15a15cab" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a>* <a class="el" href="pgpmac_8h.html#a6cb218bdccfe5a93471c161f15a15cab">alignx</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Alignment stage X. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00074">74</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a737c246c3948e644a18d191a931e1acd"></a><!-- doxytag: member="lspmac.c::aligny" ref="a737c246c3948e644a18d191a931e1acd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a>* <a class="el" href="pgpmac_8h.html#a737c246c3948e644a18d191a931e1acd">aligny</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Alignment stage Y. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00075">75</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae7642b1da0f7c7f8448104c691d40a12"></a><!-- doxytag: member="lspmac.c::alignz" ref="ae7642b1da0f7c7f8448104c691d40a12" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a>* <a class="el" href="pgpmac_8h.html#ae7642b1da0f7c7f8448104c691d40a12">alignz</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Alignment stage X. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00076">76</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa90d2363b744acbd4d45133b7a716d8f"></a><!-- doxytag: member="lspmac.c::anal" ref="aa90d2363b744acbd4d45133b7a716d8f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a>* <a class="el" href="pgpmac_8h.html#aa90d2363b744acbd4d45133b7a716d8f">anal</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Polaroid analyzer motor. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00077">77</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a139200ddaa9856a7ffcec0e6cbaa8f1b"></a><!-- doxytag: member="lspmac.c::apery" ref="a139200ddaa9856a7ffcec0e6cbaa8f1b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a>* <a class="el" href="pgpmac_8h.html#a139200ddaa9856a7ffcec0e6cbaa8f1b">apery</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Aperture Y. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00079">79</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab93bd6ee850b285ca3a95e64d15e9477"></a><!-- doxytag: member="lspmac.c::aperz" ref="ab93bd6ee850b285ca3a95e64d15e9477" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a>* <a class="el" href="pgpmac_8h.html#ab93bd6ee850b285ca3a95e64d15e9477">aperz</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Aperture Z. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00080">80</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a85d6eaa4b4a82bb3112574f458d1dc50"></a><!-- doxytag: member="lspmac.c::blight" ref="a85d6eaa4b4a82bb3112574f458d1dc50" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a>* <a class="el" href="pgpmac_8h.html#a85d6eaa4b4a82bb3112574f458d1dc50">blight</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Back Light DAC. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00091">91</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="af813a2eff0b7efa4c70633559054e84c"></a><!-- doxytag: member="lspmac.c::blight_ud" ref="af813a2eff0b7efa4c70633559054e84c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a>* <a class="el" href="lspmac_8c.html#af813a2eff0b7efa4c70633559054e84c">blight_ud</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Back Light Up/Down actuator. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00094">94</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a51358daaea8b5236f08414877d8af6c2"></a><!-- doxytag: member="lspmac.c::capy" ref="a51358daaea8b5236f08414877d8af6c2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a>* <a class="el" href="pgpmac_8h.html#a51358daaea8b5236f08414877d8af6c2">capy</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Capillary Y. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00081">81</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa45f268d0af9f3d465acfab128919718"></a><!-- doxytag: member="lspmac.c::capz" ref="aa45f268d0af9f3d465acfab128919718" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a>* <a class="el" href="pgpmac_8h.html#aa45f268d0af9f3d465acfab128919718">capz</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Capillary Z. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00082">82</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac940d950d9efeaf3f0ae67e9bf331188"></a><!-- doxytag: member="lspmac.c::cenx" ref="ac940d950d9efeaf3f0ae67e9bf331188" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a>* <a class="el" href="pgpmac_8h.html#ac940d950d9efeaf3f0ae67e9bf331188">cenx</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Centering Table X. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00084">84</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aaed18e738ba7bfb6c771a44f5d7ea827"></a><!-- doxytag: member="lspmac.c::ceny" ref="aaed18e738ba7bfb6c771a44f5d7ea827" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a>* <a class="el" href="pgpmac_8h.html#aaed18e738ba7bfb6c771a44f5d7ea827">ceny</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Centering Table Y. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00085">85</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8908812f4ff25c196679e00d330edd81"></a><!-- doxytag: member="lspmac.c::cr_cmd" ref="a8908812f4ff25c196679e00d330edd81" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structtagEthernetCmd.html">pmac_cmd_t</a> <a class="el" href="lspmac_8c.html#a8908812f4ff25c196679e00d330edd81">cr_cmd</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>commands to send out "readready", "getbuffer", controlresponse (initialized in main) </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00138">138</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9da2795d11ccbc3a060c4811770ad04c"></a><!-- doxytag: member="lspmac.c::dbmem" ref="a9da2795d11ccbc3a060c4811770ad04c" args="[64 *1024]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char <a class="el" href="lspmac_8c.html#a9da2795d11ccbc3a060c4811770ad04c">dbmem</a>[64 *1024]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>double buffered memory </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00128">128</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa0be2f26364c4d12c9c81c10913f0b26"></a><!-- doxytag: member="lspmac.c::dbmemIn" ref="aa0be2f26364c4d12c9c81c10913f0b26" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="lspmac_8c.html#aa0be2f26364c4d12c9c81c10913f0b26">dbmemIn</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>next location </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00129">129</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae85caec6f4ddb2fc52ca14a26549ab08"></a><!-- doxytag: member="lspmac.c::ethCmdOff" ref="ae85caec6f4ddb2fc52ca14a26549ab08" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="lspmac_8c.html#ae85caec6f4ddb2fc52ca14a26549ab08">ethCmdOff</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>points to current command (or none if == ethCmdOn) </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00141">141</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad62b1f9e907acc3de9f3d6a05d55829e"></a><!-- doxytag: member="lspmac.c::ethCmdOn" ref="ad62b1f9e907acc3de9f3d6a05d55829e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="lspmac_8c.html#ad62b1f9e907acc3de9f3d6a05d55829e">ethCmdOn</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>points to next empty PMAC command queue position </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00140">140</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a69e569a833fe7f202b92e860d1548f2b"></a><!-- doxytag: member="lspmac.c::ethCmdQueue" ref="a69e569a833fe7f202b92e860d1548f2b" args="[PMAC_CMD_QUEUE_LENGTH]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__cmd__queue__struct.html">pmac_cmd_queue_t</a> <a class="el" href="lspmac_8c.html#a69e569a833fe7f202b92e860d1548f2b">ethCmdQueue</a>[PMAC_CMD_QUEUE_LENGTH]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>PMAC command queue. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00139">139</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7a78524ada402bb74759a3dfc5f8a571"></a><!-- doxytag: member="lspmac.c::ethCmdReply" ref="a7a78524ada402bb74759a3dfc5f8a571" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="lspmac_8c.html#a7a78524ada402bb74759a3dfc5f8a571">ethCmdReply</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Used like ethCmdOff only to deal with the pmac reply to a command. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00142">142</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aeb09895663eff333b7a75acb319a9fc1"></a><!-- doxytag: member="lspmac.c::flight" ref="aeb09895663eff333b7a75acb319a9fc1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a>* <a class="el" href="pgpmac_8h.html#aeb09895663eff333b7a75acb319a9fc1">flight</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Front Light DAC. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00090">90</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8a3ca6fcf5e24dcc26170736843e53b2"></a><!-- doxytag: member="lspmac.c::fscint" ref="a8a3ca6fcf5e24dcc26170736843e53b2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a>* <a class="el" href="pgpmac_8h.html#a8a3ca6fcf5e24dcc26170736843e53b2">fscint</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Scintillator Piezo DAC. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00092">92</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a26dec4623af9beed912b8e7e6f99822c"></a><!-- doxytag: member="lspmac.c::fshut" ref="a26dec4623af9beed912b8e7e6f99822c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a>* <a class="el" href="pgpmac_8h.html#a26dec4623af9beed912b8e7e6f99822c">fshut</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Fast shutter. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00089">89</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae7b21213b9c78b6745213409f1ef7320"></a><!-- doxytag: member="lspmac.c::gb_cmd" ref="ae7b21213b9c78b6745213409f1ef7320" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structtagEthernetCmd.html">pmac_cmd_t</a> <a class="el" href="lspmac_8c.html#ae7b21213b9c78b6745213409f1ef7320">gb_cmd</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00138">138</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a07b7b8254772075e6a4ced500b589c36"></a><!-- doxytag: member="lspmac.c::getivars" ref="a07b7b8254772075e6a4ced500b589c36" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="lspmac_8c.html#a07b7b8254772075e6a4ced500b589c36">getivars</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>flag set at initialization to send i vars to db </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00068">68</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a50e9c0a06654fd81b3446a6e54ff12c3"></a><!-- doxytag: member="lspmac.c::getmvars" ref="a50e9c0a06654fd81b3446a6e54ff12c3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="lspmac_8c.html#a50e9c0a06654fd81b3446a6e54ff12c3">getmvars</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>flag set at initialization to send m vars to db </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00069">69</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a0be79ccb7ebf3a665248fd856112b9fd"></a><!-- doxytag: member="lspmac.c::kappa" ref="a0be79ccb7ebf3a665248fd856112b9fd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a>* <a class="el" href="pgpmac_8h.html#a0be79ccb7ebf3a665248fd856112b9fd">kappa</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Kappa. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00086">86</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1de136a293a8e4bd306e692218a81587"></a><!-- doxytag: member="lspmac.c::linesReceived" ref="a1de136a293a8e4bd306e692218a81587" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="lspmac_8c.html#a1de136a293a8e4bd306e692218a81587">linesReceived</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>current number of lines received </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00127">127</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6d9261680ee01b1e106d1ea1d7ffa390"></a><!-- doxytag: member="lspmac.c::ls_pmac_state" ref="a6d9261680ee01b1e106d1ea1d7ffa390" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="lspmac_8c.html#a6d9261680ee01b1e106d1ea1d7ffa390">ls_pmac_state</a> = LS_PMAC_STATE_DETACHED<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Current state of the PMAC communications state machine. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00052">52</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9bffbf72495499b505543cd942f665da"></a><!-- doxytag: member="lspmac.c::lspmac_motors" ref="a9bffbf72495499b505543cd942f665da" args="[32]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a> <a class="el" href="pgpmac_8h.html#aebfce5f9cbc8ba7bd4e2ee4880f303e8">lspmac_motors</a>[32]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>All our motors. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00071">71</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a57547d211906c981ef20257eba99f8df"></a><!-- doxytag: member="lspmac.c::lspmac_moving_cond" ref="a57547d211906c981ef20257eba99f8df" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_cond_t <a class="el" href="pgpmac_8h.html#a57547d211906c981ef20257eba99f8df">lspmac_moving_cond</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Wait for motor(s) to finish moving condition. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00059">59</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7a32c617c183166308241e270959df56"></a><!-- doxytag: member="lspmac.c::lspmac_moving_flags" ref="a7a32c617c183166308241e270959df56" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="pgpmac_8h.html#a7a32c617c183166308241e270959df56">lspmac_moving_flags</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Flag used to implement motor moving condition. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00060">60</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a85679cac947e199c88794f8e5a12bf5f"></a><!-- doxytag: member="lspmac.c::lspmac_moving_mutex" ref="a85679cac947e199c88794f8e5a12bf5f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t <a class="el" href="pgpmac_8h.html#a85679cac947e199c88794f8e5a12bf5f">lspmac_moving_mutex</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Coordinate moving motors between threads. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00058">58</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a56260f012c50a591ee7f97e500f16994"></a><!-- doxytag: member="lspmac.c::lspmac_nmotors" ref="a56260f012c50a591ee7f97e500f16994" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="pgpmac_8h.html#a56260f012c50a591ee7f97e500f16994">lspmac_nmotors</a> = 0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The number of motors we manage. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00072">72</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="afbd51c2cefcee87afe994c9e9f372241"></a><!-- doxytag: member="lspmac.c::lspmac_shutter_cond" ref="afbd51c2cefcee87afe994c9e9f372241" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_cond_t <a class="el" href="pgpmac_8h.html#afbd51c2cefcee87afe994c9e9f372241">lspmac_shutter_cond</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Allows waiting for the shutter status to change. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00057">57</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2ce5781f7f314dda6e6e9888fa7ba284"></a><!-- doxytag: member="lspmac.c::lspmac_shutter_has_opened" ref="a2ce5781f7f314dda6e6e9888fa7ba284" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a396fbf06208de3ecbe1b0df549f1cd46">lspmac_shutter_has_opened</a> = md2_status.fs_has_opened</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Indicates that the shutter had opened, perhaps briefly even if the state did not change. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00055">55</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1b78a13c654409333569815e1c109d38"></a><!-- doxytag: member="lspmac.c::lspmac_shutter_mutex" ref="a1b78a13c654409333569815e1c109d38" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t <a class="el" href="pgpmac_8h.html#a1b78a13c654409333569815e1c109d38">lspmac_shutter_mutex</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Coordinates threads reading shutter status. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00056">56</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a112158e0cd50449a440ac55c7af7bea2"></a><!-- doxytag: member="lspmac.c::lspmac_shutter_state" ref="a112158e0cd50449a440ac55c7af7bea2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="pgpmac_8h.html#a112158e0cd50449a440ac55c7af7bea2">lspmac_shutter_state</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>State of the shutter, used to detect changes. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00054">54</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad5bce7451d48127bace5af445d03b492"></a><!-- doxytag: member="lspmac.c::md2_status" ref="ad5bce7451d48127bace5af445d03b492" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structmd2StatusStruct.html">md2_status_t</a> <a class="el" href="lspmac_8c.html#ad5bce7451d48127bace5af445d03b492">md2_status</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Buffer for MD2 Status. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00276">276</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7a3e763682bd7f987d07f149e94b3bf8"></a><!-- doxytag: member="lspmac.c::md2_status_mutex" ref="a7a3e763682bd7f987d07f149e94b3bf8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t <a class="el" href="pgpmac_8h.html#a7a3e763682bd7f987d07f149e94b3bf8">md2_status_mutex</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Synchronize reading/writting status buffer. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00277">277</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a4bed9053319d1d2cad5cc03d0549e17f"></a><!-- doxytag: member="lspmac.c::now" ref="a4bed9053319d1d2cad5cc03d0549e17f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct timeval pmac_time_sent <a class="el" href="lspmac_8c.html#a4bed9053319d1d2cad5cc03d0549e17f">now</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>used to ensure we do not send commands to the pmac too often. Only needed for non-DB commands. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00134">134</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8237e646ce032a840637a4ef7bff49b9"></a><!-- doxytag: member="lspmac.c::omega" ref="a8237e646ce032a840637a4ef7bff49b9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a>* <a class="el" href="pgpmac_8h.html#a8237e646ce032a840637a4ef7bff49b9">omega</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>MD2 omega axis (the air bearing). </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00073">73</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac8070dc568ad974a3db42b51eca828cc"></a><!-- doxytag: member="lspmac.c::phi" ref="ac8070dc568ad974a3db42b51eca828cc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a>* <a class="el" href="pgpmac_8h.html#ac8070dc568ad974a3db42b51eca828cc">phi</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Phi (not data collection axis). </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00087">87</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="aab5a76f1ac64049314f9836e5c01fb7e"></a><!-- doxytag: member="lspmac.c::pmac_error_strs" ref="aab5a76f1ac64049314f9836e5c01fb7e" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="lspmac_8c.html#aab5a76f1ac64049314f9836e5c01fb7e">pmac_error_strs</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
  <span class="stringliteral">&quot;ERR000: Unknown error&quot;</span>,
  <span class="stringliteral">&quot;ERR001: Command not allowed during program execution&quot;</span>,
  <span class="stringliteral">&quot;ERR002: Password error&quot;</span>,
  <span class="stringliteral">&quot;ERR003: Data error or unrecognized command&quot;</span>,
  <span class="stringliteral">&quot;ERR004: Illegal character&quot;</span>,
  <span class="stringliteral">&quot;ERR005: Command not allowed unless buffer is open&quot;</span>,
  <span class="stringliteral">&quot;ERR006: No room in buffer for command&quot;</span>,
  <span class="stringliteral">&quot;ERR007: Buffer already in use&quot;</span>,
  <span class="stringliteral">&quot;ERR008: MACRO auziliary communication error&quot;</span>,
  <span class="stringliteral">&quot;ERR009: Program structure error (e.g. ENDIF without IF)&quot;</span>,
  <span class="stringliteral">&quot;ERR010: Both overtravel limits set for a motor in the C.S.&quot;</span>,
  <span class="stringliteral">&quot;ERR011: Previous move not completed&quot;</span>,
  <span class="stringliteral">&quot;ERR012: A motor in the coordinate system is open-loop&quot;</span>,
  <span class="stringliteral">&quot;ERR013: A motor in the coordinate system is not activated&quot;</span>,
  <span class="stringliteral">&quot;ERR014: No motors in the coordinate system&quot;</span>,
  <span class="stringliteral">&quot;ERR015: Not pointer to valid program buffer&quot;</span>,
  <span class="stringliteral">&quot;ERR016: Running improperly structure program (e.g. missing ENDWHILE)&quot;</span>,
  <span class="stringliteral">&quot;ERR017: Trying to resume after H or Q with motors out of stopped position&quot;</span>,
  <span class="stringliteral">&quot;ERR018: Attempt to perform phase reference during move, move during phase reference, or enabling with phase clock error&quot;</span>,
  <span class="stringliteral">&quot;ERR019: Illegal position-chage command while moves stored in CCBUFFER&quot;</span>
}
</pre></div>
<p>Decode the errors perhaps returned by the PMAC. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00145">145</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8a25bd9c593c6985107f90f999ce0b08"></a><!-- doxytag: member="lspmac.c::pmac_queue_cond" ref="a8a25bd9c593c6985107f90f999ce0b08" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_cond_t <a class="el" href="lspmac_8c.html#a8a25bd9c593c6985107f90f999ce0b08">pmac_queue_cond</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>wait for a command to be sent to PMAC before continuing </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00065">65</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="acc1bb77b9bcbc4d970f841a41fd274b3"></a><!-- doxytag: member="lspmac.c::pmac_queue_mutex" ref="acc1bb77b9bcbc4d970f841a41fd274b3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t <a class="el" href="lspmac_8c.html#acc1bb77b9bcbc4d970f841a41fd274b3">pmac_queue_mutex</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>manage access to the pmac command queue </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00064">64</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6b7011dd7d2c2d3afadff8d3e50e7677"></a><!-- doxytag: member="lspmac.c::pmac_thread" ref="a6b7011dd7d2c2d3afadff8d3e50e7677" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_t <a class="el" href="lspmac_8c.html#a6b7011dd7d2c2d3afadff8d3e50e7677">pmac_thread</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>our thread to manage access and communication to the pmac </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00063">63</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="adba7f5f4bbeabc4dac859221d4c684ba"></a><!-- doxytag: member="lspmac.c::pmacfd" ref="adba7f5f4bbeabc4dac859221d4c684ba" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct pollfd <a class="el" href="lspmac_8c.html#adba7f5f4bbeabc4dac859221d4c684ba">pmacfd</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>our poll structure </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00066">66</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6fcbbe47fe9912533962601f5befdb29"></a><!-- doxytag: member="lspmac.c::rr_cmd" ref="a6fcbbe47fe9912533962601f5befdb29" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structtagEthernetCmd.html">pmac_cmd_t</a> <a class="el" href="lspmac_8c.html#a6fcbbe47fe9912533962601f5befdb29">rr_cmd</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00138">138</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac0eeaffa0996271d8a38344a470d13d7"></a><!-- doxytag: member="lspmac.c::scinz" ref="ac0eeaffa0996271d8a38344a470d13d7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a>* <a class="el" href="pgpmac_8h.html#ac0eeaffa0996271d8a38344a470d13d7">scinz</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Scintillator Z. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00083">83</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad53a42cfaa04eff0336a44c8c9986333"></a><!-- doxytag: member="lspmac.c::zoom" ref="ad53a42cfaa04eff0336a44c8c9986333" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlspmac__motor__struct.html">lspmac_motor_t</a>* <a class="el" href="pgpmac_8h.html#ad53a42cfaa04eff0336a44c8c9986333">zoom</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Optical zoom. </p>

<p>Definition at line <a class="el" href="lspmac_8c_source.html#l00078">78</a> of file <a class="el" href="lspmac_8c_source.html">lspmac.c</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 12 Oct 2012 for LS-CAT PGPMAC by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
