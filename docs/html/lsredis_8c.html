<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LS-CAT PGPMAC: lsredis.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LS-CAT PGPMAC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lsredis_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">lsredis.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Support redis hash synchronization.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="pgpmac_8h_source.html">pgpmac.h</a>&quot;</code><br/>
</div>
<p><a href="lsredis_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlsredis__preset__list__struct.html">lsredis_preset_list_struct</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a8eac570b2b69ea0b7948b6c581cf6002"><td class="memItemLeft" align="right" valign="top">typedef struct <br class="typebreak"/>
<a class="el" href="structlsredis__preset__list__struct.html">lsredis_preset_list_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a8eac570b2b69ea0b7948b6c581cf6002">lsredis_preset_list_t</a></td></tr>
<tr class="separator:a8eac570b2b69ea0b7948b6c581cf6002"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a8268fd06bda0e2c327b057a880b97b59"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a8268fd06bda0e2c327b057a880b97b59">lsredis_debugCB</a> (redisAsyncContext *ac, void *reply, void *privdata)</td></tr>
<tr class="memdesc:a8268fd06bda0e2c327b057a880b97b59"><td class="mdescLeft">&#160;</td><td class="mdescRight">Log the reply.  <a href="#a8268fd06bda0e2c327b057a880b97b59"></a><br/></td></tr>
<tr class="separator:a8268fd06bda0e2c327b057a880b97b59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a05c7ed2bb1b5702a5c83ed3b51abb546"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a05c7ed2bb1b5702a5c83ed3b51abb546">_lsredis_set_value</a> (<a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *p, char *v)</td></tr>
<tr class="memdesc:a05c7ed2bb1b5702a5c83ed3b51abb546"><td class="mdescLeft">&#160;</td><td class="mdescRight">set_value and setstr helper funciton p-&gt;mutex must be locked before calling  <a href="#a05c7ed2bb1b5702a5c83ed3b51abb546"></a><br/></td></tr>
<tr class="separator:a05c7ed2bb1b5702a5c83ed3b51abb546"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3c27bda1c9b10e6db14665951746da8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#ac3c27bda1c9b10e6db14665951746da8">lsredis_set_value</a> (<a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *p, char *fmt,...)</td></tr>
<tr class="memdesc:ac3c27bda1c9b10e6db14665951746da8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the value of a redis object and make it valid.  <a href="#ac3c27bda1c9b10e6db14665951746da8"></a><br/></td></tr>
<tr class="separator:ac3c27bda1c9b10e6db14665951746da8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fc8fd0db4c71c5eae68682b43103078"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a9fc8fd0db4c71c5eae68682b43103078">lsredis_cmpstr</a> (<a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *p, char *s)</td></tr>
<tr class="separator:a9fc8fd0db4c71c5eae68682b43103078"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac356cd43e46799929242dcf5214df7f6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#ac356cd43e46799929242dcf5214df7f6">lsredis_cmpnstr</a> (<a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *p, char *s, int n)</td></tr>
<tr class="separator:ac356cd43e46799929242dcf5214df7f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac58fca47533e695c8775e0d2b9128766"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#ac58fca47533e695c8775e0d2b9128766">lsredis_regexec</a> (const regex_t *preg, <a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *p, size_t nmatch, regmatch_t *pmatch, int eflags)</td></tr>
<tr class="separator:ac58fca47533e695c8775e0d2b9128766"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac1994e56114b2315294527d76311f829"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#ac1994e56114b2315294527d76311f829">lsredis_getstr</a> (<a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *p)</td></tr>
<tr class="memdesc:ac1994e56114b2315294527d76311f829"><td class="mdescLeft">&#160;</td><td class="mdescRight">return a copy of the key's string value be sure to free the result  <a href="#ac1994e56114b2315294527d76311f829"></a><br/></td></tr>
<tr class="separator:ac1994e56114b2315294527d76311f829"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b9c64f883c7ded60badfe89cb15fa78"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78">lsredis_setstr</a> (<a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *p, char *fmt,...)</td></tr>
<tr class="memdesc:a9b9c64f883c7ded60badfe89cb15fa78"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the value and update redis.  <a href="#a9b9c64f883c7ded60badfe89cb15fa78"></a><br/></td></tr>
<tr class="separator:a9b9c64f883c7ded60badfe89cb15fa78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51c33bec2c54f2d468bf8d93d981914a"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a51c33bec2c54f2d468bf8d93d981914a">lsredis_get_or_set_d</a> (<a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *p, double val, int prec)</td></tr>
<tr class="separator:a51c33bec2c54f2d468bf8d93d981914a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8daf63b794b6b6341018feec205cb7d"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a> (<a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *p)</td></tr>
<tr class="separator:aa8daf63b794b6b6341018feec205cb7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1923f998441f4f451204dfd214d52218"><td class="memItemLeft" align="right" valign="top">long int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a1923f998441f4f451204dfd214d52218">lsredis_getl</a> (<a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *p)</td></tr>
<tr class="separator:a1923f998441f4f451204dfd214d52218"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71689006ffc015be6a0705a7c0aef1be"><td class="memItemLeft" align="right" valign="top">long int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a71689006ffc015be6a0705a7c0aef1be">lsredis_get_or_set_l</a> (<a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *p, long int val)</td></tr>
<tr class="separator:a71689006ffc015be6a0705a7c0aef1be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe31d0e11c41b2235307612c963bb652"><td class="memItemLeft" align="right" valign="top">char **&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#abe31d0e11c41b2235307612c963bb652">lsredis_get_string_array</a> (<a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *p)</td></tr>
<tr class="separator:abe31d0e11c41b2235307612c963bb652"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abbb4e5ece19ebd130e1be18036752a08"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#abbb4e5ece19ebd130e1be18036752a08">lsredis_getb</a> (<a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *p)</td></tr>
<tr class="separator:abbb4e5ece19ebd130e1be18036752a08"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b7600b1c9a4550b32d4be019d25f941"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a0b7600b1c9a4550b32d4be019d25f941">lsredis_getc</a> (<a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *p)</td></tr>
<tr class="separator:a0b7600b1c9a4550b32d4be019d25f941"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d9719b362d1b38275d734971b7988af"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a8d9719b362d1b38275d734971b7988af">lsredis_hgetCB</a> (redisAsyncContext *ac, void *reply, void *privdata)</td></tr>
<tr class="separator:a8d9719b362d1b38275d734971b7988af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3fb8589e280bfa18ecbca6619fea637"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#ac3fb8589e280bfa18ecbca6619fea637">_lsredis_get_obj</a> (char *key)</td></tr>
<tr class="memdesc:ac3fb8589e280bfa18ecbca6619fea637"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maybe add a new object Used internally for this module Must be called with lsredis_mutex locked.  <a href="#ac3fb8589e280bfa18ecbca6619fea637"></a><br/></td></tr>
<tr class="separator:ac3fb8589e280bfa18ecbca6619fea637"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3bb3ebbae1ffbd03e062ecdd663cc6a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a> (char *fmt,...)</td></tr>
<tr class="separator:ad3bb3ebbae1ffbd03e062ecdd663cc6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1941e6515a254f76cfd1f18d3c8fac3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#aa1941e6515a254f76cfd1f18d3c8fac3">redisDisconnectCB</a> (const redisAsyncContext *ac, int status)</td></tr>
<tr class="memdesc:aa1941e6515a254f76cfd1f18d3c8fac3"><td class="mdescLeft">&#160;</td><td class="mdescRight">call back in case a redis server becomes disconnected TODO: reconnect  <a href="#aa1941e6515a254f76cfd1f18d3c8fac3"></a><br/></td></tr>
<tr class="separator:aa1941e6515a254f76cfd1f18d3c8fac3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adee3bccecc86dd531ac5f89491632439"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#adee3bccecc86dd531ac5f89491632439">lsredis_addRead</a> (void *data)</td></tr>
<tr class="memdesc:adee3bccecc86dd531ac5f89491632439"><td class="mdescLeft">&#160;</td><td class="mdescRight">hook to mange read events  <a href="#adee3bccecc86dd531ac5f89491632439"></a><br/></td></tr>
<tr class="separator:adee3bccecc86dd531ac5f89491632439"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e1f2258b3cc864ce3eef4eda556e2a6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a2e1f2258b3cc864ce3eef4eda556e2a6">lsredis_delRead</a> (void *data)</td></tr>
<tr class="memdesc:a2e1f2258b3cc864ce3eef4eda556e2a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">hook to manage "don't need to read" events  <a href="#a2e1f2258b3cc864ce3eef4eda556e2a6"></a><br/></td></tr>
<tr class="separator:a2e1f2258b3cc864ce3eef4eda556e2a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3cb6eda5c8ae80019e7a1c078940e9e9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a3cb6eda5c8ae80019e7a1c078940e9e9">lsredis_addWrite</a> (void *data)</td></tr>
<tr class="memdesc:a3cb6eda5c8ae80019e7a1c078940e9e9"><td class="mdescLeft">&#160;</td><td class="mdescRight">hook to manage write events  <a href="#a3cb6eda5c8ae80019e7a1c078940e9e9"></a><br/></td></tr>
<tr class="separator:a3cb6eda5c8ae80019e7a1c078940e9e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04f0119cfa1156dc34d35b237358822a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a04f0119cfa1156dc34d35b237358822a">lsredis_delWrite</a> (void *data)</td></tr>
<tr class="memdesc:a04f0119cfa1156dc34d35b237358822a"><td class="mdescLeft">&#160;</td><td class="mdescRight">hook to manage "don't need to write anymore" events  <a href="#a04f0119cfa1156dc34d35b237358822a"></a><br/></td></tr>
<tr class="separator:a04f0119cfa1156dc34d35b237358822a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45f946a5262c23b362be17c2cb0310c2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a45f946a5262c23b362be17c2cb0310c2">lsredis_cleanup</a> (void *data)</td></tr>
<tr class="memdesc:a45f946a5262c23b362be17c2cb0310c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">hook to clean up TODO: figure out what we are supposed to do here and do it  <a href="#a45f946a5262c23b362be17c2cb0310c2"></a><br/></td></tr>
<tr class="separator:a45f946a5262c23b362be17c2cb0310c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84611531459bf3d92c45b86308b4a300"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a84611531459bf3d92c45b86308b4a300">lsredis_subCB</a> (redisAsyncContext *ac, void *reply, void *privdata)</td></tr>
<tr class="memdesc:a84611531459bf3d92c45b86308b4a300"><td class="mdescLeft">&#160;</td><td class="mdescRight">Use the publication to request the new value.  <a href="#a84611531459bf3d92c45b86308b4a300"></a><br/></td></tr>
<tr class="separator:a84611531459bf3d92c45b86308b4a300"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3189a7329ca92efab0054921f608b97"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#ad3189a7329ca92efab0054921f608b97">lsredis_maybe_add_key</a> (char *k)</td></tr>
<tr class="separator:ad3189a7329ca92efab0054921f608b97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace75c15c5308a0fcdafcb82c7506872a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#ace75c15c5308a0fcdafcb82c7506872a">lsredis_keysCB</a> (redisAsyncContext *ac, void *reply, void *privdata)</td></tr>
<tr class="memdesc:ace75c15c5308a0fcdafcb82c7506872a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sift through the keys to find ones we like.  <a href="#ace75c15c5308a0fcdafcb82c7506872a"></a><br/></td></tr>
<tr class="separator:ace75c15c5308a0fcdafcb82c7506872a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af48b297b5679750a131fa1e982a078b7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#af48b297b5679750a131fa1e982a078b7">lsredis_load_presets</a> (char *motor_name)</td></tr>
<tr class="memdesc:af48b297b5679750a131fa1e982a078b7"><td class="mdescLeft">&#160;</td><td class="mdescRight">update the presets hash table for the named motor  <a href="#af48b297b5679750a131fa1e982a078b7"></a><br/></td></tr>
<tr class="separator:af48b297b5679750a131fa1e982a078b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87d7bb0ade6f247edfbb7803aac9e694"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a87d7bb0ade6f247edfbb7803aac9e694">lsredis_find_preset</a> (char *motor_name, char *preset_name, double *dval)</td></tr>
<tr class="memdesc:a87d7bb0ade6f247edfbb7803aac9e694"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the value of the given preset and return it in dval Returns 0 on error, non-zero on success;.  <a href="#a87d7bb0ade6f247edfbb7803aac9e694"></a><br/></td></tr>
<tr class="separator:a87d7bb0ade6f247edfbb7803aac9e694"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b48f29f489bcbdaf4fb29e7fbf1d4d2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a2b48f29f489bcbdaf4fb29e7fbf1d4d2">lsredis_set_preset</a> (char *motor_name, char *preset_name, double dval)</td></tr>
<tr class="memdesc:a2b48f29f489bcbdaf4fb29e7fbf1d4d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">set the given preset to the given value create a new preset if we can't find it  <a href="#a2b48f29f489bcbdaf4fb29e7fbf1d4d2"></a><br/></td></tr>
<tr class="separator:a2b48f29f489bcbdaf4fb29e7fbf1d4d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adfe823e3ccec7e37ac4697179bd65b10"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#adfe823e3ccec7e37ac4697179bd65b10">lsredis_find_preset_index_by_position</a> (<a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *mp)</td></tr>
<tr class="memdesc:adfe823e3ccec7e37ac4697179bd65b10"><td class="mdescLeft">&#160;</td><td class="mdescRight">For the given motor object return the index of the current preset or -1 if we are not at a preset position.  <a href="#adfe823e3ccec7e37ac4697179bd65b10"></a><br/></td></tr>
<tr class="separator:adfe823e3ccec7e37ac4697179bd65b10"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a065d09eb6914c057383980d3d786affc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a065d09eb6914c057383980d3d786affc">lsredis_log</a> (char *fmt,...)</td></tr>
<tr class="memdesc:a065d09eb6914c057383980d3d786affc"><td class="mdescLeft">&#160;</td><td class="mdescRight">send log message to our redis log key  <a href="#a065d09eb6914c057383980d3d786affc"></a><br/></td></tr>
<tr class="separator:a065d09eb6914c057383980d3d786affc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75e500f4f9df969ca9994d6889944f47"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a75e500f4f9df969ca9994d6889944f47">lsredis_configCB</a> (redisAsyncContext *ac, void *reply, void *privdata)</td></tr>
<tr class="separator:a75e500f4f9df969ca9994d6889944f47"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaabcee808dcf48a60898798a45516b68"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#aaabcee808dcf48a60898798a45516b68">lsredis_config</a> ()</td></tr>
<tr class="separator:aaabcee808dcf48a60898798a45516b68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a7466a8c5b90df6dfc78aef625220f4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a4a7466a8c5b90df6dfc78aef625220f4">lsredis_init</a> ()</td></tr>
<tr class="memdesc:a4a7466a8c5b90df6dfc78aef625220f4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize this module, that is, set up the connections.  <a href="#a4a7466a8c5b90df6dfc78aef625220f4"></a><br/></td></tr>
<tr class="separator:a4a7466a8c5b90df6dfc78aef625220f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae1478efc852fef71550e0f58d602fa2b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#ae1478efc852fef71550e0f58d602fa2b">lsredis_fd_service</a> (struct pollfd *evt)</td></tr>
<tr class="memdesc:ae1478efc852fef71550e0f58d602fa2b"><td class="mdescLeft">&#160;</td><td class="mdescRight">service the socket requests  <a href="#ae1478efc852fef71550e0f58d602fa2b"></a><br/></td></tr>
<tr class="separator:ae1478efc852fef71550e0f58d602fa2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa060eb807fbecb6e6430d2cbae2c9673"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#aa060eb807fbecb6e6430d2cbae2c9673">lsredis_sig_service</a> (struct pollfd *evt)</td></tr>
<tr class="separator:aa060eb807fbecb6e6430d2cbae2c9673"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd9cb833103e57da756d152ecdd4f840"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#acd9cb833103e57da756d152ecdd4f840">lsredis_heartbeat_cb</a> (char *event)</td></tr>
<tr class="separator:acd9cb833103e57da756d152ecdd4f840"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade7b1ddfdc88c6964a4c90513e360f75"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#ade7b1ddfdc88c6964a4c90513e360f75">lsredis_worker</a> (void *dummy)</td></tr>
<tr class="memdesc:ade7b1ddfdc88c6964a4c90513e360f75"><td class="mdescLeft">&#160;</td><td class="mdescRight">subscribe to changes and service sockets  <a href="#ade7b1ddfdc88c6964a4c90513e360f75"></a><br/></td></tr>
<tr class="separator:ade7b1ddfdc88c6964a4c90513e360f75"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3db3d5f91bf5723bd94748ce0d88731"><td class="memItemLeft" align="right" valign="top">pthread_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#ac3db3d5f91bf5723bd94748ce0d88731">lsredis_run</a> ()</td></tr>
<tr class="separator:ac3db3d5f91bf5723bd94748ce0d88731"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a79c33eb11ad6819247930ade3a25671f"><td class="memItemLeft" align="right" valign="top">static pthread_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a79c33eb11ad6819247930ade3a25671f">lsredis_thread</a></td></tr>
<tr class="separator:a79c33eb11ad6819247930ade3a25671f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a390e8acf789b0fa41b43a794dd27e28f"><td class="memItemLeft" align="right" valign="top">pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a> = PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP</td></tr>
<tr class="separator:a390e8acf789b0fa41b43a794dd27e28f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f63408d16b5603541b124a78f36a5a8"><td class="memItemLeft" align="right" valign="top">pthread_cond_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a2f63408d16b5603541b124a78f36a5a8">lsredis_cond</a></td></tr>
<tr class="separator:a2f63408d16b5603541b124a78f36a5a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7461eb2b5974a2ffac2189007d39193c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a7461eb2b5974a2ffac2189007d39193c">lsredis_running</a> = 0</td></tr>
<tr class="separator:a7461eb2b5974a2ffac2189007d39193c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71c9f418904364d65c22d786f4dc5d39"><td class="memItemLeft" align="right" valign="top">static pthread_mutexattr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a71c9f418904364d65c22d786f4dc5d39">mutex_initializer</a></td></tr>
<tr class="separator:a71c9f418904364d65c22d786f4dc5d39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d206e1c119f1408a7cf1078139f8189"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a3d206e1c119f1408a7cf1078139f8189">lsredis_objs</a> = NULL</td></tr>
<tr class="separator:a3d206e1c119f1408a7cf1078139f8189"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42aec6aa74072797ec0344847b0e9e39"><td class="memItemLeft" align="right" valign="top">static struct hsearch_data&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a42aec6aa74072797ec0344847b0e9e39">lsredis_htab</a></td></tr>
<tr class="separator:a42aec6aa74072797ec0344847b0e9e39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d65536cb1094fb5deda0a852b181232"><td class="memItemLeft" align="right" valign="top">static redisAsyncContext *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a></td></tr>
<tr class="separator:a4d65536cb1094fb5deda0a852b181232"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc92245910ec04f9a341c092def45564"><td class="memItemLeft" align="right" valign="top">static redisAsyncContext *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a></td></tr>
<tr class="separator:afc92245910ec04f9a341c092def45564"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ea13129ad9e41a0ed2fc19fa75ffb0d"><td class="memItemLeft" align="right" valign="top">static redisAsyncContext *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a></td></tr>
<tr class="separator:a7ea13129ad9e41a0ed2fc19fa75ffb0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c81dce2e75584eeb14ab7d9dd86c72e"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a0c81dce2e75584eeb14ab7d9dd86c72e">lsredis_publisher</a> = NULL</td></tr>
<tr class="separator:a0c81dce2e75584eeb14ab7d9dd86c72e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abee04898347f9b2551fa0435b1cc597e"><td class="memItemLeft" align="right" valign="top">static regex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#abee04898347f9b2551fa0435b1cc597e">lsredis_key_select_regex</a></td></tr>
<tr class="separator:abee04898347f9b2551fa0435b1cc597e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdca9095c7a3288d7febe9f4c440a6e9"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#acdca9095c7a3288d7febe9f4c440a6e9">lsredis_head</a> = NULL</td></tr>
<tr class="separator:acdca9095c7a3288d7febe9f4c440a6e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c5cbd80d59d69603f123621cc6ddc30"><td class="memItemLeft" align="right" valign="top">static pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a0c5cbd80d59d69603f123621cc6ddc30">lsredis_config_mutex</a></td></tr>
<tr class="separator:a0c5cbd80d59d69603f123621cc6ddc30"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6fa076f1004c85a8a1dc400f45547f32"><td class="memItemLeft" align="right" valign="top">static pthread_cond_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a6fa076f1004c85a8a1dc400f45547f32">lsredis_config_cond</a></td></tr>
<tr class="separator:a6fa076f1004c85a8a1dc400f45547f32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0cd3bdc79d035eb1595371c845d14367"><td class="memItemLeft" align="right" valign="top">static struct pollfd&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a0cd3bdc79d035eb1595371c845d14367">subfd</a></td></tr>
<tr class="separator:a0cd3bdc79d035eb1595371c845d14367"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add819e43a356d0575ec64c346c6fed57"><td class="memItemLeft" align="right" valign="top">static struct pollfd&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#add819e43a356d0575ec64c346c6fed57">rofd</a></td></tr>
<tr class="separator:add819e43a356d0575ec64c346c6fed57"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13acbee14dbe8cdb98e238abb921d048"><td class="memItemLeft" align="right" valign="top">static struct pollfd&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a13acbee14dbe8cdb98e238abb921d048">wrfd</a></td></tr>
<tr class="separator:a13acbee14dbe8cdb98e238abb921d048"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a232f994f0d91ba8157cbcfe429fc90de"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="lsredis_8c.html#a8eac570b2b69ea0b7948b6c581cf6002">lsredis_preset_list_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a232f994f0d91ba8157cbcfe429fc90de">lsredis_preset_list</a> = NULL</td></tr>
<tr class="separator:a232f994f0d91ba8157cbcfe429fc90de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade00a383533fdefb2af9f3f53f37cf97"><td class="memItemLeft" align="right" valign="top">static struct hsearch_data&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#ade00a383533fdefb2af9f3f53f37cf97">lsredis_preset_ht</a></td></tr>
<tr class="separator:ade00a383533fdefb2af9f3f53f37cf97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adace74d8fa7d2dd58854fa09e66da807"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#adace74d8fa7d2dd58854fa09e66da807">lsredis_preset_n</a> = 0</td></tr>
<tr class="separator:adace74d8fa7d2dd58854fa09e66da807"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace88a236f88278adaac5419a7281c490"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#ace88a236f88278adaac5419a7281c490">lsredis_preset_max_n</a> = 1024</td></tr>
<tr class="separator:ace88a236f88278adaac5419a7281c490"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d0b14b31b12d1b2a79dc50eac09de39"><td class="memItemLeft" align="right" valign="top">static pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsredis_8c.html#a1d0b14b31b12d1b2a79dc50eac09de39">lsredis_preset_list_mutex</a></td></tr>
<tr class="separator:a1d0b14b31b12d1b2a79dc50eac09de39"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Support redis hash synchronization. </p>
<pre class="fragment">\date 2012
\author Keith Brister
\copyright All Rights Reserved
</pre><p>Redis support for redis in pgpmac.</p>
<p>Values in redis are assumed to be hashs with at list one field "VALUE". At startup the initialization routine is passed a regular expression to select which keys we'd like to duplicate locally as a lsredis_obj_t. It is assumed that the following construct in redis is used to change a value:</p>
<pre>
    MULTI
    HSET key VALUE value
    PUBLISH publisher key
    EXEC
</pre><p>Where "publisher" is a unique name in the following format: </p>
<pre>
         MD2-*
   or    UI-*
   or    REDIS_KV_CONNECTOR
   or    <a class="el" href="namespacemk__pgpmac__redis.html">mk_pgpmac_redis</a>
</pre><p> (this last value is used to support the now depreciated px.kvs table in the LS-CAT postgresql server). We assume that all publishers that we are listening to ONLY publish key names that have changed.</p>
<p>When someone else changes a value we invalidate our internal copy and issue a "HGET key VALUE" command. Other threads that request the value of our lsredis_obj_t will pause until the new value has been received and processed.</p>
<p>When a value changes locally this module changes it in redis as shown above. At this point we refuse other publishers attempt to change the value until we've seen all of our PUBLISH messages. That is, we ignore changes that in redis happened before our change.</p>
<p>You'll need an lsredis_obj_t to do anything with redis in the pgpmac project: </p>
<pre>
   lsredis_obj_t *lsredis_get_obj( char *fmt, ...)  where fmt is a printf style formatting string to interpret the rest of the arguments (if any)
                                                    During initialization a "head" string is passed that is prepended to form the redis key.
                                                    For example, "omega.position" might refer to the key "stns.2.omega.position" at LS-CAT.
   </pre><p>To set a redis value use </p>
<pre>
    void lsredis_setstr( lsredis_obj_t *p, char *fmt, ...)  where fmt is a printf style formatting string to interpret the rest of the arguments (if any)
   </pre><p>When a new value is seen we immediately parse it and make it available through the following functions: </p>
<pre></pre><pre>     char    *lsredis_getstr( lsredis_obj_t *p)            Returns a copy of the VALUE field.  Use "free" on the retured value when done using it.</pre><pre>     double   <a class="el" href="pgpmac_8h.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd( lsredis_obj_t *p)</a>              Returns a double.  If the value was not a number it returns 0.</pre><pre>     long int <a class="el" href="pgpmac_8h.html#a1923f998441f4f451204dfd214d52218">lsredis_getl( lsredis_obj_t *p)</a>              Returns a long int.  If the value was not a number it returns 0.</pre><pre>     char   **lsredis_get_string_array( lsredis_obj_t *p)  Returns an array of string pointers.  Value is assumed formated as a postgresql array, ie, {here,"I am","for example"}.
                                                  or NULL if the value could not be parsed</pre><pre>     int      <a class="el" href="pgpmac_8h.html#abbb4e5ece19ebd130e1be18036752a08">lsredis_getb( lsredis_obj_t *p)</a>              Returns 1, 0, or -1 based on the fist character of the string. 1 for T,t,Y,y, or 1, 0 for F,f,N,n or 0, -1 for anything else.</pre><pre>     char     <a class="el" href="pgpmac_8h.html#a0b7600b1c9a4550b32d4be019d25f941">lsredis_getc( lsredis_obj_t *p)</a>              Returns the first character of VALUE</pre><pre>   </pre> 
<p>Definition in file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
</div><h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="a8eac570b2b69ea0b7948b6c581cf6002"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlsredis__preset__list__struct.html">lsredis_preset_list_struct</a>  <a class="el" href="lsredis_8c.html#a8eac570b2b69ea0b7948b6c581cf6002">lsredis_preset_list_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ac3fb8589e280bfa18ecbca6619fea637"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a>* _lsredis_get_obj </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>key</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Maybe add a new object Used internally for this module Must be called with lsredis_mutex locked. </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00544">544</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                            {</div>
<div class="line">  <a class="code" href="structlsredis__obj__struct.html" title="Redis Object Basic object whose value is sychronized with our redis db.">lsredis_obj_t</a> *<a class="code" href="namespacemk__pgpmac__redis.html#a11daf2847f2dc94562b5b61b3f412574">p</a>;</div>
<div class="line">  regmatch_t pmatch[2];</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line">  ENTRY htab_input, *htab_output;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Dispense with obviously bad keys straight away</span></div>
<div class="line">  <span class="comment">// unless p-&gt;valid == 0 in which case we call HGET first</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// TODO: review logic: is there ever a time when valid is zero for a preexisting p and HGET has not been called?</span></div>
<div class="line">  <span class="comment">//       If not then we should just return p without checking for validity.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( key == NULL || *key == 0 || strchr( key, <span class="charliteral">&#39; &#39;</span>) != NULL) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;_lsredis_get_obj: bad key &#39;%s&#39;&quot;</span>, key == NULL ? <span class="stringliteral">&quot;&lt;NULL&gt;&quot;</span> : key);</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// If the key is already there then just return it</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  htab_input.key  = key;</div>
<div class="line">  htab_input.data = NULL;</div>
<div class="line">  errno = 0;</div>
<div class="line">  err = hsearch_r( htab_input, FIND, &amp;htab_output, &amp;<a class="code" href="lsredis_8c.html#a42aec6aa74072797ec0344847b0e9e39">lsredis_htab</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( err == 0)</div>
<div class="line">    p = NULL;</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    p = htab_output-&gt;data;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( p != NULL) {</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="namespacemk__pgpmac__redis.html#a11daf2847f2dc94562b5b61b3f412574">p</a>;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="comment">// make a new one.</span></div>
<div class="line">    p = calloc( 1, <span class="keyword">sizeof</span>( <a class="code" href="structlsredis__obj__struct.html" title="Redis Object Basic object whose value is sychronized with our redis db.">lsredis_obj_t</a>));</div>
<div class="line">    <span class="keywordflow">if</span>( p == NULL) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;_lsredis_get_obj: Out of memory&quot;</span>);</div>
<div class="line">      exit( -1);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    err = regexec( &amp;<a class="code" href="lsredis_8c.html#abee04898347f9b2551fa0435b1cc597e">lsredis_key_select_regex</a>, key, 2, pmatch, 0);</div>
<div class="line">    <span class="keywordflow">if</span>( err == 0 &amp;&amp; pmatch[1].rm_so != -1) {</div>
<div class="line">      p-&gt;<a class="code" href="structlsredis__obj__struct.html#ad0a987a011b580eab739cda831f78fbb" title="Name used to generate events (normally key without the station id)">events_name</a> = strndup( key+pmatch[1].rm_so, pmatch[1].rm_eo - pmatch[1].rm_so);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      p-&gt;<a class="code" href="structlsredis__obj__struct.html#ad0a987a011b580eab739cda831f78fbb" title="Name used to generate events (normally key without the station id)">events_name</a> = strdup( key);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#ad0a987a011b580eab739cda831f78fbb" title="Name used to generate events (normally key without the station id)">events_name</a> == NULL) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;_lsredis_get_obj: Out of memory (events_name)&quot;</span>);</div>
<div class="line">      exit( -1);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    pthread_mutex_init( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>, &amp;<a class="code" href="lsredis_8c.html#a71c9f418904364d65c22d786f4dc5d39">mutex_initializer</a>);</div>
<div class="line">    pthread_cond_init(  &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>, NULL);</div>
<div class="line">    p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0465c65288e8101805a6f91049164517" title="our value">value</a> = NULL;</div>
<div class="line">    p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> = 0;</div>
<div class="line">    <span class="comment">// lsevents_send_event( &quot;%s Invalid&quot;, p-&gt;events_name);</span></div>
<div class="line">    p-&gt;<a class="code" href="structlsredis__obj__struct.html#a8bc1a536b7155a1e2a749c7c434b898b" title="Number of times we need to see our publication before we start accepting new values.">wait_for_me</a> = 0;</div>
<div class="line">    p-&gt;<a class="code" href="structlsredis__obj__struct.html#aa8c5a453b9424e5666320b8675a42f5c" title="The redis key for this object.">key</a> = strdup( key);</div>
<div class="line">    p-&gt;<a class="code" href="structlsredis__obj__struct.html#a43fcbff584654ab086d973ce34cb6ddc" title="number of times we&#39;ve searched for this key">hits</a> = 0;</div>
<div class="line">  </div>
<div class="line">    htab_input.key  = p-&gt;<a class="code" href="structlsredis__obj__struct.html#aa8c5a453b9424e5666320b8675a42f5c" title="The redis key for this object.">key</a>;</div>
<div class="line">    htab_input.data = <a class="code" href="namespacemk__pgpmac__redis.html#a11daf2847f2dc94562b5b61b3f412574">p</a>;</div>
<div class="line"></div>
<div class="line">    errno = 0;</div>
<div class="line">    err = hsearch_r( htab_input, ENTER, &amp;htab_output, &amp;<a class="code" href="lsredis_8c.html#a42aec6aa74072797ec0344847b0e9e39">lsredis_htab</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( err == 0) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;_lsredis_get_obj: hseach error on enter.  errno=%d&quot;</span>, errno);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Shouldn&#39;t need the linked list unless we need to rebuild the hash table when, for example, we run out of room.</span></div>
<div class="line">    <span class="comment">// TODO: resize hash table when needed.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    p-&gt;<a class="code" href="structlsredis__obj__struct.html#afb7259e8c3c1c83ccc234b2b2894f2b0" title="the next in our list (I guess this is going to be a linked list)">next</a> = <a class="code" href="lsredis_8c.html#a3d206e1c119f1408a7cf1078139f8189">lsredis_objs</a>;</div>
<div class="line">    <a class="code" href="lsredis_8c.html#a3d206e1c119f1408a7cf1078139f8189">lsredis_objs</a> = <a class="code" href="namespacemk__pgpmac__redis.html#a11daf2847f2dc94562b5b61b3f412574">p</a>;</div>
<div class="line">  }</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// We arrive here with the valid flag lowered.  Go ahead and request the latest value.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  redisAsyncCommand( <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>, <a class="code" href="lsredis_8c.html#a8d9719b362d1b38275d734971b7988af">lsredis_hgetCB</a>, p, <span class="stringliteral">&quot;HGET %s VALUE&quot;</span>, key);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="namespacemk__pgpmac__redis.html#a11daf2847f2dc94562b5b61b3f412574">p</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a05c7ed2bb1b5702a5c83ed3b51abb546"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void _lsredis_set_value </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>v</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>set_value and setstr helper funciton p-&gt;mutex must be locked before calling </p>
<p>&lt; We can consider this value valid</p>
<p>&lt; At this point the key is considered created </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00166">166</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                    {</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( strlen(<a class="code" href="namespacemk__pgpmac__redis.html#ac732d49b0afca9a9951e3a252bae42fc">v</a>) &gt;= (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) p-&gt;<a class="code" href="structlsredis__obj__struct.html#a664f0eaafb8dffc0dbde126e0340efb9" title="Number of bytes allocated for value (not value&#39;s string length)">value_length</a>) {</div>
<div class="line">    <span class="keywordflow">if</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0465c65288e8101805a6f91049164517" title="our value">value</a> != NULL)</div>
<div class="line">      free( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0465c65288e8101805a6f91049164517" title="our value">value</a>);</div>
<div class="line">    p-&gt;<a class="code" href="structlsredis__obj__struct.html#a664f0eaafb8dffc0dbde126e0340efb9" title="Number of bytes allocated for value (not value&#39;s string length)">value_length</a> = strlen(<a class="code" href="namespacemk__pgpmac__redis.html#ac732d49b0afca9a9951e3a252bae42fc">v</a>) + 256;</div>
<div class="line">    p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0465c65288e8101805a6f91049164517" title="our value">value</a> = calloc( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a664f0eaafb8dffc0dbde126e0340efb9" title="Number of bytes allocated for value (not value&#39;s string length)">value_length</a>, <span class="keyword">sizeof</span>( <span class="keywordtype">char</span>));</div>
<div class="line">    <span class="keywordflow">if</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0465c65288e8101805a6f91049164517" title="our value">value</a> == NULL) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;_lsredis_set_value: out of memory&quot;</span>);</div>
<div class="line">      exit( -1);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  strncpy( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0465c65288e8101805a6f91049164517" title="our value">value</a>, <a class="code" href="namespacemk__pgpmac__redis.html#ac732d49b0afca9a9951e3a252bae42fc">v</a>, p-&gt;<a class="code" href="structlsredis__obj__struct.html#a664f0eaafb8dffc0dbde126e0340efb9" title="Number of bytes allocated for value (not value&#39;s string length)">value_length</a> - 1);</div>
<div class="line">  p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0465c65288e8101805a6f91049164517" title="our value">value</a>[p-&gt;<a class="code" href="structlsredis__obj__struct.html#a664f0eaafb8dffc0dbde126e0340efb9" title="Number of bytes allocated for value (not value&#39;s string length)">value_length</a>-1] = 0;</div>
<div class="line">  p-&gt;<a class="code" href="structlsredis__obj__struct.html#ab60d0a71cabad6b921b6edb5a8f68996" title="our value as a double">dvalue</a> = strtod( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0465c65288e8101805a6f91049164517" title="our value">value</a>, NULL);</div>
<div class="line">  p-&gt;<a class="code" href="structlsredis__obj__struct.html#a26211a0ab3fc02e7776e24dbc1f1256c" title="our value as a long">lvalue</a> = p-&gt;<a class="code" href="structlsredis__obj__struct.html#ab60d0a71cabad6b921b6edb5a8f68996" title="our value as a double">dvalue</a>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#ac065eeede0e08f25bcfedd45022fe593" title="our value as an array of strings">avalue</a> != NULL) {</div>
<div class="line">    <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">    <span class="keywordflow">for</span>( i=0; (p-&gt;<a class="code" href="structlsredis__obj__struct.html#ac065eeede0e08f25bcfedd45022fe593" title="our value as an array of strings">avalue</a>)[i] != NULL; i++)</div>
<div class="line">      free( (p-&gt;<a class="code" href="structlsredis__obj__struct.html#ac065eeede0e08f25bcfedd45022fe593" title="our value as an array of strings">avalue</a>)[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>]);</div>
<div class="line">    free( p-&gt;<a class="code" href="structlsredis__obj__struct.html#ac065eeede0e08f25bcfedd45022fe593" title="our value as an array of strings">avalue</a>);</div>
<div class="line">    p-&gt;<a class="code" href="structlsredis__obj__struct.html#ac065eeede0e08f25bcfedd45022fe593" title="our value as an array of strings">avalue</a> = NULL;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  p-&gt;<a class="code" href="structlsredis__obj__struct.html#ac065eeede0e08f25bcfedd45022fe593" title="our value as an array of strings">avalue</a> = <a class="code" href="lspg_8c.html#a46f23ae999129d6fd5712d7975b99aed" title="returns a null terminated list of strings parsed from postgresql array">lspg_array2ptrs</a>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0465c65288e8101805a6f91049164517" title="our value">value</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">switch</span>( *(p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0465c65288e8101805a6f91049164517" title="our value">value</a>)) {</div>
<div class="line">      <span class="keywordflow">case</span> <span class="charliteral">&#39;T&#39;</span>:</div>
<div class="line">      <span class="keywordflow">case</span> <span class="charliteral">&#39;t&#39;</span>:</div>
<div class="line">      <span class="keywordflow">case</span> <span class="charliteral">&#39;Y&#39;</span>:</div>
<div class="line">      <span class="keywordflow">case</span> <span class="charliteral">&#39;y&#39;</span>:</div>
<div class="line">      <span class="keywordflow">case</span> <span class="charliteral">&#39;1&#39;</span>:</div>
<div class="line">        p-&gt;<a class="code" href="structlsredis__obj__struct.html#ac3df3eaa275c1e8e333024c1fa8353af" title="our value as a boolean (1 or 0) -1 means we couldn&#39;t figure it out">bvalue</a> = 1;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">      <span class="keywordflow">case</span> <span class="charliteral">&#39;F&#39;</span>:</div>
<div class="line">      <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:</div>
<div class="line">      <span class="keywordflow">case</span> <span class="charliteral">&#39;N&#39;</span>:</div>
<div class="line">      <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:</div>
<div class="line">      <span class="keywordflow">case</span> <span class="charliteral">&#39;0&#39;</span>:</div>
<div class="line">        p-&gt;<a class="code" href="structlsredis__obj__struct.html#ac3df3eaa275c1e8e333024c1fa8353af" title="our value as a boolean (1 or 0) -1 means we couldn&#39;t figure it out">bvalue</a> = 0;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">      <span class="keywordflow">default</span>:</div>
<div class="line">        p-&gt;<a class="code" href="structlsredis__obj__struct.html#ac3df3eaa275c1e8e333024c1fa8353af" title="our value as a boolean (1 or 0) -1 means we couldn&#39;t figure it out">bvalue</a> = -1;         <span class="comment">// nil is -1 here in our world</span></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">  p-&gt;<a class="code" href="structlsredis__obj__struct.html#a4a5933dbd44d33d9f594f6020a443b69" title="just the first character of our value">cvalue</a> = *(p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0465c65288e8101805a6f91049164517" title="our value">value</a>);</div>
<div class="line"></div>
<div class="line">  p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> = 1;                         </div>
<div class="line">  p-&gt;<a class="code" href="structlsredis__obj__struct.html#ae0aa00ad745ee5bbc598c23ab794ed8a" title="1 if this key does not exist and we haven&#39;t set it yet: read will create and set an empty string valu...">creating</a> = 0;                      </div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adee3bccecc86dd531ac5f89491632439"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_addRead </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>hook to mange read events </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00674">674</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                  {</div>
<div class="line">  <span class="keyword">struct </span>pollfd *pfd;</div>
<div class="line">  pfd = (<span class="keyword">struct </span>pollfd *)data;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( (pfd-&gt;events &amp; POLLIN) == 0) {</div>
<div class="line">    pfd-&gt;events |= POLLIN;</div>
<div class="line">    pthread_kill( <a class="code" href="lsredis_8c.html#a79c33eb11ad6819247930ade3a25671f">lsredis_thread</a>, SIGUSR1);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3cb6eda5c8ae80019e7a1c078940e9e9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_addWrite </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>hook to manage write events </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00698">698</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                   {</div>
<div class="line">  <span class="keyword">struct </span>pollfd *pfd;</div>
<div class="line">  pfd = (<span class="keyword">struct </span>pollfd *)data;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( (pfd-&gt;events &amp; POLLOUT) == 0) {</div>
<div class="line">    pfd-&gt;events |= POLLOUT;</div>
<div class="line">    pthread_kill( <a class="code" href="lsredis_8c.html#a79c33eb11ad6819247930ade3a25671f">lsredis_thread</a>, SIGUSR1);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a45f946a5262c23b362be17c2cb0310c2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_cleanup </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>hook to clean up TODO: figure out what we are supposed to do here and do it </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00723">723</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                  {</div>
<div class="line">  <span class="keyword">struct </span>pollfd *pfd;</div>
<div class="line">  pfd = (<span class="keyword">struct </span>pollfd *)data;</div>
<div class="line"></div>
<div class="line">  pfd-&gt;fd = -1;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( (pfd-&gt;events &amp; (POLLOUT | POLLIN)) != 0) {</div>
<div class="line">    pfd-&gt;events &amp;= ~(POLLOUT | POLLIN);</div>
<div class="line">    pthread_kill( <a class="code" href="lsredis_8c.html#a79c33eb11ad6819247930ade3a25671f">lsredis_thread</a>, SIGUSR1);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac356cd43e46799929242dcf5214df7f6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsredis_cmpnstr </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00254">254</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                       {</div>
<div class="line">  <span class="keywordtype">int</span> rtn;</div>
<div class="line">  pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <span class="keywordflow">while</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>, &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  </div>
<div class="line">  rtn = strncmp( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0465c65288e8101805a6f91049164517" title="our value">value</a>, s, n);</div>
<div class="line">  pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9fc8fd0db4c71c5eae68682b43103078"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsredis_cmpstr </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>s</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00243">243</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                               {</div>
<div class="line">  <span class="keywordtype">int</span> rtn;</div>
<div class="line">  pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <span class="keywordflow">while</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>, &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  </div>
<div class="line">  rtn = strcmp( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0465c65288e8101805a6f91049164517" title="our value">value</a>, s);</div>
<div class="line">  pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aaabcee808dcf48a60898798a45516b68"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_config </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l01188">1188</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                      {</div>
<div class="line">  <span class="keywordtype">char</span> hostname[128], lhostname[128];</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line"></div>
<div class="line">  pthread_mutexattr_init( &amp;<a class="code" href="lsredis_8c.html#a71c9f418904364d65c22d786f4dc5d39">mutex_initializer</a>);</div>
<div class="line">  pthread_mutexattr_settype( &amp;<a class="code" href="lsredis_8c.html#a71c9f418904364d65c22d786f4dc5d39">mutex_initializer</a>, PTHREAD_MUTEX_RECURSIVE);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( gethostname( hostname, <span class="keyword">sizeof</span>(hostname)-1)) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis_init: cannot get our own host name.  Cannot configure redis variables.&quot;</span>);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="keywordflow">for</span>( i=0; i&lt;strlen(hostname); i++) {</div>
<div class="line">      lhostname[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>] = tolower( hostname[i]);</div>
<div class="line">    }</div>
<div class="line">    lhostname[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>] = 0;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis_init: our host name is &#39;%s&#39;&quot;</span>, lhostname);</div>
<div class="line">    redisAsyncCommand( <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>, <a class="code" href="lsredis_8c.html#a75e500f4f9df969ca9994d6889944f47">lsredis_configCB</a>, NULL, <span class="stringliteral">&quot;hgetall config.%s&quot;</span>, lhostname);</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lsredis_8c.html#a0c5cbd80d59d69603f123621cc6ddc30">lsredis_config_mutex</a>);</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lsredis_8c.html#acdca9095c7a3288d7febe9f4c440a6e9">lsredis_head</a> == NULL)</div>
<div class="line">    pthread_cond_wait( &amp;<a class="code" href="lsredis_8c.html#a6fa076f1004c85a8a1dc400f45547f32">lsredis_config_cond</a>, &amp;<a class="code" href="lsredis_8c.html#a0c5cbd80d59d69603f123621cc6ddc30">lsredis_config_mutex</a>);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lsredis_8c.html#a0c5cbd80d59d69603f123621cc6ddc30">lsredis_config_mutex</a>);</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a75e500f4f9df969ca9994d6889944f47"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_configCB </td>
          <td>(</td>
          <td class="paramtype">redisAsyncContext *&#160;</td>
          <td class="paramname"><em>ac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>reply</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>privdata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l01103">1103</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                                           {</div>
<div class="line">  redisReply *r, *r2, *r3;</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">  <span class="keywordtype">char</span> *errmsg;</div>
<div class="line">  <span class="keywordtype">int</span> err, nerrmsg;</div>
<div class="line"></div>
<div class="line">  r = reply;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( r == NULL) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis_configCB: null reply, cannot configure, bad things will happen&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( r-&gt;type != REDIS_REPLY_ARRAY || (r-&gt;elements % 2) != 0) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis_configCB: could not understand config reply.  Bad things will happen.&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lsredis_8c.html#a0c5cbd80d59d69603f123621cc6ddc30">lsredis_config_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;r-&gt;elements; i += 2) {</div>
<div class="line">    r2 = r-&gt;element[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>];</div>
<div class="line">    r3 = r-&gt;element[i+1];</div>
<div class="line">    <span class="keywordflow">if</span>( r2-&gt;type != REDIS_REPLY_STRING || r2-&gt;type != REDIS_REPLY_STRING)</div>
<div class="line">      <span class="keywordflow">continue</span>;</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// the LHS of the redis keys for this station</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">if</span>( strcmp( r2-&gt;str, <span class="stringliteral">&quot;HEAD&quot;</span>)==0) {</div>
<div class="line">      <a class="code" href="lsredis_8c.html#acdca9095c7a3288d7febe9f4c440a6e9">lsredis_head</a> = strdup( r3-&gt;str);</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Publish changes to keys with this name as the publisher</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">if</span>( strcmp( r2-&gt;str, <span class="stringliteral">&quot;PUB&quot;</span>)==0) {</div>
<div class="line">      <a class="code" href="lsredis_8c.html#a0c81dce2e75584eeb14ab7d9dd86c72e">lsredis_publisher</a> = strdup( r3-&gt;str);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( strcmp( r2-&gt;str, <span class="stringliteral">&quot;PG&quot;</span>)==0) {</div>
<div class="line">      <a class="code" href="pgpmac_8c.html#ae002f31c03cce9bf96cf0e0c2907cb2b" title="non-zero to start up lspg thread, 0 to not (reids hash PG in config.HOSTNAME sets this)...">pgpmac_use_pg</a> = r3-&gt;str[0] == <span class="charliteral">&#39;0&#39;</span> ? 0 : 1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( strcmp( r2-&gt;str, <span class="stringliteral">&quot;AUTOSCINT&quot;</span>)==0) {</div>
<div class="line">      <a class="code" href="pgpmac_8c.html#ad163e2bc6ebe322058c113dee76c11ff" title="non-zero to automatically move the alignment stage when the scintillator moves (redis hash AUTOSCINT ...">pgpmac_use_autoscint</a> = r3-&gt;str[0] == <span class="charliteral">&#39;0&#39;</span> ? 0 : 1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// reg expression to select keys we will be keeping a local copy of</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">if</span>( strcmp( r2-&gt;str, <span class="stringliteral">&quot;RE&quot;</span>)==0) {</div>
<div class="line">      err = regcomp( &amp;<a class="code" href="lsredis_8c.html#abee04898347f9b2551fa0435b1cc597e">lsredis_key_select_regex</a>, r3-&gt;str, REG_EXTENDED);</div>
<div class="line">      <span class="keywordflow">if</span>( err != 0) {</div>
<div class="line">        nerrmsg = regerror( err, &amp;<a class="code" href="lsredis_8c.html#abee04898347f9b2551fa0435b1cc597e">lsredis_key_select_regex</a>, NULL, 0);</div>
<div class="line">        <span class="keywordflow">if</span>( nerrmsg &gt; 0) {</div>
<div class="line">          errmsg = calloc( nerrmsg, <span class="keyword">sizeof</span>( <span class="keywordtype">char</span>));</div>
<div class="line">          nerrmsg = regerror( err, &amp;<a class="code" href="lsredis_8c.html#abee04898347f9b2551fa0435b1cc597e">lsredis_key_select_regex</a>, errmsg, nerrmsg);</div>
<div class="line">          <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis_configCB: %s&quot;</span>, errmsg);</div>
<div class="line">          free( errmsg);</div>
<div class="line">        }</div>
<div class="line">        exit( 1);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">/*</span></div>
<div class="line"><span class="comment">    2013-02-16 12:03:20.669342  ARRAY of 6 elements</span></div>
<div class="line"><span class="comment">    2013-02-16 12:03:20.669351      STRING: HEAD</span></div>
<div class="line"><span class="comment">    2013-02-16 12:03:20.669354      STRING: stns.2</span></div>
<div class="line"><span class="comment">    2013-02-16 12:03:20.669355      STRING: RE</span></div>
<div class="line"><span class="comment">    2013-02-16 12:03:20.669361      STRING: redis\.kvseq|stns\.2\.(.+)</span></div>
<div class="line"><span class="comment">    2013-02-16 12:03:20.669362      STRING: PUB</span></div>
<div class="line"><span class="comment">    2013-02-16 12:03:20.669364      STRING: MD2-21-ID-E</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( redisAsyncCommand( <a class="code" href="lsredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>, <a class="code" href="lsredis_8c.html#a84611531459bf3d92c45b86308b4a300" title="Use the publication to request the new value.">lsredis_subCB</a>, NULL, <span class="stringliteral">&quot;PSUBSCRIBE REDIS_NODE_CONNECTOR mk_pgpmac_redis UI* MD2-*&quot;</span>) == REDIS_ERR) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Error sending PSUBSCRIBE command&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  redisAsyncCommand( <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>, <a class="code" href="lsredis_8c.html#ace75c15c5308a0fcdafcb82c7506872a" title="Sift through the keys to find ones we like.">lsredis_keysCB</a>, NULL, <span class="stringliteral">&quot;KEYS *&quot;</span>);</div>
<div class="line"></div>
<div class="line">  pthread_cond_signal( &amp;<a class="code" href="lsredis_8c.html#a6fa076f1004c85a8a1dc400f45547f32">lsredis_config_cond</a>);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lsredis_8c.html#a0c5cbd80d59d69603f123621cc6ddc30">lsredis_config_mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8268fd06bda0e2c327b057a880b97b59"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_debugCB </td>
          <td>(</td>
          <td class="paramtype">redisAsyncContext *&#160;</td>
          <td class="paramname"><em>ac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>reply</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>privdata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Log the reply. </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00116">116</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                                          {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> indentlevel = 0;</div>
<div class="line">  redisReply *r;</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line"></div>
<div class="line">  r = (redisReply *)reply;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( r == NULL) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Null reply.  Odd&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">switch</span>( r-&gt;type) {</div>
<div class="line">  <span class="keywordflow">case</span> REDIS_REPLY_STATUS:</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;%*sSTATUS: %s&quot;</span>, indentlevel*4,<span class="stringliteral">&quot;&quot;</span>, r-&gt;str);</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> REDIS_REPLY_ERROR:</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;%*sERROR: %s&quot;</span>, indentlevel*4, <span class="stringliteral">&quot;&quot;</span>, r-&gt;str);</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> REDIS_REPLY_INTEGER:</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;%*sInteger: %lld&quot;</span>, indentlevel*4, <span class="stringliteral">&quot;&quot;</span>, r-&gt;integer);</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> REDIS_REPLY_NIL:</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;%*s(nil)&quot;</span>, indentlevel*4, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> REDIS_REPLY_STRING:</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;%*sSTRING: %s&quot;</span>, indentlevel*4, <span class="stringliteral">&quot;&quot;</span>, r-&gt;str);</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> REDIS_REPLY_ARRAY:</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;%*sARRAY of %d elements&quot;</span>, indentlevel*4, <span class="stringliteral">&quot;&quot;</span>, (<span class="keywordtype">int</span>)r-&gt;elements);</div>
<div class="line">    indentlevel++;</div>
<div class="line">    <span class="keywordflow">for</span>( i=0; i&lt;(int)r-&gt;elements; i++)</div>
<div class="line">      <a class="code" href="lsredis_8c.html#a8268fd06bda0e2c327b057a880b97b59" title="Log the reply.">lsredis_debugCB</a>( ac, r-&gt;element[i], NULL);</div>
<div class="line">    indentlevel--;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">default</span>:</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;%*sUnknown type %d&quot;</span>, indentlevel*4,<span class="stringliteral">&quot;&quot;</span>, r-&gt;type);</div>
<div class="line"></div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2e1f2258b3cc864ce3eef4eda556e2a6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_delRead </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>hook to manage "don't need to read" events </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00686">686</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                  {</div>
<div class="line">  <span class="keyword">struct </span>pollfd *pfd;</div>
<div class="line">  pfd = (<span class="keyword">struct </span>pollfd *)data;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( (pfd-&gt;events &amp; POLLIN) != 0) {</div>
<div class="line">    pfd-&gt;events &amp;= ~POLLIN;</div>
<div class="line">    pthread_kill( <a class="code" href="lsredis_8c.html#a79c33eb11ad6819247930ade3a25671f">lsredis_thread</a>, SIGUSR1);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a04f0119cfa1156dc34d35b237358822a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_delWrite </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>hook to manage "don't need to write anymore" events </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00710">710</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                   {</div>
<div class="line">  <span class="keyword">struct </span>pollfd *pfd;</div>
<div class="line">  pfd = (<span class="keyword">struct </span>pollfd *)data;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( (pfd-&gt;events &amp; POLLOUT) != 0) {</div>
<div class="line">    pfd-&gt;events &amp;= ~POLLOUT;</div>
<div class="line">    pthread_kill( <a class="code" href="lsredis_8c.html#a79c33eb11ad6819247930ade3a25671f">lsredis_thread</a>, SIGUSR1);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae1478efc852fef71550e0f58d602fa2b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_fd_service </td>
          <td>(</td>
          <td class="paramtype">struct pollfd *&#160;</td>
          <td class="paramname"><em>evt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>service the socket requests </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l01290">1290</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                             {</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>);</div>
<div class="line">  <span class="keywordflow">if</span>( evt-&gt;fd == <a class="code" href="lsredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;c.fd) {</div>
<div class="line">    <span class="keywordflow">if</span>( evt-&gt;revents &amp; POLLIN)</div>
<div class="line">      redisAsyncHandleRead( <a class="code" href="lsredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( evt-&gt;revents &amp; POLLOUT)</div>
<div class="line">      redisAsyncHandleWrite( <a class="code" href="lsredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span>( evt-&gt;fd == <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>-&gt;c.fd) {</div>
<div class="line">    <span class="keywordflow">if</span>( evt-&gt;revents &amp; POLLIN)</div>
<div class="line">      redisAsyncHandleRead( <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( evt-&gt;revents &amp; POLLOUT)</div>
<div class="line">      redisAsyncHandleWrite( <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span>( evt-&gt;fd == <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>-&gt;c.fd) {</div>
<div class="line">    <span class="keywordflow">if</span>( evt-&gt;revents &amp; POLLIN)</div>
<div class="line">      redisAsyncHandleRead( <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( evt-&gt;revents &amp; POLLOUT)</div>
<div class="line">      redisAsyncHandleWrite( <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>);</div>
<div class="line">  }</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a87d7bb0ade6f247edfbb7803aac9e694"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsredis_find_preset </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>motor_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>preset_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>dval</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the value of the given preset and return it in dval Returns 0 on error, non-zero on success;. </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00937">937</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                                            {</div>
<div class="line">  <span class="keywordtype">char</span> s[512];</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line">  ENTRY entry_in, *entry_outp;</div>
<div class="line">  <a class="code" href="structlsredis__preset__list__struct.html">lsredis_preset_list_t</a> *pl;</div>
<div class="line"></div>
<div class="line">  snprintf( s, <span class="keyword">sizeof</span>( s)-1, <span class="stringliteral">&quot;%s%s&quot;</span>, motor_name, preset_name);</div>
<div class="line">  s[<span class="keyword">sizeof</span>(s)-1] = 0;</div>
<div class="line"></div>
<div class="line">  entry_in.key  = s;</div>
<div class="line">  entry_in.data = NULL;</div>
<div class="line">  err = hsearch_r( entry_in, FIND, &amp;entry_outp, &amp;<a class="code" href="lsredis_8c.html#ade00a383533fdefb2af9f3f53f37cf97">lsredis_preset_ht</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( err == 0) {</div>
<div class="line">    <span class="comment">// not found (or some other problem that means we don&#39;t have an answer</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Maybe someone added a new preset and we don&#39;t know about it yet</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="lsredis_8c.html#af48b297b5679750a131fa1e982a078b7" title="update the presets hash table for the named motor">lsredis_load_presets</a>( motor_name);</div>
<div class="line">    err = hsearch_r( entry_in, FIND, &amp;entry_outp, &amp;<a class="code" href="lsredis_8c.html#ade00a383533fdefb2af9f3f53f37cf97">lsredis_preset_ht</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( err == 0) {</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Guess not.  Give up.  We tried</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      *dval = 0.0;</div>
<div class="line">      <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  pl = entry_outp-&gt;data;</div>
<div class="line">  *dval = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#ae365a576448adeccb66fbb85cfcf4b23">position</a>);</div>
<div class="line">  <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adfe823e3ccec7e37ac4697179bd65b10"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsredis_find_preset_index_by_position </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#aa5067fcbaabc5bbfdc52492495518c96">lspmac_motor_t</a> *&#160;</td>
          <td class="paramname"><em>mp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>For the given motor object return the index of the current preset or -1 if we are not at a preset position. </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l01035">1035</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                               {</div>
<div class="line">  <a class="code" href="structlsredis__obj__struct.html" title="Redis Object Basic object whose value is sychronized with our redis db.">lsredis_obj_t</a> *<a class="code" href="namespacemk__pgpmac__redis.html#a11daf2847f2dc94562b5b61b3f412574">p</a>;</div>
<div class="line">  <span class="keywordtype">int</span> plength;</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">  <span class="keywordtype">double</span> ur, pos;</div>
<div class="line"></div>
<div class="line">  p = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.presets.length&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line">  plength = <a class="code" href="lsredis_8c.html#a71689006ffc015be6a0705a7c0aef1be">lsredis_get_or_set_l</a>( p, 0);</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">if</span>( plength &lt;= 0) {</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  ur = <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aefa84c7592369090eec8b211caaa3a51" title="Change needs to be at least this big to report as a new position to the database.">update_resolution</a>);</div>
<div class="line">  pos = <a class="code" href="lspmac_8c.html#acc46bdddee59bd8c5ad662b3fd445e9f" title="get the motor position (with locking)">lspmac_getPosition</a>( mp);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;plength; i++) {</div>
<div class="line">    p = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.presets.%d.position&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>, i);</div>
<div class="line">    <span class="keywordflow">if</span>( fabs( pos - <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>( p)) &lt;= ur) {</div>
<div class="line">      <span class="keywordflow">return</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad3bb3ebbae1ffbd03e062ecdd663cc6a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a>* lsredis_get_obj </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00630">630</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                {</div>
<div class="line">  <a class="code" href="structlsredis__obj__struct.html" title="Redis Object Basic object whose value is sychronized with our redis db.">lsredis_obj_t</a> *rtn;</div>
<div class="line">  va_list arg_ptr;</div>
<div class="line">  <span class="keywordtype">char</span> k[512];</div>
<div class="line">  <span class="keywordtype">char</span> *kp;</div>
<div class="line">  <span class="keywordtype">int</span> nkp;</div>
<div class="line"></div>
<div class="line">  va_start( arg_ptr, fmt);</div>
<div class="line">  vsnprintf( k, <span class="keyword">sizeof</span>(k)-1, fmt, arg_ptr);</div>
<div class="line">  k[<span class="keyword">sizeof</span>(k)-1] = 0;</div>
<div class="line">  va_end( arg_ptr);</div>
<div class="line"></div>
<div class="line">  nkp = strlen(k) + strlen( <a class="code" href="lsredis_8c.html#acdca9095c7a3288d7febe9f4c440a6e9">lsredis_head</a>) + 16;         <span class="comment">// 16 is overkill. I know. Get over it.</span></div>
<div class="line">  kp = calloc( nkp, <span class="keyword">sizeof</span>( <span class="keywordtype">char</span>));</div>
<div class="line">  <span class="keywordflow">if</span>( kp == NULL) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis_get_obj: Out of memory&quot;</span>);</div>
<div class="line">    exit( -1);</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  snprintf( kp, nkp-1, <span class="stringliteral">&quot;%s.%s&quot;</span>, <a class="code" href="lsredis_8c.html#acdca9095c7a3288d7febe9f4c440a6e9">lsredis_head</a>, k);</div>
<div class="line">  kp[nkp-1] = 0;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>);</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lsredis_8c.html#a7461eb2b5974a2ffac2189007d39193c">lsredis_running</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;<a class="code" href="lsredis_8c.html#a2f63408d16b5603541b124a78f36a5a8">lsredis_cond</a>, &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>);</div>
<div class="line"></div>
<div class="line">  rtn = <a class="code" href="lsredis_8c.html#ac3fb8589e280bfa18ecbca6619fea637" title="Maybe add a new object Used internally for this module Must be called with lsredis_mutex locked...">_lsredis_get_obj</a>( kp);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>);</div>
<div class="line"></div>
<div class="line">  free( kp);</div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a51c33bec2c54f2d468bf8d93d981914a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double lsredis_get_or_set_d </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>prec</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00359">359</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                                     {</div>
<div class="line">  <span class="keywordtype">long</span> <span class="keywordtype">int</span> rtn;</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line">  <span class="keyword">struct </span>timespec timeout;</div>
<div class="line"></div>
<div class="line">  clock_gettime( CLOCK_REALTIME, &amp;timeout);</div>
<div class="line">  timeout.tv_sec += 2;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  err = 0;</div>
<div class="line">  <span class="keywordflow">while</span>( err == 0 &amp;&amp; p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> == 0)</div>
<div class="line">    err = pthread_cond_timedwait( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>, &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>, &amp;timeout);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( err == ETIMEDOUT) {</div>
<div class="line">    rtn = val;</div>
<div class="line">    pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">    <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( p, <span class="stringliteral">&quot;%.*f&quot;</span>, prec, val);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    rtn = p-&gt;<a class="code" href="structlsredis__obj__struct.html#a26211a0ab3fc02e7776e24dbc1f1256c" title="our value as a long">lvalue</a>;</div>
<div class="line">    pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}  </div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a71689006ffc015be6a0705a7c0aef1be"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">long int lsredis_get_or_set_l </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long int&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00422">422</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                               {</div>
<div class="line">  <span class="keywordtype">long</span> <span class="keywordtype">int</span> rtn;</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line">  <span class="keyword">struct </span>timespec timeout;</div>
<div class="line"></div>
<div class="line">  clock_gettime( CLOCK_REALTIME, &amp;timeout);</div>
<div class="line">  timeout.tv_sec += 2;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  err = 0;</div>
<div class="line">  <span class="keywordflow">while</span>( err == 0 &amp;&amp; p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> == 0)</div>
<div class="line">    err = pthread_cond_timedwait( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>, &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>, &amp;timeout);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( err == ETIMEDOUT) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis_get_or_set_l: using default value of %ld for redis variable %s&quot;</span>, val, p-&gt;<a class="code" href="structlsredis__obj__struct.html#aa8c5a453b9424e5666320b8675a42f5c" title="The redis key for this object.">key</a>);</div>
<div class="line">    rtn = val;</div>
<div class="line">    pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">    <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( p, <span class="stringliteral">&quot;%ld&quot;</span>, val);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    rtn = p-&gt;<a class="code" href="structlsredis__obj__struct.html#a26211a0ab3fc02e7776e24dbc1f1256c" title="our value as a long">lvalue</a>;</div>
<div class="line">    pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}  </div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="abe31d0e11c41b2235307612c963bb652"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char** lsredis_get_string_array </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00448">448</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                   {</div>
<div class="line">  <span class="keywordtype">char</span> **rtn;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <span class="keywordflow">if</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#ae0aa00ad745ee5bbc598c23ab794ed8a" title="1 if this key does not exist and we haven&#39;t set it yet: read will create and set an empty string valu...">creating</a> != 0) {</div>
<div class="line">    pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">    <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( p, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">    pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>, &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line"></div>
<div class="line">  rtn = p-&gt;<a class="code" href="structlsredis__obj__struct.html#ac065eeede0e08f25bcfedd45022fe593" title="our value as an array of strings">avalue</a>;</div>
<div class="line">  pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="abbb4e5ece19ebd130e1be18036752a08"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsredis_getb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00467">467</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                    {</div>
<div class="line">  <span class="keywordtype">int</span> rtn;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <span class="keywordflow">if</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#ae0aa00ad745ee5bbc598c23ab794ed8a" title="1 if this key does not exist and we haven&#39;t set it yet: read will create and set an empty string valu...">creating</a> != 0) {</div>
<div class="line">    pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">    <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( p, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">    pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">while</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>, &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line"></div>
<div class="line">  rtn = p-&gt;<a class="code" href="structlsredis__obj__struct.html#ac3df3eaa275c1e8e333024c1fa8353af" title="our value as a boolean (1 or 0) -1 means we couldn&#39;t figure it out">bvalue</a>;</div>
<div class="line">  pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}  </div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0b7600b1c9a4550b32d4be019d25f941"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char lsredis_getc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00485">485</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                     {</div>
<div class="line">  <span class="keywordtype">int</span> rtn;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <span class="keywordflow">if</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#ae0aa00ad745ee5bbc598c23ab794ed8a" title="1 if this key does not exist and we haven&#39;t set it yet: read will create and set an empty string valu...">creating</a> != 0) {</div>
<div class="line">    pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">    <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( p, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">    pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">while</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>, &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line"></div>
<div class="line">  rtn = p-&gt;<a class="code" href="structlsredis__obj__struct.html#a4a5933dbd44d33d9f594f6020a443b69" title="just the first character of our value">cvalue</a>;</div>
<div class="line">  pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}  </div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa8daf63b794b6b6341018feec205cb7d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double lsredis_getd </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00384">384</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                       {</div>
<div class="line">  <span class="keywordtype">double</span> rtn;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <span class="keywordflow">if</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#ae0aa00ad745ee5bbc598c23ab794ed8a" title="1 if this key does not exist and we haven&#39;t set it yet: read will create and set an empty string valu...">creating</a> != 0) {</div>
<div class="line">    pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">    <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( p, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">    pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>, &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line"></div>
<div class="line">  rtn = p-&gt;<a class="code" href="structlsredis__obj__struct.html#ab60d0a71cabad6b921b6edb5a8f68996" title="our value as a double">dvalue</a>;</div>
<div class="line">  pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1923f998441f4f451204dfd214d52218"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">long int lsredis_getl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00403">403</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                         {</div>
<div class="line">  <span class="keywordtype">long</span> <span class="keywordtype">int</span> rtn;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <span class="keywordflow">if</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#ae0aa00ad745ee5bbc598c23ab794ed8a" title="1 if this key does not exist and we haven&#39;t set it yet: read will create and set an empty string valu...">creating</a> != 0) {</div>
<div class="line">    pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">    <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( p, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">    pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>, &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line"></div>
<div class="line">  rtn = p-&gt;<a class="code" href="structlsredis__obj__struct.html#a26211a0ab3fc02e7776e24dbc1f1256c" title="our value as a long">lvalue</a>;</div>
<div class="line">  pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}  </div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac1994e56114b2315294527d76311f829"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* lsredis_getstr </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>return a copy of the key's string value be sure to free the result </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00282">282</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                        {</div>
<div class="line">  <span class="keywordtype">char</span> *rtn;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Have to use strdup since we cannot guarantee that p-&gt;value won&#39;t be freed while the caller is still using it</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <span class="keywordflow">while</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>, &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line"></div>
<div class="line">  rtn = strdup(p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0465c65288e8101805a6f91049164517" title="our value">value</a>);</div>
<div class="line">  pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="acd9cb833103e57da756d152ecdd4f840"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_heartbeat_cb </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l01331">1331</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                        {</div>
<div class="line">  <span class="keyword">static</span> <a class="code" href="structlsredis__obj__struct.html" title="Redis Object Basic object whose value is sychronized with our redis db.">lsredis_obj_t</a> *hb_time = NULL;</div>
<div class="line">  <span class="keyword">struct </span>timespec <a class="code" href="kvredis_8c.html#ad40ac52086f6b774928af45b09d54c6e" title="used to ensure we do not inundate the db server with connection requests">now</a>;</div>
<div class="line">  <span class="keyword">struct </span>tm lnow;</div>
<div class="line">  <span class="keywordtype">char</span> snow[64];</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> msecs;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( hb_time == NULL) {</div>
<div class="line">    hb_time = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;time&quot;</span>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( hb_time == NULL) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis_heartbeat_cb: null redis object.  Why?&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  clock_gettime( CLOCK_REALTIME, &amp;<a class="code" href="kvredis_8c.html#ad40ac52086f6b774928af45b09d54c6e" title="used to ensure we do not inundate the db server with connection requests">now</a>);</div>
<div class="line">  localtime_r( &amp;<a class="code" href="kvredis_8c.html#ad40ac52086f6b774928af45b09d54c6e" title="used to ensure we do not inundate the db server with connection requests">now</a>.tv_sec, &amp;lnow);</div>
<div class="line">  msecs = <a class="code" href="kvredis_8c.html#ad40ac52086f6b774928af45b09d54c6e" title="used to ensure we do not inundate the db server with connection requests">now</a>.tv_nsec / 1000;</div>
<div class="line">  strftime( snow, <span class="keyword">sizeof</span>(snow)-1, <span class="stringliteral">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, &amp;lnow);</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( hb_time, <span class="stringliteral">&quot;%s.%.06u&quot;</span>, snow, msecs);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8d9719b362d1b38275d734971b7988af"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_hgetCB </td>
          <td>(</td>
          <td class="paramtype">redisAsyncContext *&#160;</td>
          <td class="paramname"><em>ac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>reply</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>privdata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00503">503</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                                         {</div>
<div class="line">  redisReply *r;</div>
<div class="line">  <a class="code" href="structlsredis__obj__struct.html" title="Redis Object Basic object whose value is sychronized with our redis db.">lsredis_obj_t</a> *<a class="code" href="namespacemk__pgpmac__redis.html#a11daf2847f2dc94562b5b61b3f412574">p</a>;</div>
<div class="line"></div>
<div class="line">  r = reply;</div>
<div class="line">  p =  privdata;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//  lslogging_log_message( &quot;hgetCB: %s %s&quot;, p == NULL ? &quot;&lt;NULL&gt;&quot; : p-&gt;key, r-&gt;type == REDIS_REPLY_STRING ? r-&gt;str : &quot;Non-string value.  Why?&quot;);</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Apparently this item does not exist</span></div>
<div class="line">  <span class="comment">// Just set it to an empty string so at least other apps will have the same behaviour as us</span></div>
<div class="line">  <span class="comment">// TODO: figure out a better way to deal with missing key/values</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( p != NULL &amp;&amp; r-&gt;type == REDIS_REPLY_NIL) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Show that we are creating this new key</span></div>
<div class="line">    <span class="comment">// if the next request is a read we&#39;ll create an empty string value and return it</span></div>
<div class="line">    <span class="comment">// if the next request is a write then we&#39;ll create that value and return it</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">    p-&gt;<a class="code" href="structlsredis__obj__struct.html#ae0aa00ad745ee5bbc598c23ab794ed8a" title="1 if this key does not exist and we haven&#39;t set it yet: read will create and set an empty string valu...">creating</a> = 1;</div>
<div class="line">    pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( p != NULL &amp;&amp; r-&gt;type == REDIS_REPLY_STRING &amp;&amp; r-&gt;str != NULL) {</div>
<div class="line">    pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lsredis_8c.html#a05c7ed2bb1b5702a5c83ed3b51abb546" title="set_value and setstr helper funciton p-&gt;mutex must be locked before calling">_lsredis_set_value</a>( p, r-&gt;str);</div>
<div class="line"></div>
<div class="line">    pthread_cond_signal( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>);</div>
<div class="line">    pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4a7466a8c5b90df6dfc78aef625220f4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize this module, that is, set up the connections. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pub</td><td>Publish under this (unique) name </td></tr>
    <tr><td class="paramname">re</td><td>Regular expression to select keys we want to mirror </td></tr>
    <tr><td class="paramname">head</td><td>Prepend this (+ a dot) to the beginning of requested objects </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l01220">1220</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                    {</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// set up hash map to store redis objects</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  err = hcreate_r( 8192, &amp;<a class="code" href="lsredis_8c.html#a42aec6aa74072797ec0344847b0e9e39">lsredis_htab</a>);</div>
<div class="line">  <span class="keywordflow">if</span>( err == 0) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis_init: Cannot create hash table.  Really bad things are going to happen.  hcreate_r returned %d&quot;</span>, err);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  pthread_cond_init( &amp;<a class="code" href="lsredis_8c.html#a2f63408d16b5603541b124a78f36a5a8">lsredis_cond</a>, NULL);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lsredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a> = redisAsyncConnect(<span class="stringliteral">&quot;127.0.0.1&quot;</span>, 6379);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lsredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;err) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Error: %s&quot;</span>, <a class="code" href="lsredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;errstr);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lsredis_8c.html#a0cd3bdc79d035eb1595371c845d14367">subfd</a>.fd           = <a class="code" href="lsredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;c.fd;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a0cd3bdc79d035eb1595371c845d14367">subfd</a>.events       = 0;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;ev.data     = &amp;<a class="code" href="lsredis_8c.html#a0cd3bdc79d035eb1595371c845d14367">subfd</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;ev.addRead  = <a class="code" href="lsredis_8c.html#adee3bccecc86dd531ac5f89491632439" title="hook to mange read events">lsredis_addRead</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;ev.delRead  = <a class="code" href="lsredis_8c.html#a2e1f2258b3cc864ce3eef4eda556e2a6" title="hook to manage &quot;don&#39;t need to read&quot; events">lsredis_delRead</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;ev.addWrite = <a class="code" href="lsredis_8c.html#a3cb6eda5c8ae80019e7a1c078940e9e9" title="hook to manage write events">lsredis_addWrite</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;ev.delWrite = <a class="code" href="lsredis_8c.html#a04f0119cfa1156dc34d35b237358822a" title="hook to manage &quot;don&#39;t need to write anymore&quot; events">lsredis_delWrite</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;ev.cleanup  = <a class="code" href="lsredis_8c.html#a45f946a5262c23b362be17c2cb0310c2" title="hook to clean up TODO: figure out what we are supposed to do here and do it">lsredis_cleanup</a>;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a> = redisAsyncConnect(<span class="stringliteral">&quot;127.0.0.1&quot;</span>, 6379);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>-&gt;err) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Error: %s&quot;</span>, <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>-&gt;errstr);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lsredis_8c.html#add819e43a356d0575ec64c346c6fed57">rofd</a>.fd           = <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>-&gt;c.fd;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#add819e43a356d0575ec64c346c6fed57">rofd</a>.events       = 0;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>-&gt;ev.data     = &amp;<a class="code" href="lsredis_8c.html#add819e43a356d0575ec64c346c6fed57">rofd</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>-&gt;ev.addRead  = <a class="code" href="lsredis_8c.html#adee3bccecc86dd531ac5f89491632439" title="hook to mange read events">lsredis_addRead</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>-&gt;ev.delRead  = <a class="code" href="lsredis_8c.html#a2e1f2258b3cc864ce3eef4eda556e2a6" title="hook to manage &quot;don&#39;t need to read&quot; events">lsredis_delRead</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>-&gt;ev.addWrite = <a class="code" href="lsredis_8c.html#a3cb6eda5c8ae80019e7a1c078940e9e9" title="hook to manage write events">lsredis_addWrite</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>-&gt;ev.delWrite = <a class="code" href="lsredis_8c.html#a04f0119cfa1156dc34d35b237358822a" title="hook to manage &quot;don&#39;t need to write anymore&quot; events">lsredis_delWrite</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>-&gt;ev.cleanup  = <a class="code" href="lsredis_8c.html#a45f946a5262c23b362be17c2cb0310c2" title="hook to clean up TODO: figure out what we are supposed to do here and do it">lsredis_cleanup</a>;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a> = redisAsyncConnect(<span class="stringliteral">&quot;127.0.0.1&quot;</span>, 6379);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>-&gt;err) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Error: %s&quot;</span>, <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>-&gt;errstr);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lsredis_8c.html#a13acbee14dbe8cdb98e238abb921d048">wrfd</a>.fd           = <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>-&gt;c.fd;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a13acbee14dbe8cdb98e238abb921d048">wrfd</a>.events       = 0;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>-&gt;ev.data     = &amp;<a class="code" href="lsredis_8c.html#a13acbee14dbe8cdb98e238abb921d048">wrfd</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>-&gt;ev.addRead  = <a class="code" href="lsredis_8c.html#adee3bccecc86dd531ac5f89491632439" title="hook to mange read events">lsredis_addRead</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>-&gt;ev.delRead  = <a class="code" href="lsredis_8c.html#a2e1f2258b3cc864ce3eef4eda556e2a6" title="hook to manage &quot;don&#39;t need to read&quot; events">lsredis_delRead</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>-&gt;ev.addWrite = <a class="code" href="lsredis_8c.html#a3cb6eda5c8ae80019e7a1c078940e9e9" title="hook to manage write events">lsredis_addWrite</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>-&gt;ev.delWrite = <a class="code" href="lsredis_8c.html#a04f0119cfa1156dc34d35b237358822a" title="hook to manage &quot;don&#39;t need to write anymore&quot; events">lsredis_delWrite</a>;</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>-&gt;ev.cleanup  = <a class="code" href="lsredis_8c.html#a45f946a5262c23b362be17c2cb0310c2" title="hook to clean up TODO: figure out what we are supposed to do here and do it">lsredis_cleanup</a>;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// separate hash table for the presets</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  hcreate_r( <a class="code" href="lsredis_8c.html#ace88a236f88278adaac5419a7281c490">lsredis_preset_max_n</a> * 2, &amp;<a class="code" href="lsredis_8c.html#ade00a383533fdefb2af9f3f53f37cf97">lsredis_preset_ht</a>);</div>
<div class="line"></div>
<div class="line">  pthread_mutex_init( &amp;<a class="code" href="lsredis_8c.html#a1d0b14b31b12d1b2a79dc50eac09de39">lsredis_preset_list_mutex</a>, &amp;<a class="code" href="lsredis_8c.html#a71c9f418904364d65c22d786f4dc5d39">mutex_initializer</a>);</div>
<div class="line">  pthread_mutex_init( &amp;<a class="code" href="lsredis_8c.html#a0c5cbd80d59d69603f123621cc6ddc30">lsredis_config_mutex</a>, &amp;<a class="code" href="lsredis_8c.html#a71c9f418904364d65c22d786f4dc5d39">mutex_initializer</a>);</div>
<div class="line">  pthread_cond_init(  &amp;<a class="code" href="lsredis_8c.html#a6fa076f1004c85a8a1dc400f45547f32">lsredis_config_cond</a>,  NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ace75c15c5308a0fcdafcb82c7506872a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_keysCB </td>
          <td>(</td>
          <td class="paramtype">redisAsyncContext *&#160;</td>
          <td class="paramname"><em>ac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>reply</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>privdata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sift through the keys to find ones we like. </p>
<p>Add them to our list of followed objects </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00841">841</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                                         {</div>
<div class="line">  redisReply *r;</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">  </div>
<div class="line">  r = reply;</div>
<div class="line">  <span class="keywordflow">if</span>( r-&gt;type != REDIS_REPLY_ARRAY) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis_keysCB: exepected array...&quot;</span>);</div>
<div class="line">    <a class="code" href="lsredis_8c.html#a8268fd06bda0e2c327b057a880b97b59" title="Log the reply.">lsredis_debugCB</a>( ac, reply, privdata);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt; (int)r-&gt;elements; i++) {</div>
<div class="line">    <span class="keywordflow">if</span>( r-&gt;element[i]-&gt;type != REDIS_REPLY_STRING) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis_keysCB: exepected string...&quot;</span>);</div>
<div class="line">      <a class="code" href="lsredis_8c.html#a8268fd06bda0e2c327b057a880b97b59" title="Log the reply.">lsredis_debugCB</a>( ac, r-&gt;element[i], privdata);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <a class="code" href="lsredis_8c.html#ad3189a7329ca92efab0054921f608b97">lsredis_maybe_add_key</a>( r-&gt;element[i]-&gt;str);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af48b297b5679750a131fa1e982a078b7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_load_presets </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>motor_name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>update the presets hash table for the named motor </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00864">864</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                             {</div>
<div class="line">  <a class="code" href="structlsredis__obj__struct.html" title="Redis Object Basic object whose value is sychronized with our redis db.">lsredis_obj_t</a> *<a class="code" href="namespacemk__pgpmac__redis.html#a11daf2847f2dc94562b5b61b3f412574">p</a>;</div>
<div class="line">  <a class="code" href="structlsredis__preset__list__struct.html">lsredis_preset_list_t</a> *pl;</div>
<div class="line">  <span class="keywordtype">int</span> plength;</div>
<div class="line">  <span class="keywordtype">char</span> *preset_name;</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">  <span class="keywordtype">int</span> key_length;</div>
<div class="line">  ENTRY entry_in, *entry_outp;</div>
<div class="line"></div>
<div class="line">  p = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.presets.length&quot;</span>, motor_name);</div>
<div class="line">  plength = <a class="code" href="lsredis_8c.html#a71689006ffc015be6a0705a7c0aef1be">lsredis_get_or_set_l</a>( p, 0);</div>
<div class="line">  <span class="keywordflow">if</span>( plength &lt;= 0)</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lsredis_8c.html#a1d0b14b31b12d1b2a79dc50eac09de39">lsredis_preset_list_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;plength; i++) {</div>
<div class="line">    pl = calloc( 1, <span class="keyword">sizeof</span>( <a class="code" href="structlsredis__preset__list__struct.html">lsredis_preset_list_t</a>));</div>
<div class="line">    pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#a285a79dd419ae70c5b75ef57914d3331">name</a>      = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.presets.%d.name&quot;</span>,     motor_name, i);</div>
<div class="line">    pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#ae365a576448adeccb66fbb85cfcf4b23">position</a>  = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.presets.%d.position&quot;</span>, motor_name, i);</div>
<div class="line">    pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#abadcee1d288db4b988946f62bb28d5df">index</a>     = <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">    </div>
<div class="line">    preset_name   = <a class="code" href="lsredis_8c.html#ac1994e56114b2315294527d76311f829" title="return a copy of the key&#39;s string value be sure to free the result">lsredis_getstr</a>( pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#a285a79dd419ae70c5b75ef57914d3331">name</a>);</div>
<div class="line">    key_length    = strlen( motor_name) + strlen( preset_name) + 1;</div>
<div class="line">    pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#ab3a50b52cf845fa70667d8be9ea7d73b">key</a>       = calloc( key_length, 1);</div>
<div class="line"></div>
<div class="line">    pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#a14422c8bfa270e5620c66be871091f67">next</a>            = <a class="code" href="lsredis_8c.html#a232f994f0d91ba8157cbcfe429fc90de">lsredis_preset_list</a>;</div>
<div class="line">    <a class="code" href="lsredis_8c.html#a232f994f0d91ba8157cbcfe429fc90de">lsredis_preset_list</a> = pl;</div>
<div class="line"></div>
<div class="line">    snprintf( pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#ab3a50b52cf845fa70667d8be9ea7d73b">key</a>, key_length, <span class="stringliteral">&quot;%s%s&quot;</span>, motor_name, preset_name);</div>
<div class="line"></div>
<div class="line">    entry_in.key  = pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#ab3a50b52cf845fa70667d8be9ea7d73b">key</a>;</div>
<div class="line">    entry_in.data = pl;</div>
<div class="line">    hsearch_r( entry_in, ENTER, &amp;entry_outp, &amp;<a class="code" href="lsredis_8c.html#ade00a383533fdefb2af9f3f53f37cf97">lsredis_preset_ht</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( entry_outp-&gt;data != pl) {</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// The key was already there or we couldn&#39;t add it</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="keywordflow">if</span>( entry_outp-&gt;data == NULL)</div>
<div class="line">        <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis_load_presets: could not add preset &#39;%s&#39; for motor &#39;%s&#39;&quot;</span>, preset_name, motor_name);</div>
<div class="line"></div>
<div class="line">      free( pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#ab3a50b52cf845fa70667d8be9ea7d73b">key</a>);</div>
<div class="line">      free( pl);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// We&#39;ve successfully added the new key</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <a class="code" href="lsredis_8c.html#adace74d8fa7d2dd58854fa09e66da807">lsredis_preset_n</a>++;</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Resize the hash table if we are starting to fill it up</span></div>
<div class="line">      <span class="comment">// Generally we prefer a sparse table</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="keywordflow">if</span>( <a class="code" href="lsredis_8c.html#adace74d8fa7d2dd58854fa09e66da807">lsredis_preset_n</a> &gt;= <a class="code" href="lsredis_8c.html#ace88a236f88278adaac5419a7281c490">lsredis_preset_max_n</a>) {</div>
<div class="line">        <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis_load_presets: increasing preset hash table size.  max now %d&quot;</span>, <a class="code" href="lsredis_8c.html#ace88a236f88278adaac5419a7281c490">lsredis_preset_max_n</a>);</div>
<div class="line">        hdestroy_r( &amp;<a class="code" href="lsredis_8c.html#ade00a383533fdefb2af9f3f53f37cf97">lsredis_preset_ht</a>);</div>
<div class="line">        <a class="code" href="lsredis_8c.html#ace88a236f88278adaac5419a7281c490">lsredis_preset_max_n</a> *= 2;</div>
<div class="line">        hcreate_r( 2 * <a class="code" href="lsredis_8c.html#ace88a236f88278adaac5419a7281c490">lsredis_preset_max_n</a>, &amp;<a class="code" href="lsredis_8c.html#ade00a383533fdefb2af9f3f53f37cf97">lsredis_preset_ht</a>);</div>
<div class="line">        <span class="keywordflow">for</span>( pl = <a class="code" href="lsredis_8c.html#a232f994f0d91ba8157cbcfe429fc90de">lsredis_preset_list</a>; pl != NULL; pl = pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#a14422c8bfa270e5620c66be871091f67">next</a>) {</div>
<div class="line">          entry_in.key  = pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#ab3a50b52cf845fa70667d8be9ea7d73b">key</a>;</div>
<div class="line">          entry_in.data = pl;</div>
<div class="line">          hsearch_r( entry_in, ENTER, &amp;entry_outp, &amp;<a class="code" href="lsredis_8c.html#ade00a383533fdefb2af9f3f53f37cf97">lsredis_preset_ht</a>);</div>
<div class="line">        }</div>
<div class="line">        <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis_load_presets: done increasing preset hash table size.&quot;</span>, <a class="code" href="lsredis_8c.html#ace88a236f88278adaac5419a7281c490">lsredis_preset_max_n</a>);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    free( preset_name);</div>
<div class="line">  }</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lsredis_8c.html#a1d0b14b31b12d1b2a79dc50eac09de39">lsredis_preset_list_mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a065d09eb6914c057383980d3d786affc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_log </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>send log message to our redis log key </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l01064">1064</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                  {</div>
<div class="line">  <span class="keyword">static</span> <a class="code" href="structlsredis__obj__struct.html" title="Redis Object Basic object whose value is sychronized with our redis db.">lsredis_obj_t</a> *loghashs[32];</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> firstTime = 1;</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> lhi = 0;</div>
<div class="line">  <span class="keywordtype">char</span> msg[2048+64];</div>
<div class="line">  va_list arg_ptr;</div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">if</span>( pthread_mutex_trylock( &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>) == 0) {</div>
<div class="line">    </div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lsredis_8c.html#acdca9095c7a3288d7febe9f4c440a6e9">lsredis_head</a> == NULL) {                 <span class="comment">// Ignore messages that come before redis is initiallized</span></div>
<div class="line">      pthread_mutex_unlock( &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>);</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span>( firstTime) {</div>
<div class="line">      <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">      <span class="keywordflow">for</span>( i=0; i&lt;<span class="keyword">sizeof</span>(loghashs)/<span class="keyword">sizeof</span>(loghashs[0]); i++) {</div>
<div class="line">        loghashs[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>] = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;log.message.%d&quot;</span>, i);</div>
<div class="line">      }</div>
<div class="line">      lhi = 0;</div>
<div class="line">      firstTime=0;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    va_start( arg_ptr, fmt);</div>
<div class="line">    vsnprintf( msg, <span class="keyword">sizeof</span>(msg)-1, fmt, arg_ptr);</div>
<div class="line">    va_end( arg_ptr);</div>
<div class="line">    msg[<span class="keyword">sizeof</span>(msg)-1]=0;</div>
<div class="line">    </div>
<div class="line">    <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( loghashs[lhi], <span class="stringliteral">&quot;%s&quot;</span>, msg);</div>
<div class="line">    lhi = (lhi+1) % (<span class="keyword">sizeof</span>(loghashs)/<span class="keyword">sizeof</span>(loghashs[0]));</div>
<div class="line">    pthread_mutex_unlock( &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>);</div>
<div class="line">    </div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad3189a7329ca92efab0054921f608b97"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_maybe_add_key </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>k</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00833">833</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                     {</div>
<div class="line">  <span class="keywordflow">if</span>( regexec( &amp;<a class="code" href="lsredis_8c.html#abee04898347f9b2551fa0435b1cc597e">lsredis_key_select_regex</a>, k, 0, NULL, 0) == 0) {</div>
<div class="line">    <a class="code" href="lsredis_8c.html#ac3fb8589e280bfa18ecbca6619fea637" title="Maybe add a new object Used internally for this module Must be called with lsredis_mutex locked...">_lsredis_get_obj</a>( k);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac58fca47533e695c8775e0d2b9128766"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsredis_regexec </td>
          <td>(</td>
          <td class="paramtype">const regex_t *&#160;</td>
          <td class="paramname"><em>preg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>nmatch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">regmatch_t *&#160;</td>
          <td class="paramname"><em>pmatch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>eflags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00265">265</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                                                                           {</div>
<div class="line">  <span class="keywordtype">int</span> rtn;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <span class="keywordflow">while</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> == 0) </div>
<div class="line">    pthread_cond_wait( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>, &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line"></div>
<div class="line">  rtn = regexec( preg, p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0465c65288e8101805a6f91049164517" title="our value">value</a>, nmatch, pmatch, eflags);</div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac3db3d5f91bf5723bd94748ce0d88731"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_t* lsredis_run </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l01437">1437</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                         {</div>
<div class="line">  pthread_create( &amp;<a class="code" href="lsredis_8c.html#a79c33eb11ad6819247930ade3a25671f">lsredis_thread</a>, NULL, <a class="code" href="lsredis_8c.html#ade7b1ddfdc88c6964a4c90513e360f75" title="subscribe to changes and service sockets">lsredis_worker</a>, NULL);</div>
<div class="line">  <span class="keywordflow">return</span> &amp;<a class="code" href="lsredis_8c.html#a79c33eb11ad6819247930ade3a25671f">lsredis_thread</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2b48f29f489bcbdaf4fb29e7fbf1d4d2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_set_preset </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>motor_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>preset_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>dval</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>set the given preset to the given value create a new preset if we can't find it </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00974">974</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                                           {</div>
<div class="line">  <span class="keywordtype">char</span> s[512];</div>
<div class="line">  <span class="keywordtype">int</span> plength;</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line">  ENTRY entry_in, *entry_outp;</div>
<div class="line">  <a class="code" href="structlsredis__obj__struct.html" title="Redis Object Basic object whose value is sychronized with our redis db.">lsredis_obj_t</a> *p1, *p2, *presets_length_p;</div>
<div class="line">  <a class="code" href="structlsredis__preset__list__struct.html">lsredis_preset_list_t</a> *pl;</div>
<div class="line">  <span class="keyword">struct </span>timespec timeout;</div>
<div class="line"></div>
<div class="line">  snprintf( s, <span class="keyword">sizeof</span>( s)-1, <span class="stringliteral">&quot;%s%s&quot;</span>, motor_name, preset_name);</div>
<div class="line">  s[<span class="keyword">sizeof</span>(s)-1] = 0;</div>
<div class="line"></div>
<div class="line">  entry_in.key  = s;</div>
<div class="line">  entry_in.data = NULL;</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lsredis_8c.html#a1d0b14b31b12d1b2a79dc50eac09de39">lsredis_preset_list_mutex</a>);</div>
<div class="line">  err = hsearch_r( entry_in, FIND, &amp;entry_outp, &amp;<a class="code" href="lsredis_8c.html#ade00a383533fdefb2af9f3f53f37cf97">lsredis_preset_ht</a>);</div>
<div class="line">  <span class="keywordflow">if</span>( err != 0) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Found it.  Things are simple.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    pthread_mutex_unlock( &amp;p1-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    pl = entry_outp-&gt;data;</div>
<div class="line">    <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( pl-&gt;<a class="code" href="structlsredis__preset__list__struct.html#ae365a576448adeccb66fbb85cfcf4b23">position</a>, <span class="stringliteral">&quot;%.3f&quot;</span>, dval);</div>
<div class="line">    pthread_mutex_unlock( &amp;<a class="code" href="lsredis_8c.html#a1d0b14b31b12d1b2a79dc50eac09de39">lsredis_preset_list_mutex</a>);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// OK, our preset was not found, add it</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  presets_length_p = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>(  <span class="stringliteral">&quot;%s.presets.length&quot;</span>, motor_name);</div>
<div class="line">  plength = <a class="code" href="lsredis_8c.html#a71689006ffc015be6a0705a7c0aef1be">lsredis_get_or_set_l</a>( presets_length_p, 0);</div>
<div class="line">  plength += 1;</div>
<div class="line"></div>
<div class="line">  snprintf( s, <span class="keyword">sizeof</span>( s)-1, <span class="stringliteral">&quot;%s.%s.presets.%d.name&quot;</span>, <a class="code" href="lsredis_8c.html#acdca9095c7a3288d7febe9f4c440a6e9">lsredis_head</a>, motor_name, plength-1);</div>
<div class="line">  s[<span class="keyword">sizeof</span>(s)-1] = 0;</div>
<div class="line"></div>
<div class="line">  p1 = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.presets.%d.name&quot;</span>, motor_name, plength-1);</div>
<div class="line">  pthread_mutex_lock( &amp;p1-&gt;mutex);</div>
<div class="line">  err = 0;</div>
<div class="line">  <span class="keywordflow">while</span>( err == 0 &amp;&amp; p1-&gt;valid == 0)</div>
<div class="line">    err = pthread_cond_timedwait( &amp;p1-&gt;cond, &amp;p1-&gt;mutex, &amp;timeout);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( err == ETIMEDOUT) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis_set_preset: timed out waiting for name to become valid&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  pthread_mutex_unlock( &amp;p1-&gt;mutex);</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( p1, <span class="stringliteral">&quot;%s&quot;</span>, preset_name);</div>
<div class="line">  </div>
<div class="line">  p2 = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s.presets.%d.position&quot;</span>, motor_name, plength-1);</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( p2, <span class="stringliteral">&quot;%.3f&quot;</span>, dval);</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( presets_length_p, <span class="stringliteral">&quot;%ld&quot;</span>, plength);</div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lsredis_8c.html#a1d0b14b31b12d1b2a79dc50eac09de39">lsredis_preset_list_mutex</a>);</div>
<div class="line">  <a class="code" href="lsredis_8c.html#af48b297b5679750a131fa1e982a078b7" title="update the presets hash table for the named motor">lsredis_load_presets</a>( motor_name);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac3c27bda1c9b10e6db14665951746da8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_set_value </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the value of a redis object and make it valid. </p>
<p>Called by mgetCB to set the value as it is in redis Maybe TODO: we've arbitrarily set the maximum size of a value here. Although I cannot imagine needed bigger values it would not be a big deal to enable it. </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00225">225</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                          {</div>
<div class="line">  va_list arg_ptr;</div>
<div class="line">  <span class="keywordtype">char</span> <a class="code" href="namespacemk__pgpmac__redis.html#ac732d49b0afca9a9951e3a252bae42fc">v</a>[512];</div>
<div class="line">  </div>
<div class="line">  va_start( arg_ptr, fmt);</div>
<div class="line">  vsnprintf( v, <span class="keyword">sizeof</span>(v)-1, fmt, arg_ptr);</div>
<div class="line">  va_end( arg_ptr);</div>
<div class="line"></div>
<div class="line">  v[<span class="keyword">sizeof</span>(<a class="code" href="namespacemk__pgpmac__redis.html#ac732d49b0afca9a9951e3a252bae42fc">v</a>)-1] = 0;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lsredis_8c.html#a05c7ed2bb1b5702a5c83ed3b51abb546" title="set_value and setstr helper funciton p-&gt;mutex must be locked before calling">_lsredis_set_value</a>( p, v);</div>
<div class="line"></div>
<div class="line">  pthread_cond_signal( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>);</div>
<div class="line">  pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9b9c64f883c7ded60badfe89cb15fa78"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_setstr </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the value and update redis. </p>
<p>Note that lsredis_set_value sets the value based on redis while here we set redis based on the value Arbitray maximum string length set here. TODO: Probably this limit should be removed at some point.</p>
<p>redisAsyncCommandArgv used instead of redisAsyncCommand 'cause it's easier (and possible) to deal with strings that would otherwise cause hiredis to emit a bad command, like those containing spaces. </p>
<p>&lt; up the count of times we need to see ourselves published before we start listening to others again</p>
<p>&lt; Unlock to prevent deadlock in case the service routine needs to set our value</p>
<p>&lt; redisAsyncCommandArgv shouldn't need to access this after it's made up it's packet (before it returns) so we should be OK with this location disappearing soon.</p>
<p>&lt; At this point the key is considered created </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00307">307</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                       {</div>
<div class="line">  va_list arg_ptr;</div>
<div class="line">  <span class="keywordtype">char</span> <a class="code" href="namespacemk__pgpmac__redis.html#ac732d49b0afca9a9951e3a252bae42fc">v</a>[512];</div>
<div class="line">  <span class="keywordtype">char</span> *argv[4];</div>
<div class="line"></div>
<div class="line">  va_start( arg_ptr, fmt);</div>
<div class="line">  vsnprintf( v, <span class="keyword">sizeof</span>(v)-1, fmt, arg_ptr);</div>
<div class="line">  v[<span class="keyword">sizeof</span>(<a class="code" href="namespacemk__pgpmac__redis.html#ac732d49b0afca9a9951e3a252bae42fc">v</a>)-1] = 0;</div>
<div class="line">  va_end( arg_ptr);</div>
<div class="line">  </div>
<div class="line">  pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Don&#39;t send an update if a good value has not changed</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#ae0aa00ad745ee5bbc598c23ab794ed8a" title="1 if this key does not exist and we haven&#39;t set it yet: read will create and set an empty string valu...">creating</a> != 0 &amp;&amp; p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> &amp;&amp; strcmp( v, p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0465c65288e8101805a6f91049164517" title="our value">value</a>) == 0) {</div>
<div class="line">    <span class="comment">// nothing to do</span></div>
<div class="line">    pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  p-&gt;<a class="code" href="structlsredis__obj__struct.html#a8bc1a536b7155a1e2a749c7c434b898b" title="Number of times we need to see our publication before we start accepting new values.">wait_for_me</a>++;                     </div>
<div class="line">  pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);     </div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  argv[0] = <span class="stringliteral">&quot;HSET&quot;</span>;</div>
<div class="line">  argv[1] = p-&gt;<a class="code" href="structlsredis__obj__struct.html#aa8c5a453b9424e5666320b8675a42f5c" title="The redis key for this object.">key</a>;</div>
<div class="line">  argv[2] = <span class="stringliteral">&quot;VALUE&quot;</span>;</div>
<div class="line">  argv[3] = <a class="code" href="namespacemk__pgpmac__redis.html#ac732d49b0afca9a9951e3a252bae42fc">v</a>;          </div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>);</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lsredis_8c.html#a7461eb2b5974a2ffac2189007d39193c">lsredis_running</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;<a class="code" href="lsredis_8c.html#a2f63408d16b5603541b124a78f36a5a8">lsredis_cond</a>, &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>);</div>
<div class="line"></div>
<div class="line">  redisAsyncCommand( <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>, NULL, NULL, <span class="stringliteral">&quot;MULTI&quot;</span>);</div>
<div class="line">  redisAsyncCommandArgv( <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>, NULL, NULL, 4, (<span class="keyword">const</span> <span class="keywordtype">char</span> **)argv, NULL);</div>
<div class="line"></div>
<div class="line">  redisAsyncCommand( <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>, NULL, NULL, <span class="stringliteral">&quot;PUBLISH %s %s&quot;</span>, <a class="code" href="lsredis_8c.html#a0c81dce2e75584eeb14ab7d9dd86c72e">lsredis_publisher</a>, p-&gt;<a class="code" href="structlsredis__obj__struct.html#aa8c5a453b9424e5666320b8675a42f5c" title="The redis key for this object.">key</a>);</div>
<div class="line">  redisAsyncCommand( <a class="code" href="lsredis_8c.html#a7ea13129ad9e41a0ed2fc19fa75ffb0d">wrac</a>, NULL, NULL, <span class="stringliteral">&quot;EXEC&quot;</span>);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Assume redis will take exactly the value we sent it</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">  <a class="code" href="lsredis_8c.html#a05c7ed2bb1b5702a5c83ed3b51abb546" title="set_value and setstr helper funciton p-&gt;mutex must be locked before calling">_lsredis_set_value</a>( p, v);</div>
<div class="line">  p-&gt;<a class="code" href="structlsredis__obj__struct.html#ae0aa00ad745ee5bbc598c23ab794ed8a" title="1 if this key does not exist and we haven&#39;t set it yet: read will create and set an empty string valu...">creating</a> = 0;                      </div>
<div class="line">  pthread_cond_signal( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a356f6a228bb19ac7d66fdb1c875d68be" title="wait for a valid value">cond</a>);</div>
<div class="line">  pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa060eb807fbecb6e6430d2cbae2c9673"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_sig_service </td>
          <td>(</td>
          <td class="paramtype">struct pollfd *&#160;</td>
          <td class="paramname"><em>evt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">evt</td><td>The pollfd object that triggered this call </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l01314">1314</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                        {</div>
<div class="line">  <span class="keyword">struct </span>signalfd_siginfo fdsi;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Really, we don&#39;t care about the signal,</span></div>
<div class="line">  <span class="comment">// it&#39;s just used to drop out of the poll</span></div>
<div class="line">  <span class="comment">// function when there is something for us</span></div>
<div class="line">  <span class="comment">// to do.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  read( evt-&gt;fd, &amp;fdsi, <span class="keyword">sizeof</span>( <span class="keyword">struct</span> signalfd_siginfo));</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a84611531459bf3d92c45b86308b4a300"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsredis_subCB </td>
          <td>(</td>
          <td class="paramtype">redisAsyncContext *&#160;</td>
          <td class="paramname"><em>ac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>reply</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>privdata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Use the publication to request the new value. </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00741">741</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                                        {</div>
<div class="line">  redisReply *r;</div>
<div class="line">  <a class="code" href="structlsredis__obj__struct.html" title="Redis Object Basic object whose value is sychronized with our redis db.">lsredis_obj_t</a> *<a class="code" href="namespacemk__pgpmac__redis.html#a11daf2847f2dc94562b5b61b3f412574">p</a>;</div>
<div class="line">  <span class="keywordtype">char</span> *k;</div>
<div class="line">  <span class="keywordtype">char</span> *publisher;</div>
<div class="line">  ENTRY htab_input, *htab_output;</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line"></div>
<div class="line">  r = (redisReply *)reply;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Ignore our psubscribe reply</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( r-&gt;type == REDIS_REPLY_ARRAY &amp;&amp; r-&gt;elements == 3 &amp;&amp; r-&gt;element[0]-&gt;type == REDIS_REPLY_STRING &amp;&amp; strcmp( r-&gt;element[0]-&gt;str, <span class="stringliteral">&quot;psubscribe&quot;</span>)==0)</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// But log other stuff we don&#39;t understand</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( r-&gt;type != REDIS_REPLY_ARRAY ||</div>
<div class="line">      r-&gt;elements != 4 ||</div>
<div class="line">      r-&gt;element[3]-&gt;type != REDIS_REPLY_STRING ||</div>
<div class="line">      r-&gt;element[2]-&gt;type != REDIS_REPLY_STRING) {</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis_subCB: unexpected reply&quot;</span>);</div>
<div class="line">    <a class="code" href="lsredis_8c.html#a8268fd06bda0e2c327b057a880b97b59" title="Log the reply.">lsredis_debugCB</a>( ac, reply, privdata);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Ignore obvious junk</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  k = r-&gt;element[3]-&gt;str;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( k == NULL || *k == 0)</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  </div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// see if we care</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( regexec( &amp;<a class="code" href="lsredis_8c.html#abee04898347f9b2551fa0435b1cc597e">lsredis_key_select_regex</a>, k, 0, NULL, 0) == 0) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// We should know about this one</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    </div>
<div class="line">    htab_input.key  = k;</div>
<div class="line">    htab_input.data = NULL;</div>
<div class="line"></div>
<div class="line">    errno = 0;</div>
<div class="line">    err = hsearch_r( htab_input, FIND, &amp;htab_output, &amp;<a class="code" href="lsredis_8c.html#a42aec6aa74072797ec0344847b0e9e39">lsredis_htab</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( err == 0 &amp;&amp; errno == ESRCH)</div>
<div class="line">      p = NULL;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      p = htab_output-&gt;data;</div>
<div class="line">      </div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( p == NULL) {</div>
<div class="line">      <a class="code" href="lsredis_8c.html#ac3fb8589e280bfa18ecbca6619fea637" title="Maybe add a new object Used internally for this module Must be called with lsredis_mutex locked...">_lsredis_get_obj</a>( k);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <span class="comment">// Look who&#39;s talk&#39;n</span></div>
<div class="line">      publisher = r-&gt;element[2]-&gt;str;</div>
<div class="line"></div>
<div class="line">      pthread_mutex_lock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">      <span class="keywordflow">if</span>( p-&gt;<a class="code" href="structlsredis__obj__struct.html#a8bc1a536b7155a1e2a749c7c434b898b" title="Number of times we need to see our publication before we start accepting new values.">wait_for_me</a>) {</div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// see if we are done waiting</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="keywordflow">if</span>( strcmp( publisher, <a class="code" href="lsredis_8c.html#a0c81dce2e75584eeb14ab7d9dd86c72e">lsredis_publisher</a>)==0)</div>
<div class="line">          p-&gt;<a class="code" href="structlsredis__obj__struct.html#a8bc1a536b7155a1e2a749c7c434b898b" title="Number of times we need to see our publication before we start accepting new values.">wait_for_me</a>--;</div>
<div class="line"></div>
<div class="line">        pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// Don&#39;t get a new value, either we set it last or we are still waiting for redis to report</span></div>
<div class="line">        <span class="comment">// our publication</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">      }</div>
<div class="line"></div>
<div class="line">      <span class="comment">// Here we know our value is out of date</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      p-&gt;<a class="code" href="structlsredis__obj__struct.html#a338ffa4123bd06b39c8b58f5e695575e" title="1 if we think the value is good, 0 otherwise">valid</a> = 0;</div>
<div class="line">      <span class="comment">//lsevents_send_event( &quot;%s Invalid&quot;, p-&gt;events_name);</span></div>
<div class="line">      pthread_mutex_unlock( &amp;p-&gt;<a class="code" href="structlsredis__obj__struct.html#a0da18e7d0f7d52459bbc6fbc696d5252" title="Don&#39;t let anyone use an old value.">mutex</a>);</div>
<div class="line"></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// We shouldn&#39;t get here if wait_for_me is zero and we are the publisher.</span></div>
<div class="line">      <span class="comment">// If somehow we did (ie we did an hset with out incrementing wait_for_me or if we published too many times), it shouldn&#39;t hurt to get the value again.</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      redisAsyncCommand( <a class="code" href="lsredis_8c.html#afc92245910ec04f9a341c092def45564">roac</a>, <a class="code" href="lsredis_8c.html#a8d9719b362d1b38275d734971b7988af">lsredis_hgetCB</a>, p, <span class="stringliteral">&quot;HGET %s VALUE&quot;</span>, k);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ade7b1ddfdc88c6964a4c90513e360f75"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* lsredis_worker </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>dummy</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>subscribe to changes and service sockets </p>
<p>&lt; poll timeout, in millisecs (of course)</p>
<p>&lt; array of pollfd's for the poll function, one entry per connection</p>
<p>&lt; number of active elements in fda </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l01357">1357</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                    {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> poll_timeout_ms = -1;      </div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">struct </span>pollfd fda[4];          </div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> nfda = 0;                  </div>
<div class="line">  <span class="keyword">static</span> sigset_t <a class="code" href="pgpmac_8c.html#a76042459b23ade6d59ce9698d890ea89">our_sigset</a>;</div>
<div class="line">  <span class="keywordtype">int</span> pollrtn;</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>);</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// block ordinary signal mechanism</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  sigemptyset( &amp;our_sigset);</div>
<div class="line">  sigaddset( &amp;our_sigset, SIGUSR1);</div>
<div class="line">  pthread_sigmask( SIG_BLOCK, &amp;our_sigset, NULL);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Set up fd mechanism</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  fda[0].fd = signalfd( -1, &amp;our_sigset, SFD_NONBLOCK);</div>
<div class="line">  <span class="keywordflow">if</span>( fda[0].fd == -1) {</div>
<div class="line">    <span class="keywordtype">char</span> *es;</div>
<div class="line"></div>
<div class="line">    es = strerror( errno);</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis_worker: Signalfd trouble &#39;%s&#39;&quot;</span>, es);</div>
<div class="line">  }</div>
<div class="line">  fda[0].events = POLLIN;</div>
<div class="line">  nfda = 1;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lsredis_8c.html#a7461eb2b5974a2ffac2189007d39193c">lsredis_running</a> = 1;</div>
<div class="line"></div>
<div class="line">  pthread_cond_signal( &amp;<a class="code" href="lsredis_8c.html#a2f63408d16b5603541b124a78f36a5a8">lsredis_cond</a>);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^Heartbeat$&quot;</span>, <a class="code" href="lsredis_8c.html#acd9cb833103e57da756d152ecdd4f840">lsredis_heartbeat_cb</a>);</div>
<div class="line">  <a class="code" href="lstimer_8c.html#a7b3e725fbe1bb3cc9f8465941cf1e381" title="Create a timer.">lstimer_set_timer</a>( <span class="stringliteral">&quot;Heartbeat&quot;</span>, -1, 1, 0);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span>(1) {</div>
<div class="line">    nfda = 1;</div>
<div class="line"></div>
<div class="line">    pthread_mutex_lock( &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lsredis_8c.html#a0cd3bdc79d035eb1595371c845d14367">subfd</a>.fd != -1) {</div>
<div class="line">      fda[nfda].fd      = <a class="code" href="lsredis_8c.html#a0cd3bdc79d035eb1595371c845d14367">subfd</a>.fd;</div>
<div class="line">      fda[nfda].events  = <a class="code" href="lsredis_8c.html#a0cd3bdc79d035eb1595371c845d14367">subfd</a>.events;</div>
<div class="line">      fda[nfda].revents = 0;</div>
<div class="line">      nfda++;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lsredis_8c.html#add819e43a356d0575ec64c346c6fed57">rofd</a>.fd != -1) {</div>
<div class="line">      fda[nfda].fd      = <a class="code" href="lsredis_8c.html#add819e43a356d0575ec64c346c6fed57">rofd</a>.fd;</div>
<div class="line">      fda[nfda].events  = <a class="code" href="lsredis_8c.html#add819e43a356d0575ec64c346c6fed57">rofd</a>.events;</div>
<div class="line">      fda[nfda].revents = 0; </div>
<div class="line">     nfda++;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lsredis_8c.html#a13acbee14dbe8cdb98e238abb921d048">wrfd</a>.fd != -1) {</div>
<div class="line">      fda[nfda].fd      = <a class="code" href="lsredis_8c.html#a13acbee14dbe8cdb98e238abb921d048">wrfd</a>.fd;</div>
<div class="line">      fda[nfda].events  = <a class="code" href="lsredis_8c.html#a13acbee14dbe8cdb98e238abb921d048">wrfd</a>.events;</div>
<div class="line">      fda[nfda].revents = 0;</div>
<div class="line">      nfda++;</div>
<div class="line">    }</div>
<div class="line">    pthread_mutex_unlock( &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>);</div>
<div class="line"></div>
<div class="line">    pollrtn = poll( fda, nfda, poll_timeout_ms);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( pollrtn &amp;&amp; fda[0].revents) {</div>
<div class="line">      <a class="code" href="lsredis_8c.html#aa060eb807fbecb6e6430d2cbae2c9673">lsredis_sig_service</a>( &amp;(fda[0]));</div>
<div class="line">      pollrtn--;</div>
<div class="line">    } </div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>( i=1; i&lt;nfda; i++) {</div>
<div class="line">      <span class="keywordflow">if</span>( fda[i].revents) {</div>
<div class="line">        <a class="code" href="lsredis_8c.html#ae1478efc852fef71550e0f58d602fa2b" title="service the socket requests">lsredis_fd_service</a>( &amp;(fda[i]));</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa1941e6515a254f76cfd1f18d3c8fac3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void redisDisconnectCB </td>
          <td>(</td>
          <td class="paramtype">const redisAsyncContext *&#160;</td>
          <td class="paramname"><em>ac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>status</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>call back in case a redis server becomes disconnected TODO: reconnect </p>

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00666">666</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>
<div class="fragment"><div class="line">                                                                {</div>
<div class="line">  <span class="keywordflow">if</span>( status != REDIS_OK) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lsredis: Disconnected with status %d&quot;</span>, status);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a2f63408d16b5603541b124a78f36a5a8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_cond_t lsredis_cond</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00075">75</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6fa076f1004c85a8a1dc400f45547f32"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pthread_cond_t lsredis_config_cond</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00091">91</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a0c5cbd80d59d69603f123621cc6ddc30"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t lsredis_config_mutex</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00090">90</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="acdca9095c7a3288d7febe9f4c440a6e9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">char* lsredis_head = NULL</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00089">89</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a42aec6aa74072797ec0344847b0e9e39"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct hsearch_data lsredis_htab</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00081">81</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="abee04898347f9b2551fa0435b1cc597e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">regex_t lsredis_key_select_regex</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00088">88</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a390e8acf789b0fa41b43a794dd27e28f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t lsredis_mutex = PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00074">74</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3d206e1c119f1408a7cf1078139f8189"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#ad449de06d02791adf2498d2a1e1f909c">lsredis_obj_t</a>* lsredis_objs = NULL</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00080">80</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="ade00a383533fdefb2af9f3f53f37cf97"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct hsearch_data lsredis_preset_ht</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00106">106</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a232f994f0d91ba8157cbcfe429fc90de"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lsredis_8c.html#a8eac570b2b69ea0b7948b6c581cf6002">lsredis_preset_list_t</a>* lsredis_preset_list = NULL</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00105">105</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1d0b14b31b12d1b2a79dc50eac09de39"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t lsredis_preset_list_mutex</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00109">109</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="ace88a236f88278adaac5419a7281c490"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int lsredis_preset_max_n = 1024</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00108">108</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="adace74d8fa7d2dd58854fa09e66da807"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int lsredis_preset_n = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00107">107</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a0c81dce2e75584eeb14ab7d9dd86c72e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">char* lsredis_publisher = NULL</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00087">87</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7461eb2b5974a2ffac2189007d39193c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsredis_running = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00076">76</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a79c33eb11ad6819247930ade3a25671f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pthread_t lsredis_thread</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00072">72</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a71c9f418904364d65c22d786f4dc5d39"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutexattr_t mutex_initializer</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00077">77</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="afc92245910ec04f9a341c092def45564"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">redisAsyncContext* roac</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00084">84</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="add819e43a356d0575ec64c346c6fed57"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct pollfd rofd</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00094">94</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a4d65536cb1094fb5deda0a852b181232"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">redisAsyncContext* subac</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00083">83</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a0cd3bdc79d035eb1595371c845d14367"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct pollfd subfd</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00093">93</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7ea13129ad9e41a0ed2fc19fa75ffb0d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">redisAsyncContext* wrac</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00085">85</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a13acbee14dbe8cdb98e238abb921d048"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct pollfd wrfd</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lsredis_8c_source.html#l00095">95</a> of file <a class="el" href="lsredis_8c_source.html">lsredis.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="lsredis_8c.html">lsredis.c</a></li>
    <li class="footer">Generated on Fri May 23 2014 09:07:05 for LS-CAT PGPMAC by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 </li>
  </ul>
</div>
</body>
</html>
