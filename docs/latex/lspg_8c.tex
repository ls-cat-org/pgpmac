\hypertarget{lspg_8c}{\section{lspg.\-c File Reference}
\label{lspg_8c}\index{lspg.\-c@{lspg.\-c}}
}


Postgresql support for the L\-S-\/\-C\-A\-T pgpmac project.  


{\ttfamily \#include \char`\"{}pgpmac.\-h\char`\"{}}\\*
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structlspg__wait__for__detector__struct}{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-struct}
\begin{DoxyCompactList}\small\item\em Object that implements detector / spindle timing We use database locks for exposure control and this implements the md2 portion of this handshake. \end{DoxyCompactList}\item 
struct \hyperlink{structlspg__lock__diffractometer__struct}{lspg\-\_\-lock\-\_\-diffractometer\-\_\-struct}
\begin{DoxyCompactList}\small\item\em Object used to impliment locking the diffractometer Critical to exposure timing. \end{DoxyCompactList}\item 
struct \hyperlink{structlspg__lock__detector__struct}{lspg\-\_\-lock\-\_\-detector\-\_\-struct}
\begin{DoxyCompactList}\small\item\em lock detector object Implements detector lock for exposure control \end{DoxyCompactList}\item 
struct \hyperlink{structlspg__seq__run__prep__struct}{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-struct}
\begin{DoxyCompactList}\small\item\em Data collection running object. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{lspg_8c_af443092447378c73bf93aa143576aba4}{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-N\-I\-T}~-\/4
\item 
\#define \hyperlink{lspg_8c_ae7ea5876846b5f04c419aee22d3c0aa1}{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-N\-I\-T\-\_\-\-P\-O\-L\-L}~-\/3
\item 
\#define \hyperlink{lspg_8c_accda8c3a598dc7f5b107b04986d8ab50}{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-S\-E\-T}~-\/2
\item 
\#define \hyperlink{lspg_8c_ac70a1141f3b138055ea7143bd493187c}{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-S\-E\-T\-\_\-\-P\-O\-L\-L}~-\/1
\item 
\#define \hyperlink{lspg_8c_aaf1dd8ba4dafb91c296554c4cbf312e3}{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-D\-L\-E}~1
\item 
\#define \hyperlink{lspg_8c_a3c6eb19f262a990e1f9ba630d9edc309}{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-S\-E\-N\-D}~2
\item 
\#define \hyperlink{lspg_8c_a88a7e80c12fb0449c4b0857a0c7deb21}{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-S\-E\-N\-D\-\_\-\-F\-L\-U\-S\-H}~3
\item 
\#define \hyperlink{lspg_8c_a373e668840b4795ff9a71bc3f744d209}{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-C\-V}~4
\item 
\#define \hyperlink{lspg_8c_a08fe83fe8226002ee8b80ce0a914fd11}{L\-S\-\_\-\-P\-G\-\_\-\-Q\-U\-E\-R\-Y\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H}~16384
\begin{DoxyCompactList}\small\item\em Queue length should be long enough that we do not ordinarly bump into the end We should be safe as long as the thread the adds stuff to the queue is not the one that removes it. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef struct \\*
\hyperlink{structlspg__wait__for__detector__struct}{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-struct} \hyperlink{lspg_8c_a6f273a499bf316de95df3816a9b1bc06}{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-t}
\begin{DoxyCompactList}\small\item\em Object that implements detector / spindle timing We use database locks for exposure control and this implements the md2 portion of this handshake. \end{DoxyCompactList}\item 
typedef struct \\*
\hyperlink{structlspg__lock__diffractometer__struct}{lspg\-\_\-lock\-\_\-diffractometer\-\_\-struct} \hyperlink{lspg_8c_a7232a0d630558f0c4c081d087150973d}{lspg\-\_\-lock\-\_\-diffractometer\-\_\-t}
\begin{DoxyCompactList}\small\item\em Object used to impliment locking the diffractometer Critical to exposure timing. \end{DoxyCompactList}\item 
typedef struct \\*
\hyperlink{structlspg__lock__detector__struct}{lspg\-\_\-lock\-\_\-detector\-\_\-struct} \hyperlink{lspg_8c_a3442e66a1f05457eb22a0d4a5d295f3a}{lspg\-\_\-lock\-\_\-detector\-\_\-t}
\begin{DoxyCompactList}\small\item\em lock detector object Implements detector lock for exposure control \end{DoxyCompactList}\item 
typedef struct \\*
\hyperlink{structlspg__seq__run__prep__struct}{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-struct} \hyperlink{lspg_8c_ab2da550aea6388c835abe0ee0b226eb0}{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-t}
\begin{DoxyCompactList}\small\item\em Data collection running object. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{pgpmac_8h_ae57432c0a6ac48a50457815dab2c5b4c}{lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$ \hyperlink{lspg_8c_ad5f3ec8f197cc330c83dba70f310533c}{lspg\-\_\-query\-\_\-next} ()
\begin{DoxyCompactList}\small\item\em Return the next item in the postgresql queue. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a3847589e641f7e16a0cd68ef30e37cca}{lspg\-\_\-query\-\_\-reply\-\_\-next} ()
\begin{DoxyCompactList}\small\item\em Remove the oldest item in the queue. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_ae57432c0a6ac48a50457815dab2c5b4c}{lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$ \hyperlink{lspg_8c_ae6bf4f54117bedf903360883bb32699f}{lspg\-\_\-query\-\_\-reply\-\_\-peek} ()
\begin{DoxyCompactList}\small\item\em Return the next item in the reply queue but don't pop it since we may need it more than once. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\-\_\-query\-\_\-push} (void($\ast$cb)(\hyperlink{pgpmac_8h_ae57432c0a6ac48a50457815dab2c5b4c}{lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$, P\-Gresult $\ast$), char $\ast$fmt,...)
\begin{DoxyCompactList}\small\item\em Place a query on the queue. \end{DoxyCompactList}\item 
char $\ast$$\ast$ \hyperlink{lspg_8c_a46f23ae999129d6fd5712d7975b99aed}{lspg\-\_\-array2ptrs} (char $\ast$a)
\begin{DoxyCompactList}\small\item\em returns a null terminated list of strings parsed from postgresql array \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_afb8d1ff1e0f4fcdc85ad9c684271cb3d}{lspg\-\_\-allkvs\-\_\-cb} (\hyperlink{pgpmac_8h_ae57432c0a6ac48a50457815dab2c5b4c}{lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$qqp, P\-Gresult $\ast$pgr)
\begin{DoxyCompactList}\small\item\em set a redis variable based on an updated kv pair \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_ad503cefdaee8112ea2129d33db2ec7fa}{lspg\-\_\-update\-\_\-kvs\-\_\-cb} (char $\ast$event)
\begin{DoxyCompactList}\small\item\em Perhaps update the px.\-kvs table in postgresql Should be triggered by a timer event. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_ab98f7d254fa0f5f4826f9427ca8b4f03}{lspg\-\_\-starttransfer\-\_\-init} ()
\item 
void \hyperlink{lspg_8c_a289005bed571909f5ce4de2ff4e70e36}{lspg\-\_\-starttransfer\-\_\-cb} (\hyperlink{pgpmac_8h_ae57432c0a6ac48a50457815dab2c5b4c}{lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$qqp, P\-Gresult $\ast$pgr)
\item 
void \hyperlink{lspg_8c_af72c4b037347737df09348ab703f6802}{lspg\-\_\-starttransfer\-\_\-call} (unsigned int nextsample, int \hyperlink{pgpmac_8h_ac59ab990e48033a811aeb0281fb588fc}{sample\-\_\-detected}, double ax, double ay, double az, double horz, double vert, double esttime)
\item 
void \hyperlink{lspg_8c_a189e9fd5cbc06dd09e5549f6e229fa5e}{lspg\-\_\-starttransfer\-\_\-wait} ()
\item 
void \hyperlink{lspg_8c_ad989179281d8b65b940250a4580007d0}{lspg\-\_\-starttransfer\-\_\-done} ()
\item 
int \hyperlink{lspg_8c_a40fed0d8ea49206604ca5727d94b8faf}{lspg\-\_\-starttransfer\-\_\-all} (int $\ast$err, unsigned int nextsample, int sampledetected, double ax, double ay, double az, double horz, double vert, double esttime)
\item 
void \hyperlink{lspg_8c_a5d6f6c4733629fc14e4f0bc128a1ffb7}{lspg\-\_\-getcurrentsampleid\-\_\-init} ()
\item 
void \hyperlink{lspg_8c_a3245894737f9b496b7882c6e6ed8519d}{lspg\-\_\-getcurrentsampleid\-\_\-cb} (\hyperlink{pgpmac_8h_ae57432c0a6ac48a50457815dab2c5b4c}{lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$qqp, P\-Gresult $\ast$pgr)
\begin{DoxyCompactList}\small\item\em get currentsampleid \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_acf98a9e2adec05a69847045f444a5c77}{lspg\-\_\-getcurrentsampleid\-\_\-call} ()
\item 
unsigned int \hyperlink{lspg_8c_a7b070b4891f485b7f74c95e0e60471f3}{lspg\-\_\-getcurrentsampleid\-\_\-read} ()
\item 
void \hyperlink{lspg_8c_a2d624b228ddd560ace0cef4286a30b07}{lspg\-\_\-getcurrentsampleid\-\_\-wait\-\_\-for\-\_\-id} (unsigned int test)
\item 
void \hyperlink{lspg_8c_a5e1de4aa16107d1f5f801e11ae6b268c}{lspg\-\_\-nextsample\-\_\-cb} (\hyperlink{pgpmac_8h_ae57432c0a6ac48a50457815dab2c5b4c}{lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$qqp, P\-Gresult $\ast$pgr)
\begin{DoxyCompactList}\small\item\em Next Sample. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a2faa901ea0a8ef00cfd93a893b34b446}{lspg\-\_\-nextsample\-\_\-init} ()
\begin{DoxyCompactList}\small\item\em Initialize the nextsample variable, mutex, and condition. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_aab1c441d22126ea4334b3c61b7e4b4c2}{lspg\-\_\-nextsample\-\_\-call} ()
\begin{DoxyCompactList}\small\item\em Queue up a nextsample query. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a32878d3d29f4595d1d2b861d7e871726}{lspg\-\_\-nextsample\-\_\-wait} ()
\begin{DoxyCompactList}\small\item\em Wait for the nextsample query to get processed. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_ac52207cc8f4c14494ae6f4972b6a3b23}{lspg\-\_\-nextsample\-\_\-done} ()
\begin{DoxyCompactList}\small\item\em Called when the next shot query has been processed. \end{DoxyCompactList}\item 
unsigned int \hyperlink{lspg_8c_a4cc866393eda0cf20276d035f6fbe206}{lspg\-\_\-nextsample\-\_\-all} (int $\ast$err)
\item 
void \hyperlink{lspg_8c_a32b2bf00d66ee5fca130ee616a09cf7b}{lspg\-\_\-waitcryo\-\_\-init} ()
\item 
void \hyperlink{lspg_8c_a7497a7c924b31c727ea487a3efb77fb6}{lspg\-\_\-waitcryo\-\_\-cb} (\hyperlink{pgpmac_8h_ae57432c0a6ac48a50457815dab2c5b4c}{lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$qqp, P\-Gresult $\ast$pgr)
\item 
void \hyperlink{lspg_8c_a67a44f70405c8b6a01cec6ac3d166efb}{lspg\-\_\-waitcryo\-\_\-all} ()
\begin{DoxyCompactList}\small\item\em no need to get fancy with the wait cryo command It should not return until the robot is almost ready for air rights \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a61e47be0d5d7154700e7e5edb889852e}{lspg\-\_\-demandairrights\-\_\-init} ()
\begin{DoxyCompactList}\small\item\em initialize the demandairrights structure \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a208134de0d5bbbdaf5589126d46f1c4e}{lspg\-\_\-demandairrights\-\_\-cb} (\hyperlink{pgpmac_8h_ae57432c0a6ac48a50457815dab2c5b4c}{lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$qqp, P\-Gresult $\ast$pgr)
\begin{DoxyCompactList}\small\item\em handle the airrights response \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_ae3f3ae783042eb1f5f2c37b517b7404a}{lspg\-\_\-demandairrights\-\_\-call} ()
\begin{DoxyCompactList}\small\item\em call for airrights \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a96e3098f6f87fde74a83af96bf27a638}{lspg\-\_\-demandairrights\-\_\-wait} ()
\begin{DoxyCompactList}\small\item\em wait for the air rights request to return \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_aaf0ad72847ccb93694b3bdc649e6d1fc}{lspg\-\_\-demandairrights\-\_\-all} ()
\begin{DoxyCompactList}\small\item\em do nothing until we get airrights \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a9e92a204f606761d368ac7e06ef0f09c}{lspg\-\_\-nextshot\-\_\-cb} (\hyperlink{pgpmac_8h_ae57432c0a6ac48a50457815dab2c5b4c}{lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$qqp, P\-Gresult $\ast$pgr)
\begin{DoxyCompactList}\small\item\em Next Shot Callback. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_aff91db7d60e6c832684c023813e36dbf}{lspg\-\_\-nextshot\-\_\-init} ()
\begin{DoxyCompactList}\small\item\em Initialize the nextshot variable, mutex, and condition. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_af17ef79544ca5d78fd477010fe90d538}{lspg\-\_\-nextshot\-\_\-call} ()
\begin{DoxyCompactList}\small\item\em Queue up a nextshot query. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a784a6de32a86fec9efb3ef3ae4b6e3ac}{lspg\-\_\-nextshot\-\_\-wait} ()
\begin{DoxyCompactList}\small\item\em Wait for the next shot query to get processed. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a50458a014041a4118452802dfb303960}{lspg\-\_\-nextshot\-\_\-done} ()
\begin{DoxyCompactList}\small\item\em Called when the next shot query has been processed. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a3517f8fbed91c998f6036284f9bd0c48}{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-init} ()
\begin{DoxyCompactList}\small\item\em initialize the detector timing object \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a5747c519d1aa4c310010a862cae8a823}{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-cb} (\hyperlink{pgpmac_8h_ae57432c0a6ac48a50457815dab2c5b4c}{lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$qqp, P\-Gresult $\ast$pgr)
\begin{DoxyCompactList}\small\item\em Callback for the wait for detector query. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a4b5222b859a44eae616804a1e990b86d}{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-call} ()
\begin{DoxyCompactList}\small\item\em initiate the wait for detector query \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_af094e01be121ce8e14abb679abd17e19}{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-wait} ()
\begin{DoxyCompactList}\small\item\em Pause the calling thread until the detector is ready Called by the M\-D2 thread. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_abb3645dee7c4514b650ab02f27570a69}{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-done} ()
\begin{DoxyCompactList}\small\item\em Done waiting for the detector. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_ab9780e15924a50b2a5545e10806000b3}{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-all} ()
\begin{DoxyCompactList}\small\item\em Combined call to wait for the detector. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a39bb94f8e0d47702b2b920a3dee61ebc}{lspg\-\_\-lock\-\_\-diffractometer\-\_\-init} ()
\begin{DoxyCompactList}\small\item\em initialize the diffractometer locking object \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_aad4f378f37c0030634dafa0d9445d916}{lspg\-\_\-lock\-\_\-diffractometer\-\_\-cb} (\hyperlink{pgpmac_8h_ae57432c0a6ac48a50457815dab2c5b4c}{lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$qqp, P\-Gresult $\ast$pgr)
\begin{DoxyCompactList}\small\item\em Callback routine for a lock diffractometer query. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_ac5ebeb38e8e9926a52f024fe76201175}{lspg\-\_\-lock\-\_\-diffractometer\-\_\-call} ()
\begin{DoxyCompactList}\small\item\em Request that the database grab the diffractometer lock. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a8445e1dec753f2c517b87fcb9c5b5943}{lspg\-\_\-lock\-\_\-diffractometer\-\_\-wait} ()
\begin{DoxyCompactList}\small\item\em Wait for the diffractometer lock. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a75aaf0b3fe33530062226c69a33ce821}{lspg\-\_\-lock\-\_\-diffractometer\-\_\-done} ()
\begin{DoxyCompactList}\small\item\em Finish up the lock diffractometer call. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a88b33e75c42197740b157a51ea726f21}{lspg\-\_\-lock\-\_\-diffractometer\-\_\-all} ()
\begin{DoxyCompactList}\small\item\em Convience function that combines lock diffractometer calls. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a0e9bbf847dadfe0d10830d67824d9be8}{lspg\-\_\-lock\-\_\-detector\-\_\-init} ()
\begin{DoxyCompactList}\small\item\em Initialize detector lock object. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_aa760191c2b443170cebbcbf5ea5345f3}{lspg\-\_\-lock\-\_\-detector\-\_\-cb} (\hyperlink{pgpmac_8h_ae57432c0a6ac48a50457815dab2c5b4c}{lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$qqp, P\-Gresult $\ast$pgr)
\begin{DoxyCompactList}\small\item\em Callback for when the detector lock has be grabbed. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a5f71a20cc297684b2afe28e7bd8e8383}{lspg\-\_\-lock\-\_\-detector\-\_\-call} ()
\begin{DoxyCompactList}\small\item\em Request (demand) a detector lock. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_ad3d9c56bd3ca6bcc43db30872cc441cc}{lspg\-\_\-lock\-\_\-detector\-\_\-wait} ()
\begin{DoxyCompactList}\small\item\em Wait for the detector lock. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a1b567040693ff6e2932a2477045d75fa}{lspg\-\_\-lock\-\_\-detector\-\_\-done} ()
\begin{DoxyCompactList}\small\item\em Finish waiting. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_aff93d2f5ac31aa249a0bef40a3837c84}{lspg\-\_\-lock\-\_\-detector\-\_\-all} ()
\begin{DoxyCompactList}\small\item\em Detector lock convinence function. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a31823ecb2b44d4a6674f804059a27bce}{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-init} ()
\begin{DoxyCompactList}\small\item\em Initialize the data collection object. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a11cda12050dc9a86188e15e2155a6013}{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-cb} (\hyperlink{pgpmac_8h_ae57432c0a6ac48a50457815dab2c5b4c}{lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$qqp, P\-Gresult $\ast$pgr)
\begin{DoxyCompactList}\small\item\em Callback for the seq\-\_\-run\-\_\-prep query. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_af7d6efd861b152a371442791deb42bd3}{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-call} (long long skey, double \hyperlink{pgpmac_8h_a0be79ccb7ebf3a665248fd856112b9fd}{kappa}, double \hyperlink{pgpmac_8h_ac8070dc568ad974a3db42b51eca828cc}{phi}, double cx, double cy, double ax, double ay, double az)
\begin{DoxyCompactList}\small\item\em queue up the seq\-\_\-run\-\_\-prep query \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_ac0b01f501322432a8fa37f31898c3499}{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-wait} ()
\begin{DoxyCompactList}\small\item\em Wait for seq run prep query to return. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a472b09ddf716c80207f97e2bb5d37d66}{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-done} ()
\begin{DoxyCompactList}\small\item\em Indicate we are done waiting. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a4253474d4dd305aec0afdd5552b3ddd5}{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-all} (long long skey, double \hyperlink{pgpmac_8h_a0be79ccb7ebf3a665248fd856112b9fd}{kappa}, double \hyperlink{pgpmac_8h_ac8070dc568ad974a3db42b51eca828cc}{phi}, double cx, double cy, double ax, double ay, double az)
\begin{DoxyCompactList}\small\item\em Convinence function to call seq run prep. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a8184824f2b71b1d35141d7922ca69cd7}{lspg\-\_\-getcenter\-\_\-cb} (\hyperlink{pgpmac_8h_ae57432c0a6ac48a50457815dab2c5b4c}{lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$qqp, P\-Gresult $\ast$pgr)
\begin{DoxyCompactList}\small\item\em Retrieve the data to center the crystal. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_ad31db17587a02302ac4e40fb7d260b1b}{lspg\-\_\-getcenter\-\_\-init} ()
\begin{DoxyCompactList}\small\item\em Initialize getcenter object. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a6f7cd0a06f6a266ef65b3604cf33d6c4}{lspg\-\_\-getcenter\-\_\-call} ()
\begin{DoxyCompactList}\small\item\em Request a getcenter query. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a3e0e4b3cb9fa03961ee0c104e0b06754}{lspg\-\_\-getcenter\-\_\-wait} ()
\begin{DoxyCompactList}\small\item\em Wait for a getcenter query to return. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a7c678553b44c874d08ec9966ed7bb1c0}{lspg\-\_\-getcenter\-\_\-done} ()
\begin{DoxyCompactList}\small\item\em Done with getcenter query. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a523b492d9cd4970853eabee2d3c31578}{lspg\-\_\-getcenter\-\_\-all} ()
\begin{DoxyCompactList}\small\item\em Convenience function to complete synchronous getcenter query. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_aeda8dad89b03d7d61cc994dd63ee5db6}{lspg\-\_\-nextaction\-\_\-cb} (\hyperlink{pgpmac_8h_ae57432c0a6ac48a50457815dab2c5b4c}{lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$qqp, P\-Gresult $\ast$pgr)
\begin{DoxyCompactList}\small\item\em Queue the next M\-D2 instruction. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a1e11f525ca0f9ac9ab71f9fbe983c42b}{lspg\-\_\-cmd\-\_\-cb} (\hyperlink{pgpmac_8h_ae57432c0a6ac48a50457815dab2c5b4c}{lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$qqp, P\-Gresult $\ast$pgr)
\begin{DoxyCompactList}\small\item\em Send strings directly to P\-M\-A\-C queue. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_af6485ac1749c5de3008dd0e0badaa09c}{lspg\-\_\-flush} ()
\begin{DoxyCompactList}\small\item\em Flush psql output buffer (ie, send the query) \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a714b15e117ffe7bfce4f2f2ce4725b0a}{lspg\-\_\-send\-\_\-next\-\_\-query} ()
\begin{DoxyCompactList}\small\item\em send the next queued query to the D\-B server \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a038c5af23469b789fc1c55d21cb43029}{lspg\-\_\-receive} ()
\begin{DoxyCompactList}\small\item\em Receive a result of a query. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a049f4422994aa2eb2b841ffb2937f895}{lspg\-\_\-sig\-\_\-service} (struct pollfd $\ast$evt)
\begin{DoxyCompactList}\small\item\em Service a signal Signals here are treated as file descriptors and fits into our poll scheme. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_aa8d1fed4b461c2139a21826d524777d5}{lspg\-\_\-pg\-\_\-service} (struct pollfd $\ast$evt)
\begin{DoxyCompactList}\small\item\em I/\-O control to/from the postgresql server. \end{DoxyCompactList}\item 
P\-Qnotice\-Processor \hyperlink{lspg_8c_a62b110949d206fb22789191207e1d066}{lspg\-\_\-notice\-\_\-processor} (void $\ast$arg, const char $\ast$msg)
\item 
void \hyperlink{lspg_8c_a581c18be0368425665a40b4b7f7d9714}{lspg\-\_\-pg\-\_\-connect} ()
\begin{DoxyCompactList}\small\item\em Connect to the pg server. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_ab52a8c8245bf6561f40c0f224fc07ff4}{lspg\-\_\-next\-\_\-state} ()
\begin{DoxyCompactList}\small\item\em Implements our state machine Does not strictly only set the next state as it also calls some functions that, perhaps, alters the state mid-\/function. \end{DoxyCompactList}\item 
void $\ast$ \hyperlink{lspg_8c_aaf4fadd2943fa3a2ecb5d840e84d68fa}{lspg\-\_\-worker} (void $\ast$dummy)
\begin{DoxyCompactList}\small\item\em The main loop for the lspg thread. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a69a792e1981af00b2818bcda89bdaa02}{lspg\-\_\-preset\-\_\-changed\-\_\-cb} (char $\ast$event)
\item 
void \hyperlink{lspg_8c_a4710c50945fce26b4ac5dc01ed61459d}{lspg\-\_\-check\-\_\-preset\-\_\-in\-\_\-position\-\_\-cb} (char $\ast$event)
\item 
void \hyperlink{lspg_8c_abcdcee6ef5ed0865056d42a6cf9da8bd}{lspg\-\_\-unset\-\_\-current\-\_\-preset\-\_\-moving\-\_\-cb} (char $\ast$event)
\item 
void \hyperlink{lspg_8c_af61ae1cf46d67e29dfc690b9a98b1b4d}{lspg\-\_\-set\-\_\-scale\-\_\-cb} (char $\ast$event)
\begin{DoxyCompactList}\small\item\em Fix up xscale and yscale when zoom changes. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a14546bac5695b536cd348d5e0a1661fa}{lspg\-\_\-sample\-\_\-detector\-\_\-cb} (char $\ast$event)
\begin{DoxyCompactList}\small\item\em log magnet state \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a8a77972df14166e05c94ed0792baa09b}{lspg\-\_\-init} ()
\begin{DoxyCompactList}\small\item\em Initiallize the lspg module. \end{DoxyCompactList}\item 
void \hyperlink{lspg_8c_a1adfdb5ca9fdb5060849d726bf540117}{lspg\-\_\-run} ()
\begin{DoxyCompactList}\small\item\em Start 'er runnin'. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static int \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\-\_\-pg\-\_\-state} = \hyperlink{lspg_8c_af443092447378c73bf93aa143576aba4}{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-N\-I\-T}
\begin{DoxyCompactList}\small\item\em State of the lspg state machine. \end{DoxyCompactList}\item 
static struct timeval \\*
lspg\-\_\-time\-\_\-sent \hyperlink{lspg_8c_ad40ac52086f6b774928af45b09d54c6e}{now}
\begin{DoxyCompactList}\small\item\em used to ensure we do not inundate the db server with connection requests \end{DoxyCompactList}\item 
static pthread\-\_\-t \hyperlink{lspg_8c_a04eb0cda0d5e5afeae7c393b51689765}{lspg\-\_\-thread}
\begin{DoxyCompactList}\small\item\em our worker thread \end{DoxyCompactList}\item 
static pthread\-\_\-mutex\-\_\-t \hyperlink{lspg_8c_aed46a94106c583796e3a8ca0e89aa8e4}{lspg\-\_\-queue\-\_\-mutex}
\begin{DoxyCompactList}\small\item\em keep the queue from getting tangled \end{DoxyCompactList}\item 
static pthread\-\_\-cond\-\_\-t \hyperlink{lspg_8c_a61a308b6a37afd645beb422653b95baa}{lspg\-\_\-queue\-\_\-cond}
\begin{DoxyCompactList}\small\item\em keeps the queue from overflowing \end{DoxyCompactList}\item 
static struct pollfd \hyperlink{lspg_8c_af3f897b8ffa020ca54289bc5b28cb64d}{lspgfd}
\begin{DoxyCompactList}\small\item\em our poll info \end{DoxyCompactList}\item 
static \hyperlink{pgpmac_8h_ae57432c0a6ac48a50457815dab2c5b4c}{lspg\-\_\-query\-\_\-queue\-\_\-t} \hyperlink{lspg_8c_a357d9d98f0b8c9625ccebcebfcdce955}{lspg\-\_\-query\-\_\-queue} \mbox{[}\hyperlink{lspg_8c_a08fe83fe8226002ee8b80ce0a914fd11}{L\-S\-\_\-\-P\-G\-\_\-\-Q\-U\-E\-R\-Y\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H}\mbox{]}
\begin{DoxyCompactList}\small\item\em Our query queue. \end{DoxyCompactList}\item 
static unsigned int \hyperlink{lspg_8c_a3cbe7f3161b3c1838ebc56a3bbcfd8a6}{lspg\-\_\-query\-\_\-queue\-\_\-on} = 0
\begin{DoxyCompactList}\small\item\em Next position to add something to the queue. \end{DoxyCompactList}\item 
static unsigned int \hyperlink{lspg_8c_aca86bb77d6cecfae9251743f4171bafb}{lspg\-\_\-query\-\_\-queue\-\_\-off} = 0
\begin{DoxyCompactList}\small\item\em The last item still being used (on == off means nothing in queue) \end{DoxyCompactList}\item 
static unsigned int \hyperlink{lspg_8c_a2603b071afdbff7c0924b13de2454264}{lspg\-\_\-query\-\_\-queue\-\_\-reply} = 0
\begin{DoxyCompactList}\small\item\em The current item being digested. \end{DoxyCompactList}\item 
static P\-Gconn $\ast$ \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q} = N\-U\-L\-L
\begin{DoxyCompactList}\small\item\em Database connector. \end{DoxyCompactList}\item 
static Postgres\-Polling\-Status\-Type \hyperlink{lspg_8c_a69ae04978986e6413ca7cefcb692b645}{lspg\-\_\-connect\-Poll\-\_\-response}
\begin{DoxyCompactList}\small\item\em Used to determine state while connecting. \end{DoxyCompactList}\item 
static Postgres\-Polling\-Status\-Type \hyperlink{lspg_8c_a06c5a937e41a6c706a247777642ec1fb}{lspg\-\_\-reset\-Poll\-\_\-response}
\begin{DoxyCompactList}\small\item\em Used to determine state while reconnecting. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_a9dda9014cd0e39fba8d523e37cf9f982}{lspg\-\_\-nextsample\-\_\-t} \hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\-\_\-nextsample}
\begin{DoxyCompactList}\small\item\em the very next sample \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_a17ea2bf07a0b3b892baa00bd392607b3}{lspg\-\_\-nextshot\-\_\-t} \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\-\_\-nextshot}
\begin{DoxyCompactList}\small\item\em the nextshot object \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_a48b627e412dd038c1f17cdb0501eec33}{lspg\-\_\-getcenter\-\_\-t} \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\-\_\-getcenter}
\begin{DoxyCompactList}\small\item\em the getcenter object \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_a7f71abc6fdfd1839e2e3213d78aaf766}{lspg\-\_\-demandairrights\-\_\-t} \hyperlink{lspg_8c_adf89a0299edd6a99992b95dff8992eba}{lspg\-\_\-demandairrights}
\begin{DoxyCompactList}\small\item\em our demandairrights object \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_a7a794370785ff015d5ee035917e3bee8}{lspg\-\_\-getcurrentsampleid\-\_\-t} \hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\-\_\-getcurrentsampleid}
\begin{DoxyCompactList}\small\item\em our currentsample id \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa1f0e602ae9509005c62fb2d73bc1c5a}{lspg\-\_\-starttransfer\-\_\-t} \hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\-\_\-starttransfer}
\begin{DoxyCompactList}\small\item\em start a sample transfer \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_a779e2acce8b5e748c184caf23ed0db57}{lspg\-\_\-waitcryo\-\_\-t} \hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\-\_\-waitcryo}
\begin{DoxyCompactList}\small\item\em signal the robot \end{DoxyCompactList}\item 
static \hyperlink{lspg_8c_a6f273a499bf316de95df3816a9b1bc06}{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-t} \hyperlink{lspg_8c_a0dfc8d0410cd2d7f7da7a70d3ef88e58}{lspg\-\_\-wait\-\_\-for\-\_\-detector}
\begin{DoxyCompactList}\small\item\em Instance of the detector timing object. \end{DoxyCompactList}\item 
static \hyperlink{lspg_8c_a7232a0d630558f0c4c081d087150973d}{lspg\-\_\-lock\-\_\-diffractometer\-\_\-t} \hyperlink{lspg_8c_aaae7ce3ecd7d54a9e46c41d7a742a454}{lspg\-\_\-lock\-\_\-diffractometer}
\item 
static \hyperlink{lspg_8c_a3442e66a1f05457eb22a0d4a5d295f3a}{lspg\-\_\-lock\-\_\-detector\-\_\-t} \hyperlink{lspg_8c_adbf3b3652c6531c3d194320d1abc1c80}{lspg\-\_\-lock\-\_\-detector}
\item 
static \hyperlink{lspg_8c_ab2da550aea6388c835abe0ee0b226eb0}{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-t} \hyperlink{lspg_8c_a1b0d9fc30bcea6905b075d2362149172}{lspg\-\_\-seq\-\_\-run\-\_\-prep}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Postgresql support for the L\-S-\/\-C\-A\-T pgpmac project. \begin{DoxyVerb}\date 2012
\author Keith Brister
\copyright All Rights Reserved
\end{DoxyVerb}



\begin{DoxyPre}
  Database state machine\end{DoxyPre}



\begin{DoxyPre}State           Description\end{DoxyPre}



\begin{DoxyPre} -4             Initiate connection
 -3             Poll until connection initialization is complete
 -2             Initiate reset
 -1             Poll until connection reset is complete
  1             Idle (wait for a notify from the server)
  2             Send a query to the server
  3             Continue flushing a command to the server
  4             Waiting for a reply
\end{DoxyPre}
 

Definition in file \hyperlink{lspg_8c_source}{lspg.\-c}.



\subsection{Macro Definition Documentation}
\hypertarget{lspg_8c_a08fe83fe8226002ee8b80ce0a914fd11}{\index{lspg.\-c@{lspg.\-c}!L\-S\-\_\-\-P\-G\-\_\-\-Q\-U\-E\-R\-Y\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H@{L\-S\-\_\-\-P\-G\-\_\-\-Q\-U\-E\-R\-Y\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H}}
\index{L\-S\-\_\-\-P\-G\-\_\-\-Q\-U\-E\-R\-Y\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H@{L\-S\-\_\-\-P\-G\-\_\-\-Q\-U\-E\-R\-Y\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H}!lspg.c@{lspg.\-c}}
\subsubsection[{L\-S\-\_\-\-P\-G\-\_\-\-Q\-U\-E\-R\-Y\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-P\-G\-\_\-\-Q\-U\-E\-R\-Y\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H~16384}}\label{lspg_8c_a08fe83fe8226002ee8b80ce0a914fd11}


Queue length should be long enough that we do not ordinarly bump into the end We should be safe as long as the thread the adds stuff to the queue is not the one that removes it. 

(And we can tolerate the adding thread being paused.) 

Definition at line 50 of file lspg.\-c.

\hypertarget{lspg_8c_aaf1dd8ba4dafb91c296554c4cbf312e3}{\index{lspg.\-c@{lspg.\-c}!L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-D\-L\-E@{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-D\-L\-E}}
\index{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-D\-L\-E@{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-D\-L\-E}!lspg.c@{lspg.\-c}}
\subsubsection[{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-D\-L\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-D\-L\-E~1}}\label{lspg_8c_aaf1dd8ba4dafb91c296554c4cbf312e3}


Definition at line 33 of file lspg.\-c.

\hypertarget{lspg_8c_af443092447378c73bf93aa143576aba4}{\index{lspg.\-c@{lspg.\-c}!L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-N\-I\-T@{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-N\-I\-T}}
\index{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-N\-I\-T@{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-N\-I\-T}!lspg.c@{lspg.\-c}}
\subsubsection[{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-N\-I\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-N\-I\-T~-\/4}}\label{lspg_8c_af443092447378c73bf93aa143576aba4}


Definition at line 29 of file lspg.\-c.

\hypertarget{lspg_8c_ae7ea5876846b5f04c419aee22d3c0aa1}{\index{lspg.\-c@{lspg.\-c}!L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-N\-I\-T\-\_\-\-P\-O\-L\-L@{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-N\-I\-T\-\_\-\-P\-O\-L\-L}}
\index{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-N\-I\-T\-\_\-\-P\-O\-L\-L@{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-N\-I\-T\-\_\-\-P\-O\-L\-L}!lspg.c@{lspg.\-c}}
\subsubsection[{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-N\-I\-T\-\_\-\-P\-O\-L\-L}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-N\-I\-T\-\_\-\-P\-O\-L\-L~-\/3}}\label{lspg_8c_ae7ea5876846b5f04c419aee22d3c0aa1}


Definition at line 30 of file lspg.\-c.

\hypertarget{lspg_8c_a373e668840b4795ff9a71bc3f744d209}{\index{lspg.\-c@{lspg.\-c}!L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-C\-V@{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-C\-V}}
\index{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-C\-V@{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-C\-V}!lspg.c@{lspg.\-c}}
\subsubsection[{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-C\-V}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-C\-V~4}}\label{lspg_8c_a373e668840b4795ff9a71bc3f744d209}


Definition at line 36 of file lspg.\-c.

\hypertarget{lspg_8c_accda8c3a598dc7f5b107b04986d8ab50}{\index{lspg.\-c@{lspg.\-c}!L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-S\-E\-T@{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-S\-E\-T}}
\index{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-S\-E\-T@{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-S\-E\-T}!lspg.c@{lspg.\-c}}
\subsubsection[{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-S\-E\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-S\-E\-T~-\/2}}\label{lspg_8c_accda8c3a598dc7f5b107b04986d8ab50}


Definition at line 31 of file lspg.\-c.

\hypertarget{lspg_8c_ac70a1141f3b138055ea7143bd493187c}{\index{lspg.\-c@{lspg.\-c}!L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-S\-E\-T\-\_\-\-P\-O\-L\-L@{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-S\-E\-T\-\_\-\-P\-O\-L\-L}}
\index{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-S\-E\-T\-\_\-\-P\-O\-L\-L@{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-S\-E\-T\-\_\-\-P\-O\-L\-L}!lspg.c@{lspg.\-c}}
\subsubsection[{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-S\-E\-T\-\_\-\-P\-O\-L\-L}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-S\-E\-T\-\_\-\-P\-O\-L\-L~-\/1}}\label{lspg_8c_ac70a1141f3b138055ea7143bd493187c}


Definition at line 32 of file lspg.\-c.

\hypertarget{lspg_8c_a3c6eb19f262a990e1f9ba630d9edc309}{\index{lspg.\-c@{lspg.\-c}!L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-S\-E\-N\-D@{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-S\-E\-N\-D}}
\index{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-S\-E\-N\-D@{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-S\-E\-N\-D}!lspg.c@{lspg.\-c}}
\subsubsection[{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-S\-E\-N\-D}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-S\-E\-N\-D~2}}\label{lspg_8c_a3c6eb19f262a990e1f9ba630d9edc309}


Definition at line 34 of file lspg.\-c.

\hypertarget{lspg_8c_a88a7e80c12fb0449c4b0857a0c7deb21}{\index{lspg.\-c@{lspg.\-c}!L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-S\-E\-N\-D\-\_\-\-F\-L\-U\-S\-H@{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-S\-E\-N\-D\-\_\-\-F\-L\-U\-S\-H}}
\index{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-S\-E\-N\-D\-\_\-\-F\-L\-U\-S\-H@{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-S\-E\-N\-D\-\_\-\-F\-L\-U\-S\-H}!lspg.c@{lspg.\-c}}
\subsubsection[{L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-S\-E\-N\-D\-\_\-\-F\-L\-U\-S\-H}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-S\-E\-N\-D\-\_\-\-F\-L\-U\-S\-H~3}}\label{lspg_8c_a88a7e80c12fb0449c4b0857a0c7deb21}


Definition at line 35 of file lspg.\-c.



\subsection{Typedef Documentation}
\hypertarget{lspg_8c_a3442e66a1f05457eb22a0d4a5d295f3a}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-lock\-\_\-detector\-\_\-t@{lspg\-\_\-lock\-\_\-detector\-\_\-t}}
\index{lspg\-\_\-lock\-\_\-detector\-\_\-t@{lspg\-\_\-lock\-\_\-detector\-\_\-t}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-lock\-\_\-detector\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf lspg\-\_\-lock\-\_\-detector\-\_\-struct}  {\bf lspg\-\_\-lock\-\_\-detector\-\_\-t}}}\label{lspg_8c_a3442e66a1f05457eb22a0d4a5d295f3a}


lock detector object Implements detector lock for exposure control 

\hypertarget{lspg_8c_a7232a0d630558f0c4c081d087150973d}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-lock\-\_\-diffractometer\-\_\-t@{lspg\-\_\-lock\-\_\-diffractometer\-\_\-t}}
\index{lspg\-\_\-lock\-\_\-diffractometer\-\_\-t@{lspg\-\_\-lock\-\_\-diffractometer\-\_\-t}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-lock\-\_\-diffractometer\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf lspg\-\_\-lock\-\_\-diffractometer\-\_\-struct}  {\bf lspg\-\_\-lock\-\_\-diffractometer\-\_\-t}}}\label{lspg_8c_a7232a0d630558f0c4c081d087150973d}


Object used to impliment locking the diffractometer Critical to exposure timing. 

\hypertarget{lspg_8c_ab2da550aea6388c835abe0ee0b226eb0}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-t@{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-t}}
\index{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-t@{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-t}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-struct}  {\bf lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-t}}}\label{lspg_8c_ab2da550aea6388c835abe0ee0b226eb0}


Data collection running object. 

\hypertarget{lspg_8c_a6f273a499bf316de95df3816a9b1bc06}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-t@{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-t}}
\index{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-t@{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-t}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-struct}  {\bf lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-t}}}\label{lspg_8c_a6f273a499bf316de95df3816a9b1bc06}


Object that implements detector / spindle timing We use database locks for exposure control and this implements the md2 portion of this handshake. 



\subsection{Function Documentation}
\hypertarget{lspg_8c_afb8d1ff1e0f4fcdc85ad9c684271cb3d}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-allkvs\-\_\-cb@{lspg\-\_\-allkvs\-\_\-cb}}
\index{lspg\-\_\-allkvs\-\_\-cb@{lspg\-\_\-allkvs\-\_\-cb}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-allkvs\-\_\-cb}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-allkvs\-\_\-cb (
\begin{DoxyParamCaption}
\item[{{\bf lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$}]{qqp, }
\item[{P\-Gresult $\ast$}]{pgr}
\end{DoxyParamCaption}
)}}\label{lspg_8c_afb8d1ff1e0f4fcdc85ad9c684271cb3d}


set a redis variable based on an updated kv pair 


\begin{DoxyParams}{Parameters}
{\em qqp} & The query that elicited this response \\
\hline
{\em pgr} & The resonse from postgresql \\
\hline
\end{DoxyParams}


Definition at line 279 of file lspg.\-c.


\begin{DoxyCode}
                                                             \{
  \textcolor{keywordtype}{int} kvname\_col, kvvalue\_col, kvseq\_col, kvdbrtype\_col;
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};
  \hyperlink{structlsredis__obj__struct}{lsredis\_obj\_t} *robj;
  
  kvname\_col    = PQfnumber( pgr, \textcolor{stringliteral}{"rname"});
  kvvalue\_col   = PQfnumber( pgr, \textcolor{stringliteral}{"rvalue"});
  kvseq\_col     = PQfnumber( pgr, \textcolor{stringliteral}{"rseq"});
  kvdbrtype\_col = PQfnumber( pgr, \textcolor{stringliteral}{"rdbrtype"});
  
  \textcolor{keywordflow}{if}( kvname\_col == -1 || kvvalue\_col == -1 || kvseq\_col == -1 || kvdbrtype\_col
       == -1) \{
    fprintf( stderr, \textcolor{stringliteral}{"lspg\_allkvs\_cb: bad column number(s)\(\backslash\)n"});
    \textcolor{keywordflow}{return};
  \}

  
  \textcolor{keywordflow}{for}( i=0; i<PQntuples( pgr); i++) \{
    pthread\_mutex\_lock( &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex});
    \textcolor{keywordflow}{while}( \hyperlink{lsredis_8c_a7461eb2b5974a2ffac2189007d39193c}{lsredis\_running} == 0)
      pthread\_cond\_wait( &\hyperlink{lsredis_8c_a2f63408d16b5603541b124a78f36a5a8}{lsredis\_cond}, &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex}
      );

    robj = \hyperlink{lsredis_8c_ac3fb8589e280bfa18ecbca6619fea637}{\_lsredis\_get\_obj}( PQgetvalue( pgr, i, kvname\_col));
    pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex});


    \textcolor{keywordflow}{if}( robj == NULL) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspg\_allkvs\_cb: could not
       find redis object named '%s'"}, PQgetvalue( pgr, i, kvname\_col));
      \textcolor{keywordflow}{continue};
    \}

    \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\_setstr}( robj, \textcolor{stringliteral}{"%s"}, PQgetvalue( pgr, i, kvvalue\_col))
      ;
  \}

\}
\end{DoxyCode}
\hypertarget{lspg_8c_a46f23ae999129d6fd5712d7975b99aed}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-array2ptrs@{lspg\-\_\-array2ptrs}}
\index{lspg\-\_\-array2ptrs@{lspg\-\_\-array2ptrs}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-array2ptrs}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$$\ast$ lspg\-\_\-array2ptrs (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{a}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a46f23ae999129d6fd5712d7975b99aed}


returns a null terminated list of strings parsed from postgresql array 



Definition at line 160 of file lspg.\-c.


\begin{DoxyCode}
                                 \{
  \textcolor{keywordtype}{char} **rtn, *sp, *acums;
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}, n, inquote, havebackslash, rtni;;
  \textcolor{keywordtype}{int} mxsz;
  
  inquote       = 0;
  havebackslash = 0;

  \textcolor{comment}{// Despense with the null input condition before we complicate the code below}
  \textcolor{keywordflow}{if}( a == NULL || a[0] != \textcolor{charliteral}{'\{'} || a[strlen(a)-1] != \textcolor{charliteral}{'\}'})
    \textcolor{keywordflow}{return} NULL;

  \textcolor{comment}{// Count the maximum number of strings}
  \textcolor{comment}{// Actual number will be less if there are quoted commas}
  \textcolor{comment}{//}
  n = 1;
  \textcolor{keywordflow}{for}( i=0; a[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}]; i++) \{
    \textcolor{keywordflow}{if}( a[i] == \textcolor{charliteral}{','})
      n++;
  \}
  \textcolor{comment}{//}
  \textcolor{comment}{// The maximum size of any string is the length of a (+1)}
  \textcolor{comment}{//}
  mxsz = strlen(a) + 1;

  \textcolor{comment}{// This is the accumulation string to make up the array elements}
  acums = (\textcolor{keywordtype}{char} *)calloc( mxsz, \textcolor{keyword}{sizeof}( \textcolor{keywordtype}{char}));
  \textcolor{keywordflow}{if}( acums == NULL) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspg\_array2ptrs: out of memory
       (acums)"});
    exit( 1);
  \}
  
  \textcolor{comment}{//}
  \textcolor{comment}{// allocate storage for the pointer array and the null terminator}
  \textcolor{comment}{//}
  rtn = (\textcolor{keywordtype}{char} **)calloc( n+1, \textcolor{keyword}{sizeof}( \textcolor{keywordtype}{char} *));
  \textcolor{keywordflow}{if}( rtn == NULL) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspg\_array2ptrs: out of memory
       (rtn)"});
    exit( 1);
  \}
  rtni = 0;
  
  \textcolor{comment}{// Go through and create the individual strings}
  sp = acums;
  *sp = 0;

  inquote = 0;
  havebackslash = 0;
  \textcolor{keywordflow}{for}( i=1; a[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}] != 0; i++) \{
    \textcolor{keywordflow}{switch}( a[i]) \{
    \textcolor{keywordflow}{case} \textcolor{charliteral}{'"'}:
      \textcolor{keywordflow}{if}( havebackslash) \{
        \textcolor{comment}{// a quoted quote.  Cool}
        \textcolor{comment}{//}
        *(sp++) = a[i];
        *sp = 0;
        havebackslash = 0;
      \} \textcolor{keywordflow}{else} \{
        \textcolor{comment}{// Toggle the flag}
        inquote = 1 - inquote;
      \}
      \textcolor{keywordflow}{break};

    \textcolor{keywordflow}{case} \textcolor{charliteral}{'\(\backslash\)\(\backslash\)'}:
      \textcolor{keywordflow}{if}( havebackslash) \{
        *(sp++) = a[i];
        *sp = 0;
        havebackslash = 0;
      \} \textcolor{keywordflow}{else} \{
        havebackslash = 1;
      \}
      \textcolor{keywordflow}{break};

    \textcolor{keywordflow}{case} \textcolor{charliteral}{','}:
      \textcolor{keywordflow}{if}( inquote || havebackslash) \{
        *(sp++) = a[i];
        *sp = 0;
        havebackslash = 0;
      \} \textcolor{keywordflow}{else} \{
        rtn[rtni++] = strdup( acums);
        sp = acums;
      \}
      \textcolor{keywordflow}{break};
      
    \textcolor{keywordflow}{case} \textcolor{charliteral}{'\}'}:
      \textcolor{keywordflow}{if}( inquote || havebackslash) \{
        *(sp++) = a[i];
        *sp = 0;
        havebackslash = 0;
      \} \textcolor{keywordflow}{else} \{
        rtn[rtni++] = strdup( acums);
        rtn[rtni]   = NULL;
        free( acums);
        \textcolor{keywordflow}{return}( rtn);
      \}
      \textcolor{keywordflow}{break};

    \textcolor{keywordflow}{default}:
      *(sp++) = a[i];
      *sp = 0;
      havebackslash = 0;
    \}
  \}
  \textcolor{comment}{//}
  \textcolor{comment}{// Getting here means the final '\}' was missing}
  \textcolor{comment}{// Probably we should throw an error or log it or something.}
  \textcolor{comment}{// Through out the last entry since this there is not resonable expectation
       that}
  \textcolor{comment}{// we should be parsing it anyway.}
  \textcolor{comment}{//}
  rtn[rtni]   = NULL;
  free( acums);
  \textcolor{keywordflow}{return}( rtn);
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a4710c50945fce26b4ac5dc01ed61459d}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-check\-\_\-preset\-\_\-in\-\_\-position\-\_\-cb@{lspg\-\_\-check\-\_\-preset\-\_\-in\-\_\-position\-\_\-cb}}
\index{lspg\-\_\-check\-\_\-preset\-\_\-in\-\_\-position\-\_\-cb@{lspg\-\_\-check\-\_\-preset\-\_\-in\-\_\-position\-\_\-cb}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-check\-\_\-preset\-\_\-in\-\_\-position\-\_\-cb}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-check\-\_\-preset\-\_\-in\-\_\-position\-\_\-cb (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{event}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a4710c50945fce26b4ac5dc01ed61459d}


Definition at line 1868 of file lspg.\-c.


\begin{DoxyCode}
                                                    \{
  \hyperlink{structlspmac__motor__struct}{lspmac\_motor\_t} *mp;
  \textcolor{keywordtype}{char} cp[64];
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};

  \textcolor{keywordflow}{for}( i=0; i<strlen( event); i++) \{
    cp[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}] = 0;
    \textcolor{keywordflow}{if}( event[i] == \textcolor{charliteral}{' '})
      \textcolor{keywordflow}{break};
    cp[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}] = \textcolor{keyword}{event}[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}];
  \}

  mp = \hyperlink{lspmac_8c_a22ef36819bdee963712691e660cfc101}{lspmac\_find\_motor\_by\_name}( cp);
  \textcolor{keywordflow}{if}( mp == NULL) \{
    \textcolor{keywordflow}{return};
  \}
  i = \hyperlink{lsredis_8c_adfe823e3ccec7e37ac4697179bd65b10}{lsredis\_find\_preset\_index\_by\_position}
      ( mp);
  \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( NULL, \textcolor{stringliteral}{"EXECUTE kvupdate(
       '\{%s.currentPreset,%d\}')"}, cp, i);

\}
\end{DoxyCode}
\hypertarget{lspg_8c_a1e11f525ca0f9ac9ab71f9fbe983c42b}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-cmd\-\_\-cb@{lspg\-\_\-cmd\-\_\-cb}}
\index{lspg\-\_\-cmd\-\_\-cb@{lspg\-\_\-cmd\-\_\-cb}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-cmd\-\_\-cb}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-cmd\-\_\-cb (
\begin{DoxyParamCaption}
\item[{{\bf lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$}]{qqp, }
\item[{P\-Gresult $\ast$}]{pgr}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a1e11f525ca0f9ac9ab71f9fbe983c42b}


Send strings directly to P\-M\-A\-C queue. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em qqp} & Our query \\
\hline
\mbox{\tt in}  & {\em pgr} & Our result \\
\hline
\end{DoxyParams}


Definition at line 1338 of file lspg.\-c.


\begin{DoxyCode}
                   \{
  \textcolor{comment}{//}
  \textcolor{comment}{// Call back funciton assumes query results in zero or more commands to send
       to the PMAC}
  \textcolor{comment}{//}
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};
  \textcolor{keywordtype}{char} *sp;
  
  \textcolor{keywordflow}{for}( i=0; i<PQntuples( pgr); i++) \{
    sp = PQgetvalue( pgr, i, 0);
    \textcolor{keywordflow}{if}( sp != NULL && *sp != 0) \{
      \hyperlink{lspmac_8c_afab9e8f0502a92ee5cf93209af710f81}{lspmac\_SockSendDPline}( NULL, sp);
      \textcolor{comment}{//      lspmac\_SockSendline( sp);}
      \textcolor{comment}{//}
      \textcolor{comment}{// Keep asking for more until}
      \textcolor{comment}{// there are no commands left}
      \textcolor{comment}{// }
      \textcolor{comment}{// This should solve a potential problem where}
      \textcolor{comment}{// more than one command is put on the queue for a given notify.}
      \textcolor{comment}{//}
      \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( \hyperlink{lspg_8c_a1e11f525ca0f9ac9ab71f9fbe983c42b}{lspg\_cmd\_cb}, \textcolor{stringliteral}{"select
       pmac.md2\_queue\_next()"});
    \}
  \}
\}
\end{DoxyCode}
\hypertarget{lspg_8c_aaf0ad72847ccb93694b3bdc649e6d1fc}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-demandairrights\-\_\-all@{lspg\-\_\-demandairrights\-\_\-all}}
\index{lspg\-\_\-demandairrights\-\_\-all@{lspg\-\_\-demandairrights\-\_\-all}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-demandairrights\-\_\-all}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-demandairrights\-\_\-all (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_aaf0ad72847ccb93694b3bdc649e6d1fc}


do nothing until we get airrights 



Definition at line 655 of file lspg.\-c.


\begin{DoxyCode}
                                \{
  \hyperlink{lspg_8c_ae3f3ae783042eb1f5f2c37b517b7404a}{lspg\_demandairrights\_call}();
  \hyperlink{lspg_8c_a96e3098f6f87fde74a83af96bf27a638}{lspg\_demandairrights\_wait}();
  \textcolor{comment}{// there is no "done" version}
\}
\end{DoxyCode}
\hypertarget{lspg_8c_ae3f3ae783042eb1f5f2c37b517b7404a}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-demandairrights\-\_\-call@{lspg\-\_\-demandairrights\-\_\-call}}
\index{lspg\-\_\-demandairrights\-\_\-call@{lspg\-\_\-demandairrights\-\_\-call}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-demandairrights\-\_\-call}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-demandairrights\-\_\-call (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_ae3f3ae783042eb1f5f2c37b517b7404a}


call for airrights 



Definition at line 637 of file lspg.\-c.


\begin{DoxyCode}
                                 \{
  pthread\_mutex\_lock( &\hyperlink{lspg_8c_adf89a0299edd6a99992b95dff8992eba}{lspg\_demandairrights}.\hyperlink{structlspg__demandairrights__struct_a874970af767d4bb329f9764075b30096}{mutex});
  \hyperlink{lspg_8c_adf89a0299edd6a99992b95dff8992eba}{lspg\_demandairrights}.\hyperlink{structlspg__demandairrights__struct_ad686c9a04d0c7e10b236c234eaf03ce7}{new\_value\_ready} = 0;
  pthread\_mutex\_unlock( &\hyperlink{lspg_8c_adf89a0299edd6a99992b95dff8992eba}{lspg\_demandairrights}.\hyperlink{structlspg__demandairrights__struct_a874970af767d4bb329f9764075b30096}{mutex});
  \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( \hyperlink{lspg_8c_a208134de0d5bbbdaf5589126d46f1c4e}{lspg\_demandairrights\_cb}
      , \textcolor{stringliteral}{"SELECT px.demandairrights())"});
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a208134de0d5bbbdaf5589126d46f1c4e}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-demandairrights\-\_\-cb@{lspg\-\_\-demandairrights\-\_\-cb}}
\index{lspg\-\_\-demandairrights\-\_\-cb@{lspg\-\_\-demandairrights\-\_\-cb}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-demandairrights\-\_\-cb}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-demandairrights\-\_\-cb (
\begin{DoxyParamCaption}
\item[{{\bf lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$}]{qqp, }
\item[{P\-Gresult $\ast$}]{pgr}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a208134de0d5bbbdaf5589126d46f1c4e}


handle the airrights response 



Definition at line 628 of file lspg.\-c.


\begin{DoxyCode}
                                                                      \{
  pthread\_mutex\_lock( &\hyperlink{lspg_8c_adf89a0299edd6a99992b95dff8992eba}{lspg\_demandairrights}.\hyperlink{structlspg__demandairrights__struct_a874970af767d4bb329f9764075b30096}{mutex});
  \hyperlink{lspg_8c_adf89a0299edd6a99992b95dff8992eba}{lspg\_demandairrights}.\hyperlink{structlspg__demandairrights__struct_ad686c9a04d0c7e10b236c234eaf03ce7}{new\_value\_ready} = 1;
  pthread\_cond\_signal( &\hyperlink{lspg_8c_adf89a0299edd6a99992b95dff8992eba}{lspg\_demandairrights}.\hyperlink{structlspg__demandairrights__struct_addc1e3476a3f282a19b335f7875861d1}{cond});
  pthread\_mutex\_unlock( &\hyperlink{lspg_8c_adf89a0299edd6a99992b95dff8992eba}{lspg\_demandairrights}.\hyperlink{structlspg__demandairrights__struct_a874970af767d4bb329f9764075b30096}{mutex});
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a61e47be0d5d7154700e7e5edb889852e}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-demandairrights\-\_\-init@{lspg\-\_\-demandairrights\-\_\-init}}
\index{lspg\-\_\-demandairrights\-\_\-init@{lspg\-\_\-demandairrights\-\_\-init}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-demandairrights\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-demandairrights\-\_\-init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a61e47be0d5d7154700e7e5edb889852e}


initialize the demandairrights structure 



Definition at line 620 of file lspg.\-c.


\begin{DoxyCode}
                                 \{
  \hyperlink{lspg_8c_adf89a0299edd6a99992b95dff8992eba}{lspg\_demandairrights}.\hyperlink{structlspg__demandairrights__struct_ad686c9a04d0c7e10b236c234eaf03ce7}{new\_value\_ready} = 0;
  pthread\_mutex\_init( &\hyperlink{lspg_8c_adf89a0299edd6a99992b95dff8992eba}{lspg\_demandairrights}.\hyperlink{structlspg__demandairrights__struct_a874970af767d4bb329f9764075b30096}{mutex}, 
      NULL);
  pthread\_cond\_init( &\hyperlink{lspg_8c_adf89a0299edd6a99992b95dff8992eba}{lspg\_demandairrights}.\hyperlink{structlspg__demandairrights__struct_addc1e3476a3f282a19b335f7875861d1}{cond}, NULL);
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a96e3098f6f87fde74a83af96bf27a638}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-demandairrights\-\_\-wait@{lspg\-\_\-demandairrights\-\_\-wait}}
\index{lspg\-\_\-demandairrights\-\_\-wait@{lspg\-\_\-demandairrights\-\_\-wait}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-demandairrights\-\_\-wait}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-demandairrights\-\_\-wait (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a96e3098f6f87fde74a83af96bf27a638}


wait for the air rights request to return 



Definition at line 646 of file lspg.\-c.


\begin{DoxyCode}
                                 \{
  pthread\_mutex\_lock( &\hyperlink{lspg_8c_adf89a0299edd6a99992b95dff8992eba}{lspg\_demandairrights}.\hyperlink{structlspg__demandairrights__struct_a874970af767d4bb329f9764075b30096}{mutex});
  \textcolor{keywordflow}{while}( \hyperlink{lspg_8c_adf89a0299edd6a99992b95dff8992eba}{lspg\_demandairrights}.\hyperlink{structlspg__demandairrights__struct_ad686c9a04d0c7e10b236c234eaf03ce7}{new\_value\_ready}
       == 0)
    pthread\_cond\_wait( &\hyperlink{lspg_8c_adf89a0299edd6a99992b95dff8992eba}{lspg\_demandairrights}.\hyperlink{structlspg__demandairrights__struct_addc1e3476a3f282a19b335f7875861d1}{cond}, &
      \hyperlink{lspg_8c_adf89a0299edd6a99992b95dff8992eba}{lspg\_demandairrights}.\hyperlink{structlspg__demandairrights__struct_a874970af767d4bb329f9764075b30096}{mutex});
  pthread\_mutex\_unlock( &\hyperlink{lspg_8c_adf89a0299edd6a99992b95dff8992eba}{lspg\_demandairrights}.\hyperlink{structlspg__demandairrights__struct_a874970af767d4bb329f9764075b30096}{mutex});
\}
\end{DoxyCode}
\hypertarget{lspg_8c_af6485ac1749c5de3008dd0e0badaa09c}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-flush@{lspg\-\_\-flush}}
\index{lspg\-\_\-flush@{lspg\-\_\-flush}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-flush}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-flush (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_af6485ac1749c5de3008dd0e0badaa09c}


Flush psql output buffer (ie, send the query) 



Definition at line 1368 of file lspg.\-c.


\begin{DoxyCode}
                  \{
  \textcolor{keywordtype}{int} err;

  err = PQflush( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q});
  \textcolor{keywordflow}{switch}( err) \{
  \textcolor{keywordflow}{case} -1:
    \textcolor{comment}{// an error occured}

    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"flush failed: %s"}, 
      PQerrorMessage( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q}));

    \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} = \hyperlink{lspg_8c_aaf1dd8ba4dafb91c296554c4cbf312e3}{LS\_PG\_STATE\_IDLE};
    \textcolor{comment}{//}
    \textcolor{comment}{// We should probably reset the connection and start from scratch. 
       Probably the connection died.}
    \textcolor{comment}{//}
    \textcolor{keywordflow}{break};
          
  \textcolor{keywordflow}{case} 0:
    \textcolor{comment}{// goodness and joy.}
    \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} = \hyperlink{lspg_8c_a373e668840b4795ff9a71bc3f744d209}{LS\_PG\_STATE\_RECV};
    \textcolor{keywordflow}{break};

  \textcolor{keywordflow}{case} 1:
    \textcolor{comment}{// more sending to do}
    \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} = \hyperlink{lspg_8c_a88a7e80c12fb0449c4b0857a0c7deb21}{LS\_PG\_STATE\_SEND\_FLUSH};
    \textcolor{keywordflow}{break};
  \}
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a523b492d9cd4970853eabee2d3c31578}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-getcenter\-\_\-all@{lspg\-\_\-getcenter\-\_\-all}}
\index{lspg\-\_\-getcenter\-\_\-all@{lspg\-\_\-getcenter\-\_\-all}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-getcenter\-\_\-all}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-getcenter\-\_\-all (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a523b492d9cd4970853eabee2d3c31578}


Convenience function to complete synchronous getcenter query. 



Definition at line 1300 of file lspg.\-c.


\begin{DoxyCode}
                          \{
  \hyperlink{lspg_8c_a6f7cd0a06f6a266ef65b3604cf33d6c4}{lspg\_getcenter\_call}();
  \hyperlink{lspg_8c_a3e0e4b3cb9fa03961ee0c104e0b06754}{lspg\_getcenter\_wait}();
  \hyperlink{lspg_8c_a7c678553b44c874d08ec9966ed7bb1c0}{lspg\_getcenter\_done}();
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a6f7cd0a06f6a266ef65b3604cf33d6c4}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-getcenter\-\_\-call@{lspg\-\_\-getcenter\-\_\-call}}
\index{lspg\-\_\-getcenter\-\_\-call@{lspg\-\_\-getcenter\-\_\-call}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-getcenter\-\_\-call}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-getcenter\-\_\-call (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a6f7cd0a06f6a266ef65b3604cf33d6c4}


Request a getcenter query. 



Definition at line 1276 of file lspg.\-c.


\begin{DoxyCode}
                           \{
  pthread\_mutex\_lock( &\hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a214bb7e88b137162f13f41f2c43002a9}{mutex});
  \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a4b350f11f1e375b9e9e839caaffbcb6b}{new\_value\_ready} = 0;
  pthread\_mutex\_unlock( &\hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a214bb7e88b137162f13f41f2c43002a9}{mutex});

  \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( \hyperlink{lspg_8c_a8184824f2b71b1d35141d7922ca69cd7}{lspg\_getcenter\_cb}, \textcolor{stringliteral}{"SELECT *
       FROM px.getcenter2()"});
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a8184824f2b71b1d35141d7922ca69cd7}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-getcenter\-\_\-cb@{lspg\-\_\-getcenter\-\_\-cb}}
\index{lspg\-\_\-getcenter\-\_\-cb@{lspg\-\_\-getcenter\-\_\-cb}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-getcenter\-\_\-cb}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-getcenter\-\_\-cb (
\begin{DoxyParamCaption}
\item[{{\bf lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$}]{qqp, }
\item[{P\-Gresult $\ast$}]{pgr}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a8184824f2b71b1d35141d7922ca69cd7}


Retrieve the data to center the crystal. 



Definition at line 1211 of file lspg.\-c.


\begin{DoxyCode}
                                                                \{
  \textcolor{keyword}{static} \textcolor{keywordtype}{int}
    zoom\_c, dcx\_c, dcy\_c, dax\_c, day\_c, daz\_c;

  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a214bb7e88b137162f13f41f2c43002a9}{mutex}));
  
  \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_aaeb0ccf4289b4fb306c2bc04ae85b237}{no\_rows\_returned} = PQntuples( 
      pgr) <= 0;
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_aaeb0ccf4289b4fb306c2bc04ae85b237}{no\_rows\_returned}) \{
    \textcolor{comment}{//}
    \textcolor{comment}{// No particular reason this path should ever be taken}
    \textcolor{comment}{// but if we don't get rows then we had better not move anything.}
    \textcolor{comment}{//}
    \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a4b350f11f1e375b9e9e839caaffbcb6b}{new\_value\_ready} = 1;
    pthread\_cond\_signal( &(\hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_ae0db0ff2608ab5ba3e7c1b4ad3fc0e91}{cond}));
    pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a214bb7e88b137162f13f41f2c43002a9}{mutex}));
    \textcolor{keywordflow}{return};
  \}

  zoom\_c = PQfnumber( pgr, \textcolor{stringliteral}{"zoom"});
  dcx\_c  = PQfnumber( pgr, \textcolor{stringliteral}{"dcx"});
  dcy\_c  = PQfnumber( pgr, \textcolor{stringliteral}{"dcy"});
  dax\_c  = PQfnumber( pgr, \textcolor{stringliteral}{"dax"});
  day\_c  = PQfnumber( pgr, \textcolor{stringliteral}{"day"});
  daz\_c  = PQfnumber( pgr, \textcolor{stringliteral}{"daz"});

  \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a6ca85a8de29039188357b2814acd7803}{zoom\_isnull} = PQgetisnull( pgr, 0, 
      zoom\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a6ca85a8de29039188357b2814acd7803}{zoom\_isnull} == 0)
    \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a63e640a925611d2404a1529aea30a853}{zoom} = atoi( PQgetvalue( pgr, 0, zoom\_c));

  \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_aa404da85af654998f039c81a77626748}{dcx\_isnull} = PQgetisnull( pgr, 0, 
      dcx\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_aa404da85af654998f039c81a77626748}{dcx\_isnull} == 0)
    \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_ade0534056296e9ed568404c538be9227}{dcx} = atof( PQgetvalue( pgr, 0, dcx\_c));

  \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a352c48c8d443c52f18ebd13019d01684}{dcy\_isnull} = PQgetisnull( pgr, 0, 
      dcy\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a352c48c8d443c52f18ebd13019d01684}{dcy\_isnull} == 0)
    \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a55b1a488b714e6a40d8e06a6e182bd0a}{dcy} = atof( PQgetvalue( pgr, 0, dcy\_c));

  \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a621b489777d61e9db8b33b784b8d70f9}{dax\_isnull} = PQgetisnull( pgr, 0, 
      dax\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a621b489777d61e9db8b33b784b8d70f9}{dax\_isnull} == 0)
    \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a17db52848c28852a470222ec93ae8886}{dax} = atof( PQgetvalue( pgr, 0, dax\_c));

  \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a36f57a319288810caf365cca7827ff96}{day\_isnull} = PQgetisnull( pgr, 0, 
      day\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a36f57a319288810caf365cca7827ff96}{day\_isnull} == 0)
    \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a9ce0f29540f2ff47be9788565d19f1b8}{day} = atof( PQgetvalue( pgr, 0, day\_c));

  \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a36742b6bd0f4bf9356414930ba893617}{daz\_isnull} = PQgetisnull( pgr, 0, 
      daz\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a36742b6bd0f4bf9356414930ba893617}{daz\_isnull} == 0)
    \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a1170bab2161f03ab29c39f79519ed9ae}{daz} = atof( PQgetvalue( pgr, 0, daz\_c));

  \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a4b350f11f1e375b9e9e839caaffbcb6b}{new\_value\_ready} = 1;

  pthread\_cond\_signal( &(\hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_ae0db0ff2608ab5ba3e7c1b4ad3fc0e91}{cond}));
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a214bb7e88b137162f13f41f2c43002a9}{mutex}));
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a7c678553b44c874d08ec9966ed7bb1c0}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-getcenter\-\_\-done@{lspg\-\_\-getcenter\-\_\-done}}
\index{lspg\-\_\-getcenter\-\_\-done@{lspg\-\_\-getcenter\-\_\-done}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-getcenter\-\_\-done}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-getcenter\-\_\-done (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a7c678553b44c874d08ec9966ed7bb1c0}


Done with getcenter query. 



Definition at line 1294 of file lspg.\-c.


\begin{DoxyCode}
                           \{
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a214bb7e88b137162f13f41f2c43002a9}{mutex}));
\}
\end{DoxyCode}
\hypertarget{lspg_8c_ad31db17587a02302ac4e40fb7d260b1b}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-getcenter\-\_\-init@{lspg\-\_\-getcenter\-\_\-init}}
\index{lspg\-\_\-getcenter\-\_\-init@{lspg\-\_\-getcenter\-\_\-init}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-getcenter\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-getcenter\-\_\-init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_ad31db17587a02302ac4e40fb7d260b1b}


Initialize getcenter object. 



Definition at line 1268 of file lspg.\-c.


\begin{DoxyCode}
                           \{
  memset( &\hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}, 0, \textcolor{keyword}{sizeof}( \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}
      ));
  pthread\_mutex\_init( &(\hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a214bb7e88b137162f13f41f2c43002a9}{mutex}), NULL);
  pthread\_cond\_init( &(\hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_ae0db0ff2608ab5ba3e7c1b4ad3fc0e91}{cond}), NULL);
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a3e0e4b3cb9fa03961ee0c104e0b06754}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-getcenter\-\_\-wait@{lspg\-\_\-getcenter\-\_\-wait}}
\index{lspg\-\_\-getcenter\-\_\-wait@{lspg\-\_\-getcenter\-\_\-wait}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-getcenter\-\_\-wait}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-getcenter\-\_\-wait (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a3e0e4b3cb9fa03961ee0c104e0b06754}


Wait for a getcenter query to return. 



Definition at line 1286 of file lspg.\-c.


\begin{DoxyCode}
                           \{
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a214bb7e88b137162f13f41f2c43002a9}{mutex}));
  \textcolor{keywordflow}{while}( \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a4b350f11f1e375b9e9e839caaffbcb6b}{new\_value\_ready} == 0)
    pthread\_cond\_wait( &(\hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_ae0db0ff2608ab5ba3e7c1b4ad3fc0e91}{cond}), &(
      \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a214bb7e88b137162f13f41f2c43002a9}{mutex}));
\}
\end{DoxyCode}
\hypertarget{lspg_8c_acf98a9e2adec05a69847045f444a5c77}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-getcurrentsampleid\-\_\-call@{lspg\-\_\-getcurrentsampleid\-\_\-call}}
\index{lspg\-\_\-getcurrentsampleid\-\_\-call@{lspg\-\_\-getcurrentsampleid\-\_\-call}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-getcurrentsampleid\-\_\-call}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-getcurrentsampleid\-\_\-call (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_acf98a9e2adec05a69847045f444a5c77}


Definition at line 466 of file lspg.\-c.


\begin{DoxyCode}
                                    \{
  pthread\_mutex\_lock( &\hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_ace54acbdcbce620437962858ba04e256}{mutex}
      );
  \hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_ada3840f03195ee1807150f1e75fd3775}{new\_value\_ready}
       = 0;
  pthread\_mutex\_unlock( &\hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_ace54acbdcbce620437962858ba04e256}{mutex}
      );

  \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( \hyperlink{lspg_8c_a3245894737f9b496b7882c6e6ed8519d}{lspg\_getcurrentsampleid\_cb}
      , \textcolor{stringliteral}{"SELECT px.getcurrentsampleid()"});
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a3245894737f9b496b7882c6e6ed8519d}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-getcurrentsampleid\-\_\-cb@{lspg\-\_\-getcurrentsampleid\-\_\-cb}}
\index{lspg\-\_\-getcurrentsampleid\-\_\-cb@{lspg\-\_\-getcurrentsampleid\-\_\-cb}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-getcurrentsampleid\-\_\-cb}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-getcurrentsampleid\-\_\-cb (
\begin{DoxyParamCaption}
\item[{{\bf lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$}]{qqp, }
\item[{P\-Gresult $\ast$}]{pgr}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a3245894737f9b496b7882c6e6ed8519d}


get currentsampleid 



Definition at line 445 of file lspg.\-c.


\begin{DoxyCode}
                                                                         \{
  pthread\_mutex\_lock( &\hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_ace54acbdcbce620437962858ba04e256}{mutex}
      );

  \hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_ab1c9e9d3dc5140137a7ccf908e95f69e}{new\_value\_ready} = 1;
  \hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_a06758730db55730eb10d2d63e2520d71}{no\_rows\_returned}
       = PQntuples( pgr) <= 0;
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_a06758730db55730eb10d2d63e2520d71}{no\_rows\_returned}
      ) \{
    pthread\_cond\_signal( &\hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_a289960e45fdc9339a05dc8607f1b7563}{cond}
      );
    pthread\_mutex\_unlock( &\hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_ace54acbdcbce620437962858ba04e256}{mutex}
      );
    \textcolor{keywordflow}{return};
  \}

  \hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_af370f8d1aaec7dd15121dc65d2a6cfc1}{getcurrentsampleid\_isnull}
       = PQgetisnull( pgr, 0, 0);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_af370f8d1aaec7dd15121dc65d2a6cfc1}{getcurrentsampleid\_isnull}
       == 0)
    \hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_af629de1e076fd6763bccea3547ef24e7}{getcurrentsampleid}
       = strtol( PQgetvalue( pgr, 0, 0), NULL, 0);

  pthread\_cond\_signal( &\hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_a289960e45fdc9339a05dc8607f1b7563}{cond}
      );
  pthread\_mutex\_unlock( &\hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_ace54acbdcbce620437962858ba04e256}{mutex}
      );
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a5d6f6c4733629fc14e4f0bc128a1ffb7}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-getcurrentsampleid\-\_\-init@{lspg\-\_\-getcurrentsampleid\-\_\-init}}
\index{lspg\-\_\-getcurrentsampleid\-\_\-init@{lspg\-\_\-getcurrentsampleid\-\_\-init}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-getcurrentsampleid\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-getcurrentsampleid\-\_\-init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a5d6f6c4733629fc14e4f0bc128a1ffb7}


Definition at line 437 of file lspg.\-c.


\begin{DoxyCode}
                                    \{
  \hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_ada3840f03195ee1807150f1e75fd3775}{new\_value\_ready}
       = 0;
  pthread\_mutex\_init( &\hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_ace54acbdcbce620437962858ba04e256}{mutex}
      , NULL);
  pthread\_cond\_init( &\hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_a289960e45fdc9339a05dc8607f1b7563}{cond}, 
      NULL);
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a7b070b4891f485b7f74c95e0e60471f3}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-getcurrentsampleid\-\_\-read@{lspg\-\_\-getcurrentsampleid\-\_\-read}}
\index{lspg\-\_\-getcurrentsampleid\-\_\-read@{lspg\-\_\-getcurrentsampleid\-\_\-read}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-getcurrentsampleid\-\_\-read}]{\setlength{\rightskip}{0pt plus 5cm}unsigned int lspg\-\_\-getcurrentsampleid\-\_\-read (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a7b070b4891f485b7f74c95e0e60471f3}


Definition at line 476 of file lspg.\-c.


\begin{DoxyCode}
                                            \{
  \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} rtn;
  pthread\_mutex\_lock( &\hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_ace54acbdcbce620437962858ba04e256}{mutex}
      );
  \textcolor{keywordflow}{while}( \hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_ada3840f03195ee1807150f1e75fd3775}{new\_value\_ready}
       == 0)
    pthread\_cond\_wait( &\hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_a289960e45fdc9339a05dc8607f1b7563}{cond}
      , &\hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_ace54acbdcbce620437962858ba04e256}{mutex});
  
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_af370f8d1aaec7dd15121dc65d2a6cfc1}{getcurrentsampleid\_isnull}
      )
    rtn = -1;
  \textcolor{keywordflow}{else}
    rtn = \hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_af629de1e076fd6763bccea3547ef24e7}{getcurrentsampleid}
      ;
  pthread\_mutex\_unlock( &\hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_ace54acbdcbce620437962858ba04e256}{mutex}
      );
  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a2d624b228ddd560ace0cef4286a30b07}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-getcurrentsampleid\-\_\-wait\-\_\-for\-\_\-id@{lspg\-\_\-getcurrentsampleid\-\_\-wait\-\_\-for\-\_\-id}}
\index{lspg\-\_\-getcurrentsampleid\-\_\-wait\-\_\-for\-\_\-id@{lspg\-\_\-getcurrentsampleid\-\_\-wait\-\_\-for\-\_\-id}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-getcurrentsampleid\-\_\-wait\-\_\-for\-\_\-id}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-getcurrentsampleid\-\_\-wait\-\_\-for\-\_\-id (
\begin{DoxyParamCaption}
\item[{unsigned int}]{test}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a2d624b228ddd560ace0cef4286a30b07}


Definition at line 492 of file lspg.\-c.


\begin{DoxyCode}
                                                             \{
  pthread\_mutex\_lock( &\hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_ace54acbdcbce620437962858ba04e256}{mutex}
      );
  \textcolor{keywordflow}{while}( \hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_af629de1e076fd6763bccea3547ef24e7}{getcurrentsampleid}
       != test)
    pthread\_cond\_wait( &\hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_a289960e45fdc9339a05dc8607f1b7563}{cond}
      , &\hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_ace54acbdcbce620437962858ba04e256}{mutex});
    
  pthread\_mutex\_unlock( &\hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_ace54acbdcbce620437962858ba04e256}{mutex}
      );
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a8a77972df14166e05c94ed0792baa09b}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-init@{lspg\-\_\-init}}
\index{lspg\-\_\-init@{lspg\-\_\-init}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a8a77972df14166e05c94ed0792baa09b}


Initiallize the lspg module. 



Definition at line 1951 of file lspg.\-c.


\begin{DoxyCode}
                 \{
  pthread\_mutex\_init( &\hyperlink{lspg_8c_aed46a94106c583796e3a8ca0e89aa8e4}{lspg\_queue\_mutex}, NULL);
  pthread\_cond\_init( &\hyperlink{lspg_8c_a61a308b6a37afd645beb422653b95baa}{lspg\_queue\_cond}, NULL);

  \hyperlink{lspg_8c_a61e47be0d5d7154700e7e5edb889852e}{lspg\_demandairrights\_init}();
  \hyperlink{lspg_8c_ad31db17587a02302ac4e40fb7d260b1b}{lspg\_getcenter\_init}();
  \hyperlink{lspg_8c_a5d6f6c4733629fc14e4f0bc128a1ffb7}{lspg\_getcurrentsampleid\_init}();
  \hyperlink{lspg_8c_a0e9bbf847dadfe0d10830d67824d9be8}{lspg\_lock\_detector\_init}();
  \hyperlink{lspg_8c_a39bb94f8e0d47702b2b920a3dee61ebc}{lspg\_lock\_diffractometer\_init}();
  \hyperlink{lspg_8c_a2faa901ea0a8ef00cfd93a893b34b446}{lspg\_nextsample\_init}();
  \hyperlink{lspg_8c_aff91db7d60e6c832684c023813e36dbf}{lspg\_nextshot\_init}();
  \hyperlink{lspg_8c_a31823ecb2b44d4a6674f804059a27bce}{lspg\_seq\_run\_prep\_init}();
  \hyperlink{lspg_8c_ab98f7d254fa0f5f4826f9427ca8b4f03}{lspg\_starttransfer\_init}();
  \hyperlink{lspg_8c_a3517f8fbed91c998f6036284f9bd0c48}{lspg\_wait\_for\_detector\_init}();
  \hyperlink{lspg_8c_a32b2bf00d66ee5fca130ee616a09cf7b}{lspg\_waitcryo\_init}();
\}
\end{DoxyCode}
\hypertarget{lspg_8c_aff93d2f5ac31aa249a0bef40a3837c84}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-lock\-\_\-detector\-\_\-all@{lspg\-\_\-lock\-\_\-detector\-\_\-all}}
\index{lspg\-\_\-lock\-\_\-detector\-\_\-all@{lspg\-\_\-lock\-\_\-detector\-\_\-all}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-lock\-\_\-detector\-\_\-all}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-lock\-\_\-detector\-\_\-all (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_aff93d2f5ac31aa249a0bef40a3837c84}


Detector lock convinence function. 



Definition at line 1123 of file lspg.\-c.


\begin{DoxyCode}
                              \{
  \hyperlink{lspg_8c_a5f71a20cc297684b2afe28e7bd8e8383}{lspg\_lock\_detector\_call}();
  \hyperlink{lspg_8c_ad3d9c56bd3ca6bcc43db30872cc441cc}{lspg\_lock\_detector\_wait}();
  \hyperlink{lspg_8c_a1b567040693ff6e2932a2477045d75fa}{lspg\_lock\_detector\_done}();
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a5f71a20cc297684b2afe28e7bd8e8383}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-lock\-\_\-detector\-\_\-call@{lspg\-\_\-lock\-\_\-detector\-\_\-call}}
\index{lspg\-\_\-lock\-\_\-detector\-\_\-call@{lspg\-\_\-lock\-\_\-detector\-\_\-call}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-lock\-\_\-detector\-\_\-call}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-lock\-\_\-detector\-\_\-call (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a5f71a20cc297684b2afe28e7bd8e8383}


Request (demand) a detector lock. 



Definition at line 1099 of file lspg.\-c.


\begin{DoxyCode}
                               \{
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_adbf3b3652c6531c3d194320d1abc1c80}{lspg\_lock\_detector}.\hyperlink{structlspg__lock__detector__struct_ab5ab5534b376a8fbafdd0b54cec4483c}{mutex}));
  \hyperlink{lspg_8c_adbf3b3652c6531c3d194320d1abc1c80}{lspg\_lock\_detector}.\hyperlink{structlspg__lock__detector__struct_a62373414b815fe178edd8522b3bd4d78}{new\_value\_ready} = 0;
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_adbf3b3652c6531c3d194320d1abc1c80}{lspg\_lock\_detector}.\hyperlink{structlspg__lock__detector__struct_ab5ab5534b376a8fbafdd0b54cec4483c}{mutex}));

  \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( \hyperlink{lspg_8c_aa760191c2b443170cebbcbf5ea5345f3}{lspg\_lock\_detector\_cb}, \textcolor{stringliteral}{"
      SELECT px.lock\_detector()"});
\}
\end{DoxyCode}
\hypertarget{lspg_8c_aa760191c2b443170cebbcbf5ea5345f3}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-lock\-\_\-detector\-\_\-cb@{lspg\-\_\-lock\-\_\-detector\-\_\-cb}}
\index{lspg\-\_\-lock\-\_\-detector\-\_\-cb@{lspg\-\_\-lock\-\_\-detector\-\_\-cb}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-lock\-\_\-detector\-\_\-cb}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-lock\-\_\-detector\-\_\-cb (
\begin{DoxyParamCaption}
\item[{{\bf lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$}]{qqp, }
\item[{P\-Gresult $\ast$}]{pgr}
\end{DoxyParamCaption}
)}}\label{lspg_8c_aa760191c2b443170cebbcbf5ea5345f3}


Callback for when the detector lock has be grabbed. 



Definition at line 1090 of file lspg.\-c.


\begin{DoxyCode}
                                                                    \{
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_adbf3b3652c6531c3d194320d1abc1c80}{lspg\_lock\_detector}.\hyperlink{structlspg__lock__detector__struct_ab5ab5534b376a8fbafdd0b54cec4483c}{mutex}));
  \hyperlink{lspg_8c_adbf3b3652c6531c3d194320d1abc1c80}{lspg\_lock\_detector}.\hyperlink{structlspg__lock__detector__struct_a62373414b815fe178edd8522b3bd4d78}{new\_value\_ready} = 1;
  pthread\_cond\_signal( &(\hyperlink{lspg_8c_adbf3b3652c6531c3d194320d1abc1c80}{lspg\_lock\_detector}.\hyperlink{structlspg__lock__detector__struct_adc90c859665dccc8717219e824cba0b8}{cond}));
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_adbf3b3652c6531c3d194320d1abc1c80}{lspg\_lock\_detector}.\hyperlink{structlspg__lock__detector__struct_ab5ab5534b376a8fbafdd0b54cec4483c}{mutex}));
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a1b567040693ff6e2932a2477045d75fa}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-lock\-\_\-detector\-\_\-done@{lspg\-\_\-lock\-\_\-detector\-\_\-done}}
\index{lspg\-\_\-lock\-\_\-detector\-\_\-done@{lspg\-\_\-lock\-\_\-detector\-\_\-done}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-lock\-\_\-detector\-\_\-done}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-lock\-\_\-detector\-\_\-done (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a1b567040693ff6e2932a2477045d75fa}


Finish waiting. 



Definition at line 1117 of file lspg.\-c.


\begin{DoxyCode}
                               \{
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_adbf3b3652c6531c3d194320d1abc1c80}{lspg\_lock\_detector}.\hyperlink{structlspg__lock__detector__struct_ab5ab5534b376a8fbafdd0b54cec4483c}{mutex}));
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a0e9bbf847dadfe0d10830d67824d9be8}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-lock\-\_\-detector\-\_\-init@{lspg\-\_\-lock\-\_\-detector\-\_\-init}}
\index{lspg\-\_\-lock\-\_\-detector\-\_\-init@{lspg\-\_\-lock\-\_\-detector\-\_\-init}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-lock\-\_\-detector\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-lock\-\_\-detector\-\_\-init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a0e9bbf847dadfe0d10830d67824d9be8}


Initialize detector lock object. 



Definition at line 1082 of file lspg.\-c.


\begin{DoxyCode}
                               \{
  \hyperlink{lspg_8c_adbf3b3652c6531c3d194320d1abc1c80}{lspg\_lock\_detector}.\hyperlink{structlspg__lock__detector__struct_a62373414b815fe178edd8522b3bd4d78}{new\_value\_ready} = 0;
  pthread\_mutex\_init( &(\hyperlink{lspg_8c_adbf3b3652c6531c3d194320d1abc1c80}{lspg\_lock\_detector}.\hyperlink{structlspg__lock__detector__struct_ab5ab5534b376a8fbafdd0b54cec4483c}{mutex}), NULL)
      ;
  pthread\_cond\_init(  &(\hyperlink{lspg_8c_adbf3b3652c6531c3d194320d1abc1c80}{lspg\_lock\_detector}.\hyperlink{structlspg__lock__detector__struct_adc90c859665dccc8717219e824cba0b8}{cond}),  NULL);
\}
\end{DoxyCode}
\hypertarget{lspg_8c_ad3d9c56bd3ca6bcc43db30872cc441cc}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-lock\-\_\-detector\-\_\-wait@{lspg\-\_\-lock\-\_\-detector\-\_\-wait}}
\index{lspg\-\_\-lock\-\_\-detector\-\_\-wait@{lspg\-\_\-lock\-\_\-detector\-\_\-wait}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-lock\-\_\-detector\-\_\-wait}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-lock\-\_\-detector\-\_\-wait (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_ad3d9c56bd3ca6bcc43db30872cc441cc}


Wait for the detector lock. 



Definition at line 1109 of file lspg.\-c.


\begin{DoxyCode}
                               \{
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_adbf3b3652c6531c3d194320d1abc1c80}{lspg\_lock\_detector}.\hyperlink{structlspg__lock__detector__struct_ab5ab5534b376a8fbafdd0b54cec4483c}{mutex}));
  \textcolor{keywordflow}{while}( \hyperlink{lspg_8c_adbf3b3652c6531c3d194320d1abc1c80}{lspg\_lock\_detector}.\hyperlink{structlspg__lock__detector__struct_a62373414b815fe178edd8522b3bd4d78}{new\_value\_ready} ==
       0)
    pthread\_cond\_wait( &(\hyperlink{lspg_8c_adbf3b3652c6531c3d194320d1abc1c80}{lspg\_lock\_detector}.\hyperlink{structlspg__lock__detector__struct_adc90c859665dccc8717219e824cba0b8}{cond}), &(
      \hyperlink{lspg_8c_adbf3b3652c6531c3d194320d1abc1c80}{lspg\_lock\_detector}.\hyperlink{structlspg__lock__detector__struct_ab5ab5534b376a8fbafdd0b54cec4483c}{mutex}));
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a88b33e75c42197740b157a51ea726f21}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-lock\-\_\-diffractometer\-\_\-all@{lspg\-\_\-lock\-\_\-diffractometer\-\_\-all}}
\index{lspg\-\_\-lock\-\_\-diffractometer\-\_\-all@{lspg\-\_\-lock\-\_\-diffractometer\-\_\-all}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-lock\-\_\-diffractometer\-\_\-all}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-lock\-\_\-diffractometer\-\_\-all (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a88b33e75c42197740b157a51ea726f21}


Convience function that combines lock diffractometer calls. 



Definition at line 1064 of file lspg.\-c.


\begin{DoxyCode}
                                    \{
  \hyperlink{lspg_8c_ac5ebeb38e8e9926a52f024fe76201175}{lspg\_lock\_diffractometer\_call}();
  \hyperlink{lspg_8c_a8445e1dec753f2c517b87fcb9c5b5943}{lspg\_lock\_diffractometer\_wait}();
  \hyperlink{lspg_8c_a88b33e75c42197740b157a51ea726f21}{lspg\_lock\_diffractometer\_all}();
\}
\end{DoxyCode}
\hypertarget{lspg_8c_ac5ebeb38e8e9926a52f024fe76201175}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-lock\-\_\-diffractometer\-\_\-call@{lspg\-\_\-lock\-\_\-diffractometer\-\_\-call}}
\index{lspg\-\_\-lock\-\_\-diffractometer\-\_\-call@{lspg\-\_\-lock\-\_\-diffractometer\-\_\-call}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-lock\-\_\-diffractometer\-\_\-call}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-lock\-\_\-diffractometer\-\_\-call (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_ac5ebeb38e8e9926a52f024fe76201175}


Request that the database grab the diffractometer lock. 



Definition at line 1040 of file lspg.\-c.


\begin{DoxyCode}
                                     \{
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_aaae7ce3ecd7d54a9e46c41d7a742a454}{lspg\_lock\_diffractometer}.\hyperlink{structlspg__lock__diffractometer__struct_a362e848dfd1551428b8d12d8776fd2ed}{mutex}
      ));
  \hyperlink{lspg_8c_aaae7ce3ecd7d54a9e46c41d7a742a454}{lspg\_lock\_diffractometer}.\hyperlink{structlspg__lock__diffractometer__struct_ae94acdf44008ce48930e3083f08f5b6c}{new\_value\_ready}
       = 0;
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_aaae7ce3ecd7d54a9e46c41d7a742a454}{lspg\_lock\_diffractometer}.\hyperlink{structlspg__lock__diffractometer__struct_a362e848dfd1551428b8d12d8776fd2ed}{
      mutex}));

  \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( \hyperlink{lspg_8c_aad4f378f37c0030634dafa0d9445d916}{lspg\_lock\_diffractometer\_cb}
      , \textcolor{stringliteral}{"SELECT px.lock\_diffractomter()"});
\}
\end{DoxyCode}
\hypertarget{lspg_8c_aad4f378f37c0030634dafa0d9445d916}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-lock\-\_\-diffractometer\-\_\-cb@{lspg\-\_\-lock\-\_\-diffractometer\-\_\-cb}}
\index{lspg\-\_\-lock\-\_\-diffractometer\-\_\-cb@{lspg\-\_\-lock\-\_\-diffractometer\-\_\-cb}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-lock\-\_\-diffractometer\-\_\-cb}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-lock\-\_\-diffractometer\-\_\-cb (
\begin{DoxyParamCaption}
\item[{{\bf lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$}]{qqp, }
\item[{P\-Gresult $\ast$}]{pgr}
\end{DoxyParamCaption}
)}}\label{lspg_8c_aad4f378f37c0030634dafa0d9445d916}


Callback routine for a lock diffractometer query. 



Definition at line 1031 of file lspg.\-c.


\begin{DoxyCode}
                                                                          \{
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_aaae7ce3ecd7d54a9e46c41d7a742a454}{lspg\_lock\_diffractometer}.\hyperlink{structlspg__lock__diffractometer__struct_a362e848dfd1551428b8d12d8776fd2ed}{mutex}
      ));
  \hyperlink{lspg_8c_aaae7ce3ecd7d54a9e46c41d7a742a454}{lspg\_lock\_diffractometer}.\hyperlink{structlspg__lock__diffractometer__struct_ae94acdf44008ce48930e3083f08f5b6c}{new\_value\_ready}
       = 1;
  pthread\_cond\_signal( &(\hyperlink{lspg_8c_aaae7ce3ecd7d54a9e46c41d7a742a454}{lspg\_lock\_diffractometer}.\hyperlink{structlspg__lock__diffractometer__struct_a7614c802af37c1d3358479a2c13ac898}{cond}
      ));
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_aaae7ce3ecd7d54a9e46c41d7a742a454}{lspg\_lock\_diffractometer}.\hyperlink{structlspg__lock__diffractometer__struct_a362e848dfd1551428b8d12d8776fd2ed}{
      mutex}));
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a75aaf0b3fe33530062226c69a33ce821}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-lock\-\_\-diffractometer\-\_\-done@{lspg\-\_\-lock\-\_\-diffractometer\-\_\-done}}
\index{lspg\-\_\-lock\-\_\-diffractometer\-\_\-done@{lspg\-\_\-lock\-\_\-diffractometer\-\_\-done}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-lock\-\_\-diffractometer\-\_\-done}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-lock\-\_\-diffractometer\-\_\-done (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a75aaf0b3fe33530062226c69a33ce821}


Finish up the lock diffractometer call. 



Definition at line 1058 of file lspg.\-c.


\begin{DoxyCode}
                                     \{
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_aaae7ce3ecd7d54a9e46c41d7a742a454}{lspg\_lock\_diffractometer}.\hyperlink{structlspg__lock__diffractometer__struct_a362e848dfd1551428b8d12d8776fd2ed}{
      mutex}));
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a39bb94f8e0d47702b2b920a3dee61ebc}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-lock\-\_\-diffractometer\-\_\-init@{lspg\-\_\-lock\-\_\-diffractometer\-\_\-init}}
\index{lspg\-\_\-lock\-\_\-diffractometer\-\_\-init@{lspg\-\_\-lock\-\_\-diffractometer\-\_\-init}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-lock\-\_\-diffractometer\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-lock\-\_\-diffractometer\-\_\-init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a39bb94f8e0d47702b2b920a3dee61ebc}


initialize the diffractometer locking object 



Definition at line 1023 of file lspg.\-c.


\begin{DoxyCode}
                                     \{
  \hyperlink{lspg_8c_aaae7ce3ecd7d54a9e46c41d7a742a454}{lspg\_lock\_diffractometer}.\hyperlink{structlspg__lock__diffractometer__struct_ae94acdf44008ce48930e3083f08f5b6c}{new\_value\_ready}
       = 0;
  pthread\_mutex\_init( &(\hyperlink{lspg_8c_aaae7ce3ecd7d54a9e46c41d7a742a454}{lspg\_lock\_diffractometer}.\hyperlink{structlspg__lock__diffractometer__struct_a362e848dfd1551428b8d12d8776fd2ed}{mutex}
      ), NULL);
  pthread\_cond\_init(  &(\hyperlink{lspg_8c_aaae7ce3ecd7d54a9e46c41d7a742a454}{lspg\_lock\_diffractometer}.\hyperlink{structlspg__lock__diffractometer__struct_a7614c802af37c1d3358479a2c13ac898}{cond}
      ), NULL);
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a8445e1dec753f2c517b87fcb9c5b5943}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-lock\-\_\-diffractometer\-\_\-wait@{lspg\-\_\-lock\-\_\-diffractometer\-\_\-wait}}
\index{lspg\-\_\-lock\-\_\-diffractometer\-\_\-wait@{lspg\-\_\-lock\-\_\-diffractometer\-\_\-wait}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-lock\-\_\-diffractometer\-\_\-wait}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-lock\-\_\-diffractometer\-\_\-wait (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a8445e1dec753f2c517b87fcb9c5b5943}


Wait for the diffractometer lock. 



Definition at line 1050 of file lspg.\-c.


\begin{DoxyCode}
                                     \{
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_aaae7ce3ecd7d54a9e46c41d7a742a454}{lspg\_lock\_diffractometer}.\hyperlink{structlspg__lock__diffractometer__struct_a362e848dfd1551428b8d12d8776fd2ed}{mutex}
      ));
  \textcolor{keywordflow}{while}( \hyperlink{lspg_8c_aaae7ce3ecd7d54a9e46c41d7a742a454}{lspg\_lock\_diffractometer}.\hyperlink{structlspg__lock__diffractometer__struct_ae94acdf44008ce48930e3083f08f5b6c}{new\_value\_ready}
       == 0)
    pthread\_cond\_wait( &(\hyperlink{lspg_8c_aaae7ce3ecd7d54a9e46c41d7a742a454}{lspg\_lock\_diffractometer}.\hyperlink{structlspg__lock__diffractometer__struct_a7614c802af37c1d3358479a2c13ac898}{cond}
      ), &(\hyperlink{lspg_8c_aaae7ce3ecd7d54a9e46c41d7a742a454}{lspg\_lock\_diffractometer}.\hyperlink{structlspg__lock__diffractometer__struct_a362e848dfd1551428b8d12d8776fd2ed}{mutex}));
\}
\end{DoxyCode}
\hypertarget{lspg_8c_ab52a8c8245bf6561f40c0f224fc07ff4}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-next\-\_\-state@{lspg\-\_\-next\-\_\-state}}
\index{lspg\-\_\-next\-\_\-state@{lspg\-\_\-next\-\_\-state}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-next\-\_\-state}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-next\-\_\-state (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_ab52a8c8245bf6561f40c0f224fc07ff4}


Implements our state machine Does not strictly only set the next state as it also calls some functions that, perhaps, alters the state mid-\/function. 



Definition at line 1725 of file lspg.\-c.


\begin{DoxyCode}
                       \{
  \textcolor{comment}{//}
  \textcolor{comment}{// connect to the database}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q} == NULL ||
      \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} == \hyperlink{lspg_8c_af443092447378c73bf93aa143576aba4}{LS\_PG\_STATE\_INIT} ||
      \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} == \hyperlink{lspg_8c_accda8c3a598dc7f5b107b04986d8ab50}{LS\_PG\_STATE\_RESET} ||
      \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} == \hyperlink{lspg_8c_ae7ea5876846b5f04c419aee22d3c0aa1}{LS\_PG\_STATE\_INIT\_POLL} ||
      \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} == \hyperlink{lspg_8c_ac70a1141f3b138055ea7143bd493187c}{LS\_PG\_STATE\_RESET\_POLL})
    \hyperlink{lspg_8c_a581c18be0368425665a40b4b7f7d9714}{lspg\_pg\_connect}( \hyperlink{lspg_8c_af3f897b8ffa020ca54289bc5b28cb64d}{lspgfd});


  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} == \hyperlink{lspg_8c_aaf1dd8ba4dafb91c296554c4cbf312e3}{LS\_PG\_STATE\_IDLE} && 
      \hyperlink{lspg_8c_a3cbe7f3161b3c1838ebc56a3bbcfd8a6}{lspg\_query\_queue\_on} != \hyperlink{lspg_8c_aca86bb77d6cecfae9251743f4171bafb}{lspg\_query\_queue\_off}
      )
    \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} = \hyperlink{lspg_8c_a3c6eb19f262a990e1f9ba630d9edc309}{LS\_PG\_STATE\_SEND};

  \textcolor{keywordflow}{switch}( \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state}) \{
  \textcolor{keywordflow}{case} \hyperlink{lspg_8c_ae7ea5876846b5f04c419aee22d3c0aa1}{LS\_PG\_STATE\_INIT\_POLL}:
    \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a69ae04978986e6413ca7cefcb692b645}{lspg\_connectPoll\_response} == 
      PGRES\_POLLING\_WRITING)
      \hyperlink{lspg_8c_af3f897b8ffa020ca54289bc5b28cb64d}{lspgfd}.events = POLLOUT;
    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a69ae04978986e6413ca7cefcb692b645}{lspg\_connectPoll\_response} == 
      PGRES\_POLLING\_READING)
      \hyperlink{lspg_8c_af3f897b8ffa020ca54289bc5b28cb64d}{lspgfd}.events = POLLIN;
    \textcolor{keywordflow}{else}
      \hyperlink{lspg_8c_af3f897b8ffa020ca54289bc5b28cb64d}{lspgfd}.events = 0;
    \textcolor{keywordflow}{break};
      
  \textcolor{keywordflow}{case} \hyperlink{lspg_8c_ac70a1141f3b138055ea7143bd493187c}{LS\_PG\_STATE\_RESET\_POLL}:
    \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a06c5a937e41a6c706a247777642ec1fb}{lspg\_resetPoll\_response} == PGRES\_POLLING\_WRITING
      )
      \hyperlink{lspg_8c_af3f897b8ffa020ca54289bc5b28cb64d}{lspgfd}.events = POLLOUT;
    \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a06c5a937e41a6c706a247777642ec1fb}{lspg\_resetPoll\_response} == 
      PGRES\_POLLING\_READING)
      \hyperlink{lspg_8c_af3f897b8ffa020ca54289bc5b28cb64d}{lspgfd}.events = POLLIN;
    \textcolor{keywordflow}{else}
      \hyperlink{lspg_8c_af3f897b8ffa020ca54289bc5b28cb64d}{lspgfd}.events = 0;
    \textcolor{keywordflow}{break};

  \textcolor{keywordflow}{case} \hyperlink{lspg_8c_aaf1dd8ba4dafb91c296554c4cbf312e3}{LS\_PG\_STATE\_IDLE}:
  \textcolor{keywordflow}{case} \hyperlink{lspg_8c_a373e668840b4795ff9a71bc3f744d209}{LS\_PG\_STATE\_RECV}:
    \hyperlink{lspg_8c_af3f897b8ffa020ca54289bc5b28cb64d}{lspgfd}.events = POLLIN;
    \textcolor{keywordflow}{break};

  \textcolor{keywordflow}{case} \hyperlink{lspg_8c_a3c6eb19f262a990e1f9ba630d9edc309}{LS\_PG\_STATE\_SEND}:
  \textcolor{keywordflow}{case} \hyperlink{lspg_8c_a88a7e80c12fb0449c4b0857a0c7deb21}{LS\_PG\_STATE\_SEND\_FLUSH}:
    \hyperlink{lspg_8c_af3f897b8ffa020ca54289bc5b28cb64d}{lspgfd}.events = POLLOUT;
    \textcolor{keywordflow}{break};

  \textcolor{keywordflow}{default}:
    \hyperlink{lspg_8c_af3f897b8ffa020ca54289bc5b28cb64d}{lspgfd}.events = 0;
  \}
\}
\end{DoxyCode}
\hypertarget{lspg_8c_aeda8dad89b03d7d61cc994dd63ee5db6}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-nextaction\-\_\-cb@{lspg\-\_\-nextaction\-\_\-cb}}
\index{lspg\-\_\-nextaction\-\_\-cb@{lspg\-\_\-nextaction\-\_\-cb}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-nextaction\-\_\-cb}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-nextaction\-\_\-cb (
\begin{DoxyParamCaption}
\item[{{\bf lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$}]{qqp, }
\item[{P\-Gresult $\ast$}]{pgr}
\end{DoxyParamCaption}
)}}\label{lspg_8c_aeda8dad89b03d7d61cc994dd63ee5db6}


Queue the next M\-D2 instruction. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em qqp} & The query that generated this result \\
\hline
\mbox{\tt in}  & {\em pgr} & The result \\
\hline
\end{DoxyParams}


Definition at line 1309 of file lspg.\-c.


\begin{DoxyCode}
                          \{
  \textcolor{keywordtype}{char} *action;


  \textcolor{keywordflow}{if}( PQntuples( pgr) <= 0)
    \textcolor{keywordflow}{return};             \textcolor{comment}{// Note: nextaction should always return at least
       "noAction", so this branch should never be taken}

  action = PQgetvalue( pgr, 0, 0);      \textcolor{comment}{// next action only returns one row}

  \textcolor{keywordflow}{if}( strcmp( action, \textcolor{stringliteral}{"noAction"}) == 0)
    \textcolor{keywordflow}{return};
  
  \textcolor{keywordflow}{if}( pthread\_mutex\_trylock( &\hyperlink{md2cmds_8c_ad67304bb851dc6268b0cda2f40fc5aa8}{md2cmds\_mutex}) == 0) \{
    strncpy( \hyperlink{md2cmds_8c_a5f0fe1e2dfa92cf345b8c29134ab1ede}{md2cmds\_cmd}, action, \hyperlink{pgpmac_8h_a30f0f377b0f0695284145d420ea51846}{MD2CMDS\_CMD\_LENGTH}
      -1);
    \hyperlink{md2cmds_8c_a5f0fe1e2dfa92cf345b8c29134ab1ede}{md2cmds\_cmd}[\hyperlink{pgpmac_8h_a30f0f377b0f0695284145d420ea51846}{MD2CMDS\_CMD\_LENGTH}-1] = 0;
    pthread\_cond\_signal( &\hyperlink{md2cmds_8c_a08d5b18ec9478d753c46a3e28d1f2126}{md2cmds\_cond});
    pthread\_mutex\_unlock( &\hyperlink{md2cmds_8c_ad67304bb851dc6268b0cda2f40fc5aa8}{md2cmds\_mutex});
  \} \textcolor{keywordflow}{else} \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"MD2 command '%s' ignored. 
       Already running '%s'"}, action, \hyperlink{md2cmds_8c_a5f0fe1e2dfa92cf345b8c29134ab1ede}{md2cmds\_cmd});
  \}
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a4cc866393eda0cf20276d035f6fbe206}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-nextsample\-\_\-all@{lspg\-\_\-nextsample\-\_\-all}}
\index{lspg\-\_\-nextsample\-\_\-all@{lspg\-\_\-nextsample\-\_\-all}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-nextsample\-\_\-all}]{\setlength{\rightskip}{0pt plus 5cm}unsigned int lspg\-\_\-nextsample\-\_\-all (
\begin{DoxyParamCaption}
\item[{int $\ast$}]{err}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a4cc866393eda0cf20276d035f6fbe206}


Definition at line 567 of file lspg.\-c.


\begin{DoxyCode}
                                            \{
  \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} rtn;

  \hyperlink{lspg_8c_aab1c441d22126ea4334b3c61b7e4b4c2}{lspg\_nextsample\_call}();
  \hyperlink{lspg_8c_a32878d3d29f4595d1d2b861d7e871726}{lspg\_nextsample\_wait}();

  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_aeee8110133db9f1895237ed9b54dd873}{no\_rows\_returned}) \{
    rtn = 0;
    *err = 1;
  \} \textcolor{keywordflow}{else} \{
    \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_a2ca6e2a667c9fe7f1a54329de04d2a3c}{nextsample\_isnull}) \{
      rtn = 0;
      *err = 1;
    \} \textcolor{keywordflow}{else} \{
      rtn = \hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_aecd82b329462ae06bc2f0d162985a086}{nextsample};
      *err = 0;
    \}
  \}
  \hyperlink{lspg_8c_ac52207cc8f4c14494ae6f4972b6a3b23}{lspg\_nextsample\_done}();

  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{lspg_8c_aab1c441d22126ea4334b3c61b7e4b4c2}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-nextsample\-\_\-call@{lspg\-\_\-nextsample\-\_\-call}}
\index{lspg\-\_\-nextsample\-\_\-call@{lspg\-\_\-nextsample\-\_\-call}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-nextsample\-\_\-call}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-nextsample\-\_\-call (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_aab1c441d22126ea4334b3c61b7e4b4c2}


Queue up a nextsample query. 



Definition at line 544 of file lspg.\-c.


\begin{DoxyCode}
                            \{
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_a99408b5825e2510f07be199d2cdc3633}{mutex}));
  \hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_ab1c9e9d3dc5140137a7ccf908e95f69e}{new\_value\_ready} = 0;
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_a99408b5825e2510f07be199d2cdc3633}{mutex}));
  
  \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( \hyperlink{lspg_8c_a5e1de4aa16107d1f5f801e11ae6b268c}{lspg\_nextsample\_cb}, \textcolor{stringliteral}{"SELECT
       nextsample FROM px.nextsample()"});
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a5e1de4aa16107d1f5f801e11ae6b268c}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-nextsample\-\_\-cb@{lspg\-\_\-nextsample\-\_\-cb}}
\index{lspg\-\_\-nextsample\-\_\-cb@{lspg\-\_\-nextsample\-\_\-cb}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-nextsample\-\_\-cb}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-nextsample\-\_\-cb (
\begin{DoxyParamCaption}
\item[{{\bf lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$}]{qqp, }
\item[{P\-Gresult $\ast$}]{pgr}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a5e1de4aa16107d1f5f801e11ae6b268c}


Next Sample. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em qqp} & Our nextsample query \\
\hline
\mbox{\tt in}  & {\em pgr} & result of the query \\
\hline
\end{DoxyParams}


Definition at line 503 of file lspg.\-c.


\begin{DoxyCode}
                        \{
  \textcolor{keyword}{static} \textcolor{keywordtype}{int} got\_columns = 0;
  \textcolor{keyword}{static} \textcolor{keywordtype}{int} nextsample\_col;
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_a99408b5825e2510f07be199d2cdc3633}{mutex}));

  \hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_aeee8110133db9f1895237ed9b54dd873}{no\_rows\_returned} = PQntuples( 
      pgr) <= 0;
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_aeee8110133db9f1895237ed9b54dd873}{no\_rows\_returned}) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspg\_nextsample\_cb: no rows
       returned.  This should never happen."});
    \hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_ab1c9e9d3dc5140137a7ccf908e95f69e}{new\_value\_ready} = 1;
    pthread\_cond\_signal( &(\hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_a5b46e4537dac3be839f6c3eeff6b46b6}{cond}));
    pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_a99408b5825e2510f07be199d2cdc3633}{mutex}));
    \textcolor{keywordflow}{return};
  \}

  \textcolor{keywordflow}{if}( got\_columns == 0) \{
    nextsample\_col = PQfnumber( pgr, \textcolor{stringliteral}{"nextsample"});
    got\_columns = 1;
  \}

  \hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_a2ca6e2a667c9fe7f1a54329de04d2a3c}{nextsample\_isnull} = 
      PQgetisnull( pgr, 0, nextsample\_col);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_a2ca6e2a667c9fe7f1a54329de04d2a3c}{nextsample\_isnull} == 0)
    \hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_aecd82b329462ae06bc2f0d162985a086}{nextsample} = strtol( PQgetvalue( 
      pgr, 0, nextsample\_col), NULL, 0);

  \hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_ab1c9e9d3dc5140137a7ccf908e95f69e}{new\_value\_ready} = 1;
  pthread\_cond\_signal( &(\hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_a5b46e4537dac3be839f6c3eeff6b46b6}{cond}));
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_a99408b5825e2510f07be199d2cdc3633}{mutex}));
\}
\end{DoxyCode}
\hypertarget{lspg_8c_ac52207cc8f4c14494ae6f4972b6a3b23}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-nextsample\-\_\-done@{lspg\-\_\-nextsample\-\_\-done}}
\index{lspg\-\_\-nextsample\-\_\-done@{lspg\-\_\-nextsample\-\_\-done}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-nextsample\-\_\-done}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-nextsample\-\_\-done (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_ac52207cc8f4c14494ae6f4972b6a3b23}


Called when the next shot query has been processed. 



Definition at line 562 of file lspg.\-c.


\begin{DoxyCode}
                            \{
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_a99408b5825e2510f07be199d2cdc3633}{mutex}));
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a2faa901ea0a8ef00cfd93a893b34b446}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-nextsample\-\_\-init@{lspg\-\_\-nextsample\-\_\-init}}
\index{lspg\-\_\-nextsample\-\_\-init@{lspg\-\_\-nextsample\-\_\-init}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-nextsample\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-nextsample\-\_\-init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a2faa901ea0a8ef00cfd93a893b34b446}


Initialize the nextsample variable, mutex, and condition. 



Definition at line 536 of file lspg.\-c.


\begin{DoxyCode}
                            \{
  memset( &\hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}, 0, \textcolor{keyword}{sizeof}( \hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}
      ));
  pthread\_mutex\_init( &(\hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_a99408b5825e2510f07be199d2cdc3633}{mutex}), NULL);
  pthread\_cond\_init( &(\hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_a5b46e4537dac3be839f6c3eeff6b46b6}{cond}), NULL);
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a32878d3d29f4595d1d2b861d7e871726}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-nextsample\-\_\-wait@{lspg\-\_\-nextsample\-\_\-wait}}
\index{lspg\-\_\-nextsample\-\_\-wait@{lspg\-\_\-nextsample\-\_\-wait}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-nextsample\-\_\-wait}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-nextsample\-\_\-wait (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a32878d3d29f4595d1d2b861d7e871726}


Wait for the nextsample query to get processed. 



Definition at line 554 of file lspg.\-c.


\begin{DoxyCode}
                            \{
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_a99408b5825e2510f07be199d2cdc3633}{mutex}));
  \textcolor{keywordflow}{while}( \hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_ab1c9e9d3dc5140137a7ccf908e95f69e}{new\_value\_ready} == 0)
    pthread\_cond\_wait( &(\hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_a5b46e4537dac3be839f6c3eeff6b46b6}{cond}), &(
      \hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_a99408b5825e2510f07be199d2cdc3633}{mutex}));
\}
\end{DoxyCode}
\hypertarget{lspg_8c_af17ef79544ca5d78fd477010fe90d538}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-nextshot\-\_\-call@{lspg\-\_\-nextshot\-\_\-call}}
\index{lspg\-\_\-nextshot\-\_\-call@{lspg\-\_\-nextshot\-\_\-call}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-nextshot\-\_\-call}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-nextshot\-\_\-call (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_af17ef79544ca5d78fd477010fe90d538}


Queue up a nextshot query. 



Definition at line 923 of file lspg.\-c.


\begin{DoxyCode}
                          \{
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a38b657155fbee9b73278f76912cf2333}{mutex}));
  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_adb8da14444b98f556dba9420dd4666dc}{new\_value\_ready} = 0;
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a38b657155fbee9b73278f76912cf2333}{mutex}));
  
  \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( \hyperlink{lspg_8c_a9e92a204f606761d368ac7e06ef0f09c}{lspg\_nextshot\_cb}, \textcolor{stringliteral}{"SELECT *
       FROM px.nextshot2()"});
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a9e92a204f606761d368ac7e06ef0f09c}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-nextshot\-\_\-cb@{lspg\-\_\-nextshot\-\_\-cb}}
\index{lspg\-\_\-nextshot\-\_\-cb@{lspg\-\_\-nextshot\-\_\-cb}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-nextshot\-\_\-cb}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-nextshot\-\_\-cb (
\begin{DoxyParamCaption}
\item[{{\bf lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$}]{qqp, }
\item[{P\-Gresult $\ast$}]{pgr}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a9e92a204f606761d368ac7e06ef0f09c}


Next Shot Callback. 

This is a long and tedious routine as there are a large number of variables returned. Suck it up. Return with the global object lspg\-\_\-nextshot set. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em qqp} & Our nextshot query \\
\hline
\mbox{\tt in}  & {\em pgr} & result of the query \\
\hline
\end{DoxyParams}


Definition at line 668 of file lspg.\-c.


\begin{DoxyCode}
                        \{
  \textcolor{keyword}{static} \textcolor{keywordtype}{int} got\_col\_nums=0;
  \textcolor{keyword}{static} \textcolor{keywordtype}{int}
    dsdir\_c, dspid\_c, dsowidth\_c, dsoscaxis\_c, dsexp\_c, skey\_c, sstart\_c, sfn\_c
      , dsphi\_c,
    dsomega\_c, dskappa\_c, dsdist\_c, dsnrg\_c, dshpid\_c, cx\_c, cy\_c, ax\_c, ay\_c, 
      az\_c,
    active\_c, sindex\_c, stype\_c,
    dsowidth2\_c, dsoscaxis2\_c, dsexp2\_c, sstart2\_c, dsphi2\_c, dsomega2\_c, 
      dskappa2\_c, dsdist2\_c, dsnrg2\_c,
    cx2\_c, cy2\_c, ax2\_c, ay2\_c, az2\_c, active2\_c, sindex2\_c, stype2\_c;
  
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a38b657155fbee9b73278f76912cf2333}{mutex}));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_abc9242805729f70b83df79706c394c71}{no\_rows\_returned} = PQntuples( pgr)
       <= 0;
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_abc9242805729f70b83df79706c394c71}{no\_rows\_returned}) \{
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_adb8da14444b98f556dba9420dd4666dc}{new\_value\_ready} = 1;
    pthread\_cond\_signal( &(\hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_afc773a9eefc173aa98d5c2889e1d7669}{cond}));
    pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a38b657155fbee9b73278f76912cf2333}{mutex}));
    \textcolor{keywordflow}{return};                     \textcolor{comment}{// I guess there was no shot after all}
  \}

  \textcolor{keywordflow}{if}( got\_col\_nums == 0) \{
    dsdir\_c      = PQfnumber( pgr, \textcolor{stringliteral}{"dsdir"});
    dspid\_c      = PQfnumber( pgr, \textcolor{stringliteral}{"dspid"});
    dsowidth\_c   = PQfnumber( pgr, \textcolor{stringliteral}{"dsowidth"});
    dsoscaxis\_c  = PQfnumber( pgr, \textcolor{stringliteral}{"dsoscaxis"});
    dsexp\_c      = PQfnumber( pgr, \textcolor{stringliteral}{"dsexp"});
    skey\_c       = PQfnumber( pgr, \textcolor{stringliteral}{"skey"});
    sstart\_c     = PQfnumber( pgr, \textcolor{stringliteral}{"sstart"});
    sfn\_c        = PQfnumber( pgr, \textcolor{stringliteral}{"sfn"});
    dsphi\_c      = PQfnumber( pgr, \textcolor{stringliteral}{"dsphi"});
    dsomega\_c    = PQfnumber( pgr, \textcolor{stringliteral}{"dsomega"});
    dskappa\_c    = PQfnumber( pgr, \textcolor{stringliteral}{"dskappa"});
    dsdist\_c     = PQfnumber( pgr, \textcolor{stringliteral}{"dsdist"});
    dsnrg\_c      = PQfnumber( pgr, \textcolor{stringliteral}{"dsnrg"});
    dshpid\_c     = PQfnumber( pgr, \textcolor{stringliteral}{"dshpid"});
    cx\_c         = PQfnumber( pgr, \textcolor{stringliteral}{"cx"});
    cy\_c         = PQfnumber( pgr, \textcolor{stringliteral}{"cy"});
    ax\_c         = PQfnumber( pgr, \textcolor{stringliteral}{"ax"});
    ay\_c         = PQfnumber( pgr, \textcolor{stringliteral}{"ay"});
    az\_c         = PQfnumber( pgr, \textcolor{stringliteral}{"az"});
    active\_c     = PQfnumber( pgr, \textcolor{stringliteral}{"active"});
    sindex\_c     = PQfnumber( pgr, \textcolor{stringliteral}{"sindex"});
    stype\_c      = PQfnumber( pgr, \textcolor{stringliteral}{"stype"});
    dsowidth2\_c  = PQfnumber( pgr, \textcolor{stringliteral}{"dsowidth2"});
    dsoscaxis2\_c = PQfnumber( pgr, \textcolor{stringliteral}{"dsoscaxis2"});
    dsexp2\_c     = PQfnumber( pgr, \textcolor{stringliteral}{"dsexp2"});
    sstart2\_c    = PQfnumber( pgr, \textcolor{stringliteral}{"sstart2"});
    dsphi2\_c     = PQfnumber( pgr, \textcolor{stringliteral}{"dsphi2"});
    dsomega2\_c   = PQfnumber( pgr, \textcolor{stringliteral}{"dsomega2"});
    dskappa2\_c   = PQfnumber( pgr, \textcolor{stringliteral}{"dskappa2"});
    dsdist2\_c    = PQfnumber( pgr, \textcolor{stringliteral}{"dsdist2"});
    dsnrg2\_c     = PQfnumber( pgr, \textcolor{stringliteral}{"dsnrg2"});
    cx2\_c        = PQfnumber( pgr, \textcolor{stringliteral}{"cx2"});
    cy2\_c        = PQfnumber( pgr, \textcolor{stringliteral}{"cy2"});
    ax2\_c        = PQfnumber( pgr, \textcolor{stringliteral}{"ax2"});
    ay2\_c        = PQfnumber( pgr, \textcolor{stringliteral}{"ay2"});
    az2\_c        = PQfnumber( pgr, \textcolor{stringliteral}{"az2"});
    active2\_c    = PQfnumber( pgr, \textcolor{stringliteral}{"active2"});
    sindex2\_c    = PQfnumber( pgr, \textcolor{stringliteral}{"sindex2"});
    stype2\_c     = PQfnumber( pgr, \textcolor{stringliteral}{"stype2"});
    
    got\_col\_nums = 1;
  \}


  \textcolor{comment}{//}
  \textcolor{comment}{// NULL string values come back as empty strings}
  \textcolor{comment}{// Mark the null flag but allocate the empty string anyway}
  \textcolor{comment}{//}

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a8dea57b78b92d67d83ccbb6ed6da13ca}{dsdir\_isnull} = PQgetisnull( pgr, 0, 
      dsdir\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ac372e1774a25b3d4bfbb9169762eb39e}{dsdir} != NULL)
    free( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ac372e1774a25b3d4bfbb9169762eb39e}{dsdir});
  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ac372e1774a25b3d4bfbb9169762eb39e}{dsdir} = strdup( PQgetvalue( pgr, 0, dsdir\_c))
      ;

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a7665485395487756ab448d0c81c84d10}{dspid\_isnull} = PQgetisnull( pgr, 0, 
      dspid\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a4487e718c2b55a8ab9ebb18329574ae1}{dspid} != NULL)
    free( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a4487e718c2b55a8ab9ebb18329574ae1}{dspid});
  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a4487e718c2b55a8ab9ebb18329574ae1}{dspid} = strdup( PQgetvalue( pgr, 0, dspid\_c))
      ;

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a51a26391afcacfb4c946fb9e8e9ab6b0}{dsoscaxis\_isnull} = PQgetisnull( 
      pgr, 0, dsoscaxis\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a9a62c304e66013e8e5e5618a44f0b6d4}{dsoscaxis} != NULL)
    free( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a9a62c304e66013e8e5e5618a44f0b6d4}{dsoscaxis});
  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a9a62c304e66013e8e5e5618a44f0b6d4}{dsoscaxis} = strdup( PQgetvalue( pgr, 0, 
      dsoscaxis\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a98e280e99ae847559bb82836df3c32d1}{dsoscaxis2\_isnull} = PQgetisnull( 
      pgr, 0, dsoscaxis2\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ac86005a6e90ff502da9e95b59d0b7a5f}{dsoscaxis2} != NULL)
    free( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ac86005a6e90ff502da9e95b59d0b7a5f}{dsoscaxis2});
  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ac86005a6e90ff502da9e95b59d0b7a5f}{dsoscaxis2} = strdup( PQgetvalue( pgr, 0,
       dsoscaxis2\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a56f32eb413b1fca9f085874eb86294de}{sfn\_isnull} = PQgetisnull(pgr, 0, sfn\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a03252bba597b081edc9d08b20b558cc7}{sfn} != NULL)
    free( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a03252bba597b081edc9d08b20b558cc7}{sfn});
  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a03252bba597b081edc9d08b20b558cc7}{sfn} = strdup( PQgetvalue( pgr, 0, sfn\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a79f48c452a4aca8506bae22f897c7441}{stype\_isnull} = PQgetisnull( pgr, 0, 
      stype\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ab5a70b189c2fe516ca0c84bd06f3e564}{stype} != NULL)
    free( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ab5a70b189c2fe516ca0c84bd06f3e564}{stype});
  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ab5a70b189c2fe516ca0c84bd06f3e564}{stype} = strdup( PQgetvalue( pgr, 0, stype\_c))
      ;

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a203e29ed0bb403aaab6d7f95f690cc0d}{stype2\_isnull} = PQgetisnull( pgr, 0, 
      stype2\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ae08ef74ea76e6e099a3ff6c7f845d337}{stype2} != NULL)
    free( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ae08ef74ea76e6e099a3ff6c7f845d337}{stype2});
  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ae08ef74ea76e6e099a3ff6c7f845d337}{stype2} = strdup( PQgetvalue( pgr, 0, 
      stype2\_c));

  \textcolor{comment}{//}
  \textcolor{comment}{// Probably shouldn't try to convert null number values}
  \textcolor{comment}{//}
  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a5dd3db64790e09bc03499e521bbaa126}{dsowidth\_isnull} = PQgetisnull( pgr,
       0, dsowidth\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a5dd3db64790e09bc03499e521bbaa126}{dsowidth\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ad5a8f568a04aa6a13767933062b28f19}{dsowidth} = atof( PQgetvalue( pgr,0, 
      dsowidth\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ae07498f62ea9c0e2f702b78c87500794}{dsexp\_isnull} = PQgetisnull( pgr, 0, 
      dsexp\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ae07498f62ea9c0e2f702b78c87500794}{dsexp\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a063e4c99201a763c2eb048acfc855efa}{dsexp}    = atof( PQgetvalue( pgr,0, dsexp\_c
      ));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_aa53094de91e2f69d7174ab119df1cdac}{sstart\_isnull} = PQgetisnull( pgr, 0, 
      sstart\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_aa53094de91e2f69d7174ab119df1cdac}{sstart\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a8dc11eaa094d59f61642c4abc226918f}{sstart}   = atof( PQgetvalue( pgr,0, 
      sstart\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a2d1f51cb1bb575a214344773136be878}{dsphi\_isnull} = PQgetisnull( pgr, 0, 
      dsphi\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a2d1f51cb1bb575a214344773136be878}{dsphi\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a64ebde597ca97a3b98145dc2d580c64f}{dsphi}    = atof( PQgetvalue( pgr,0, dsphi\_c
      ));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ad1da3548dc642d415aed53dc165c44fc}{dsomega\_isnull} = PQgetisnull( pgr, 0
      , dsomega\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ad1da3548dc642d415aed53dc165c44fc}{dsomega\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a4be525bb32fb0232c21a91529f1e8c73}{dsomega}  = atof( PQgetvalue( pgr,0, 
      dsomega\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a1686a72509cc1c3383ee95a790ddff14}{dskappa\_isnull} = PQgetisnull( pgr, 0
      , dskappa\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a1686a72509cc1c3383ee95a790ddff14}{dskappa\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a59355281e8eb935cd7bfac597fdc5289}{dskappa}  = atof( PQgetvalue( pgr,0, 
      dskappa\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ac6f2bdc7b023d933509bf74af7b169f9}{dsdist\_isnull} = PQgetisnull( pgr, 0, 
      dsdist\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ac6f2bdc7b023d933509bf74af7b169f9}{dsdist\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_acab9431a911f5bb11296cbfb271fb83a}{dsdist}   = atof( PQgetvalue( pgr,0, 
      dsdist\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ad14d8bb50290ec12e58f4aaec5cc5aab}{dsnrg\_isnull} = PQgetisnull( pgr, 0, 
      dsnrg\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ad14d8bb50290ec12e58f4aaec5cc5aab}{dsnrg\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a371e574055fec7660b8f2e637eaf9f25}{dsnrg}    = atof( PQgetvalue( pgr,0, dsnrg\_c
      ));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a779b99533f0ed4e659177afb0b791ad2}{cx\_isnull} = PQgetisnull( pgr, 0, cx\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a779b99533f0ed4e659177afb0b791ad2}{cx\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ad9eb2013fa6f295f72f0891fe98c863f}{cx}       = atof( PQgetvalue( pgr,0, cx\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a3895d645420848aed05b95694ec8c6c7}{cy\_isnull} = PQgetisnull( pgr, 0, cy\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a3895d645420848aed05b95694ec8c6c7}{cy\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ab7a7b37a17f06c4e9ebdcdf056946098}{cy}       = atof( PQgetvalue( pgr,0, cy\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_aae46c7911b2b218497ad4a68f3dbb7d9}{ax\_isnull} = PQgetisnull( pgr, 0, ax\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_aae46c7911b2b218497ad4a68f3dbb7d9}{ax\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a7f57874223897ab7d9c7531a9522904d}{ax}       = atof( PQgetvalue( pgr,0, ax\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a9da91abc8090532ed98ccd47a3bab775}{ay\_isnull} = PQgetisnull( pgr, 0, ay\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a9da91abc8090532ed98ccd47a3bab775}{ay\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a9e20b9a0aeb41f7f7d653a1c60335bf1}{ay}       = atof( PQgetvalue( pgr,0, ay\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_aaebd6d432810313294b5fed5f4445cb1}{az\_isnull} = PQgetisnull( pgr, 0, az\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_aaebd6d432810313294b5fed5f4445cb1}{az\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a66e678866ce79f6398b66d033ae45a17}{az}       = atof( PQgetvalue( pgr,0, az\_c));
  
  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a9f777671ec617a0f533b3c51f28babb3}{active\_isnull} = PQgetisnull( pgr, 0, 
      active\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a9f777671ec617a0f533b3c51f28babb3}{active\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a1a94eefbad713976a3d9213695a6ca28}{active} = atoi( PQgetvalue( pgr, 0, 
      active\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a7ca4fbc86974d1b75a681ba5ecaaf5af}{sindex\_isnull} = PQgetisnull( pgr, 0, 
      sindex\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a7ca4fbc86974d1b75a681ba5ecaaf5af}{sindex\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a5d096f2c2bf9be29c44129b54eaf01da}{sindex} = atoi( PQgetvalue( pgr, 0, 
      sindex\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_afe16be0382423aa3f25cb3d6cf99430b}{dshpid\_isnull} = PQgetisnull( pgr, 0, 
      dshpid\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_afe16be0382423aa3f25cb3d6cf99430b}{dshpid\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a5e260a420176f2973cdb100d0a5c4c09}{dshpid} = atoi( PQgetvalue( pgr, 0, 
      dshpid\_c));
  
  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_abd3c69357470052eb79ddd8eddd57b2c}{skey\_isnull} = PQgetisnull( pgr, 0, 
      skey\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_abd3c69357470052eb79ddd8eddd57b2c}{skey\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_af64a4e3f17752b5f1f05fb15d6f48382}{skey}   = atoll( PQgetvalue( pgr, 0, skey\_c))
      ;

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a5ffd27b8063506fd54162658e5c2ce8a}{dsowidth2\_isnull} = PQgetisnull( 
      pgr, 0, dsowidth2\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a5ffd27b8063506fd54162658e5c2ce8a}{dsowidth2\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a5378e13735a5392a9fcd853ce8c9e929}{dsowidth2} = atof( PQgetvalue( pgr,0, 
      dsowidth2\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a45091283dc073e5b7da2cfbe5a75fade}{dsexp2\_isnull} = PQgetisnull( pgr, 0, 
      dsexp2\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a45091283dc073e5b7da2cfbe5a75fade}{dsexp2\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a4d8c34309572875352ddabe9cc9001ee}{dsexp2}    = atof( PQgetvalue( pgr,0, 
      dsexp2\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a240c8532d5ce48dbc872d5123a4e721c}{sstart2\_isnull} = PQgetisnull( pgr, 0
      , sstart2\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a240c8532d5ce48dbc872d5123a4e721c}{sstart2\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a8445cbd2206dc6d62b6bd433f5218c98}{sstart2}   = atof( PQgetvalue( pgr,0, 
      sstart2\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a57a9c43be86188f65b96d59c2adec674}{dsphi2\_isnull} = PQgetisnull( pgr, 0, 
      dsphi2\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a57a9c43be86188f65b96d59c2adec674}{dsphi2\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a98857616b6bbb6ba861e96b6b7551756}{dsphi2}    = atof( PQgetvalue( pgr,0, 
      dsphi2\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_afaf9bdf89a68e7f479969072643e55eb}{dsomega2\_isnull} = PQgetisnull( pgr,
       0, dsomega2\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_afaf9bdf89a68e7f479969072643e55eb}{dsomega2\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a84ae35abfa725d1bdbff5403f6384ee4}{dsomega2}  = atof( PQgetvalue( pgr,0, 
      dsomega2\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a9a7e47372f4f6e0e48a0cb3c78fa8437}{dskappa2\_isnull} = PQgetisnull( pgr,
       0, dskappa2\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a9a7e47372f4f6e0e48a0cb3c78fa8437}{dskappa2\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a8571a0b95fb6ea6356fd7204b9c9e371}{dskappa2}  = atof( PQgetvalue( pgr,0, 
      dskappa2\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a7fce65f4719a4a8110006f8b72eec3f7}{dsdist2\_isnull} = PQgetisnull( pgr, 0
      , dsdist2\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a7fce65f4719a4a8110006f8b72eec3f7}{dsdist2\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a516827749068577217b27860a01e6041}{dsdist2}   = atof( PQgetvalue( pgr,0, 
      dsdist2\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_aee9f8196dd9bcea832a60f2f0ea3a999}{dsnrg2\_isnull} = PQgetisnull( pgr, 0, 
      dsnrg2\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_aee9f8196dd9bcea832a60f2f0ea3a999}{dsnrg2\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ae461439c2af31255227765c0fb61850f}{dsnrg2}    = atof( PQgetvalue( pgr,0, 
      dsnrg2\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a3ad947f4efe2cb5c338244b019334749}{cx2\_isnull} = PQgetisnull( pgr, 0, cx2\_c)
      ;
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a3ad947f4efe2cb5c338244b019334749}{cx2\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a10d45763100bc59f9a5f68f1b48db6d3}{cx2}       = atof( PQgetvalue( pgr,0, cx2\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a57d78a389413827302df6ebe3dcb3c89}{cy2\_isnull} = PQgetisnull( pgr, 0, cy2\_c)
      ;
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a57d78a389413827302df6ebe3dcb3c89}{cy2\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a3644e5c3f12af18a3b426d4d4d7e16a5}{cy2}       = atof( PQgetvalue( pgr,0, cy2\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a846845b0b9ecf6517ef85554771ec71d}{ax2\_isnull} = PQgetisnull( pgr, 0, ax2\_c)
      ;
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a846845b0b9ecf6517ef85554771ec71d}{ax2\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ab76bd38d2a098bc7eda82aff5dcb9c66}{ax2}       = atof( PQgetvalue( pgr,0, ax2\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ad0f50ec6339296d3d39c8d95131ab6b5}{ay2\_isnull} = PQgetisnull( pgr, 0, ay2\_c)
      ;
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ad0f50ec6339296d3d39c8d95131ab6b5}{ay2\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ad13759740204b42e379161f98815f3d0}{ay2}       = atof( PQgetvalue( pgr,0, ay2\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a95d080f13a4e02b9aa883821ee3e721c}{az2\_isnull} = PQgetisnull( pgr, 0, az2\_c)
      ;
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a95d080f13a4e02b9aa883821ee3e721c}{az2\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a94698a030fd5b2abf1f10a2ad33476a4}{az2}       = atof( PQgetvalue( pgr,0, az2\_c));
  
  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a1aa11ff4a4c8d69695786b4349e84e6b}{active2\_isnull} = PQgetisnull( pgr, 0
      , active2\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a1aa11ff4a4c8d69695786b4349e84e6b}{active2\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a2875aa18df587806a3d8c05220fd62b5}{active2} = atoi( PQgetvalue( pgr, 0, 
      active2\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a28e0b5c32a2741ef22edeb9d35b04e4d}{sindex2\_isnull} = PQgetisnull( pgr, 0
      , sindex2\_c);
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a28e0b5c32a2741ef22edeb9d35b04e4d}{sindex2\_isnull} == 0)
    \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_ae9d0cfdff6868e0ba9cd5acafbe133db}{sindex2} = atoi( PQgetvalue( pgr, 0, 
      sindex2\_c));

  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_adb8da14444b98f556dba9420dd4666dc}{new\_value\_ready} = 1;

  pthread\_cond\_signal( &(\hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_afc773a9eefc173aa98d5c2889e1d7669}{cond}));
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a38b657155fbee9b73278f76912cf2333}{mutex}));

\}
\end{DoxyCode}
\hypertarget{lspg_8c_a50458a014041a4118452802dfb303960}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-nextshot\-\_\-done@{lspg\-\_\-nextshot\-\_\-done}}
\index{lspg\-\_\-nextshot\-\_\-done@{lspg\-\_\-nextshot\-\_\-done}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-nextshot\-\_\-done}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-nextshot\-\_\-done (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a50458a014041a4118452802dfb303960}


Called when the next shot query has been processed. 



Definition at line 941 of file lspg.\-c.


\begin{DoxyCode}
                          \{
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a38b657155fbee9b73278f76912cf2333}{mutex}));
\}
\end{DoxyCode}
\hypertarget{lspg_8c_aff91db7d60e6c832684c023813e36dbf}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-nextshot\-\_\-init@{lspg\-\_\-nextshot\-\_\-init}}
\index{lspg\-\_\-nextshot\-\_\-init@{lspg\-\_\-nextshot\-\_\-init}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-nextshot\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-nextshot\-\_\-init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_aff91db7d60e6c832684c023813e36dbf}


Initialize the nextshot variable, mutex, and condition. 



Definition at line 915 of file lspg.\-c.


\begin{DoxyCode}
                          \{
  memset( &\hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}, 0, \textcolor{keyword}{sizeof}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}));
  pthread\_mutex\_init( &(\hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a38b657155fbee9b73278f76912cf2333}{mutex}), NULL);
  pthread\_cond\_init( &(\hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_afc773a9eefc173aa98d5c2889e1d7669}{cond}), NULL);
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a784a6de32a86fec9efb3ef3ae4b6e3ac}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-nextshot\-\_\-wait@{lspg\-\_\-nextshot\-\_\-wait}}
\index{lspg\-\_\-nextshot\-\_\-wait@{lspg\-\_\-nextshot\-\_\-wait}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-nextshot\-\_\-wait}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-nextshot\-\_\-wait (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a784a6de32a86fec9efb3ef3ae4b6e3ac}


Wait for the next shot query to get processed. 



Definition at line 933 of file lspg.\-c.


\begin{DoxyCode}
                          \{
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a38b657155fbee9b73278f76912cf2333}{mutex}));
  \textcolor{keywordflow}{while}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_adb8da14444b98f556dba9420dd4666dc}{new\_value\_ready} == 0)
    pthread\_cond\_wait( &(\hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_afc773a9eefc173aa98d5c2889e1d7669}{cond}), &(\hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}
      .\hyperlink{structlspg__nextshot__struct_a38b657155fbee9b73278f76912cf2333}{mutex}));
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a62b110949d206fb22789191207e1d066}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-notice\-\_\-processor@{lspg\-\_\-notice\-\_\-processor}}
\index{lspg\-\_\-notice\-\_\-processor@{lspg\-\_\-notice\-\_\-processor}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-notice\-\_\-processor}]{\setlength{\rightskip}{0pt plus 5cm}P\-Qnotice\-Processor lspg\-\_\-notice\-\_\-processor (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{arg, }
\item[{const char $\ast$}]{msg}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a62b110949d206fb22789191207e1d066}


Definition at line 1629 of file lspg.\-c.


\begin{DoxyCode}
                                                                     \{
  \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspg: %s"}, msg);
  \textcolor{keywordflow}{return} NULL;
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a581c18be0368425665a40b4b7f7d9714}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-pg\-\_\-connect@{lspg\-\_\-pg\-\_\-connect}}
\index{lspg\-\_\-pg\-\_\-connect@{lspg\-\_\-pg\-\_\-connect}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-pg\-\_\-connect}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-pg\-\_\-connect (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a581c18be0368425665a40b4b7f7d9714}


Connect to the pg server. 



Definition at line 1636 of file lspg.\-c.


\begin{DoxyCode}
                       \{
  \textcolor{keywordtype}{int} err;

  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q} == NULL)
    \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} = \hyperlink{lspg_8c_af443092447378c73bf93aa143576aba4}{LS\_PG\_STATE\_INIT};

  \textcolor{keywordflow}{switch}( \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state}) \{
  \textcolor{keywordflow}{case} \hyperlink{lspg_8c_af443092447378c73bf93aa143576aba4}{LS\_PG\_STATE\_INIT}:

    \textcolor{keywordflow}{if}( lspg\_time\_sent.tv\_sec != 0) \{
      \textcolor{comment}{//}
      \textcolor{comment}{// Reality check: if it's less the about 10 seconds since the last failed
       attempt}
      \textcolor{comment}{// the just chill.}
      \textcolor{comment}{//}
      gettimeofday( &\hyperlink{lspg_8c_ad40ac52086f6b774928af45b09d54c6e}{now}, NULL);
      \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_ad40ac52086f6b774928af45b09d54c6e}{now}.tv\_sec - lspg\_time\_sent.tv\_sec < 10) \{
        \textcolor{keywordflow}{return};
      \}
    \}

    \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q} = PQconnectStart( \textcolor{stringliteral}{"dbname=ls user=lsuser hostaddr=10.1.0.3"});
    \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q} == NULL) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Out of memory
       (lspg\_pg\_connect)"});
      exit( -1);
    \}

    err = PQstatus( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q});
    \textcolor{keywordflow}{if}( err == CONNECTION\_BAD) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Trouble connecting to
       database"});

      gettimeofday( &lspg\_time\_sent, NULL);
      \textcolor{keywordflow}{return};
    \}
    err = PQsetnonblocking( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q}, 1);
    \textcolor{keywordflow}{if}( err != 0) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Odd, could not set database
       connection to nonblocking"});
    \}

    \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} = \hyperlink{lspg_8c_ae7ea5876846b5f04c419aee22d3c0aa1}{LS\_PG\_STATE\_INIT\_POLL};
    \hyperlink{lspg_8c_a69ae04978986e6413ca7cefcb692b645}{lspg\_connectPoll\_response} = PGRES\_POLLING\_WRITING;
    \textcolor{comment}{//}
    \textcolor{comment}{// set up the connection for poll}
    \textcolor{comment}{//}
    \hyperlink{lspg_8c_af3f897b8ffa020ca54289bc5b28cb64d}{lspgfd}.fd = PQsocket( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q});
    \textcolor{keywordflow}{break};

  \textcolor{keywordflow}{case} \hyperlink{lspg_8c_ae7ea5876846b5f04c419aee22d3c0aa1}{LS\_PG\_STATE\_INIT\_POLL}:
    \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a69ae04978986e6413ca7cefcb692b645}{lspg\_connectPoll\_response} == 
      PGRES\_POLLING\_FAILED) \{
      PQfinish( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q});
      \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q} = NULL;
      \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} = \hyperlink{lspg_8c_af443092447378c73bf93aa143576aba4}{LS\_PG\_STATE\_INIT};
    \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a69ae04978986e6413ca7cefcb692b645}{lspg\_connectPoll\_response} == 
      PGRES\_POLLING\_OK) \{
      PQsetNoticeProcessor( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q}, (PQnoticeProcessor)\hyperlink{lspg_8c_a62b110949d206fb22789191207e1d066}{lspg\_notice\_processor}
      , NULL);
      \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( NULL, \textcolor{stringliteral}{"select pmac.md2\_init()"});
      \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} = \hyperlink{lspg_8c_aaf1dd8ba4dafb91c296554c4cbf312e3}{LS\_PG\_STATE\_IDLE};
    \}
    \textcolor{keywordflow}{break};

  \textcolor{keywordflow}{case} \hyperlink{lspg_8c_accda8c3a598dc7f5b107b04986d8ab50}{LS\_PG\_STATE\_RESET}:
    err = PQresetStart( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q});
    \textcolor{keywordflow}{if}( err == 0) \{
      PQfinish( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q});
      \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q} = NULL;
      \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} = \hyperlink{lspg_8c_af443092447378c73bf93aa143576aba4}{LS\_PG\_STATE\_INIT};
    \} \textcolor{keywordflow}{else} \{
      \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} = \hyperlink{lspg_8c_ac70a1141f3b138055ea7143bd493187c}{LS\_PG\_STATE\_RESET\_POLL};
      \hyperlink{lspg_8c_a06c5a937e41a6c706a247777642ec1fb}{lspg\_resetPoll\_response} = PGRES\_POLLING\_WRITING;
    \}
    \textcolor{keywordflow}{break};

  \textcolor{keywordflow}{case} \hyperlink{lspg_8c_ac70a1141f3b138055ea7143bd493187c}{LS\_PG\_STATE\_RESET\_POLL}:
    \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a06c5a937e41a6c706a247777642ec1fb}{lspg\_resetPoll\_response} == PGRES\_POLLING\_FAILED)
       \{
      PQfinish( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q});
      \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q} = NULL;
      \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} = \hyperlink{lspg_8c_af443092447378c73bf93aa143576aba4}{LS\_PG\_STATE\_INIT};
    \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a06c5a937e41a6c706a247777642ec1fb}{lspg\_resetPoll\_response} == 
      PGRES\_POLLING\_OK) \{
      \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( NULL, \textcolor{stringliteral}{"select pmac.md2\_init()"});
      \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} = \hyperlink{lspg_8c_aaf1dd8ba4dafb91c296554c4cbf312e3}{LS\_PG\_STATE\_IDLE};
    \}
    \textcolor{keywordflow}{break};
  \}
\}
\end{DoxyCode}
\hypertarget{lspg_8c_aa8d1fed4b461c2139a21826d524777d5}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-pg\-\_\-service@{lspg\-\_\-pg\-\_\-service}}
\index{lspg\-\_\-pg\-\_\-service@{lspg\-\_\-pg\-\_\-service}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-pg\-\_\-service}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-pg\-\_\-service (
\begin{DoxyParamCaption}
\item[{struct pollfd $\ast$}]{evt}
\end{DoxyParamCaption}
)}}\label{lspg_8c_aa8d1fed4b461c2139a21826d524777d5}


I/\-O control to/from the postgresql server. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em evt} & The pollfd object that we are responding to \\
\hline
\end{DoxyParams}


Definition at line 1528 of file lspg.\-c.


\begin{DoxyCode}
                       \{
  \textcolor{comment}{//}
  \textcolor{comment}{// Currently just used to check for notifies}
  \textcolor{comment}{// Other socket communication is done syncronously}
  \textcolor{comment}{//}

  \textcolor{keywordflow}{if}( evt->revents & POLLIN) \{
    \textcolor{keywordtype}{int} err;

    \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} == \hyperlink{lspg_8c_ae7ea5876846b5f04c419aee22d3c0aa1}{LS\_PG\_STATE\_INIT\_POLL}) \{
      \hyperlink{lspg_8c_a69ae04978986e6413ca7cefcb692b645}{lspg\_connectPoll\_response} = PQconnectPoll( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q});
      \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a69ae04978986e6413ca7cefcb692b645}{lspg\_connectPoll\_response} == 
      PGRES\_POLLING\_FAILED) \{
        \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} = \hyperlink{lspg_8c_accda8c3a598dc7f5b107b04986d8ab50}{LS\_PG\_STATE\_RESET};
      \}
      \textcolor{keywordflow}{return};
    \}

    \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} == \hyperlink{lspg_8c_ac70a1141f3b138055ea7143bd493187c}{LS\_PG\_STATE\_RESET\_POLL})
       \{
      \hyperlink{lspg_8c_a06c5a937e41a6c706a247777642ec1fb}{lspg\_resetPoll\_response} = PQresetPoll( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q});
      \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a06c5a937e41a6c706a247777642ec1fb}{lspg\_resetPoll\_response} == 
      PGRES\_POLLING\_FAILED) \{
        \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} = \hyperlink{lspg_8c_accda8c3a598dc7f5b107b04986d8ab50}{LS\_PG\_STATE\_RESET};
      \}
      \textcolor{keywordflow}{return};
    \}


    \textcolor{comment}{//}
    \textcolor{comment}{// if in IDLE or RECV we need to call consumeInput first}
    \textcolor{comment}{//}
    \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} == \hyperlink{lspg_8c_aaf1dd8ba4dafb91c296554c4cbf312e3}{LS\_PG\_STATE\_IDLE}) \{
      err = PQconsumeInput( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q});
      \textcolor{keywordflow}{if}( err != 1) \{
        \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"consume input failed: %s"},
       PQerrorMessage( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q}));
        \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} = \hyperlink{lspg_8c_accda8c3a598dc7f5b107b04986d8ab50}{LS\_PG\_STATE\_RESET};
        \textcolor{keywordflow}{return};
      \}
    \}      

    \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} == \hyperlink{lspg_8c_a373e668840b4795ff9a71bc3f744d209}{LS\_PG\_STATE\_RECV}) \{
      \hyperlink{lspg_8c_a038c5af23469b789fc1c55d21cb43029}{lspg\_receive}();
    \}

    \textcolor{comment}{//}
    \textcolor{comment}{// Check for notifies regardless of our state}
    \textcolor{comment}{// Push as many requests as we have notifies.}
    \textcolor{comment}{//}
    \{
      PGnotify *pgn;

      \textcolor{keywordflow}{while}( 1) \{
        pgn = PQnotifies( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q});
        \textcolor{keywordflow}{if}( pgn == NULL)
          \textcolor{keywordflow}{break};

        \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspg\_pg\_service: notify
       recieved %s"}, pgn->relname);
        
        \textcolor{keywordflow}{if}( strstr( pgn->relname, \textcolor{stringliteral}{"\_pmac"}) != NULL) \{
          \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( \hyperlink{lspg_8c_a1e11f525ca0f9ac9ab71f9fbe983c42b}{lspg\_cmd\_cb}, \textcolor{stringliteral}{"EXEVUTE
       md2\_queue\_next"});
        \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( strstr( pgn->relname, \textcolor{stringliteral}{"\_diff"}) != NULL || strstr( pgn->
      relname, \textcolor{stringliteral}{"\_run"}) != NULL) \{
          \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( \hyperlink{lspg_8c_aeda8dad89b03d7d61cc994dd63ee5db6}{lspg\_nextaction\_cb},
       \textcolor{stringliteral}{"EXECUTE nextaction"});
        \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( strstr( pgn->relname, \textcolor{stringliteral}{"\_sample"}) != NULL) \{
          \hyperlink{lspg_8c_acf98a9e2adec05a69847045f444a5c77}{lspg\_getcurrentsampleid\_call}();
        \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( strstr( pgn->relname, \textcolor{stringliteral}{"\_kvs"}) != NULL) \{
          \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( \hyperlink{lspg_8c_afb8d1ff1e0f4fcdc85ad9c684271cb3d}{lspg\_allkvs\_cb}, \textcolor{stringliteral}{"
      EXECUTE getkvs"});
        \}
        PQfreemem( pgn);
      \}
    \}
  \}

  \textcolor{keywordflow}{if}( evt->revents & POLLOUT) \{

    \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} == \hyperlink{lspg_8c_ae7ea5876846b5f04c419aee22d3c0aa1}{LS\_PG\_STATE\_INIT\_POLL}) \{
      \hyperlink{lspg_8c_a69ae04978986e6413ca7cefcb692b645}{lspg\_connectPoll\_response} = PQconnectPoll( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q});
      \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a69ae04978986e6413ca7cefcb692b645}{lspg\_connectPoll\_response} == 
      PGRES\_POLLING\_FAILED) \{
        \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} = \hyperlink{lspg_8c_accda8c3a598dc7f5b107b04986d8ab50}{LS\_PG\_STATE\_RESET};
      \}
      \textcolor{keywordflow}{return};
    \}

    \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} == \hyperlink{lspg_8c_ac70a1141f3b138055ea7143bd493187c}{LS\_PG\_STATE\_RESET\_POLL})
       \{
      \hyperlink{lspg_8c_a06c5a937e41a6c706a247777642ec1fb}{lspg\_resetPoll\_response} = PQresetPoll( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q});
      \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a06c5a937e41a6c706a247777642ec1fb}{lspg\_resetPoll\_response} == 
      PGRES\_POLLING\_FAILED) \{
        \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} = \hyperlink{lspg_8c_accda8c3a598dc7f5b107b04986d8ab50}{LS\_PG\_STATE\_RESET};
      \}
      \textcolor{keywordflow}{return};
    \}


    \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} == \hyperlink{lspg_8c_a3c6eb19f262a990e1f9ba630d9edc309}{LS\_PG\_STATE\_SEND}) \{
      \hyperlink{lspg_8c_a714b15e117ffe7bfce4f2f2ce4725b0a}{lspg\_send\_next\_query}();
    \}

    \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} == \hyperlink{lspg_8c_a88a7e80c12fb0449c4b0857a0c7deb21}{LS\_PG\_STATE\_SEND\_FLUSH})
       \{
      \hyperlink{lspg_8c_af6485ac1749c5de3008dd0e0badaa09c}{lspg\_flush}();
    \}
  \}
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a69a792e1981af00b2818bcda89bdaa02}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-preset\-\_\-changed\-\_\-cb@{lspg\-\_\-preset\-\_\-changed\-\_\-cb}}
\index{lspg\-\_\-preset\-\_\-changed\-\_\-cb@{lspg\-\_\-preset\-\_\-changed\-\_\-cb}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-preset\-\_\-changed\-\_\-cb}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-preset\-\_\-changed\-\_\-cb (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{event}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a69a792e1981af00b2818bcda89bdaa02}


Definition at line 1846 of file lspg.\-c.


\begin{DoxyCode}
                                          \{
  \textcolor{keyword}{static} \textcolor{keywordtype}{char} base[] = \textcolor{stringliteral}{"Preset Changed "};
  \textcolor{keywordtype}{char} *pn;
  \hyperlink{structlsredis__obj__struct}{lsredis\_obj\_t} *\hyperlink{namespacemk__pgpmac__redis_a11daf2847f2dc94562b5b61b3f412574}{p};
  \textcolor{keywordtype}{char} *\hyperlink{namespacemk__pgpmac__redis_ac732d49b0afca9a9951e3a252bae42fc}{v};

  pn = strstr( event, base);
  \textcolor{keywordflow}{if}( pn == NULL) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspg\_preset\_changed\_cb: Could
       not parse '%s'"}, event);
    \textcolor{keywordflow}{return};
  \}
  pn += strlen( base);
  
  p = \hyperlink{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{lsredis\_get\_obj}( \textcolor{stringliteral}{"%s"}, pn);
  \textcolor{keywordflow}{if}( p == NULL) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspg\_preset\_changed\_cb: Could
       not find variable '%s'"}, pn);
    \textcolor{keywordflow}{return};
  \}
  v = \hyperlink{lsredis_8c_ac1994e56114b2315294527d76311f829}{lsredis\_getstr}( p);
  \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( NULL, \textcolor{stringliteral}{"EXECUTE kvupdate('\{%s,%s\}'::text[])"}, 
      pn, v);
\}
\end{DoxyCode}
\hypertarget{lspg_8c_ad5f3ec8f197cc330c83dba70f310533c}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-query\-\_\-next@{lspg\-\_\-query\-\_\-next}}
\index{lspg\-\_\-query\-\_\-next@{lspg\-\_\-query\-\_\-next}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-query\-\_\-next}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspg\-\_\-query\-\_\-queue\-\_\-t}$\ast$ lspg\-\_\-query\-\_\-next (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_ad5f3ec8f197cc330c83dba70f310533c}


Return the next item in the postgresql queue. 

If there is an item left in the queue then it is returned. Otherwise, N\-U\-L\-L is returned. 

Definition at line 74 of file lspg.\-c.


\begin{DoxyCode}
                                      \{
  \hyperlink{structlspgQueryQueueStruct}{lspg\_query\_queue\_t} *rtn;
  
  pthread\_mutex\_lock( &\hyperlink{lspg_8c_aed46a94106c583796e3a8ca0e89aa8e4}{lspg\_queue\_mutex});

  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_aca86bb77d6cecfae9251743f4171bafb}{lspg\_query\_queue\_off} == \hyperlink{lspg_8c_a3cbe7f3161b3c1838ebc56a3bbcfd8a6}{lspg\_query\_queue\_on}
      )
    \textcolor{comment}{// Queue is empty}
    rtn = NULL;
  \textcolor{keywordflow}{else} \{
    rtn = &(\hyperlink{lspg_8c_a357d9d98f0b8c9625ccebcebfcdce955}{lspg\_query\_queue}[(\hyperlink{lspg_8c_aca86bb77d6cecfae9251743f4171bafb}{lspg\_query\_queue\_off}
      ++) % \hyperlink{lspg_8c_a08fe83fe8226002ee8b80ce0a914fd11}{LS\_PG\_QUERY\_QUEUE\_LENGTH}]); 
    pthread\_cond\_signal( &\hyperlink{lspg_8c_a61a308b6a37afd645beb422653b95baa}{lspg\_queue\_cond});
  \}
  pthread\_mutex\_unlock( &\hyperlink{lspg_8c_aed46a94106c583796e3a8ca0e89aa8e4}{lspg\_queue\_mutex});

  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-query\-\_\-push@{lspg\-\_\-query\-\_\-push}}
\index{lspg\-\_\-query\-\_\-push@{lspg\-\_\-query\-\_\-push}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-query\-\_\-push}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-query\-\_\-push (
\begin{DoxyParamCaption}
\item[{void($\ast$)({\bf lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$, P\-Gresult $\ast$)}]{cb, }
\item[{char $\ast$}]{fmt, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}


Place a query on the queue. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em cb} & Our callback function that deals with the response \\
\hline
\mbox{\tt in}  & {\em fmt} & Printf style function to generate the query \\
\hline
\end{DoxyParams}


Definition at line 127 of file lspg.\-c.


\begin{DoxyCode}
                       \{
  \textcolor{keywordtype}{int} idx;
  va\_list arg\_ptr;

  pthread\_mutex\_lock( &\hyperlink{lspg_8c_aed46a94106c583796e3a8ca0e89aa8e4}{lspg\_queue\_mutex});

  \textcolor{comment}{//}
  \textcolor{comment}{// Pause the thread while we service the queue}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{while}( (\hyperlink{lspg_8c_a3cbe7f3161b3c1838ebc56a3bbcfd8a6}{lspg\_query\_queue\_on} + 1) % \hyperlink{lspg_8c_a08fe83fe8226002ee8b80ce0a914fd11}{
      LS\_PG\_QUERY\_QUEUE\_LENGTH} == \hyperlink{lspg_8c_aca86bb77d6cecfae9251743f4171bafb}{lspg\_query\_queue\_off} % 
      \hyperlink{lspg_8c_a08fe83fe8226002ee8b80ce0a914fd11}{LS\_PG\_QUERY\_QUEUE\_LENGTH}) \{
    pthread\_cond\_wait( &\hyperlink{lspg_8c_a61a308b6a37afd645beb422653b95baa}{lspg\_queue\_cond}, &\hyperlink{lspg_8c_aed46a94106c583796e3a8ca0e89aa8e4}{lspg\_queue\_mutex}
      );
  \}

  idx = \hyperlink{lspg_8c_a3cbe7f3161b3c1838ebc56a3bbcfd8a6}{lspg\_query\_queue\_on} % \hyperlink{lspg_8c_a08fe83fe8226002ee8b80ce0a914fd11}{LS\_PG\_QUERY\_QUEUE\_LENGTH}
      ;

  va\_start( arg\_ptr, fmt);
  vsnprintf( \hyperlink{lspg_8c_a357d9d98f0b8c9625ccebcebfcdce955}{lspg\_query\_queue}[idx].qs, \hyperlink{pgpmac_8h_a3a8ef1b4b5994d6dd12bf74454ea891b}{
      LS\_PG\_QUERY\_STRING\_LENGTH}-1, fmt, arg\_ptr);
  va\_end( arg\_ptr);

  \hyperlink{lspg_8c_a357d9d98f0b8c9625ccebcebfcdce955}{lspg\_query\_queue}[idx].\hyperlink{structlspgQueryQueueStruct_abf8c9c581b38a5e3e269eda69e47de15}{qs}[\hyperlink{pgpmac_8h_a3a8ef1b4b5994d6dd12bf74454ea891b}{LS\_PG\_QUERY\_STRING\_LENGTH}
       - 1] = 0;
  \hyperlink{lspg_8c_a357d9d98f0b8c9625ccebcebfcdce955}{lspg\_query\_queue}[idx].\hyperlink{structlspgQueryQueueStruct_a53bac5ae4cab775423940bff5092a831}{onResponse} = cb;
  \hyperlink{lspg_8c_a3cbe7f3161b3c1838ebc56a3bbcfd8a6}{lspg\_query\_queue\_on}++;

  pthread\_kill( \hyperlink{lspg_8c_a04eb0cda0d5e5afeae7c393b51689765}{lspg\_thread}, SIGUSR1);
  pthread\_mutex\_unlock( &\hyperlink{lspg_8c_aed46a94106c583796e3a8ca0e89aa8e4}{lspg\_queue\_mutex});
\};
\end{DoxyCode}
\hypertarget{lspg_8c_a3847589e641f7e16a0cd68ef30e37cca}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-query\-\_\-reply\-\_\-next@{lspg\-\_\-query\-\_\-reply\-\_\-next}}
\index{lspg\-\_\-query\-\_\-reply\-\_\-next@{lspg\-\_\-query\-\_\-reply\-\_\-next}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-query\-\_\-reply\-\_\-next}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-query\-\_\-reply\-\_\-next (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a3847589e641f7e16a0cd68ef30e37cca}


Remove the oldest item in the queue. 

this is called only when there is nothing else to service the reply\-: this pop does not return anything. We use the ...reply\-\_\-peek function to return the next item in the reply queue 

Definition at line 98 of file lspg.\-c.


\begin{DoxyCode}
                             \{

  pthread\_mutex\_lock( &\hyperlink{lspg_8c_aed46a94106c583796e3a8ca0e89aa8e4}{lspg\_queue\_mutex});

  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a2603b071afdbff7c0924b13de2454264}{lspg\_query\_queue\_reply} != \hyperlink{lspg_8c_a3cbe7f3161b3c1838ebc56a3bbcfd8a6}{lspg\_query\_queue\_on}
      )
    \hyperlink{lspg_8c_a2603b071afdbff7c0924b13de2454264}{lspg\_query\_queue\_reply}++;

  pthread\_mutex\_unlock( &\hyperlink{lspg_8c_aed46a94106c583796e3a8ca0e89aa8e4}{lspg\_queue\_mutex});
\}
\end{DoxyCode}
\hypertarget{lspg_8c_ae6bf4f54117bedf903360883bb32699f}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-query\-\_\-reply\-\_\-peek@{lspg\-\_\-query\-\_\-reply\-\_\-peek}}
\index{lspg\-\_\-query\-\_\-reply\-\_\-peek@{lspg\-\_\-query\-\_\-reply\-\_\-peek}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-query\-\_\-reply\-\_\-peek}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspg\-\_\-query\-\_\-queue\-\_\-t}$\ast$ lspg\-\_\-query\-\_\-reply\-\_\-peek (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_ae6bf4f54117bedf903360883bb32699f}


Return the next item in the reply queue but don't pop it since we may need it more than once. 

Call \hyperlink{lspg_8c_a3847589e641f7e16a0cd68ef30e37cca}{lspg\-\_\-query\-\_\-reply\-\_\-next()} when done. 

Definition at line 111 of file lspg.\-c.


\begin{DoxyCode}
                                            \{
  \hyperlink{structlspgQueryQueueStruct}{lspg\_query\_queue\_t} *rtn;

  pthread\_mutex\_lock( &\hyperlink{lspg_8c_aed46a94106c583796e3a8ca0e89aa8e4}{lspg\_queue\_mutex});

  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_a2603b071afdbff7c0924b13de2454264}{lspg\_query\_queue\_reply} == \hyperlink{lspg_8c_a3cbe7f3161b3c1838ebc56a3bbcfd8a6}{lspg\_query\_queue\_on}
      )
    rtn = NULL;
  \textcolor{keywordflow}{else}
    rtn = &(\hyperlink{lspg_8c_a357d9d98f0b8c9625ccebcebfcdce955}{lspg\_query\_queue}[(\hyperlink{lspg_8c_a2603b071afdbff7c0924b13de2454264}{lspg\_query\_queue\_reply}
      ) % \hyperlink{lspg_8c_a08fe83fe8226002ee8b80ce0a914fd11}{LS\_PG\_QUERY\_QUEUE\_LENGTH}]);

  pthread\_mutex\_unlock( &\hyperlink{lspg_8c_aed46a94106c583796e3a8ca0e89aa8e4}{lspg\_queue\_mutex});
  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a038c5af23469b789fc1c55d21cb43029}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-receive@{lspg\-\_\-receive}}
\index{lspg\-\_\-receive@{lspg\-\_\-receive}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-receive}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-receive (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a038c5af23469b789fc1c55d21cb43029}


Receive a result of a query. 



Definition at line 1445 of file lspg.\-c.


\begin{DoxyCode}
                    \{
  PGresult *pgr;
  \hyperlink{structlspgQueryQueueStruct}{lspg\_query\_queue\_t} *qqp;
  \textcolor{keywordtype}{int} err;

  err = PQconsumeInput( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q});
  \textcolor{keywordflow}{if}( err != 1) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"consume input failed: %s"}, 
      PQerrorMessage( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q}));
    \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} = \hyperlink{lspg_8c_accda8c3a598dc7f5b107b04986d8ab50}{LS\_PG\_STATE\_RESET};
    \textcolor{keywordflow}{return};
  \}

  \textcolor{comment}{//}
  \textcolor{comment}{// We must call PQgetResult until it returns NULL before sending the next
       query}
  \textcolor{comment}{// This implies that only one query can ever be active at a time and our
       queue}
  \textcolor{comment}{// management should be simple}
  \textcolor{comment}{//}
  \textcolor{comment}{// We should be in the LS\_PG\_STATE\_RECV here}
  \textcolor{comment}{//}

  \textcolor{keywordflow}{while}( !PQisBusy( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q})) \{
    pgr = PQgetResult( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q});
    \textcolor{keywordflow}{if}( pgr == NULL) \{
      \hyperlink{lspg_8c_a3847589e641f7e16a0cd68ef30e37cca}{lspg\_query\_reply\_next}();
      \textcolor{comment}{//}
      \textcolor{comment}{// we are now done reading the response from the database}
      \textcolor{comment}{//}
      \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} = \hyperlink{lspg_8c_aaf1dd8ba4dafb91c296554c4cbf312e3}{LS\_PG\_STATE\_IDLE};
      \textcolor{keywordflow}{break};
    \} \textcolor{keywordflow}{else} \{
      ExecStatusType es;

      qqp = \hyperlink{lspg_8c_ae6bf4f54117bedf903360883bb32699f}{lspg\_query\_reply\_peek}();
      es = PQresultStatus( pgr);

      \textcolor{keywordflow}{if}( es != PGRES\_COMMAND\_OK && es != PGRES\_TUPLES\_OK) \{
        \textcolor{keywordtype}{char} *emess;
        emess = PQresultErrorMessage( pgr);
        \textcolor{keywordflow}{if}( emess != NULL && emess[0] != 0) \{
          \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Error from query '%s':\(\backslash\)n
      %s"}, qqp->\hyperlink{structlspgQueryQueueStruct_abf8c9c581b38a5e3e269eda69e47de15}{qs}, emess);
        \}
      \} \textcolor{keywordflow}{else} \{
        \textcolor{comment}{//}
        \textcolor{comment}{// Deal with the response}
        \textcolor{comment}{//}
        \textcolor{comment}{// If the response is likely to take awhile we should probably}
        \textcolor{comment}{// add a new state and put something in the main look to run the
       onResponse}
        \textcolor{comment}{// routine in the main loop.  For now, though, we only expect very
       brief onResponse routines}
        \textcolor{comment}{//}
        \textcolor{keywordflow}{if}( qqp != NULL && qqp->\hyperlink{structlspgQueryQueueStruct_a53bac5ae4cab775423940bff5092a831}{onResponse} != NULL)
          qqp->\hyperlink{structlspgQueryQueueStruct_a53bac5ae4cab775423940bff5092a831}{onResponse}( qqp, pgr);
      \}
      PQclear( pgr);
    \}
  \}
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a1adfdb5ca9fdb5060849d726bf540117}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-run@{lspg\-\_\-run}}
\index{lspg\-\_\-run@{lspg\-\_\-run}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-run}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-run (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a1adfdb5ca9fdb5060849d726bf540117}


Start 'er runnin'. 



Definition at line 1970 of file lspg.\-c.


\begin{DoxyCode}
                \{
  pthread\_create( &\hyperlink{lspg_8c_a04eb0cda0d5e5afeae7c393b51689765}{lspg\_thread}, NULL, \hyperlink{lspg_8c_aaf4fadd2943fa3a2ecb5d840e84d68fa}{lspg\_worker}, NULL);
  \hyperlink{lsevents_8c_ab0617d3f0594b51d10e34bf397096654}{lsevents\_add\_listener}( \textcolor{stringliteral}{"(appy|appz|capy|capz|scint) In
       Position"},        \hyperlink{lspg_8c_a4710c50945fce26b4ac5dc01ed61459d}{lspg\_check\_preset\_in\_position\_cb}
      );
  \hyperlink{lsevents_8c_ab0617d3f0594b51d10e34bf397096654}{lsevents\_add\_listener}( \textcolor{stringliteral}{"(appy|appz|capy|capz|scint)
       Moving"},             \hyperlink{lspg_8c_abcdcee6ef5ed0865056d42a6cf9da8bd}{lspg\_unset\_current\_preset\_moving\_cb}
      );
  \hyperlink{lsevents_8c_ab0617d3f0594b51d10e34bf397096654}{lsevents\_add\_listener}( \textcolor{stringliteral}{"Preset Changed (.+)"},     
      \hyperlink{lspg_8c_a69a792e1981af00b2818bcda89bdaa02}{lspg\_preset\_changed\_cb});
  \hyperlink{lsevents_8c_ab0617d3f0594b51d10e34bf397096654}{lsevents\_add\_listener}( \textcolor{stringliteral}{"Sample(Detected|Absent)"}, 
      \hyperlink{lspg_8c_a14546bac5695b536cd348d5e0a1661fa}{lspg\_sample\_detector\_cb});
  \hyperlink{lsevents_8c_ab0617d3f0594b51d10e34bf397096654}{lsevents\_add\_listener}( \textcolor{stringliteral}{"Timer Update KVs"},        
      \hyperlink{lspg_8c_ad503cefdaee8112ea2129d33db2ec7fa}{lspg\_update\_kvs\_cb});
  \hyperlink{lsevents_8c_ab0617d3f0594b51d10e34bf397096654}{lsevents\_add\_listener}( \textcolor{stringliteral}{"cam.zoom In Position"},    
      \hyperlink{lspg_8c_af61ae1cf46d67e29dfc690b9a98b1b4d}{lspg\_set\_scale\_cb});
  \hyperlink{lstimer_8c_a14f35a979ca0537d8180d90cbc56c577}{lstimer\_add\_timer}(     \textcolor{stringliteral}{"Timer Update KVs"}, -1, 0, 500000000)
      ;
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a14546bac5695b536cd348d5e0a1661fa}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-sample\-\_\-detector\-\_\-cb@{lspg\-\_\-sample\-\_\-detector\-\_\-cb}}
\index{lspg\-\_\-sample\-\_\-detector\-\_\-cb@{lspg\-\_\-sample\-\_\-detector\-\_\-cb}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-sample\-\_\-detector\-\_\-cb}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-sample\-\_\-detector\-\_\-cb (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{event}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a14546bac5695b536cd348d5e0a1661fa}


log magnet state 



Definition at line 1939 of file lspg.\-c.


\begin{DoxyCode}
                                           \{
  \textcolor{keywordtype}{int} present;
  \textcolor{keywordflow}{if}( strcmp( event, \textcolor{stringliteral}{"SampleDetected"}) == 0)
    present = 1;
  \textcolor{keywordflow}{else}
    present = 0;

  \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( NULL, \textcolor{stringliteral}{"SELECT px.logmagnetstate(%s)"}, present
       ? \textcolor{stringliteral}{"TRUE"} : \textcolor{stringliteral}{"FALSE"});
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a714b15e117ffe7bfce4f2f2ce4725b0a}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-send\-\_\-next\-\_\-query@{lspg\-\_\-send\-\_\-next\-\_\-query}}
\index{lspg\-\_\-send\-\_\-next\-\_\-query@{lspg\-\_\-send\-\_\-next\-\_\-query}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-send\-\_\-next\-\_\-query}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-send\-\_\-next\-\_\-query (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a714b15e117ffe7bfce4f2f2ce4725b0a}


send the next queued query to the D\-B server 



Definition at line 1398 of file lspg.\-c.


\begin{DoxyCode}
                            \{
  \textcolor{comment}{//}
  \textcolor{comment}{// Normally we should be in the "send" state}
  \textcolor{comment}{// but we can also send if we are servicing}
  \textcolor{comment}{// a reply}
  \textcolor{comment}{//}

  \hyperlink{structlspgQueryQueueStruct}{lspg\_query\_queue\_t} *qqp;
  \textcolor{keywordtype}{int} err;

  qqp = \hyperlink{lspg_8c_ad5f3ec8f197cc330c83dba70f310533c}{lspg\_query\_next}();
  \textcolor{keywordflow}{if}( qqp == NULL) \{
    \textcolor{comment}{//}
    \textcolor{comment}{// A send without a query?  Should never happen.}
    \textcolor{comment}{// But at least we shouldn't segfault if it does.}
    \textcolor{comment}{//}
    \textcolor{keywordflow}{return};
  \}

  \textcolor{keywordflow}{if}( qqp->\hyperlink{structlspgQueryQueueStruct_abf8c9c581b38a5e3e269eda69e47de15}{qs}[0] == 0) \{
    \textcolor{comment}{//}
    \textcolor{comment}{// Do we really have to check this case?}
    \textcolor{comment}{// It would only come up if we stupidly pushed an empty query string}
    \textcolor{comment}{// or ran off the end of the queue}
    \textcolor{comment}{//}
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Popped empty query string. 
       Probably bad things are going on."});

    \hyperlink{lspg_8c_a3847589e641f7e16a0cd68ef30e37cca}{lspg\_query\_reply\_next}();
    \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} = \hyperlink{lspg_8c_aaf1dd8ba4dafb91c296554c4cbf312e3}{LS\_PG\_STATE\_IDLE};
  \} \textcolor{keywordflow}{else} \{
    err = PQsendQuery( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q}, qqp->\hyperlink{structlspgQueryQueueStruct_abf8c9c581b38a5e3e269eda69e47de15}{qs});
    \textcolor{keywordflow}{if}( err == 0) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"query failed: %s\(\backslash\)n"}, 
      PQerrorMessage( \hyperlink{lspg_8c_a9012783dbbadf652a81649a289697cf3}{q}));

      \textcolor{comment}{//}
      \textcolor{comment}{// Don't wait for a reply, just reset the connection}
      \textcolor{comment}{//}
      \hyperlink{lspg_8c_a3847589e641f7e16a0cd68ef30e37cca}{lspg\_query\_reply\_next}();
      \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} = \hyperlink{lspg_8c_accda8c3a598dc7f5b107b04986d8ab50}{LS\_PG\_STATE\_RESET};
    \} \textcolor{keywordflow}{else} \{
      \hyperlink{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{ls\_pg\_state} = \hyperlink{lspg_8c_a88a7e80c12fb0449c4b0857a0c7deb21}{LS\_PG\_STATE\_SEND\_FLUSH};
    \}
  \}
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a4253474d4dd305aec0afdd5552b3ddd5}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-all@{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-all}}
\index{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-all@{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-all}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-all}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-all (
\begin{DoxyParamCaption}
\item[{long long}]{skey, }
\item[{double}]{kappa, }
\item[{double}]{phi, }
\item[{double}]{cx, }
\item[{double}]{cy, }
\item[{double}]{ax, }
\item[{double}]{ay, }
\item[{double}]{az}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a4253474d4dd305aec0afdd5552b3ddd5}


Convinence function to call seq run prep. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em skey} & px.\-shots key for this image \\
\hline
\mbox{\tt in}  & {\em kappa} & current kappa postion \\
\hline
\mbox{\tt in}  & {\em phi} & current phi postition \\
\hline
\mbox{\tt in}  & {\em cx} & current center table x \\
\hline
\mbox{\tt in}  & {\em cy} & current center table y \\
\hline
\mbox{\tt in}  & {\em ax} & current alignment table x \\
\hline
\mbox{\tt in}  & {\em ay} & current alignment table y \\
\hline
\mbox{\tt in}  & {\em az} & current alignment table z \\
\hline
\end{DoxyParams}


Definition at line 1194 of file lspg.\-c.


\begin{DoxyCode}
                             \{
  \hyperlink{lspg_8c_af7d6efd861b152a371442791deb42bd3}{lspg\_seq\_run\_prep\_call}( skey, \hyperlink{lspmac_8c_a0be79ccb7ebf3a665248fd856112b9fd}{kappa}, \hyperlink{lspmac_8c_ac8070dc568ad974a3db42b51eca828cc}{phi}, cx, 
      cy, ax, ay, az);
  \hyperlink{lspg_8c_ac0b01f501322432a8fa37f31898c3499}{lspg\_seq\_run\_prep\_wait}();
  \hyperlink{lspg_8c_a472b09ddf716c80207f97e2bb5d37d66}{lspg\_seq\_run\_prep\_done}();
\}
\end{DoxyCode}
\hypertarget{lspg_8c_af7d6efd861b152a371442791deb42bd3}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-call@{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-call}}
\index{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-call@{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-call}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-call}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-call (
\begin{DoxyParamCaption}
\item[{long long}]{skey, }
\item[{double}]{kappa, }
\item[{double}]{phi, }
\item[{double}]{cx, }
\item[{double}]{cy, }
\item[{double}]{ax, }
\item[{double}]{ay, }
\item[{double}]{az}
\end{DoxyParamCaption}
)}}\label{lspg_8c_af7d6efd861b152a371442791deb42bd3}


queue up the seq\-\_\-run\-\_\-prep query 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em skey} & px.\-shots key for this image \\
\hline
\mbox{\tt in}  & {\em kappa} & current kappa postion \\
\hline
\mbox{\tt in}  & {\em phi} & current phi postition \\
\hline
\mbox{\tt in}  & {\em cx} & current center table x \\
\hline
\mbox{\tt in}  & {\em cy} & current center table y \\
\hline
\mbox{\tt in}  & {\em ax} & current alignment table x \\
\hline
\mbox{\tt in}  & {\em ay} & current alignment table y \\
\hline
\mbox{\tt in}  & {\em az} & current alignment table z \\
\hline
\end{DoxyParams}


Definition at line 1160 of file lspg.\-c.


\begin{DoxyCode}
                              \{
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_a1b0d9fc30bcea6905b075d2362149172}{lspg\_seq\_run\_prep}.\hyperlink{structlspg__seq__run__prep__struct_ad146cb91b5f7dd8bb283092c28781fe7}{mutex}));
  \hyperlink{lspg_8c_a1b0d9fc30bcea6905b075d2362149172}{lspg\_seq\_run\_prep}.\hyperlink{structlspg__seq__run__prep__struct_a42d08888327e9059ddd69ddfec31b8a9}{new\_value\_ready} = 0;
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_a1b0d9fc30bcea6905b075d2362149172}{lspg\_seq\_run\_prep}.\hyperlink{structlspg__seq__run__prep__struct_ad146cb91b5f7dd8bb283092c28781fe7}{mutex}));

  \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( \hyperlink{lspg_8c_a11cda12050dc9a86188e15e2155a6013}{lspg\_seq\_run\_prep\_cb}, \textcolor{stringliteral}{"
      SELECT px.seq\_run\_prep( %lld, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f)"},
                   skey, \hyperlink{lspmac_8c_a0be79ccb7ebf3a665248fd856112b9fd}{kappa}, \hyperlink{lspmac_8c_ac8070dc568ad974a3db42b51eca828cc}{phi}, cx, cy, ax, ay, az);
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a11cda12050dc9a86188e15e2155a6013}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-cb@{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-cb}}
\index{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-cb@{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-cb}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-cb}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-cb (
\begin{DoxyParamCaption}
\item[{{\bf lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$}]{qqp, }
\item[{P\-Gresult $\ast$}]{pgr}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a11cda12050dc9a86188e15e2155a6013}


Callback for the seq\-\_\-run\-\_\-prep query. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em qqp} & The query item that generated this callback \\
\hline
\mbox{\tt in}  & {\em pgr} & The result of the query \\
\hline
\end{DoxyParams}


Definition at line 1148 of file lspg.\-c.


\begin{DoxyCode}
                            \{
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_a1b0d9fc30bcea6905b075d2362149172}{lspg\_seq\_run\_prep}.\hyperlink{structlspg__seq__run__prep__struct_ad146cb91b5f7dd8bb283092c28781fe7}{mutex}));
  \hyperlink{lspg_8c_a1b0d9fc30bcea6905b075d2362149172}{lspg\_seq\_run\_prep}.\hyperlink{structlspg__seq__run__prep__struct_a42d08888327e9059ddd69ddfec31b8a9}{new\_value\_ready} = 1;
  pthread\_cond\_signal( &(\hyperlink{lspg_8c_a1b0d9fc30bcea6905b075d2362149172}{lspg\_seq\_run\_prep}.\hyperlink{structlspg__seq__run__prep__struct_acd83ea6994f57377716ff01c8ee7ce43}{cond}));
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_a1b0d9fc30bcea6905b075d2362149172}{lspg\_seq\_run\_prep}.\hyperlink{structlspg__seq__run__prep__struct_ad146cb91b5f7dd8bb283092c28781fe7}{mutex}));
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a472b09ddf716c80207f97e2bb5d37d66}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-done@{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-done}}
\index{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-done@{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-done}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-done}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-done (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a472b09ddf716c80207f97e2bb5d37d66}


Indicate we are done waiting. 



Definition at line 1188 of file lspg.\-c.


\begin{DoxyCode}
                              \{
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_a1b0d9fc30bcea6905b075d2362149172}{lspg\_seq\_run\_prep}.\hyperlink{structlspg__seq__run__prep__struct_ad146cb91b5f7dd8bb283092c28781fe7}{mutex}));
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a31823ecb2b44d4a6674f804059a27bce}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-init@{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-init}}
\index{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-init@{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-init}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a31823ecb2b44d4a6674f804059a27bce}


Initialize the data collection object. 



Definition at line 1140 of file lspg.\-c.


\begin{DoxyCode}
                              \{
  \hyperlink{lspg_8c_a1b0d9fc30bcea6905b075d2362149172}{lspg\_seq\_run\_prep}.\hyperlink{structlspg__seq__run__prep__struct_a42d08888327e9059ddd69ddfec31b8a9}{new\_value\_ready} = 0;
  pthread\_mutex\_init( &(\hyperlink{lspg_8c_a1b0d9fc30bcea6905b075d2362149172}{lspg\_seq\_run\_prep}.\hyperlink{structlspg__seq__run__prep__struct_ad146cb91b5f7dd8bb283092c28781fe7}{mutex}), NULL);
  pthread\_cond\_init(  &(\hyperlink{lspg_8c_a1b0d9fc30bcea6905b075d2362149172}{lspg\_seq\_run\_prep}.\hyperlink{structlspg__seq__run__prep__struct_acd83ea6994f57377716ff01c8ee7ce43}{cond}),  NULL);
\}
\end{DoxyCode}
\hypertarget{lspg_8c_ac0b01f501322432a8fa37f31898c3499}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-wait@{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-wait}}
\index{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-wait@{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-wait}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-wait}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-wait (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_ac0b01f501322432a8fa37f31898c3499}


Wait for seq run prep query to return. 



Definition at line 1180 of file lspg.\-c.


\begin{DoxyCode}
                              \{
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_a1b0d9fc30bcea6905b075d2362149172}{lspg\_seq\_run\_prep}.\hyperlink{structlspg__seq__run__prep__struct_ad146cb91b5f7dd8bb283092c28781fe7}{mutex}));
  \textcolor{keywordflow}{while}( \hyperlink{lspg_8c_a1b0d9fc30bcea6905b075d2362149172}{lspg\_seq\_run\_prep}.\hyperlink{structlspg__seq__run__prep__struct_a42d08888327e9059ddd69ddfec31b8a9}{new\_value\_ready} == 0
      )
    pthread\_cond\_wait( &(\hyperlink{lspg_8c_a1b0d9fc30bcea6905b075d2362149172}{lspg\_seq\_run\_prep}.\hyperlink{structlspg__seq__run__prep__struct_acd83ea6994f57377716ff01c8ee7ce43}{cond}), &(
      \hyperlink{lspg_8c_a1b0d9fc30bcea6905b075d2362149172}{lspg\_seq\_run\_prep}.\hyperlink{structlspg__seq__run__prep__struct_ad146cb91b5f7dd8bb283092c28781fe7}{mutex}));
\}
\end{DoxyCode}
\hypertarget{lspg_8c_af61ae1cf46d67e29dfc690b9a98b1b4d}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-set\-\_\-scale\-\_\-cb@{lspg\-\_\-set\-\_\-scale\-\_\-cb}}
\index{lspg\-\_\-set\-\_\-scale\-\_\-cb@{lspg\-\_\-set\-\_\-scale\-\_\-cb}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-set\-\_\-scale\-\_\-cb}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-set\-\_\-scale\-\_\-cb (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{event}
\end{DoxyParamCaption}
)}}\label{lspg_8c_af61ae1cf46d67e29dfc690b9a98b1b4d}


Fix up xscale and yscale when zoom changes. 



Definition at line 1912 of file lspg.\-c.


\begin{DoxyCode}
                                     \{
  \textcolor{keywordtype}{int} mag;
  \hyperlink{structlsredis__obj__struct}{lsredis\_obj\_t} *px, *py;
  \textcolor{keywordtype}{char} *sx, *sy;

  \textcolor{comment}{//}
  \textcolor{comment}{// There is already a call back to set the redis variables xScale and yScale}
  \textcolor{comment}{// we just need to set the KV's}
  \textcolor{comment}{//}

  mag = \hyperlink{lspmac_8c_acc46bdddee59bd8c5ad662b3fd445e9f}{lspmac\_getPosition}( \hyperlink{lspmac_8c_ad53a42cfaa04eff0336a44c8c9986333}{zoom});
  
  px  = \hyperlink{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{lsredis\_get\_obj}( \textcolor{stringliteral}{"cam.zoom.%d.ScaleX"}, mag);
  sx = \hyperlink{lsredis_8c_ac1994e56114b2315294527d76311f829}{lsredis\_getstr}( px);

  py  = \hyperlink{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{lsredis\_get\_obj}( \textcolor{stringliteral}{"cam.zoom.%d.ScaleY"}, mag);
  sy = \hyperlink{lsredis_8c_ac1994e56114b2315294527d76311f829}{lsredis\_getstr}( py);

  \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( NULL, \textcolor{stringliteral}{"EXECUTE kvupdate(
       '\{cam.xScale,%s,cam.yScale,%s\}')"}, sx, sy);
  free( sx);
  free( sy);
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a049f4422994aa2eb2b841ffb2937f895}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-sig\-\_\-service@{lspg\-\_\-sig\-\_\-service}}
\index{lspg\-\_\-sig\-\_\-service@{lspg\-\_\-sig\-\_\-service}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-sig\-\_\-service}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-sig\-\_\-service (
\begin{DoxyParamCaption}
\item[{struct pollfd $\ast$}]{evt}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a049f4422994aa2eb2b841ffb2937f895}


Service a signal Signals here are treated as file descriptors and fits into our poll scheme. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em evt} & The pollfd object that triggered this call \\
\hline
\end{DoxyParams}


Definition at line 1506 of file lspg.\-c.


\begin{DoxyCode}
                        \{
  \textcolor{keyword}{struct }signalfd\_siginfo fdsi;

  \textcolor{comment}{//}
  \textcolor{comment}{// Really, we don't care about the signal,}
  \textcolor{comment}{// it's just used to drop out of the poll}
  \textcolor{comment}{// function when there is something for us}
  \textcolor{comment}{// to do that didn't invovle something coming}
  \textcolor{comment}{// from our postgresql server.}
  \textcolor{comment}{//}
  \textcolor{comment}{// This is accompished by the query\_push function}
  \textcolor{comment}{// to notify us that a new query is ready.}
  \textcolor{comment}{//}

  read( evt->fd, &fdsi, \textcolor{keyword}{sizeof}( \textcolor{keyword}{struct} signalfd\_siginfo));

\}
\end{DoxyCode}
\hypertarget{lspg_8c_a40fed0d8ea49206604ca5727d94b8faf}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-starttransfer\-\_\-all@{lspg\-\_\-starttransfer\-\_\-all}}
\index{lspg\-\_\-starttransfer\-\_\-all@{lspg\-\_\-starttransfer\-\_\-all}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-starttransfer\-\_\-all}]{\setlength{\rightskip}{0pt plus 5cm}int lspg\-\_\-starttransfer\-\_\-all (
\begin{DoxyParamCaption}
\item[{int $\ast$}]{err, }
\item[{unsigned int}]{nextsample, }
\item[{int}]{sampledetected, }
\item[{double}]{ax, }
\item[{double}]{ay, }
\item[{double}]{az, }
\item[{double}]{horz, }
\item[{double}]{vert, }
\item[{double}]{esttime}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a40fed0d8ea49206604ca5727d94b8faf}


Definition at line 421 of file lspg.\-c.


\begin{DoxyCode}
                                                                               
                                                                                     \{
  \textcolor{keywordtype}{int} rtn;

  \hyperlink{lspg_8c_af72c4b037347737df09348ab703f6802}{lspg\_starttransfer\_call}( nextsample, sampledetected, 
      ax, ay, az, horz, vert, esttime);
  \hyperlink{lspg_8c_a189e9fd5cbc06dd09e5549f6e229fa5e}{lspg\_starttransfer\_wait}();
  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_aa384ccd326d9247317f77072b93f94ca}{no\_rows\_returned} || 
      \hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_af01b6bac6db9830719aef63e552312eb}{starttransfer} != 1) \{
    *err = 1;
  \} \textcolor{keywordflow}{else} \{
    *err = 0;
    rtn = \hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_af01b6bac6db9830719aef63e552312eb}{starttransfer};
  \}
  \hyperlink{lspg_8c_ad989179281d8b65b940250a4580007d0}{lspg\_starttransfer\_done}();

  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{lspg_8c_af72c4b037347737df09348ab703f6802}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-starttransfer\-\_\-call@{lspg\-\_\-starttransfer\-\_\-call}}
\index{lspg\-\_\-starttransfer\-\_\-call@{lspg\-\_\-starttransfer\-\_\-call}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-starttransfer\-\_\-call}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-starttransfer\-\_\-call (
\begin{DoxyParamCaption}
\item[{unsigned int}]{nextsample, }
\item[{int}]{sample\-\_\-detected, }
\item[{double}]{ax, }
\item[{double}]{ay, }
\item[{double}]{az, }
\item[{double}]{horz, }
\item[{double}]{vert, }
\item[{double}]{esttime}
\end{DoxyParamCaption}
)}}\label{lspg_8c_af72c4b037347737df09348ab703f6802}


Definition at line 401 of file lspg.\-c.


\begin{DoxyCode}
                                                                               
                                                                              \{
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_a47824bb2701a699d43a7a916e2010705}{mutex}));
  \hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_ad3a6356e5ccce15c982ddecf9634999f}{new\_value\_ready} = 0;
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_a47824bb2701a699d43a7a916e2010705}{mutex}));

  \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( \hyperlink{lspg_8c_a289005bed571909f5ce4de2ff4e70e36}{lspg\_starttransfer\_cb}, \textcolor{stringliteral}{"
      SELECT px.starttransfer( %d, %d, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f"},
                   nextsample, \hyperlink{lspmac_8c_ac59ab990e48033a811aeb0281fb588fc}{sample\_detected}, ax, ay, az, horz
      , vert, esttime);
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a289005bed571909f5ce4de2ff4e70e36}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-starttransfer\-\_\-cb@{lspg\-\_\-starttransfer\-\_\-cb}}
\index{lspg\-\_\-starttransfer\-\_\-cb@{lspg\-\_\-starttransfer\-\_\-cb}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-starttransfer\-\_\-cb}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-starttransfer\-\_\-cb (
\begin{DoxyParamCaption}
\item[{{\bf lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$}]{qqp, }
\item[{P\-Gresult $\ast$}]{pgr}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a289005bed571909f5ce4de2ff4e70e36}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em qqp} & Our nextsample query \\
\hline
\mbox{\tt in}  & {\em pgr} & result of the query \\
\hline
\end{DoxyParams}


Definition at line 380 of file lspg.\-c.


\begin{DoxyCode}
                        \{
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_a47824bb2701a699d43a7a916e2010705}{mutex}));

  \hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_ad3a6356e5ccce15c982ddecf9634999f}{new\_value\_ready} = 1;
  \textcolor{keywordflow}{if}( PQntuples( pgr) <=0) \{
    \hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_aa384ccd326d9247317f77072b93f94ca}{no\_rows\_returned} = 0;
    \hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_af01b6bac6db9830719aef63e552312eb}{starttransfer} = 0;
  \} \textcolor{keywordflow}{else} \{
    \hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_aa384ccd326d9247317f77072b93f94ca}{no\_rows\_returned} = 1;
    \textcolor{keywordflow}{if}( PQgetisnull( pgr, 0, 0) || strtol( PQgetvalue( pgr, 0, 0), NULL, 0) != 
      1)
    \hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_af01b6bac6db9830719aef63e552312eb}{starttransfer} = 0;
  \textcolor{keywordflow}{else}
    \hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_af01b6bac6db9830719aef63e552312eb}{starttransfer} = 1;
  \}
  pthread\_cond\_signal( &(\hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_a1a569a2afabd7910219ff9d2d48c1b38}{cond}));
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_a47824bb2701a699d43a7a916e2010705}{mutex}));
\}
\end{DoxyCode}
\hypertarget{lspg_8c_ad989179281d8b65b940250a4580007d0}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-starttransfer\-\_\-done@{lspg\-\_\-starttransfer\-\_\-done}}
\index{lspg\-\_\-starttransfer\-\_\-done@{lspg\-\_\-starttransfer\-\_\-done}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-starttransfer\-\_\-done}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-starttransfer\-\_\-done (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_ad989179281d8b65b940250a4580007d0}


Definition at line 416 of file lspg.\-c.


\begin{DoxyCode}
                               \{
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_a47824bb2701a699d43a7a916e2010705}{mutex}));
\}
\end{DoxyCode}
\hypertarget{lspg_8c_ab98f7d254fa0f5f4826f9427ca8b4f03}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-starttransfer\-\_\-init@{lspg\-\_\-starttransfer\-\_\-init}}
\index{lspg\-\_\-starttransfer\-\_\-init@{lspg\-\_\-starttransfer\-\_\-init}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-starttransfer\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-starttransfer\-\_\-init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_ab98f7d254fa0f5f4826f9427ca8b4f03}


Definition at line 374 of file lspg.\-c.


\begin{DoxyCode}
                               \{
  \hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_ad3a6356e5ccce15c982ddecf9634999f}{new\_value\_ready} = 0;
  pthread\_mutex\_init( &\hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_a47824bb2701a699d43a7a916e2010705}{mutex}, NULL);
  pthread\_cond\_init( &\hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_a1a569a2afabd7910219ff9d2d48c1b38}{cond}, NULL);
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a189e9fd5cbc06dd09e5549f6e229fa5e}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-starttransfer\-\_\-wait@{lspg\-\_\-starttransfer\-\_\-wait}}
\index{lspg\-\_\-starttransfer\-\_\-wait@{lspg\-\_\-starttransfer\-\_\-wait}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-starttransfer\-\_\-wait}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-starttransfer\-\_\-wait (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a189e9fd5cbc06dd09e5549f6e229fa5e}


Definition at line 410 of file lspg.\-c.


\begin{DoxyCode}
                               \{
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_a47824bb2701a699d43a7a916e2010705}{mutex}));
  \textcolor{keywordflow}{while}( \hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_ad3a6356e5ccce15c982ddecf9634999f}{new\_value\_ready} ==
       0)
    pthread\_cond\_wait( &(\hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_a1a569a2afabd7910219ff9d2d48c1b38}{cond}), &(
      \hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_a47824bb2701a699d43a7a916e2010705}{mutex}));
\}
\end{DoxyCode}
\hypertarget{lspg_8c_abcdcee6ef5ed0865056d42a6cf9da8bd}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-unset\-\_\-current\-\_\-preset\-\_\-moving\-\_\-cb@{lspg\-\_\-unset\-\_\-current\-\_\-preset\-\_\-moving\-\_\-cb}}
\index{lspg\-\_\-unset\-\_\-current\-\_\-preset\-\_\-moving\-\_\-cb@{lspg\-\_\-unset\-\_\-current\-\_\-preset\-\_\-moving\-\_\-cb}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-unset\-\_\-current\-\_\-preset\-\_\-moving\-\_\-cb}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-unset\-\_\-current\-\_\-preset\-\_\-moving\-\_\-cb (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{event}
\end{DoxyParamCaption}
)}}\label{lspg_8c_abcdcee6ef5ed0865056d42a6cf9da8bd}


Definition at line 1889 of file lspg.\-c.


\begin{DoxyCode}
                                                       \{
  \hyperlink{structlspmac__motor__struct}{lspmac\_motor\_t} *mp;
  \textcolor{keywordtype}{char} cp[64];
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};

  \textcolor{keywordflow}{for}( i=0; i<strlen( event); i++) \{
    cp[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}] = 0;
    \textcolor{keywordflow}{if}( event[i] == \textcolor{charliteral}{' '})
      \textcolor{keywordflow}{break};
    cp[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}] = \textcolor{keyword}{event}[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}];
  \}

  mp = \hyperlink{lspmac_8c_a22ef36819bdee963712691e660cfc101}{lspmac\_find\_motor\_by\_name}( cp);
  \textcolor{keywordflow}{if}( mp == NULL) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"
      lspg\_unset\_current\_reset\_moving\_cb: Could not find motor '%s'"}, cp);
    \textcolor{keywordflow}{return};
  \}
  \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( NULL, \textcolor{stringliteral}{"EXECUTE kvupdate(
       '\{%s.currentPreset,-1\}')"}, cp);
\}
\end{DoxyCode}
\hypertarget{lspg_8c_ad503cefdaee8112ea2129d33db2ec7fa}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-update\-\_\-kvs\-\_\-cb@{lspg\-\_\-update\-\_\-kvs\-\_\-cb}}
\index{lspg\-\_\-update\-\_\-kvs\-\_\-cb@{lspg\-\_\-update\-\_\-kvs\-\_\-cb}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-update\-\_\-kvs\-\_\-cb}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-update\-\_\-kvs\-\_\-cb (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{event}
\end{DoxyParamCaption}
)}}\label{lspg_8c_ad503cefdaee8112ea2129d33db2ec7fa}


Perhaps update the px.\-kvs table in postgresql Should be triggered by a timer event. 



Definition at line 317 of file lspg.\-c.


\begin{DoxyCode}
                                      \{
  \textcolor{keyword}{static} \textcolor{keywordtype}{char} s[\hyperlink{pgpmac_8h_a3a8ef1b4b5994d6dd12bf74454ea891b}{LS\_PG\_QUERY\_STRING\_LENGTH} - 64], *fmt;
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}, need\_comma, n;
  \hyperlink{structlspmac__motor__struct}{lspmac\_motor\_t} *mp;
  \textcolor{keywordtype}{int} updateme;
  \textcolor{keywordtype}{double} new\_value;

  s[0] = 0;
  need\_comma = 0;

  \textcolor{keywordflow}{for}( i=0; i<\hyperlink{lspmac_8c_a56260f012c50a591ee7f97e500f16994}{lspmac\_nmotors}; i++ ) \{
    mp = &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}]);
    pthread\_mutex\_lock( &mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex});
    \textcolor{keywordflow}{if}( fabs(mp->\hyperlink{structlspmac__motor__struct_a959bd55eb5c88a30cd4873ea567944d8}{reported\_pg\_position} - mp->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position}
      ) >= \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\_getd}(mp->\hyperlink{structlspmac__motor__struct_aefa84c7592369090eec8b211caaa3a51}{update\_resolution})) \{
      new\_value = mp->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position};
      mp->\hyperlink{structlspmac__motor__struct_a959bd55eb5c88a30cd4873ea567944d8}{reported\_pg\_position} = mp->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position};
      fmt = \hyperlink{lsredis_8c_ac1994e56114b2315294527d76311f829}{lsredis\_getstr}( mp->\hyperlink{structlspmac__motor__struct_a91c38b2072d878b71f4e77de2f1375a4}{redis\_fmt});      \textcolor{comment}{//
       borrow the redis format}
      updateme = 1;
    \} \textcolor{keywordflow}{else} \{
      updateme = 0;
    \}
    pthread\_mutex\_unlock( &mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex});
    \textcolor{keywordflow}{if}( !updateme)
      \textcolor{keywordflow}{continue};
    
    n = strlen( s);
    snprintf( &(s[n]), \textcolor{keyword}{sizeof}(s)-n-1, \textcolor{stringliteral}{"%s%s.position,"}, need\_comma++ ? \textcolor{stringliteral}{","} : \textcolor{stringliteral}{""}
      , mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name});

    n = strlen( s);
    snprintf( &(s[n]), \textcolor{keyword}{sizeof}(s)-n-1, fmt, new\_value);

    \textcolor{comment}{//}
    \textcolor{comment}{// And again for the original remote interface}
    \textcolor{comment}{// We'll be able to remove this, someday}
    \textcolor{comment}{//}
    n = strlen( s);
    snprintf( &(s[n]), \textcolor{keyword}{sizeof}(s)-n-1, \textcolor{stringliteral}{",%s,"},  mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name});

    n = strlen( s);
    snprintf( &(s[n]), \textcolor{keyword}{sizeof}(s)-n-1, fmt, new\_value);
    free( fmt);

    n = strlen( s);
    \textcolor{keywordflow}{if}( n >= \textcolor{keyword}{sizeof}(s) - 64) \{
      \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( NULL, \textcolor{stringliteral}{"EXECUTE kvupdate('\{%s\}')"}, s);
      s[0] = 0;
      need\_comma = 0;
    \}
  \}

  \textcolor{keywordflow}{if}( strlen(s)) \{
    \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( NULL, \textcolor{stringliteral}{"EXECUTE kvupdate('\{%s\}')"}, s);
  \}
\}
\end{DoxyCode}
\hypertarget{lspg_8c_ab9780e15924a50b2a5545e10806000b3}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-all@{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-all}}
\index{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-all@{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-all}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-all}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-all (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_ab9780e15924a50b2a5545e10806000b3}


Combined call to wait for the detector. 



Definition at line 1004 of file lspg.\-c.


\begin{DoxyCode}
                                  \{
  \hyperlink{lspg_8c_a4b5222b859a44eae616804a1e990b86d}{lspg\_wait\_for\_detector\_call}();
  \hyperlink{lspg_8c_af094e01be121ce8e14abb679abd17e19}{lspg\_wait\_for\_detector\_wait}();
  \hyperlink{lspg_8c_abb3645dee7c4514b650ab02f27570a69}{lspg\_wait\_for\_detector\_done}();
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a4b5222b859a44eae616804a1e990b86d}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-call@{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-call}}
\index{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-call@{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-call}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-call}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-call (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a4b5222b859a44eae616804a1e990b86d}


initiate the wait for detector query 



Definition at line 978 of file lspg.\-c.


\begin{DoxyCode}
                                   \{
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_a0dfc8d0410cd2d7f7da7a70d3ef88e58}{lspg\_wait\_for\_detector}.\hyperlink{structlspg__wait__for__detector__struct_a958e9fe59e671e61f95c2ce796ba24ce}{mutex}
      ));
  \hyperlink{lspg_8c_a0dfc8d0410cd2d7f7da7a70d3ef88e58}{lspg\_wait\_for\_detector}.\hyperlink{structlspg__wait__for__detector__struct_ad950e85c70c4473c5c7c40f8ceeae61d}{new\_value\_ready} =
       0;
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_a0dfc8d0410cd2d7f7da7a70d3ef88e58}{lspg\_wait\_for\_detector}.\hyperlink{structlspg__wait__for__detector__struct_a958e9fe59e671e61f95c2ce796ba24ce}{mutex}
      ));
  
  \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( \hyperlink{lspg_8c_a5747c519d1aa4c310010a862cae8a823}{lspg\_wait\_for\_detector\_cb}
      , \textcolor{stringliteral}{"SELECT px.lock\_detector\_test\_block()"});
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a5747c519d1aa4c310010a862cae8a823}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-cb@{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-cb}}
\index{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-cb@{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-cb}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-cb}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-cb (
\begin{DoxyParamCaption}
\item[{{\bf lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$}]{qqp, }
\item[{P\-Gresult $\ast$}]{pgr}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a5747c519d1aa4c310010a862cae8a823}


Callback for the wait for detector query. 



Definition at line 969 of file lspg.\-c.


\begin{DoxyCode}
                                                                        \{
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_a0dfc8d0410cd2d7f7da7a70d3ef88e58}{lspg\_wait\_for\_detector}.\hyperlink{structlspg__wait__for__detector__struct_a958e9fe59e671e61f95c2ce796ba24ce}{mutex}
      ));
  \hyperlink{lspg_8c_a0dfc8d0410cd2d7f7da7a70d3ef88e58}{lspg\_wait\_for\_detector}.\hyperlink{structlspg__wait__for__detector__struct_ad950e85c70c4473c5c7c40f8ceeae61d}{new\_value\_ready} =
       1;
  pthread\_cond\_signal(  &(\hyperlink{lspg_8c_a0dfc8d0410cd2d7f7da7a70d3ef88e58}{lspg\_wait\_for\_detector}.\hyperlink{structlspg__wait__for__detector__struct_aa97388f93ca5099196ba0da1e4a5b7bb}{cond}
      ));
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_a0dfc8d0410cd2d7f7da7a70d3ef88e58}{lspg\_wait\_for\_detector}.\hyperlink{structlspg__wait__for__detector__struct_a958e9fe59e671e61f95c2ce796ba24ce}{mutex}
      ));
\}
\end{DoxyCode}
\hypertarget{lspg_8c_abb3645dee7c4514b650ab02f27570a69}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-done@{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-done}}
\index{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-done@{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-done}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-done}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-done (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_abb3645dee7c4514b650ab02f27570a69}


Done waiting for the detector. 



Definition at line 997 of file lspg.\-c.


\begin{DoxyCode}
                                   \{
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_a0dfc8d0410cd2d7f7da7a70d3ef88e58}{lspg\_wait\_for\_detector}.\hyperlink{structlspg__wait__for__detector__struct_a958e9fe59e671e61f95c2ce796ba24ce}{mutex}
      ));
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a3517f8fbed91c998f6036284f9bd0c48}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-init@{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-init}}
\index{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-init@{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-init}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a3517f8fbed91c998f6036284f9bd0c48}


initialize the detector timing object 



Definition at line 961 of file lspg.\-c.


\begin{DoxyCode}
                                   \{
  \hyperlink{lspg_8c_a0dfc8d0410cd2d7f7da7a70d3ef88e58}{lspg\_wait\_for\_detector}.\hyperlink{structlspg__wait__for__detector__struct_ad950e85c70c4473c5c7c40f8ceeae61d}{new\_value\_ready} =
       0;
  pthread\_mutex\_init( &(\hyperlink{lspg_8c_a0dfc8d0410cd2d7f7da7a70d3ef88e58}{lspg\_wait\_for\_detector}.\hyperlink{structlspg__wait__for__detector__struct_a958e9fe59e671e61f95c2ce796ba24ce}{mutex}
      ), NULL);
  pthread\_cond\_init(  &(\hyperlink{lspg_8c_a0dfc8d0410cd2d7f7da7a70d3ef88e58}{lspg\_wait\_for\_detector}.\hyperlink{structlspg__wait__for__detector__struct_aa97388f93ca5099196ba0da1e4a5b7bb}{cond}),
       NULL);
\}
\end{DoxyCode}
\hypertarget{lspg_8c_af094e01be121ce8e14abb679abd17e19}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-wait@{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-wait}}
\index{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-wait@{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-wait}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-wait}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-wait (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_af094e01be121ce8e14abb679abd17e19}


Pause the calling thread until the detector is ready Called by the M\-D2 thread. 



Definition at line 989 of file lspg.\-c.


\begin{DoxyCode}
                                   \{
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_a0dfc8d0410cd2d7f7da7a70d3ef88e58}{lspg\_wait\_for\_detector}.\hyperlink{structlspg__wait__for__detector__struct_a958e9fe59e671e61f95c2ce796ba24ce}{mutex}
      ));
  \textcolor{keywordflow}{while}( \hyperlink{lspg_8c_a0dfc8d0410cd2d7f7da7a70d3ef88e58}{lspg\_wait\_for\_detector}.\hyperlink{structlspg__wait__for__detector__struct_ad950e85c70c4473c5c7c40f8ceeae61d}{new\_value\_ready}
       == 0)
    pthread\_cond\_wait( &(\hyperlink{lspg_8c_a0dfc8d0410cd2d7f7da7a70d3ef88e58}{lspg\_wait\_for\_detector}.\hyperlink{structlspg__wait__for__detector__struct_aa97388f93ca5099196ba0da1e4a5b7bb}{cond})
      , &(\hyperlink{lspg_8c_a0dfc8d0410cd2d7f7da7a70d3ef88e58}{lspg\_wait\_for\_detector}.\hyperlink{structlspg__wait__for__detector__struct_a958e9fe59e671e61f95c2ce796ba24ce}{mutex}));
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a67a44f70405c8b6a01cec6ac3d166efb}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-waitcryo\-\_\-all@{lspg\-\_\-waitcryo\-\_\-all}}
\index{lspg\-\_\-waitcryo\-\_\-all@{lspg\-\_\-waitcryo\-\_\-all}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-waitcryo\-\_\-all}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-waitcryo\-\_\-all (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a67a44f70405c8b6a01cec6ac3d166efb}


no need to get fancy with the wait cryo command It should not return until the robot is almost ready for air rights 



Definition at line 606 of file lspg.\-c.


\begin{DoxyCode}
                         \{
  pthread\_mutex\_lock( &\hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}.\hyperlink{structlspg__waitcryo__struct_a62b50ead380fc8a6be35956eba384ba6}{mutex});
  \hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}.\hyperlink{structlspg__waitcryo__struct_a97298b773fd8c1f2ef20159093a08246}{new\_value\_ready} = 0;

  \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( \hyperlink{lspg_8c_a7497a7c924b31c727ea487a3efb77fb6}{lspg\_waitcryo\_cb}, \textcolor{stringliteral}{"SELECT
       px.waitcryo())"});

  \textcolor{keywordflow}{while}( \hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}.\hyperlink{structlspg__waitcryo__struct_a97298b773fd8c1f2ef20159093a08246}{new\_value\_ready} == 0)
    pthread\_cond\_wait( &\hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}.\hyperlink{structlspg__waitcryo__struct_a54c275159d9f096e0d1884e64d099298}{cond}, &\hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}
      .\hyperlink{structlspg__waitcryo__struct_a62b50ead380fc8a6be35956eba384ba6}{mutex});

  pthread\_mutex\_unlock( &\hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}.\hyperlink{structlspg__waitcryo__struct_a62b50ead380fc8a6be35956eba384ba6}{mutex});
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a7497a7c924b31c727ea487a3efb77fb6}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-waitcryo\-\_\-cb@{lspg\-\_\-waitcryo\-\_\-cb}}
\index{lspg\-\_\-waitcryo\-\_\-cb@{lspg\-\_\-waitcryo\-\_\-cb}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-waitcryo\-\_\-cb}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-waitcryo\-\_\-cb (
\begin{DoxyParamCaption}
\item[{{\bf lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$}]{qqp, }
\item[{P\-Gresult $\ast$}]{pgr}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a7497a7c924b31c727ea487a3efb77fb6}


Definition at line 596 of file lspg.\-c.


\begin{DoxyCode}
                                                               \{
  pthread\_mutex\_lock( &\hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}.\hyperlink{structlspg__waitcryo__struct_a62b50ead380fc8a6be35956eba384ba6}{mutex});
  \hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}.\hyperlink{structlspg__waitcryo__struct_a97298b773fd8c1f2ef20159093a08246}{new\_value\_ready} = 1;
  pthread\_cond\_signal( &\hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}.\hyperlink{structlspg__waitcryo__struct_a54c275159d9f096e0d1884e64d099298}{cond});
  pthread\_mutex\_unlock( &\hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}.\hyperlink{structlspg__waitcryo__struct_a62b50ead380fc8a6be35956eba384ba6}{mutex});
\}
\end{DoxyCode}
\hypertarget{lspg_8c_a32b2bf00d66ee5fca130ee616a09cf7b}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-waitcryo\-\_\-init@{lspg\-\_\-waitcryo\-\_\-init}}
\index{lspg\-\_\-waitcryo\-\_\-init@{lspg\-\_\-waitcryo\-\_\-init}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-waitcryo\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-waitcryo\-\_\-init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspg_8c_a32b2bf00d66ee5fca130ee616a09cf7b}


Definition at line 590 of file lspg.\-c.


\begin{DoxyCode}
                          \{
  \hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}.\hyperlink{structlspg__waitcryo__struct_a97298b773fd8c1f2ef20159093a08246}{new\_value\_ready} = 0;
  pthread\_mutex\_init( &\hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}.\hyperlink{structlspg__waitcryo__struct_a62b50ead380fc8a6be35956eba384ba6}{mutex}, NULL);
  pthread\_cond\_init( &\hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}.\hyperlink{structlspg__waitcryo__struct_a54c275159d9f096e0d1884e64d099298}{cond}, NULL);
\}
\end{DoxyCode}
\hypertarget{lspg_8c_aaf4fadd2943fa3a2ecb5d840e84d68fa}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-worker@{lspg\-\_\-worker}}
\index{lspg\-\_\-worker@{lspg\-\_\-worker}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-worker}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ lspg\-\_\-worker (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{dummy}
\end{DoxyParamCaption}
)}}\label{lspg_8c_aaf4fadd2943fa3a2ecb5d840e84d68fa}


The main loop for the lspg thread. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em dummy} & Required by pthreads but unused \\
\hline
\end{DoxyParams}


Definition at line 1776 of file lspg.\-c.


\begin{DoxyCode}
                    \{
  \textcolor{keyword}{static} \textcolor{keyword}{struct }pollfd fda[2];  \textcolor{comment}{// 0=signal handler, 1=pg socket}
  \textcolor{keyword}{static} \textcolor{keywordtype}{int} nfda = 0;
  \textcolor{keyword}{static} sigset\_t our\_sigset;

  \textcolor{comment}{//}
  \textcolor{comment}{// block ordinary signal mechanism}
  \textcolor{comment}{//}
  sigemptyset( &our\_sigset);
  sigaddset( &our\_sigset, SIGUSR1);
  pthread\_sigmask(SIG\_BLOCK, &our\_sigset, NULL);

    
  fda[0].fd = signalfd( -1, &our\_sigset, SFD\_NONBLOCK);
  \textcolor{keywordflow}{if}( fda[0].fd == -1) \{
    \textcolor{keywordtype}{char} *es;

    es = strerror( errno);
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Signalfd trouble: %s"}, es);
  \}
  fda[0].events = POLLIN;

  \textcolor{comment}{//}
  \textcolor{comment}{//  make sure file descriptor is not legal until it's been conneceted}
  \textcolor{comment}{//}
  \hyperlink{lspg_8c_af3f897b8ffa020ca54289bc5b28cb64d}{lspgfd}.fd   = -1;


  \textcolor{keywordflow}{while}( 1) \{
    \textcolor{keywordtype}{int} pollrtn;
    \textcolor{keywordtype}{int} poll\_timeout\_ms;

   \hyperlink{lspg_8c_ab52a8c8245bf6561f40c0f224fc07ff4}{lspg\_next\_state}();

    \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_af3f897b8ffa020ca54289bc5b28cb64d}{lspgfd}.fd == -1) \{
      \textcolor{comment}{//}
      \textcolor{comment}{// Here a connection to the database is not established.}
      \textcolor{comment}{// Periodicaly try again.  Should possibly arrange to reconnect}
      \textcolor{comment}{// to signalfd but that's unlikely to be nessesary.}
      \textcolor{comment}{//}
      nfda = 1;
      poll\_timeout\_ms = 10000;
      fda[1].revents = 0;
    \} \textcolor{keywordflow}{else} \{
      \textcolor{comment}{//}
      \textcolor{comment}{// Arrange to peacfully do nothing until either the pg server sends us
       something}
      \textcolor{comment}{// or someone pushs something onto our queue}
      \textcolor{comment}{//}
      nfda = 2;
      fda[1].fd      = \hyperlink{lspg_8c_af3f897b8ffa020ca54289bc5b28cb64d}{lspgfd}.fd;
      fda[1].events  = \hyperlink{lspg_8c_af3f897b8ffa020ca54289bc5b28cb64d}{lspgfd}.events;
      fda[1].revents = 0;
      poll\_timeout\_ms = -1;
    \}

    pollrtn = poll( fda, nfda, poll\_timeout\_ms);

    \textcolor{keywordflow}{if}( pollrtn && fda[0].revents) \{
      \hyperlink{lspg_8c_a049f4422994aa2eb2b841ffb2937f895}{lspg\_sig\_service}( &(fda[0]));
      pollrtn--;
    \} 
    \textcolor{keywordflow}{if}( pollrtn && fda[1].revents) \{
      \hyperlink{lspg_8c_aa8d1fed4b461c2139a21826d524777d5}{lspg\_pg\_service}( &(fda[1]));
      pollrtn--;
    \} 
  \}
\}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}{\index{lspg.\-c@{lspg.\-c}!ls\-\_\-pg\-\_\-state@{ls\-\_\-pg\-\_\-state}}
\index{ls\-\_\-pg\-\_\-state@{ls\-\_\-pg\-\_\-state}!lspg.c@{lspg.\-c}}
\subsubsection[{ls\-\_\-pg\-\_\-state}]{\setlength{\rightskip}{0pt plus 5cm}int ls\-\_\-pg\-\_\-state = {\bf L\-S\-\_\-\-P\-G\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-N\-I\-T}\hspace{0.3cm}{\ttfamily [static]}}}\label{lspg_8c_a4937baac0cc78ea306d58b5f027867f1}


State of the lspg state machine. 



Definition at line 38 of file lspg.\-c.

\hypertarget{lspg_8c_a69ae04978986e6413ca7cefcb692b645}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-connect\-Poll\-\_\-response@{lspg\-\_\-connect\-Poll\-\_\-response}}
\index{lspg\-\_\-connect\-Poll\-\_\-response@{lspg\-\_\-connect\-Poll\-\_\-response}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-connect\-Poll\-\_\-response}]{\setlength{\rightskip}{0pt plus 5cm}Postgres\-Polling\-Status\-Type lspg\-\_\-connect\-Poll\-\_\-response\hspace{0.3cm}{\ttfamily [static]}}}\label{lspg_8c_a69ae04978986e6413ca7cefcb692b645}


Used to determine state while connecting. 



Definition at line 59 of file lspg.\-c.

\hypertarget{lspg_8c_adf89a0299edd6a99992b95dff8992eba}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-demandairrights@{lspg\-\_\-demandairrights}}
\index{lspg\-\_\-demandairrights@{lspg\-\_\-demandairrights}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-demandairrights}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspg\-\_\-demandairrights\-\_\-t} lspg\-\_\-demandairrights}}\label{lspg_8c_adf89a0299edd6a99992b95dff8992eba}


our demandairrights object 



Definition at line 65 of file lspg.\-c.

\hypertarget{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-getcenter@{lspg\-\_\-getcenter}}
\index{lspg\-\_\-getcenter@{lspg\-\_\-getcenter}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-getcenter}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspg\-\_\-getcenter\-\_\-t} lspg\-\_\-getcenter}}\label{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}


the getcenter object 



Definition at line 64 of file lspg.\-c.

\hypertarget{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-getcurrentsampleid@{lspg\-\_\-getcurrentsampleid}}
\index{lspg\-\_\-getcurrentsampleid@{lspg\-\_\-getcurrentsampleid}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-getcurrentsampleid}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspg\-\_\-getcurrentsampleid\-\_\-t} lspg\-\_\-getcurrentsampleid}}\label{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}


our currentsample id 



Definition at line 66 of file lspg.\-c.

\hypertarget{lspg_8c_adbf3b3652c6531c3d194320d1abc1c80}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-lock\-\_\-detector@{lspg\-\_\-lock\-\_\-detector}}
\index{lspg\-\_\-lock\-\_\-detector@{lspg\-\_\-lock\-\_\-detector}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-lock\-\_\-detector}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspg\-\_\-lock\-\_\-detector\-\_\-t} lspg\-\_\-lock\-\_\-detector\hspace{0.3cm}{\ttfamily [static]}}}\label{lspg_8c_adbf3b3652c6531c3d194320d1abc1c80}


Definition at line 1078 of file lspg.\-c.

\hypertarget{lspg_8c_aaae7ce3ecd7d54a9e46c41d7a742a454}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-lock\-\_\-diffractometer@{lspg\-\_\-lock\-\_\-diffractometer}}
\index{lspg\-\_\-lock\-\_\-diffractometer@{lspg\-\_\-lock\-\_\-diffractometer}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-lock\-\_\-diffractometer}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspg\-\_\-lock\-\_\-diffractometer\-\_\-t} lspg\-\_\-lock\-\_\-diffractometer\hspace{0.3cm}{\ttfamily [static]}}}\label{lspg_8c_aaae7ce3ecd7d54a9e46c41d7a742a454}


Definition at line 1019 of file lspg.\-c.

\hypertarget{lspg_8c_adbf70f382e469e02dce77833981f9547}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-nextsample@{lspg\-\_\-nextsample}}
\index{lspg\-\_\-nextsample@{lspg\-\_\-nextsample}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-nextsample}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspg\-\_\-nextsample\-\_\-t} lspg\-\_\-nextsample}}\label{lspg_8c_adbf70f382e469e02dce77833981f9547}


the very next sample 



Definition at line 62 of file lspg.\-c.

\hypertarget{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-nextshot@{lspg\-\_\-nextshot}}
\index{lspg\-\_\-nextshot@{lspg\-\_\-nextshot}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-nextshot}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspg\-\_\-nextshot\-\_\-t} lspg\-\_\-nextshot}}\label{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}


the nextshot object 



Definition at line 63 of file lspg.\-c.

\hypertarget{lspg_8c_a357d9d98f0b8c9625ccebcebfcdce955}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-query\-\_\-queue@{lspg\-\_\-query\-\_\-queue}}
\index{lspg\-\_\-query\-\_\-queue@{lspg\-\_\-query\-\_\-queue}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-query\-\_\-queue}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspg\-\_\-query\-\_\-queue\-\_\-t} lspg\-\_\-query\-\_\-queue\mbox{[}{\bf L\-S\-\_\-\-P\-G\-\_\-\-Q\-U\-E\-R\-Y\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H}\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}}\label{lspg_8c_a357d9d98f0b8c9625ccebcebfcdce955}


Our query queue. 



Definition at line 51 of file lspg.\-c.

\hypertarget{lspg_8c_aca86bb77d6cecfae9251743f4171bafb}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-query\-\_\-queue\-\_\-off@{lspg\-\_\-query\-\_\-queue\-\_\-off}}
\index{lspg\-\_\-query\-\_\-queue\-\_\-off@{lspg\-\_\-query\-\_\-queue\-\_\-off}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-query\-\_\-queue\-\_\-off}]{\setlength{\rightskip}{0pt plus 5cm}unsigned int lspg\-\_\-query\-\_\-queue\-\_\-off = 0\hspace{0.3cm}{\ttfamily [static]}}}\label{lspg_8c_aca86bb77d6cecfae9251743f4171bafb}


The last item still being used (on == off means nothing in queue) 



Definition at line 53 of file lspg.\-c.

\hypertarget{lspg_8c_a3cbe7f3161b3c1838ebc56a3bbcfd8a6}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-query\-\_\-queue\-\_\-on@{lspg\-\_\-query\-\_\-queue\-\_\-on}}
\index{lspg\-\_\-query\-\_\-queue\-\_\-on@{lspg\-\_\-query\-\_\-queue\-\_\-on}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-query\-\_\-queue\-\_\-on}]{\setlength{\rightskip}{0pt plus 5cm}unsigned int lspg\-\_\-query\-\_\-queue\-\_\-on = 0\hspace{0.3cm}{\ttfamily [static]}}}\label{lspg_8c_a3cbe7f3161b3c1838ebc56a3bbcfd8a6}


Next position to add something to the queue. 



Definition at line 52 of file lspg.\-c.

\hypertarget{lspg_8c_a2603b071afdbff7c0924b13de2454264}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-query\-\_\-queue\-\_\-reply@{lspg\-\_\-query\-\_\-queue\-\_\-reply}}
\index{lspg\-\_\-query\-\_\-queue\-\_\-reply@{lspg\-\_\-query\-\_\-queue\-\_\-reply}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-query\-\_\-queue\-\_\-reply}]{\setlength{\rightskip}{0pt plus 5cm}unsigned int lspg\-\_\-query\-\_\-queue\-\_\-reply = 0\hspace{0.3cm}{\ttfamily [static]}}}\label{lspg_8c_a2603b071afdbff7c0924b13de2454264}


The current item being digested. 

Normally off $<$= reply $<$= on. Corner case of queue wrap arround works because we only increment and compare for equality. 

Definition at line 54 of file lspg.\-c.

\hypertarget{lspg_8c_a61a308b6a37afd645beb422653b95baa}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-queue\-\_\-cond@{lspg\-\_\-queue\-\_\-cond}}
\index{lspg\-\_\-queue\-\_\-cond@{lspg\-\_\-queue\-\_\-cond}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-queue\-\_\-cond}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-cond\-\_\-t lspg\-\_\-queue\-\_\-cond\hspace{0.3cm}{\ttfamily [static]}}}\label{lspg_8c_a61a308b6a37afd645beb422653b95baa}


keeps the queue from overflowing 



Definition at line 43 of file lspg.\-c.

\hypertarget{lspg_8c_aed46a94106c583796e3a8ca0e89aa8e4}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-queue\-\_\-mutex@{lspg\-\_\-queue\-\_\-mutex}}
\index{lspg\-\_\-queue\-\_\-mutex@{lspg\-\_\-queue\-\_\-mutex}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-queue\-\_\-mutex}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-mutex\-\_\-t lspg\-\_\-queue\-\_\-mutex\hspace{0.3cm}{\ttfamily [static]}}}\label{lspg_8c_aed46a94106c583796e3a8ca0e89aa8e4}


keep the queue from getting tangled 



Definition at line 42 of file lspg.\-c.

\hypertarget{lspg_8c_a06c5a937e41a6c706a247777642ec1fb}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-reset\-Poll\-\_\-response@{lspg\-\_\-reset\-Poll\-\_\-response}}
\index{lspg\-\_\-reset\-Poll\-\_\-response@{lspg\-\_\-reset\-Poll\-\_\-response}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-reset\-Poll\-\_\-response}]{\setlength{\rightskip}{0pt plus 5cm}Postgres\-Polling\-Status\-Type lspg\-\_\-reset\-Poll\-\_\-response\hspace{0.3cm}{\ttfamily [static]}}}\label{lspg_8c_a06c5a937e41a6c706a247777642ec1fb}


Used to determine state while reconnecting. 



Definition at line 60 of file lspg.\-c.

\hypertarget{lspg_8c_a1b0d9fc30bcea6905b075d2362149172}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-seq\-\_\-run\-\_\-prep@{lspg\-\_\-seq\-\_\-run\-\_\-prep}}
\index{lspg\-\_\-seq\-\_\-run\-\_\-prep@{lspg\-\_\-seq\-\_\-run\-\_\-prep}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-seq\-\_\-run\-\_\-prep}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-t} lspg\-\_\-seq\-\_\-run\-\_\-prep\hspace{0.3cm}{\ttfamily [static]}}}\label{lspg_8c_a1b0d9fc30bcea6905b075d2362149172}


Definition at line 1136 of file lspg.\-c.

\hypertarget{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-starttransfer@{lspg\-\_\-starttransfer}}
\index{lspg\-\_\-starttransfer@{lspg\-\_\-starttransfer}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-starttransfer}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspg\-\_\-starttransfer\-\_\-t} lspg\-\_\-starttransfer}}\label{lspg_8c_af18499d17171eff473cfc49d4a0a5562}


start a sample transfer 



Definition at line 67 of file lspg.\-c.

\hypertarget{lspg_8c_a04eb0cda0d5e5afeae7c393b51689765}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-thread@{lspg\-\_\-thread}}
\index{lspg\-\_\-thread@{lspg\-\_\-thread}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-thread}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-t lspg\-\_\-thread\hspace{0.3cm}{\ttfamily [static]}}}\label{lspg_8c_a04eb0cda0d5e5afeae7c393b51689765}


our worker thread 



Definition at line 41 of file lspg.\-c.

\hypertarget{lspg_8c_a0dfc8d0410cd2d7f7da7a70d3ef88e58}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-wait\-\_\-for\-\_\-detector@{lspg\-\_\-wait\-\_\-for\-\_\-detector}}
\index{lspg\-\_\-wait\-\_\-for\-\_\-detector@{lspg\-\_\-wait\-\_\-for\-\_\-detector}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-wait\-\_\-for\-\_\-detector}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspg\-\_\-wait\-\_\-for\-\_\-detector\-\_\-t} lspg\-\_\-wait\-\_\-for\-\_\-detector\hspace{0.3cm}{\ttfamily [static]}}}\label{lspg_8c_a0dfc8d0410cd2d7f7da7a70d3ef88e58}


Instance of the detector timing object. 



Definition at line 957 of file lspg.\-c.

\hypertarget{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{\index{lspg.\-c@{lspg.\-c}!lspg\-\_\-waitcryo@{lspg\-\_\-waitcryo}}
\index{lspg\-\_\-waitcryo@{lspg\-\_\-waitcryo}!lspg.c@{lspg.\-c}}
\subsubsection[{lspg\-\_\-waitcryo}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspg\-\_\-waitcryo\-\_\-t} lspg\-\_\-waitcryo}}\label{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}


signal the robot 



Definition at line 68 of file lspg.\-c.

\hypertarget{lspg_8c_af3f897b8ffa020ca54289bc5b28cb64d}{\index{lspg.\-c@{lspg.\-c}!lspgfd@{lspgfd}}
\index{lspgfd@{lspgfd}!lspg.c@{lspg.\-c}}
\subsubsection[{lspgfd}]{\setlength{\rightskip}{0pt plus 5cm}struct pollfd lspgfd\hspace{0.3cm}{\ttfamily [static]}}}\label{lspg_8c_af3f897b8ffa020ca54289bc5b28cb64d}


our poll info 



Definition at line 44 of file lspg.\-c.

\hypertarget{lspg_8c_ad40ac52086f6b774928af45b09d54c6e}{\index{lspg.\-c@{lspg.\-c}!now@{now}}
\index{now@{now}!lspg.c@{lspg.\-c}}
\subsubsection[{now}]{\setlength{\rightskip}{0pt plus 5cm}struct timeval lspg\-\_\-time\-\_\-sent now\hspace{0.3cm}{\ttfamily [static]}}}\label{lspg_8c_ad40ac52086f6b774928af45b09d54c6e}


used to ensure we do not inundate the db server with connection requests 



Definition at line 39 of file lspg.\-c.

\hypertarget{lspg_8c_a9012783dbbadf652a81649a289697cf3}{\index{lspg.\-c@{lspg.\-c}!q@{q}}
\index{q@{q}!lspg.c@{lspg.\-c}}
\subsubsection[{q}]{\setlength{\rightskip}{0pt plus 5cm}P\-Gconn$\ast$ q = N\-U\-L\-L\hspace{0.3cm}{\ttfamily [static]}}}\label{lspg_8c_a9012783dbbadf652a81649a289697cf3}


Database connector. 



Definition at line 58 of file lspg.\-c.

