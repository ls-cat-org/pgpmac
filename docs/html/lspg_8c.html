<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LS-CAT PGPMAC: lspg.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LS-CAT PGPMAC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lspg_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">lspg.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Postgresql support for the LS-CAT pgpmac project.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="pgpmac_8h_source.html">pgpmac.h</a>&quot;</code><br/>
</div>
<p><a href="lspg_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlspg__wait__for__detector__struct.html">lspg_wait_for_detector_struct</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Object that implements detector / spindle timing We use database locks for exposure control and this implements the md2 portion of this handshake.  <a href="structlspg__wait__for__detector__struct.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlspg__lock__diffractometer__struct.html">lspg_lock_diffractometer_struct</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Object used to impliment locking the diffractometer Critical to exposure timing.  <a href="structlspg__lock__diffractometer__struct.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlspg__lock__detector__struct.html">lspg_lock_detector_struct</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">lock detector object Implements detector lock for exposure control  <a href="structlspg__lock__detector__struct.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlspg__seq__run__prep__struct.html">lspg_seq_run_prep_struct</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Data collection running object.  <a href="structlspg__seq__run__prep__struct.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:af443092447378c73bf93aa143576aba4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a>&#160;&#160;&#160;-4</td></tr>
<tr class="separator:af443092447378c73bf93aa143576aba4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7ea5876846b5f04c419aee22d3c0aa1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ae7ea5876846b5f04c419aee22d3c0aa1">LS_PG_STATE_INIT_POLL</a>&#160;&#160;&#160;-3</td></tr>
<tr class="separator:ae7ea5876846b5f04c419aee22d3c0aa1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:accda8c3a598dc7f5b107b04986d8ab50"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>&#160;&#160;&#160;-2</td></tr>
<tr class="separator:accda8c3a598dc7f5b107b04986d8ab50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac70a1141f3b138055ea7143bd493187c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ac70a1141f3b138055ea7143bd493187c">LS_PG_STATE_RESET_POLL</a>&#160;&#160;&#160;-1</td></tr>
<tr class="separator:ac70a1141f3b138055ea7143bd493187c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf1dd8ba4dafb91c296554c4cbf312e3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:aaf1dd8ba4dafb91c296554c4cbf312e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c6eb19f262a990e1f9ba630d9edc309"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a3c6eb19f262a990e1f9ba630d9edc309">LS_PG_STATE_SEND</a>&#160;&#160;&#160;2</td></tr>
<tr class="separator:a3c6eb19f262a990e1f9ba630d9edc309"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88a7e80c12fb0449c4b0857a0c7deb21"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a88a7e80c12fb0449c4b0857a0c7deb21">LS_PG_STATE_SEND_FLUSH</a>&#160;&#160;&#160;3</td></tr>
<tr class="separator:a88a7e80c12fb0449c4b0857a0c7deb21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a373e668840b4795ff9a71bc3f744d209"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a373e668840b4795ff9a71bc3f744d209">LS_PG_STATE_RECV</a>&#160;&#160;&#160;4</td></tr>
<tr class="separator:a373e668840b4795ff9a71bc3f744d209"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9878a5ed7cb7c2b925a9f902e5ce8d4a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a9878a5ed7cb7c2b925a9f902e5ce8d4a">LS_PG_STATE_QUITTING</a>&#160;&#160;&#160;5</td></tr>
<tr class="separator:a9878a5ed7cb7c2b925a9f902e5ce8d4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08fe83fe8226002ee8b80ce0a914fd11"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a08fe83fe8226002ee8b80ce0a914fd11">LS_PG_QUERY_QUEUE_LENGTH</a>&#160;&#160;&#160;16384</td></tr>
<tr class="memdesc:a08fe83fe8226002ee8b80ce0a914fd11"><td class="mdescLeft">&#160;</td><td class="mdescRight">Queue length should be long enough that we do not ordinarly bump into the end We should be safe as long as the thread the adds stuff to the queue is not the one that removes it.  <a href="#a08fe83fe8226002ee8b80ce0a914fd11"></a><br/></td></tr>
<tr class="separator:a08fe83fe8226002ee8b80ce0a914fd11"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a6f273a499bf316de95df3816a9b1bc06"><td class="memItemLeft" align="right" valign="top">typedef struct <br class="typebreak"/>
<a class="el" href="structlspg__wait__for__detector__struct.html">lspg_wait_for_detector_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a6f273a499bf316de95df3816a9b1bc06">lspg_wait_for_detector_t</a></td></tr>
<tr class="memdesc:a6f273a499bf316de95df3816a9b1bc06"><td class="mdescLeft">&#160;</td><td class="mdescRight">Object that implements detector / spindle timing We use database locks for exposure control and this implements the md2 portion of this handshake.  <a href="#a6f273a499bf316de95df3816a9b1bc06"></a><br/></td></tr>
<tr class="separator:a6f273a499bf316de95df3816a9b1bc06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7232a0d630558f0c4c081d087150973d"><td class="memItemLeft" align="right" valign="top">typedef struct <br class="typebreak"/>
<a class="el" href="structlspg__lock__diffractometer__struct.html">lspg_lock_diffractometer_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a7232a0d630558f0c4c081d087150973d">lspg_lock_diffractometer_t</a></td></tr>
<tr class="memdesc:a7232a0d630558f0c4c081d087150973d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Object used to impliment locking the diffractometer Critical to exposure timing.  <a href="#a7232a0d630558f0c4c081d087150973d"></a><br/></td></tr>
<tr class="separator:a7232a0d630558f0c4c081d087150973d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3442e66a1f05457eb22a0d4a5d295f3a"><td class="memItemLeft" align="right" valign="top">typedef struct <br class="typebreak"/>
<a class="el" href="structlspg__lock__detector__struct.html">lspg_lock_detector_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a3442e66a1f05457eb22a0d4a5d295f3a">lspg_lock_detector_t</a></td></tr>
<tr class="memdesc:a3442e66a1f05457eb22a0d4a5d295f3a"><td class="mdescLeft">&#160;</td><td class="mdescRight">lock detector object Implements detector lock for exposure control  <a href="#a3442e66a1f05457eb22a0d4a5d295f3a"></a><br/></td></tr>
<tr class="separator:a3442e66a1f05457eb22a0d4a5d295f3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab2da550aea6388c835abe0ee0b226eb0"><td class="memItemLeft" align="right" valign="top">typedef struct <br class="typebreak"/>
<a class="el" href="structlspg__seq__run__prep__struct.html">lspg_seq_run_prep_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ab2da550aea6388c835abe0ee0b226eb0">lspg_seq_run_prep_t</a></td></tr>
<tr class="memdesc:ab2da550aea6388c835abe0ee0b226eb0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Data collection running object.  <a href="#ab2da550aea6388c835abe0ee0b226eb0"></a><br/></td></tr>
<tr class="separator:ab2da550aea6388c835abe0ee0b226eb0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad5f3ec8f197cc330c83dba70f310533c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ad5f3ec8f197cc330c83dba70f310533c">lspg_query_next</a> ()</td></tr>
<tr class="memdesc:ad5f3ec8f197cc330c83dba70f310533c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the next item in the postgresql queue.  <a href="#ad5f3ec8f197cc330c83dba70f310533c"></a><br/></td></tr>
<tr class="separator:ad5f3ec8f197cc330c83dba70f310533c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3847589e641f7e16a0cd68ef30e37cca"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a3847589e641f7e16a0cd68ef30e37cca">lspg_query_reply_next</a> ()</td></tr>
<tr class="memdesc:a3847589e641f7e16a0cd68ef30e37cca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove the oldest item in the queue.  <a href="#a3847589e641f7e16a0cd68ef30e37cca"></a><br/></td></tr>
<tr class="separator:a3847589e641f7e16a0cd68ef30e37cca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6bf4f54117bedf903360883bb32699f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ae6bf4f54117bedf903360883bb32699f">lspg_query_reply_peek</a> ()</td></tr>
<tr class="memdesc:ae6bf4f54117bedf903360883bb32699f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the next item in the reply queue but don't pop it since we may need it more than once.  <a href="#ae6bf4f54117bedf903360883bb32699f"></a><br/></td></tr>
<tr class="separator:ae6bf4f54117bedf903360883bb32699f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad653cd4f070c8ce7d35e0e414b722690"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ad653cd4f070c8ce7d35e0e414b722690">lspg_query_push</a> (void(*cb)(<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *, PGresult *), void(*er)(), char *fmt,...)</td></tr>
<tr class="memdesc:ad653cd4f070c8ce7d35e0e414b722690"><td class="mdescLeft">&#160;</td><td class="mdescRight">Place a query on the queue.  <a href="#ad653cd4f070c8ce7d35e0e414b722690"></a><br/></td></tr>
<tr class="separator:ad653cd4f070c8ce7d35e0e414b722690"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46f23ae999129d6fd5712d7975b99aed"><td class="memItemLeft" align="right" valign="top">char **&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a46f23ae999129d6fd5712d7975b99aed">lspg_array2ptrs</a> (char *a)</td></tr>
<tr class="memdesc:a46f23ae999129d6fd5712d7975b99aed"><td class="mdescLeft">&#160;</td><td class="mdescRight">returns a null terminated list of strings parsed from postgresql array  <a href="#a46f23ae999129d6fd5712d7975b99aed"></a><br/></td></tr>
<tr class="separator:a46f23ae999129d6fd5712d7975b99aed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb8d1ff1e0f4fcdc85ad9c684271cb3d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#afb8d1ff1e0f4fcdc85ad9c684271cb3d">lspg_allkvs_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="memdesc:afb8d1ff1e0f4fcdc85ad9c684271cb3d"><td class="mdescLeft">&#160;</td><td class="mdescRight">set a redis variable based on an updated kv pair  <a href="#afb8d1ff1e0f4fcdc85ad9c684271cb3d"></a><br/></td></tr>
<tr class="separator:afb8d1ff1e0f4fcdc85ad9c684271cb3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade0aad16c5ea2254c8cdc1539302c93b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ade0aad16c5ea2254c8cdc1539302c93b">lspg_allkvs_error_cb</a> ()</td></tr>
<tr class="separator:ade0aad16c5ea2254c8cdc1539302c93b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad503cefdaee8112ea2129d33db2ec7fa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ad503cefdaee8112ea2129d33db2ec7fa">lspg_update_kvs_cb</a> (char *event)</td></tr>
<tr class="memdesc:ad503cefdaee8112ea2129d33db2ec7fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Perhaps update the px.kvs table in postgresql Should be triggered by a timer event.  <a href="#ad503cefdaee8112ea2129d33db2ec7fa"></a><br/></td></tr>
<tr class="separator:ad503cefdaee8112ea2129d33db2ec7fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab98f7d254fa0f5f4826f9427ca8b4f03"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ab98f7d254fa0f5f4826f9427ca8b4f03">lspg_starttransfer_init</a> ()</td></tr>
<tr class="separator:ab98f7d254fa0f5f4826f9427ca8b4f03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a289005bed571909f5ce4de2ff4e70e36"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a289005bed571909f5ce4de2ff4e70e36">lspg_starttransfer_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="separator:a289005bed571909f5ce4de2ff4e70e36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed6571a457cde0cd7c1ef1250d8f0a75"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aed6571a457cde0cd7c1ef1250d8f0a75">lspg_starttransfer_error_cb</a> ()</td></tr>
<tr class="separator:aed6571a457cde0cd7c1ef1250d8f0a75"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af72c4b037347737df09348ab703f6802"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#af72c4b037347737df09348ab703f6802">lspg_starttransfer_call</a> (unsigned int nextsample, int <a class="el" href="pgpmac_8h.html#ac59ab990e48033a811aeb0281fb588fc">sample_detected</a>, double ax, double ay, double az, double horz, double vert, double esttime)</td></tr>
<tr class="separator:af72c4b037347737df09348ab703f6802"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a189e9fd5cbc06dd09e5549f6e229fa5e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a189e9fd5cbc06dd09e5549f6e229fa5e">lspg_starttransfer_wait</a> ()</td></tr>
<tr class="separator:a189e9fd5cbc06dd09e5549f6e229fa5e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad989179281d8b65b940250a4580007d0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ad989179281d8b65b940250a4580007d0">lspg_starttransfer_done</a> ()</td></tr>
<tr class="separator:ad989179281d8b65b940250a4580007d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40fed0d8ea49206604ca5727d94b8faf"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a40fed0d8ea49206604ca5727d94b8faf">lspg_starttransfer_all</a> (int *err, unsigned int nextsample, int sampledetected, double ax, double ay, double az, double horz, double vert, double esttime)</td></tr>
<tr class="separator:a40fed0d8ea49206604ca5727d94b8faf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d6f6c4733629fc14e4f0bc128a1ffb7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a5d6f6c4733629fc14e4f0bc128a1ffb7">lspg_getcurrentsampleid_init</a> ()</td></tr>
<tr class="separator:a5d6f6c4733629fc14e4f0bc128a1ffb7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3245894737f9b496b7882c6e6ed8519d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a3245894737f9b496b7882c6e6ed8519d">lspg_getcurrentsampleid_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="memdesc:a3245894737f9b496b7882c6e6ed8519d"><td class="mdescLeft">&#160;</td><td class="mdescRight">get currentsampleid  <a href="#a3245894737f9b496b7882c6e6ed8519d"></a><br/></td></tr>
<tr class="separator:a3245894737f9b496b7882c6e6ed8519d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a0d183cfae389da62dcedee4c1598fa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a0a0d183cfae389da62dcedee4c1598fa">lspg_getcurrentsampleid_error_cb</a> ()</td></tr>
<tr class="memdesc:a0a0d183cfae389da62dcedee4c1598fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">get currentsampleid error callback  <a href="#a0a0d183cfae389da62dcedee4c1598fa"></a><br/></td></tr>
<tr class="separator:a0a0d183cfae389da62dcedee4c1598fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf98a9e2adec05a69847045f444a5c77"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#acf98a9e2adec05a69847045f444a5c77">lspg_getcurrentsampleid_call</a> ()</td></tr>
<tr class="separator:acf98a9e2adec05a69847045f444a5c77"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b070b4891f485b7f74c95e0e60471f3"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a7b070b4891f485b7f74c95e0e60471f3">lspg_getcurrentsampleid_read</a> ()</td></tr>
<tr class="separator:a7b070b4891f485b7f74c95e0e60471f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39ff432056655f9dbe0f0239668caf74"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a39ff432056655f9dbe0f0239668caf74">lspg_getcurrentsampleid_all</a> ()</td></tr>
<tr class="memdesc:a39ff432056655f9dbe0f0239668caf74"><td class="mdescLeft">&#160;</td><td class="mdescRight">return the current sampleid  <a href="#a39ff432056655f9dbe0f0239668caf74"></a><br/></td></tr>
<tr class="separator:a39ff432056655f9dbe0f0239668caf74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02d7dc2b8b8667b07b48d9147eb4621d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a02d7dc2b8b8667b07b48d9147eb4621d">lspg_getcurrentsampleid_wait_for_id</a> (unsigned int test)</td></tr>
<tr class="separator:a02d7dc2b8b8667b07b48d9147eb4621d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e1de4aa16107d1f5f801e11ae6b268c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a5e1de4aa16107d1f5f801e11ae6b268c">lspg_nextsample_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="memdesc:a5e1de4aa16107d1f5f801e11ae6b268c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Next Sample.  <a href="#a5e1de4aa16107d1f5f801e11ae6b268c"></a><br/></td></tr>
<tr class="separator:a5e1de4aa16107d1f5f801e11ae6b268c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab42eaae1a2f17f7f0e5e976f1a527709"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ab42eaae1a2f17f7f0e5e976f1a527709">lspg_nextsample_error_cb</a> ()</td></tr>
<tr class="memdesc:ab42eaae1a2f17f7f0e5e976f1a527709"><td class="mdescLeft">&#160;</td><td class="mdescRight">Next Sample Query Error Callback.  <a href="#ab42eaae1a2f17f7f0e5e976f1a527709"></a><br/></td></tr>
<tr class="separator:ab42eaae1a2f17f7f0e5e976f1a527709"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2faa901ea0a8ef00cfd93a893b34b446"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a2faa901ea0a8ef00cfd93a893b34b446">lspg_nextsample_init</a> ()</td></tr>
<tr class="memdesc:a2faa901ea0a8ef00cfd93a893b34b446"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the nextsample variable, mutex, and condition.  <a href="#a2faa901ea0a8ef00cfd93a893b34b446"></a><br/></td></tr>
<tr class="separator:a2faa901ea0a8ef00cfd93a893b34b446"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab1c441d22126ea4334b3c61b7e4b4c2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aab1c441d22126ea4334b3c61b7e4b4c2">lspg_nextsample_call</a> ()</td></tr>
<tr class="memdesc:aab1c441d22126ea4334b3c61b7e4b4c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Queue up a nextsample query.  <a href="#aab1c441d22126ea4334b3c61b7e4b4c2"></a><br/></td></tr>
<tr class="separator:aab1c441d22126ea4334b3c61b7e4b4c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32878d3d29f4595d1d2b861d7e871726"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a32878d3d29f4595d1d2b861d7e871726">lspg_nextsample_wait</a> ()</td></tr>
<tr class="memdesc:a32878d3d29f4595d1d2b861d7e871726"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for the nextsample query to get processed.  <a href="#a32878d3d29f4595d1d2b861d7e871726"></a><br/></td></tr>
<tr class="separator:a32878d3d29f4595d1d2b861d7e871726"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac52207cc8f4c14494ae6f4972b6a3b23"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ac52207cc8f4c14494ae6f4972b6a3b23">lspg_nextsample_done</a> ()</td></tr>
<tr class="memdesc:ac52207cc8f4c14494ae6f4972b6a3b23"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called when the next shot query has been processed.  <a href="#ac52207cc8f4c14494ae6f4972b6a3b23"></a><br/></td></tr>
<tr class="separator:ac52207cc8f4c14494ae6f4972b6a3b23"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4cc866393eda0cf20276d035f6fbe206"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a4cc866393eda0cf20276d035f6fbe206">lspg_nextsample_all</a> (int *err)</td></tr>
<tr class="separator:a4cc866393eda0cf20276d035f6fbe206"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32b2bf00d66ee5fca130ee616a09cf7b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a32b2bf00d66ee5fca130ee616a09cf7b">lspg_waitcryo_init</a> ()</td></tr>
<tr class="separator:a32b2bf00d66ee5fca130ee616a09cf7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7497a7c924b31c727ea487a3efb77fb6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a7497a7c924b31c727ea487a3efb77fb6">lspg_waitcryo_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="separator:a7497a7c924b31c727ea487a3efb77fb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21393baf18a3934474b40e0006d93d50"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a21393baf18a3934474b40e0006d93d50">lspg_waitcryo_error_cb</a> ()</td></tr>
<tr class="separator:a21393baf18a3934474b40e0006d93d50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68d367d98c780a95b2c347d09e9ddec3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a68d367d98c780a95b2c347d09e9ddec3">lspg_waitcryo_all</a> ()</td></tr>
<tr class="memdesc:a68d367d98c780a95b2c347d09e9ddec3"><td class="mdescLeft">&#160;</td><td class="mdescRight">no need to get fancy with the wait cryo command It should not return until the robot is almost ready for air rights  <a href="#a68d367d98c780a95b2c347d09e9ddec3"></a><br/></td></tr>
<tr class="separator:a68d367d98c780a95b2c347d09e9ddec3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61e47be0d5d7154700e7e5edb889852e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a61e47be0d5d7154700e7e5edb889852e">lspg_demandairrights_init</a> ()</td></tr>
<tr class="memdesc:a61e47be0d5d7154700e7e5edb889852e"><td class="mdescLeft">&#160;</td><td class="mdescRight">initialize the demandairrights structure  <a href="#a61e47be0d5d7154700e7e5edb889852e"></a><br/></td></tr>
<tr class="separator:a61e47be0d5d7154700e7e5edb889852e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a208134de0d5bbbdaf5589126d46f1c4e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a208134de0d5bbbdaf5589126d46f1c4e">lspg_demandairrights_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="memdesc:a208134de0d5bbbdaf5589126d46f1c4e"><td class="mdescLeft">&#160;</td><td class="mdescRight">handle the airrights response  <a href="#a208134de0d5bbbdaf5589126d46f1c4e"></a><br/></td></tr>
<tr class="separator:a208134de0d5bbbdaf5589126d46f1c4e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a705d2b323797dde2b5b41925dba84c8b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a705d2b323797dde2b5b41925dba84c8b">lspg_demandairrights_error_cb</a> ()</td></tr>
<tr class="memdesc:a705d2b323797dde2b5b41925dba84c8b"><td class="mdescLeft">&#160;</td><td class="mdescRight">handle airrights query error  <a href="#a705d2b323797dde2b5b41925dba84c8b"></a><br/></td></tr>
<tr class="separator:a705d2b323797dde2b5b41925dba84c8b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3f3ae783042eb1f5f2c37b517b7404a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ae3f3ae783042eb1f5f2c37b517b7404a">lspg_demandairrights_call</a> ()</td></tr>
<tr class="memdesc:ae3f3ae783042eb1f5f2c37b517b7404a"><td class="mdescLeft">&#160;</td><td class="mdescRight">call for airrights  <a href="#ae3f3ae783042eb1f5f2c37b517b7404a"></a><br/></td></tr>
<tr class="separator:ae3f3ae783042eb1f5f2c37b517b7404a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79cc363874905f76f5607cca5dc9773a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a79cc363874905f76f5607cca5dc9773a">lspg_demandairrights_wait</a> ()</td></tr>
<tr class="memdesc:a79cc363874905f76f5607cca5dc9773a"><td class="mdescLeft">&#160;</td><td class="mdescRight">wait for the air rights request to return  <a href="#a79cc363874905f76f5607cca5dc9773a"></a><br/></td></tr>
<tr class="separator:a79cc363874905f76f5607cca5dc9773a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4cad634cac645d0366acbb25cef7b96"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aa4cad634cac645d0366acbb25cef7b96">lspg_demandairrights_all</a> ()</td></tr>
<tr class="memdesc:aa4cad634cac645d0366acbb25cef7b96"><td class="mdescLeft">&#160;</td><td class="mdescRight">do nothing until we get airrights  <a href="#aa4cad634cac645d0366acbb25cef7b96"></a><br/></td></tr>
<tr class="separator:aa4cad634cac645d0366acbb25cef7b96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e92a204f606761d368ac7e06ef0f09c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a9e92a204f606761d368ac7e06ef0f09c">lspg_nextshot_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="memdesc:a9e92a204f606761d368ac7e06ef0f09c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Next Shot Callback.  <a href="#a9e92a204f606761d368ac7e06ef0f09c"></a><br/></td></tr>
<tr class="separator:a9e92a204f606761d368ac7e06ef0f09c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83677bfe7aab92df2d6d93fdf8cd2280"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a83677bfe7aab92df2d6d93fdf8cd2280">lspg_nextshot_error_cb</a> ()</td></tr>
<tr class="memdesc:a83677bfe7aab92df2d6d93fdf8cd2280"><td class="mdescLeft">&#160;</td><td class="mdescRight">next shot query error callback  <a href="#a83677bfe7aab92df2d6d93fdf8cd2280"></a><br/></td></tr>
<tr class="separator:a83677bfe7aab92df2d6d93fdf8cd2280"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff91db7d60e6c832684c023813e36dbf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aff91db7d60e6c832684c023813e36dbf">lspg_nextshot_init</a> ()</td></tr>
<tr class="memdesc:aff91db7d60e6c832684c023813e36dbf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the nextshot variable, mutex, and condition.  <a href="#aff91db7d60e6c832684c023813e36dbf"></a><br/></td></tr>
<tr class="separator:aff91db7d60e6c832684c023813e36dbf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af17ef79544ca5d78fd477010fe90d538"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#af17ef79544ca5d78fd477010fe90d538">lspg_nextshot_call</a> ()</td></tr>
<tr class="memdesc:af17ef79544ca5d78fd477010fe90d538"><td class="mdescLeft">&#160;</td><td class="mdescRight">Queue up a nextshot query.  <a href="#af17ef79544ca5d78fd477010fe90d538"></a><br/></td></tr>
<tr class="separator:af17ef79544ca5d78fd477010fe90d538"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a784a6de32a86fec9efb3ef3ae4b6e3ac"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a784a6de32a86fec9efb3ef3ae4b6e3ac">lspg_nextshot_wait</a> ()</td></tr>
<tr class="memdesc:a784a6de32a86fec9efb3ef3ae4b6e3ac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for the next shot query to get processed.  <a href="#a784a6de32a86fec9efb3ef3ae4b6e3ac"></a><br/></td></tr>
<tr class="separator:a784a6de32a86fec9efb3ef3ae4b6e3ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50458a014041a4118452802dfb303960"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a50458a014041a4118452802dfb303960">lspg_nextshot_done</a> ()</td></tr>
<tr class="memdesc:a50458a014041a4118452802dfb303960"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called when the next shot query has been processed.  <a href="#a50458a014041a4118452802dfb303960"></a><br/></td></tr>
<tr class="separator:a50458a014041a4118452802dfb303960"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3517f8fbed91c998f6036284f9bd0c48"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a3517f8fbed91c998f6036284f9bd0c48">lspg_wait_for_detector_init</a> ()</td></tr>
<tr class="memdesc:a3517f8fbed91c998f6036284f9bd0c48"><td class="mdescLeft">&#160;</td><td class="mdescRight">initialize the detector timing object  <a href="#a3517f8fbed91c998f6036284f9bd0c48"></a><br/></td></tr>
<tr class="separator:a3517f8fbed91c998f6036284f9bd0c48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5747c519d1aa4c310010a862cae8a823"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a5747c519d1aa4c310010a862cae8a823">lspg_wait_for_detector_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="memdesc:a5747c519d1aa4c310010a862cae8a823"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback for the wait for detector query.  <a href="#a5747c519d1aa4c310010a862cae8a823"></a><br/></td></tr>
<tr class="separator:a5747c519d1aa4c310010a862cae8a823"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a2365af50268b1ebce795b818c375a8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a9a2365af50268b1ebce795b818c375a8">lspg_wait_for_detector_error_cb</a> ()</td></tr>
<tr class="memdesc:a9a2365af50268b1ebce795b818c375a8"><td class="mdescLeft">&#160;</td><td class="mdescRight">wait for detector query error callback  <a href="#a9a2365af50268b1ebce795b818c375a8"></a><br/></td></tr>
<tr class="separator:a9a2365af50268b1ebce795b818c375a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b5222b859a44eae616804a1e990b86d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a4b5222b859a44eae616804a1e990b86d">lspg_wait_for_detector_call</a> ()</td></tr>
<tr class="memdesc:a4b5222b859a44eae616804a1e990b86d"><td class="mdescLeft">&#160;</td><td class="mdescRight">initiate the wait for detector query  <a href="#a4b5222b859a44eae616804a1e990b86d"></a><br/></td></tr>
<tr class="separator:a4b5222b859a44eae616804a1e990b86d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af094e01be121ce8e14abb679abd17e19"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#af094e01be121ce8e14abb679abd17e19">lspg_wait_for_detector_wait</a> ()</td></tr>
<tr class="memdesc:af094e01be121ce8e14abb679abd17e19"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pause the calling thread until the detector is ready Called by the MD2 thread.  <a href="#af094e01be121ce8e14abb679abd17e19"></a><br/></td></tr>
<tr class="separator:af094e01be121ce8e14abb679abd17e19"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb3645dee7c4514b650ab02f27570a69"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#abb3645dee7c4514b650ab02f27570a69">lspg_wait_for_detector_done</a> ()</td></tr>
<tr class="memdesc:abb3645dee7c4514b650ab02f27570a69"><td class="mdescLeft">&#160;</td><td class="mdescRight">Done waiting for the detector.  <a href="#abb3645dee7c4514b650ab02f27570a69"></a><br/></td></tr>
<tr class="separator:abb3645dee7c4514b650ab02f27570a69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab9780e15924a50b2a5545e10806000b3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ab9780e15924a50b2a5545e10806000b3">lspg_wait_for_detector_all</a> ()</td></tr>
<tr class="memdesc:ab9780e15924a50b2a5545e10806000b3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Combined call to wait for the detector.  <a href="#ab9780e15924a50b2a5545e10806000b3"></a><br/></td></tr>
<tr class="separator:ab9780e15924a50b2a5545e10806000b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39bb94f8e0d47702b2b920a3dee61ebc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a39bb94f8e0d47702b2b920a3dee61ebc">lspg_lock_diffractometer_init</a> ()</td></tr>
<tr class="memdesc:a39bb94f8e0d47702b2b920a3dee61ebc"><td class="mdescLeft">&#160;</td><td class="mdescRight">initialize the diffractometer locking object  <a href="#a39bb94f8e0d47702b2b920a3dee61ebc"></a><br/></td></tr>
<tr class="separator:a39bb94f8e0d47702b2b920a3dee61ebc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad4f378f37c0030634dafa0d9445d916"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aad4f378f37c0030634dafa0d9445d916">lspg_lock_diffractometer_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="memdesc:aad4f378f37c0030634dafa0d9445d916"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback routine for a lock diffractometer query.  <a href="#aad4f378f37c0030634dafa0d9445d916"></a><br/></td></tr>
<tr class="separator:aad4f378f37c0030634dafa0d9445d916"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a446af872041c0a4f6151b442c92d025b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a446af872041c0a4f6151b442c92d025b">lspg_lock_diffractometer_error_cb</a> ()</td></tr>
<tr class="memdesc:a446af872041c0a4f6151b442c92d025b"><td class="mdescLeft">&#160;</td><td class="mdescRight">lock diffractometer query error callback  <a href="#a446af872041c0a4f6151b442c92d025b"></a><br/></td></tr>
<tr class="separator:a446af872041c0a4f6151b442c92d025b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5ebeb38e8e9926a52f024fe76201175"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ac5ebeb38e8e9926a52f024fe76201175">lspg_lock_diffractometer_call</a> ()</td></tr>
<tr class="memdesc:ac5ebeb38e8e9926a52f024fe76201175"><td class="mdescLeft">&#160;</td><td class="mdescRight">Request that the database grab the diffractometer lock.  <a href="#ac5ebeb38e8e9926a52f024fe76201175"></a><br/></td></tr>
<tr class="separator:ac5ebeb38e8e9926a52f024fe76201175"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8445e1dec753f2c517b87fcb9c5b5943"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a8445e1dec753f2c517b87fcb9c5b5943">lspg_lock_diffractometer_wait</a> ()</td></tr>
<tr class="memdesc:a8445e1dec753f2c517b87fcb9c5b5943"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for the diffractometer lock.  <a href="#a8445e1dec753f2c517b87fcb9c5b5943"></a><br/></td></tr>
<tr class="separator:a8445e1dec753f2c517b87fcb9c5b5943"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75aaf0b3fe33530062226c69a33ce821"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a75aaf0b3fe33530062226c69a33ce821">lspg_lock_diffractometer_done</a> ()</td></tr>
<tr class="memdesc:a75aaf0b3fe33530062226c69a33ce821"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finish up the lock diffractometer call.  <a href="#a75aaf0b3fe33530062226c69a33ce821"></a><br/></td></tr>
<tr class="separator:a75aaf0b3fe33530062226c69a33ce821"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88b33e75c42197740b157a51ea726f21"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a88b33e75c42197740b157a51ea726f21">lspg_lock_diffractometer_all</a> ()</td></tr>
<tr class="memdesc:a88b33e75c42197740b157a51ea726f21"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convience function that combines lock diffractometer calls.  <a href="#a88b33e75c42197740b157a51ea726f21"></a><br/></td></tr>
<tr class="separator:a88b33e75c42197740b157a51ea726f21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e9bbf847dadfe0d10830d67824d9be8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a0e9bbf847dadfe0d10830d67824d9be8">lspg_lock_detector_init</a> ()</td></tr>
<tr class="memdesc:a0e9bbf847dadfe0d10830d67824d9be8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize detector lock object.  <a href="#a0e9bbf847dadfe0d10830d67824d9be8"></a><br/></td></tr>
<tr class="separator:a0e9bbf847dadfe0d10830d67824d9be8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa760191c2b443170cebbcbf5ea5345f3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aa760191c2b443170cebbcbf5ea5345f3">lspg_lock_detector_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="memdesc:aa760191c2b443170cebbcbf5ea5345f3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback for when the detector lock has be grabbed.  <a href="#aa760191c2b443170cebbcbf5ea5345f3"></a><br/></td></tr>
<tr class="separator:aa760191c2b443170cebbcbf5ea5345f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c4869c73a26328109c40f33693ef77d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a1c4869c73a26328109c40f33693ef77d">lspg_lock_detector_error_cb</a> ()</td></tr>
<tr class="memdesc:a1c4869c73a26328109c40f33693ef77d"><td class="mdescLeft">&#160;</td><td class="mdescRight">lock detector query error callback  <a href="#a1c4869c73a26328109c40f33693ef77d"></a><br/></td></tr>
<tr class="separator:a1c4869c73a26328109c40f33693ef77d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f71a20cc297684b2afe28e7bd8e8383"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a5f71a20cc297684b2afe28e7bd8e8383">lspg_lock_detector_call</a> ()</td></tr>
<tr class="memdesc:a5f71a20cc297684b2afe28e7bd8e8383"><td class="mdescLeft">&#160;</td><td class="mdescRight">Request (demand) a detector lock.  <a href="#a5f71a20cc297684b2afe28e7bd8e8383"></a><br/></td></tr>
<tr class="separator:a5f71a20cc297684b2afe28e7bd8e8383"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3d9c56bd3ca6bcc43db30872cc441cc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ad3d9c56bd3ca6bcc43db30872cc441cc">lspg_lock_detector_wait</a> ()</td></tr>
<tr class="memdesc:ad3d9c56bd3ca6bcc43db30872cc441cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for the detector lock.  <a href="#ad3d9c56bd3ca6bcc43db30872cc441cc"></a><br/></td></tr>
<tr class="separator:ad3d9c56bd3ca6bcc43db30872cc441cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b567040693ff6e2932a2477045d75fa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a1b567040693ff6e2932a2477045d75fa">lspg_lock_detector_done</a> ()</td></tr>
<tr class="memdesc:a1b567040693ff6e2932a2477045d75fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finish waiting.  <a href="#a1b567040693ff6e2932a2477045d75fa"></a><br/></td></tr>
<tr class="separator:a1b567040693ff6e2932a2477045d75fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff93d2f5ac31aa249a0bef40a3837c84"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aff93d2f5ac31aa249a0bef40a3837c84">lspg_lock_detector_all</a> ()</td></tr>
<tr class="memdesc:aff93d2f5ac31aa249a0bef40a3837c84"><td class="mdescLeft">&#160;</td><td class="mdescRight">Detector lock convinence function.  <a href="#aff93d2f5ac31aa249a0bef40a3837c84"></a><br/></td></tr>
<tr class="separator:aff93d2f5ac31aa249a0bef40a3837c84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31823ecb2b44d4a6674f804059a27bce"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a31823ecb2b44d4a6674f804059a27bce">lspg_seq_run_prep_init</a> ()</td></tr>
<tr class="memdesc:a31823ecb2b44d4a6674f804059a27bce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the data collection object.  <a href="#a31823ecb2b44d4a6674f804059a27bce"></a><br/></td></tr>
<tr class="separator:a31823ecb2b44d4a6674f804059a27bce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a11cda12050dc9a86188e15e2155a6013"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a11cda12050dc9a86188e15e2155a6013">lspg_seq_run_prep_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="memdesc:a11cda12050dc9a86188e15e2155a6013"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback for the seq_run_prep query.  <a href="#a11cda12050dc9a86188e15e2155a6013"></a><br/></td></tr>
<tr class="separator:a11cda12050dc9a86188e15e2155a6013"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03e51bca6d876ba56e22447c831bf28c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a03e51bca6d876ba56e22447c831bf28c">lspg_seq_run_prep_error_cb</a> ()</td></tr>
<tr class="memdesc:a03e51bca6d876ba56e22447c831bf28c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback for seq_run error.  <a href="#a03e51bca6d876ba56e22447c831bf28c"></a><br/></td></tr>
<tr class="separator:a03e51bca6d876ba56e22447c831bf28c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7d6efd861b152a371442791deb42bd3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#af7d6efd861b152a371442791deb42bd3">lspg_seq_run_prep_call</a> (long long skey, double <a class="el" href="pgpmac_8h.html#a0be79ccb7ebf3a665248fd856112b9fd">kappa</a>, double <a class="el" href="pgpmac_8h.html#ac8070dc568ad974a3db42b51eca828cc">phi</a>, double cx, double cy, double ax, double ay, double az)</td></tr>
<tr class="memdesc:af7d6efd861b152a371442791deb42bd3"><td class="mdescLeft">&#160;</td><td class="mdescRight">queue up the seq_run_prep query  <a href="#af7d6efd861b152a371442791deb42bd3"></a><br/></td></tr>
<tr class="separator:af7d6efd861b152a371442791deb42bd3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0b01f501322432a8fa37f31898c3499"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ac0b01f501322432a8fa37f31898c3499">lspg_seq_run_prep_wait</a> ()</td></tr>
<tr class="memdesc:ac0b01f501322432a8fa37f31898c3499"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for seq run prep query to return.  <a href="#ac0b01f501322432a8fa37f31898c3499"></a><br/></td></tr>
<tr class="separator:ac0b01f501322432a8fa37f31898c3499"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a472b09ddf716c80207f97e2bb5d37d66"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a472b09ddf716c80207f97e2bb5d37d66">lspg_seq_run_prep_done</a> ()</td></tr>
<tr class="memdesc:a472b09ddf716c80207f97e2bb5d37d66"><td class="mdescLeft">&#160;</td><td class="mdescRight">Indicate we are done waiting.  <a href="#a472b09ddf716c80207f97e2bb5d37d66"></a><br/></td></tr>
<tr class="separator:a472b09ddf716c80207f97e2bb5d37d66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d3cf153b086f5252f248d17db824917"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a5d3cf153b086f5252f248d17db824917">lspg_seq_run_prep_all</a> (long long skey, double <a class="el" href="pgpmac_8h.html#a0be79ccb7ebf3a665248fd856112b9fd">kappa</a>, double <a class="el" href="pgpmac_8h.html#ac8070dc568ad974a3db42b51eca828cc">phi</a>, double cx, double cy, double ax, double ay, double az)</td></tr>
<tr class="memdesc:a5d3cf153b086f5252f248d17db824917"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convinence function to call seq run prep.  <a href="#a5d3cf153b086f5252f248d17db824917"></a><br/></td></tr>
<tr class="separator:a5d3cf153b086f5252f248d17db824917"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8184824f2b71b1d35141d7922ca69cd7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a8184824f2b71b1d35141d7922ca69cd7">lspg_getcenter_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="memdesc:a8184824f2b71b1d35141d7922ca69cd7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve the data to center the crystal.  <a href="#a8184824f2b71b1d35141d7922ca69cd7"></a><br/></td></tr>
<tr class="separator:a8184824f2b71b1d35141d7922ca69cd7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42a5e614dc36938e4897ea3c038d4dc2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a42a5e614dc36938e4897ea3c038d4dc2">lspg_getcenter_error_cb</a> ()</td></tr>
<tr class="memdesc:a42a5e614dc36938e4897ea3c038d4dc2"><td class="mdescLeft">&#160;</td><td class="mdescRight">getcenter query error callback  <a href="#a42a5e614dc36938e4897ea3c038d4dc2"></a><br/></td></tr>
<tr class="separator:a42a5e614dc36938e4897ea3c038d4dc2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad31db17587a02302ac4e40fb7d260b1b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ad31db17587a02302ac4e40fb7d260b1b">lspg_getcenter_init</a> ()</td></tr>
<tr class="memdesc:ad31db17587a02302ac4e40fb7d260b1b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize getcenter object.  <a href="#ad31db17587a02302ac4e40fb7d260b1b"></a><br/></td></tr>
<tr class="separator:ad31db17587a02302ac4e40fb7d260b1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f7cd0a06f6a266ef65b3604cf33d6c4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a6f7cd0a06f6a266ef65b3604cf33d6c4">lspg_getcenter_call</a> ()</td></tr>
<tr class="memdesc:a6f7cd0a06f6a266ef65b3604cf33d6c4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Request a getcenter query.  <a href="#a6f7cd0a06f6a266ef65b3604cf33d6c4"></a><br/></td></tr>
<tr class="separator:a6f7cd0a06f6a266ef65b3604cf33d6c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e0e4b3cb9fa03961ee0c104e0b06754"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a3e0e4b3cb9fa03961ee0c104e0b06754">lspg_getcenter_wait</a> ()</td></tr>
<tr class="memdesc:a3e0e4b3cb9fa03961ee0c104e0b06754"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for a getcenter query to return.  <a href="#a3e0e4b3cb9fa03961ee0c104e0b06754"></a><br/></td></tr>
<tr class="separator:a3e0e4b3cb9fa03961ee0c104e0b06754"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c678553b44c874d08ec9966ed7bb1c0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a7c678553b44c874d08ec9966ed7bb1c0">lspg_getcenter_done</a> ()</td></tr>
<tr class="memdesc:a7c678553b44c874d08ec9966ed7bb1c0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Done with getcenter query.  <a href="#a7c678553b44c874d08ec9966ed7bb1c0"></a><br/></td></tr>
<tr class="separator:a7c678553b44c874d08ec9966ed7bb1c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a523b492d9cd4970853eabee2d3c31578"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a523b492d9cd4970853eabee2d3c31578">lspg_getcenter_all</a> ()</td></tr>
<tr class="memdesc:a523b492d9cd4970853eabee2d3c31578"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convenience function to complete synchronous getcenter query.  <a href="#a523b492d9cd4970853eabee2d3c31578"></a><br/></td></tr>
<tr class="separator:a523b492d9cd4970853eabee2d3c31578"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeda8dad89b03d7d61cc994dd63ee5db6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aeda8dad89b03d7d61cc994dd63ee5db6">lspg_nextaction_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="memdesc:aeda8dad89b03d7d61cc994dd63ee5db6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Queue the next MD2 instruction.  <a href="#aeda8dad89b03d7d61cc994dd63ee5db6"></a><br/></td></tr>
<tr class="separator:aeda8dad89b03d7d61cc994dd63ee5db6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90358250d1560ae5b90cf84a78c5f84e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a90358250d1560ae5b90cf84a78c5f84e">lspg_nextaction_error_cb</a> ()</td></tr>
<tr class="separator:a90358250d1560ae5b90cf84a78c5f84e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3bf385449e085f049d55fe988d9b22dd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a3bf385449e085f049d55fe988d9b22dd">lspg_nexterrors_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="separator:a3bf385449e085f049d55fe988d9b22dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02f0348ce66bea38ce4356571e3c8fdd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a02f0348ce66bea38ce4356571e3c8fdd">lspg_nexterrors_error_cb</a> ()</td></tr>
<tr class="separator:a02f0348ce66bea38ce4356571e3c8fdd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6cff8b4272907291da431eff274a51b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ad6cff8b4272907291da431eff274a51b">lspg_cmd_error_cb</a> ()</td></tr>
<tr class="separator:ad6cff8b4272907291da431eff274a51b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e11f525ca0f9ac9ab71f9fbe983c42b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a1e11f525ca0f9ac9ab71f9fbe983c42b">lspg_cmd_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="memdesc:a1e11f525ca0f9ac9ab71f9fbe983c42b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send strings directly to PMAC queue.  <a href="#a1e11f525ca0f9ac9ab71f9fbe983c42b"></a><br/></td></tr>
<tr class="separator:a1e11f525ca0f9ac9ab71f9fbe983c42b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6485ac1749c5de3008dd0e0badaa09c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#af6485ac1749c5de3008dd0e0badaa09c">lspg_flush</a> ()</td></tr>
<tr class="memdesc:af6485ac1749c5de3008dd0e0badaa09c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flush psql output buffer (ie, send the query)  <a href="#af6485ac1749c5de3008dd0e0badaa09c"></a><br/></td></tr>
<tr class="separator:af6485ac1749c5de3008dd0e0badaa09c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a714b15e117ffe7bfce4f2f2ce4725b0a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a714b15e117ffe7bfce4f2f2ce4725b0a">lspg_send_next_query</a> ()</td></tr>
<tr class="memdesc:a714b15e117ffe7bfce4f2f2ce4725b0a"><td class="mdescLeft">&#160;</td><td class="mdescRight">send the next queued query to the DB server  <a href="#a714b15e117ffe7bfce4f2f2ce4725b0a"></a><br/></td></tr>
<tr class="separator:a714b15e117ffe7bfce4f2f2ce4725b0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a038c5af23469b789fc1c55d21cb43029"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a038c5af23469b789fc1c55d21cb43029">lspg_receive</a> ()</td></tr>
<tr class="memdesc:a038c5af23469b789fc1c55d21cb43029"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receive a result of a query.  <a href="#a038c5af23469b789fc1c55d21cb43029"></a><br/></td></tr>
<tr class="separator:a038c5af23469b789fc1c55d21cb43029"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a049f4422994aa2eb2b841ffb2937f895"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a049f4422994aa2eb2b841ffb2937f895">lspg_sig_service</a> (struct pollfd *evt)</td></tr>
<tr class="memdesc:a049f4422994aa2eb2b841ffb2937f895"><td class="mdescLeft">&#160;</td><td class="mdescRight">Service a signal Signals here are treated as file descriptors and fits into our poll scheme.  <a href="#a049f4422994aa2eb2b841ffb2937f895"></a><br/></td></tr>
<tr class="separator:a049f4422994aa2eb2b841ffb2937f895"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8d1fed4b461c2139a21826d524777d5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aa8d1fed4b461c2139a21826d524777d5">lspg_pg_service</a> (struct pollfd *evt)</td></tr>
<tr class="memdesc:aa8d1fed4b461c2139a21826d524777d5"><td class="mdescLeft">&#160;</td><td class="mdescRight">I/O control to/from the postgresql server.  <a href="#aa8d1fed4b461c2139a21826d524777d5"></a><br/></td></tr>
<tr class="separator:aa8d1fed4b461c2139a21826d524777d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62b110949d206fb22789191207e1d066"><td class="memItemLeft" align="right" valign="top">PQnoticeProcessor&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a62b110949d206fb22789191207e1d066">lspg_notice_processor</a> (void *arg, const char *msg)</td></tr>
<tr class="separator:a62b110949d206fb22789191207e1d066"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a581c18be0368425665a40b4b7f7d9714"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a581c18be0368425665a40b4b7f7d9714">lspg_pg_connect</a> ()</td></tr>
<tr class="memdesc:a581c18be0368425665a40b4b7f7d9714"><td class="mdescLeft">&#160;</td><td class="mdescRight">Connect to the pg server.  <a href="#a581c18be0368425665a40b4b7f7d9714"></a><br/></td></tr>
<tr class="separator:a581c18be0368425665a40b4b7f7d9714"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab52a8c8245bf6561f40c0f224fc07ff4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ab52a8c8245bf6561f40c0f224fc07ff4">lspg_next_state</a> ()</td></tr>
<tr class="memdesc:ab52a8c8245bf6561f40c0f224fc07ff4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implements our state machine Does not strictly only set the next state as it also calls some functions that, perhaps, alters the state mid-function.  <a href="#ab52a8c8245bf6561f40c0f224fc07ff4"></a><br/></td></tr>
<tr class="separator:ab52a8c8245bf6561f40c0f224fc07ff4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf4fadd2943fa3a2ecb5d840e84d68fa"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aaf4fadd2943fa3a2ecb5d840e84d68fa">lspg_worker</a> (void *dummy)</td></tr>
<tr class="memdesc:aaf4fadd2943fa3a2ecb5d840e84d68fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">The main loop for the lspg thread.  <a href="#aaf4fadd2943fa3a2ecb5d840e84d68fa"></a><br/></td></tr>
<tr class="separator:aaf4fadd2943fa3a2ecb5d840e84d68fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69a792e1981af00b2818bcda89bdaa02"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a69a792e1981af00b2818bcda89bdaa02">lspg_preset_changed_cb</a> (char *event)</td></tr>
<tr class="separator:a69a792e1981af00b2818bcda89bdaa02"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4710c50945fce26b4ac5dc01ed61459d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a4710c50945fce26b4ac5dc01ed61459d">lspg_check_preset_in_position_cb</a> (char *event)</td></tr>
<tr class="separator:a4710c50945fce26b4ac5dc01ed61459d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abcdcee6ef5ed0865056d42a6cf9da8bd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#abcdcee6ef5ed0865056d42a6cf9da8bd">lspg_unset_current_preset_moving_cb</a> (char *event)</td></tr>
<tr class="separator:abcdcee6ef5ed0865056d42a6cf9da8bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af61ae1cf46d67e29dfc690b9a98b1b4d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#af61ae1cf46d67e29dfc690b9a98b1b4d">lspg_set_scale_cb</a> (char *event)</td></tr>
<tr class="memdesc:af61ae1cf46d67e29dfc690b9a98b1b4d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fix up xscale and yscale when zoom changes.  <a href="#af61ae1cf46d67e29dfc690b9a98b1b4d"></a><br/></td></tr>
<tr class="separator:af61ae1cf46d67e29dfc690b9a98b1b4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14546bac5695b536cd348d5e0a1661fa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a14546bac5695b536cd348d5e0a1661fa">lspg_sample_detector_cb</a> (char *event)</td></tr>
<tr class="memdesc:a14546bac5695b536cd348d5e0a1661fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">log magnet state  <a href="#a14546bac5695b536cd348d5e0a1661fa"></a><br/></td></tr>
<tr class="separator:a14546bac5695b536cd348d5e0a1661fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8e61b88e2afc47a73630160cca23e11"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aa8e61b88e2afc47a73630160cca23e11">lspg_quit_query_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="memdesc:aa8e61b88e2afc47a73630160cca23e11"><td class="mdescLeft">&#160;</td><td class="mdescRight">call back to handle signing out of the database  <a href="#aa8e61b88e2afc47a73630160cca23e11"></a><br/></td></tr>
<tr class="separator:aa8e61b88e2afc47a73630160cca23e11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91e910f7ab9b340bea598b01450e9c6b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a91e910f7ab9b340bea598b01450e9c6b">lspg_quitting_cb</a> (char *event)</td></tr>
<tr class="memdesc:a91e910f7ab9b340bea598b01450e9c6b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepare to exit the program in a couple of seconds.  <a href="#a91e910f7ab9b340bea598b01450e9c6b"></a><br/></td></tr>
<tr class="separator:a91e910f7ab9b340bea598b01450e9c6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a77972df14166e05c94ed0792baa09b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a8a77972df14166e05c94ed0792baa09b">lspg_init</a> ()</td></tr>
<tr class="memdesc:a8a77972df14166e05c94ed0792baa09b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initiallize the lspg module.  <a href="#a8a77972df14166e05c94ed0792baa09b"></a><br/></td></tr>
<tr class="separator:a8a77972df14166e05c94ed0792baa09b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a80df49750b61bb2526618db4253fc4ce"><td class="memItemLeft" align="right" valign="top">pthread_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a80df49750b61bb2526618db4253fc4ce">lspg_run</a> ()</td></tr>
<tr class="memdesc:a80df49750b61bb2526618db4253fc4ce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start 'er runnin'.  <a href="#a80df49750b61bb2526618db4253fc4ce"></a><br/></td></tr>
<tr class="separator:a80df49750b61bb2526618db4253fc4ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a4937baac0cc78ea306d58b5f027867f1"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1">ls_pg_state</a> = <a class="el" href="lspg_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a></td></tr>
<tr class="memdesc:a4937baac0cc78ea306d58b5f027867f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">State of the lspg state machine.  <a href="#a4937baac0cc78ea306d58b5f027867f1"></a><br/></td></tr>
<tr class="separator:a4937baac0cc78ea306d58b5f027867f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad40ac52086f6b774928af45b09d54c6e"><td class="memItemLeft" align="right" valign="top">static struct timeval <br class="typebreak"/>
lspg_time_sent&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ad40ac52086f6b774928af45b09d54c6e">now</a></td></tr>
<tr class="memdesc:ad40ac52086f6b774928af45b09d54c6e"><td class="mdescLeft">&#160;</td><td class="mdescRight">used to ensure we do not inundate the db server with connection requests  <a href="#ad40ac52086f6b774928af45b09d54c6e"></a><br/></td></tr>
<tr class="separator:ad40ac52086f6b774928af45b09d54c6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04eb0cda0d5e5afeae7c393b51689765"><td class="memItemLeft" align="right" valign="top">static pthread_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a04eb0cda0d5e5afeae7c393b51689765">lspg_thread</a></td></tr>
<tr class="memdesc:a04eb0cda0d5e5afeae7c393b51689765"><td class="mdescLeft">&#160;</td><td class="mdescRight">our worker thread  <a href="#a04eb0cda0d5e5afeae7c393b51689765"></a><br/></td></tr>
<tr class="separator:a04eb0cda0d5e5afeae7c393b51689765"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed46a94106c583796e3a8ca0e89aa8e4"><td class="memItemLeft" align="right" valign="top">static pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4">lspg_queue_mutex</a></td></tr>
<tr class="memdesc:aed46a94106c583796e3a8ca0e89aa8e4"><td class="mdescLeft">&#160;</td><td class="mdescRight">keep the queue from getting tangled  <a href="#aed46a94106c583796e3a8ca0e89aa8e4"></a><br/></td></tr>
<tr class="separator:aed46a94106c583796e3a8ca0e89aa8e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61a308b6a37afd645beb422653b95baa"><td class="memItemLeft" align="right" valign="top">static pthread_cond_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a61a308b6a37afd645beb422653b95baa">lspg_queue_cond</a></td></tr>
<tr class="memdesc:a61a308b6a37afd645beb422653b95baa"><td class="mdescLeft">&#160;</td><td class="mdescRight">keeps the queue from overflowing  <a href="#a61a308b6a37afd645beb422653b95baa"></a><br/></td></tr>
<tr class="separator:a61a308b6a37afd645beb422653b95baa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af3f897b8ffa020ca54289bc5b28cb64d"><td class="memItemLeft" align="right" valign="top">static struct pollfd&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d">lspgfd</a></td></tr>
<tr class="memdesc:af3f897b8ffa020ca54289bc5b28cb64d"><td class="mdescLeft">&#160;</td><td class="mdescRight">our poll info  <a href="#af3f897b8ffa020ca54289bc5b28cb64d"></a><br/></td></tr>
<tr class="separator:af3f897b8ffa020ca54289bc5b28cb64d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a357d9d98f0b8c9625ccebcebfcdce955"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a357d9d98f0b8c9625ccebcebfcdce955">lspg_query_queue</a> [<a class="el" href="lspg_8c.html#a08fe83fe8226002ee8b80ce0a914fd11">LS_PG_QUERY_QUEUE_LENGTH</a>]</td></tr>
<tr class="memdesc:a357d9d98f0b8c9625ccebcebfcdce955"><td class="mdescLeft">&#160;</td><td class="mdescRight">Our query queue.  <a href="#a357d9d98f0b8c9625ccebcebfcdce955"></a><br/></td></tr>
<tr class="separator:a357d9d98f0b8c9625ccebcebfcdce955"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3cbe7f3161b3c1838ebc56a3bbcfd8a6"><td class="memItemLeft" align="right" valign="top">static unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6">lspg_query_queue_on</a> = 0</td></tr>
<tr class="memdesc:a3cbe7f3161b3c1838ebc56a3bbcfd8a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Next position to add something to the queue.  <a href="#a3cbe7f3161b3c1838ebc56a3bbcfd8a6"></a><br/></td></tr>
<tr class="separator:a3cbe7f3161b3c1838ebc56a3bbcfd8a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca86bb77d6cecfae9251743f4171bafb"><td class="memItemLeft" align="right" valign="top">static unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aca86bb77d6cecfae9251743f4171bafb">lspg_query_queue_off</a> = 0</td></tr>
<tr class="memdesc:aca86bb77d6cecfae9251743f4171bafb"><td class="mdescLeft">&#160;</td><td class="mdescRight">The last item still being used (on == off means nothing in queue)  <a href="#aca86bb77d6cecfae9251743f4171bafb"></a><br/></td></tr>
<tr class="separator:aca86bb77d6cecfae9251743f4171bafb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2603b071afdbff7c0924b13de2454264"><td class="memItemLeft" align="right" valign="top">static unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a2603b071afdbff7c0924b13de2454264">lspg_query_queue_reply</a> = 0</td></tr>
<tr class="memdesc:a2603b071afdbff7c0924b13de2454264"><td class="mdescLeft">&#160;</td><td class="mdescRight">The current item being digested.  <a href="#a2603b071afdbff7c0924b13de2454264"></a><br/></td></tr>
<tr class="separator:a2603b071afdbff7c0924b13de2454264"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9012783dbbadf652a81649a289697cf3"><td class="memItemLeft" align="right" valign="top">static PGconn *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3">q</a> = NULL</td></tr>
<tr class="memdesc:a9012783dbbadf652a81649a289697cf3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Database connector.  <a href="#a9012783dbbadf652a81649a289697cf3"></a><br/></td></tr>
<tr class="separator:a9012783dbbadf652a81649a289697cf3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9209da216af53c39e7c384b89a0f018"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ae9209da216af53c39e7c384b89a0f018">lspg_running</a> = 1</td></tr>
<tr class="memdesc:ae9209da216af53c39e7c384b89a0f018"><td class="mdescLeft">&#160;</td><td class="mdescRight">flag to tell worker it's time to go home  <a href="#ae9209da216af53c39e7c384b89a0f018"></a><br/></td></tr>
<tr class="separator:ae9209da216af53c39e7c384b89a0f018"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69ae04978986e6413ca7cefcb692b645"><td class="memItemLeft" align="right" valign="top">static PostgresPollingStatusType&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a69ae04978986e6413ca7cefcb692b645">lspg_connectPoll_response</a></td></tr>
<tr class="memdesc:a69ae04978986e6413ca7cefcb692b645"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used to determine state while connecting.  <a href="#a69ae04978986e6413ca7cefcb692b645"></a><br/></td></tr>
<tr class="separator:a69ae04978986e6413ca7cefcb692b645"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06c5a937e41a6c706a247777642ec1fb"><td class="memItemLeft" align="right" valign="top">static PostgresPollingStatusType&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a06c5a937e41a6c706a247777642ec1fb">lspg_resetPoll_response</a></td></tr>
<tr class="memdesc:a06c5a937e41a6c706a247777642ec1fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used to determine state while reconnecting.  <a href="#a06c5a937e41a6c706a247777642ec1fb"></a><br/></td></tr>
<tr class="separator:a06c5a937e41a6c706a247777642ec1fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbf70f382e469e02dce77833981f9547"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#a9dda9014cd0e39fba8d523e37cf9f982">lspg_nextsample_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547">lspg_nextsample</a></td></tr>
<tr class="memdesc:adbf70f382e469e02dce77833981f9547"><td class="mdescLeft">&#160;</td><td class="mdescRight">the very next sample  <a href="#adbf70f382e469e02dce77833981f9547"></a><br/></td></tr>
<tr class="separator:adbf70f382e469e02dce77833981f9547"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8d8e2f578ca79189a80c1fd5b60cefd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#a17ea2bf07a0b3b892baa00bd392607b3">lspg_nextshot_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd">lspg_nextshot</a></td></tr>
<tr class="memdesc:ad8d8e2f578ca79189a80c1fd5b60cefd"><td class="mdescLeft">&#160;</td><td class="mdescRight">the nextshot object  <a href="#ad8d8e2f578ca79189a80c1fd5b60cefd"></a><br/></td></tr>
<tr class="separator:ad8d8e2f578ca79189a80c1fd5b60cefd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ef8a09203117578c9b2ce4719519f36"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#a48b627e412dd038c1f17cdb0501eec33">lspg_getcenter_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36">lspg_getcenter</a></td></tr>
<tr class="memdesc:a7ef8a09203117578c9b2ce4719519f36"><td class="mdescLeft">&#160;</td><td class="mdescRight">the getcenter object  <a href="#a7ef8a09203117578c9b2ce4719519f36"></a><br/></td></tr>
<tr class="separator:a7ef8a09203117578c9b2ce4719519f36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf89a0299edd6a99992b95dff8992eba"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#a7f71abc6fdfd1839e2e3213d78aaf766">lspg_demandairrights_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#adf89a0299edd6a99992b95dff8992eba">lspg_demandairrights</a></td></tr>
<tr class="memdesc:adf89a0299edd6a99992b95dff8992eba"><td class="mdescLeft">&#160;</td><td class="mdescRight">our demandairrights object  <a href="#adf89a0299edd6a99992b95dff8992eba"></a><br/></td></tr>
<tr class="separator:adf89a0299edd6a99992b95dff8992eba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c50804e6019d47d91f3f1cb3ebd1f00"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#a7a794370785ff015d5ee035917e3bee8">lspg_getcurrentsampleid_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00">lspg_getcurrentsampleid</a></td></tr>
<tr class="memdesc:a5c50804e6019d47d91f3f1cb3ebd1f00"><td class="mdescLeft">&#160;</td><td class="mdescRight">our currentsample id  <a href="#a5c50804e6019d47d91f3f1cb3ebd1f00"></a><br/></td></tr>
<tr class="separator:a5c50804e6019d47d91f3f1cb3ebd1f00"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af18499d17171eff473cfc49d4a0a5562"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#aa1f0e602ae9509005c62fb2d73bc1c5a">lspg_starttransfer_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562">lspg_starttransfer</a></td></tr>
<tr class="memdesc:af18499d17171eff473cfc49d4a0a5562"><td class="mdescLeft">&#160;</td><td class="mdescRight">start a sample transfer  <a href="#af18499d17171eff473cfc49d4a0a5562"></a><br/></td></tr>
<tr class="separator:af18499d17171eff473cfc49d4a0a5562"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f699604dcc5d3d64fd6cb5c363d29c9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#a779e2acce8b5e748c184caf23ed0db57">lspg_waitcryo_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9">lspg_waitcryo</a></td></tr>
<tr class="memdesc:a5f699604dcc5d3d64fd6cb5c363d29c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">signal the robot  <a href="#a5f699604dcc5d3d64fd6cb5c363d29c9"></a><br/></td></tr>
<tr class="separator:a5f699604dcc5d3d64fd6cb5c363d29c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0dfc8d0410cd2d7f7da7a70d3ef88e58"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="lspg_8c.html#a6f273a499bf316de95df3816a9b1bc06">lspg_wait_for_detector_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58">lspg_wait_for_detector</a></td></tr>
<tr class="memdesc:a0dfc8d0410cd2d7f7da7a70d3ef88e58"><td class="mdescLeft">&#160;</td><td class="mdescRight">Instance of the detector timing object.  <a href="#a0dfc8d0410cd2d7f7da7a70d3ef88e58"></a><br/></td></tr>
<tr class="separator:a0dfc8d0410cd2d7f7da7a70d3ef88e58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaae7ce3ecd7d54a9e46c41d7a742a454"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="lspg_8c.html#a7232a0d630558f0c4c081d087150973d">lspg_lock_diffractometer_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a></td></tr>
<tr class="separator:aaae7ce3ecd7d54a9e46c41d7a742a454"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbf3b3652c6531c3d194320d1abc1c80"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="lspg_8c.html#a3442e66a1f05457eb22a0d4a5d295f3a">lspg_lock_detector_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a></td></tr>
<tr class="separator:adbf3b3652c6531c3d194320d1abc1c80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b0d9fc30bcea6905b075d2362149172"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="lspg_8c.html#ab2da550aea6388c835abe0ee0b226eb0">lspg_seq_run_prep_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a></td></tr>
<tr class="separator:a1b0d9fc30bcea6905b075d2362149172"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Postgresql support for the LS-CAT pgpmac project. </p>
<pre class="fragment">\date 2012
\author Keith Brister
\copyright All Rights Reserved
</pre><pre>
  Database state machine</pre><pre>State           Description</pre><pre> -4             Initiate connection
 -3             Poll until connection initialization is complete
 -2             Initiate reset
 -1             Poll until connection reset is complete
  1             Idle (wait for a notify from the server)
  2             Send a query to the server
  3             Continue flushing a command to the server
  4             Waiting for a reply
  5             Quitting: ignore new queries
</pre> 
<p>Definition in file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a08fe83fe8226002ee8b80ce0a914fd11"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_QUERY_QUEUE_LENGTH&#160;&#160;&#160;16384</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Queue length should be long enough that we do not ordinarly bump into the end We should be safe as long as the thread the adds stuff to the queue is not the one that removes it. </p>
<p>(And we can tolerate the adding thread being paused.) </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00052">52</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="aaf1dd8ba4dafb91c296554c4cbf312e3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_STATE_IDLE&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00034">34</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="af443092447378c73bf93aa143576aba4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_STATE_INIT&#160;&#160;&#160;-4</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00030">30</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae7ea5876846b5f04c419aee22d3c0aa1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_STATE_INIT_POLL&#160;&#160;&#160;-3</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00031">31</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9878a5ed7cb7c2b925a9f902e5ce8d4a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_STATE_QUITTING&#160;&#160;&#160;5</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00038">38</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a373e668840b4795ff9a71bc3f744d209"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_STATE_RECV&#160;&#160;&#160;4</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00037">37</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="accda8c3a598dc7f5b107b04986d8ab50"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_STATE_RESET&#160;&#160;&#160;-2</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00032">32</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac70a1141f3b138055ea7143bd493187c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_STATE_RESET_POLL&#160;&#160;&#160;-1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00033">33</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3c6eb19f262a990e1f9ba630d9edc309"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_STATE_SEND&#160;&#160;&#160;2</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00035">35</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a88a7e80c12fb0449c4b0857a0c7deb21"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_STATE_SEND_FLUSH&#160;&#160;&#160;3</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00036">36</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="a3442e66a1f05457eb22a0d4a5d295f3a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlspg__lock__detector__struct.html">lspg_lock_detector_struct</a>  <a class="el" href="lspg_8c.html#a3442e66a1f05457eb22a0d4a5d295f3a">lspg_lock_detector_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>lock detector object Implements detector lock for exposure control </p>

</div>
</div>
<a class="anchor" id="a7232a0d630558f0c4c081d087150973d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlspg__lock__diffractometer__struct.html">lspg_lock_diffractometer_struct</a>  <a class="el" href="lspg_8c.html#a7232a0d630558f0c4c081d087150973d">lspg_lock_diffractometer_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Object used to impliment locking the diffractometer Critical to exposure timing. </p>

</div>
</div>
<a class="anchor" id="ab2da550aea6388c835abe0ee0b226eb0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlspg__seq__run__prep__struct.html">lspg_seq_run_prep_struct</a>  <a class="el" href="lspg_8c.html#ab2da550aea6388c835abe0ee0b226eb0">lspg_seq_run_prep_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Data collection running object. </p>

</div>
</div>
<a class="anchor" id="a6f273a499bf316de95df3816a9b1bc06"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlspg__wait__for__detector__struct.html">lspg_wait_for_detector_struct</a>  <a class="el" href="lspg_8c.html#a6f273a499bf316de95df3816a9b1bc06">lspg_wait_for_detector_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Object that implements detector / spindle timing We use database locks for exposure control and this implements the md2 portion of this handshake. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="afb8d1ff1e0f4fcdc85ad9c684271cb3d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_allkvs_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>set a redis variable based on an updated kv pair </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">qqp</td><td>The query that elicited this response </td></tr>
    <tr><td class="paramname">pgr</td><td>The resonse from postgresql </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00284">284</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                                             {</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">  <a class="code" href="structlsredis__obj__struct.html" title="Redis Object Basic object whose value is sychronized with our redis db.">lsredis_obj_t</a> *robj;</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;PQntuples( pgr); i += 2) {</div>
<div class="line">    pthread_mutex_lock( &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>);</div>
<div class="line">    <span class="keywordflow">while</span>( <a class="code" href="lsredis_8c.html#a7461eb2b5974a2ffac2189007d39193c">lsredis_running</a> == 0)</div>
<div class="line">      pthread_cond_wait( &amp;<a class="code" href="lsredis_8c.html#a2f63408d16b5603541b124a78f36a5a8">lsredis_cond</a>, &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>);</div>
<div class="line">    pthread_mutex_unlock( &amp;<a class="code" href="lsredis_8c.html#a390e8acf789b0fa41b43a794dd27e28f">lsredis_mutex</a>);</div>
<div class="line"></div>
<div class="line">    robj = <a class="code" href="lsredis_8c.html#ac3fb8589e280bfa18ecbca6619fea637" title="Maybe add a new object Used internally for this module Must be called with lsredis_mutex locked...">_lsredis_get_obj</a>( PQgetvalue( pgr, i, 0));</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( robj == NULL) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspg_allkvs_cb: could not find redis object named &#39;%s&#39;&quot;</span>, PQgetvalue( pgr, i, 0));</div>
<div class="line">      <span class="keywordflow">continue</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lsredis_8c.html#a9b9c64f883c7ded60badfe89cb15fa78" title="Set the value and update redis.">lsredis_setstr</a>( robj, <span class="stringliteral">&quot;%s&quot;</span>, PQgetvalue( pgr, i+1, 0));</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ade0aad16c5ea2254c8cdc1539302c93b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_allkvs_error_cb </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00305">305</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                            {</div>
<div class="line">  <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;query error getting kvs&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a46f23ae999129d6fd5712d7975b99aed"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char** lspg_array2ptrs </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>a</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>returns a null terminated list of strings parsed from postgresql array </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00165">165</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                 {</div>
<div class="line">  <span class="keywordtype">char</span> **rtn, *sp, *acums;</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>, n, inquote, havebackslash, rtni;;</div>
<div class="line">  <span class="keywordtype">int</span> mxsz;</div>
<div class="line">  </div>
<div class="line">  inquote       = 0;</div>
<div class="line">  havebackslash = 0;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Despense with the null input condition before we complicate the code below</span></div>
<div class="line">  <span class="keywordflow">if</span>( a == NULL || a[0] != <span class="charliteral">&#39;{&#39;</span> || a[strlen(a)-1] != <span class="charliteral">&#39;}&#39;</span>)</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Count the maximum number of strings</span></div>
<div class="line">  <span class="comment">// Actual number will be less if there are quoted commas</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  n = 1;</div>
<div class="line">  <span class="keywordflow">for</span>( i=0; a[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>]; i++) {</div>
<div class="line">    <span class="keywordflow">if</span>( a[i] == <span class="charliteral">&#39;,&#39;</span>)</div>
<div class="line">      n++;</div>
<div class="line">  }</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// The maximum size of any string is the length of a (+1)</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  mxsz = strlen(a) + 1;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// This is the accumulation string to make up the array elements</span></div>
<div class="line">  acums = (<span class="keywordtype">char</span> *)calloc( mxsz, <span class="keyword">sizeof</span>( <span class="keywordtype">char</span>));</div>
<div class="line">  <span class="keywordflow">if</span>( acums == NULL) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspg_array2ptrs: out of memory (acums)&quot;</span>);</div>
<div class="line">    exit( 1);</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// allocate storage for the pointer array and the null terminator</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  rtn = (<span class="keywordtype">char</span> **)calloc( n+1, <span class="keyword">sizeof</span>( <span class="keywordtype">char</span> *));</div>
<div class="line">  <span class="keywordflow">if</span>( rtn == NULL) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspg_array2ptrs: out of memory (rtn)&quot;</span>);</div>
<div class="line">    exit( 1);</div>
<div class="line">  }</div>
<div class="line">  rtni = 0;</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Go through and create the individual strings</span></div>
<div class="line">  sp = acums;</div>
<div class="line">  *sp = 0;</div>
<div class="line"></div>
<div class="line">  inquote = 0;</div>
<div class="line">  havebackslash = 0;</div>
<div class="line">  <span class="keywordflow">for</span>( i=1; a[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>] != 0; i++) {</div>
<div class="line">    <span class="keywordflow">switch</span>( a[i]) {</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;&quot;&#39;</span>:</div>
<div class="line">      <span class="keywordflow">if</span>( havebackslash) {</div>
<div class="line">        <span class="comment">// a quoted quote.  Cool</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        *(sp++) = a[i];</div>
<div class="line">        *sp = 0;</div>
<div class="line">        havebackslash = 0;</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">// Toggle the flag</span></div>
<div class="line">        inquote = 1 - inquote;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;\\&#39;</span>:</div>
<div class="line">      <span class="keywordflow">if</span>( havebackslash) {</div>
<div class="line">        *(sp++) = a[i];</div>
<div class="line">        *sp = 0;</div>
<div class="line">        havebackslash = 0;</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        havebackslash = 1;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;,&#39;</span>:</div>
<div class="line">      <span class="keywordflow">if</span>( inquote || havebackslash) {</div>
<div class="line">        *(sp++) = a[i];</div>
<div class="line">        *sp = 0;</div>
<div class="line">        havebackslash = 0;</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        rtn[rtni++] = strdup( acums);</div>
<div class="line">        sp = acums;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">      </div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;}&#39;</span>:</div>
<div class="line">      <span class="keywordflow">if</span>( inquote || havebackslash) {</div>
<div class="line">        *(sp++) = a[i];</div>
<div class="line">        *sp = 0;</div>
<div class="line">        havebackslash = 0;</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        rtn[rtni++] = strdup( acums);</div>
<div class="line">        rtn[rtni]   = NULL;</div>
<div class="line">        free( acums);</div>
<div class="line">        <span class="keywordflow">return</span>( rtn);</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">      *(sp++) = a[i];</div>
<div class="line">      *sp = 0;</div>
<div class="line">      havebackslash = 0;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Getting here means the final &#39;}&#39; was missing</span></div>
<div class="line">  <span class="comment">// Probably we should throw an error or log it or something.</span></div>
<div class="line">  <span class="comment">// Through out the last entry since this there is not resonable expectation that</span></div>
<div class="line">  <span class="comment">// we should be parsing it anyway.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  rtn[rtni]   = NULL;</div>
<div class="line">  free( acums);</div>
<div class="line">  <span class="keywordflow">return</span>( rtn);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4710c50945fce26b4ac5dc01ed61459d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_check_preset_in_position_cb </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l02063">2063</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                                    {</div>
<div class="line">  <a class="code" href="structlspmac__motor__struct.html" title="Motor information.">lspmac_motor_t</a> *mp;</div>
<div class="line">  <span class="keywordtype">char</span> cp[64];</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;strlen( event); i++) {</div>
<div class="line">    cp[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>] = 0;</div>
<div class="line">    <span class="keywordflow">if</span>( event[i] == <span class="charliteral">&#39; &#39;</span>)</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    cp[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>] = <span class="keyword">event</span>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>];</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  mp = <a class="code" href="lspmac_8c.html#a22ef36819bdee963712691e660cfc101">lspmac_find_motor_by_name</a>( cp);</div>
<div class="line">  <span class="keywordflow">if</span>( mp == NULL) {</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line">  i = <a class="code" href="lsredis_8c.html#adfe823e3ccec7e37ac4697179bd65b10" title="For the given motor object return the index of the current preset or -1 if we are not at a preset pos...">lsredis_find_preset_index_by_position</a>( mp);</div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( NULL, NULL, <span class="stringliteral">&quot;EXECUTE kvupdate( &#39;{%s.currentPreset,%d}&#39;)&quot;</span>, cp, i);</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1e11f525ca0f9ac9ab71f9fbe983c42b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_cmd_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send strings directly to PMAC queue. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">qqp</td><td>Our query </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pgr</td><td>Our result </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01522">1522</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                   {</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Call back funciton assumes query results in zero or more commands to send to the PMAC</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">  <span class="keywordtype">char</span> *sp;</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;PQntuples( pgr); i++) {</div>
<div class="line">    sp = PQgetvalue( pgr, i, 0);</div>
<div class="line">    <span class="keywordflow">if</span>( sp != NULL &amp;&amp; *sp != 0) {</div>
<div class="line">      <a class="code" href="lspmac_8c.html#afab9e8f0502a92ee5cf93209af710f81" title="prepare (queue up) a line to send the dpram ascii command interface">lspmac_SockSendDPline</a>( NULL, sp);</div>
<div class="line">      <span class="comment">//      lspmac_SockSendline( sp);</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Keep asking for more until</span></div>
<div class="line">      <span class="comment">// there are no commands left</span></div>
<div class="line">      <span class="comment">// </span></div>
<div class="line">      <span class="comment">// This should solve a potential problem where</span></div>
<div class="line">      <span class="comment">// more than one command is put on the queue for a given notify.</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#a1e11f525ca0f9ac9ab71f9fbe983c42b" title="Send strings directly to PMAC queue.">lspg_cmd_cb</a>, <a class="code" href="lspg_8c.html#ad6cff8b4272907291da431eff274a51b">lspg_cmd_error_cb</a>, <span class="stringliteral">&quot;select pmac.md2_queue_next()&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad6cff8b4272907291da431eff274a51b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_cmd_error_cb </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01516">1516</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                         {</div>
<div class="line">  <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;query error getting next md2 command&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa4cad634cac645d0366acbb25cef7b96"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspg_demandairrights_all </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>do nothing until we get airrights </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00724">724</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                               {</div>
<div class="line">  <a class="code" href="lspg_8c.html#ae3f3ae783042eb1f5f2c37b517b7404a" title="call for airrights">lspg_demandairrights_call</a>();</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="lspg_8c.html#a79cc363874905f76f5607cca5dc9773a" title="wait for the air rights request to return">lspg_demandairrights_wait</a>();</div>
<div class="line">  <span class="comment">// there is no &quot;done&quot; version</span></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae3f3ae783042eb1f5f2c37b517b7404a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_demandairrights_call </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>call for airrights </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00701">701</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                 {</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#adf89a0299edd6a99992b95dff8992eba" title="our demandairrights object">lspg_demandairrights</a>.<a class="code" href="structlspg__demandairrights__struct.html#a874970af767d4bb329f9764075b30096">mutex</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#adf89a0299edd6a99992b95dff8992eba" title="our demandairrights object">lspg_demandairrights</a>.<a class="code" href="structlspg__demandairrights__struct.html#ad686c9a04d0c7e10b236c234eaf03ce7">new_value_ready</a> = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#adf89a0299edd6a99992b95dff8992eba" title="our demandairrights object">lspg_demandairrights</a>.<a class="code" href="structlspg__demandairrights__struct.html#ae3d1f2e51c623ecefefd87728905475d" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a>     = 0;</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#adf89a0299edd6a99992b95dff8992eba" title="our demandairrights object">lspg_demandairrights</a>.<a class="code" href="structlspg__demandairrights__struct.html#a874970af767d4bb329f9764075b30096">mutex</a>);</div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#a208134de0d5bbbdaf5589126d46f1c4e" title="handle the airrights response">lspg_demandairrights_cb</a>, <a class="code" href="lspg_8c.html#a705d2b323797dde2b5b41925dba84c8b" title="handle airrights query error">lspg_demandairrights_error_cb</a>, <span class="stringliteral">&quot;SELECT px.demandairrights()&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a208134de0d5bbbdaf5589126d46f1c4e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_demandairrights_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>handle the airrights response </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00683">683</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                                                      {</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#adf89a0299edd6a99992b95dff8992eba" title="our demandairrights object">lspg_demandairrights</a>.<a class="code" href="structlspg__demandairrights__struct.html#a874970af767d4bb329f9764075b30096">mutex</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#adf89a0299edd6a99992b95dff8992eba" title="our demandairrights object">lspg_demandairrights</a>.<a class="code" href="structlspg__demandairrights__struct.html#ad686c9a04d0c7e10b236c234eaf03ce7">new_value_ready</a> = 1;</div>
<div class="line">  pthread_cond_signal( &amp;<a class="code" href="lspg_8c.html#adf89a0299edd6a99992b95dff8992eba" title="our demandairrights object">lspg_demandairrights</a>.<a class="code" href="structlspg__demandairrights__struct.html#addc1e3476a3f282a19b335f7875861d1">cond</a>);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#adf89a0299edd6a99992b95dff8992eba" title="our demandairrights object">lspg_demandairrights</a>.<a class="code" href="structlspg__demandairrights__struct.html#a874970af767d4bb329f9764075b30096">mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a705d2b323797dde2b5b41925dba84c8b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_demandairrights_error_cb </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>handle airrights query error </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00692">692</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                     {</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#adf89a0299edd6a99992b95dff8992eba" title="our demandairrights object">lspg_demandairrights</a>.<a class="code" href="structlspg__demandairrights__struct.html#a874970af767d4bb329f9764075b30096">mutex</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#adf89a0299edd6a99992b95dff8992eba" title="our demandairrights object">lspg_demandairrights</a>.<a class="code" href="structlspg__demandairrights__struct.html#ae3d1f2e51c623ecefefd87728905475d" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a> = 1;</div>
<div class="line">  pthread_cond_signal( &amp;<a class="code" href="lspg_8c.html#adf89a0299edd6a99992b95dff8992eba" title="our demandairrights object">lspg_demandairrights</a>.<a class="code" href="structlspg__demandairrights__struct.html#addc1e3476a3f282a19b335f7875861d1">cond</a>);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#adf89a0299edd6a99992b95dff8992eba" title="our demandairrights object">lspg_demandairrights</a>.<a class="code" href="structlspg__demandairrights__struct.html#a874970af767d4bb329f9764075b30096">mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a61e47be0d5d7154700e7e5edb889852e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_demandairrights_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>initialize the demandairrights structure </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00674">674</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                 {</div>
<div class="line">  <a class="code" href="lspg_8c.html#adf89a0299edd6a99992b95dff8992eba" title="our demandairrights object">lspg_demandairrights</a>.<a class="code" href="structlspg__demandairrights__struct.html#ad686c9a04d0c7e10b236c234eaf03ce7">new_value_ready</a> = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#adf89a0299edd6a99992b95dff8992eba" title="our demandairrights object">lspg_demandairrights</a>.<a class="code" href="structlspg__demandairrights__struct.html#ae3d1f2e51c623ecefefd87728905475d" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a>     = 0;</div>
<div class="line">  pthread_mutex_init( &amp;<a class="code" href="lspg_8c.html#adf89a0299edd6a99992b95dff8992eba" title="our demandairrights object">lspg_demandairrights</a>.<a class="code" href="structlspg__demandairrights__struct.html#a874970af767d4bb329f9764075b30096">mutex</a>, NULL);</div>
<div class="line">  pthread_cond_init( &amp;<a class="code" href="lspg_8c.html#adf89a0299edd6a99992b95dff8992eba" title="our demandairrights object">lspg_demandairrights</a>.<a class="code" href="structlspg__demandairrights__struct.html#addc1e3476a3f282a19b335f7875861d1">cond</a>, NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a79cc363874905f76f5607cca5dc9773a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspg_demandairrights_wait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>wait for the air rights request to return </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00711">711</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                {</div>
<div class="line">  <span class="keywordtype">int</span> rtn;</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#adf89a0299edd6a99992b95dff8992eba" title="our demandairrights object">lspg_demandairrights</a>.<a class="code" href="structlspg__demandairrights__struct.html#a874970af767d4bb329f9764075b30096">mutex</a>);</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lspg_8c.html#adf89a0299edd6a99992b95dff8992eba" title="our demandairrights object">lspg_demandairrights</a>.<a class="code" href="structlspg__demandairrights__struct.html#ad686c9a04d0c7e10b236c234eaf03ce7">new_value_ready</a> == 0 &amp;&amp; <a class="code" href="lspg_8c.html#adf89a0299edd6a99992b95dff8992eba" title="our demandairrights object">lspg_demandairrights</a>.<a class="code" href="structlspg__demandairrights__struct.html#ae3d1f2e51c623ecefefd87728905475d" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;<a class="code" href="lspg_8c.html#adf89a0299edd6a99992b95dff8992eba" title="our demandairrights object">lspg_demandairrights</a>.<a class="code" href="structlspg__demandairrights__struct.html#addc1e3476a3f282a19b335f7875861d1">cond</a>, &amp;<a class="code" href="lspg_8c.html#adf89a0299edd6a99992b95dff8992eba" title="our demandairrights object">lspg_demandairrights</a>.<a class="code" href="structlspg__demandairrights__struct.html#a874970af767d4bb329f9764075b30096">mutex</a>);</div>
<div class="line">  rtn = <a class="code" href="lspg_8c.html#adf89a0299edd6a99992b95dff8992eba" title="our demandairrights object">lspg_demandairrights</a>.<a class="code" href="structlspg__demandairrights__struct.html#ae3d1f2e51c623ecefefd87728905475d" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a>;</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#adf89a0299edd6a99992b95dff8992eba" title="our demandairrights object">lspg_demandairrights</a>.<a class="code" href="structlspg__demandairrights__struct.html#a874970af767d4bb329f9764075b30096">mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af6485ac1749c5de3008dd0e0badaa09c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_flush </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Flush psql output buffer (ie, send the query) </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01552">1552</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                  {</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line"></div>
<div class="line">  err = PQflush( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">  <span class="keywordflow">switch</span>( err) {</div>
<div class="line">  <span class="keywordflow">case</span> -1:</div>
<div class="line">    <span class="comment">// an error occured</span></div>
<div class="line"></div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;flush failed: %s&quot;</span>, PQerrorMessage( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>));</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a>;</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// We should probably reset the connection and start from scratch.  Probably the connection died.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">          </div>
<div class="line">  <span class="keywordflow">case</span> 0:</div>
<div class="line">    <span class="comment">// goodness and joy.</span></div>
<div class="line">    <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#a373e668840b4795ff9a71bc3f744d209">LS_PG_STATE_RECV</a>;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> 1:</div>
<div class="line">    <span class="comment">// more sending to do</span></div>
<div class="line">    <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#a88a7e80c12fb0449c4b0857a0c7deb21">LS_PG_STATE_SEND_FLUSH</a>;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a523b492d9cd4970853eabee2d3c31578"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_getcenter_all </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convenience function to complete synchronous getcenter query. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01449">1449</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  <a class="code" href="lspg_8c.html#a6f7cd0a06f6a266ef65b3604cf33d6c4" title="Request a getcenter query.">lspg_getcenter_call</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a3e0e4b3cb9fa03961ee0c104e0b06754" title="Wait for a getcenter query to return.">lspg_getcenter_wait</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a7c678553b44c874d08ec9966ed7bb1c0" title="Done with getcenter query.">lspg_getcenter_done</a>();</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6f7cd0a06f6a266ef65b3604cf33d6c4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_getcenter_call </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Request a getcenter query. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01424">1424</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                           {</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a214bb7e88b137162f13f41f2c43002a9" title="don&#39;t let the threads collide!">mutex</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a4b350f11f1e375b9e9e839caaffbcb6b" title="used with condition">new_value_ready</a> = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a0d1be4b8199bc5ec781c3df2211335aa" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a>     = 0;</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a214bb7e88b137162f13f41f2c43002a9" title="don&#39;t let the threads collide!">mutex</a>);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#a8184824f2b71b1d35141d7922ca69cd7" title="Retrieve the data to center the crystal.">lspg_getcenter_cb</a>, <a class="code" href="lspg_8c.html#a42a5e614dc36938e4897ea3c038d4dc2" title="getcenter query error callback">lspg_getcenter_error_cb</a>, <span class="stringliteral">&quot;SELECT * FROM px.getcenter2()&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8184824f2b71b1d35141d7922ca69cd7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_getcenter_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieve the data to center the crystal. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01344">1344</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                                                {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">    zoom_c, dcx_c, dcy_c, dax_c, day_c, daz_c, hash_c;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a214bb7e88b137162f13f41f2c43002a9" title="don&#39;t let the threads collide!">mutex</a>));</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#aaeb0ccf4289b4fb306c2bc04ae85b237" title="flag in case no centering information was forthcoming">no_rows_returned</a> = PQntuples( pgr) &lt;= 0;</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#aaeb0ccf4289b4fb306c2bc04ae85b237" title="flag in case no centering information was forthcoming">no_rows_returned</a>) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// No particular reason this path should ever be taken</span></div>
<div class="line">    <span class="comment">// but if we don&#39;t get rows then we had better not move anything.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a4b350f11f1e375b9e9e839caaffbcb6b" title="used with condition">new_value_ready</a> = 1;</div>
<div class="line">    pthread_cond_signal( &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#ae0db0ff2608ab5ba3e7c1b4ad3fc0e91" title="provides signaling for when the query is done">cond</a>));</div>
<div class="line">    pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a214bb7e88b137162f13f41f2c43002a9" title="don&#39;t let the threads collide!">mutex</a>));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  zoom_c = PQfnumber( pgr, <span class="stringliteral">&quot;zoom&quot;</span>);</div>
<div class="line">  dcx_c  = PQfnumber( pgr, <span class="stringliteral">&quot;dcx&quot;</span>);</div>
<div class="line">  dcy_c  = PQfnumber( pgr, <span class="stringliteral">&quot;dcy&quot;</span>);</div>
<div class="line">  dax_c  = PQfnumber( pgr, <span class="stringliteral">&quot;dax&quot;</span>);</div>
<div class="line">  day_c  = PQfnumber( pgr, <span class="stringliteral">&quot;day&quot;</span>);</div>
<div class="line">  daz_c  = PQfnumber( pgr, <span class="stringliteral">&quot;daz&quot;</span>);</div>
<div class="line">  hash_c = PQfnumber( pgr, <span class="stringliteral">&quot;hash&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a6ca85a8de29039188357b2814acd7803">zoom_isnull</a> = PQgetisnull( pgr, 0, zoom_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a6ca85a8de29039188357b2814acd7803">zoom_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a63e640a925611d2404a1529aea30a853" title="the next zoom level to go to before taking the next movie">zoom</a> = atoi( PQgetvalue( pgr, 0, zoom_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#aa404da85af654998f039c81a77626748">dcx_isnull</a> = PQgetisnull( pgr, 0, dcx_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#aa404da85af654998f039c81a77626748">dcx_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#ade0534056296e9ed568404c538be9227" title="center x change">dcx</a> = atof( PQgetvalue( pgr, 0, dcx_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a352c48c8d443c52f18ebd13019d01684">dcy_isnull</a> = PQgetisnull( pgr, 0, dcy_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a352c48c8d443c52f18ebd13019d01684">dcy_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a55b1a488b714e6a40d8e06a6e182bd0a" title="center y change">dcy</a> = atof( PQgetvalue( pgr, 0, dcy_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a621b489777d61e9db8b33b784b8d70f9">dax_isnull</a> = PQgetisnull( pgr, 0, dax_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a621b489777d61e9db8b33b784b8d70f9">dax_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a17db52848c28852a470222ec93ae8886" title="alignment x change">dax</a> = atof( PQgetvalue( pgr, 0, dax_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a36f57a319288810caf365cca7827ff96">day_isnull</a> = PQgetisnull( pgr, 0, day_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a36f57a319288810caf365cca7827ff96">day_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a9ce0f29540f2ff47be9788565d19f1b8" title="alignment y change">day</a> = atof( PQgetvalue( pgr, 0, day_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a36742b6bd0f4bf9356414930ba893617">daz_isnull</a> = PQgetisnull( pgr, 0, daz_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a36742b6bd0f4bf9356414930ba893617">daz_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a1170bab2161f03ab29c39f79519ed9ae" title="alignment z change">daz</a> = atof( PQgetvalue( pgr, 0, daz_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a5c4814bcb0a2d68a1d79dfd5790c66f8">hash_isnull</a> = PQgetisnull( pgr, 0, hash_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a25ec9de09c01ce75f020605fe2bc38d9" title="identifies this centering attempt">hash</a> != NULL)</div>
<div class="line">    free( <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a25ec9de09c01ce75f020605fe2bc38d9" title="identifies this centering attempt">hash</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a25ec9de09c01ce75f020605fe2bc38d9" title="identifies this centering attempt">hash</a> = strdup( PQgetvalue( pgr, 0, hash_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a4b350f11f1e375b9e9e839caaffbcb6b" title="used with condition">new_value_ready</a> = 1;</div>
<div class="line"></div>
<div class="line">  pthread_cond_signal( &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#ae0db0ff2608ab5ba3e7c1b4ad3fc0e91" title="provides signaling for when the query is done">cond</a>));</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a214bb7e88b137162f13f41f2c43002a9" title="don&#39;t let the threads collide!">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7c678553b44c874d08ec9966ed7bb1c0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_getcenter_done </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Done with getcenter query. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01443">1443</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                           {</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a214bb7e88b137162f13f41f2c43002a9" title="don&#39;t let the threads collide!">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a42a5e614dc36938e4897ea3c038d4dc2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_getcenter_error_cb </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>getcenter query error callback </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01407">1407</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                               {</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a214bb7e88b137162f13f41f2c43002a9" title="don&#39;t let the threads collide!">mutex</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a0d1be4b8199bc5ec781c3df2211335aa" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a> = 1;</div>
<div class="line">  pthread_cond_signal( &amp;<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#ae0db0ff2608ab5ba3e7c1b4ad3fc0e91" title="provides signaling for when the query is done">cond</a>);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a214bb7e88b137162f13f41f2c43002a9" title="don&#39;t let the threads collide!">mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad31db17587a02302ac4e40fb7d260b1b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_getcenter_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize getcenter object. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01416">1416</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                           {</div>
<div class="line">  memset( &amp;<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>, 0, <span class="keyword">sizeof</span>( <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>));</div>
<div class="line">  pthread_mutex_init( &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a214bb7e88b137162f13f41f2c43002a9" title="don&#39;t let the threads collide!">mutex</a>), NULL);</div>
<div class="line">  pthread_cond_init( &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#ae0db0ff2608ab5ba3e7c1b4ad3fc0e91" title="provides signaling for when the query is done">cond</a>), NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3e0e4b3cb9fa03961ee0c104e0b06754"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_getcenter_wait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for a getcenter query to return. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01435">1435</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                           {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a214bb7e88b137162f13f41f2c43002a9" title="don&#39;t let the threads collide!">mutex</a>));</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a4b350f11f1e375b9e9e839caaffbcb6b" title="used with condition">new_value_ready</a> == 0 &amp;&amp; <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a0d1be4b8199bc5ec781c3df2211335aa" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#ae0db0ff2608ab5ba3e7c1b4ad3fc0e91" title="provides signaling for when the query is done">cond</a>), &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a214bb7e88b137162f13f41f2c43002a9" title="don&#39;t let the threads collide!">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a39ff432056655f9dbe0f0239668caf74"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int lspg_getcurrentsampleid_all </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>return the current sampleid </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00510">510</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                           {</div>
<div class="line">  <a class="code" href="lspg_8c.html#acf98a9e2adec05a69847045f444a5c77">lspg_getcurrentsampleid_call</a>();</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="lspg_8c.html#a7b070b4891f485b7f74c95e0e60471f3">lspg_getcurrentsampleid_read</a>();</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="acf98a9e2adec05a69847045f444a5c77"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_getcurrentsampleid_call </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00482">482</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                    {</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ace54acbdcbce620437962858ba04e256" title="practice safe threading">mutex</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ada3840f03195ee1807150f1e75fd3775" title="OK, there is never a value, we need a variable for the conditional wait and this is what we call it e...">new_value_ready</a> = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ac81d3b649befe470ef32453c9b83d334" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a>     = 0;</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ace54acbdcbce620437962858ba04e256" title="practice safe threading">mutex</a>);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#a3245894737f9b496b7882c6e6ed8519d" title="get currentsampleid">lspg_getcurrentsampleid_cb</a>, <a class="code" href="lspg_8c.html#a0a0d183cfae389da62dcedee4c1598fa" title="get currentsampleid error callback">lspg_getcurrentsampleid_error_cb</a>, <span class="stringliteral">&quot;SELECT px.getcurrentsampleid()&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3245894737f9b496b7882c6e6ed8519d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_getcurrentsampleid_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>get currentsampleid </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00452">452</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                                                         {</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ace54acbdcbce620437962858ba04e256" title="practice safe threading">mutex</a>);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ada3840f03195ee1807150f1e75fd3775" title="OK, there is never a value, we need a variable for the conditional wait and this is what we call it e...">new_value_ready</a> = 1;</div>
<div class="line">  <a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#a06758730db55730eb10d2d63e2520d71" title="flag for an empty return">no_rows_returned</a> = PQntuples( pgr) &lt;= 0;</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#a06758730db55730eb10d2d63e2520d71" title="flag for an empty return">no_rows_returned</a>) {</div>
<div class="line">    pthread_cond_signal( &amp;<a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#a289960e45fdc9339a05dc8607f1b7563" title="for signaling">cond</a>);</div>
<div class="line">    pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ace54acbdcbce620437962858ba04e256" title="practice safe threading">mutex</a>);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#af370f8d1aaec7dd15121dc65d2a6cfc1" title="the sample we think is mounted on the diffractometer">getcurrentsampleid_isnull</a> = PQgetisnull( pgr, 0, 0);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#af370f8d1aaec7dd15121dc65d2a6cfc1" title="the sample we think is mounted on the diffractometer">getcurrentsampleid_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#af629de1e076fd6763bccea3547ef24e7" title="the sample we think is mounted on the diffractometer">getcurrentsampleid</a> = strtol( PQgetvalue( pgr, 0, 0), NULL, 0);</div>
<div class="line"></div>
<div class="line">  pthread_cond_signal( &amp;<a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#a289960e45fdc9339a05dc8607f1b7563" title="for signaling">cond</a>);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ace54acbdcbce620437962858ba04e256" title="practice safe threading">mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0a0d183cfae389da62dcedee4c1598fa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_getcurrentsampleid_error_cb </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>get currentsampleid error callback </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00473">473</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                        {</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ace54acbdcbce620437962858ba04e256" title="practice safe threading">mutex</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ac81d3b649befe470ef32453c9b83d334" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a> = 1;</div>
<div class="line">  pthread_cond_signal( &amp;<a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#a289960e45fdc9339a05dc8607f1b7563" title="for signaling">cond</a>);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ace54acbdcbce620437962858ba04e256" title="practice safe threading">mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5d6f6c4733629fc14e4f0bc128a1ffb7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_getcurrentsampleid_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00443">443</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                    {</div>
<div class="line">  <a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ada3840f03195ee1807150f1e75fd3775" title="OK, there is never a value, we need a variable for the conditional wait and this is what we call it e...">new_value_ready</a> = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ac81d3b649befe470ef32453c9b83d334" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a>     = 0;</div>
<div class="line">  pthread_mutex_init( &amp;<a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ace54acbdcbce620437962858ba04e256" title="practice safe threading">mutex</a>, NULL);</div>
<div class="line">  pthread_cond_init( &amp;<a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#a289960e45fdc9339a05dc8607f1b7563" title="for signaling">cond</a>, NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7b070b4891f485b7f74c95e0e60471f3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int lspg_getcurrentsampleid_read </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00493">493</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                            {</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rtn;</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ace54acbdcbce620437962858ba04e256" title="practice safe threading">mutex</a>);</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ada3840f03195ee1807150f1e75fd3775" title="OK, there is never a value, we need a variable for the conditional wait and this is what we call it e...">new_value_ready</a> == 0 &amp;&amp; <a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ac81d3b649befe470ef32453c9b83d334" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;<a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#a289960e45fdc9339a05dc8607f1b7563" title="for signaling">cond</a>, &amp;<a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ace54acbdcbce620437962858ba04e256" title="practice safe threading">mutex</a>);</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#af370f8d1aaec7dd15121dc65d2a6cfc1" title="the sample we think is mounted on the diffractometer">getcurrentsampleid_isnull</a> || <a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ac81d3b649befe470ef32453c9b83d334" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a> != 0)</div>
<div class="line">    rtn = -1;</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    rtn = <a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#af629de1e076fd6763bccea3547ef24e7" title="the sample we think is mounted on the diffractometer">getcurrentsampleid</a>;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ace54acbdcbce620437962858ba04e256" title="practice safe threading">mutex</a>);</div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a02d7dc2b8b8667b07b48d9147eb4621d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspg_getcurrentsampleid_wait_for_id </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>test</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00517">517</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                                            {</div>
<div class="line">  <span class="keywordtype">int</span> rtn;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ace54acbdcbce620437962858ba04e256" title="practice safe threading">mutex</a>);</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#af629de1e076fd6763bccea3547ef24e7" title="the sample we think is mounted on the diffractometer">getcurrentsampleid</a> != test &amp;&amp; <a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ac81d3b649befe470ef32453c9b83d334" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;<a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#a289960e45fdc9339a05dc8607f1b7563" title="for signaling">cond</a>, &amp;<a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ace54acbdcbce620437962858ba04e256" title="practice safe threading">mutex</a>);</div>
<div class="line">  </div>
<div class="line">  rtn = <a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ac81d3b649befe470ef32453c9b83d334" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a>;</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#a5c50804e6019d47d91f3f1cb3ebd1f00" title="our currentsample id">lspg_getcurrentsampleid</a>.<a class="code" href="structlspg__getcurrentsampleid__struct.html#ace54acbdcbce620437962858ba04e256" title="practice safe threading">mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8a77972df14166e05c94ed0792baa09b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initiallize the lspg module. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l02161">2161</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                 {</div>
<div class="line">  pthread_mutex_init( &amp;<a class="code" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4" title="keep the queue from getting tangled">lspg_queue_mutex</a>, NULL);</div>
<div class="line">  pthread_cond_init( &amp;<a class="code" href="lspg_8c.html#a61a308b6a37afd645beb422653b95baa" title="keeps the queue from overflowing">lspg_queue_cond</a>, NULL);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#a61e47be0d5d7154700e7e5edb889852e" title="initialize the demandairrights structure">lspg_demandairrights_init</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad31db17587a02302ac4e40fb7d260b1b" title="Initialize getcenter object.">lspg_getcenter_init</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a5d6f6c4733629fc14e4f0bc128a1ffb7">lspg_getcurrentsampleid_init</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a0e9bbf847dadfe0d10830d67824d9be8" title="Initialize detector lock object.">lspg_lock_detector_init</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a39bb94f8e0d47702b2b920a3dee61ebc" title="initialize the diffractometer locking object">lspg_lock_diffractometer_init</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a2faa901ea0a8ef00cfd93a893b34b446" title="Initialize the nextsample variable, mutex, and condition.">lspg_nextsample_init</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#aff91db7d60e6c832684c023813e36dbf" title="Initialize the nextshot variable, mutex, and condition.">lspg_nextshot_init</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a31823ecb2b44d4a6674f804059a27bce" title="Initialize the data collection object.">lspg_seq_run_prep_init</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#ab98f7d254fa0f5f4826f9427ca8b4f03">lspg_starttransfer_init</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a3517f8fbed91c998f6036284f9bd0c48" title="initialize the detector timing object">lspg_wait_for_detector_init</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a32b2bf00d66ee5fca130ee616a09cf7b">lspg_waitcryo_init</a>();</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aff93d2f5ac31aa249a0bef40a3837c84"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_detector_all </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Detector lock convinence function. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01238">1238</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                              {</div>
<div class="line">  <a class="code" href="lspg_8c.html#a5f71a20cc297684b2afe28e7bd8e8383" title="Request (demand) a detector lock.">lspg_lock_detector_call</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad3d9c56bd3ca6bcc43db30872cc441cc" title="Wait for the detector lock.">lspg_lock_detector_wait</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a1b567040693ff6e2932a2477045d75fa" title="Finish waiting.">lspg_lock_detector_done</a>();</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5f71a20cc297684b2afe28e7bd8e8383"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_detector_call </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Request (demand) a detector lock. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01213">1213</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                               {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#ab5ab5534b376a8fbafdd0b54cec4483c">mutex</a>));</div>
<div class="line">  <a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#a62373414b815fe178edd8522b3bd4d78">new_value_ready</a> = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#afdad2787564475cac316153d117c3748">query_error</a>     = 0;</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#ab5ab5534b376a8fbafdd0b54cec4483c">mutex</a>));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#aa760191c2b443170cebbcbf5ea5345f3" title="Callback for when the detector lock has be grabbed.">lspg_lock_detector_cb</a>, <a class="code" href="lspg_8c.html#a1c4869c73a26328109c40f33693ef77d" title="lock detector query error callback">lspg_lock_detector_error_cb</a>, <span class="stringliteral">&quot;SELECT px.lock_detector()&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa760191c2b443170cebbcbf5ea5345f3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_detector_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback for when the detector lock has be grabbed. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01195">1195</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                                                    {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#ab5ab5534b376a8fbafdd0b54cec4483c">mutex</a>));</div>
<div class="line">  <a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#a62373414b815fe178edd8522b3bd4d78">new_value_ready</a> = 1;</div>
<div class="line">  pthread_cond_signal( &amp;(<a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#adc90c859665dccc8717219e824cba0b8">cond</a>));</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#ab5ab5534b376a8fbafdd0b54cec4483c">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1b567040693ff6e2932a2477045d75fa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_detector_done </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Finish waiting. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01232">1232</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                               {</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#ab5ab5534b376a8fbafdd0b54cec4483c">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1c4869c73a26328109c40f33693ef77d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_detector_error_cb </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>lock detector query error callback </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01204">1204</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                   {</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#ab5ab5534b376a8fbafdd0b54cec4483c">mutex</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#afdad2787564475cac316153d117c3748">query_error</a> = 1;</div>
<div class="line">  pthread_cond_signal( &amp;<a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#adc90c859665dccc8717219e824cba0b8">cond</a>);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#ab5ab5534b376a8fbafdd0b54cec4483c">mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0e9bbf847dadfe0d10830d67824d9be8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_detector_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize detector lock object. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01186">1186</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                               {</div>
<div class="line">  <a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#a62373414b815fe178edd8522b3bd4d78">new_value_ready</a> = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#afdad2787564475cac316153d117c3748">query_error</a>     = 0;</div>
<div class="line">  pthread_mutex_init( &amp;(<a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#ab5ab5534b376a8fbafdd0b54cec4483c">mutex</a>), NULL);</div>
<div class="line">  pthread_cond_init(  &amp;(<a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#adc90c859665dccc8717219e824cba0b8">cond</a>),  NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad3d9c56bd3ca6bcc43db30872cc441cc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_detector_wait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for the detector lock. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01224">1224</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                               {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#ab5ab5534b376a8fbafdd0b54cec4483c">mutex</a>));</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#a62373414b815fe178edd8522b3bd4d78">new_value_ready</a> == 0 &amp;&amp; <a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#afdad2787564475cac316153d117c3748">query_error</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;(<a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#adc90c859665dccc8717219e824cba0b8">cond</a>), &amp;(<a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#ab5ab5534b376a8fbafdd0b54cec4483c">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a88b33e75c42197740b157a51ea726f21"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_diffractometer_all </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convience function that combines lock diffractometer calls. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01167">1167</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                    {</div>
<div class="line">  <a class="code" href="lspg_8c.html#ac5ebeb38e8e9926a52f024fe76201175" title="Request that the database grab the diffractometer lock.">lspg_lock_diffractometer_call</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a8445e1dec753f2c517b87fcb9c5b5943" title="Wait for the diffractometer lock.">lspg_lock_diffractometer_wait</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a88b33e75c42197740b157a51ea726f21" title="Convience function that combines lock diffractometer calls.">lspg_lock_diffractometer_all</a>();</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac5ebeb38e8e9926a52f024fe76201175"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_diffractometer_call </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Request that the database grab the diffractometer lock. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01142">1142</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                     {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a362e848dfd1551428b8d12d8776fd2ed">mutex</a>));</div>
<div class="line">  <a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#ae94acdf44008ce48930e3083f08f5b6c">new_value_ready</a> = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a49980d7db2189df39987468a75a1f5f7">query_error</a>     = 0;</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a362e848dfd1551428b8d12d8776fd2ed">mutex</a>));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#aad4f378f37c0030634dafa0d9445d916" title="Callback routine for a lock diffractometer query.">lspg_lock_diffractometer_cb</a>, <a class="code" href="lspg_8c.html#a446af872041c0a4f6151b442c92d025b" title="lock diffractometer query error callback">lspg_lock_diffractometer_error_cb</a>, <span class="stringliteral">&quot;SELECT px.lock_diffractomter()&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aad4f378f37c0030634dafa0d9445d916"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_diffractometer_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback routine for a lock diffractometer query. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01124">1124</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                                                          {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a362e848dfd1551428b8d12d8776fd2ed">mutex</a>));</div>
<div class="line">  <a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#ae94acdf44008ce48930e3083f08f5b6c">new_value_ready</a> = 1;</div>
<div class="line">  pthread_cond_signal( &amp;(<a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a7614c802af37c1d3358479a2c13ac898">cond</a>));</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a362e848dfd1551428b8d12d8776fd2ed">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a75aaf0b3fe33530062226c69a33ce821"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_diffractometer_done </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Finish up the lock diffractometer call. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01161">1161</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                     {</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a362e848dfd1551428b8d12d8776fd2ed">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a446af872041c0a4f6151b442c92d025b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_diffractometer_error_cb </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>lock diffractometer query error callback </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01133">1133</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                         {</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a362e848dfd1551428b8d12d8776fd2ed">mutex</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a49980d7db2189df39987468a75a1f5f7">query_error</a> = 1;</div>
<div class="line">  pthread_cond_signal( &amp;<a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a7614c802af37c1d3358479a2c13ac898">cond</a>);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a362e848dfd1551428b8d12d8776fd2ed">mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a39bb94f8e0d47702b2b920a3dee61ebc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_diffractometer_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>initialize the diffractometer locking object </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01115">1115</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                     {</div>
<div class="line">  <a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#ae94acdf44008ce48930e3083f08f5b6c">new_value_ready</a> = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a49980d7db2189df39987468a75a1f5f7">query_error</a>     = 0;</div>
<div class="line">  pthread_mutex_init( &amp;(<a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a362e848dfd1551428b8d12d8776fd2ed">mutex</a>), NULL);</div>
<div class="line">  pthread_cond_init(  &amp;(<a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a7614c802af37c1d3358479a2c13ac898">cond</a>), NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8445e1dec753f2c517b87fcb9c5b5943"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_diffractometer_wait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for the diffractometer lock. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01153">1153</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                     {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a362e848dfd1551428b8d12d8776fd2ed">mutex</a>));</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#ae94acdf44008ce48930e3083f08f5b6c">new_value_ready</a> == 0 &amp;&amp; <a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a49980d7db2189df39987468a75a1f5f7">query_error</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;(<a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a7614c802af37c1d3358479a2c13ac898">cond</a>), &amp;(<a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a362e848dfd1551428b8d12d8776fd2ed">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab52a8c8245bf6561f40c0f224fc07ff4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_next_state </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Implements our state machine Does not strictly only set the next state as it also calls some functions that, perhaps, alters the state mid-function. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01915">1915</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                       {</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// connect to the database</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a> == NULL ||</div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a> ||</div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a> ||</div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#ae7ea5876846b5f04c419aee22d3c0aa1">LS_PG_STATE_INIT_POLL</a> ||</div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#ac70a1141f3b138055ea7143bd493187c">LS_PG_STATE_RESET_POLL</a>)</div>
<div class="line">    <a class="code" href="kvredis_8c.html#a581c18be0368425665a40b4b7f7d9714" title="Connect to the pg server.">lspg_pg_connect</a>( <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a> &amp;&amp; <a class="code" href="lspg_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6" title="Next position to add something to the queue.">lspg_query_queue_on</a> != <a class="code" href="lspg_8c.html#aca86bb77d6cecfae9251743f4171bafb" title="The last item still being used (on == off means nothing in queue)">lspg_query_queue_off</a>)</div>
<div class="line">    <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#a3c6eb19f262a990e1f9ba630d9edc309">LS_PG_STATE_SEND</a>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">switch</span>( <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a>) {</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspg_8c.html#ae7ea5876846b5f04c419aee22d3c0aa1">LS_PG_STATE_INIT_POLL</a>:</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> == PGRES_POLLING_WRITING)</div>
<div class="line">      <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = POLLOUT;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> == PGRES_POLLING_READING)</div>
<div class="line">      <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = POLLIN;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = 0;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">      </div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspg_8c.html#ac70a1141f3b138055ea7143bd493187c">LS_PG_STATE_RESET_POLL</a>:</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> == PGRES_POLLING_WRITING)</div>
<div class="line">      <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = POLLOUT;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> == PGRES_POLLING_READING)</div>
<div class="line">      <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = POLLIN;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = 0;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspg_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a>:</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspg_8c.html#a373e668840b4795ff9a71bc3f744d209">LS_PG_STATE_RECV</a>:</div>
<div class="line">    <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = POLLIN;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspg_8c.html#a3c6eb19f262a990e1f9ba630d9edc309">LS_PG_STATE_SEND</a>:</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspg_8c.html#a88a7e80c12fb0449c4b0857a0c7deb21">LS_PG_STATE_SEND_FLUSH</a>:</div>
<div class="line">    <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = POLLOUT;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">default</span>:</div>
<div class="line">    <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = 0;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aeda8dad89b03d7d61cc994dd63ee5db6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_nextaction_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Queue the next MD2 instruction. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">qqp</td><td>The query that generated this result </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pgr</td><td>The result </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01458">1458</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  <span class="keywordtype">char</span> *action;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( PQntuples( pgr) &lt;= 0)</div>
<div class="line">    <span class="keywordflow">return</span>;             <span class="comment">// Note: nextaction should always return at least &quot;noAction&quot;, so this branch should never be taken</span></div>
<div class="line"></div>
<div class="line">  action = PQgetvalue( pgr, 0, 0);      <span class="comment">// next action only returns one row</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( strcmp( action, <span class="stringliteral">&quot;noAction&quot;</span>) == 0)</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="md2cmds_8c.html#ae2ecf1ddb756452728eba479f36b486b">md2cmds_push_queue</a>( action);</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a90358250d1560ae5b90cf84a78c5f84e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_nextaction_error_cb </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01477">1477</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                {</div>
<div class="line">  <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;query error getting next md2 action&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3bf385449e085f049d55fe988d9b22dd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_nexterrors_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01481">1481</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                                                 {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> etid_col, etseverity_col, etterse_col, etverbose_col, etdetails_col;</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> first_time=1;</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">  <span class="keywordtype">char</span> *terse, *verbose, *details, *severity, *id;</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">if</span>( first_time) {</div>
<div class="line">    etid_col       = PQfnumber( pgr, <span class="stringliteral">&quot;etid&quot;</span>);</div>
<div class="line">    etseverity_col = PQfnumber( pgr, <span class="stringliteral">&quot;etseverity&quot;</span>);</div>
<div class="line">    etterse_col    = PQfnumber( pgr, <span class="stringliteral">&quot;etterse&quot;</span>);</div>
<div class="line">    etverbose_col  = PQfnumber( pgr, <span class="stringliteral">&quot;etverbose&quot;</span>);</div>
<div class="line">    etdetails_col  = PQfnumber( pgr, <span class="stringliteral">&quot;etdetails&quot;</span>);</div>
<div class="line">    first_time     = 0;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;PQntuples( pgr); i++) {</div>
<div class="line">    <span class="keywordtype">id</span>       = PQgetvalue( pgr, i, etid_col);</div>
<div class="line">    terse    = PQgetvalue( pgr, i, etterse_col);</div>
<div class="line">    verbose  = PQgetvalue( pgr, i, etverbose_col);</div>
<div class="line">    details  = PQgetvalue( pgr, i, etdetails_col);</div>
<div class="line">    severity = PQgetvalue( pgr, i, etseverity_col);</div>
<div class="line">    </div>
<div class="line">    <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( NULL, NULL, <span class="stringliteral">&quot;EXECUTE acknowledgeerror(%s)&quot;</span>, <span class="keywordtype">id</span>);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspg_nexterrors_cb: %s %s\n&quot;</span>, severity, strlen(verbose)&gt;0 ? verbose : terse);</div>
<div class="line">    <span class="keywordflow">if</span>( strlen( details) &gt; 0)</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspg_nexterrors_cb: %s\n&quot;</span>, details);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a02f0348ce66bea38ce4356571e3c8fdd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_nexterrors_error_cb </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01511">1511</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                {</div>
<div class="line">  <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;query error retrieving next error message&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4cc866393eda0cf20276d035f6fbe206"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int lspg_nextsample_all </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>err</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00608">608</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                            {</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rtn;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#aab1c441d22126ea4334b3c61b7e4b4c2" title="Queue up a nextsample query.">lspg_nextsample_call</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a32878d3d29f4595d1d2b861d7e871726" title="Wait for the nextsample query to get processed.">lspg_nextsample_wait</a>();</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#aeee8110133db9f1895237ed9b54dd873" title="just in case, though this query should always return an integer, perhaps 0">no_rows_returned</a> || <a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#ade2772532d53709c5144d07332966a4a" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a>) {</div>
<div class="line">    rtn = 0;</div>
<div class="line">    *err = <a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#ade2772532d53709c5144d07332966a4a" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a> ? 2 : 1;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#a2ca6e2a667c9fe7f1a54329de04d2a3c" title="shouldn&#39;t ever be set, but if we change the logic of this call in PG then we are ready for it here...">nextsample_isnull</a>) {</div>
<div class="line">      rtn = 0;</div>
<div class="line">      *err = 1;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      rtn = <a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#aecd82b329462ae06bc2f0d162985a086" title="sample number (4 8-bit segments: station, dewar (lid), puck, and position in the puck)">nextsample</a>;</div>
<div class="line">      *err = 0;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="lspg_8c.html#ac52207cc8f4c14494ae6f4972b6a3b23" title="Called when the next shot query has been processed.">lspg_nextsample_done</a>();</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aab1c441d22126ea4334b3c61b7e4b4c2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_nextsample_call </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Queue up a nextsample query. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00584">584</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                            {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#a99408b5825e2510f07be199d2cdc3633" title="Our mutex.">mutex</a>));</div>
<div class="line">  <a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#ab1c9e9d3dc5140137a7ccf908e95f69e" title="flag for our condition">new_value_ready</a> = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#ade2772532d53709c5144d07332966a4a" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a>     = 0;</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#a99408b5825e2510f07be199d2cdc3633" title="Our mutex.">mutex</a>));</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#a5e1de4aa16107d1f5f801e11ae6b268c" title="Next Sample.">lspg_nextsample_cb</a>, <a class="code" href="lspg_8c.html#ab42eaae1a2f17f7f0e5e976f1a527709" title="Next Sample Query Error Callback.">lspg_nextsample_error_cb</a>, <span class="stringliteral">&quot;SELECT nextsample FROM px.nextsample()&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5e1de4aa16107d1f5f801e11ae6b268c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_nextsample_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Next Sample. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">qqp</td><td>Our nextsample query </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pgr</td><td>result of the query </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00533">533</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                        {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> got_columns = 0;</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> nextsample_col;</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#a99408b5825e2510f07be199d2cdc3633" title="Our mutex.">mutex</a>));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#aeee8110133db9f1895237ed9b54dd873" title="just in case, though this query should always return an integer, perhaps 0">no_rows_returned</a> = PQntuples( pgr) &lt;= 0;</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#aeee8110133db9f1895237ed9b54dd873" title="just in case, though this query should always return an integer, perhaps 0">no_rows_returned</a>) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspg_nextsample_cb: no rows returned.  This should never happen.&quot;</span>);</div>
<div class="line">    <a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#ab1c9e9d3dc5140137a7ccf908e95f69e" title="flag for our condition">new_value_ready</a> = 1;</div>
<div class="line">    pthread_cond_signal( &amp;(<a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#a5b46e4537dac3be839f6c3eeff6b46b6" title="Our condition.">cond</a>));</div>
<div class="line">    pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#a99408b5825e2510f07be199d2cdc3633" title="Our mutex.">mutex</a>));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( got_columns == 0) {</div>
<div class="line">    nextsample_col = PQfnumber( pgr, <span class="stringliteral">&quot;nextsample&quot;</span>);</div>
<div class="line">    got_columns = 1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#a2ca6e2a667c9fe7f1a54329de04d2a3c" title="shouldn&#39;t ever be set, but if we change the logic of this call in PG then we are ready for it here...">nextsample_isnull</a> = PQgetisnull( pgr, 0, nextsample_col);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#a2ca6e2a667c9fe7f1a54329de04d2a3c" title="shouldn&#39;t ever be set, but if we change the logic of this call in PG then we are ready for it here...">nextsample_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#aecd82b329462ae06bc2f0d162985a086" title="sample number (4 8-bit segments: station, dewar (lid), puck, and position in the puck)">nextsample</a> = strtol( PQgetvalue( pgr, 0, nextsample_col), NULL, 0);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#ab1c9e9d3dc5140137a7ccf908e95f69e" title="flag for our condition">new_value_ready</a> = 1;</div>
<div class="line">  pthread_cond_signal( &amp;(<a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#a5b46e4537dac3be839f6c3eeff6b46b6" title="Our condition.">cond</a>));</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#a99408b5825e2510f07be199d2cdc3633" title="Our mutex.">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac52207cc8f4c14494ae6f4972b6a3b23"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_nextsample_done </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Called when the next shot query has been processed. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00603">603</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                            {</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#a99408b5825e2510f07be199d2cdc3633" title="Our mutex.">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab42eaae1a2f17f7f0e5e976f1a527709"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_nextsample_error_cb </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Next Sample Query Error Callback. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00566">566</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#a99408b5825e2510f07be199d2cdc3633" title="Our mutex.">mutex</a>));</div>
<div class="line">  <a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#ade2772532d53709c5144d07332966a4a" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a> = 1;</div>
<div class="line">  pthread_cond_signal( &amp;(<a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#a5b46e4537dac3be839f6c3eeff6b46b6" title="Our condition.">cond</a>));</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#a99408b5825e2510f07be199d2cdc3633" title="Our mutex.">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2faa901ea0a8ef00cfd93a893b34b446"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_nextsample_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the nextsample variable, mutex, and condition. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00576">576</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                            {</div>
<div class="line">  memset( &amp;<a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>, 0, <span class="keyword">sizeof</span>( <a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>));</div>
<div class="line">  pthread_mutex_init( &amp;(<a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#a99408b5825e2510f07be199d2cdc3633" title="Our mutex.">mutex</a>), NULL);</div>
<div class="line">  pthread_cond_init( &amp;(<a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#a5b46e4537dac3be839f6c3eeff6b46b6" title="Our condition.">cond</a>), NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a32878d3d29f4595d1d2b861d7e871726"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_nextsample_wait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for the nextsample query to get processed. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00595">595</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                            {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#a99408b5825e2510f07be199d2cdc3633" title="Our mutex.">mutex</a>));</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#ab1c9e9d3dc5140137a7ccf908e95f69e" title="flag for our condition">new_value_ready</a> == 0 &amp;&amp; <a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#ade2772532d53709c5144d07332966a4a" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;(<a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#a5b46e4537dac3be839f6c3eeff6b46b6" title="Our condition.">cond</a>), &amp;(<a class="code" href="lspg_8c.html#adbf70f382e469e02dce77833981f9547" title="the very next sample">lspg_nextsample</a>.<a class="code" href="structlspg__nextsample__struct.html#a99408b5825e2510f07be199d2cdc3633" title="Our mutex.">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af17ef79544ca5d78fd477010fe90d538"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_nextshot_call </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Queue up a nextshot query. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01001">1001</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a38b657155fbee9b73278f76912cf2333" title="Our mutex for sanity in the multi-threaded program.">mutex</a>));</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#adb8da14444b98f556dba9420dd4666dc" title="Our flag for the condition to wait for.">new_value_ready</a> = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#aa50fbe34bd93ccc3762a804e95f8fd10" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a>     = 0;</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a38b657155fbee9b73278f76912cf2333" title="Our mutex for sanity in the multi-threaded program.">mutex</a>));</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#a9e92a204f606761d368ac7e06ef0f09c" title="Next Shot Callback.">lspg_nextshot_cb</a>, <a class="code" href="lspg_8c.html#a83677bfe7aab92df2d6d93fdf8cd2280" title="next shot query error callback">lspg_nextshot_error_cb</a>, <span class="stringliteral">&quot;SELECT * FROM px.nextshot2()&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9e92a204f606761d368ac7e06ef0f09c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_nextshot_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Next Shot Callback. </p>
<p>This is a long and tedious routine as there are a large number of variables returned. Suck it up. Return with the global object lspg_nextshot set. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">qqp</td><td>Our nextshot query </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pgr</td><td>result of the query </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00737">737</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                        {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> got_col_nums=0;</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">    dsdir_c, dspid_c, dsowidth_c, dsoscaxis_c, dsexp_c, skey_c, sstart_c, sfn_c, dsphi_c,</div>
<div class="line">    dsomega_c, dskappa_c, dsdist_c, dsnrg_c, dshpid_c, cx_c, cy_c, ax_c, ay_c, az_c,</div>
<div class="line">    active_c, sindex_c, stype_c,</div>
<div class="line">    dsowidth2_c, dsoscaxis2_c, dsexp2_c, sstart2_c, dsphi2_c, dsomega2_c, dskappa2_c, dsdist2_c, dsnrg2_c,</div>
<div class="line">    cx2_c, cy2_c, ax2_c, ay2_c, az2_c, active2_c, sindex2_c, stype2_c;</div>
<div class="line">  </div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a38b657155fbee9b73278f76912cf2333" title="Our mutex for sanity in the multi-threaded program.">mutex</a>));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#abc9242805729f70b83df79706c394c71" title="flag indicating that no rows were returned.">no_rows_returned</a> = PQntuples( pgr) &lt;= 0;</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#abc9242805729f70b83df79706c394c71" title="flag indicating that no rows were returned.">no_rows_returned</a>) {</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#adb8da14444b98f556dba9420dd4666dc" title="Our flag for the condition to wait for.">new_value_ready</a> = 1;</div>
<div class="line">    pthread_cond_signal( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#afc773a9eefc173aa98d5c2889e1d7669" title="Condition to wait for a response from our postgresql server.">cond</a>));</div>
<div class="line">    pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a38b657155fbee9b73278f76912cf2333" title="Our mutex for sanity in the multi-threaded program.">mutex</a>));</div>
<div class="line">    <span class="keywordflow">return</span>;                     <span class="comment">// I guess there was no shot after all</span></div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( got_col_nums == 0) {</div>
<div class="line">    dsdir_c      = PQfnumber( pgr, <span class="stringliteral">&quot;dsdir&quot;</span>);</div>
<div class="line">    dspid_c      = PQfnumber( pgr, <span class="stringliteral">&quot;dspid&quot;</span>);</div>
<div class="line">    dsowidth_c   = PQfnumber( pgr, <span class="stringliteral">&quot;dsowidth&quot;</span>);</div>
<div class="line">    dsoscaxis_c  = PQfnumber( pgr, <span class="stringliteral">&quot;dsoscaxis&quot;</span>);</div>
<div class="line">    dsexp_c      = PQfnumber( pgr, <span class="stringliteral">&quot;dsexp&quot;</span>);</div>
<div class="line">    skey_c       = PQfnumber( pgr, <span class="stringliteral">&quot;skey&quot;</span>);</div>
<div class="line">    sstart_c     = PQfnumber( pgr, <span class="stringliteral">&quot;sstart&quot;</span>);</div>
<div class="line">    sfn_c        = PQfnumber( pgr, <span class="stringliteral">&quot;sfn&quot;</span>);</div>
<div class="line">    dsphi_c      = PQfnumber( pgr, <span class="stringliteral">&quot;dsphi&quot;</span>);</div>
<div class="line">    dsomega_c    = PQfnumber( pgr, <span class="stringliteral">&quot;dsomega&quot;</span>);</div>
<div class="line">    dskappa_c    = PQfnumber( pgr, <span class="stringliteral">&quot;dskappa&quot;</span>);</div>
<div class="line">    dsdist_c     = PQfnumber( pgr, <span class="stringliteral">&quot;dsdist&quot;</span>);</div>
<div class="line">    dsnrg_c      = PQfnumber( pgr, <span class="stringliteral">&quot;dsnrg&quot;</span>);</div>
<div class="line">    dshpid_c     = PQfnumber( pgr, <span class="stringliteral">&quot;dshpid&quot;</span>);</div>
<div class="line">    cx_c         = PQfnumber( pgr, <span class="stringliteral">&quot;cx&quot;</span>);</div>
<div class="line">    cy_c         = PQfnumber( pgr, <span class="stringliteral">&quot;cy&quot;</span>);</div>
<div class="line">    ax_c         = PQfnumber( pgr, <span class="stringliteral">&quot;ax&quot;</span>);</div>
<div class="line">    ay_c         = PQfnumber( pgr, <span class="stringliteral">&quot;ay&quot;</span>);</div>
<div class="line">    az_c         = PQfnumber( pgr, <span class="stringliteral">&quot;az&quot;</span>);</div>
<div class="line">    active_c     = PQfnumber( pgr, <span class="stringliteral">&quot;active&quot;</span>);</div>
<div class="line">    sindex_c     = PQfnumber( pgr, <span class="stringliteral">&quot;sindex&quot;</span>);</div>
<div class="line">    stype_c      = PQfnumber( pgr, <span class="stringliteral">&quot;stype&quot;</span>);</div>
<div class="line">    dsowidth2_c  = PQfnumber( pgr, <span class="stringliteral">&quot;dsowidth2&quot;</span>);</div>
<div class="line">    dsoscaxis2_c = PQfnumber( pgr, <span class="stringliteral">&quot;dsoscaxis2&quot;</span>);</div>
<div class="line">    dsexp2_c     = PQfnumber( pgr, <span class="stringliteral">&quot;dsexp2&quot;</span>);</div>
<div class="line">    sstart2_c    = PQfnumber( pgr, <span class="stringliteral">&quot;sstart2&quot;</span>);</div>
<div class="line">    dsphi2_c     = PQfnumber( pgr, <span class="stringliteral">&quot;dsphi2&quot;</span>);</div>
<div class="line">    dsomega2_c   = PQfnumber( pgr, <span class="stringliteral">&quot;dsomega2&quot;</span>);</div>
<div class="line">    dskappa2_c   = PQfnumber( pgr, <span class="stringliteral">&quot;dskappa2&quot;</span>);</div>
<div class="line">    dsdist2_c    = PQfnumber( pgr, <span class="stringliteral">&quot;dsdist2&quot;</span>);</div>
<div class="line">    dsnrg2_c     = PQfnumber( pgr, <span class="stringliteral">&quot;dsnrg2&quot;</span>);</div>
<div class="line">    cx2_c        = PQfnumber( pgr, <span class="stringliteral">&quot;cx2&quot;</span>);</div>
<div class="line">    cy2_c        = PQfnumber( pgr, <span class="stringliteral">&quot;cy2&quot;</span>);</div>
<div class="line">    ax2_c        = PQfnumber( pgr, <span class="stringliteral">&quot;ax2&quot;</span>);</div>
<div class="line">    ay2_c        = PQfnumber( pgr, <span class="stringliteral">&quot;ay2&quot;</span>);</div>
<div class="line">    az2_c        = PQfnumber( pgr, <span class="stringliteral">&quot;az2&quot;</span>);</div>
<div class="line">    active2_c    = PQfnumber( pgr, <span class="stringliteral">&quot;active2&quot;</span>);</div>
<div class="line">    sindex2_c    = PQfnumber( pgr, <span class="stringliteral">&quot;sindex2&quot;</span>);</div>
<div class="line">    stype2_c     = PQfnumber( pgr, <span class="stringliteral">&quot;stype2&quot;</span>);</div>
<div class="line">    </div>
<div class="line">    got_col_nums = 1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// NULL string values come back as empty strings</span></div>
<div class="line">  <span class="comment">// Mark the null flag but allocate the empty string anyway</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a8dea57b78b92d67d83ccbb6ed6da13ca">dsdir_isnull</a> = PQgetisnull( pgr, 0, dsdir_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ac372e1774a25b3d4bfbb9169762eb39e" title="Directory for data relative to the ESAF home directory.">dsdir</a> != NULL)</div>
<div class="line">    free( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ac372e1774a25b3d4bfbb9169762eb39e" title="Directory for data relative to the ESAF home directory.">dsdir</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ac372e1774a25b3d4bfbb9169762eb39e" title="Directory for data relative to the ESAF home directory.">dsdir</a> = strdup( PQgetvalue( pgr, 0, dsdir_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a7665485395487756ab448d0c81c84d10">dspid_isnull</a> = PQgetisnull( pgr, 0, dspid_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a4487e718c2b55a8ab9ebb18329574ae1" title="ID string identifying this dataset.">dspid</a> != NULL)</div>
<div class="line">    free( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a4487e718c2b55a8ab9ebb18329574ae1" title="ID string identifying this dataset.">dspid</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a4487e718c2b55a8ab9ebb18329574ae1" title="ID string identifying this dataset.">dspid</a> = strdup( PQgetvalue( pgr, 0, dspid_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a51a26391afcacfb4c946fb9e8e9ab6b0">dsoscaxis_isnull</a> = PQgetisnull( pgr, 0, dsoscaxis_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a9a62c304e66013e8e5e5618a44f0b6d4" title="dataset defined oscillation axis (always omega)">dsoscaxis</a> != NULL)</div>
<div class="line">    free( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a9a62c304e66013e8e5e5618a44f0b6d4" title="dataset defined oscillation axis (always omega)">dsoscaxis</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a9a62c304e66013e8e5e5618a44f0b6d4" title="dataset defined oscillation axis (always omega)">dsoscaxis</a> = strdup( PQgetvalue( pgr, 0, dsoscaxis_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a98e280e99ae847559bb82836df3c32d1">dsoscaxis2_isnull</a> = PQgetisnull( pgr, 0, dsoscaxis2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ac86005a6e90ff502da9e95b59d0b7a5f" title="next image ascillation axis (always &quot;omega&quot;)">dsoscaxis2</a> != NULL)</div>
<div class="line">    free( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ac86005a6e90ff502da9e95b59d0b7a5f" title="next image ascillation axis (always &quot;omega&quot;)">dsoscaxis2</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ac86005a6e90ff502da9e95b59d0b7a5f" title="next image ascillation axis (always &quot;omega&quot;)">dsoscaxis2</a> = strdup( PQgetvalue( pgr, 0, dsoscaxis2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a56f32eb413b1fca9f085874eb86294de">sfn_isnull</a> = PQgetisnull(pgr, 0, sfn_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a03252bba597b081edc9d08b20b558cc7" title="file name">sfn</a> != NULL)</div>
<div class="line">    free( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a03252bba597b081edc9d08b20b558cc7" title="file name">sfn</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a03252bba597b081edc9d08b20b558cc7" title="file name">sfn</a> = strdup( PQgetvalue( pgr, 0, sfn_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a79f48c452a4aca8506bae22f897c7441">stype_isnull</a> = PQgetisnull( pgr, 0, stype_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ab5a70b189c2fe516ca0c84bd06f3e564" title="&quot;Normal&quot; or &quot;Gridsearch&quot;">stype</a> != NULL)</div>
<div class="line">    free( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ab5a70b189c2fe516ca0c84bd06f3e564" title="&quot;Normal&quot; or &quot;Gridsearch&quot;">stype</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ab5a70b189c2fe516ca0c84bd06f3e564" title="&quot;Normal&quot; or &quot;Gridsearch&quot;">stype</a> = strdup( PQgetvalue( pgr, 0, stype_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a203e29ed0bb403aaab6d7f95f690cc0d">stype2_isnull</a> = PQgetisnull( pgr, 0, stype2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ae08ef74ea76e6e099a3ff6c7f845d337" title="next image type (&quot;Normal&quot; or &quot;Gridsearch&quot;)">stype2</a> != NULL)</div>
<div class="line">    free( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ae08ef74ea76e6e099a3ff6c7f845d337" title="next image type (&quot;Normal&quot; or &quot;Gridsearch&quot;)">stype2</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ae08ef74ea76e6e099a3ff6c7f845d337" title="next image type (&quot;Normal&quot; or &quot;Gridsearch&quot;)">stype2</a> = strdup( PQgetvalue( pgr, 0, stype2_c));</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Probably shouldn&#39;t try to convert null number values</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a5dd3db64790e09bc03499e521bbaa126">dsowidth_isnull</a> = PQgetisnull( pgr, 0, dsowidth_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a5dd3db64790e09bc03499e521bbaa126">dsowidth_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ad5a8f568a04aa6a13767933062b28f19" title="dataset defined oscillation width">dsowidth</a> = atof( PQgetvalue( pgr,0, dsowidth_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ae07498f62ea9c0e2f702b78c87500794">dsexp_isnull</a> = PQgetisnull( pgr, 0, dsexp_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ae07498f62ea9c0e2f702b78c87500794">dsexp_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a063e4c99201a763c2eb048acfc855efa" title="dataset defined exposure time">dsexp</a>    = atof( PQgetvalue( pgr,0, dsexp_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#aa53094de91e2f69d7174ab119df1cdac">sstart_isnull</a> = PQgetisnull( pgr, 0, sstart_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#aa53094de91e2f69d7174ab119df1cdac">sstart_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a8dc11eaa094d59f61642c4abc226918f" title="starting angle">sstart</a>   = atof( PQgetvalue( pgr,0, sstart_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a2d1f51cb1bb575a214344773136be878">dsphi_isnull</a> = PQgetisnull( pgr, 0, dsphi_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a2d1f51cb1bb575a214344773136be878">dsphi_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a64ebde597ca97a3b98145dc2d580c64f" title="dataset defined starting phi angle">dsphi</a>    = atof( PQgetvalue( pgr,0, dsphi_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ad1da3548dc642d415aed53dc165c44fc">dsomega_isnull</a> = PQgetisnull( pgr, 0, dsomega_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ad1da3548dc642d415aed53dc165c44fc">dsomega_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a4be525bb32fb0232c21a91529f1e8c73" title="dataset defined starting omega angle">dsomega</a>  = atof( PQgetvalue( pgr,0, dsomega_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a1686a72509cc1c3383ee95a790ddff14">dskappa_isnull</a> = PQgetisnull( pgr, 0, dskappa_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a1686a72509cc1c3383ee95a790ddff14">dskappa_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a59355281e8eb935cd7bfac597fdc5289" title="dataset defined starting kappa angle">dskappa</a>  = atof( PQgetvalue( pgr,0, dskappa_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ac6f2bdc7b023d933509bf74af7b169f9">dsdist_isnull</a> = PQgetisnull( pgr, 0, dsdist_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ac6f2bdc7b023d933509bf74af7b169f9">dsdist_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#acab9431a911f5bb11296cbfb271fb83a" title="dataset defined detector distance">dsdist</a>   = atof( PQgetvalue( pgr,0, dsdist_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ad14d8bb50290ec12e58f4aaec5cc5aab">dsnrg_isnull</a> = PQgetisnull( pgr, 0, dsnrg_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ad14d8bb50290ec12e58f4aaec5cc5aab">dsnrg_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a371e574055fec7660b8f2e637eaf9f25" title="dataset defined energy">dsnrg</a>    = atof( PQgetvalue( pgr,0, dsnrg_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a779b99533f0ed4e659177afb0b791ad2">cx_isnull</a> = PQgetisnull( pgr, 0, cx_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a779b99533f0ed4e659177afb0b791ad2">cx_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ad9eb2013fa6f295f72f0891fe98c863f" title="centering table x position">cx</a>       = atof( PQgetvalue( pgr,0, cx_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a3895d645420848aed05b95694ec8c6c7">cy_isnull</a> = PQgetisnull( pgr, 0, cy_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a3895d645420848aed05b95694ec8c6c7">cy_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ab7a7b37a17f06c4e9ebdcdf056946098" title="centering table y position">cy</a>       = atof( PQgetvalue( pgr,0, cy_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#aae46c7911b2b218497ad4a68f3dbb7d9">ax_isnull</a> = PQgetisnull( pgr, 0, ax_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#aae46c7911b2b218497ad4a68f3dbb7d9">ax_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a7f57874223897ab7d9c7531a9522904d" title="alignment table x position">ax</a>       = atof( PQgetvalue( pgr,0, ax_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a9da91abc8090532ed98ccd47a3bab775">ay_isnull</a> = PQgetisnull( pgr, 0, ay_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a9da91abc8090532ed98ccd47a3bab775">ay_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a9e20b9a0aeb41f7f7d653a1c60335bf1" title="alignment table y position">ay</a>       = atof( PQgetvalue( pgr,0, ay_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#aaebd6d432810313294b5fed5f4445cb1">az_isnull</a> = PQgetisnull( pgr, 0, az_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#aaebd6d432810313294b5fed5f4445cb1">az_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a66e678866ce79f6398b66d033ae45a17" title="alignment table z position">az</a>       = atof( PQgetvalue( pgr,0, az_c));</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a9f777671ec617a0f533b3c51f28babb3">active_isnull</a> = PQgetisnull( pgr, 0, active_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a9f777671ec617a0f533b3c51f28babb3">active_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a1a94eefbad713976a3d9213695a6ca28" title="flag: 1=move to indicated center position, 0=don&#39;t move center or alignment tables">active</a> = atoi( PQgetvalue( pgr, 0, active_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a7ca4fbc86974d1b75a681ba5ecaaf5af">sindex_isnull</a> = PQgetisnull( pgr, 0, sindex_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a7ca4fbc86974d1b75a681ba5ecaaf5af">sindex_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a5d096f2c2bf9be29c44129b54eaf01da" title="index of frame (used to generate the file extension)">sindex</a> = atoi( PQgetvalue( pgr, 0, sindex_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#afe16be0382423aa3f25cb3d6cf99430b">dshpid_isnull</a> = PQgetisnull( pgr, 0, dshpid_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#afe16be0382423aa3f25cb3d6cf99430b">dshpid_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a5e260a420176f2973cdb100d0a5c4c09" title="sample holder ID">dshpid</a> = atoi( PQgetvalue( pgr, 0, dshpid_c));</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#abd3c69357470052eb79ddd8eddd57b2c">skey_isnull</a> = PQgetisnull( pgr, 0, skey_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#abd3c69357470052eb79ddd8eddd57b2c">skey_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#af64a4e3f17752b5f1f05fb15d6f48382" title="key identifying a particulary image">skey</a>   = atoll( PQgetvalue( pgr, 0, skey_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a5ffd27b8063506fd54162658e5c2ce8a">dsowidth2_isnull</a> = PQgetisnull( pgr, 0, dsowidth2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a5ffd27b8063506fd54162658e5c2ce8a">dsowidth2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a5378e13735a5392a9fcd853ce8c9e929" title="next image oscillation width">dsowidth2</a> = atof( PQgetvalue( pgr,0, dsowidth2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a45091283dc073e5b7da2cfbe5a75fade">dsexp2_isnull</a> = PQgetisnull( pgr, 0, dsexp2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a45091283dc073e5b7da2cfbe5a75fade">dsexp2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a4d8c34309572875352ddabe9cc9001ee" title="next image exposure time">dsexp2</a>    = atof( PQgetvalue( pgr,0, dsexp2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a240c8532d5ce48dbc872d5123a4e721c">sstart2_isnull</a> = PQgetisnull( pgr, 0, sstart2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a240c8532d5ce48dbc872d5123a4e721c">sstart2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a8445cbd2206dc6d62b6bd433f5218c98" title="next image start angle">sstart2</a>   = atof( PQgetvalue( pgr,0, sstart2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a57a9c43be86188f65b96d59c2adec674">dsphi2_isnull</a> = PQgetisnull( pgr, 0, dsphi2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a57a9c43be86188f65b96d59c2adec674">dsphi2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a98857616b6bbb6ba861e96b6b7551756" title="next image phi position">dsphi2</a>    = atof( PQgetvalue( pgr,0, dsphi2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#afaf9bdf89a68e7f479969072643e55eb">dsomega2_isnull</a> = PQgetisnull( pgr, 0, dsomega2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#afaf9bdf89a68e7f479969072643e55eb">dsomega2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a84ae35abfa725d1bdbff5403f6384ee4" title="next image omega position">dsomega2</a>  = atof( PQgetvalue( pgr,0, dsomega2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a9a7e47372f4f6e0e48a0cb3c78fa8437">dskappa2_isnull</a> = PQgetisnull( pgr, 0, dskappa2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a9a7e47372f4f6e0e48a0cb3c78fa8437">dskappa2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a8571a0b95fb6ea6356fd7204b9c9e371" title="next image kappa position">dskappa2</a>  = atof( PQgetvalue( pgr,0, dskappa2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a7fce65f4719a4a8110006f8b72eec3f7">dsdist2_isnull</a> = PQgetisnull( pgr, 0, dsdist2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a7fce65f4719a4a8110006f8b72eec3f7">dsdist2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a516827749068577217b27860a01e6041" title="next image distance">dsdist2</a>   = atof( PQgetvalue( pgr,0, dsdist2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#aee9f8196dd9bcea832a60f2f0ea3a999">dsnrg2_isnull</a> = PQgetisnull( pgr, 0, dsnrg2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#aee9f8196dd9bcea832a60f2f0ea3a999">dsnrg2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ae461439c2af31255227765c0fb61850f" title="next image energy">dsnrg2</a>    = atof( PQgetvalue( pgr,0, dsnrg2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a3ad947f4efe2cb5c338244b019334749">cx2_isnull</a> = PQgetisnull( pgr, 0, cx2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a3ad947f4efe2cb5c338244b019334749">cx2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a10d45763100bc59f9a5f68f1b48db6d3" title="next image centering table x position">cx2</a>       = atof( PQgetvalue( pgr,0, cx2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a57d78a389413827302df6ebe3dcb3c89">cy2_isnull</a> = PQgetisnull( pgr, 0, cy2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a57d78a389413827302df6ebe3dcb3c89">cy2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a3644e5c3f12af18a3b426d4d4d7e16a5" title="next image centering table y position">cy2</a>       = atof( PQgetvalue( pgr,0, cy2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a846845b0b9ecf6517ef85554771ec71d">ax2_isnull</a> = PQgetisnull( pgr, 0, ax2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a846845b0b9ecf6517ef85554771ec71d">ax2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ab76bd38d2a098bc7eda82aff5dcb9c66" title="next image alignment x position">ax2</a>       = atof( PQgetvalue( pgr,0, ax2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ad0f50ec6339296d3d39c8d95131ab6b5">ay2_isnull</a> = PQgetisnull( pgr, 0, ay2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ad0f50ec6339296d3d39c8d95131ab6b5">ay2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ad13759740204b42e379161f98815f3d0" title="next image alignment y position">ay2</a>       = atof( PQgetvalue( pgr,0, ay2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a95d080f13a4e02b9aa883821ee3e721c">az2_isnull</a> = PQgetisnull( pgr, 0, az2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a95d080f13a4e02b9aa883821ee3e721c">az2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a94698a030fd5b2abf1f10a2ad33476a4" title="next image alignment z position">az2</a>       = atof( PQgetvalue( pgr,0, az2_c));</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a1aa11ff4a4c8d69695786b4349e84e6b">active2_isnull</a> = PQgetisnull( pgr, 0, active2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a1aa11ff4a4c8d69695786b4349e84e6b">active2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a2875aa18df587806a3d8c05220fd62b5" title="flag: 1 if next image should use the above centering parameters">active2</a> = atoi( PQgetvalue( pgr, 0, active2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a28e0b5c32a2741ef22edeb9d35b04e4d">sindex2_isnull</a> = PQgetisnull( pgr, 0, sindex2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a28e0b5c32a2741ef22edeb9d35b04e4d">sindex2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ae9d0cfdff6868e0ba9cd5acafbe133db" title="next image index number">sindex2</a> = atoi( PQgetvalue( pgr, 0, sindex2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#adb8da14444b98f556dba9420dd4666dc" title="Our flag for the condition to wait for.">new_value_ready</a> = 1;</div>
<div class="line"></div>
<div class="line">  pthread_cond_signal( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#afc773a9eefc173aa98d5c2889e1d7669" title="Condition to wait for a response from our postgresql server.">cond</a>));</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a38b657155fbee9b73278f76912cf2333" title="Our mutex for sanity in the multi-threaded program.">mutex</a>));</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a50458a014041a4118452802dfb303960"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_nextshot_done </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Called when the next shot query has been processed. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01020">1020</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a38b657155fbee9b73278f76912cf2333" title="Our mutex for sanity in the multi-threaded program.">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a83677bfe7aab92df2d6d93fdf8cd2280"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_nextshot_error_cb </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>next shot query error callback </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00984">984</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                              {</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a38b657155fbee9b73278f76912cf2333" title="Our mutex for sanity in the multi-threaded program.">mutex</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#aa50fbe34bd93ccc3762a804e95f8fd10" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a> = 1;</div>
<div class="line">  pthread_cond_signal( &amp;<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#afc773a9eefc173aa98d5c2889e1d7669" title="Condition to wait for a response from our postgresql server.">cond</a>);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a38b657155fbee9b73278f76912cf2333" title="Our mutex for sanity in the multi-threaded program.">mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aff91db7d60e6c832684c023813e36dbf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_nextshot_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the nextshot variable, mutex, and condition. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00993">993</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  memset( &amp;<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>, 0, <span class="keyword">sizeof</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>));</div>
<div class="line">  pthread_mutex_init( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a38b657155fbee9b73278f76912cf2333" title="Our mutex for sanity in the multi-threaded program.">mutex</a>), NULL);</div>
<div class="line">  pthread_cond_init( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#afc773a9eefc173aa98d5c2889e1d7669" title="Condition to wait for a response from our postgresql server.">cond</a>), NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a784a6de32a86fec9efb3ef3ae4b6e3ac"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_nextshot_wait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for the next shot query to get processed. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01012">1012</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a38b657155fbee9b73278f76912cf2333" title="Our mutex for sanity in the multi-threaded program.">mutex</a>));</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#adb8da14444b98f556dba9420dd4666dc" title="Our flag for the condition to wait for.">new_value_ready</a> == 0 &amp;&amp; <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#aa50fbe34bd93ccc3762a804e95f8fd10" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#afc773a9eefc173aa98d5c2889e1d7669" title="Condition to wait for a response from our postgresql server.">cond</a>), &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a38b657155fbee9b73278f76912cf2333" title="Our mutex for sanity in the multi-threaded program.">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a62b110949d206fb22789191207e1d066"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PQnoticeProcessor lspg_notice_processor </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01819">1819</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                                                     {</div>
<div class="line">  <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspg: %s&quot;</span>, msg);</div>
<div class="line">  <span class="keywordflow">return</span> NULL;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a581c18be0368425665a40b4b7f7d9714"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_pg_connect </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Connect to the pg server. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01826">1826</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                       {</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a> == NULL)</div>
<div class="line">    <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">switch</span>( <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a>) {</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspg_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a>:</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( lspg_time_sent.tv_sec != 0) {</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Reality check: if it&#39;s less the about 10 seconds since the last failed attempt</span></div>
<div class="line">      <span class="comment">// the just chill.</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      gettimeofday( &amp;<a class="code" href="lspg_8c.html#ad40ac52086f6b774928af45b09d54c6e" title="used to ensure we do not inundate the db server with connection requests">now</a>, NULL);</div>
<div class="line">      <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad40ac52086f6b774928af45b09d54c6e" title="used to ensure we do not inundate the db server with connection requests">now</a>.tv_sec - lspg_time_sent.tv_sec &lt; 10) {</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a> = PQconnectStart( <span class="stringliteral">&quot;dbname=ls user=lsuser hostaddr=10.1.0.3&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a> == NULL) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Out of memory (lspg_pg_connect)&quot;</span>);</div>
<div class="line">      exit( -1);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    err = PQstatus( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( err == CONNECTION_BAD) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Trouble connecting to database&quot;</span>);</div>
<div class="line"></div>
<div class="line">      gettimeofday( &amp;lspg_time_sent, NULL);</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    err = PQsetnonblocking( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>, 1);</div>
<div class="line">    <span class="keywordflow">if</span>( err != 0) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Odd, could not set database connection to nonblocking&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#ae7ea5876846b5f04c419aee22d3c0aa1">LS_PG_STATE_INIT_POLL</a>;</div>
<div class="line">    <a class="code" href="lspg_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> = PGRES_POLLING_WRITING;</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// set up the connection for poll</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.fd = PQsocket( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspg_8c.html#ae7ea5876846b5f04c419aee22d3c0aa1">LS_PG_STATE_INIT_POLL</a>:</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> == PGRES_POLLING_FAILED) {</div>
<div class="line">      PQfinish( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">      <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a> = NULL;</div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a>;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> == PGRES_POLLING_OK) {</div>
<div class="line">      PQsetNoticeProcessor( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>, (PQnoticeProcessor)<a class="code" href="kvredis_8c.html#a62b110949d206fb22789191207e1d066">lspg_notice_processor</a>, NULL);</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( NULL, NULL, <span class="stringliteral">&quot;select pmac.md2_init()&quot;</span>);</div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspg_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>:</div>
<div class="line">    err = PQresetStart( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( err == 0) {</div>
<div class="line">      PQfinish( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">      <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a> = NULL;</div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a>;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#ac70a1141f3b138055ea7143bd493187c">LS_PG_STATE_RESET_POLL</a>;</div>
<div class="line">      <a class="code" href="lspg_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> = PGRES_POLLING_WRITING;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspg_8c.html#ac70a1141f3b138055ea7143bd493187c">LS_PG_STATE_RESET_POLL</a>:</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> == PGRES_POLLING_FAILED) {</div>
<div class="line">      PQfinish( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">      <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a> = NULL;</div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a>;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> == PGRES_POLLING_OK) {</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( NULL, NULL, <span class="stringliteral">&quot;select pmac.md2_init()&quot;</span>);</div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa8d1fed4b461c2139a21826d524777d5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_pg_service </td>
          <td>(</td>
          <td class="paramtype">struct pollfd *&#160;</td>
          <td class="paramname"><em>evt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>I/O control to/from the postgresql server. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">evt</td><td>The pollfd object that we are responding to </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01714">1714</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                       {</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Currently just used to check for notifies</span></div>
<div class="line">  <span class="comment">// Other socket communication is done syncronously</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( evt-&gt;revents &amp; POLLIN) {</div>
<div class="line">    <span class="keywordtype">int</span> err;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#ae7ea5876846b5f04c419aee22d3c0aa1">LS_PG_STATE_INIT_POLL</a>) {</div>
<div class="line">      <a class="code" href="lspg_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> = PQconnectPoll( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">      <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> == PGRES_POLLING_FAILED) {</div>
<div class="line">        <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#ac70a1141f3b138055ea7143bd493187c">LS_PG_STATE_RESET_POLL</a>) {</div>
<div class="line">      <a class="code" href="lspg_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> = PQresetPoll( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">      <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> == PGRES_POLLING_FAILED) {</div>
<div class="line">        <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// if in IDLE or RECV we need to call consumeInput first</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a>) {</div>
<div class="line">      err = PQconsumeInput( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">      <span class="keywordflow">if</span>( err != 1) {</div>
<div class="line">        <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;consume input failed: %s&quot;</span>, PQerrorMessage( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>));</div>
<div class="line">        <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>;</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">      }</div>
<div class="line">    }      </div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#a373e668840b4795ff9a71bc3f744d209">LS_PG_STATE_RECV</a>) {</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a038c5af23469b789fc1c55d21cb43029" title="Receive a result of a query.">lspg_receive</a>();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Check for notifies regardless of our state</span></div>
<div class="line">    <span class="comment">// Push as many requests as we have notifies.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    {</div>
<div class="line">      PGnotify *pgn;</div>
<div class="line"></div>
<div class="line">      <span class="keywordflow">while</span>( 1) {</div>
<div class="line">        pgn = PQnotifies( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">        <span class="keywordflow">if</span>( pgn == NULL)</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspg_pg_service: notify recieved %s&quot;</span>, pgn-&gt;relname);</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span>( strstr( pgn-&gt;relname, <span class="stringliteral">&quot;_pmac&quot;</span>) != NULL) {</div>
<div class="line">          <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#a1e11f525ca0f9ac9ab71f9fbe983c42b" title="Send strings directly to PMAC queue.">lspg_cmd_cb</a>, <a class="code" href="lspg_8c.html#ad6cff8b4272907291da431eff274a51b">lspg_cmd_error_cb</a>, <span class="stringliteral">&quot;EXECUTE md2_queue_next&quot;</span>);</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( strstr( pgn-&gt;relname, <span class="stringliteral">&quot;_diff&quot;</span>) != NULL || strstr( pgn-&gt;relname, <span class="stringliteral">&quot;_run&quot;</span>) != NULL) {</div>
<div class="line">          <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#aeda8dad89b03d7d61cc994dd63ee5db6" title="Queue the next MD2 instruction.">lspg_nextaction_cb</a>, <a class="code" href="lspg_8c.html#a90358250d1560ae5b90cf84a78c5f84e">lspg_nextaction_error_cb</a>, <span class="stringliteral">&quot;EXECUTE nextaction&quot;</span>);</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( strstr( pgn-&gt;relname, <span class="stringliteral">&quot;_sample&quot;</span>) != NULL) {</div>
<div class="line">          <a class="code" href="lspg_8c.html#acf98a9e2adec05a69847045f444a5c77">lspg_getcurrentsampleid_call</a>();</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( strstr( pgn-&gt;relname, <span class="stringliteral">&quot;_kvs&quot;</span>) != NULL) {</div>
<div class="line">          <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="kvredis_8c.html#afb8d1ff1e0f4fcdc85ad9c684271cb3d">lspg_allkvs_cb</a>, <a class="code" href="lspg_8c.html#ade0aad16c5ea2254c8cdc1539302c93b">lspg_allkvs_error_cb</a>, <span class="stringliteral">&quot;EXECUTE getkvs&quot;</span>);</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( strstr( pgn-&gt;relname, <span class="stringliteral">&quot;_mess&quot;</span>) != NULL) {</div>
<div class="line">          <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#a3bf385449e085f049d55fe988d9b22dd">lspg_nexterrors_cb</a>, <a class="code" href="lspg_8c.html#a02f0348ce66bea38ce4356571e3c8fdd">lspg_nexterrors_error_cb</a>, <span class="stringliteral">&quot;EXECUTE nexterrors&quot;</span>);</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( strstr( pgn-&gt;relname, <span class="stringliteral">&quot;_pause&quot;</span>) != NULL) {</div>
<div class="line">          </div>
<div class="line">        }</div>
<div class="line">        PQfreemem( pgn);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( evt-&gt;revents &amp; POLLOUT) {</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#ae7ea5876846b5f04c419aee22d3c0aa1">LS_PG_STATE_INIT_POLL</a>) {</div>
<div class="line">      <a class="code" href="lspg_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> = PQconnectPoll( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">      <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> == PGRES_POLLING_FAILED) {</div>
<div class="line">        <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#ac70a1141f3b138055ea7143bd493187c">LS_PG_STATE_RESET_POLL</a>) {</div>
<div class="line">      <a class="code" href="lspg_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> = PQresetPoll( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">      <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> == PGRES_POLLING_FAILED) {</div>
<div class="line">        <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#a3c6eb19f262a990e1f9ba630d9edc309">LS_PG_STATE_SEND</a>) {</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a714b15e117ffe7bfce4f2f2ce4725b0a" title="send the next queued query to the DB server">lspg_send_next_query</a>();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#a88a7e80c12fb0449c4b0857a0c7deb21">LS_PG_STATE_SEND_FLUSH</a>) {</div>
<div class="line">      <a class="code" href="kvredis_8c.html#af6485ac1749c5de3008dd0e0badaa09c" title="Flush psql output buffer (ie, send the query)">lspg_flush</a>();</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a69a792e1981af00b2818bcda89bdaa02"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_preset_changed_cb </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l02037">2037</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                          {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">char</span> base[] = <span class="stringliteral">&quot;Preset Changed &quot;</span>;</div>
<div class="line">  <span class="keywordtype">char</span> *pn;</div>
<div class="line">  <a class="code" href="structlsredis__obj__struct.html" title="Redis Object Basic object whose value is sychronized with our redis db.">lsredis_obj_t</a> *<a class="code" href="namespacemk__pgpmac__redis.html#a11daf2847f2dc94562b5b61b3f412574">p</a>;</div>
<div class="line">  <span class="keywordtype">char</span> *<a class="code" href="namespacemk__pgpmac__redis.html#ac732d49b0afca9a9951e3a252bae42fc">v</a>;</div>
<div class="line"></div>
<div class="line">  pn = strstr( event, base);</div>
<div class="line">  <span class="keywordflow">if</span>( pn == NULL) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspg_preset_changed_cb: Could not parse &#39;%s&#39;&quot;</span>, event);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line">  pn += strlen( base);</div>
<div class="line">  </div>
<div class="line">  p = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;%s&quot;</span>, pn);</div>
<div class="line">  <span class="keywordflow">if</span>( p == NULL) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspg_preset_changed_cb: Could not find variable &#39;%s&#39;&quot;</span>, pn);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line">  v = <a class="code" href="lsredis_8c.html#ac1994e56114b2315294527d76311f829" title="return a copy of the key&#39;s string value be sure to free the result">lsredis_getstr</a>( p);</div>
<div class="line">  <span class="keywordflow">if</span>( v == NULL || v[0] == 0) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspg_preset_chanted_cb: Value for preset %s is %s&quot;</span>, pn, v==NULL ? <span class="stringliteral">&quot;NULL&quot;</span> : <span class="stringliteral">&quot;Empty&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( NULL, NULL, <span class="stringliteral">&quot;EXECUTE kvupdate(&#39;{%s,%s}&#39;::text[])&quot;</span>, pn, v);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad5f3ec8f197cc330c83dba70f310533c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a>* lspg_query_next </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the next item in the postgresql queue. </p>
<p>If there is an item left in the queue then it is returned. Otherwise, NULL is returned. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00077">77</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                      {</div>
<div class="line">  <a class="code" href="structlspgQueryQueueStruct.html" title="Store each query along with it&#39;s callback function.">lspg_query_queue_t</a> *rtn;</div>
<div class="line">  </div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4" title="keep the queue from getting tangled">lspg_queue_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#aca86bb77d6cecfae9251743f4171bafb" title="The last item still being used (on == off means nothing in queue)">lspg_query_queue_off</a> == <a class="code" href="lspg_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6" title="Next position to add something to the queue.">lspg_query_queue_on</a>)</div>
<div class="line">    <span class="comment">// Queue is empty</span></div>
<div class="line">    rtn = NULL;</div>
<div class="line">  <span class="keywordflow">else</span> {</div>
<div class="line">    rtn = &amp;(<a class="code" href="lspg_8c.html#a357d9d98f0b8c9625ccebcebfcdce955" title="Our query queue.">lspg_query_queue</a>[(<a class="code" href="lspg_8c.html#aca86bb77d6cecfae9251743f4171bafb" title="The last item still being used (on == off means nothing in queue)">lspg_query_queue_off</a>++) % <a class="code" href="lspg_8c.html#a08fe83fe8226002ee8b80ce0a914fd11" title="Queue length should be long enough that we do not ordinarly bump into the end We should be safe as lo...">LS_PG_QUERY_QUEUE_LENGTH</a>]); </div>
<div class="line">    pthread_cond_signal( &amp;<a class="code" href="lspg_8c.html#a61a308b6a37afd645beb422653b95baa" title="keeps the queue from overflowing">lspg_queue_cond</a>);</div>
<div class="line">  }</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4" title="keep the queue from getting tangled">lspg_queue_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad653cd4f070c8ce7d35e0e414b722690"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_query_push </td>
          <td>(</td>
          <td class="paramtype">void(*)(<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *, PGresult *)&#160;</td>
          <td class="paramname"><em>cb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)()&#160;</td>
          <td class="paramname"><em>er</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Place a query on the queue. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cb</td><td>Our callback function that deals with the response </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">er</td><td>error response </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fmt</td><td>Printf style function to generate the query </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00130">130</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                       {</div>
<div class="line">  <span class="keywordtype">int</span> idx;</div>
<div class="line">  va_list arg_ptr;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4" title="keep the queue from getting tangled">lspg_queue_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Pause the thread while we service the queue</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">while</span>( (<a class="code" href="lspg_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6" title="Next position to add something to the queue.">lspg_query_queue_on</a> + 1) % <a class="code" href="lspg_8c.html#a08fe83fe8226002ee8b80ce0a914fd11" title="Queue length should be long enough that we do not ordinarly bump into the end We should be safe as lo...">LS_PG_QUERY_QUEUE_LENGTH</a> == <a class="code" href="lspg_8c.html#aca86bb77d6cecfae9251743f4171bafb" title="The last item still being used (on == off means nothing in queue)">lspg_query_queue_off</a> % <a class="code" href="lspg_8c.html#a08fe83fe8226002ee8b80ce0a914fd11" title="Queue length should be long enough that we do not ordinarly bump into the end We should be safe as lo...">LS_PG_QUERY_QUEUE_LENGTH</a>) {</div>
<div class="line">    pthread_cond_wait( &amp;<a class="code" href="lspg_8c.html#a61a308b6a37afd645beb422653b95baa" title="keeps the queue from overflowing">lspg_queue_cond</a>, &amp;<a class="code" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4" title="keep the queue from getting tangled">lspg_queue_mutex</a>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  idx = <a class="code" href="lspg_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6" title="Next position to add something to the queue.">lspg_query_queue_on</a> % <a class="code" href="lspg_8c.html#a08fe83fe8226002ee8b80ce0a914fd11" title="Queue length should be long enough that we do not ordinarly bump into the end We should be safe as lo...">LS_PG_QUERY_QUEUE_LENGTH</a>;</div>
<div class="line"></div>
<div class="line">  va_start( arg_ptr, fmt);</div>
<div class="line">  vsnprintf( <a class="code" href="lspg_8c.html#a357d9d98f0b8c9625ccebcebfcdce955" title="Our query queue.">lspg_query_queue</a>[idx].qs, <a class="code" href="kvredis_8c.html#a3a8ef1b4b5994d6dd12bf74454ea891b">LS_PG_QUERY_STRING_LENGTH</a>-1, fmt, arg_ptr);</div>
<div class="line">  va_end( arg_ptr);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#a357d9d98f0b8c9625ccebcebfcdce955" title="Our query queue.">lspg_query_queue</a>[idx].<a class="code" href="structlspgQueryQueueStruct.html#a1389b3ec4ddf9ed5cc0344d229a7ff9e" title="our queries should all be pretty short as we&#39;ll just be calling functions: fixed length here simplifi...">qs</a>[<a class="code" href="kvredis_8c.html#a3a8ef1b4b5994d6dd12bf74454ea891b">LS_PG_QUERY_STRING_LENGTH</a> - 1] = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#a357d9d98f0b8c9625ccebcebfcdce955" title="Our query queue.">lspg_query_queue</a>[idx].<a class="code" href="structlspgQueryQueueStruct.html#a53bac5ae4cab775423940bff5092a831" title="Callback function for when a query returns a result.">onResponse</a> = cb;</div>
<div class="line">  <a class="code" href="lspg_8c.html#a357d9d98f0b8c9625ccebcebfcdce955" title="Our query queue.">lspg_query_queue</a>[idx].<a class="code" href="structlspgQueryQueueStruct.html#ac7e4b4a8c59d7c814670ed1004154c2c" title="Perhaps the caller wants to clean up or recover.">onError</a>    = er;</div>
<div class="line">  <a class="code" href="lspg_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6" title="Next position to add something to the queue.">lspg_query_queue_on</a>++;</div>
<div class="line"></div>
<div class="line">  pthread_kill( <a class="code" href="lspg_8c.html#a04eb0cda0d5e5afeae7c393b51689765" title="our worker thread">lspg_thread</a>, SIGUSR1);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4" title="keep the queue from getting tangled">lspg_queue_mutex</a>);</div>
<div class="line">};</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3847589e641f7e16a0cd68ef30e37cca"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_query_reply_next </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove the oldest item in the queue. </p>
<p>this is called only when there is nothing else to service the reply: this pop does not return anything. We use the ...reply_peek function to return the next item in the reply queue </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00101">101</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                             {</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4" title="keep the queue from getting tangled">lspg_queue_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a2603b071afdbff7c0924b13de2454264" title="The current item being digested.">lspg_query_queue_reply</a> != <a class="code" href="lspg_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6" title="Next position to add something to the queue.">lspg_query_queue_on</a>)</div>
<div class="line">    <a class="code" href="lspg_8c.html#a2603b071afdbff7c0924b13de2454264" title="The current item being digested.">lspg_query_queue_reply</a>++;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4" title="keep the queue from getting tangled">lspg_queue_mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae6bf4f54117bedf903360883bb32699f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a>* lspg_query_reply_peek </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the next item in the reply queue but don't pop it since we may need it more than once. </p>
<p>Call <a class="el" href="kvredis_8c.html#a3847589e641f7e16a0cd68ef30e37cca" title="Remove the oldest item in the queue.">lspg_query_reply_next()</a> when done. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00114">114</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                            {</div>
<div class="line">  <a class="code" href="structlspgQueryQueueStruct.html" title="Store each query along with it&#39;s callback function.">lspg_query_queue_t</a> *rtn;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4" title="keep the queue from getting tangled">lspg_queue_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a2603b071afdbff7c0924b13de2454264" title="The current item being digested.">lspg_query_queue_reply</a> == <a class="code" href="lspg_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6" title="Next position to add something to the queue.">lspg_query_queue_on</a>)</div>
<div class="line">    rtn = NULL;</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    rtn = &amp;(<a class="code" href="lspg_8c.html#a357d9d98f0b8c9625ccebcebfcdce955" title="Our query queue.">lspg_query_queue</a>[(<a class="code" href="lspg_8c.html#a2603b071afdbff7c0924b13de2454264" title="The current item being digested.">lspg_query_queue_reply</a>) % <a class="code" href="lspg_8c.html#a08fe83fe8226002ee8b80ce0a914fd11" title="Queue length should be long enough that we do not ordinarly bump into the end We should be safe as lo...">LS_PG_QUERY_QUEUE_LENGTH</a>]);</div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4" title="keep the queue from getting tangled">lspg_queue_mutex</a>);</div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa8e61b88e2afc47a73630160cca23e11"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_quit_query_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>call back to handle signing out of the database </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l02146">2146</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                                                 {</div>
<div class="line">  <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#a9878a5ed7cb7c2b925a9f902e5ce8d4a">LS_PG_STATE_QUITTING</a>;</div>
<div class="line">  PQfinish( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#ae9209da216af53c39e7c384b89a0f018" title="flag to tell worker it&#39;s time to go home">lspg_running</a> = 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a91e910f7ab9b340bea598b01450e9c6b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_quitting_cb </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prepare to exit the program in a couple of seconds. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l02154">2154</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                    {</div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#aa8e61b88e2afc47a73630160cca23e11" title="call back to handle signing out of the database">lspg_quit_query_cb</a>, <a class="code" href="lspg_8c.html#aa8e61b88e2afc47a73630160cca23e11" title="call back to handle signing out of the database">lspg_quit_query_cb</a>, <span class="stringliteral">&quot;SELECT px.dropairrights()&quot;</span>);</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a038c5af23469b789fc1c55d21cb43029"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_receive </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Receive a result of a query. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01629">1629</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                    {</div>
<div class="line">  PGresult *pgr;</div>
<div class="line">  <a class="code" href="structlspgQueryQueueStruct.html" title="Store each query along with it&#39;s callback function.">lspg_query_queue_t</a> *qqp;</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line"></div>
<div class="line">  err = PQconsumeInput( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">  <span class="keywordflow">if</span>( err != 1) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;consume input failed: %s&quot;</span>, PQerrorMessage( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>));</div>
<div class="line">    <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>;</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// We must call PQgetResult until it returns NULL before sending the next query</span></div>
<div class="line">  <span class="comment">// This implies that only one query can ever be active at a time and our queue</span></div>
<div class="line">  <span class="comment">// management should be simple</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// We should be in the LS_PG_STATE_RECV here</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span>( !PQisBusy( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>)) {</div>
<div class="line">    pgr = PQgetResult( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( pgr == NULL) {</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a3847589e641f7e16a0cd68ef30e37cca" title="Remove the oldest item in the queue.">lspg_query_reply_next</a>();</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// we are now done reading the response from the database</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      ExecStatusType es;</div>
<div class="line"></div>
<div class="line">      qqp = <a class="code" href="kvredis_8c.html#ae6bf4f54117bedf903360883bb32699f" title="Return the next item in the reply queue but don&#39;t pop it since we may need it more than once...">lspg_query_reply_peek</a>();</div>
<div class="line">      es = PQresultStatus( pgr);</div>
<div class="line"></div>
<div class="line">      <span class="keywordflow">if</span>( es != PGRES_COMMAND_OK &amp;&amp; es != PGRES_TUPLES_OK) {</div>
<div class="line">        <span class="keywordtype">char</span> *emess;</div>
<div class="line">        emess = PQresultErrorMessage( pgr);</div>
<div class="line">        <span class="keywordflow">if</span>( emess != NULL &amp;&amp; emess[0] != 0) {</div>
<div class="line">          <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Error from query &#39;%s&#39;:\n%s&quot;</span>, qqp-&gt;<a class="code" href="structlspgQueryQueueStruct.html#a1389b3ec4ddf9ed5cc0344d229a7ff9e" title="our queries should all be pretty short as we&#39;ll just be calling functions: fixed length here simplifi...">qs</a>, emess);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span>( qqp != NULL &amp;&amp; qqp-&gt;<a class="code" href="structlspgQueryQueueStruct.html#ac7e4b4a8c59d7c814670ed1004154c2c" title="Perhaps the caller wants to clean up or recover.">onError</a> != NULL)</div>
<div class="line">          qqp-&gt;<a class="code" href="structlspgQueryQueueStruct.html#ac7e4b4a8c59d7c814670ed1004154c2c" title="Perhaps the caller wants to clean up or recover.">onError</a>();</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// Deal with the response</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// If the response is likely to take awhile we should probably</span></div>
<div class="line">        <span class="comment">// add a new state and put something in the main look to run the onResponse</span></div>
<div class="line">        <span class="comment">// routine in the main loop.  For now, though, we only expect very brief onResponse routines</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="keywordflow">if</span>( qqp != NULL &amp;&amp; qqp-&gt;<a class="code" href="structlspgQueryQueueStruct.html#a53bac5ae4cab775423940bff5092a831" title="Callback function for when a query returns a result.">onResponse</a> != NULL)</div>
<div class="line">          qqp-&gt;<a class="code" href="structlspgQueryQueueStruct.html#a53bac5ae4cab775423940bff5092a831" title="Callback function for when a query returns a result.">onResponse</a>( qqp, pgr);</div>
<div class="line">      }</div>
<div class="line">      PQclear( pgr);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a80df49750b61bb2526618db4253fc4ce"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_t* lspg_run </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start 'er runnin'. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l02180">2180</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                      {</div>
<div class="line"></div>
<div class="line">  pthread_create( &amp;<a class="code" href="lspg_8c.html#a04eb0cda0d5e5afeae7c393b51689765" title="our worker thread">lspg_thread</a>, NULL, <a class="code" href="lspg_8c.html#aaf4fadd2943fa3a2ecb5d840e84d68fa" title="The main loop for the lspg thread.">lspg_worker</a>, NULL);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^(appy|appz|capy|capz|scint) In Position$&quot;</span>, <a class="code" href="lspg_8c.html#a4710c50945fce26b4ac5dc01ed61459d">lspg_check_preset_in_position_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^(appy|appz|capy|capz|scint) Moving$&quot;</span>,      <a class="code" href="lspg_8c.html#abcdcee6ef5ed0865056d42a6cf9da8bd">lspg_unset_current_preset_moving_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^Preset Changed (.+)&quot;</span>,                      <a class="code" href="lspg_8c.html#a69a792e1981af00b2818bcda89bdaa02">lspg_preset_changed_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^Sample(Detected|Absent)$&quot;</span>,                 <a class="code" href="lspg_8c.html#a14546bac5695b536cd348d5e0a1661fa" title="log magnet state">lspg_sample_detector_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^Timer Update KVs$&quot;</span>,                        <a class="code" href="lspg_8c.html#ad503cefdaee8112ea2129d33db2ec7fa" title="Perhaps update the px.kvs table in postgresql Should be triggered by a timer event.">lspg_update_kvs_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^cam.zoom In Position$&quot;</span>,                    <a class="code" href="lspg_8c.html#af61ae1cf46d67e29dfc690b9a98b1b4d" title="Fix up xscale and yscale when zoom changes.">lspg_set_scale_cb</a>);</div>
<div class="line">  <a class="code" href="lsevents_8c.html#a1efedb183d9558ae0f3573712e7918b2" title="Add a callback routine to listen for a specific event.">lsevents_add_listener</a>( <span class="stringliteral">&quot;^Quitting Program$&quot;</span>,                        <a class="code" href="lspg_8c.html#a91e910f7ab9b340bea598b01450e9c6b" title="Prepare to exit the program in a couple of seconds.">lspg_quitting_cb</a>);</div>
<div class="line">  <a class="code" href="lstimer_8c.html#a7b3e725fbe1bb3cc9f8465941cf1e381" title="Create a timer.">lstimer_set_timer</a>(     <span class="stringliteral">&quot;Timer Update KVs&quot;</span>, -1, 0, 500000000);</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Make sure we own the airrights</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <a class="code" href="lspg_8c.html#aa4cad634cac645d0366acbb25cef7b96" title="do nothing until we get airrights">lspg_demandairrights_all</a>();</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span>( &amp;<a class="code" href="lspg_8c.html#a04eb0cda0d5e5afeae7c393b51689765" title="our worker thread">lspg_thread</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a14546bac5695b536cd348d5e0a1661fa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_sample_detector_cb </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>log magnet state </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l02134">2134</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                           {</div>
<div class="line">  <span class="keywordtype">int</span> present;</div>
<div class="line">  <span class="keywordflow">if</span>( strcmp( event, <span class="stringliteral">&quot;SampleDetected&quot;</span>) == 0)</div>
<div class="line">    present = 1;</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    present = 0;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( NULL, NULL, <span class="stringliteral">&quot;SELECT px.logmagnetstate(%s)&quot;</span>, present ? <span class="stringliteral">&quot;TRUE&quot;</span> : <span class="stringliteral">&quot;FALSE&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a714b15e117ffe7bfce4f2f2ce4725b0a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_send_next_query </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>send the next queued query to the DB server </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01582">1582</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                            {</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Normally we should be in the &quot;send&quot; state</span></div>
<div class="line">  <span class="comment">// but we can also send if we are servicing</span></div>
<div class="line">  <span class="comment">// a reply</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  <a class="code" href="structlspgQueryQueueStruct.html" title="Store each query along with it&#39;s callback function.">lspg_query_queue_t</a> *qqp;</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line"></div>
<div class="line">  qqp = <a class="code" href="kvredis_8c.html#ad5f3ec8f197cc330c83dba70f310533c" title="Return the next item in the postgresql queue.">lspg_query_next</a>();</div>
<div class="line">  <span class="keywordflow">if</span>( qqp == NULL) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// A send without a query?  Should never happen.</span></div>
<div class="line">    <span class="comment">// But at least we shouldn&#39;t segfault if it does.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( qqp-&gt;<a class="code" href="structlspgQueryQueueStruct.html#a1389b3ec4ddf9ed5cc0344d229a7ff9e" title="our queries should all be pretty short as we&#39;ll just be calling functions: fixed length here simplifi...">qs</a>[0] == 0) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Do we really have to check this case?</span></div>
<div class="line">    <span class="comment">// It would only come up if we stupidly pushed an empty query string</span></div>
<div class="line">    <span class="comment">// or ran off the end of the queue</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Popped empty query string.  Probably bad things are going on.&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="kvredis_8c.html#a3847589e641f7e16a0cd68ef30e37cca" title="Remove the oldest item in the queue.">lspg_query_reply_next</a>();</div>
<div class="line">    <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a>;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    err = PQsendQuery( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>, qqp-&gt;<a class="code" href="structlspgQueryQueueStruct.html#a1389b3ec4ddf9ed5cc0344d229a7ff9e" title="our queries should all be pretty short as we&#39;ll just be calling functions: fixed length here simplifi...">qs</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( err == 0) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;query failed: %s\n&quot;</span>, PQerrorMessage( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>));</div>
<div class="line"></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Don&#39;t wait for a reply, just reset the connection</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <a class="code" href="kvredis_8c.html#a3847589e641f7e16a0cd68ef30e37cca" title="Remove the oldest item in the queue.">lspg_query_reply_next</a>();</div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#a88a7e80c12fb0449c4b0857a0c7deb21">LS_PG_STATE_SEND_FLUSH</a>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5d3cf153b086f5252f248d17db824917"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspg_seq_run_prep_all </td>
          <td>(</td>
          <td class="paramtype">long long&#160;</td>
          <td class="paramname"><em>skey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>kappa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>phi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>cx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>cy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>ax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>ay</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>az</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convinence function to call seq run prep. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">skey</td><td>px.shots key for this image </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">kappa</td><td>current kappa postion </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phi</td><td>current phi postition </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cx</td><td>current center table x </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cy</td><td>current center table y </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ax</td><td>current alignment table x </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ay</td><td>current alignment table y </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">az</td><td>current alignment table z </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01324">1324</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                             {</div>
<div class="line">  <span class="keywordtype">int</span> rtn;</div>
<div class="line">  <a class="code" href="lspg_8c.html#af7d6efd861b152a371442791deb42bd3" title="queue up the seq_run_prep query">lspg_seq_run_prep_call</a>( skey, <a class="code" href="lspmac_8c.html#a0be79ccb7ebf3a665248fd856112b9fd" title="Kappa.">kappa</a>, <a class="code" href="lspmac_8c.html#ac8070dc568ad974a3db42b51eca828cc" title="Phi (not data collection axis)">phi</a>, cx, cy, ax, ay, az);</div>
<div class="line">  <a class="code" href="lspg_8c.html#ac0b01f501322432a8fa37f31898c3499" title="Wait for seq run prep query to return.">lspg_seq_run_prep_wait</a>();</div>
<div class="line">  rtn = <a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#af7ff6fa6075cabb2bf51ce63afaeee25">query_error</a>;</div>
<div class="line">  <a class="code" href="lspg_8c.html#a472b09ddf716c80207f97e2bb5d37d66" title="Indicate we are done waiting.">lspg_seq_run_prep_done</a>();</div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af7d6efd861b152a371442791deb42bd3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_seq_run_prep_call </td>
          <td>(</td>
          <td class="paramtype">long long&#160;</td>
          <td class="paramname"><em>skey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>kappa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>phi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>cx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>cy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>ax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>ay</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>az</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>queue up the seq_run_prep query </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">skey</td><td>px.shots key for this image </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">kappa</td><td>current kappa postion </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phi</td><td>current phi postition </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cx</td><td>current center table x </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cy</td><td>current center table y </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ax</td><td>current alignment table x </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ay</td><td>current alignment table y </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">az</td><td>current alignment table z </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01288">1288</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                              {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#ad146cb91b5f7dd8bb283092c28781fe7">mutex</a>));</div>
<div class="line">  <a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#a42d08888327e9059ddd69ddfec31b8a9">new_value_ready</a> = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#af7ff6fa6075cabb2bf51ce63afaeee25">query_error</a>     = 0;</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#ad146cb91b5f7dd8bb283092c28781fe7">mutex</a>));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#a11cda12050dc9a86188e15e2155a6013" title="Callback for the seq_run_prep query.">lspg_seq_run_prep_cb</a>, <a class="code" href="lspg_8c.html#a03e51bca6d876ba56e22447c831bf28c" title="Callback for seq_run error.">lspg_seq_run_prep_error_cb</a>, </div>
<div class="line">                   <span class="stringliteral">&quot;SELECT px.seq_run_prep( %lld, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f)&quot;</span>,</div>
<div class="line">                   skey, <a class="code" href="lspmac_8c.html#a0be79ccb7ebf3a665248fd856112b9fd" title="Kappa.">kappa</a>, <a class="code" href="lspmac_8c.html#ac8070dc568ad974a3db42b51eca828cc" title="Phi (not data collection axis)">phi</a>, cx, cy, ax, ay, az);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a11cda12050dc9a86188e15e2155a6013"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_seq_run_prep_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback for the seq_run_prep query. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">qqp</td><td>The query item that generated this callback </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pgr</td><td>The result of the query </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01265">1265</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                            {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#ad146cb91b5f7dd8bb283092c28781fe7">mutex</a>));</div>
<div class="line">  <a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#a42d08888327e9059ddd69ddfec31b8a9">new_value_ready</a> = 1;</div>
<div class="line">  pthread_cond_signal( &amp;(<a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#acd83ea6994f57377716ff01c8ee7ce43">cond</a>));</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#ad146cb91b5f7dd8bb283092c28781fe7">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a472b09ddf716c80207f97e2bb5d37d66"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_seq_run_prep_done </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Indicate we are done waiting. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01318">1318</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                              {</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#ad146cb91b5f7dd8bb283092c28781fe7">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a03e51bca6d876ba56e22447c831bf28c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_seq_run_prep_error_cb </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback for seq_run error. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01278">1278</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                  {</div>
<div class="line">  pthread_mutex_lock( &amp; (<a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#ad146cb91b5f7dd8bb283092c28781fe7">mutex</a>));</div>
<div class="line">  <a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#af7ff6fa6075cabb2bf51ce63afaeee25">query_error</a> = 1;</div>
<div class="line">  pthread_cond_signal( &amp;(<a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#acd83ea6994f57377716ff01c8ee7ce43">cond</a>));</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#ad146cb91b5f7dd8bb283092c28781fe7">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a31823ecb2b44d4a6674f804059a27bce"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_seq_run_prep_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the data collection object. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01256">1256</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                              {</div>
<div class="line">  <a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#a42d08888327e9059ddd69ddfec31b8a9">new_value_ready</a> = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#af7ff6fa6075cabb2bf51ce63afaeee25">query_error</a>     = 0;</div>
<div class="line">  pthread_mutex_init( &amp;(<a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#ad146cb91b5f7dd8bb283092c28781fe7">mutex</a>), NULL);</div>
<div class="line">  pthread_cond_init(  &amp;(<a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#acd83ea6994f57377716ff01c8ee7ce43">cond</a>),  NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac0b01f501322432a8fa37f31898c3499"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_seq_run_prep_wait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for seq run prep query to return. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01310">1310</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                              {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#ad146cb91b5f7dd8bb283092c28781fe7">mutex</a>));</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#a42d08888327e9059ddd69ddfec31b8a9">new_value_ready</a> == 0 &amp;&amp; <a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#af7ff6fa6075cabb2bf51ce63afaeee25">query_error</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;(<a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#acd83ea6994f57377716ff01c8ee7ce43">cond</a>), &amp;(<a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#ad146cb91b5f7dd8bb283092c28781fe7">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af61ae1cf46d67e29dfc690b9a98b1b4d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_set_scale_cb </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fix up xscale and yscale when zoom changes. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l02107">2107</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                     {</div>
<div class="line">  <span class="keywordtype">int</span> mag;</div>
<div class="line">  <a class="code" href="structlsredis__obj__struct.html" title="Redis Object Basic object whose value is sychronized with our redis db.">lsredis_obj_t</a> *px, *py;</div>
<div class="line">  <span class="keywordtype">char</span> *sx, *sy;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// There is already a call back to set the redis variables xScale and yScale</span></div>
<div class="line">  <span class="comment">// we just need to set the KV&#39;s</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  mag = floor(( <a class="code" href="lspmac_8c.html#acc46bdddee59bd8c5ad662b3fd445e9f" title="get the motor position (with locking)">lspmac_getPosition</a>( <a class="code" href="lspmac_8c.html#ad53a42cfaa04eff0336a44c8c9986333" title="Optical zoom.">zoom</a>) + 0.5));</div>
<div class="line">  </div>
<div class="line">  px  = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;cam.zoom.%d.ScaleX&quot;</span>, mag);</div>
<div class="line">  sx = <a class="code" href="lsredis_8c.html#ac1994e56114b2315294527d76311f829" title="return a copy of the key&#39;s string value be sure to free the result">lsredis_getstr</a>( px);</div>
<div class="line"></div>
<div class="line">  py  = <a class="code" href="lsredis_8c.html#ad3bb3ebbae1ffbd03e062ecdd663cc6a">lsredis_get_obj</a>( <span class="stringliteral">&quot;cam.zoom.%d.ScaleY&quot;</span>, mag);</div>
<div class="line">  sy = <a class="code" href="lsredis_8c.html#ac1994e56114b2315294527d76311f829" title="return a copy of the key&#39;s string value be sure to free the result">lsredis_getstr</a>( py);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( NULL, NULL, <span class="stringliteral">&quot;EXECUTE kvupdate( &#39;{cam.xScale,%s,cam.yScale,%s}&#39;)&quot;</span>, sx, sy);</div>
<div class="line">  free( sx);</div>
<div class="line">  free( sy);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a049f4422994aa2eb2b841ffb2937f895"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_sig_service </td>
          <td>(</td>
          <td class="paramtype">struct pollfd *&#160;</td>
          <td class="paramname"><em>evt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Service a signal Signals here are treated as file descriptors and fits into our poll scheme. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">evt</td><td>The pollfd object that triggered this call </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01692">1692</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                        {</div>
<div class="line">  <span class="keyword">struct </span>signalfd_siginfo fdsi;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Really, we don&#39;t care about the signal,</span></div>
<div class="line">  <span class="comment">// it&#39;s just used to drop out of the poll</span></div>
<div class="line">  <span class="comment">// function when there is something for us</span></div>
<div class="line">  <span class="comment">// to do that didn&#39;t invovle something coming</span></div>
<div class="line">  <span class="comment">// from our postgresql server.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// This is accompished by the query_push function</span></div>
<div class="line">  <span class="comment">// to notify us that a new query is ready.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  read( evt-&gt;fd, &amp;fdsi, <span class="keyword">sizeof</span>( <span class="keyword">struct</span> signalfd_siginfo));</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a40fed0d8ea49206604ca5727d94b8faf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspg_starttransfer_all </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>err</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>nextsample</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sampledetected</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>ax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>ay</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>az</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>horz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>vert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>esttime</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00427">427</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                                                                                                                                              {</div>
<div class="line">  <span class="keywordtype">int</span> rtn;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#af72c4b037347737df09348ab703f6802">lspg_starttransfer_call</a>( nextsample, sampledetected, ax, ay, az, horz, vert, esttime);</div>
<div class="line">  <a class="code" href="lspg_8c.html#a189e9fd5cbc06dd09e5549f6e229fa5e">lspg_starttransfer_wait</a>();</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#aa384ccd326d9247317f77072b93f94ca" title="just in case, though this query should always return an integer, perhaps 0">no_rows_returned</a> || <a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#af01b6bac6db9830719aef63e552312eb" title="sample number (4 8-bit segments: station, dewar (lid), puck, and position in the puck)">starttransfer</a> != 1) {</div>
<div class="line">    *err = 1;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    *err = 0;</div>
<div class="line">    rtn = <a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#af01b6bac6db9830719aef63e552312eb" title="sample number (4 8-bit segments: station, dewar (lid), puck, and position in the puck)">starttransfer</a>;</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad989179281d8b65b940250a4580007d0">lspg_starttransfer_done</a>();</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af72c4b037347737df09348ab703f6802"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_starttransfer_call </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>nextsample</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sample_detected</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>ax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>ay</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>az</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>horz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>vert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>esttime</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00405">405</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                                                                                                                                       {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a47824bb2701a699d43a7a916e2010705" title="Our mutex.">mutex</a>));</div>
<div class="line">  <a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#ad3a6356e5ccce15c982ddecf9634999f" title="flag for our condition">new_value_ready</a> = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a5ef1d5a6708b3872761b86aef34d7aeb" title="1 if the query failed for any reason">query_error</a>     = 0;</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a47824bb2701a699d43a7a916e2010705" title="Our mutex.">mutex</a>));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#a289005bed571909f5ce4de2ff4e70e36">lspg_starttransfer_cb</a>, <a class="code" href="lspg_8c.html#aed6571a457cde0cd7c1ef1250d8f0a75">lspg_starttransfer_error_cb</a>,</div>
<div class="line">                   <span class="stringliteral">&quot;SELECT px.starttransfer( %d, %s, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f)&quot;</span>,</div>
<div class="line">                   nextsample, <a class="code" href="lspmac_8c.html#ac59ab990e48033a811aeb0281fb588fc" title="smart magnet detected sample">sample_detected</a> ? <span class="stringliteral">&quot;True&quot;</span> : <span class="stringliteral">&quot;False&quot;</span>, ax, ay, az, horz, vert, esttime);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a289005bed571909f5ce4de2ff4e70e36"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_starttransfer_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">qqp</td><td>Our nextsample query </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pgr</td><td>result of the query </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00377">377</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                        {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a47824bb2701a699d43a7a916e2010705" title="Our mutex.">mutex</a>));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#ad3a6356e5ccce15c982ddecf9634999f" title="flag for our condition">new_value_ready</a> = 1;</div>
<div class="line">  <span class="keywordflow">if</span>( PQntuples( pgr) &lt;=0) {</div>
<div class="line">    <a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#aa384ccd326d9247317f77072b93f94ca" title="just in case, though this query should always return an integer, perhaps 0">no_rows_returned</a> = 1;</div>
<div class="line">    <a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#af01b6bac6db9830719aef63e552312eb" title="sample number (4 8-bit segments: station, dewar (lid), puck, and position in the puck)">starttransfer</a> = 0;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#aa384ccd326d9247317f77072b93f94ca" title="just in case, though this query should always return an integer, perhaps 0">no_rows_returned</a> = 0;</div>
<div class="line">    <span class="keywordflow">if</span>( PQgetisnull( pgr, 0, 0) || strcmp( PQgetvalue( pgr,0,0), <span class="stringliteral">&quot;1&quot;</span>) != 0)</div>
<div class="line">      <a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#af01b6bac6db9830719aef63e552312eb" title="sample number (4 8-bit segments: station, dewar (lid), puck, and position in the puck)">starttransfer</a> = 0;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      <a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#af01b6bac6db9830719aef63e552312eb" title="sample number (4 8-bit segments: station, dewar (lid), puck, and position in the puck)">starttransfer</a> = 1;</div>
<div class="line">  }</div>
<div class="line">  pthread_cond_signal( &amp;(<a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a1a569a2afabd7910219ff9d2d48c1b38" title="Our condition.">cond</a>));</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a47824bb2701a699d43a7a916e2010705" title="Our mutex.">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad989179281d8b65b940250a4580007d0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_starttransfer_done </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00422">422</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                               {</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a47824bb2701a699d43a7a916e2010705" title="Our mutex.">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aed6571a457cde0cd7c1ef1250d8f0a75"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_starttransfer_error_cb </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00398">398</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                    {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a47824bb2701a699d43a7a916e2010705" title="Our mutex.">mutex</a>));</div>
<div class="line">  <a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a5ef1d5a6708b3872761b86aef34d7aeb" title="1 if the query failed for any reason">query_error</a> = 1;</div>
<div class="line">  pthread_cond_signal( &amp;(<a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a1a569a2afabd7910219ff9d2d48c1b38" title="Our condition.">cond</a>));</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a47824bb2701a699d43a7a916e2010705" title="Our mutex.">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab98f7d254fa0f5f4826f9427ca8b4f03"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_starttransfer_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00370">370</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                               {</div>
<div class="line">  <a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#ad3a6356e5ccce15c982ddecf9634999f" title="flag for our condition">new_value_ready</a> = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a5ef1d5a6708b3872761b86aef34d7aeb" title="1 if the query failed for any reason">query_error</a>     = 0;</div>
<div class="line">  pthread_mutex_init( &amp;<a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a47824bb2701a699d43a7a916e2010705" title="Our mutex.">mutex</a>, NULL);</div>
<div class="line">  pthread_cond_init( &amp;<a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a1a569a2afabd7910219ff9d2d48c1b38" title="Our condition.">cond</a>, NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a189e9fd5cbc06dd09e5549f6e229fa5e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_starttransfer_wait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00416">416</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                               {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a47824bb2701a699d43a7a916e2010705" title="Our mutex.">mutex</a>));</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#ad3a6356e5ccce15c982ddecf9634999f" title="flag for our condition">new_value_ready</a> == 0 &amp;&amp; <a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a5ef1d5a6708b3872761b86aef34d7aeb" title="1 if the query failed for any reason">query_error</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;(<a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a1a569a2afabd7910219ff9d2d48c1b38" title="Our condition.">cond</a>), &amp;(<a class="code" href="lspg_8c.html#af18499d17171eff473cfc49d4a0a5562" title="start a sample transfer">lspg_starttransfer</a>.<a class="code" href="structlspg__starttransfer__struct.html#a47824bb2701a699d43a7a916e2010705" title="Our mutex.">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="abcdcee6ef5ed0865056d42a6cf9da8bd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_unset_current_preset_moving_cb </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l02084">2084</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                                       {</div>
<div class="line">  <a class="code" href="structlspmac__motor__struct.html" title="Motor information.">lspmac_motor_t</a> *mp;</div>
<div class="line">  <span class="keywordtype">char</span> cp[64];</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;strlen( event); i++) {</div>
<div class="line">    cp[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>] = 0;</div>
<div class="line">    <span class="keywordflow">if</span>( event[i] == <span class="charliteral">&#39; &#39;</span>)</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    cp[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>] = <span class="keyword">event</span>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>];</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  mp = <a class="code" href="lspmac_8c.html#a22ef36819bdee963712691e660cfc101">lspmac_find_motor_by_name</a>( cp);</div>
<div class="line">  <span class="keywordflow">if</span>( mp == NULL) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspg_unset_current_reset_moving_cb: Could not find motor &#39;%s&#39;&quot;</span>, cp);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( NULL, NULL, <span class="stringliteral">&quot;EXECUTE kvupdate( &#39;{%s.currentPreset,-1}&#39;)&quot;</span>, cp);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad503cefdaee8112ea2129d33db2ec7fa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_update_kvs_cb </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Perhaps update the px.kvs table in postgresql Should be triggered by a timer event. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00313">313</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                      {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">char</span> s[<a class="code" href="kvredis_8c.html#a3a8ef1b4b5994d6dd12bf74454ea891b">LS_PG_QUERY_STRING_LENGTH</a> - 64], *fmt;</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>, need_comma, n;</div>
<div class="line">  <a class="code" href="structlspmac__motor__struct.html" title="Motor information.">lspmac_motor_t</a> *mp;</div>
<div class="line">  <span class="keywordtype">int</span> updateme;</div>
<div class="line">  <span class="keywordtype">double</span> new_value;</div>
<div class="line"></div>
<div class="line">  s[0] = 0;</div>
<div class="line">  need_comma = 0;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;<a class="code" href="lspmac_8c.html#a56260f012c50a591ee7f97e500f16994" title="The number of motors we manage.">lspmac_nmotors</a>; i++ ) {</div>
<div class="line">    mp = &amp;(<a class="code" href="lspmac_8c.html#afbfbc3160d5ed6afefdb07f6a25924f7" title="All our motors.">lspmac_motors</a>[<a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>]);</div>
<div class="line">    pthread_mutex_lock( &amp;mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( fabs(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a959bd55eb5c88a30cd4873ea567944d8" title="previous position reported to postgresql">reported_pg_position</a> - mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a>) &gt;= <a class="code" href="lsredis_8c.html#aa8daf63b794b6b6341018feec205cb7d">lsredis_getd</a>(mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aefa84c7592369090eec8b211caaa3a51" title="Change needs to be at least this big to report as a new position to the database.">update_resolution</a>)) {</div>
<div class="line">      new_value = mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a>;</div>
<div class="line">      mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a959bd55eb5c88a30cd4873ea567944d8" title="previous position reported to postgresql">reported_pg_position</a> = mp-&gt;<a class="code" href="structlspmac__motor__struct.html#af8ffb3aed907d8664b65b37601954411" title="scaled position">position</a>;</div>
<div class="line">      fmt = <a class="code" href="lsredis_8c.html#ac1994e56114b2315294527d76311f829" title="return a copy of the key&#39;s string value be sure to free the result">lsredis_getstr</a>( mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a91c38b2072d878b71f4e77de2f1375a4" title="special format string to create text array for putting the position back into redis">redis_fmt</a>);     <span class="comment">// borrow the redis format</span></div>
<div class="line">      updateme = 1;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      updateme = 0;</div>
<div class="line">    }</div>
<div class="line">    pthread_mutex_unlock( &amp;mp-&gt;<a class="code" href="structlspmac__motor__struct.html#a188c5b1e991750ce2ffd53e0192e0907" title="coordinate waiting for motor to be done">mutex</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( !updateme)</div>
<div class="line">      <span class="keywordflow">continue</span>;</div>
<div class="line">    </div>
<div class="line">    n = strlen( s);</div>
<div class="line">    snprintf( &amp;(s[n]), <span class="keyword">sizeof</span>(s)-n-1, <span class="stringliteral">&quot;%s%s.position,&quot;</span>, need_comma++ ? <span class="stringliteral">&quot;,&quot;</span> : <span class="stringliteral">&quot;&quot;</span>, mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line"></div>
<div class="line">    n = strlen( s);</div>
<div class="line">    snprintf( &amp;(s[n]), <span class="keyword">sizeof</span>(s)-n-1, fmt, new_value);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// And again for the original remote interface</span></div>
<div class="line">    <span class="comment">// We&#39;ll be able to remove this, someday</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    n = strlen( s);</div>
<div class="line">    snprintf( &amp;(s[n]), <span class="keyword">sizeof</span>(s)-n-1, <span class="stringliteral">&quot;,%s,&quot;</span>,  mp-&gt;<a class="code" href="structlspmac__motor__struct.html#aa90af2f6f1489f1befe1d0891e51575a" title="Name of motor as refered by ls database kvs table.">name</a>);</div>
<div class="line"></div>
<div class="line">    n = strlen( s);</div>
<div class="line">    snprintf( &amp;(s[n]), <span class="keyword">sizeof</span>(s)-n-1, fmt, new_value);</div>
<div class="line">    free( fmt);</div>
<div class="line"></div>
<div class="line">    n = strlen( s);</div>
<div class="line">    <span class="keywordflow">if</span>( n &gt;= <span class="keyword">sizeof</span>(s) - 64) {</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( NULL, NULL, <span class="stringliteral">&quot;EXECUTE kvupdate(&#39;{%s}&#39;)&quot;</span>, s);</div>
<div class="line">      s[0] = 0;</div>
<div class="line">      need_comma = 0;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( strlen(s)) {</div>
<div class="line">    <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( NULL, NULL, <span class="stringliteral">&quot;EXECUTE kvupdate(&#39;{%s}&#39;)&quot;</span>, s);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab9780e15924a50b2a5545e10806000b3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_wait_for_detector_all </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Combined call to wait for the detector. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01095">1095</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                  {</div>
<div class="line">  <a class="code" href="lspg_8c.html#a4b5222b859a44eae616804a1e990b86d" title="initiate the wait for detector query">lspg_wait_for_detector_call</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#af094e01be121ce8e14abb679abd17e19" title="Pause the calling thread until the detector is ready Called by the MD2 thread.">lspg_wait_for_detector_wait</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#abb3645dee7c4514b650ab02f27570a69" title="Done waiting for the detector.">lspg_wait_for_detector_done</a>();</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4b5222b859a44eae616804a1e990b86d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_wait_for_detector_call </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>initiate the wait for detector query </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01068">1068</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                   {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#a958e9fe59e671e61f95c2ce796ba24ce">mutex</a>));</div>
<div class="line">  <a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#ad950e85c70c4473c5c7c40f8ceeae61d">new_value_ready</a> = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#a5b4032f8407bb1e4aec7fb59045601b2">query_error</a>     = 0;</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#a958e9fe59e671e61f95c2ce796ba24ce">mutex</a>));</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#a5747c519d1aa4c310010a862cae8a823" title="Callback for the wait for detector query.">lspg_wait_for_detector_cb</a>, <a class="code" href="lspg_8c.html#a9a2365af50268b1ebce795b818c375a8" title="wait for detector query error callback">lspg_wait_for_detector_error_cb</a>, <span class="stringliteral">&quot;SELECT px.lock_detector_test_block()&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5747c519d1aa4c310010a862cae8a823"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_wait_for_detector_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback for the wait for detector query. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01050">1050</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                                                        {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#a958e9fe59e671e61f95c2ce796ba24ce">mutex</a>));</div>
<div class="line">  <a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#ad950e85c70c4473c5c7c40f8ceeae61d">new_value_ready</a> = 1;</div>
<div class="line">  pthread_cond_signal(  &amp;(<a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#aa97388f93ca5099196ba0da1e4a5b7bb">cond</a>));</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#a958e9fe59e671e61f95c2ce796ba24ce">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="abb3645dee7c4514b650ab02f27570a69"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_wait_for_detector_done </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Done waiting for the detector. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01088">1088</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                   {</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#a958e9fe59e671e61f95c2ce796ba24ce">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9a2365af50268b1ebce795b818c375a8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_wait_for_detector_error_cb </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>wait for detector query error callback </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01059">1059</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                       {</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#a958e9fe59e671e61f95c2ce796ba24ce">mutex</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#a5b4032f8407bb1e4aec7fb59045601b2">query_error</a> = 1;</div>
<div class="line">  pthread_cond_signal( &amp;<a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#aa97388f93ca5099196ba0da1e4a5b7bb">cond</a>);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#a958e9fe59e671e61f95c2ce796ba24ce">mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3517f8fbed91c998f6036284f9bd0c48"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_wait_for_detector_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>initialize the detector timing object </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01041">1041</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                   {</div>
<div class="line">  <a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#ad950e85c70c4473c5c7c40f8ceeae61d">new_value_ready</a> = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#a5b4032f8407bb1e4aec7fb59045601b2">query_error</a>     = 0;</div>
<div class="line">  pthread_mutex_init( &amp;(<a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#a958e9fe59e671e61f95c2ce796ba24ce">mutex</a>), NULL);</div>
<div class="line">  pthread_cond_init(  &amp;(<a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#aa97388f93ca5099196ba0da1e4a5b7bb">cond</a>), NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af094e01be121ce8e14abb679abd17e19"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_wait_for_detector_wait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Pause the calling thread until the detector is ready Called by the MD2 thread. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01080">1080</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                   {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#a958e9fe59e671e61f95c2ce796ba24ce">mutex</a>));</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#ad950e85c70c4473c5c7c40f8ceeae61d">new_value_ready</a> == 0 &amp;&amp; <a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#a5b4032f8407bb1e4aec7fb59045601b2">query_error</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;(<a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#aa97388f93ca5099196ba0da1e4a5b7bb">cond</a>), &amp;(<a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#a958e9fe59e671e61f95c2ce796ba24ce">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a68d367d98c780a95b2c347d09e9ddec3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lspg_waitcryo_all </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>no need to get fancy with the wait cryo command It should not return until the robot is almost ready for air rights </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00655">655</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                        {</div>
<div class="line">  <span class="keywordtype">int</span> rtn;</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a62b50ead380fc8a6be35956eba384ba6" title="practice safe threading">mutex</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a97298b773fd8c1f2ef20159093a08246" title="OK, there is never a value, we need a variable for the conditional wait and this is what we call it e...">new_value_ready</a> = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a562f641a86142566aa67dc41f2676fb7" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a>     = 0;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#a7497a7c924b31c727ea487a3efb77fb6">lspg_waitcryo_cb</a>, <a class="code" href="lspg_8c.html#a21393baf18a3934474b40e0006d93d50">lspg_waitcryo_error_cb</a>, <span class="stringliteral">&quot;SELECT px.waitcryo()&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a97298b773fd8c1f2ef20159093a08246" title="OK, there is never a value, we need a variable for the conditional wait and this is what we call it e...">new_value_ready</a> == 0 &amp;&amp; <a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a562f641a86142566aa67dc41f2676fb7" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;<a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a54c275159d9f096e0d1884e64d099298" title="for signaling">cond</a>, &amp;<a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a62b50ead380fc8a6be35956eba384ba6" title="practice safe threading">mutex</a>);</div>
<div class="line"></div>
<div class="line">  rtn = <a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a562f641a86142566aa67dc41f2676fb7" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a>;</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a62b50ead380fc8a6be35956eba384ba6" title="practice safe threading">mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7497a7c924b31c727ea487a3efb77fb6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_waitcryo_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00638">638</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                                               {</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a62b50ead380fc8a6be35956eba384ba6" title="practice safe threading">mutex</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a97298b773fd8c1f2ef20159093a08246" title="OK, there is never a value, we need a variable for the conditional wait and this is what we call it e...">new_value_ready</a> = 1;</div>
<div class="line">  pthread_cond_signal( &amp;<a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a54c275159d9f096e0d1884e64d099298" title="for signaling">cond</a>);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a62b50ead380fc8a6be35956eba384ba6" title="practice safe threading">mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a21393baf18a3934474b40e0006d93d50"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_waitcryo_error_cb </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00645">645</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                              {</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a62b50ead380fc8a6be35956eba384ba6" title="practice safe threading">mutex</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a562f641a86142566aa67dc41f2676fb7" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a> = 1;</div>
<div class="line">  pthread_cond_signal( &amp;<a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a54c275159d9f096e0d1884e64d099298" title="for signaling">cond</a>);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a62b50ead380fc8a6be35956eba384ba6" title="practice safe threading">mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a32b2bf00d66ee5fca130ee616a09cf7b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_waitcryo_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00631">631</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  <a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a97298b773fd8c1f2ef20159093a08246" title="OK, there is never a value, we need a variable for the conditional wait and this is what we call it e...">new_value_ready</a> = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a562f641a86142566aa67dc41f2676fb7" title="0 is OK, 1 is postgres complained. Note current implemention automatically logs the error...">query_error</a>     = 0;</div>
<div class="line">  pthread_mutex_init( &amp;<a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a62b50ead380fc8a6be35956eba384ba6" title="practice safe threading">mutex</a>, NULL);</div>
<div class="line">  pthread_cond_init( &amp;<a class="code" href="lspg_8c.html#a5f699604dcc5d3d64fd6cb5c363d29c9" title="signal the robot">lspg_waitcryo</a>.<a class="code" href="structlspg__waitcryo__struct.html#a54c275159d9f096e0d1884e64d099298" title="for signaling">cond</a>, NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aaf4fadd2943fa3a2ecb5d840e84d68fa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* lspg_worker </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>dummy</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The main loop for the lspg thread. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">dummy</td><td>Required by pthreads but unused </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01966">1966</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                    {</div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">struct </span>pollfd fda[2];  <span class="comment">// 0=signal handler, 1=pg socket</span></div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> nfda = 0;</div>
<div class="line">  <span class="keyword">static</span> sigset_t <a class="code" href="pgpmac_8c.html#a76042459b23ade6d59ce9698d890ea89">our_sigset</a>;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// block ordinary signal mechanism</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  sigemptyset( &amp;our_sigset);</div>
<div class="line">  sigaddset( &amp;our_sigset, SIGUSR1);</div>
<div class="line">  pthread_sigmask(SIG_BLOCK, &amp;our_sigset, NULL);</div>
<div class="line"></div>
<div class="line">    </div>
<div class="line">  fda[0].fd = signalfd( -1, &amp;our_sigset, SFD_NONBLOCK);</div>
<div class="line">  <span class="keywordflow">if</span>( fda[0].fd == -1) {</div>
<div class="line">    <span class="keywordtype">char</span> *es;</div>
<div class="line"></div>
<div class="line">    es = strerror( errno);</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Signalfd trouble: %s&quot;</span>, es);</div>
<div class="line">  }</div>
<div class="line">  fda[0].events = POLLIN;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">//  make sure file descriptor is not legal until it&#39;s been conneceted</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.fd   = -1;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lspg_8c.html#ae9209da216af53c39e7c384b89a0f018" title="flag to tell worker it&#39;s time to go home">lspg_running</a>) {</div>
<div class="line">    <span class="keywordtype">int</span> pollrtn;</div>
<div class="line">    <span class="keywordtype">int</span> poll_timeout_ms;</div>
<div class="line"></div>
<div class="line">   <a class="code" href="kvredis_8c.html#ab52a8c8245bf6561f40c0f224fc07ff4" title="Implements our state machine Does not strictly only set the next state as it also calls some function...">lspg_next_state</a>();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.fd == -1) {</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Here a connection to the database is not established.</span></div>
<div class="line">      <span class="comment">// Periodicaly try again.  Should possibly arrange to reconnect</span></div>
<div class="line">      <span class="comment">// to signalfd but that&#39;s unlikely to be nessesary.</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      nfda = 1;</div>
<div class="line">      poll_timeout_ms = 10000;</div>
<div class="line">      fda[1].revents = 0;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Arrange to peacfully do nothing until either the pg server sends us something</span></div>
<div class="line">      <span class="comment">// or someone pushs something onto our queue</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      nfda = 2;</div>
<div class="line">      fda[1].fd      = <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.fd;</div>
<div class="line">      fda[1].events  = <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events;</div>
<div class="line">      fda[1].revents = 0;</div>
<div class="line">      poll_timeout_ms = -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    pollrtn = poll( fda, nfda, poll_timeout_ms);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( pollrtn &amp;&amp; fda[0].revents) {</div>
<div class="line">      <a class="code" href="lspg_8c.html#a049f4422994aa2eb2b841ffb2937f895" title="Service a signal Signals here are treated as file descriptors and fits into our poll scheme...">lspg_sig_service</a>( &amp;(fda[0]));</div>
<div class="line">      pollrtn--;</div>
<div class="line">    } </div>
<div class="line">    <span class="keywordflow">if</span>( pollrtn &amp;&amp; fda[1].revents) {</div>
<div class="line">      <a class="code" href="kvredis_8c.html#aa8d1fed4b461c2139a21826d524777d5" title="I/O control to/from the postgresql server.">lspg_pg_service</a>( &amp;(fda[1]));</div>
<div class="line">      pollrtn--;</div>
<div class="line">    } </div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> NULL;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a4937baac0cc78ea306d58b5f027867f1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int ls_pg_state = <a class="el" href="lspg_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>State of the lspg state machine. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00040">40</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a69ae04978986e6413ca7cefcb692b645"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">PostgresPollingStatusType lspg_connectPoll_response</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Used to determine state while connecting. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00062">62</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="adf89a0299edd6a99992b95dff8992eba"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a7f71abc6fdfd1839e2e3213d78aaf766">lspg_demandairrights_t</a> lspg_demandairrights</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>our demandairrights object </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00068">68</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7ef8a09203117578c9b2ce4719519f36"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a48b627e412dd038c1f17cdb0501eec33">lspg_getcenter_t</a> lspg_getcenter</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>the getcenter object </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00067">67</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5c50804e6019d47d91f3f1cb3ebd1f00"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a7a794370785ff015d5ee035917e3bee8">lspg_getcurrentsampleid_t</a> lspg_getcurrentsampleid</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>our currentsample id </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00069">69</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="adbf3b3652c6531c3d194320d1abc1c80"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lspg_8c.html#a3442e66a1f05457eb22a0d4a5d295f3a">lspg_lock_detector_t</a> lspg_lock_detector</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01182">1182</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="aaae7ce3ecd7d54a9e46c41d7a742a454"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lspg_8c.html#a7232a0d630558f0c4c081d087150973d">lspg_lock_diffractometer_t</a> lspg_lock_diffractometer</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01111">1111</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="adbf70f382e469e02dce77833981f9547"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a9dda9014cd0e39fba8d523e37cf9f982">lspg_nextsample_t</a> lspg_nextsample</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>the very next sample </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00065">65</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad8d8e2f578ca79189a80c1fd5b60cefd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a17ea2bf07a0b3b892baa00bd392607b3">lspg_nextshot_t</a> lspg_nextshot</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>the nextshot object </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00066">66</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a357d9d98f0b8c9625ccebcebfcdce955"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> lspg_query_queue[<a class="el" href="lspg_8c.html#a08fe83fe8226002ee8b80ce0a914fd11">LS_PG_QUERY_QUEUE_LENGTH</a>]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Our query queue. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00053">53</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="aca86bb77d6cecfae9251743f4171bafb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int lspg_query_queue_off = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The last item still being used (on == off means nothing in queue) </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00055">55</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3cbe7f3161b3c1838ebc56a3bbcfd8a6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int lspg_query_queue_on = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Next position to add something to the queue. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00054">54</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2603b071afdbff7c0924b13de2454264"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int lspg_query_queue_reply = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The current item being digested. </p>
<p>Normally off &lt;= reply &lt;= on. Corner case of queue wrap arround works because we only increment and compare for equality. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00056">56</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a61a308b6a37afd645beb422653b95baa"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pthread_cond_t lspg_queue_cond</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>keeps the queue from overflowing </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00045">45</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="aed46a94106c583796e3a8ca0e89aa8e4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t lspg_queue_mutex</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>keep the queue from getting tangled </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00044">44</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a06c5a937e41a6c706a247777642ec1fb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">PostgresPollingStatusType lspg_resetPoll_response</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Used to determine state while reconnecting. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00063">63</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae9209da216af53c39e7c384b89a0f018"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int lspg_running = 1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>flag to tell worker it's time to go home </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00061">61</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1b0d9fc30bcea6905b075d2362149172"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lspg_8c.html#ab2da550aea6388c835abe0ee0b226eb0">lspg_seq_run_prep_t</a> lspg_seq_run_prep</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01252">1252</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="af18499d17171eff473cfc49d4a0a5562"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#aa1f0e602ae9509005c62fb2d73bc1c5a">lspg_starttransfer_t</a> lspg_starttransfer</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>start a sample transfer </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00070">70</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a04eb0cda0d5e5afeae7c393b51689765"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pthread_t lspg_thread</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>our worker thread </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00043">43</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a0dfc8d0410cd2d7f7da7a70d3ef88e58"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lspg_8c.html#a6f273a499bf316de95df3816a9b1bc06">lspg_wait_for_detector_t</a> lspg_wait_for_detector</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Instance of the detector timing object. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01037">1037</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5f699604dcc5d3d64fd6cb5c363d29c9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a779e2acce8b5e748c184caf23ed0db57">lspg_waitcryo_t</a> lspg_waitcryo</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>signal the robot </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00071">71</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="af3f897b8ffa020ca54289bc5b28cb64d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct pollfd lspgfd</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>our poll info </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00046">46</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad40ac52086f6b774928af45b09d54c6e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct timeval lspg_time_sent now</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>used to ensure we do not inundate the db server with connection requests </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00041">41</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9012783dbbadf652a81649a289697cf3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">PGconn* q = NULL</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Database connector. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00060">60</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="lspg_8c.html">lspg.c</a></li>
    <li class="footer">Generated on Fri May 23 2014 09:07:05 for LS-CAT PGPMAC by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 </li>
  </ul>
</div>
</body>
</html>
