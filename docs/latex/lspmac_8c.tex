\hypertarget{lspmac_8c}{\section{lspmac.\-c File Reference}
\label{lspmac_8c}\index{lspmac.\-c@{lspmac.\-c}}
}


Routines concerned with communication with P\-M\-A\-C.  


{\ttfamily \#include \char`\"{}pgpmac.\-h\char`\"{}}\\*
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structmd2StatusStruct}{md2\-Status\-Struct}
\begin{DoxyCompactList}\small\item\em The block of memory retrieved in a status request. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{lspmac_8c_a7e1c68021b3dbb53ba1bac2afbd8fc20}{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-S\-E\-T}~-\/1
\item 
\#define \hyperlink{lspmac_8c_a7eb86ecf0789ab9555de1e03a4c73567}{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-D\-E\-T\-A\-C\-H\-E\-D}~0
\item 
\#define \hyperlink{lspmac_8c_a37741af675425d61c876cc30ae6c99d0}{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-D\-L\-E}~1
\item 
\#define \hyperlink{lspmac_8c_a7d8f34fc599cc08c1a9d2cd62ccbb20a}{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-S\-C}~2
\item 
\#define \hyperlink{lspmac_8c_a63356b0c18fcb186f456c12c6e927d84}{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K\-\_\-\-N\-F\-R}~3
\item 
\#define \hyperlink{lspmac_8c_adef540911028fda73e8bbf0aa6ad39e9}{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K\-\_\-\-C\-C}~4
\item 
\#define \hyperlink{lspmac_8c_a5eba9ef09d4316e803b9d75bd3104f43}{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K}~5
\item 
\#define \hyperlink{lspmac_8c_a220b39710719cfe8b500d51819e8efeb}{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-G\-M\-R}~6
\item 
\#define \hyperlink{lspmac_8c_abbd709b56a71eb1fc6adc9063605d243}{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-C\-R}~7
\item 
\#define \hyperlink{lspmac_8c_add5325f4a84e4fe05f558880349485ea}{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-R}~8
\item 
\#define \hyperlink{lspmac_8c_a3e0a62cd9a1212419ad3615c34bdc65a}{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K\-\_\-\-R\-R}~9
\item 
\#define \hyperlink{lspmac_8c_a5f4ff8874677aac48a4c675f2c1ca4e9}{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-G\-B}~10
\item 
\#define \hyperlink{lspmac_8c_a27ee6c39d58604c8aa9bd6c249c4833f}{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-C\-R}~11
\item 
\#define \hyperlink{lspmac_8c_a591822cc92f76a39b293c2e90b322db2}{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-G\-B}~12
\item 
\#define \hyperlink{lspmac_8c_ac95886e84843b6b0bb6cc270e42043c4}{P\-M\-A\-C\-P\-O\-R\-T}~1025
\begin{DoxyCompactList}\small\item\em The P\-M\-A\-C (only) listens on this port. \end{DoxyCompactList}\item 
\#define \hyperlink{lspmac_8c_abdc45e3f7106f84f688419e2da9b3627}{pmac\-\_\-cmd\-\_\-size}~8
\begin{DoxyCompactList}\small\item\em P\-M\-A\-C command size in bytes. \end{DoxyCompactList}\item 
\#define \hyperlink{lspmac_8c_a5485d08fdc80533b5cebadff63696ed2}{V\-R\-\_\-\-U\-P\-L\-O\-A\-D}~0xc0
\item 
\#define \hyperlink{lspmac_8c_af24ecdc10723dc8fd6320fef416ae514}{V\-R\-\_\-\-D\-O\-W\-N\-L\-O\-A\-D}~0x40
\item 
\#define \hyperlink{lspmac_8c_a772b2ea2ad93989ae4275c79a93525ee}{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-N\-D\-L\-I\-N\-E}~0xb0
\item 
\#define \hyperlink{lspmac_8c_af3c7372a48fccf0458f266f4bc758a2c}{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-L\-I\-N\-E}~0xb1
\item 
\#define \hyperlink{lspmac_8c_ac0e5588681366b52589cd321eabf12ff}{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-F\-L\-U\-S\-H}~0xb3
\item 
\#define \hyperlink{lspmac_8c_af9c53e7c5b2681a5ca1c5410a914a2dc}{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-M\-E\-M}~0xb4
\item 
\#define \hyperlink{lspmac_8c_ab79207cc3145740f8c070a24c91b11e0}{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-T\-M\-E\-M}~0xb5
\item 
\#define \hyperlink{lspmac_8c_a76c1c401354826ac2ba8906578be930f}{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-N\-D\-C\-T\-R\-L\-C\-H\-A\-R}~0xb6
\item 
\#define \hyperlink{lspmac_8c_aaed77195148c3d9fe10c6e82fc6b2ea7}{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-T\-B\-I\-T}~0xba
\item 
\#define \hyperlink{lspmac_8c_a91a625425f6df7610f440231868a5cf1}{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-T\-B\-I\-T\-S}~0xbb
\item 
\#define \hyperlink{lspmac_8c_a4cd95cb80b8da3962ebe9ec8afe844c8}{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-P\-O\-R\-T}~0xbe
\item 
\#define \hyperlink{lspmac_8c_aee7c46f33b9b6945c6b2b260810dc7f5}{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-R\-E\-S\-P\-O\-N\-S\-E}~0xbf
\item 
\#define \hyperlink{lspmac_8c_aad3c7b4a9403e56c09eceadcf21252c0}{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-R\-E\-A\-D\-R\-E\-A\-D\-Y}~0xc2
\item 
\#define \hyperlink{lspmac_8c_a8f4ce4666a23a3fb153d680bd1cb6556}{V\-R\-\_\-\-C\-T\-R\-L\-\_\-\-R\-E\-S\-P\-O\-N\-S\-E}~0xc4
\item 
\#define \hyperlink{lspmac_8c_a50e444b5ceb6d62a1be43c88c55c549c}{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-B\-U\-F\-F\-E\-R}~0xc5
\item 
\#define \hyperlink{lspmac_8c_af5e53c37c17cd06e42f7b0df211f96d8}{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-W\-R\-I\-T\-E\-B\-U\-F\-F\-E\-R}~0xc6
\item 
\#define \hyperlink{lspmac_8c_ab8367c4c9247a96c6828418d87b8623b}{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-W\-R\-I\-T\-E\-E\-R\-R\-O\-R}~0xc7
\item 
\#define \hyperlink{lspmac_8c_a15e4dbce5615c285ec1755f01057b5fe}{V\-R\-\_\-\-F\-W\-D\-O\-W\-N\-L\-O\-A\-D}~0xcb
\item 
\#define \hyperlink{lspmac_8c_a34a2e0d5c1f48ba463ae5d98431d05f7}{V\-R\-\_\-\-I\-P\-A\-D\-D\-R\-E\-S\-S}~0xe0
\item 
\#define \hyperlink{lspmac_8c_a59f5f5218e25332dbf64f216aec116e5}{P\-M\-A\-C\-\_\-\-M\-I\-N\-\_\-\-C\-M\-D\-\_\-\-T\-I\-M\-E}~20000.\-0
\begin{DoxyCompactList}\small\item\em Minimum time between commands to the pmac. \end{DoxyCompactList}\item 
\#define \hyperlink{lspmac_8c_a3fae557baafab24b7518dc84f5ef5a9b}{P\-M\-A\-C\-\_\-\-C\-M\-D\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H}~2048
\begin{DoxyCompactList}\small\item\em Size of the P\-M\-A\-C command queue. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef struct \hyperlink{structmd2StatusStruct}{md2\-Status\-Struct} \hyperlink{lspmac_8c_a3495613b8b94cadc4205f19e1254ebeb}{md2\-\_\-status\-\_\-t}
\begin{DoxyCompactList}\small\item\em The block of memory retrieved in a status request. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
double \hyperlink{lspmac_8c_a55b882be15d56a2a777f2b1f92901b7d}{lspmac\-\_\-lut} (int nlut, double $\ast$lut, double x)
\begin{DoxyCompactList}\small\item\em Look up table support for motor positions (think x=zoom, y=light intensity) use a lookup table to find the \char`\"{}counts\char`\"{} to move the motor to the requested position The look up table is a simple one dimensional array with the x values as even indicies and the y values as odd indices. \end{DoxyCompactList}\item 
double \hyperlink{lspmac_8c_a5afe5cd407b44f9c05ad4f1c4e4d5f6a}{lspmac\-\_\-rlut} (int nlut, double $\ast$lut, double y)
\item 
void \hyperlink{lspmac_8c_a1c3786f3a38724f497afc4fe6d82d8c4}{hex\-\_\-dump} (int n, unsigned char $\ast$s)
\begin{DoxyCompactList}\small\item\em Prints a hex dump of the given data. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_a8f9f1ad624350095075aa6b51423b02d}{cleanstr} (char $\ast$s)
\begin{DoxyCompactList}\small\item\em Replace \textbackslash{}r with \textbackslash{}n in null terminated string and print result to terminal. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_aae020ea2478b41702ce8b7d20b2560be}{ls\-Connect} (char $\ast$ipaddr)
\begin{DoxyCompactList}\small\item\em Connect to the P\-M\-A\-C socket. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_a99c275e32ad897dca34d196b91f038cb}{pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$ \hyperlink{lspmac_8c_a84a6096d9bfff2bfb1506a216756ae28}{lspmac\-\_\-push\-\_\-queue} (\hyperlink{pgpmac_8h_a99c275e32ad897dca34d196b91f038cb}{pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$cmd)
\begin{DoxyCompactList}\small\item\em Put a new command on the queue. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_a99c275e32ad897dca34d196b91f038cb}{pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$ \hyperlink{lspmac_8c_a9627f30135aa7007bc4ab8dde905739a}{lspmac\-\_\-pop\-\_\-queue} ()
\begin{DoxyCompactList}\small\item\em Remove the oldest queue item. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_a99c275e32ad897dca34d196b91f038cb}{pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$ \hyperlink{lspmac_8c_a0f60f18dfe11c1c0299909521596be8f}{lspmac\-\_\-pop\-\_\-reply} ()
\begin{DoxyCompactList}\small\item\em Remove the next command queue item that is waiting for a reply. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_a99c275e32ad897dca34d196b91f038cb}{pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$ \hyperlink{lspmac_8c_a1e472a11df3765763c2fe92dd358bf0c}{lspmac\-\_\-send\-\_\-command} (int rq\-Type, int rq, int w\-Value, int w\-Index, int w\-Length, unsigned char $\ast$data, void($\ast$response\-C\-B)(\hyperlink{pgpmac_8h_a99c275e32ad897dca34d196b91f038cb}{pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$, int, unsigned char $\ast$), int no\-\_\-reply)
\begin{DoxyCompactList}\small\item\em Compose a packet and send it to the P\-M\-A\-C. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_ac5745f25f242edf02f7b9b7c77ed6126}{lspmac\-\_\-\-Sock\-Flush} ()
\begin{DoxyCompactList}\small\item\em Reset the P\-M\-A\-C socket from the P\-M\-A\-C side. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_aaedae34bc18ac1742a232117c125d7b9}{lspmac\-\_\-\-Reset} ()
\begin{DoxyCompactList}\small\item\em Clear the queue and put the P\-M\-A\-C into a known state. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_a2442c529b024e9c23c4acef8c1eb8689}{lspmac\-\_\-\-Error} (unsigned char $\ast$buff)
\begin{DoxyCompactList}\small\item\em The service routing detected an error condition. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_af3fa79868ba88f7c37f7b8f7d53149ff}{lspmac\-\_\-\-Service} (struct pollfd $\ast$evt)
\begin{DoxyCompactList}\small\item\em Service routine for packet coming from the P\-M\-A\-C. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_ac89b615b3ecb738c902c3c090d7c1dc3}{lspmac\-\_\-\-Get\-Short\-Reply\-C\-B} (\hyperlink{pgpmac_8h_a99c275e32ad897dca34d196b91f038cb}{pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$cmd, int nreceived, unsigned char $\ast$buff)
\begin{DoxyCompactList}\small\item\em Receive a reply that does not require multiple buffers. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_ac23af52b8d3a8f2722d4804d5340fa6c}{lspmac\-\_\-\-Send\-Control\-Reply\-Print\-C\-B} (\hyperlink{pgpmac_8h_a99c275e32ad897dca34d196b91f038cb}{pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$cmd, int nreceived, unsigned char $\ast$buff)
\begin{DoxyCompactList}\small\item\em Receive a reply to a control character Print a \char`\"{}printable\char`\"{} version of the character to the terminal Followed by a hex dump of the response. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_aaa3323f952efd66e63ff864932da5ced}{lspmac\-\_\-\-Getmem\-Reply\-C\-B} (\hyperlink{pgpmac_8h_a99c275e32ad897dca34d196b91f038cb}{pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$cmd, int nreceived, unsigned char $\ast$buff)
\begin{DoxyCompactList}\small\item\em Service a reply to the getmem command. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_a99c275e32ad897dca34d196b91f038cb}{pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$ \hyperlink{lspmac_8c_a0a56c777b1469ad8c3d29d825a71e300}{lspmac\-\_\-\-Sock\-Getmem} (int offset, int nbytes)
\begin{DoxyCompactList}\small\item\em Request a chunk of memory to be returned. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_a99c275e32ad897dca34d196b91f038cb}{pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$ \hyperlink{lspmac_8c_aaa442d9bc7a3cdee39adea0724f0e18c}{lspmac\-\_\-\-Sock\-Sendline} (char $\ast$fmt,...)
\begin{DoxyCompactList}\small\item\em Send a one line command. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_a99c275e32ad897dca34d196b91f038cb}{pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$ \hyperlink{lspmac_8c_ac4cf3a79186859714d8a8293377526ba}{lspmac\-\_\-\-Sock\-Sendline\-\_\-nr} (char $\ast$fmt,...)
\begin{DoxyCompactList}\small\item\em Send a command and ignore the response. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_a99c275e32ad897dca34d196b91f038cb}{pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$ \hyperlink{lspmac_8c_a53ee9ff1a8ca316901babf8314b423de}{lspmac\-\_\-\-Sock\-Send\-Control\-Char\-Print} (char c)
\begin{DoxyCompactList}\small\item\em Send a control character. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_a825ba2feb0108b977c34872e24a6c827}{lspmac\-\_\-\-Getmem} ()
\begin{DoxyCompactList}\small\item\em Request a block of double buffer memory. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_a5945488310a5a8f616e6605782c7f1c9}{lspmac\-\_\-bio\-\_\-read} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$mp)
\begin{DoxyCompactList}\small\item\em Read the state of a binary i/o motor This is the read method for the binary i/o motor class. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_a200bc9306d54fca566eb5e29d8e82308}{lspmac\-\_\-dac\-\_\-read} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$mp)
\begin{DoxyCompactList}\small\item\em Read a D\-A\-C motor position. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_ab81f07dea6bb0e88103a05a380de1034}{lspmac\-\_\-shutter\-\_\-read} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$mp)
\begin{DoxyCompactList}\small\item\em Fast shutter read routine The shutter is mildly complicated in that we need to take into account the fact that the shutter can open and close again between status updates. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_a9fbadf816a842c8f131cf8ee47b54e29}{lspmac\-\_\-home1\-\_\-queue} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$mp)
\begin{DoxyCompactList}\small\item\em Homing method for steppers and servos. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_a43e54631dc8de372854ebbb63ff28f70}{lspmac\-\_\-home2\-\_\-queue} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$mp)
\begin{DoxyCompactList}\small\item\em Second stage of homing. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_a637fc023d1255f3519b2eee01913d64d}{lspmac\-\_\-pmacmotor\-\_\-read} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$mp)
\begin{DoxyCompactList}\small\item\em Read the position and status of a normal P\-M\-A\-C motor. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_ad060fd55c9e2411fd4fd4e946aff23c6}{lspmac\-\_\-get\-\_\-status\-\_\-cb} (\hyperlink{pgpmac_8h_a99c275e32ad897dca34d196b91f038cb}{pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$cmd, int nreceived, unsigned char $\ast$buff)
\begin{DoxyCompactList}\small\item\em Service routing for status upate This updates positions and status information. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_a6dedca923b3a6904395ad02158e2e96f}{lspmac\-\_\-get\-\_\-status} ()
\begin{DoxyCompactList}\small\item\em Request a status update from the P\-M\-A\-C. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_add86d60f9d192563fc9a357dc90f7f75}{lspmac\-\_\-\-Get\-All\-I\-Vars\-C\-B} (\hyperlink{pgpmac_8h_a99c275e32ad897dca34d196b91f038cb}{pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$cmd, int nreceived, unsigned char $\ast$buff)
\begin{DoxyCompactList}\small\item\em Receive the values of all the I variables Update our Postgresql database with the results. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_ac24bdffa893a9bf7c9cb084fe1417f6f}{lspmac\-\_\-\-Get\-All\-I\-Vars} ()
\begin{DoxyCompactList}\small\item\em Request the values of all the I variables. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_ac585cd63a433c86843eb51b15017c3da}{lspmac\-\_\-\-Get\-All\-M\-Vars\-C\-B} (\hyperlink{pgpmac_8h_a99c275e32ad897dca34d196b91f038cb}{pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$cmd, int nreceived, unsigned char $\ast$buff)
\begin{DoxyCompactList}\small\item\em Receive the values of all the M variables Update our database with the results. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_a983d291506dc387ba5d71a97766e8a25}{lspmac\-\_\-\-Get\-All\-M\-Vars} ()
\begin{DoxyCompactList}\small\item\em Request the values of all the M variables. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_aa9bbf5ae34ce793d3d72945c64c43948}{lspmac\-\_\-sendcmd\-\_\-nocb} (char $\ast$fmt,...)
\begin{DoxyCompactList}\small\item\em Send a command that does not need to deal with the reply. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_abc3ef9890ab5c4e00d14ccd0d360fb05}{lspmac\-\_\-sendcmd} (void($\ast$response\-C\-B)(\hyperlink{pgpmac_8h_a99c275e32ad897dca34d196b91f038cb}{pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$, int, unsigned char $\ast$), char $\ast$fmt,...)
\begin{DoxyCompactList}\small\item\em P\-M\-A\-C command with call back. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_a68886d1b658e7b1d996c07e9dbcd9c15}{lspmac\-\_\-next\-\_\-state} ()
\begin{DoxyCompactList}\small\item\em State machine logic. \end{DoxyCompactList}\item 
void $\ast$ \hyperlink{lspmac_8c_abdec5883055967b1eda043670870f55f}{lspmac\-\_\-worker} (void $\ast$dummy)
\begin{DoxyCompactList}\small\item\em Our lspmac worker thread. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_a7d601716497857c2b5c072c1aed37b71}{lspmac\-\_\-movedac\-\_\-queue} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$mp, double requested\-\_\-position)
\begin{DoxyCompactList}\small\item\em Move method for dac motor objects (ie, lights) \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_ad6ae1e37afd118f24ab1c6878da53878}{lspmac\-\_\-movezoom\-\_\-queue} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$mp, double requested\-\_\-position)
\begin{DoxyCompactList}\small\item\em Move method for the zoom motor. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_ab9f114bba58e685760a518bd5f115d74}{lspmac\-\_\-moveabs\-\_\-fshut\-\_\-queue} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$mp, double requested\-\_\-position)
\begin{DoxyCompactList}\small\item\em Move method for the fast shutter. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_ad1167f01262cf6387e7e82a14d3e1a9d}{lspmac\-\_\-moveabs\-\_\-bio\-\_\-queue} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$mp, double requested\-\_\-position)
\begin{DoxyCompactList}\small\item\em Move method for binary i/o motor objects. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_aa4ea5a4c387ef167702c58eaddcb4151}{lspmac\-\_\-moveabs\-\_\-queue} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$mp, double requested\-\_\-position)
\begin{DoxyCompactList}\small\item\em Move method for normal stepper and servo motor objects. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_aae2282edace621ee65c682d03b7ccc36}{lspmac\-\_\-moveabs\-\_\-wait} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$mp)
\begin{DoxyCompactList}\small\item\em Wait for motor to finish moving. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_a45becc46f46e5aea14a388d3ec1b8b13}{lspmac\-\_\-motor\-\_\-init} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$d, int motor\-\_\-number, int wy, int wx, int $\ast$posp, int $\ast$stat1p, int $\ast$stat2p, char $\ast$wtitle, char $\ast$name, void($\ast$move\-Abs)(\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$, double))
\begin{DoxyCompactList}\small\item\em Initialize a pmac stepper or servo motor. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_a40aa4aeb5c799a6a3a089137da4fd6a8}{lspmac\-\_\-fshut\-\_\-init} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$d)
\begin{DoxyCompactList}\small\item\em Initalize the fast shutter motor. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_a50e22adfb4d14499c1f5647458ca2ad9}{lspmac\-\_\-bio\-\_\-init} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$d, char $\ast$name, char $\ast$write\-\_\-fmt, int $\ast$read\-\_\-ptr, int read\-\_\-mask)
\begin{DoxyCompactList}\small\item\em Initialize binary i/o motor. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_a6d88f6db90e4a7219a237b183d10a27d}{lspmac\-\_\-dac\-\_\-init} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$d, int $\ast$posp, double scale, char $\ast$mvar, char $\ast$name)
\begin{DoxyCompactList}\small\item\em Initialize D\-A\-C motor Note that some motors require further initialization from a database query. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_a236945579e57dbb30c0b64f5b9184e9d}{lspmac\-\_\-init} (int ivarsflag, int mvarsflag)
\begin{DoxyCompactList}\small\item\em Initialize this module. \end{DoxyCompactList}\item 
void \hyperlink{lspmac_8c_a3a7fb93fb3fb9c4454613f30bfb0b1ee}{lspmac\-\_\-run} ()
\begin{DoxyCompactList}\small\item\em Start up the lspmac thread. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static int \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\-\_\-pmac\-\_\-state} = \hyperlink{lspmac_8c_a7eb86ecf0789ab9555de1e03a4c73567}{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-D\-E\-T\-A\-C\-H\-E\-D}
\begin{DoxyCompactList}\small\item\em Current state of the P\-M\-A\-C communications state machine. \end{DoxyCompactList}\item 
int \hyperlink{lspmac_8c_a112158e0cd50449a440ac55c7af7bea2}{lspmac\-\_\-shutter\-\_\-state}
\begin{DoxyCompactList}\small\item\em State of the shutter, used to detect changes. \end{DoxyCompactList}\item 
int \hyperlink{lspmac_8c_a396fbf06208de3ecbe1b0df549f1cd46}{lspmac\-\_\-shutter\-\_\-has\-\_\-opened}
\begin{DoxyCompactList}\small\item\em Indicates that the shutter had opened, perhaps briefly even if the state did not change. \end{DoxyCompactList}\item 
pthread\-\_\-mutex\-\_\-t \hyperlink{lspmac_8c_a1b78a13c654409333569815e1c109d38}{lspmac\-\_\-shutter\-\_\-mutex}
\begin{DoxyCompactList}\small\item\em Coordinates threads reading shutter status. \end{DoxyCompactList}\item 
pthread\-\_\-cond\-\_\-t \hyperlink{lspmac_8c_afbd51c2cefcee87afe994c9e9f372241}{lspmac\-\_\-shutter\-\_\-cond}
\begin{DoxyCompactList}\small\item\em Allows waiting for the shutter status to change. \end{DoxyCompactList}\item 
pthread\-\_\-mutex\-\_\-t \hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\-\_\-moving\-\_\-mutex}
\begin{DoxyCompactList}\small\item\em Coordinate moving motors between threads. \end{DoxyCompactList}\item 
pthread\-\_\-cond\-\_\-t \hyperlink{lspmac_8c_a57547d211906c981ef20257eba99f8df}{lspmac\-\_\-moving\-\_\-cond}
\begin{DoxyCompactList}\small\item\em Wait for motor(s) to finish moving condition. \end{DoxyCompactList}\item 
int \hyperlink{lspmac_8c_a7a32c617c183166308241e270959df56}{lspmac\-\_\-moving\-\_\-flags}
\begin{DoxyCompactList}\small\item\em Flag used to implement motor moving condition. \end{DoxyCompactList}\item 
static pthread\-\_\-t \hyperlink{lspmac_8c_a6b7011dd7d2c2d3afadff8d3e50e7677}{pmac\-\_\-thread}
\begin{DoxyCompactList}\small\item\em our thread to manage access and communication to the pmac \end{DoxyCompactList}\item 
static pthread\-\_\-mutex\-\_\-t \hyperlink{lspmac_8c_acc1bb77b9bcbc4d970f841a41fd274b3}{pmac\-\_\-queue\-\_\-mutex}
\begin{DoxyCompactList}\small\item\em manage access to the pmac command queue \end{DoxyCompactList}\item 
static pthread\-\_\-cond\-\_\-t \hyperlink{lspmac_8c_a8a25bd9c593c6985107f90f999ce0b08}{pmac\-\_\-queue\-\_\-cond}
\begin{DoxyCompactList}\small\item\em wait for a command to be sent to P\-M\-A\-C before continuing \end{DoxyCompactList}\item 
static struct pollfd \hyperlink{lspmac_8c_adba7f5f4bbeabc4dac859221d4c684ba}{pmacfd}
\begin{DoxyCompactList}\small\item\em our poll structure \end{DoxyCompactList}\item 
static int \hyperlink{lspmac_8c_a07b7b8254772075e6a4ced500b589c36}{getivars} = 0
\begin{DoxyCompactList}\small\item\em flag set at initialization to send i vars to db \end{DoxyCompactList}\item 
static int \hyperlink{lspmac_8c_a50e9c0a06654fd81b3446a6e54ff12c3}{getmvars} = 0
\begin{DoxyCompactList}\small\item\em flag set at initialization to send m vars to db \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} \hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\-\_\-motors} \mbox{[}32\mbox{]}
\begin{DoxyCompactList}\small\item\em All our motors. \end{DoxyCompactList}\item 
int \hyperlink{lspmac_8c_a56260f012c50a591ee7f97e500f16994}{lspmac\-\_\-nmotors} = 0
\begin{DoxyCompactList}\small\item\em The number of motors we manage. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_a8237e646ce032a840637a4ef7bff49b9}{omega}
\begin{DoxyCompactList}\small\item\em M\-D2 omega axis (the air bearing) \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_a6cb218bdccfe5a93471c161f15a15cab}{alignx}
\begin{DoxyCompactList}\small\item\em Alignment stage X. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_a737c246c3948e644a18d191a931e1acd}{aligny}
\begin{DoxyCompactList}\small\item\em Alignment stage Y. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_ae7642b1da0f7c7f8448104c691d40a12}{alignz}
\begin{DoxyCompactList}\small\item\em Alignment stage X. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_aa90d2363b744acbd4d45133b7a716d8f}{anal}
\begin{DoxyCompactList}\small\item\em Polaroid analyzer motor. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_ad53a42cfaa04eff0336a44c8c9986333}{zoom}
\begin{DoxyCompactList}\small\item\em Optical zoom. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_a139200ddaa9856a7ffcec0e6cbaa8f1b}{apery}
\begin{DoxyCompactList}\small\item\em Aperture Y. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_ab93bd6ee850b285ca3a95e64d15e9477}{aperz}
\begin{DoxyCompactList}\small\item\em Aperture Z. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_a51358daaea8b5236f08414877d8af6c2}{capy}
\begin{DoxyCompactList}\small\item\em Capillary Y. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_aa45f268d0af9f3d465acfab128919718}{capz}
\begin{DoxyCompactList}\small\item\em Capillary Z. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_ac0eeaffa0996271d8a38344a470d13d7}{scinz}
\begin{DoxyCompactList}\small\item\em Scintillator Z. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_ac940d950d9efeaf3f0ae67e9bf331188}{cenx}
\begin{DoxyCompactList}\small\item\em Centering Table X. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_aaed18e738ba7bfb6c771a44f5d7ea827}{ceny}
\begin{DoxyCompactList}\small\item\em Centering Table Y. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_a0be79ccb7ebf3a665248fd856112b9fd}{kappa}
\begin{DoxyCompactList}\small\item\em Kappa. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_ac8070dc568ad974a3db42b51eca828cc}{phi}
\begin{DoxyCompactList}\small\item\em Phi (not data collection axis) \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_a26dec4623af9beed912b8e7e6f99822c}{fshut}
\begin{DoxyCompactList}\small\item\em Fast shutter. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_aeb09895663eff333b7a75acb319a9fc1}{flight}
\begin{DoxyCompactList}\small\item\em Front Light D\-A\-C. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_a85d6eaa4b4a82bb3112574f458d1dc50}{blight}
\begin{DoxyCompactList}\small\item\em Back Light D\-A\-C. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_a8a3ca6fcf5e24dcc26170736843e53b2}{fscint}
\begin{DoxyCompactList}\small\item\em Scintillator Piezo D\-A\-C. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_af813a2eff0b7efa4c70633559054e84c}{blight\-\_\-ud}
\begin{DoxyCompactList}\small\item\em Back Light Up/\-Down actuator. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_ae78d9a757d4c85419fff9c94b15e25d7}{cryo}
\begin{DoxyCompactList}\small\item\em Move the cryostream towards or away from the crystal. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{lspmac_8c_a9d9c5030d817483ca9518027c91adac4}{dryer}
\begin{DoxyCompactList}\small\item\em blow air on the scintilator to dry it off \end{DoxyCompactList}\item 
static int \hyperlink{lspmac_8c_a1de136a293a8e4bd306e692218a81587}{lines\-Received} =0
\begin{DoxyCompactList}\small\item\em current number of lines received \end{DoxyCompactList}\item 
static unsigned char \hyperlink{lspmac_8c_a9da2795d11ccbc3a060c4811770ad04c}{dbmem} \mbox{[}64 $\ast$1024\mbox{]}
\begin{DoxyCompactList}\small\item\em double buffered memory \end{DoxyCompactList}\item 
static int \hyperlink{lspmac_8c_aa0be2f26364c4d12c9c81c10913f0b26}{dbmem\-In} = 0
\begin{DoxyCompactList}\small\item\em next location \end{DoxyCompactList}\item 
static struct timeval \\*
pmac\-\_\-time\-\_\-sent \hyperlink{lspmac_8c_a4bed9053319d1d2cad5cc03d0549e17f}{now}
\begin{DoxyCompactList}\small\item\em used to ensure we do not send commands to the pmac too often. Only needed for non-\/\-D\-B commands. \end{DoxyCompactList}\item 
static \hyperlink{pgpmac_8h_a2d163436571135a457f4a4e2fbd09633}{pmac\-\_\-cmd\-\_\-t} \hyperlink{lspmac_8c_a6fcbbe47fe9912533962601f5befdb29}{rr\-\_\-cmd}
\item 
static \hyperlink{pgpmac_8h_a2d163436571135a457f4a4e2fbd09633}{pmac\-\_\-cmd\-\_\-t} \hyperlink{lspmac_8c_ae7b21213b9c78b6745213409f1ef7320}{gb\-\_\-cmd}
\item 
static \hyperlink{pgpmac_8h_a2d163436571135a457f4a4e2fbd09633}{pmac\-\_\-cmd\-\_\-t} \hyperlink{lspmac_8c_a8908812f4ff25c196679e00d330edd81}{cr\-\_\-cmd}
\begin{DoxyCompactList}\small\item\em commands to send out \char`\"{}readready\char`\"{}, \char`\"{}getbuffer\char`\"{}, controlresponse (initialized in main) \end{DoxyCompactList}\item 
static \hyperlink{pgpmac_8h_a99c275e32ad897dca34d196b91f038cb}{pmac\-\_\-cmd\-\_\-queue\-\_\-t} \hyperlink{lspmac_8c_a69e569a833fe7f202b92e860d1548f2b}{eth\-Cmd\-Queue} \mbox{[}\hyperlink{lspmac_8c_a3fae557baafab24b7518dc84f5ef5a9b}{P\-M\-A\-C\-\_\-\-C\-M\-D\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H}\mbox{]}
\begin{DoxyCompactList}\small\item\em P\-M\-A\-C command queue. \end{DoxyCompactList}\item 
static unsigned int \hyperlink{lspmac_8c_ad62b1f9e907acc3de9f3d6a05d55829e}{eth\-Cmd\-On} = 0
\begin{DoxyCompactList}\small\item\em points to next empty P\-M\-A\-C command queue position \end{DoxyCompactList}\item 
static unsigned int \hyperlink{lspmac_8c_ae85caec6f4ddb2fc52ca14a26549ab08}{eth\-Cmd\-Off} = 0
\begin{DoxyCompactList}\small\item\em points to current command (or none if == eth\-Cmd\-On) \end{DoxyCompactList}\item 
static unsigned int \hyperlink{lspmac_8c_a7a78524ada402bb74759a3dfc5f8a571}{eth\-Cmd\-Reply} = 0
\begin{DoxyCompactList}\small\item\em Used like eth\-Cmd\-Off only to deal with the pmac reply to a command. \end{DoxyCompactList}\item 
static char $\ast$ \hyperlink{lspmac_8c_aab5a76f1ac64049314f9836e5c01fb7e}{pmac\-\_\-error\-\_\-strs} \mbox{[}$\,$\mbox{]}
\begin{DoxyCompactList}\small\item\em Decode the errors perhaps returned by the P\-M\-A\-C. \end{DoxyCompactList}\item 
static \hyperlink{lspmac_8c_a3495613b8b94cadc4205f19e1254ebeb}{md2\-\_\-status\-\_\-t} \hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\-\_\-status}
\begin{DoxyCompactList}\small\item\em Buffer for M\-D2 Status. \end{DoxyCompactList}\item 
pthread\-\_\-mutex\-\_\-t \hyperlink{lspmac_8c_a7a3e763682bd7f987d07f149e94b3bf8}{md2\-\_\-status\-\_\-mutex}
\begin{DoxyCompactList}\small\item\em Synchronize reading/writting status buffer. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Routines concerned with communication with P\-M\-A\-C. \begin{DoxyVerb}\date 2012
\author Keith Brister
\copyright All Rights Reserved
\end{DoxyVerb}


This is a state machine (surprise!) Lacking is support for writingbuffer, control writing and reading, as well as double buffered memory It looks like several different methods of managing P\-M\-A\-C communications are possible. Here is set up a queue of outgoing commands and deal completely with the result before sending the next. A full handshake of acknowledgements and \char`\"{}readready\char`\"{} is expected.

\begin{TabularC}{2}
\hline
\rowcolor{lightgray}{\bf State }&{\bf Description  }\\\cline{1-2}
-\/1 &Reset the connection  \\\cline{1-2}
0 &Detached\-: need to connect to tcp port  \\\cline{1-2}
1 &Idle (waiting for a command to send to the pmac)  \\\cline{1-2}
2 &Send command  \\\cline{1-2}
3 &Waiting for command acknowledgement (no further response expected)  \\\cline{1-2}
4 &Waiting for control character acknowledgement (further response expected)  \\\cline{1-2}
5 &Waiting for command acknowledgement (further response expected)  \\\cline{1-2}
6 &Waiting for get memory response  \\\cline{1-2}
7 &Send controlresponse  \\\cline{1-2}
8 &Send readready  \\\cline{1-2}
9 &Waiting for acknowledgement of \char`\"{}readready\char`\"{}  \\\cline{1-2}
10 &Send readbuffer  \\\cline{1-2}
11 &Waiting for control response  \\\cline{1-2}
12 &Waiting for readbuffer response 

\\\cline{1-2}
\end{TabularC}


Definition in file \hyperlink{lspmac_8c_source}{lspmac.\-c}.



\subsection{Macro Definition Documentation}
\hypertarget{lspmac_8c_abbd709b56a71eb1fc6adc9063605d243}{\index{lspmac.\-c@{lspmac.\-c}!L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-C\-R@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-C\-R}}
\index{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-C\-R@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-C\-R}!lspmac.c@{lspmac.\-c}}
\subsubsection[{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-C\-R}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-C\-R~7}}\label{lspmac_8c_abbd709b56a71eb1fc6adc9063605d243}


Definition at line 45 of file lspmac.\-c.

\hypertarget{lspmac_8c_a7eb86ecf0789ab9555de1e03a4c73567}{\index{lspmac.\-c@{lspmac.\-c}!L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-D\-E\-T\-A\-C\-H\-E\-D@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-D\-E\-T\-A\-C\-H\-E\-D}}
\index{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-D\-E\-T\-A\-C\-H\-E\-D@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-D\-E\-T\-A\-C\-H\-E\-D}!lspmac.c@{lspmac.\-c}}
\subsubsection[{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-D\-E\-T\-A\-C\-H\-E\-D}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-D\-E\-T\-A\-C\-H\-E\-D~0}}\label{lspmac_8c_a7eb86ecf0789ab9555de1e03a4c73567}


Definition at line 38 of file lspmac.\-c.

\hypertarget{lspmac_8c_a5f4ff8874677aac48a4c675f2c1ca4e9}{\index{lspmac.\-c@{lspmac.\-c}!L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-G\-B@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-G\-B}}
\index{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-G\-B@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-G\-B}!lspmac.c@{lspmac.\-c}}
\subsubsection[{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-G\-B}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-G\-B~10}}\label{lspmac_8c_a5f4ff8874677aac48a4c675f2c1ca4e9}


Definition at line 48 of file lspmac.\-c.

\hypertarget{lspmac_8c_a220b39710719cfe8b500d51819e8efeb}{\index{lspmac.\-c@{lspmac.\-c}!L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-G\-M\-R@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-G\-M\-R}}
\index{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-G\-M\-R@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-G\-M\-R}!lspmac.c@{lspmac.\-c}}
\subsubsection[{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-G\-M\-R}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-G\-M\-R~6}}\label{lspmac_8c_a220b39710719cfe8b500d51819e8efeb}


Definition at line 44 of file lspmac.\-c.

\hypertarget{lspmac_8c_a37741af675425d61c876cc30ae6c99d0}{\index{lspmac.\-c@{lspmac.\-c}!L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-D\-L\-E@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-D\-L\-E}}
\index{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-D\-L\-E@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-D\-L\-E}!lspmac.c@{lspmac.\-c}}
\subsubsection[{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-D\-L\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-I\-D\-L\-E~1}}\label{lspmac_8c_a37741af675425d61c876cc30ae6c99d0}


Definition at line 39 of file lspmac.\-c.

\hypertarget{lspmac_8c_a7e1c68021b3dbb53ba1bac2afbd8fc20}{\index{lspmac.\-c@{lspmac.\-c}!L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-S\-E\-T@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-S\-E\-T}}
\index{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-S\-E\-T@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-S\-E\-T}!lspmac.c@{lspmac.\-c}}
\subsubsection[{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-S\-E\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-S\-E\-T~-\/1}}\label{lspmac_8c_a7e1c68021b3dbb53ba1bac2afbd8fc20}


Definition at line 37 of file lspmac.\-c.

\hypertarget{lspmac_8c_add5325f4a84e4fe05f558880349485ea}{\index{lspmac.\-c@{lspmac.\-c}!L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-R@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-R}}
\index{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-R@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-R}!lspmac.c@{lspmac.\-c}}
\subsubsection[{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-R}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-R~8}}\label{lspmac_8c_add5325f4a84e4fe05f558880349485ea}


Definition at line 46 of file lspmac.\-c.

\hypertarget{lspmac_8c_a7d8f34fc599cc08c1a9d2cd62ccbb20a}{\index{lspmac.\-c@{lspmac.\-c}!L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-S\-C@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-S\-C}}
\index{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-S\-C@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-S\-C}!lspmac.c@{lspmac.\-c}}
\subsubsection[{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-S\-C}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-S\-C~2}}\label{lspmac_8c_a7d8f34fc599cc08c1a9d2cd62ccbb20a}


Definition at line 40 of file lspmac.\-c.

\hypertarget{lspmac_8c_a5eba9ef09d4316e803b9d75bd3104f43}{\index{lspmac.\-c@{lspmac.\-c}!L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K}}
\index{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K}!lspmac.c@{lspmac.\-c}}
\subsubsection[{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K~5}}\label{lspmac_8c_a5eba9ef09d4316e803b9d75bd3104f43}


Definition at line 43 of file lspmac.\-c.

\hypertarget{lspmac_8c_adef540911028fda73e8bbf0aa6ad39e9}{\index{lspmac.\-c@{lspmac.\-c}!L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K\-\_\-\-C\-C@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K\-\_\-\-C\-C}}
\index{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K\-\_\-\-C\-C@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K\-\_\-\-C\-C}!lspmac.c@{lspmac.\-c}}
\subsubsection[{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K\-\_\-\-C\-C}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K\-\_\-\-C\-C~4}}\label{lspmac_8c_adef540911028fda73e8bbf0aa6ad39e9}


Definition at line 42 of file lspmac.\-c.

\hypertarget{lspmac_8c_a63356b0c18fcb186f456c12c6e927d84}{\index{lspmac.\-c@{lspmac.\-c}!L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K\-\_\-\-N\-F\-R@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K\-\_\-\-N\-F\-R}}
\index{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K\-\_\-\-N\-F\-R@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K\-\_\-\-N\-F\-R}!lspmac.c@{lspmac.\-c}}
\subsubsection[{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K\-\_\-\-N\-F\-R}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K\-\_\-\-N\-F\-R~3}}\label{lspmac_8c_a63356b0c18fcb186f456c12c6e927d84}


Definition at line 41 of file lspmac.\-c.

\hypertarget{lspmac_8c_a3e0a62cd9a1212419ad3615c34bdc65a}{\index{lspmac.\-c@{lspmac.\-c}!L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K\-\_\-\-R\-R@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K\-\_\-\-R\-R}}
\index{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K\-\_\-\-R\-R@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K\-\_\-\-R\-R}!lspmac.c@{lspmac.\-c}}
\subsubsection[{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K\-\_\-\-R\-R}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-C\-K\-\_\-\-R\-R~9}}\label{lspmac_8c_a3e0a62cd9a1212419ad3615c34bdc65a}


Definition at line 47 of file lspmac.\-c.

\hypertarget{lspmac_8c_a27ee6c39d58604c8aa9bd6c249c4833f}{\index{lspmac.\-c@{lspmac.\-c}!L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-C\-R@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-C\-R}}
\index{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-C\-R@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-C\-R}!lspmac.c@{lspmac.\-c}}
\subsubsection[{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-C\-R}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-C\-R~11}}\label{lspmac_8c_a27ee6c39d58604c8aa9bd6c249c4833f}


Definition at line 49 of file lspmac.\-c.

\hypertarget{lspmac_8c_a591822cc92f76a39b293c2e90b322db2}{\index{lspmac.\-c@{lspmac.\-c}!L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-G\-B@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-G\-B}}
\index{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-G\-B@{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-G\-B}!lspmac.c@{lspmac.\-c}}
\subsubsection[{L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-G\-B}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-G\-B~12}}\label{lspmac_8c_a591822cc92f76a39b293c2e90b322db2}


Definition at line 50 of file lspmac.\-c.

\hypertarget{lspmac_8c_a3fae557baafab24b7518dc84f5ef5a9b}{\index{lspmac.\-c@{lspmac.\-c}!P\-M\-A\-C\-\_\-\-C\-M\-D\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H@{P\-M\-A\-C\-\_\-\-C\-M\-D\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H}}
\index{P\-M\-A\-C\-\_\-\-C\-M\-D\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H@{P\-M\-A\-C\-\_\-\-C\-M\-D\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H}!lspmac.c@{lspmac.\-c}}
\subsubsection[{P\-M\-A\-C\-\_\-\-C\-M\-D\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-M\-A\-C\-\_\-\-C\-M\-D\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H~2048}}\label{lspmac_8c_a3fae557baafab24b7518dc84f5ef5a9b}


Size of the P\-M\-A\-C command queue. 



Definition at line 139 of file lspmac.\-c.

\hypertarget{lspmac_8c_abdc45e3f7106f84f688419e2da9b3627}{\index{lspmac.\-c@{lspmac.\-c}!pmac\-\_\-cmd\-\_\-size@{pmac\-\_\-cmd\-\_\-size}}
\index{pmac\-\_\-cmd\-\_\-size@{pmac\-\_\-cmd\-\_\-size}!lspmac.c@{lspmac.\-c}}
\subsubsection[{pmac\-\_\-cmd\-\_\-size}]{\setlength{\rightskip}{0pt plus 5cm}\#define pmac\-\_\-cmd\-\_\-size~8}}\label{lspmac_8c_abdc45e3f7106f84f688419e2da9b3627}


P\-M\-A\-C command size in bytes. 



Definition at line 105 of file lspmac.\-c.

\hypertarget{lspmac_8c_a59f5f5218e25332dbf64f216aec116e5}{\index{lspmac.\-c@{lspmac.\-c}!P\-M\-A\-C\-\_\-\-M\-I\-N\-\_\-\-C\-M\-D\-\_\-\-T\-I\-M\-E@{P\-M\-A\-C\-\_\-\-M\-I\-N\-\_\-\-C\-M\-D\-\_\-\-T\-I\-M\-E}}
\index{P\-M\-A\-C\-\_\-\-M\-I\-N\-\_\-\-C\-M\-D\-\_\-\-T\-I\-M\-E@{P\-M\-A\-C\-\_\-\-M\-I\-N\-\_\-\-C\-M\-D\-\_\-\-T\-I\-M\-E}!lspmac.c@{lspmac.\-c}}
\subsubsection[{P\-M\-A\-C\-\_\-\-M\-I\-N\-\_\-\-C\-M\-D\-\_\-\-T\-I\-M\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-M\-A\-C\-\_\-\-M\-I\-N\-\_\-\-C\-M\-D\-\_\-\-T\-I\-M\-E~20000.\-0}}\label{lspmac_8c_a59f5f5218e25332dbf64f216aec116e5}


Minimum time between commands to the pmac. 



Definition at line 135 of file lspmac.\-c.

\hypertarget{lspmac_8c_ac95886e84843b6b0bb6cc270e42043c4}{\index{lspmac.\-c@{lspmac.\-c}!P\-M\-A\-C\-P\-O\-R\-T@{P\-M\-A\-C\-P\-O\-R\-T}}
\index{P\-M\-A\-C\-P\-O\-R\-T@{P\-M\-A\-C\-P\-O\-R\-T}!lspmac.c@{lspmac.\-c}}
\subsubsection[{P\-M\-A\-C\-P\-O\-R\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-M\-A\-C\-P\-O\-R\-T~1025}}\label{lspmac_8c_ac95886e84843b6b0bb6cc270e42043c4}


The P\-M\-A\-C (only) listens on this port. 



Definition at line 99 of file lspmac.\-c.

\hypertarget{lspmac_8c_a8f4ce4666a23a3fb153d680bd1cb6556}{\index{lspmac.\-c@{lspmac.\-c}!V\-R\-\_\-\-C\-T\-R\-L\-\_\-\-R\-E\-S\-P\-O\-N\-S\-E@{V\-R\-\_\-\-C\-T\-R\-L\-\_\-\-R\-E\-S\-P\-O\-N\-S\-E}}
\index{V\-R\-\_\-\-C\-T\-R\-L\-\_\-\-R\-E\-S\-P\-O\-N\-S\-E@{V\-R\-\_\-\-C\-T\-R\-L\-\_\-\-R\-E\-S\-P\-O\-N\-S\-E}!lspmac.c@{lspmac.\-c}}
\subsubsection[{V\-R\-\_\-\-C\-T\-R\-L\-\_\-\-R\-E\-S\-P\-O\-N\-S\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\-R\-\_\-\-C\-T\-R\-L\-\_\-\-R\-E\-S\-P\-O\-N\-S\-E~0xc4}}\label{lspmac_8c_a8f4ce4666a23a3fb153d680bd1cb6556}


Definition at line 121 of file lspmac.\-c.

\hypertarget{lspmac_8c_af24ecdc10723dc8fd6320fef416ae514}{\index{lspmac.\-c@{lspmac.\-c}!V\-R\-\_\-\-D\-O\-W\-N\-L\-O\-A\-D@{V\-R\-\_\-\-D\-O\-W\-N\-L\-O\-A\-D}}
\index{V\-R\-\_\-\-D\-O\-W\-N\-L\-O\-A\-D@{V\-R\-\_\-\-D\-O\-W\-N\-L\-O\-A\-D}!lspmac.c@{lspmac.\-c}}
\subsubsection[{V\-R\-\_\-\-D\-O\-W\-N\-L\-O\-A\-D}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\-R\-\_\-\-D\-O\-W\-N\-L\-O\-A\-D~0x40}}\label{lspmac_8c_af24ecdc10723dc8fd6320fef416ae514}


Definition at line 108 of file lspmac.\-c.

\hypertarget{lspmac_8c_a15e4dbce5615c285ec1755f01057b5fe}{\index{lspmac.\-c@{lspmac.\-c}!V\-R\-\_\-\-F\-W\-D\-O\-W\-N\-L\-O\-A\-D@{V\-R\-\_\-\-F\-W\-D\-O\-W\-N\-L\-O\-A\-D}}
\index{V\-R\-\_\-\-F\-W\-D\-O\-W\-N\-L\-O\-A\-D@{V\-R\-\_\-\-F\-W\-D\-O\-W\-N\-L\-O\-A\-D}!lspmac.c@{lspmac.\-c}}
\subsubsection[{V\-R\-\_\-\-F\-W\-D\-O\-W\-N\-L\-O\-A\-D}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\-R\-\_\-\-F\-W\-D\-O\-W\-N\-L\-O\-A\-D~0xcb}}\label{lspmac_8c_a15e4dbce5615c285ec1755f01057b5fe}


Definition at line 125 of file lspmac.\-c.

\hypertarget{lspmac_8c_a34a2e0d5c1f48ba463ae5d98431d05f7}{\index{lspmac.\-c@{lspmac.\-c}!V\-R\-\_\-\-I\-P\-A\-D\-D\-R\-E\-S\-S@{V\-R\-\_\-\-I\-P\-A\-D\-D\-R\-E\-S\-S}}
\index{V\-R\-\_\-\-I\-P\-A\-D\-D\-R\-E\-S\-S@{V\-R\-\_\-\-I\-P\-A\-D\-D\-R\-E\-S\-S}!lspmac.c@{lspmac.\-c}}
\subsubsection[{V\-R\-\_\-\-I\-P\-A\-D\-D\-R\-E\-S\-S}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\-R\-\_\-\-I\-P\-A\-D\-D\-R\-E\-S\-S~0xe0}}\label{lspmac_8c_a34a2e0d5c1f48ba463ae5d98431d05f7}


Definition at line 126 of file lspmac.\-c.

\hypertarget{lspmac_8c_ac0e5588681366b52589cd321eabf12ff}{\index{lspmac.\-c@{lspmac.\-c}!V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-F\-L\-U\-S\-H@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-F\-L\-U\-S\-H}}
\index{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-F\-L\-U\-S\-H@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-F\-L\-U\-S\-H}!lspmac.c@{lspmac.\-c}}
\subsubsection[{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-F\-L\-U\-S\-H}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-F\-L\-U\-S\-H~0xb3}}\label{lspmac_8c_ac0e5588681366b52589cd321eabf12ff}


Definition at line 112 of file lspmac.\-c.

\hypertarget{lspmac_8c_a50e444b5ceb6d62a1be43c88c55c549c}{\index{lspmac.\-c@{lspmac.\-c}!V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-B\-U\-F\-F\-E\-R@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-B\-U\-F\-F\-E\-R}}
\index{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-B\-U\-F\-F\-E\-R@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-B\-U\-F\-F\-E\-R}!lspmac.c@{lspmac.\-c}}
\subsubsection[{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-B\-U\-F\-F\-E\-R}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-B\-U\-F\-F\-E\-R~0xc5}}\label{lspmac_8c_a50e444b5ceb6d62a1be43c88c55c549c}


Definition at line 122 of file lspmac.\-c.

\hypertarget{lspmac_8c_af3c7372a48fccf0458f266f4bc758a2c}{\index{lspmac.\-c@{lspmac.\-c}!V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-L\-I\-N\-E@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-L\-I\-N\-E}}
\index{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-L\-I\-N\-E@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-L\-I\-N\-E}!lspmac.c@{lspmac.\-c}}
\subsubsection[{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-L\-I\-N\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-L\-I\-N\-E~0xb1}}\label{lspmac_8c_af3c7372a48fccf0458f266f4bc758a2c}


Definition at line 111 of file lspmac.\-c.

\hypertarget{lspmac_8c_af9c53e7c5b2681a5ca1c5410a914a2dc}{\index{lspmac.\-c@{lspmac.\-c}!V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-M\-E\-M@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-M\-E\-M}}
\index{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-M\-E\-M@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-M\-E\-M}!lspmac.c@{lspmac.\-c}}
\subsubsection[{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-M\-E\-M}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-M\-E\-M~0xb4}}\label{lspmac_8c_af9c53e7c5b2681a5ca1c5410a914a2dc}


Definition at line 113 of file lspmac.\-c.

\hypertarget{lspmac_8c_aee7c46f33b9b6945c6b2b260810dc7f5}{\index{lspmac.\-c@{lspmac.\-c}!V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-R\-E\-S\-P\-O\-N\-S\-E@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-R\-E\-S\-P\-O\-N\-S\-E}}
\index{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-R\-E\-S\-P\-O\-N\-S\-E@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-R\-E\-S\-P\-O\-N\-S\-E}!lspmac.c@{lspmac.\-c}}
\subsubsection[{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-R\-E\-S\-P\-O\-N\-S\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-G\-E\-T\-R\-E\-S\-P\-O\-N\-S\-E~0xbf}}\label{lspmac_8c_aee7c46f33b9b6945c6b2b260810dc7f5}


Definition at line 119 of file lspmac.\-c.

\hypertarget{lspmac_8c_a4cd95cb80b8da3962ebe9ec8afe844c8}{\index{lspmac.\-c@{lspmac.\-c}!V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-P\-O\-R\-T@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-P\-O\-R\-T}}
\index{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-P\-O\-R\-T@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-P\-O\-R\-T}!lspmac.c@{lspmac.\-c}}
\subsubsection[{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-P\-O\-R\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-P\-O\-R\-T~0xbe}}\label{lspmac_8c_a4cd95cb80b8da3962ebe9ec8afe844c8}


Definition at line 118 of file lspmac.\-c.

\hypertarget{lspmac_8c_aad3c7b4a9403e56c09eceadcf21252c0}{\index{lspmac.\-c@{lspmac.\-c}!V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-R\-E\-A\-D\-R\-E\-A\-D\-Y@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-R\-E\-A\-D\-R\-E\-A\-D\-Y}}
\index{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-R\-E\-A\-D\-R\-E\-A\-D\-Y@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-R\-E\-A\-D\-R\-E\-A\-D\-Y}!lspmac.c@{lspmac.\-c}}
\subsubsection[{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-R\-E\-A\-D\-R\-E\-A\-D\-Y}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-R\-E\-A\-D\-R\-E\-A\-D\-Y~0xc2}}\label{lspmac_8c_aad3c7b4a9403e56c09eceadcf21252c0}


Definition at line 120 of file lspmac.\-c.

\hypertarget{lspmac_8c_a76c1c401354826ac2ba8906578be930f}{\index{lspmac.\-c@{lspmac.\-c}!V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-N\-D\-C\-T\-R\-L\-C\-H\-A\-R@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-N\-D\-C\-T\-R\-L\-C\-H\-A\-R}}
\index{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-N\-D\-C\-T\-R\-L\-C\-H\-A\-R@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-N\-D\-C\-T\-R\-L\-C\-H\-A\-R}!lspmac.c@{lspmac.\-c}}
\subsubsection[{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-N\-D\-C\-T\-R\-L\-C\-H\-A\-R}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-N\-D\-C\-T\-R\-L\-C\-H\-A\-R~0xb6}}\label{lspmac_8c_a76c1c401354826ac2ba8906578be930f}


Definition at line 115 of file lspmac.\-c.

\hypertarget{lspmac_8c_a772b2ea2ad93989ae4275c79a93525ee}{\index{lspmac.\-c@{lspmac.\-c}!V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-N\-D\-L\-I\-N\-E@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-N\-D\-L\-I\-N\-E}}
\index{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-N\-D\-L\-I\-N\-E@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-N\-D\-L\-I\-N\-E}!lspmac.c@{lspmac.\-c}}
\subsubsection[{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-N\-D\-L\-I\-N\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-N\-D\-L\-I\-N\-E~0xb0}}\label{lspmac_8c_a772b2ea2ad93989ae4275c79a93525ee}


Definition at line 110 of file lspmac.\-c.

\hypertarget{lspmac_8c_aaed77195148c3d9fe10c6e82fc6b2ea7}{\index{lspmac.\-c@{lspmac.\-c}!V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-T\-B\-I\-T@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-T\-B\-I\-T}}
\index{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-T\-B\-I\-T@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-T\-B\-I\-T}!lspmac.c@{lspmac.\-c}}
\subsubsection[{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-T\-B\-I\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-T\-B\-I\-T~0xba}}\label{lspmac_8c_aaed77195148c3d9fe10c6e82fc6b2ea7}


Definition at line 116 of file lspmac.\-c.

\hypertarget{lspmac_8c_a91a625425f6df7610f440231868a5cf1}{\index{lspmac.\-c@{lspmac.\-c}!V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-T\-B\-I\-T\-S@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-T\-B\-I\-T\-S}}
\index{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-T\-B\-I\-T\-S@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-T\-B\-I\-T\-S}!lspmac.c@{lspmac.\-c}}
\subsubsection[{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-T\-B\-I\-T\-S}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-T\-B\-I\-T\-S~0xbb}}\label{lspmac_8c_a91a625425f6df7610f440231868a5cf1}


Definition at line 117 of file lspmac.\-c.

\hypertarget{lspmac_8c_ab79207cc3145740f8c070a24c91b11e0}{\index{lspmac.\-c@{lspmac.\-c}!V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-T\-M\-E\-M@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-T\-M\-E\-M}}
\index{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-T\-M\-E\-M@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-T\-M\-E\-M}!lspmac.c@{lspmac.\-c}}
\subsubsection[{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-T\-M\-E\-M}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-S\-E\-T\-M\-E\-M~0xb5}}\label{lspmac_8c_ab79207cc3145740f8c070a24c91b11e0}


Definition at line 114 of file lspmac.\-c.

\hypertarget{lspmac_8c_af5e53c37c17cd06e42f7b0df211f96d8}{\index{lspmac.\-c@{lspmac.\-c}!V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-W\-R\-I\-T\-E\-B\-U\-F\-F\-E\-R@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-W\-R\-I\-T\-E\-B\-U\-F\-F\-E\-R}}
\index{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-W\-R\-I\-T\-E\-B\-U\-F\-F\-E\-R@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-W\-R\-I\-T\-E\-B\-U\-F\-F\-E\-R}!lspmac.c@{lspmac.\-c}}
\subsubsection[{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-W\-R\-I\-T\-E\-B\-U\-F\-F\-E\-R}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-W\-R\-I\-T\-E\-B\-U\-F\-F\-E\-R~0xc6}}\label{lspmac_8c_af5e53c37c17cd06e42f7b0df211f96d8}


Definition at line 123 of file lspmac.\-c.

\hypertarget{lspmac_8c_ab8367c4c9247a96c6828418d87b8623b}{\index{lspmac.\-c@{lspmac.\-c}!V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-W\-R\-I\-T\-E\-E\-R\-R\-O\-R@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-W\-R\-I\-T\-E\-E\-R\-R\-O\-R}}
\index{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-W\-R\-I\-T\-E\-E\-R\-R\-O\-R@{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-W\-R\-I\-T\-E\-E\-R\-R\-O\-R}!lspmac.c@{lspmac.\-c}}
\subsubsection[{V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-W\-R\-I\-T\-E\-E\-R\-R\-O\-R}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\-R\-\_\-\-P\-M\-A\-C\-\_\-\-W\-R\-I\-T\-E\-E\-R\-R\-O\-R~0xc7}}\label{lspmac_8c_ab8367c4c9247a96c6828418d87b8623b}


Definition at line 124 of file lspmac.\-c.

\hypertarget{lspmac_8c_a5485d08fdc80533b5cebadff63696ed2}{\index{lspmac.\-c@{lspmac.\-c}!V\-R\-\_\-\-U\-P\-L\-O\-A\-D@{V\-R\-\_\-\-U\-P\-L\-O\-A\-D}}
\index{V\-R\-\_\-\-U\-P\-L\-O\-A\-D@{V\-R\-\_\-\-U\-P\-L\-O\-A\-D}!lspmac.c@{lspmac.\-c}}
\subsubsection[{V\-R\-\_\-\-U\-P\-L\-O\-A\-D}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\-R\-\_\-\-U\-P\-L\-O\-A\-D~0xc0}}\label{lspmac_8c_a5485d08fdc80533b5cebadff63696ed2}


Definition at line 107 of file lspmac.\-c.



\subsection{Typedef Documentation}
\hypertarget{lspmac_8c_a3495613b8b94cadc4205f19e1254ebeb}{\index{lspmac.\-c@{lspmac.\-c}!md2\-\_\-status\-\_\-t@{md2\-\_\-status\-\_\-t}}
\index{md2\-\_\-status\-\_\-t@{md2\-\_\-status\-\_\-t}!lspmac.c@{lspmac.\-c}}
\subsubsection[{md2\-\_\-status\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf md2\-Status\-Struct}  {\bf md2\-\_\-status\-\_\-t}}}\label{lspmac_8c_a3495613b8b94cadc4205f19e1254ebeb}


The block of memory retrieved in a status request. 



\subsection{Function Documentation}
\hypertarget{lspmac_8c_a8f9f1ad624350095075aa6b51423b02d}{\index{lspmac.\-c@{lspmac.\-c}!cleanstr@{cleanstr}}
\index{cleanstr@{cleanstr}!lspmac.c@{lspmac.\-c}}
\subsubsection[{cleanstr}]{\setlength{\rightskip}{0pt plus 5cm}void cleanstr (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{s}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a8f9f1ad624350095075aa6b51423b02d}


Replace \textbackslash{}r with \textbackslash{}n in null terminated string and print result to terminal. 

Needed to turn P\-M\-A\-C messages into something printable. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em s} & String to print to terminal. \\
\hline
\end{DoxyParams}


Definition at line 432 of file lspmac.\-c.


\begin{DoxyCode}
                \{
  \textcolor{keywordtype}{int} i;

  pthread\_mutex\_lock( &\hyperlink{pgpmac_8c_ad128c64890c7c0d4f836d9ec6e99216a}{ncurses\_mutex});

  \textcolor{keywordflow}{for}( i=0; i<strlen( s); i++) \{
    \textcolor{keywordflow}{if}( s[i] == \textcolor{charliteral}{'\(\backslash\)r'})
      wprintw( \hyperlink{pgpmac_8c_a65daf0f4a5bc6def23a9df98ff5ca57e}{term\_output}, \textcolor{stringliteral}{"\(\backslash\)n"});
    \textcolor{keywordflow}{else}
      wprintw( \hyperlink{pgpmac_8c_a65daf0f4a5bc6def23a9df98ff5ca57e}{term\_output}, \textcolor{stringliteral}{"%c"}, s[i]);
  \}

  pthread\_mutex\_unlock( &\hyperlink{pgpmac_8c_ad128c64890c7c0d4f836d9ec6e99216a}{ncurses\_mutex});
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a1c3786f3a38724f497afc4fe6d82d8c4}{\index{lspmac.\-c@{lspmac.\-c}!hex\-\_\-dump@{hex\-\_\-dump}}
\index{hex\-\_\-dump@{hex\-\_\-dump}!lspmac.c@{lspmac.\-c}}
\subsubsection[{hex\-\_\-dump}]{\setlength{\rightskip}{0pt plus 5cm}void hex\-\_\-dump (
\begin{DoxyParamCaption}
\item[{int}]{n, }
\item[{unsigned char $\ast$}]{s}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a1c3786f3a38724f497afc4fe6d82d8c4}


Prints a hex dump of the given data. 

Used to debug packet data. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em n} & Number of bytes passed in s \\
\hline
\mbox{\tt in}  & {\em s} & Data to dump \\
\hline
\end{DoxyParams}


Definition at line 404 of file lspmac.\-c.


\begin{DoxyCode}
                \{

  \textcolor{keywordtype}{int} i;        \textcolor{comment}{// row counter}
  \textcolor{keywordtype}{int} j;        \textcolor{comment}{// column counter}

  pthread\_mutex\_lock( &\hyperlink{pgpmac_8c_ad128c64890c7c0d4f836d9ec6e99216a}{ncurses\_mutex});

  \textcolor{keywordflow}{for}( i=0; n > 0; i++) \{
    \textcolor{keywordflow}{for}( j=0; j<16 && n > 0; j++) \{
      \textcolor{keywordflow}{if}( j==8)
        wprintw( \hyperlink{pgpmac_8c_a65daf0f4a5bc6def23a9df98ff5ca57e}{term\_output}, \textcolor{stringliteral}{"  "});
      wprintw( \hyperlink{pgpmac_8c_a65daf0f4a5bc6def23a9df98ff5ca57e}{term\_output}, \textcolor{stringliteral}{" %02x"}, *(s + 16*i + j));
      n--;
    \}
    wprintw( \hyperlink{pgpmac_8c_a65daf0f4a5bc6def23a9df98ff5ca57e}{term\_output}, \textcolor{stringliteral}{"\(\backslash\)n"});
  \}
  wprintw( \hyperlink{pgpmac_8c_a65daf0f4a5bc6def23a9df98ff5ca57e}{term\_output}, \textcolor{stringliteral}{"\(\backslash\)n"});

  pthread\_mutex\_unlock( &\hyperlink{pgpmac_8c_ad128c64890c7c0d4f836d9ec6e99216a}{ncurses\_mutex});
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_aae020ea2478b41702ce8b7d20b2560be}{\index{lspmac.\-c@{lspmac.\-c}!ls\-Connect@{ls\-Connect}}
\index{ls\-Connect@{ls\-Connect}!lspmac.c@{lspmac.\-c}}
\subsubsection[{ls\-Connect}]{\setlength{\rightskip}{0pt plus 5cm}void ls\-Connect (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{ipaddr}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_aae020ea2478b41702ce8b7d20b2560be}


Connect to the P\-M\-A\-C socket. 

Establish or reestablish communications. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em ipaddr} & String representation of the I\-P address (dot quad or F\-Q\-N) \\
\hline
\end{DoxyParams}


Definition at line 453 of file lspmac.\-c.


\begin{DoxyCode}
                 \{
  \textcolor{keywordtype}{int} psock;                    \textcolor{comment}{// our socket: value stored in pmacfda.fd}
  \textcolor{keywordtype}{int} err;                      \textcolor{comment}{// error code from some system calls}
  \textcolor{keyword}{struct }sockaddr\_in *addrP;    \textcolor{comment}{// our address structure to connect to}
  \textcolor{keyword}{struct }addrinfo ai\_hints;     \textcolor{comment}{// required for getaddrinfo}
  \textcolor{keyword}{struct }addrinfo *ai\_resultP;  \textcolor{comment}{// linked list of address structures (we'll
       always pick the first)}

  \hyperlink{lspmac_8c_adba7f5f4bbeabc4dac859221d4c684ba}{pmacfd}.fd     = -1;
  \hyperlink{lspmac_8c_adba7f5f4bbeabc4dac859221d4c684ba}{pmacfd}.events = 0;

  \textcolor{comment}{// Initial buffer(s)}
  memset( &ai\_hints,  0, \textcolor{keyword}{sizeof}( ai\_hints));

  ai\_hints.ai\_family   = AF\_INET;
  ai\_hints.ai\_socktype = SOCK\_STREAM;


  \textcolor{comment}{//}
  \textcolor{comment}{// get address}
  \textcolor{comment}{//}
  err = getaddrinfo( ipaddr, NULL, &ai\_hints, &ai\_resultP);
  \textcolor{keywordflow}{if}( err != 0) \{

    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Could not find address: %s"}, 
      gai\_strerror( err));

    \textcolor{keywordflow}{return};
  \}


  addrP = (\textcolor{keyword}{struct }sockaddr\_in *)ai\_resultP->ai\_addr;
  addrP->sin\_port = htons( \hyperlink{lspmac_8c_ac95886e84843b6b0bb6cc270e42043c4}{PMACPORT});


  psock = socket( PF\_INET, SOCK\_STREAM, 0);
  \textcolor{keywordflow}{if}( psock == -1) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Could not create socket"});
    \textcolor{keywordflow}{return};
  \}

  err = connect( psock, (\textcolor{keyword}{const} \textcolor{keyword}{struct} sockaddr *)addrP, \textcolor{keyword}{sizeof}( *addrP));
  \textcolor{keywordflow}{if}( err != 0) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Could not connect socket: %s"},
       strerror( errno));
    \textcolor{keywordflow}{return};
  \}

  \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state} = \hyperlink{lspmac_8c_a37741af675425d61c876cc30ae6c99d0}{LS\_PMAC\_STATE\_IDLE};
  \hyperlink{lspmac_8c_adba7f5f4bbeabc4dac859221d4c684ba}{pmacfd}.fd     = psock;
  \hyperlink{lspmac_8c_adba7f5f4bbeabc4dac859221d4c684ba}{pmacfd}.events = POLLIN;

\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a50e22adfb4d14499c1f5647458ca2ad9}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-bio\-\_\-init@{lspmac\-\_\-bio\-\_\-init}}
\index{lspmac\-\_\-bio\-\_\-init@{lspmac\-\_\-bio\-\_\-init}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-bio\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ lspmac\-\_\-bio\-\_\-init (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{d, }
\item[{char $\ast$}]{name, }
\item[{char $\ast$}]{write\-\_\-fmt, }
\item[{int $\ast$}]{read\-\_\-ptr, }
\item[{int}]{read\-\_\-mask}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a50e22adfb4d14499c1f5647458ca2ad9}


Initialize binary i/o motor. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em d} & Our uninitialized motor object \\
\hline
\mbox{\tt in}  & {\em name} & Name of motor to coordinate with D\-B \\
\hline
\mbox{\tt in}  & {\em write\-\_\-fmt} & Format string used to generate P\-M\-A\-C command to move motor \\
\hline
\mbox{\tt in}  & {\em read\-\_\-ptr} & Pointer to byte in md2\-\_\-status to find position \\
\hline
\mbox{\tt in}  & {\em read\-\_\-mask} & Bitmask to find position in $\ast$read\-\_\-ptr \\
\hline
\end{DoxyParams}


Definition at line 2032 of file lspmac.\-c.


\begin{DoxyCode}
                                  \{
  \hyperlink{lspmac_8c_a56260f012c50a591ee7f97e500f16994}{lspmac\_nmotors}++;

  d->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name}              = strdup( name);
  d->\hyperlink{structlspmac__motor__struct_a20db3de86854b627815b3d940555ea75}{moveAbs}           = \hyperlink{lspmac_8c_ad1167f01262cf6387e7e82a14d3e1a9d}{lspmac\_moveabs\_bio\_queue}
      ;
  d->\hyperlink{structlspmac__motor__struct_ac62692eb939c04ca35e939d1c3acfe8f}{read}              = \hyperlink{lspmac_8c_a5945488310a5a8f616e6605782c7f1c9}{lspmac\_bio\_read};
  d->\hyperlink{structlspmac__motor__struct_a7b43671f7f3e06521f6cf91fb9ac707d}{lut}               = NULL;
  d->\hyperlink{structlspmac__motor__struct_a11cbc6f50c150ed446e9a901cf7cc12b}{nlut}              = 0;
  d->\hyperlink{structlspmac__motor__struct_a312047bb71def5cd2443fecd875eaea5}{actual\_pos\_cnts\_p} = NULL;
  d->\hyperlink{structlspmac__motor__struct_a56c41875faf19c643e97c10519e6eb8c}{status1\_p}         = NULL;
  d->\hyperlink{structlspmac__motor__struct_a2b33ef6e12717459c1e9967cc6e659c6}{status2\_p}         = NULL;
  d->\hyperlink{structlspmac__motor__struct_a45fae17618f0c0827e97060dc04f79cb}{motor\_num}         = -1;
  d->\hyperlink{structlspmac__motor__struct_a05dff021221abbc1bf656039fffb3275}{dac\_mvar}          = NULL;
  d->\hyperlink{structlspmac__motor__struct_a133775154b0e008f3a2fde6f53bc0eff}{win}               = NULL;
  d->\hyperlink{structlspmac__motor__struct_a70291ddfe7994c0bec7fc2287cb6dd89}{write\_fmt}         = strdup( write\_fmt);
  d->\hyperlink{structlspmac__motor__struct_a844b28ccabab5048ca216db074fb9704}{read\_ptr}          = read\_ptr;
  d->\hyperlink{structlspmac__motor__struct_a3c24ed30c5a3ad490c6139b2780b2af7}{read\_mask}         = read\_mask;
  d->\hyperlink{structlspmac__motor__struct_aa74108855693f94fc2ff76333c9fb6ac}{homing}            = 0;
  d->\hyperlink{structlspmac__motor__struct_a133775154b0e008f3a2fde6f53bc0eff}{win}               = NULL;
  d->\hyperlink{structlspmac__motor__struct_a61415627ab2dc0f438b190d117e532db}{u2c}               = 1.0;

  d->\hyperlink{structlspmac__motor__struct_af11e5f75c1cf88ed6842d04154d27a31}{lspg\_initialized} = 0;
  \textcolor{keywordflow}{return} d;
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a5945488310a5a8f616e6605782c7f1c9}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-bio\-\_\-read@{lspmac\-\_\-bio\-\_\-read}}
\index{lspmac\-\_\-bio\-\_\-read@{lspmac\-\_\-bio\-\_\-read}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-bio\-\_\-read}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-bio\-\_\-read (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{mp}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a5945488310a5a8f616e6605782c7f1c9}


Read the state of a binary i/o motor This is the read method for the binary i/o motor class. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em mp} & The motor \\
\hline
\end{DoxyParams}


Definition at line 995 of file lspmac.\-c.


\begin{DoxyCode}
                       \{
  \textcolor{keywordtype}{char} s[512];
  \textcolor{keywordtype}{int} pos;

  pthread\_mutex\_lock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));

  pos = (*(mp->\hyperlink{structlspmac__motor__struct_a844b28ccabab5048ca216db074fb9704}{read\_ptr}) & mp->\hyperlink{structlspmac__motor__struct_a3c24ed30c5a3ad490c6139b2780b2af7}{read\_mask}) == 0 ? 0 : 1;
  mp->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position} = pos;

  \textcolor{comment}{// Not sure what kind of status makes sense to report}
  mp->\hyperlink{structlspmac__motor__struct_ae4a6f54a98e7758d66228efebe8f3baa}{statuss}[0] = 0;


  \textcolor{comment}{/*}
\textcolor{comment}{  pthread\_mutex\_lock( &ncurses\_mutex);}
\textcolor{comment}{  wprintw( term\_output, "    %d    %f\(\backslash\)n", pos, mp->position);}
\textcolor{comment}{  wnoutrefresh( term\_output);}
\textcolor{comment}{  wnoutrefresh( term\_input);}
\textcolor{comment}{  doupdate();}
\textcolor{comment}{  pthread\_mutex\_unlock( &ncurses\_mutex);}
\textcolor{comment}{  */}

  pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a6d88f6db90e4a7219a237b183d10a27d}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-dac\-\_\-init@{lspmac\-\_\-dac\-\_\-init}}
\index{lspmac\-\_\-dac\-\_\-init@{lspmac\-\_\-dac\-\_\-init}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-dac\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ lspmac\-\_\-dac\-\_\-init (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{d, }
\item[{int $\ast$}]{posp, }
\item[{double}]{scale, }
\item[{char $\ast$}]{mvar, }
\item[{char $\ast$}]{name}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a6d88f6db90e4a7219a237b183d10a27d}


Initialize D\-A\-C motor Note that some motors require further initialization from a database query. 

For this reason this initialzation code must be run before the database queue is allowed to be processed. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em d} & Returns the (almost) initialized motor object \mbox{[}in,out\mbox{]} unitintialized motor \\
\hline
\mbox{\tt in}  & {\em posp} & Location of current position \\
\hline
\mbox{\tt in}  & {\em scale} & Scale factor (units) \\
\hline
\mbox{\tt in}  & {\em mvar} & M variable, ie, \char`\"{}\-M1200\char`\"{} \\
\hline
\mbox{\tt in}  & {\em name} & name to coordinate with D\-B \\
\hline
\end{DoxyParams}


Definition at line 2070 of file lspmac.\-c.


\begin{DoxyCode}
                                  \{
  \hyperlink{lspmac_8c_a56260f012c50a591ee7f97e500f16994}{lspmac\_nmotors}++;
  d->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name}     = strdup( name);
  d->\hyperlink{structlspmac__motor__struct_a20db3de86854b627815b3d940555ea75}{moveAbs}  = \hyperlink{lspmac_8c_a7d601716497857c2b5c072c1aed37b71}{lspmac\_movedac\_queue};
  d->\hyperlink{structlspmac__motor__struct_ac62692eb939c04ca35e939d1c3acfe8f}{read}     = \hyperlink{lspmac_8c_a200bc9306d54fca566eb5e29d8e82308}{lspmac\_dac\_read};
  d->\hyperlink{structlspmac__motor__struct_a7b43671f7f3e06521f6cf91fb9ac707d}{lut}      = NULL;
  d->\hyperlink{structlspmac__motor__struct_a11cbc6f50c150ed446e9a901cf7cc12b}{nlut}     = 0;
  d->\hyperlink{structlspmac__motor__struct_a312047bb71def5cd2443fecd875eaea5}{actual\_pos\_cnts\_p} = posp;
  d->\hyperlink{structlspmac__motor__struct_a56c41875faf19c643e97c10519e6eb8c}{status1\_p}         = NULL;
  d->\hyperlink{structlspmac__motor__struct_a2b33ef6e12717459c1e9967cc6e659c6}{status2\_p}         = NULL;
  d->\hyperlink{structlspmac__motor__struct_a45fae17618f0c0827e97060dc04f79cb}{motor\_num}         = -1;
  d->\hyperlink{structlspmac__motor__struct_a05dff021221abbc1bf656039fffb3275}{dac\_mvar}          = strdup(mvar);
  d->\hyperlink{structlspmac__motor__struct_a61415627ab2dc0f438b190d117e532db}{u2c}               = scale;
  d->\hyperlink{structlspmac__motor__struct_aa74108855693f94fc2ff76333c9fb6ac}{homing}            = 0;
  d->\hyperlink{structlspmac__motor__struct_a133775154b0e008f3a2fde6f53bc0eff}{win}               = NULL;

  d->\hyperlink{structlspmac__motor__struct_af11e5f75c1cf88ed6842d04154d27a31}{lspg\_initialized} = 0;
  \textcolor{keywordflow}{return} d;
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a200bc9306d54fca566eb5e29d8e82308}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-dac\-\_\-read@{lspmac\-\_\-dac\-\_\-read}}
\index{lspmac\-\_\-dac\-\_\-read@{lspmac\-\_\-dac\-\_\-read}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-dac\-\_\-read}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-dac\-\_\-read (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{mp}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a200bc9306d54fca566eb5e29d8e82308}


Read a D\-A\-C motor position. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em mp} & The motor \\
\hline
\end{DoxyParams}


Definition at line 1024 of file lspmac.\-c.


\begin{DoxyCode}
                       \{
  \textcolor{keywordtype}{int} pos;
  pthread\_mutex\_lock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
  mp->\hyperlink{structlspmac__motor__struct_ae5c7aea45b9637a1817be246688fd980}{actual\_pos\_cnts} = *mp->\hyperlink{structlspmac__motor__struct_a312047bb71def5cd2443fecd875eaea5}{actual\_pos\_cnts\_p};

  \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a11cbc6f50c150ed446e9a901cf7cc12b}{nlut} >0 && mp->\hyperlink{structlspmac__motor__struct_a7b43671f7f3e06521f6cf91fb9ac707d}{lut} != NULL) \{
    mp->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position} = \hyperlink{lspmac_8c_a5afe5cd407b44f9c05ad4f1c4e4d5f6a}{lspmac\_rlut}( mp->\hyperlink{structlspmac__motor__struct_a11cbc6f50c150ed446e9a901cf7cc12b}{nlut}, mp->\hyperlink{structlspmac__motor__struct_a7b43671f7f3e06521f6cf91fb9ac707d}{lut}, mp
      ->\hyperlink{structlspmac__motor__struct_ae5c7aea45b9637a1817be246688fd980}{actual\_pos\_cnts});
  \} \textcolor{keywordflow}{else} \{
    \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a61415627ab2dc0f438b190d117e532db}{u2c} != 0.0) \{
      mp->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position} = mp->\hyperlink{structlspmac__motor__struct_ae5c7aea45b9637a1817be246688fd980}{actual\_pos\_cnts} / mp->\hyperlink{structlspmac__motor__struct_a61415627ab2dc0f438b190d117e532db}{u2c};
    \} \textcolor{keywordflow}{else} \{
      mp->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position} = mp->\hyperlink{structlspmac__motor__struct_ae5c7aea45b9637a1817be246688fd980}{actual\_pos\_cnts};
    \}
  \}

  \textcolor{comment}{// Not sure what kind of status makes sense to report}
  mp->\hyperlink{structlspmac__motor__struct_ae4a6f54a98e7758d66228efebe8f3baa}{statuss}[0] = 0;

  pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a2442c529b024e9c23c4acef8c1eb8689}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-\-Error@{lspmac\-\_\-\-Error}}
\index{lspmac\-\_\-\-Error@{lspmac\-\_\-\-Error}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-\-Error}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-\-Error (
\begin{DoxyParamCaption}
\item[{unsigned char $\ast$}]{buff}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a2442c529b024e9c23c4acef8c1eb8689}


The service routing detected an error condition. 

Scan the response buffer for an error code and print it out. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em buff} & Buffer returned by P\-M\-A\-C perhaps containing a N\-U\-L\-L terminated message. \\
\hline
\end{DoxyParams}


Definition at line 650 of file lspmac.\-c.


\begin{DoxyCode}
                    \{
  \textcolor{keywordtype}{int} err;
  \textcolor{comment}{//}
  \textcolor{comment}{// assume buff points to a 1400 byte array of stuff read from the pmac}
  \textcolor{comment}{//}

  \textcolor{keywordflow}{if}( buff[0] == 7 && buff[1] == \textcolor{charliteral}{'E'} && buff[2] == \textcolor{charliteral}{'R'} && buff[3] == \textcolor{charliteral}{'R'}) \{
    buff[7] = 0;  \textcolor{comment}{// For null termination}
    err = atoi( &(buff[4]));
    \textcolor{keywordflow}{if}( err > 0 && err < 20) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \hyperlink{lspmac_8c_aab5a76f1ac64049314f9836e5c01fb7e}{pmac\_error\_strs}
      [err]);

      pthread\_mutex\_lock( &\hyperlink{pgpmac_8c_ad128c64890c7c0d4f836d9ec6e99216a}{ncurses\_mutex});
      wprintw( \hyperlink{pgpmac_8c_a65daf0f4a5bc6def23a9df98ff5ca57e}{term\_output}, \textcolor{stringliteral}{"\(\backslash\)n%s\(\backslash\)n"}, \hyperlink{lspmac_8c_aab5a76f1ac64049314f9836e5c01fb7e}{pmac\_error\_strs}
      [err]);
      wnoutrefresh( \hyperlink{pgpmac_8c_a65daf0f4a5bc6def23a9df98ff5ca57e}{term\_output});
      wnoutrefresh( \hyperlink{pgpmac_8c_ab0487111dbe3c05d0bd835eb2fb9a3f7}{term\_input});
      doupdate();
      pthread\_mutex\_unlock( &\hyperlink{pgpmac_8c_ad128c64890c7c0d4f836d9ec6e99216a}{ncurses\_mutex});
    \}
  \}
  \hyperlink{lspmac_8c_aaedae34bc18ac1742a232117c125d7b9}{lspmac\_Reset}();
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a40aa4aeb5c799a6a3a089137da4fd6a8}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-fshut\-\_\-init@{lspmac\-\_\-fshut\-\_\-init}}
\index{lspmac\-\_\-fshut\-\_\-init@{lspmac\-\_\-fshut\-\_\-init}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-fshut\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ lspmac\-\_\-fshut\-\_\-init (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{d}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a40aa4aeb5c799a6a3a089137da4fd6a8}


Initalize the fast shutter motor. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em d} & Our uninitialized motor object \\
\hline
\end{DoxyParams}


Definition at line 2004 of file lspmac.\-c.


\begin{DoxyCode}
                                    \{
  \hyperlink{lspmac_8c_a56260f012c50a591ee7f97e500f16994}{lspmac\_nmotors}++;
  d->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name}           = strdup(\textcolor{stringliteral}{"fastShutter"});
  d->\hyperlink{structlspmac__motor__struct_a20db3de86854b627815b3d940555ea75}{moveAbs}        = \hyperlink{lspmac_8c_ab9f114bba58e685760a518bd5f115d74}{lspmac\_moveabs\_fshut\_queue}
      ;
  d->\hyperlink{structlspmac__motor__struct_ac62692eb939c04ca35e939d1c3acfe8f}{read}           = \hyperlink{lspmac_8c_ab81f07dea6bb0e88103a05a380de1034}{lspmac\_shutter\_read};
  d->\hyperlink{structlspmac__motor__struct_a7b43671f7f3e06521f6cf91fb9ac707d}{lut}            = NULL;
  d->\hyperlink{structlspmac__motor__struct_a11cbc6f50c150ed446e9a901cf7cc12b}{nlut}           = 0;
  d->\hyperlink{structlspmac__motor__struct_a312047bb71def5cd2443fecd875eaea5}{actual\_pos\_cnts\_p} = NULL;
  d->\hyperlink{structlspmac__motor__struct_a56c41875faf19c643e97c10519e6eb8c}{status1\_p}         = NULL;
  d->\hyperlink{structlspmac__motor__struct_a2b33ef6e12717459c1e9967cc6e659c6}{status2\_p}         = NULL;
  d->\hyperlink{structlspmac__motor__struct_a45fae17618f0c0827e97060dc04f79cb}{motor\_num}         = -1;
  d->\hyperlink{structlspmac__motor__struct_a05dff021221abbc1bf656039fffb3275}{dac\_mvar}          = NULL;
  d->\hyperlink{structlspmac__motor__struct_aa74108855693f94fc2ff76333c9fb6ac}{homing}            = 0;
  d->\hyperlink{structlspmac__motor__struct_a133775154b0e008f3a2fde6f53bc0eff}{win}               = NULL;

  d->\hyperlink{structlspmac__motor__struct_af11e5f75c1cf88ed6842d04154d27a31}{lspg\_initialized} = 0;
  \textcolor{keywordflow}{return} d;
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a6dedca923b3a6904395ad02158e2e96f}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-get\-\_\-status@{lspmac\-\_\-get\-\_\-status}}
\index{lspmac\-\_\-get\-\_\-status@{lspmac\-\_\-get\-\_\-status}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-get\-\_\-status}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-get\-\_\-status (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a6dedca923b3a6904395ad02158e2e96f}


Request a status update from the P\-M\-A\-C. 



Definition at line 1512 of file lspmac.\-c.


\begin{DoxyCode}
                         \{
  \hyperlink{lspmac_8c_a1e472a11df3765763c2fe92dd358bf0c}{lspmac\_send\_command}( \hyperlink{lspmac_8c_a5485d08fdc80533b5cebadff63696ed2}{VR\_UPLOAD}, \hyperlink{lspmac_8c_af9c53e7c5b2681a5ca1c5410a914a2dc}{VR\_PMAC\_GETMEM}
      , 0x400, 0, \textcolor{keyword}{sizeof}(\hyperlink{structmd2StatusStruct}{md2\_status\_t}), NULL, \hyperlink{lspmac_8c_ad060fd55c9e2411fd4fd4e946aff23c6}{lspmac\_get\_status\_cb}
      , 0);
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_ad060fd55c9e2411fd4fd4e946aff23c6}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-get\-\_\-status\-\_\-cb@{lspmac\-\_\-get\-\_\-status\-\_\-cb}}
\index{lspmac\-\_\-get\-\_\-status\-\_\-cb@{lspmac\-\_\-get\-\_\-status\-\_\-cb}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-get\-\_\-status\-\_\-cb}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-get\-\_\-status\-\_\-cb (
\begin{DoxyParamCaption}
\item[{{\bf pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$}]{cmd, }
\item[{int}]{nreceived, }
\item[{unsigned char $\ast$}]{buff}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_ad060fd55c9e2411fd4fd4e946aff23c6}


Service routing for status upate This updates positions and status information. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em cmd} & The command that generated this reply \\
\hline
\mbox{\tt in}  & {\em nreceived} & Number of bytes received \\
\hline
\mbox{\tt in}  & {\em buff} & The Big Byte Buffer \\
\hline
\end{DoxyParams}


Definition at line 1374 of file lspmac.\-c.


\begin{DoxyCode}
                            \{
  \textcolor{keyword}{static} \textcolor{keywordtype}{int} cnt = 0;
  \textcolor{keyword}{static} \textcolor{keywordtype}{char} s[256];
  \textcolor{keyword}{static} \textcolor{keyword}{struct }timeval ts1, ts2;

  \textcolor{keywordtype}{char} *sp;
  \textcolor{keywordtype}{int} i, pos;
  \hyperlink{structlspmac__motor__struct}{lspmac\_motor\_t} *mp;

  \textcolor{keywordflow}{if}( cnt == 0) \{
    gettimeofday( &ts1, NULL);
  \}

  pthread\_mutex\_lock( &\hyperlink{lspmac_8c_a7a3e763682bd7f987d07f149e94b3bf8}{md2\_status\_mutex});
  memcpy( &\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}, buff, \textcolor{keyword}{sizeof}(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}));
  pthread\_mutex\_unlock( &\hyperlink{lspmac_8c_a7a3e763682bd7f987d07f149e94b3bf8}{md2\_status\_mutex});


  \textcolor{comment}{//}
  \textcolor{comment}{// track the coordinate system moving flags}
  \textcolor{comment}{//}
  pthread\_mutex\_lock( &\hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex});
  \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_aac82f8e97fa39ea9be7823dd1d308986}{moving\_flags} != \hyperlink{lspmac_8c_a7a32c617c183166308241e270959df56}{lspmac\_moving\_flags}
      ) \{
    \hyperlink{lspmac_8c_a7a32c617c183166308241e270959df56}{lspmac\_moving\_flags} = \hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_aac82f8e97fa39ea9be7823dd1d308986}{moving\_flags}
      ;
    pthread\_cond\_signal( &\hyperlink{lspmac_8c_a57547d211906c981ef20257eba99f8df}{lspmac\_moving\_cond});
  \}
  pthread\_mutex\_unlock( &\hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex});



  \textcolor{keywordflow}{for}( i=0; i<\hyperlink{lspmac_8c_a56260f012c50a591ee7f97e500f16994}{lspmac\_nmotors}; i++) \{
    \hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}[i].\hyperlink{structlspmac__motor__struct_ac62692eb939c04ca35e939d1c3acfe8f}{read}(&(\hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}[i]));
  \}

  pthread\_mutex\_lock( &\hyperlink{pgpmac_8c_ad128c64890c7c0d4f836d9ec6e99216a}{ncurses\_mutex});

  \textcolor{comment}{// acc11c\_1}
  \textcolor{comment}{// mask  bit}
  \textcolor{comment}{// 0x01  0    Air pressure OK}
  \textcolor{comment}{// 0x02  1    Air bearing OK}
  \textcolor{comment}{// 0x04  2    Cryo switch}
  \textcolor{comment}{// 0x08  3}
  \textcolor{comment}{// 0x10  4}
  \textcolor{comment}{// 0x20  5}
  \textcolor{comment}{// 0x40  6    Cryo is back}

  \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_a69fc2e30a5de0a11c992d133e7a761cd}{acc11c\_1} & 0x40)
    mvwprintw( \hyperlink{pgpmac_8c_ae2d7da3afeb756716e6e4ee9cab78f8a}{term\_status2}, 3, 1, \textcolor{stringliteral}{"%*s"}, -8, \textcolor{stringliteral}{"Cryo Out"});
  \textcolor{keywordflow}{else}
    mvwprintw( \hyperlink{pgpmac_8c_ae2d7da3afeb756716e6e4ee9cab78f8a}{term\_status2}, 3, 1, \textcolor{stringliteral}{"%*s"}, -8, \textcolor{stringliteral}{"Cryo In "});

  \textcolor{comment}{//}
  \textcolor{comment}{// acc11c\_2}
  \textcolor{comment}{// mask  bit}
  \textcolor{comment}{// 0x01  0    Fluor Dector back}
  \textcolor{comment}{// 0x02  1    Sample Detected}
  \textcolor{comment}{// 0x04  2}
  \textcolor{comment}{// 0x08  3}
  \textcolor{comment}{// 0x10  4}
  \textcolor{comment}{// 0x20  5    Etel Ready}
  \textcolor{comment}{// 0x40  6    Etel On}
  \textcolor{comment}{// 0x80  7    Etel Init OK}

  \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_ad186f06cb4670b00b8af8264d1da66a4}{acc11c\_2} & 0x01)
    mvwprintw( \hyperlink{pgpmac_8c_ae2d7da3afeb756716e6e4ee9cab78f8a}{term\_status2}, 3, 10, \textcolor{stringliteral}{"%*s"}, -8, \textcolor{stringliteral}{"Fluor Out"});
  \textcolor{keywordflow}{else}
    mvwprintw( \hyperlink{pgpmac_8c_ae2d7da3afeb756716e6e4ee9cab78f8a}{term\_status2}, 3, 10, \textcolor{stringliteral}{"%*s"}, -8, \textcolor{stringliteral}{"Fluor In"});

  \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_ab09c1342dc12052b8f5b35f78ef95000}{acc11c\_5} & 0x08)
    mvwprintw( \hyperlink{pgpmac_8c_ae2d7da3afeb756716e6e4ee9cab78f8a}{term\_status2}, 4, 1, \textcolor{stringliteral}{"%*s"}, -(\hyperlink{pgpmac_8h_a1f96754f00a1f82414cebc66f75ded78}{LS\_DISPLAY\_WINDOW\_WIDTH}
      -2), \textcolor{stringliteral}{"Dryer On"});
  \textcolor{keywordflow}{else}
    mvwprintw( \hyperlink{pgpmac_8c_ae2d7da3afeb756716e6e4ee9cab78f8a}{term\_status2}, 4, 1, \textcolor{stringliteral}{"%*s"}, -(\hyperlink{pgpmac_8h_a1f96754f00a1f82414cebc66f75ded78}{LS\_DISPLAY\_WINDOW\_WIDTH}
      -2), \textcolor{stringliteral}{"Dryer Off"});

  \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_ad186f06cb4670b00b8af8264d1da66a4}{acc11c\_2} & 0x02)
    mvwprintw( \hyperlink{pgpmac_8c_ae2d7da3afeb756716e6e4ee9cab78f8a}{term\_status2}, 2, 1, \textcolor{stringliteral}{"%*s"}, -(\hyperlink{pgpmac_8h_a1f96754f00a1f82414cebc66f75ded78}{LS\_DISPLAY\_WINDOW\_WIDTH}
      -2), \textcolor{stringliteral}{"Cap Dectected"});
  \textcolor{keywordflow}{else}
    mvwprintw( \hyperlink{pgpmac_8c_ae2d7da3afeb756716e6e4ee9cab78f8a}{term\_status2}, 2, 1, \textcolor{stringliteral}{"%*s"}, -(\hyperlink{pgpmac_8h_a1f96754f00a1f82414cebc66f75ded78}{LS\_DISPLAY\_WINDOW\_WIDTH}
      -2), \textcolor{stringliteral}{"Cap Not Dectected"});
  wnoutrefresh( \hyperlink{pgpmac_8c_ae2d7da3afeb756716e6e4ee9cab78f8a}{term\_status2});


  \textcolor{comment}{// acc11c\_3}
  \textcolor{comment}{// mask  bit}
  \textcolor{comment}{// 0x01  0    Minikappa OK}
  \textcolor{comment}{// 0x02  1}
  \textcolor{comment}{// 0x04  2}
  \textcolor{comment}{// 0x08  3    Arm Parked}

  \textcolor{comment}{// acc11c\_5}
  \textcolor{comment}{// mask  bit}
  \textcolor{comment}{// 0x01  0    Mag Off}
  \textcolor{comment}{// 0x02  1    Condenser Out}
  \textcolor{comment}{// 0x04  2    Cryo Back}
  \textcolor{comment}{// 0x08  3    Dryer On}
  \textcolor{comment}{// 0x10  4    FluoDet Out}
  \textcolor{comment}{// 0x20  5}
  \textcolor{comment}{// 0x40  6    1=SmartMag, 0=Permanent Mag}
  \textcolor{comment}{//}

  \textcolor{comment}{// acc11c\_6}
  \textcolor{comment}{// mask   bit}
  \textcolor{comment}{// 0x0080   7   Etel Enable}
  \textcolor{comment}{// 0x0100   8   Fast Shutter Enable}
  \textcolor{comment}{// 0x0200   9   Fast Shutter Manual Enable}
  \textcolor{comment}{// 0x0400  10   Fast Shutter On}



  \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_ab09c1342dc12052b8f5b35f78ef95000}{acc11c\_5} & 0x02)
    mvwprintw( \hyperlink{pgpmac_8c_ae746a6903fb8a4ea216def88eccedc3c}{term\_status},  3, 1, \textcolor{stringliteral}{"%*s"}, -(\hyperlink{pgpmac_8h_a1f96754f00a1f82414cebc66f75ded78}{LS\_DISPLAY\_WINDOW\_WIDTH}
      -2), \textcolor{stringliteral}{"Backlight Up"});
  \textcolor{keywordflow}{else}
    mvwprintw( \hyperlink{pgpmac_8c_ae746a6903fb8a4ea216def88eccedc3c}{term\_status},  3, 1, \textcolor{stringliteral}{"%*s"}, -(\hyperlink{pgpmac_8h_a1f96754f00a1f82414cebc66f75ded78}{LS\_DISPLAY\_WINDOW\_WIDTH}
      -2), \textcolor{stringliteral}{"Backlight Down"});

  mvwprintw( \hyperlink{pgpmac_8c_ae746a6903fb8a4ea216def88eccedc3c}{term\_status}, 4, 1, \textcolor{stringliteral}{"Front: %*u"}, \hyperlink{pgpmac_8h_a1f96754f00a1f82414cebc66f75ded78}{
      LS\_DISPLAY\_WINDOW\_WIDTH}-2-8, (\textcolor{keywordtype}{int})\hyperlink{lspmac_8c_aeb09895663eff333b7a75acb319a9fc1}{flight}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position});
  mvwprintw( \hyperlink{pgpmac_8c_ae746a6903fb8a4ea216def88eccedc3c}{term\_status}, 5, 1, \textcolor{stringliteral}{"Back: %*u"}, \hyperlink{pgpmac_8h_a1f96754f00a1f82414cebc66f75ded78}{LS\_DISPLAY\_WINDOW\_WIDTH}
      -2-7,  (\textcolor{keywordtype}{int})\hyperlink{lspmac_8c_a85d6eaa4b4a82bb3112574f458d1dc50}{blight}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position});
  mvwprintw( \hyperlink{pgpmac_8c_ae746a6903fb8a4ea216def88eccedc3c}{term\_status}, 6, 1, \textcolor{stringliteral}{"Piezo: %*u"}, \hyperlink{pgpmac_8h_a1f96754f00a1f82414cebc66f75ded78}{
      LS\_DISPLAY\_WINDOW\_WIDTH}-2-8, (\textcolor{keywordtype}{int})\hyperlink{lspmac_8c_a8a3ca6fcf5e24dcc26170736843e53b2}{fscint}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position});
  wnoutrefresh( \hyperlink{pgpmac_8c_ae746a6903fb8a4ea216def88eccedc3c}{term\_status});

  wnoutrefresh( \hyperlink{pgpmac_8c_ab0487111dbe3c05d0bd835eb2fb9a3f7}{term\_input});
  doupdate();
  pthread\_mutex\_unlock( &\hyperlink{pgpmac_8c_ad128c64890c7c0d4f836d9ec6e99216a}{ncurses\_mutex});

  \textcolor{comment}{/*}
\textcolor{comment}{  if( ++cnt % 1000 == 0) \{}
\textcolor{comment}{    gettimeofday( &ts2, NULL);}
\textcolor{comment}{}
\textcolor{comment}{    lslogging\_log\_message( "Refresh Rate: %0.1f Hz", 1000000.*(cnt)/(ts2.tv\_sec
      *1000000 + ts2.tv\_usec - ts1.tv\_sec*1000000 - ts1.tv\_usec));}
\textcolor{comment}{}
\textcolor{comment}{    cnt = 0;}
\textcolor{comment}{  \}}
\textcolor{comment}{  */}
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_ac24bdffa893a9bf7c9cb084fe1417f6f}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-\-Get\-All\-I\-Vars@{lspmac\-\_\-\-Get\-All\-I\-Vars}}
\index{lspmac\-\_\-\-Get\-All\-I\-Vars@{lspmac\-\_\-\-Get\-All\-I\-Vars}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-\-Get\-All\-I\-Vars}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-\-Get\-All\-I\-Vars (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_ac24bdffa893a9bf7c9cb084fe1417f6f}


Request the values of all the I variables. 



Definition at line 1537 of file lspmac.\-c.


\begin{DoxyCode}
                          \{
  \textcolor{keyword}{static} \textcolor{keywordtype}{char} *cmds = \textcolor{stringliteral}{"I0..8191"};
  \hyperlink{lspmac_8c_a1e472a11df3765763c2fe92dd358bf0c}{lspmac\_send\_command}( \hyperlink{lspmac_8c_af24ecdc10723dc8fd6320fef416ae514}{VR\_DOWNLOAD}, 
      \hyperlink{lspmac_8c_a772b2ea2ad93989ae4275c79a93525ee}{VR\_PMAC\_SENDLINE}, 0, 0, strlen( cmds), cmds, 
      \hyperlink{lspmac_8c_add86d60f9d192563fc9a357dc90f7f75}{lspmac\_GetAllIVarsCB}, 0);
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_add86d60f9d192563fc9a357dc90f7f75}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-\-Get\-All\-I\-Vars\-C\-B@{lspmac\-\_\-\-Get\-All\-I\-Vars\-C\-B}}
\index{lspmac\-\_\-\-Get\-All\-I\-Vars\-C\-B@{lspmac\-\_\-\-Get\-All\-I\-Vars\-C\-B}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-\-Get\-All\-I\-Vars\-C\-B}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-\-Get\-All\-I\-Vars\-C\-B (
\begin{DoxyParamCaption}
\item[{{\bf pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$}]{cmd, }
\item[{int}]{nreceived, }
\item[{unsigned char $\ast$}]{buff}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_add86d60f9d192563fc9a357dc90f7f75}


Receive the values of all the I variables Update our Postgresql database with the results. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em cmd} & The command that gave this response \\
\hline
\mbox{\tt in}  & {\em nreceived} & Number of bytes received \\
\hline
\mbox{\tt in}  & {\em buff} & The byte buffer \\
\hline
\end{DoxyParams}


Definition at line 1520 of file lspmac.\-c.


\begin{DoxyCode}
                            \{
  \textcolor{keyword}{static} \textcolor{keywordtype}{char} qs[\hyperlink{pgpmac_8h_a3a8ef1b4b5994d6dd12bf74454ea891b}{LS\_PG\_QUERY\_STRING\_LENGTH}];
  \textcolor{keywordtype}{char} *sp;
  \textcolor{keywordtype}{int} i;
  \textcolor{keywordflow}{for}( i=0, sp=strtok(buff, \textcolor{stringliteral}{"\(\backslash\)r"}); sp != NULL; sp=strtok( NULL, \textcolor{stringliteral}{"\(\backslash\)r"}), i++) \{
    snprintf( qs, \textcolor{keyword}{sizeof}( qs)-1, \textcolor{stringliteral}{"SELECT pmac.md2\_ivar\_set( %d, '%s')"}, i, sp);
    qs[\textcolor{keyword}{sizeof}( qs)-1]=0;
    \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( NULL, qs);
  \}
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a983d291506dc387ba5d71a97766e8a25}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-\-Get\-All\-M\-Vars@{lspmac\-\_\-\-Get\-All\-M\-Vars}}
\index{lspmac\-\_\-\-Get\-All\-M\-Vars@{lspmac\-\_\-\-Get\-All\-M\-Vars}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-\-Get\-All\-M\-Vars}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-\-Get\-All\-M\-Vars (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a983d291506dc387ba5d71a97766e8a25}


Request the values of all the M variables. 



Definition at line 1562 of file lspmac.\-c.


\begin{DoxyCode}
                          \{
  \textcolor{keyword}{static} \textcolor{keywordtype}{char} *cmds = \textcolor{stringliteral}{"M0..8191->"};
  \hyperlink{lspmac_8c_a1e472a11df3765763c2fe92dd358bf0c}{lspmac\_send\_command}( \hyperlink{lspmac_8c_af24ecdc10723dc8fd6320fef416ae514}{VR\_DOWNLOAD}, 
      \hyperlink{lspmac_8c_a772b2ea2ad93989ae4275c79a93525ee}{VR\_PMAC\_SENDLINE}, 0, 0, strlen( cmds), cmds, 
      \hyperlink{lspmac_8c_ac585cd63a433c86843eb51b15017c3da}{lspmac\_GetAllMVarsCB}, 0);
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_ac585cd63a433c86843eb51b15017c3da}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-\-Get\-All\-M\-Vars\-C\-B@{lspmac\-\_\-\-Get\-All\-M\-Vars\-C\-B}}
\index{lspmac\-\_\-\-Get\-All\-M\-Vars\-C\-B@{lspmac\-\_\-\-Get\-All\-M\-Vars\-C\-B}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-\-Get\-All\-M\-Vars\-C\-B}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-\-Get\-All\-M\-Vars\-C\-B (
\begin{DoxyParamCaption}
\item[{{\bf pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$}]{cmd, }
\item[{int}]{nreceived, }
\item[{unsigned char $\ast$}]{buff}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_ac585cd63a433c86843eb51b15017c3da}


Receive the values of all the M variables Update our database with the results. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em cmd} & The command that started this \\
\hline
\mbox{\tt in}  & {\em nreceived} & Number of bytes received \\
\hline
\mbox{\tt in}  & {\em buff} & Our byte buffer \\
\hline
\end{DoxyParams}


Definition at line 1545 of file lspmac.\-c.


\begin{DoxyCode}
                            \{
  \textcolor{keyword}{static} \textcolor{keywordtype}{char} qs[\hyperlink{pgpmac_8h_a3a8ef1b4b5994d6dd12bf74454ea891b}{LS\_PG\_QUERY\_STRING\_LENGTH}];
  \textcolor{keywordtype}{char} *sp;
  \textcolor{keywordtype}{int} i;
  \textcolor{keywordflow}{for}( i=0, sp=strtok(buff, \textcolor{stringliteral}{"\(\backslash\)r"}); sp != NULL; sp=strtok( NULL, \textcolor{stringliteral}{"\(\backslash\)r"}), i++) \{
    snprintf( qs, \textcolor{keyword}{sizeof}( qs)-1, \textcolor{stringliteral}{"SELECT pmac.md2\_mvar\_set( %d, '%s')"}, i, sp);
    qs[\textcolor{keyword}{sizeof}( qs)-1]=0;
    \hyperlink{lspg_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( NULL, qs);
  \}
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a825ba2feb0108b977c34872e24a6c827}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-\-Getmem@{lspmac\-\_\-\-Getmem}}
\index{lspmac\-\_\-\-Getmem@{lspmac\-\_\-\-Getmem}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-\-Getmem}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-\-Getmem (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a825ba2feb0108b977c34872e24a6c827}


Request a block of double buffer memory. 



Definition at line 986 of file lspmac.\-c.


\begin{DoxyCode}
                     \{
  \textcolor{keywordtype}{int} nbytes;
  nbytes = (\hyperlink{lspmac_8c_aa0be2f26364c4d12c9c81c10913f0b26}{dbmemIn} + 1400 > \textcolor{keyword}{sizeof}( \hyperlink{lspmac_8c_a9da2795d11ccbc3a060c4811770ad04c}{dbmem})) ? \textcolor{keyword}{sizeof}( \hyperlink{lspmac_8c_a9da2795d11ccbc3a060c4811770ad04c}{dbmem}) 
      - \hyperlink{lspmac_8c_aa0be2f26364c4d12c9c81c10913f0b26}{dbmemIn} : 1400;
  \hyperlink{lspmac_8c_a0a56c777b1469ad8c3d29d825a71e300}{lspmac\_SockGetmem}( \hyperlink{lspmac_8c_aa0be2f26364c4d12c9c81c10913f0b26}{dbmemIn}, nbytes);
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_aaa3323f952efd66e63ff864932da5ced}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-\-Getmem\-Reply\-C\-B@{lspmac\-\_\-\-Getmem\-Reply\-C\-B}}
\index{lspmac\-\_\-\-Getmem\-Reply\-C\-B@{lspmac\-\_\-\-Getmem\-Reply\-C\-B}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-\-Getmem\-Reply\-C\-B}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-\-Getmem\-Reply\-C\-B (
\begin{DoxyParamCaption}
\item[{{\bf pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$}]{cmd, }
\item[{int}]{nreceived, }
\item[{unsigned char $\ast$}]{buff}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_aaa3323f952efd66e63ff864932da5ced}


Service a reply to the getmem command. 

Not currently used. 
\begin{DoxyParams}{Parameters}
{\em cmd} & Queue item this is a reply to \\
\hline
{\em nreceived} & Number of bytes received \\
\hline
{\em buff} & Buffer of bytes recieved \\
\hline
\end{DoxyParams}


Definition at line 917 of file lspmac.\-c.


\begin{DoxyCode}
                                                                               
             \{

  memcpy( &(\hyperlink{lspmac_8c_a9da2795d11ccbc3a060c4811770ad04c}{dbmem}[ntohs(cmd->\hyperlink{structlspmac__cmd__queue__struct_a9ac7618bbe0faa3001e8efeb1d89010d}{pcmd}.\hyperlink{structtagEthernetCmd_aec0ee9a5f6c7e3bc6e4bd98f1bd52783}{wValue})]), buff, nreceived);

  \hyperlink{lspmac_8c_aa0be2f26364c4d12c9c81c10913f0b26}{dbmemIn} += nreceived;
  \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_aa0be2f26364c4d12c9c81c10913f0b26}{dbmemIn} >= \textcolor{keyword}{sizeof}( \hyperlink{lspmac_8c_a9da2795d11ccbc3a060c4811770ad04c}{dbmem})) \{
    \hyperlink{lspmac_8c_aa0be2f26364c4d12c9c81c10913f0b26}{dbmemIn} = 0;
  \}
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_ac89b615b3ecb738c902c3c090d7c1dc3}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-\-Get\-Short\-Reply\-C\-B@{lspmac\-\_\-\-Get\-Short\-Reply\-C\-B}}
\index{lspmac\-\_\-\-Get\-Short\-Reply\-C\-B@{lspmac\-\_\-\-Get\-Short\-Reply\-C\-B}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-\-Get\-Short\-Reply\-C\-B}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-\-Get\-Short\-Reply\-C\-B (
\begin{DoxyParamCaption}
\item[{{\bf pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$}]{cmd, }
\item[{int}]{nreceived, }
\item[{unsigned char $\ast$}]{buff}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_ac89b615b3ecb738c902c3c090d7c1dc3}


Receive a reply that does not require multiple buffers. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em cmd} & Queue item this is a reply to \\
\hline
\mbox{\tt in}  & {\em nreceived} & Number of bytes received \\
\hline
\mbox{\tt in}  & {\em buff} & The buffer of bytes \\
\hline
\end{DoxyParams}


Definition at line 859 of file lspmac.\-c.


\begin{DoxyCode}
                              \{

  \textcolor{keywordtype}{char} *sp;     \textcolor{comment}{// pointer to the command this is a reply to}

  \textcolor{keywordflow}{if}( nreceived < 1400)
    buff[nreceived]=0;

  sp = (\textcolor{keywordtype}{char} *)(cmd->\hyperlink{structlspmac__cmd__queue__struct_a9ac7618bbe0faa3001e8efeb1d89010d}{pcmd}.\hyperlink{structtagEthernetCmd_a872dab798127d6f589974a79c5d0aef1}{bData});

  \textcolor{keywordflow}{if}( *buff == 0) \{
    pthread\_mutex\_lock( &\hyperlink{pgpmac_8c_ad128c64890c7c0d4f836d9ec6e99216a}{ncurses\_mutex});
    wprintw( \hyperlink{pgpmac_8c_a65daf0f4a5bc6def23a9df98ff5ca57e}{term\_output}, \textcolor{stringliteral}{"%s\(\backslash\)n"}, sp);
    pthread\_mutex\_unlock( &\hyperlink{pgpmac_8c_ad128c64890c7c0d4f836d9ec6e99216a}{ncurses\_mutex});
  \} \textcolor{keywordflow}{else} \{
    pthread\_mutex\_lock( &\hyperlink{pgpmac_8c_ad128c64890c7c0d4f836d9ec6e99216a}{ncurses\_mutex});
    wprintw( \hyperlink{pgpmac_8c_a65daf0f4a5bc6def23a9df98ff5ca57e}{term\_output}, \textcolor{stringliteral}{"%s: "}, sp);
    pthread\_mutex\_unlock( &\hyperlink{pgpmac_8c_ad128c64890c7c0d4f836d9ec6e99216a}{ncurses\_mutex});
    \hyperlink{lspmac_8c_a8f9f1ad624350095075aa6b51423b02d}{cleanstr}( buff);
  \}
  wnoutrefresh( \hyperlink{pgpmac_8c_a65daf0f4a5bc6def23a9df98ff5ca57e}{term\_output});
  wnoutrefresh( \hyperlink{pgpmac_8c_ab0487111dbe3c05d0bd835eb2fb9a3f7}{term\_input});
  doupdate();

  memset( cmd->\hyperlink{structlspmac__cmd__queue__struct_a9ac7618bbe0faa3001e8efeb1d89010d}{pcmd}.\hyperlink{structtagEthernetCmd_a872dab798127d6f589974a79c5d0aef1}{bData}, 0, \textcolor{keyword}{sizeof}( cmd->\hyperlink{structlspmac__cmd__queue__struct_a9ac7618bbe0faa3001e8efeb1d89010d}{pcmd}.\hyperlink{structtagEthernetCmd_a872dab798127d6f589974a79c5d0aef1}{bData}));
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a9fbadf816a842c8f131cf8ee47b54e29}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-home1\-\_\-queue@{lspmac\-\_\-home1\-\_\-queue}}
\index{lspmac\-\_\-home1\-\_\-queue@{lspmac\-\_\-home1\-\_\-queue}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-home1\-\_\-queue}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-home1\-\_\-queue (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{mp}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a9fbadf816a842c8f131cf8ee47b54e29}


Homing method for steppers and servos. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em mp} & motor we are concerned about \\
\hline
\end{DoxyParams}


Definition at line 1090 of file lspmac.\-c.


\begin{DoxyCode}
                         \{
  \textcolor{keywordtype}{char} openloops[32];
  \textcolor{keywordtype}{char} *sp;
  \textcolor{keywordtype}{int} i;

  pthread\_mutex\_lock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));

  
  \textcolor{comment}{// We got here before the initialization routine finished}
  \textcolor{comment}{// TODO: arrange to retry or at least indicated we haven't run}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( (mp->\hyperlink{structlspmac__motor__struct_af11e5f75c1cf88ed6842d04154d27a31}{lspg\_initialized} & 1) == 0) \{
    pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
    \textcolor{keywordflow}{return};
  \}    


  \textcolor{comment}{// Each of the motors should have this defined}
  \textcolor{comment}{// but let's not seg fault if home is missing}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a073246b8878d75615b0536301b343f3d}{home} == NULL || *(mp->\hyperlink{structlspmac__motor__struct_a073246b8878d75615b0536301b343f3d}{home}) == NULL) \{
    \textcolor{comment}{//}
    \textcolor{comment}{// Note we are already initialized}
    \textcolor{comment}{// so if we are here there is something wrong.}
    \textcolor{comment}{// TODO: log this event}
    pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
    \textcolor{keywordflow}{return};
  \}

  \textcolor{comment}{// We've already been called.  Don't home again until}
  \textcolor{comment}{// we're finish with the last time.}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_aa74108855693f94fc2ff76333c9fb6ac}{homing}) \{
    pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
    \textcolor{keywordflow}{return};
  \}    


  \textcolor{comment}{//}
  \textcolor{comment}{// Don't go on if any other motors in this coordinate system are homing.}
  \textcolor{comment}{// It's possible to write the homing program to home all the motors in the
       coordinate}
  \textcolor{comment}{// system.}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a2093b0a3cd2f9500fd92e3c89bf46577}{coord\_num} > 0) \{
    \textcolor{keywordflow}{for}( i=0; i<\hyperlink{lspmac_8c_a56260f012c50a591ee7f97e500f16994}{lspmac\_nmotors}; i++) \{
      \textcolor{keywordflow}{if}( &(\hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}[i]) == mp)
        \textcolor{keywordflow}{continue};
      \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}[i].coord\_num == mp->\hyperlink{structlspmac__motor__struct_a2093b0a3cd2f9500fd92e3c89bf46577}{coord\_num}) \{
        \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}[i].homing) \{
          pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
          \textcolor{keywordflow}{return};
        \}
      \}
    \}
  \}
  mp->\hyperlink{structlspmac__motor__struct_aa74108855693f94fc2ff76333c9fb6ac}{homing} = 1;
       
  \textcolor{comment}{// This opens the control loop.}
  \textcolor{comment}{// The status routine should notice this and the fact that}
  \textcolor{comment}{// the homing flag is set and call on the home2 routine}
  \textcolor{comment}{//}
  \textcolor{comment}{// Only send the open loop command if we are not in}
  \textcolor{comment}{// open loop mode already.  This test might prevent a race condition}
  \textcolor{comment}{// where we've already moved the home2 routine (and queue the homing program
       motion)}
  \textcolor{comment}{// before the open loop command is dequeued and acted on.}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( ~(mp->\hyperlink{structlspmac__motor__struct_acb52b612b9237e8eec0b97fb1e76a35d}{status1}) & 0x040000) \{
    snprintf( openloops, \textcolor{keyword}{sizeof}(openloops)-1, \textcolor{stringliteral}{"#%d$*"}, mp->\hyperlink{structlspmac__motor__struct_a45fae17618f0c0827e97060dc04f79cb}{motor\_num});
    openloops[\textcolor{keyword}{sizeof}(openloops)-1] = 0;
    \hyperlink{lspmac_8c_aaa442d9bc7a3cdee39adea0724f0e18c}{lspmac\_SockSendline}( openloops);
  \}

  pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a43e54631dc8de372854ebbb63ff28f70}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-home2\-\_\-queue@{lspmac\-\_\-home2\-\_\-queue}}
\index{lspmac\-\_\-home2\-\_\-queue@{lspmac\-\_\-home2\-\_\-queue}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-home2\-\_\-queue}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-home2\-\_\-queue (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{mp}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a43e54631dc8de372854ebbb63ff28f70}


Second stage of homing. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em mp} & motor we are concerned about \\
\hline
\end{DoxyParams}


Definition at line 1170 of file lspmac.\-c.


\begin{DoxyCode}
                         \{

  \textcolor{keywordtype}{char} **spp;

  \textcolor{comment}{//}
  \textcolor{comment}{// At this point we are in open loop.}
  \textcolor{comment}{// Run the motor specific commands}
  \textcolor{comment}{//}

  pthread\_mutex\_lock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
  \textcolor{comment}{//}
  \textcolor{comment}{// We don't have any motors that have a null home text array so }
  \textcolor{comment}{// there is currently no need to worry about this case other than}
  \textcolor{comment}{// not to seg fault}
  \textcolor{comment}{//}
  \textcolor{comment}{// Also, Only go on if the first homing phase has been started}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a073246b8878d75615b0536301b343f3d}{home} == NULL || mp->\hyperlink{structlspmac__motor__struct_aa74108855693f94fc2ff76333c9fb6ac}{homing} != 1) \{
    pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
    \textcolor{keywordflow}{return};
  \}

  \textcolor{keywordflow}{for}( spp = mp->\hyperlink{structlspmac__motor__struct_a073246b8878d75615b0536301b343f3d}{home}; *spp != NULL; spp++) \{

    pthread\_mutex\_lock( &\hyperlink{pgpmac_8c_ad128c64890c7c0d4f836d9ec6e99216a}{ncurses\_mutex});
    wprintw( \hyperlink{pgpmac_8c_a65daf0f4a5bc6def23a9df98ff5ca57e}{term\_output}, \textcolor{stringliteral}{"home2 is queuing '%s'\(\backslash\)n"}, *spp);
    wnoutrefresh( \hyperlink{pgpmac_8c_a65daf0f4a5bc6def23a9df98ff5ca57e}{term\_output});
    doupdate();
    pthread\_mutex\_unlock( &\hyperlink{pgpmac_8c_ad128c64890c7c0d4f836d9ec6e99216a}{ncurses\_mutex});

    \hyperlink{lspmac_8c_aaa442d9bc7a3cdee39adea0724f0e18c}{lspmac\_SockSendline}( *spp);
  \}

  mp->\hyperlink{structlspmac__motor__struct_aa74108855693f94fc2ff76333c9fb6ac}{homing} = 2;
  pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
  
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a236945579e57dbb30c0b64f5b9184e9d}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-init@{lspmac\-\_\-init}}
\index{lspmac\-\_\-init@{lspmac\-\_\-init}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-init (
\begin{DoxyParamCaption}
\item[{int}]{ivarsflag, }
\item[{int}]{mvarsflag}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a236945579e57dbb30c0b64f5b9184e9d}


Initialize this module. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em ivarsflag} & Set global flag to harvest i variables \\
\hline
\mbox{\tt in}  & {\em mvarsflag} & Set global flag to harvest m variables \\
\hline
\end{DoxyParams}


Definition at line 2100 of file lspmac.\-c.


\begin{DoxyCode}
                   \{
  \hyperlink{structmd2StatusStruct}{md2\_status\_t} *p;

  \textcolor{comment}{// Set our global harvest flags}
  \hyperlink{lspmac_8c_a07b7b8254772075e6a4ced500b589c36}{getivars} = ivarsflag;
  \hyperlink{lspmac_8c_a50e9c0a06654fd81b3446a6e54ff12c3}{getmvars} = mvarsflag;

  \textcolor{comment}{// All important status mutex}
  pthread\_mutex\_init( &\hyperlink{lspmac_8c_a7a3e763682bd7f987d07f149e94b3bf8}{md2\_status\_mutex}, NULL);

  \textcolor{comment}{//}
  \textcolor{comment}{// Initialize the motor objects}
  \textcolor{comment}{//}

  p = &\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status};

  \hyperlink{lspmac_8c_a8237e646ce032a840637a4ef7bff49b9}{omega}  = \hyperlink{lspmac_8c_a45becc46f46e5aea14a388d3ec1b8b13}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}
      [ 0]),  1, 0, 0, &p->\hyperlink{structmd2StatusStruct_a6ce303bec89082cae1e9b1fddf6b6c10}{omega\_act\_pos},     &p->\hyperlink{structmd2StatusStruct_af6cf3cd65b9ef205685a0d970f168907}{omega\_status\_1}
      ,     &p->\hyperlink{structmd2StatusStruct_a8577c9df7b663b548b2759ac3db721cd}{omega\_status\_2},     \textcolor{stringliteral}{"Omega   #1 &1 X"}, \textcolor{stringliteral}{"omega"},       
      \hyperlink{lspmac_8c_aa4ea5a4c387ef167702c58eaddcb4151}{lspmac\_moveabs\_queue});
  \hyperlink{lspmac_8c_a6cb218bdccfe5a93471c161f15a15cab}{alignx} = \hyperlink{lspmac_8c_a45becc46f46e5aea14a388d3ec1b8b13}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}
      [ 1]),  2, 0, 1, &p->\hyperlink{structmd2StatusStruct_a9653a75bc0b66c5f86d8b0206dc39b4f}{alignx\_act\_pos},    &p->\hyperlink{structmd2StatusStruct_a56accf8cb00c59bff87ed75df7dafbbe}{alignx\_status\_1}
      ,    &p->\hyperlink{structmd2StatusStruct_a2feb35ceab8129fd2cc34d1104af8b8f}{alignx\_status\_2},    \textcolor{stringliteral}{"Align X #2 &3 X"}, \textcolor{stringliteral}{"align.x"},     
      \hyperlink{lspmac_8c_aa4ea5a4c387ef167702c58eaddcb4151}{lspmac\_moveabs\_queue});
  \hyperlink{lspmac_8c_a737c246c3948e644a18d191a931e1acd}{aligny} = \hyperlink{lspmac_8c_a45becc46f46e5aea14a388d3ec1b8b13}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}
      [ 2]),  3, 0, 2, &p->\hyperlink{structmd2StatusStruct_a0d40a01d2aa93c443526e826440f77fc}{aligny\_act\_pos},    &p->\hyperlink{structmd2StatusStruct_a2f2a11fe2fc7a446323def2be465185a}{aligny\_status\_1}
      ,    &p->\hyperlink{structmd2StatusStruct_a1f98d8b9831e32d77129f9b0f1d7d255}{aligny\_status\_2},    \textcolor{stringliteral}{"Align Y #3 &3 Y"}, \textcolor{stringliteral}{"align.y"},     
      \hyperlink{lspmac_8c_aa4ea5a4c387ef167702c58eaddcb4151}{lspmac\_moveabs\_queue});
  \hyperlink{lspmac_8c_ae7642b1da0f7c7f8448104c691d40a12}{alignz} = \hyperlink{lspmac_8c_a45becc46f46e5aea14a388d3ec1b8b13}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}
      [ 3]),  4, 0, 3, &p->\hyperlink{structmd2StatusStruct_a480f892fe91b05b2980fb00064807e2b}{alignz\_act\_pos},    &p->\hyperlink{structmd2StatusStruct_aadbfac5709de57e449a37e2937d6ade7}{alignz\_status\_1}
      ,    &p->\hyperlink{structmd2StatusStruct_ac378da16eeaab2bc47f3f8f88f7411ed}{alignz\_status\_2},    \textcolor{stringliteral}{"Align Z #4 &3 Z"}, \textcolor{stringliteral}{"align.z"},     
      \hyperlink{lspmac_8c_aa4ea5a4c387ef167702c58eaddcb4151}{lspmac\_moveabs\_queue});
  \hyperlink{lspmac_8c_aa90d2363b744acbd4d45133b7a716d8f}{anal}   = \hyperlink{lspmac_8c_a45becc46f46e5aea14a388d3ec1b8b13}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}
      [ 4]),  5, 0, 4, &p->\hyperlink{structmd2StatusStruct_a49d1151b0e819646587be0ca9c9d612a}{analyzer\_act\_pos},  &p->\hyperlink{structmd2StatusStruct_ab876b484f55bcce576fcd89dcc3f7267}{analyzer\_status\_1}
      ,  &p->\hyperlink{structmd2StatusStruct_a4f88bb778e4e18f1fbf7672ac11e7433}{analyzer\_status\_2},  \textcolor{stringliteral}{"Anal    #5"},      \textcolor{stringliteral}{"lightPolar"},  
      \hyperlink{lspmac_8c_aa4ea5a4c387ef167702c58eaddcb4151}{lspmac\_moveabs\_queue});
  \hyperlink{lspmac_8c_ad53a42cfaa04eff0336a44c8c9986333}{zoom}   = \hyperlink{lspmac_8c_a45becc46f46e5aea14a388d3ec1b8b13}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}
      [ 5]),  6, 1, 0, &p->\hyperlink{structmd2StatusStruct_a920b80e9f5f08aedac3ad541d5ffc8ae}{zoom\_act\_pos},      &p->\hyperlink{structmd2StatusStruct_af28e978b761dc07eefed3971547cfd4d}{zoom\_status\_1}
      ,      &p->\hyperlink{structmd2StatusStruct_a34e4200315a083deb8a970e21bbbe277}{zoom\_status\_2},      \textcolor{stringliteral}{"Zoom    #6 &4 Z"}, \textcolor{stringliteral}{"zoom"},        
      \hyperlink{lspmac_8c_ad6ae1e37afd118f24ab1c6878da53878}{lspmac\_movezoom\_queue});
  \hyperlink{lspmac_8c_a139200ddaa9856a7ffcec0e6cbaa8f1b}{apery}  = \hyperlink{lspmac_8c_a45becc46f46e5aea14a388d3ec1b8b13}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}
      [ 6]),  7, 1, 1, &p->\hyperlink{structmd2StatusStruct_a2a434d2b57dbb669de0765486a1516ff}{aperturey\_act\_pos}, &p->\hyperlink{structmd2StatusStruct_a2ef953eaddf7058bf4276585e6ff066b}{aperturey\_status\_1}
      , &p->\hyperlink{structmd2StatusStruct_a0a7738f13a0fa80626cafc2299b104b4}{aperturey\_status\_2}, \textcolor{stringliteral}{"Aper Y  #7 &5 Y"}, \textcolor{stringliteral}{"appy"},        
      \hyperlink{lspmac_8c_aa4ea5a4c387ef167702c58eaddcb4151}{lspmac\_moveabs\_queue});
  \hyperlink{lspmac_8c_ab93bd6ee850b285ca3a95e64d15e9477}{aperz}  = \hyperlink{lspmac_8c_a45becc46f46e5aea14a388d3ec1b8b13}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}
      [ 7]),  8, 1, 2, &p->\hyperlink{structmd2StatusStruct_a62d584ce23cfd9aa626d3c03649b455c}{aperturez\_act\_pos}, &p->\hyperlink{structmd2StatusStruct_a27880dd795e1ba4fea4870c64ee3aa84}{aperturez\_status\_1}
      , &p->\hyperlink{structmd2StatusStruct_ae407a99e428d9f4a7444a02c8bc3414e}{aperturez\_status\_2}, \textcolor{stringliteral}{"Aper Z  #8 &5 Z"}, \textcolor{stringliteral}{"appz"},        
      \hyperlink{lspmac_8c_aa4ea5a4c387ef167702c58eaddcb4151}{lspmac\_moveabs\_queue});
  \hyperlink{lspmac_8c_a51358daaea8b5236f08414877d8af6c2}{capy}   = \hyperlink{lspmac_8c_a45becc46f46e5aea14a388d3ec1b8b13}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}
      [ 8]),  9, 1, 3, &p->\hyperlink{structmd2StatusStruct_ae25122a6db146501b51609b9cb59b044}{capy\_act\_pos},      &p->\hyperlink{structmd2StatusStruct_a7f4e945e80b1980b9e69366a69ad79cc}{capy\_status\_1}
      ,      &p->\hyperlink{structmd2StatusStruct_a5d7c10d9a16ebcc53ac4a0770ab2ef62}{capy\_status\_2},      \textcolor{stringliteral}{"Cap Y   #9 &5 U"}, \textcolor{stringliteral}{"capy"},        
      \hyperlink{lspmac_8c_aa4ea5a4c387ef167702c58eaddcb4151}{lspmac\_moveabs\_queue});
  \hyperlink{lspmac_8c_aa45f268d0af9f3d465acfab128919718}{capz}   = \hyperlink{lspmac_8c_a45becc46f46e5aea14a388d3ec1b8b13}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}
      [ 9]), 10, 1, 4, &p->\hyperlink{structmd2StatusStruct_a257c04efac3a33d5d34b21d64c6f1266}{capz\_act\_pos},      &p->\hyperlink{structmd2StatusStruct_a719db4477f35331eaa8b7b44150e88a2}{capz\_status\_1}
      ,      &p->\hyperlink{structmd2StatusStruct_a3abb998bb89433aed16121d0dae6275a}{capz\_status\_2},      \textcolor{stringliteral}{"Cap Z  #10 &5 V"}, \textcolor{stringliteral}{"capz"},        
      \hyperlink{lspmac_8c_aa4ea5a4c387ef167702c58eaddcb4151}{lspmac\_moveabs\_queue});
  \hyperlink{lspmac_8c_ac0eeaffa0996271d8a38344a470d13d7}{scinz}  = \hyperlink{lspmac_8c_a45becc46f46e5aea14a388d3ec1b8b13}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}
      [10]), 11, 2, 0, &p->\hyperlink{structmd2StatusStruct_a1c146fc792c4285eed5b2c446c214f98}{scint\_act\_pos},     &p->\hyperlink{structmd2StatusStruct_a1723870357f428ac5c2758a2c9a475c7}{scint\_status\_1}
      ,     &p->\hyperlink{structmd2StatusStruct_a4e5bc72e2f4007370f1c29ea272c952f}{scint\_status\_2},     \textcolor{stringliteral}{"Scin Z #11 &5 W"}, \textcolor{stringliteral}{"scint"},       
      \hyperlink{lspmac_8c_aa4ea5a4c387ef167702c58eaddcb4151}{lspmac\_moveabs\_queue});
  \hyperlink{lspmac_8c_ac940d950d9efeaf3f0ae67e9bf331188}{cenx}   = \hyperlink{lspmac_8c_a45becc46f46e5aea14a388d3ec1b8b13}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}
      [11]), 17, 2, 1, &p->\hyperlink{structmd2StatusStruct_ae7924b6e91e1de82f6f7910cb3a9c9bd}{centerx\_act\_pos},   &p->\hyperlink{structmd2StatusStruct_aa619cdbd7a563408c6b825ddc4f74ebb}{centerx\_status\_1}
      ,   &p->\hyperlink{structmd2StatusStruct_ae4fad6debe138ed7815d463e83f8d0f6}{centerx\_status\_2},   \textcolor{stringliteral}{"Cen X  #17 &2 X"}, \textcolor{stringliteral}{"centering.x"}, 
      \hyperlink{lspmac_8c_aa4ea5a4c387ef167702c58eaddcb4151}{lspmac\_moveabs\_queue});
  \hyperlink{lspmac_8c_aaed18e738ba7bfb6c771a44f5d7ea827}{ceny}   = \hyperlink{lspmac_8c_a45becc46f46e5aea14a388d3ec1b8b13}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}
      [12]), 18, 2, 2, &p->\hyperlink{structmd2StatusStruct_a6be71a92a599d490ca808af8c7e7faa0}{centery\_act\_pos},   &p->\hyperlink{structmd2StatusStruct_a57f65ebe28ef88f1c632d9f35d9167eb}{centery\_status\_1}
      ,   &p->\hyperlink{structmd2StatusStruct_aa242098c185cce8f852cd6e081ef0b1d}{centery\_status\_2},   \textcolor{stringliteral}{"Cen Y  #18 &2 Y"}, \textcolor{stringliteral}{"centering.y"}, 
      \hyperlink{lspmac_8c_aa4ea5a4c387ef167702c58eaddcb4151}{lspmac\_moveabs\_queue});
  \hyperlink{lspmac_8c_a0be79ccb7ebf3a665248fd856112b9fd}{kappa}  = \hyperlink{lspmac_8c_a45becc46f46e5aea14a388d3ec1b8b13}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}
      [13]), 19, 2, 3, &p->\hyperlink{structmd2StatusStruct_ac384fb7073387dd5dcb2e85a00ec8a77}{kappa\_act\_pos},     &p->\hyperlink{structmd2StatusStruct_ab152694bc32d37c1d180f55e8d282020}{kappa\_status\_1}
      ,     &p->\hyperlink{structmd2StatusStruct_af6891f5f8dcfc62668f64c583042c6bc}{kappa\_status\_2},     \textcolor{stringliteral}{"Kappa  #19 &7 X"}, \textcolor{stringliteral}{"kappa"},       
      \hyperlink{lspmac_8c_aa4ea5a4c387ef167702c58eaddcb4151}{lspmac\_moveabs\_queue});
  \hyperlink{lspmac_8c_ac8070dc568ad974a3db42b51eca828cc}{phi}    = \hyperlink{lspmac_8c_a45becc46f46e5aea14a388d3ec1b8b13}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}[
      14]), 20, 2, 4, &p->\hyperlink{structmd2StatusStruct_a4de22995a72ff6e72a1a9ccab6d00620}{phi\_act\_pos},       &p->\hyperlink{structmd2StatusStruct_ad8b8fd90ffff43016e2adaab5ccbfa02}{phi\_status\_1}, 
            &p->\hyperlink{structmd2StatusStruct_a0e6cea4c32cb34e602b9ac3d21259219}{phi\_status\_2},       \textcolor{stringliteral}{"Phi    #20 &7 Y"}, \textcolor{stringliteral}{"phi"},         
      \hyperlink{lspmac_8c_aa4ea5a4c387ef167702c58eaddcb4151}{lspmac\_moveabs\_queue});

  \hyperlink{lspmac_8c_a26dec4623af9beed912b8e7e6f99822c}{fshut}  = \hyperlink{lspmac_8c_a40aa4aeb5c799a6a3a089137da4fd6a8}{lspmac\_fshut\_init}( &(\hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}
      [15]));
  \hyperlink{lspmac_8c_aeb09895663eff333b7a75acb319a9fc1}{flight} = \hyperlink{lspmac_8c_a6d88f6db90e4a7219a237b183d10a27d}{lspmac\_dac\_init}( &(\hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}[1
      6]), &p->\hyperlink{structmd2StatusStruct_a3be73c48b09190241a2bcb801af5b97c}{front\_dac},   160.0, \textcolor{stringliteral}{"M1200"}, \textcolor{stringliteral}{"frontLight.intensity"});
  \hyperlink{lspmac_8c_a85d6eaa4b4a82bb3112574f458d1dc50}{blight} = \hyperlink{lspmac_8c_a6d88f6db90e4a7219a237b183d10a27d}{lspmac\_dac\_init}( &(\hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}[1
      7]), &p->\hyperlink{structmd2StatusStruct_a33ce490348c8de255cf49b96469d3d4e}{back\_dac},    160.0, \textcolor{stringliteral}{"M1201"}, \textcolor{stringliteral}{"backLight.intensity"});
  \hyperlink{lspmac_8c_a8a3ca6fcf5e24dcc26170736843e53b2}{fscint} = \hyperlink{lspmac_8c_a6d88f6db90e4a7219a237b183d10a27d}{lspmac\_dac\_init}( &(\hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}[1
      8]), &p->\hyperlink{structmd2StatusStruct_a031be48adfa016c637d6eae49054c435}{scint\_piezo}, 320.0, \textcolor{stringliteral}{"M1203"}, \textcolor{stringliteral}{"scint.focus"});

  \hyperlink{lspmac_8c_af813a2eff0b7efa4c70633559054e84c}{blight\_ud} = \hyperlink{lspmac_8c_a50e22adfb4d14499c1f5647458ca2ad9}{lspmac\_bio\_init}( &(\hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}
      [19]), \textcolor{stringliteral}{"backLight"}, \textcolor{stringliteral}{"M1101=%d"}, &(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_ab09c1342dc12052b8f5b35f78ef95000}{acc11c\_5}), 0x02);
  \hyperlink{lspmac_8c_ae78d9a757d4c85419fff9c94b15e25d7}{cryo}      = \hyperlink{lspmac_8c_a50e22adfb4d14499c1f5647458ca2ad9}{lspmac\_bio\_init}( &(\hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}[
      20]), \textcolor{stringliteral}{"cryo"},      \textcolor{stringliteral}{"M1102=%d"}, &(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_a69fc2e30a5de0a11c992d133e7a761cd}{acc11c\_1}), 0x40);
  \hyperlink{lspmac_8c_a9d9c5030d817483ca9518027c91adac4}{dryer}     = \hyperlink{lspmac_8c_a50e22adfb4d14499c1f5647458ca2ad9}{lspmac\_bio\_init}( &(\hyperlink{lspmac_8c_a9bffbf72495499b505543cd942f665da}{lspmac\_motors}
      [21]), \textcolor{stringliteral}{"dryer"},     \textcolor{stringliteral}{"M1103=%d"}, &(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_ab09c1342dc12052b8f5b35f78ef95000}{acc11c\_5}), 0x08);




  \textcolor{comment}{//}
  \textcolor{comment}{// Initialize several commands that get called, perhaps, alot}
  \textcolor{comment}{//}
  \hyperlink{lspmac_8c_a6fcbbe47fe9912533962601f5befdb29}{rr\_cmd}.\hyperlink{structtagEthernetCmd_a6a155eb3ae546dd29369c4a33ddb3310}{RequestType} = \hyperlink{lspmac_8c_a5485d08fdc80533b5cebadff63696ed2}{VR\_UPLOAD};
  \hyperlink{lspmac_8c_a6fcbbe47fe9912533962601f5befdb29}{rr\_cmd}.\hyperlink{structtagEthernetCmd_a0dc566e7edbb226f1a4ea443d93d56e2}{Request}     = \hyperlink{lspmac_8c_aad3c7b4a9403e56c09eceadcf21252c0}{VR\_PMAC\_READREADY};
  \hyperlink{lspmac_8c_a6fcbbe47fe9912533962601f5befdb29}{rr\_cmd}.\hyperlink{structtagEthernetCmd_aec0ee9a5f6c7e3bc6e4bd98f1bd52783}{wValue}      = 0;
  \hyperlink{lspmac_8c_a6fcbbe47fe9912533962601f5befdb29}{rr\_cmd}.\hyperlink{structtagEthernetCmd_a92f5a374e87d4f496b64b4888850d6e6}{wIndex}      = 0;
  \hyperlink{lspmac_8c_a6fcbbe47fe9912533962601f5befdb29}{rr\_cmd}.\hyperlink{structtagEthernetCmd_af5df25ff13ca30fa33719d0df1ab7e97}{wLength}     = htons(2);
  memset( \hyperlink{lspmac_8c_a6fcbbe47fe9912533962601f5befdb29}{rr\_cmd}.\hyperlink{structtagEthernetCmd_a872dab798127d6f589974a79c5d0aef1}{bData}, 0, \textcolor{keyword}{sizeof}(\hyperlink{lspmac_8c_a6fcbbe47fe9912533962601f5befdb29}{rr\_cmd}.\hyperlink{structtagEthernetCmd_a872dab798127d6f589974a79c5d0aef1}{bData}));

  \hyperlink{lspmac_8c_ae7b21213b9c78b6745213409f1ef7320}{gb\_cmd}.\hyperlink{structtagEthernetCmd_a6a155eb3ae546dd29369c4a33ddb3310}{RequestType} = \hyperlink{lspmac_8c_a5485d08fdc80533b5cebadff63696ed2}{VR\_UPLOAD};
  \hyperlink{lspmac_8c_ae7b21213b9c78b6745213409f1ef7320}{gb\_cmd}.\hyperlink{structtagEthernetCmd_a0dc566e7edbb226f1a4ea443d93d56e2}{Request}     = \hyperlink{lspmac_8c_a50e444b5ceb6d62a1be43c88c55c549c}{VR\_PMAC\_GETBUFFER};
  \hyperlink{lspmac_8c_ae7b21213b9c78b6745213409f1ef7320}{gb\_cmd}.\hyperlink{structtagEthernetCmd_aec0ee9a5f6c7e3bc6e4bd98f1bd52783}{wValue}      = 0;
  \hyperlink{lspmac_8c_ae7b21213b9c78b6745213409f1ef7320}{gb\_cmd}.\hyperlink{structtagEthernetCmd_a92f5a374e87d4f496b64b4888850d6e6}{wIndex}      = 0;
  \hyperlink{lspmac_8c_ae7b21213b9c78b6745213409f1ef7320}{gb\_cmd}.\hyperlink{structtagEthernetCmd_af5df25ff13ca30fa33719d0df1ab7e97}{wLength}     = htons(1400);
  memset( \hyperlink{lspmac_8c_ae7b21213b9c78b6745213409f1ef7320}{gb\_cmd}.\hyperlink{structtagEthernetCmd_a872dab798127d6f589974a79c5d0aef1}{bData}, 0, \textcolor{keyword}{sizeof}(\hyperlink{lspmac_8c_ae7b21213b9c78b6745213409f1ef7320}{gb\_cmd}.\hyperlink{structtagEthernetCmd_a872dab798127d6f589974a79c5d0aef1}{bData}));

  \hyperlink{lspmac_8c_a8908812f4ff25c196679e00d330edd81}{cr\_cmd}.\hyperlink{structtagEthernetCmd_a6a155eb3ae546dd29369c4a33ddb3310}{RequestType} = \hyperlink{lspmac_8c_a5485d08fdc80533b5cebadff63696ed2}{VR\_UPLOAD};
  \hyperlink{lspmac_8c_a8908812f4ff25c196679e00d330edd81}{cr\_cmd}.\hyperlink{structtagEthernetCmd_a0dc566e7edbb226f1a4ea443d93d56e2}{Request}     = \hyperlink{lspmac_8c_a8f4ce4666a23a3fb153d680bd1cb6556}{VR\_CTRL\_RESPONSE};
  \hyperlink{lspmac_8c_a8908812f4ff25c196679e00d330edd81}{cr\_cmd}.\hyperlink{structtagEthernetCmd_aec0ee9a5f6c7e3bc6e4bd98f1bd52783}{wValue}      = 0;
  \hyperlink{lspmac_8c_a8908812f4ff25c196679e00d330edd81}{cr\_cmd}.\hyperlink{structtagEthernetCmd_a92f5a374e87d4f496b64b4888850d6e6}{wIndex}      = 0;
  \hyperlink{lspmac_8c_a8908812f4ff25c196679e00d330edd81}{cr\_cmd}.\hyperlink{structtagEthernetCmd_af5df25ff13ca30fa33719d0df1ab7e97}{wLength}     = htons(1400);
  memset( \hyperlink{lspmac_8c_a8908812f4ff25c196679e00d330edd81}{cr\_cmd}.\hyperlink{structtagEthernetCmd_a872dab798127d6f589974a79c5d0aef1}{bData}, 0, \textcolor{keyword}{sizeof}(\hyperlink{lspmac_8c_a8908812f4ff25c196679e00d330edd81}{cr\_cmd}.\hyperlink{structtagEthernetCmd_a872dab798127d6f589974a79c5d0aef1}{bData}));

  \textcolor{comment}{//}
  \textcolor{comment}{// Initialize some mutexs and conditions}
  \textcolor{comment}{//}

  pthread\_mutex\_init( &\hyperlink{lspmac_8c_acc1bb77b9bcbc4d970f841a41fd274b3}{pmac\_queue\_mutex}, NULL);
  pthread\_cond\_init(  &\hyperlink{lspmac_8c_a8a25bd9c593c6985107f90f999ce0b08}{pmac\_queue\_cond}, NULL);

  \hyperlink{lspmac_8c_a112158e0cd50449a440ac55c7af7bea2}{lspmac\_shutter\_state} = 0;                         \textcolor{comment}{//
       assume the shutter is now closed: not a big deal if we are wrong}
  pthread\_mutex\_init( &\hyperlink{lspmac_8c_a1b78a13c654409333569815e1c109d38}{lspmac\_shutter\_mutex}, NULL);
  pthread\_cond\_init(  &\hyperlink{lspmac_8c_afbd51c2cefcee87afe994c9e9f372241}{lspmac\_shutter\_cond}, NULL);
  \hyperlink{lspmac_8c_adba7f5f4bbeabc4dac859221d4c684ba}{pmacfd}.fd = -1;

  pthread\_mutex\_init( &\hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex}, NULL);
  pthread\_cond\_init(  &\hyperlink{lspmac_8c_a57547d211906c981ef20257eba99f8df}{lspmac\_moving\_cond}, NULL);

\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a55b882be15d56a2a777f2b1f92901b7d}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-lut@{lspmac\-\_\-lut}}
\index{lspmac\-\_\-lut@{lspmac\-\_\-lut}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-lut}]{\setlength{\rightskip}{0pt plus 5cm}double lspmac\-\_\-lut (
\begin{DoxyParamCaption}
\item[{int}]{nlut, }
\item[{double $\ast$}]{lut, }
\item[{double}]{x}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a55b882be15d56a2a777f2b1f92901b7d}


Look up table support for motor positions (think x=zoom, y=light intensity) use a lookup table to find the \char`\"{}counts\char`\"{} to move the motor to the requested position The look up table is a simple one dimensional array with the x values as even indicies and the y values as odd indices. 

Returns\-: y value 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em nlut} & number of entries in lookup table \\
\hline
\mbox{\tt in}  & {\em lut} & The lookup table\-: even indicies are the x values, odd are the y's \\
\hline
\mbox{\tt in}  & {\em x} & The x value we are looking up. \\
\hline
\end{DoxyParams}


Definition at line 291 of file lspmac.\-c.


\begin{DoxyCode}
                    \{
  \textcolor{keywordtype}{int} i, foundone;
  \textcolor{keywordtype}{double} m;
  \textcolor{keywordtype}{double} y1, y2, x1, x2, y;

  foundone = 0;
  \textcolor{keywordflow}{if}( lut != NULL && nlut > 1) \{
    \textcolor{keywordflow}{for}( i=0; i < 2*nlut; i += 2) \{
      x1 = lut[i];
      y1 = lut[i+1];
      \textcolor{keywordflow}{if}( i < 2*nlut - 2) \{
        x2 = lut[i+2];
        y2 = lut[i+3];
      \}

      \textcolor{comment}{//}
      \textcolor{comment}{// First one too big?  Use the y value of the first element}
      \textcolor{comment}{//}
      \textcolor{keywordflow}{if}( i == 0 && x1 > x) \{
        y = y1;
        foundone = 1;
        \textcolor{keywordflow}{break};
      \}

      \textcolor{comment}{//}
      \textcolor{comment}{// Look for equality}
      \textcolor{comment}{//}
      \textcolor{keywordflow}{if}( x1 == x) \{
        y = y1;
        foundone = 1;
        \textcolor{keywordflow}{break};
      \}

      \textcolor{comment}{//}
      \textcolor{comment}{// Maybe interpolate}
      \textcolor{comment}{//}
      \textcolor{keywordflow}{if}( (i < 2*nlut-2) && x < x2) \{
        m = (y2 - y1) / (x2 - x1);
        y = m*(x - x1) + y1;
        foundone = 1;
        \textcolor{keywordflow}{break};
      \}
    \}
    \textcolor{keywordflow}{if}( foundone == 0) \{
      \textcolor{comment}{// must be bigger than the last entry}
      \textcolor{comment}{//}
      \textcolor{comment}{//}
      y = lut[2*(nlut-1) + 1];
    \}
    \textcolor{keywordflow}{return} y;
  \}
  \textcolor{keywordflow}{return} 0.0;
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a45becc46f46e5aea14a388d3ec1b8b13}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-motor\-\_\-init@{lspmac\-\_\-motor\-\_\-init}}
\index{lspmac\-\_\-motor\-\_\-init@{lspmac\-\_\-motor\-\_\-init}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-motor\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ lspmac\-\_\-motor\-\_\-init (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{d, }
\item[{int}]{motor\-\_\-number, }
\item[{int}]{wy, }
\item[{int}]{wx, }
\item[{int $\ast$}]{posp, }
\item[{int $\ast$}]{stat1p, }
\item[{int $\ast$}]{stat2p, }
\item[{char $\ast$}]{wtitle, }
\item[{char $\ast$}]{name, }
\item[{void($\ast$)({\bf lspmac\-\_\-motor\-\_\-t} $\ast$, double)}]{move\-Abs}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a45becc46f46e5aea14a388d3ec1b8b13}


Initialize a pmac stepper or servo motor. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em d} & An uninitialize motor object \\
\hline
\mbox{\tt in}  & {\em motor\-\_\-number} & The P\-M\-A\-C motor number \\
\hline
\mbox{\tt in}  & {\em wy} & Curses status window row index \\
\hline
\mbox{\tt in}  & {\em wx} & Curses status window column index \\
\hline
\mbox{\tt in}  & {\em posp} & Pointer to position status \\
\hline
\mbox{\tt in}  & {\em stat1p} & Pointer to 1st status word \\
\hline
\mbox{\tt in}  & {\em stat2p} & Pointer to 2nd status word \\
\hline
\mbox{\tt in}  & {\em wtitle} & Title for this motor (to display) \\
\hline
\mbox{\tt in}  & {\em name} & Name of this motor (to match database) \\
\hline
\mbox{\tt in}  & {\em move\-Abs} & Method to use to move this motor \\
\hline
\end{DoxyParams}


Definition at line 1965 of file lspmac.\-c.


\begin{DoxyCode}
                                    \{
  \hyperlink{lspmac_8c_a56260f012c50a591ee7f97e500f16994}{lspmac\_nmotors}++;

  pthread\_mutex\_init( &(d->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}), NULL);
  pthread\_cond\_init(  &(d->\hyperlink{structlspmac__motor__struct_aa0ea4108b8fed5b41ff91ca7266f3d84}{cond}), NULL);

  d->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name} = strdup(name);
  d->\hyperlink{structlspmac__motor__struct_a20db3de86854b627815b3d940555ea75}{moveAbs} = moveAbs;
  d->\hyperlink{structlspmac__motor__struct_ac62692eb939c04ca35e939d1c3acfe8f}{read} = \hyperlink{lspmac_8c_a637fc023d1255f3519b2eee01913d64d}{lspmac\_pmacmotor\_read};
  d->\hyperlink{structlspmac__motor__struct_a7b43671f7f3e06521f6cf91fb9ac707d}{lut} = NULL;
  d->\hyperlink{structlspmac__motor__struct_a11cbc6f50c150ed446e9a901cf7cc12b}{nlut} = 0;
  d->\hyperlink{structlspmac__motor__struct_a312047bb71def5cd2443fecd875eaea5}{actual\_pos\_cnts\_p} = posp;
  d->\hyperlink{structlspmac__motor__struct_a56c41875faf19c643e97c10519e6eb8c}{status1\_p}           = stat1p;
  d->\hyperlink{structlspmac__motor__struct_a2b33ef6e12717459c1e9967cc6e659c6}{status2\_p}           = stat2p;
  d->\hyperlink{structlspmac__motor__struct_a45fae17618f0c0827e97060dc04f79cb}{motor\_num} = motor\_number;
  d->\hyperlink{structlspmac__motor__struct_a05dff021221abbc1bf656039fffb3275}{dac\_mvar}          = NULL;
  d->\hyperlink{structlspmac__motor__struct_a133775154b0e008f3a2fde6f53bc0eff}{win} = newwin( \hyperlink{pgpmac_8h_a3bae94e8e4e4347dd5f87b6bda058de6}{LS\_DISPLAY\_WINDOW\_HEIGHT}, 
      \hyperlink{pgpmac_8h_a1f96754f00a1f82414cebc66f75ded78}{LS\_DISPLAY\_WINDOW\_WIDTH}, wy*\hyperlink{pgpmac_8h_a3bae94e8e4e4347dd5f87b6bda058de6}{LS\_DISPLAY\_WINDOW\_HEIGHT}
      , wx*\hyperlink{pgpmac_8h_a1f96754f00a1f82414cebc66f75ded78}{LS\_DISPLAY\_WINDOW\_WIDTH});
  box( d->\hyperlink{structlspmac__motor__struct_a133775154b0e008f3a2fde6f53bc0eff}{win}, 0, 0);
  mvwprintw( d->\hyperlink{structlspmac__motor__struct_a133775154b0e008f3a2fde6f53bc0eff}{win}, 1, 1, \textcolor{stringliteral}{"%s"}, wtitle);
  wnoutrefresh( d->\hyperlink{structlspmac__motor__struct_a133775154b0e008f3a2fde6f53bc0eff}{win});
  d->\hyperlink{structlspmac__motor__struct_aa74108855693f94fc2ff76333c9fb6ac}{homing} = 0;
  d->\hyperlink{structlspmac__motor__struct_af11e5f75c1cf88ed6842d04154d27a31}{lspg\_initialized} = 0;

  \textcolor{keywordflow}{return} d;
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_ad1167f01262cf6387e7e82a14d3e1a9d}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-moveabs\-\_\-bio\-\_\-queue@{lspmac\-\_\-moveabs\-\_\-bio\-\_\-queue}}
\index{lspmac\-\_\-moveabs\-\_\-bio\-\_\-queue@{lspmac\-\_\-moveabs\-\_\-bio\-\_\-queue}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-moveabs\-\_\-bio\-\_\-queue}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-moveabs\-\_\-bio\-\_\-queue (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{mp, }
\item[{double}]{requested\-\_\-position}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_ad1167f01262cf6387e7e82a14d3e1a9d}


Move method for binary i/o motor objects. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em mp} & A binary i/o motor object \\
\hline
\mbox{\tt in}  & {\em requested\-\_\-position} & a 1 or a 0 request to move \\
\hline
\end{DoxyParams}


Definition at line 1855 of file lspmac.\-c.


\begin{DoxyCode}
                                \{
  pthread\_mutex\_lock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
  mp->\hyperlink{structlspmac__motor__struct_af8cdc94c6e2478b12ce942d4cf1d7499}{requested\_position} = requested\_position;
  mp->\hyperlink{structlspmac__motor__struct_ab7bd8bff48953ce05c758598d75877ac}{not\_done}    = 1;
  mp->\hyperlink{structlspmac__motor__struct_a68c471836f52707fa8582f7860cf500f}{motion\_seen} = 0;
  mp->\hyperlink{structlspmac__motor__struct_a6e8dc9c11dc52a439fe9837230f93ce2}{requested\_pos\_cnts} = requested\_position;
  mp->\hyperlink{structlspmac__motor__struct_ae0a0c9264f49f51bf72168c3b62f8723}{pq} = \hyperlink{lspmac_8c_ac4cf3a79186859714d8a8293377526ba}{lspmac\_SockSendline\_nr}( mp->\hyperlink{structlspmac__motor__struct_a70291ddfe7994c0bec7fc2287cb6dd89}{write\_fmt}
      , mp->\hyperlink{structlspmac__motor__struct_a6e8dc9c11dc52a439fe9837230f93ce2}{requested\_pos\_cnts});
  pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));

  \textcolor{keywordflow}{if}( mp == \hyperlink{lspmac_8c_af813a2eff0b7efa4c70633559054e84c}{blight\_ud}) \{
    \textcolor{keywordflow}{if}( requested\_position == 0) \{
      \hyperlink{lspmac_8c_a7d601716497857c2b5c072c1aed37b71}{lspmac\_movedac\_queue}( \hyperlink{lspmac_8c_a85d6eaa4b4a82bb3112574f458d1dc50}{blight}, 0);
    \} \textcolor{keywordflow}{else} \{
      pthread\_mutex\_lock( &(\hyperlink{lspmac_8c_ad53a42cfaa04eff0336a44c8c9986333}{zoom}->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
      \hyperlink{lspmac_8c_a7d601716497857c2b5c072c1aed37b71}{lspmac\_movedac\_queue}( \hyperlink{lspmac_8c_a85d6eaa4b4a82bb3112574f458d1dc50}{blight}, \hyperlink{lspmac_8c_ad53a42cfaa04eff0336a44c8c9986333}{zoom}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{
      position});
      pthread\_mutex\_unlock( &(\hyperlink{lspmac_8c_ad53a42cfaa04eff0336a44c8c9986333}{zoom}->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
    \}
  \}
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_ab9f114bba58e685760a518bd5f115d74}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-moveabs\-\_\-fshut\-\_\-queue@{lspmac\-\_\-moveabs\-\_\-fshut\-\_\-queue}}
\index{lspmac\-\_\-moveabs\-\_\-fshut\-\_\-queue@{lspmac\-\_\-moveabs\-\_\-fshut\-\_\-queue}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-moveabs\-\_\-fshut\-\_\-queue}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-moveabs\-\_\-fshut\-\_\-queue (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{mp, }
\item[{double}]{requested\-\_\-position}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_ab9f114bba58e685760a518bd5f115d74}


Move method for the fast shutter. 

Slightly more complicated than a binary io as some flags need to be set up. 
\begin{DoxyParams}{Parameters}
{\em mp} & The fast shutter motor instance \\
\hline
{\em requested\-\_\-position} & 1 (open) or 0 (close), really \\
\hline
\end{DoxyParams}


Definition at line 1828 of file lspmac.\-c.


\begin{DoxyCode}
                                  \{
  pthread\_mutex\_lock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));

  mp->\hyperlink{structlspmac__motor__struct_af8cdc94c6e2478b12ce942d4cf1d7499}{requested\_position} = requested\_position;
  mp->\hyperlink{structlspmac__motor__struct_ab7bd8bff48953ce05c758598d75877ac}{not\_done}    = 1;
  mp->\hyperlink{structlspmac__motor__struct_a68c471836f52707fa8582f7860cf500f}{motion\_seen} = 0;
  mp->\hyperlink{structlspmac__motor__struct_a6e8dc9c11dc52a439fe9837230f93ce2}{requested\_pos\_cnts} = requested\_position;
  \textcolor{keywordflow}{if}( requested\_position != 0) \{
    \textcolor{comment}{//}
    \textcolor{comment}{// ScanEnable=0, ManualEnable=1, ManualOn=1}
    \textcolor{comment}{//}
    mp->\hyperlink{structlspmac__motor__struct_ae0a0c9264f49f51bf72168c3b62f8723}{pq} = \hyperlink{lspmac_8c_ac4cf3a79186859714d8a8293377526ba}{lspmac\_SockSendline\_nr}( \textcolor{stringliteral}{"M1124=0 M1125=1
       M1126=1"});
  \} \textcolor{keywordflow}{else} \{
    \textcolor{comment}{//}
    \textcolor{comment}{// ManualOn=0, ManualEnable=0, ScanEnable=1}
    \textcolor{comment}{//}
    mp->\hyperlink{structlspmac__motor__struct_ae0a0c9264f49f51bf72168c3b62f8723}{pq} = \hyperlink{lspmac_8c_ac4cf3a79186859714d8a8293377526ba}{lspmac\_SockSendline\_nr}( \textcolor{stringliteral}{"M1126=0 M1125=0
       M1124=1"});
  \}

  pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_aa4ea5a4c387ef167702c58eaddcb4151}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-moveabs\-\_\-queue@{lspmac\-\_\-moveabs\-\_\-queue}}
\index{lspmac\-\_\-moveabs\-\_\-queue@{lspmac\-\_\-moveabs\-\_\-queue}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-moveabs\-\_\-queue}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-moveabs\-\_\-queue (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{mp, }
\item[{double}]{requested\-\_\-position}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_aa4ea5a4c387ef167702c58eaddcb4151}


Move method for normal stepper and servo motor objects. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em mp} & The motor to move \\
\hline
\mbox{\tt in}  & {\em requested\-\_\-position} & Where to move it \\
\hline
\end{DoxyParams}


Definition at line 1881 of file lspmac.\-c.


\begin{DoxyCode}
                            \{
  \textcolor{keywordtype}{char} s[512];

  pthread\_mutex\_lock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
  mp->\hyperlink{structlspmac__motor__struct_af8cdc94c6e2478b12ce942d4cf1d7499}{requested\_position} = requested\_position;
  \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a61415627ab2dc0f438b190d117e532db}{u2c} != 0.0) \{
    mp->\hyperlink{structlspmac__motor__struct_ab7bd8bff48953ce05c758598d75877ac}{not\_done}    = 1;
    mp->\hyperlink{structlspmac__motor__struct_a68c471836f52707fa8582f7860cf500f}{motion\_seen} = 0;
    mp->\hyperlink{structlspmac__motor__struct_a6e8dc9c11dc52a439fe9837230f93ce2}{requested\_pos\_cnts} = mp->\hyperlink{structlspmac__motor__struct_a61415627ab2dc0f438b190d117e532db}{u2c} * requested\_position;
        
    snprintf( s, \textcolor{keyword}{sizeof}(s)-1, \textcolor{stringliteral}{"#%d j=%d"}, mp->\hyperlink{structlspmac__motor__struct_a45fae17618f0c0827e97060dc04f79cb}{motor\_num}, mp->
      \hyperlink{structlspmac__motor__struct_a6e8dc9c11dc52a439fe9837230f93ce2}{requested\_pos\_cnts});
    mp->\hyperlink{structlspmac__motor__struct_ae0a0c9264f49f51bf72168c3b62f8723}{pq} = \hyperlink{lspmac_8c_ac4cf3a79186859714d8a8293377526ba}{lspmac\_SockSendline\_nr}( s);
  \}
  pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_aae2282edace621ee65c682d03b7ccc36}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-moveabs\-\_\-wait@{lspmac\-\_\-moveabs\-\_\-wait}}
\index{lspmac\-\_\-moveabs\-\_\-wait@{lspmac\-\_\-moveabs\-\_\-wait}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-moveabs\-\_\-wait}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-moveabs\-\_\-wait (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{mp}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_aae2282edace621ee65c682d03b7ccc36}


Wait for motor to finish moving. 

Assume motion already queued, now just wait 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em mp} & The motor object to wait for \\
\hline
\end{DoxyParams}


Definition at line 1904 of file lspmac.\-c.


\begin{DoxyCode}
                           \{
  \textcolor{keyword}{struct }timespec wt;
  \textcolor{keywordtype}{int} return\_code;

  pthread\_mutex\_lock( &\hyperlink{lspmac_8c_acc1bb77b9bcbc4d970f841a41fd274b3}{pmac\_queue\_mutex});

  \textcolor{comment}{//}
  \textcolor{comment}{// wait for the command to be sent}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{while}( mp->\hyperlink{structlspmac__motor__struct_ae0a0c9264f49f51bf72168c3b62f8723}{pq}->\hyperlink{structlspmac__cmd__queue__struct_a276ebc4b35c2554e4cb7377b60fd89b7}{time\_sent}.tv\_sec==0)
    pthread\_cond\_wait( &\hyperlink{lspmac_8c_a8a25bd9c593c6985107f90f999ce0b08}{pmac\_queue\_cond}, &\hyperlink{lspmac_8c_acc1bb77b9bcbc4d970f841a41fd274b3}{pmac\_queue\_mutex}
      );

  \textcolor{comment}{//}
  \textcolor{comment}{// set the timeout to be long enough after we sent the motion request to
       ensure that}
  \textcolor{comment}{// we will have read back the motor moving status but not so long that the
       timeout causes}
  \textcolor{comment}{// problems;}
  \textcolor{comment}{//}
  wt.tv\_sec  = mp->\hyperlink{structlspmac__motor__struct_ae0a0c9264f49f51bf72168c3b62f8723}{pq}->\hyperlink{structlspmac__cmd__queue__struct_a276ebc4b35c2554e4cb7377b60fd89b7}{time\_sent}.tv\_sec;
  wt.tv\_nsec = mp->\hyperlink{structlspmac__motor__struct_ae0a0c9264f49f51bf72168c3b62f8723}{pq}->\hyperlink{structlspmac__cmd__queue__struct_a276ebc4b35c2554e4cb7377b60fd89b7}{time\_sent}.tv\_nsec + 500000000;

  pthread\_mutex\_unlock( &\hyperlink{lspmac_8c_acc1bb77b9bcbc4d970f841a41fd274b3}{pmac\_queue\_mutex});

  \textcolor{keywordflow}{if}( wt.tv\_nsec >= 1000000000) \{
    wt.tv\_nsec -= 1000000000;
    wt.tv\_sec += 1;
  \}

  \textcolor{comment}{//}
  \textcolor{comment}{// wait for the motion to have started}
  \textcolor{comment}{// This will time out if the motion ends before we can read the status back}
  \textcolor{comment}{// hence the added complication of time stamp of the sent packet.}
  \textcolor{comment}{//}

  return\_code=0;

  pthread\_mutex\_lock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
  \textcolor{keywordflow}{while}( mp->\hyperlink{structlspmac__motor__struct_a68c471836f52707fa8582f7860cf500f}{motion\_seen} == 0 && return\_code == 0)
    return\_code = pthread\_cond\_timedwait( &(mp->\hyperlink{structlspmac__motor__struct_aa0ea4108b8fed5b41ff91ca7266f3d84}{cond}), &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}), &
      wt);

  \textcolor{keywordflow}{if}( return\_code == 0) \{
    \textcolor{comment}{//}
    \textcolor{comment}{// wait for the motion that we know has started to finish}
    \textcolor{comment}{//}
    \textcolor{keywordflow}{while}( mp->\hyperlink{structlspmac__motor__struct_ab7bd8bff48953ce05c758598d75877ac}{not\_done})
      pthread\_cond\_wait( &(mp->\hyperlink{structlspmac__motor__struct_aa0ea4108b8fed5b41ff91ca7266f3d84}{cond}), &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));

  \}

  \textcolor{comment}{//}
  \textcolor{comment}{// if return code was not 0 then we know we shouldn't wait for not\_done flag.}
  \textcolor{comment}{// In this case the motion ended before we read the status that should the
       motor moving.}
  \textcolor{comment}{//}
  pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));

\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a7d601716497857c2b5c072c1aed37b71}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-movedac\-\_\-queue@{lspmac\-\_\-movedac\-\_\-queue}}
\index{lspmac\-\_\-movedac\-\_\-queue@{lspmac\-\_\-movedac\-\_\-queue}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-movedac\-\_\-queue}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-movedac\-\_\-queue (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{mp, }
\item[{double}]{requested\-\_\-position}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a7d601716497857c2b5c072c1aed37b71}


Move method for dac motor objects (ie, lights) 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em mp} & Our motor \\
\hline
\mbox{\tt in}  & {\em requested\-\_\-position} & Desired x postion (look up and send y position) \\
\hline
\end{DoxyParams}


Definition at line 1751 of file lspmac.\-c.


\begin{DoxyCode}
                            \{
  \textcolor{keywordtype}{char} s[512];
  \textcolor{keywordtype}{double} y;

  pthread\_mutex\_lock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));

  mp->\hyperlink{structlspmac__motor__struct_af8cdc94c6e2478b12ce942d4cf1d7499}{requested\_position} = requested\_position;

  \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a11cbc6f50c150ed446e9a901cf7cc12b}{nlut} > 0 && mp->\hyperlink{structlspmac__motor__struct_a7b43671f7f3e06521f6cf91fb9ac707d}{lut} != NULL) \{
    mp->\hyperlink{structlspmac__motor__struct_a6e8dc9c11dc52a439fe9837230f93ce2}{requested\_pos\_cnts} = \hyperlink{lspmac_8c_a55b882be15d56a2a777f2b1f92901b7d}{lspmac\_lut}( mp->\hyperlink{structlspmac__motor__struct_a11cbc6f50c150ed446e9a901cf7cc12b}{nlut}
      , mp->\hyperlink{structlspmac__motor__struct_a7b43671f7f3e06521f6cf91fb9ac707d}{lut}, requested\_position);
    mp->\hyperlink{structlspmac__motor__struct_ab7bd8bff48953ce05c758598d75877ac}{not\_done}    = 1;
    mp->\hyperlink{structlspmac__motor__struct_a68c471836f52707fa8582f7860cf500f}{motion\_seen} = 0;


    \textcolor{comment}{//}
    \textcolor{comment}{//  By convention requested\_pos\_cnts scales from 0 to 100}
    \textcolor{comment}{//  for the lights u2c converts this to 0 to 16,000}
    \textcolor{comment}{//  for the scintilator focus this is   0 to 32,000}
    \textcolor{comment}{//}
    snprintf( s, \textcolor{keyword}{sizeof}(s)-1, \textcolor{stringliteral}{"%s=%d"}, mp->\hyperlink{structlspmac__motor__struct_a05dff021221abbc1bf656039fffb3275}{dac\_mvar}, mp->
      \hyperlink{structlspmac__motor__struct_a6e8dc9c11dc52a439fe9837230f93ce2}{requested\_pos\_cnts});
    mp->\hyperlink{structlspmac__motor__struct_ae0a0c9264f49f51bf72168c3b62f8723}{pq} = \hyperlink{lspmac_8c_ac4cf3a79186859714d8a8293377526ba}{lspmac\_SockSendline\_nr}( s);

  \}

  pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_ad6ae1e37afd118f24ab1c6878da53878}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-movezoom\-\_\-queue@{lspmac\-\_\-movezoom\-\_\-queue}}
\index{lspmac\-\_\-movezoom\-\_\-queue@{lspmac\-\_\-movezoom\-\_\-queue}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-movezoom\-\_\-queue}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-movezoom\-\_\-queue (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{mp, }
\item[{double}]{requested\-\_\-position}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_ad6ae1e37afd118f24ab1c6878da53878}


Move method for the zoom motor. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em mp} & the zoom motor \\
\hline
\mbox{\tt in}  & {\em requested\-\_\-position} & our desired zoom \\
\hline
\end{DoxyParams}


Definition at line 1784 of file lspmac.\-c.


\begin{DoxyCode}
                             \{
  \textcolor{keywordtype}{char} s[512];
  \textcolor{keywordtype}{double} y;
  \textcolor{keywordtype}{int} blud;
  pthread\_mutex\_lock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));

  mp->\hyperlink{structlspmac__motor__struct_af8cdc94c6e2478b12ce942d4cf1d7499}{requested\_position} = requested\_position;

  \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a11cbc6f50c150ed446e9a901cf7cc12b}{nlut} > 0 && mp->\hyperlink{structlspmac__motor__struct_a7b43671f7f3e06521f6cf91fb9ac707d}{lut} != NULL) \{
    y = \hyperlink{lspmac_8c_a55b882be15d56a2a777f2b1f92901b7d}{lspmac\_lut}( mp->\hyperlink{structlspmac__motor__struct_a11cbc6f50c150ed446e9a901cf7cc12b}{nlut}, mp->\hyperlink{structlspmac__motor__struct_a7b43671f7f3e06521f6cf91fb9ac707d}{lut}, requested\_position);

    mp->\hyperlink{structlspmac__motor__struct_a6e8dc9c11dc52a439fe9837230f93ce2}{requested\_pos\_cnts} = (int)y;
    mp->\hyperlink{structlspmac__motor__struct_ab7bd8bff48953ce05c758598d75877ac}{not\_done}    = 1;
    mp->\hyperlink{structlspmac__motor__struct_a68c471836f52707fa8582f7860cf500f}{motion\_seen} = 0;


    snprintf( s, \textcolor{keyword}{sizeof}(s)-1, \textcolor{stringliteral}{"#%d j=%d"}, mp->\hyperlink{structlspmac__motor__struct_a45fae17618f0c0827e97060dc04f79cb}{motor\_num}, mp->
      \hyperlink{structlspmac__motor__struct_a6e8dc9c11dc52a439fe9837230f93ce2}{requested\_pos\_cnts});
    mp->\hyperlink{structlspmac__motor__struct_ae0a0c9264f49f51bf72168c3b62f8723}{pq} = \hyperlink{lspmac_8c_ac4cf3a79186859714d8a8293377526ba}{lspmac\_SockSendline\_nr}( s);

  \}
  pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));

  \textcolor{comment}{//}
  \textcolor{comment}{// the lights should "move" with the zoom motor}
  \textcolor{comment}{//}
  \hyperlink{lspmac_8c_a7d601716497857c2b5c072c1aed37b71}{lspmac\_movedac\_queue}( \hyperlink{lspmac_8c_aeb09895663eff333b7a75acb319a9fc1}{flight}, requested\_position);

  pthread\_mutex\_lock( &(\hyperlink{lspmac_8c_af813a2eff0b7efa4c70633559054e84c}{blight\_ud}->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
  blud = \hyperlink{lspmac_8c_af813a2eff0b7efa4c70633559054e84c}{blight\_ud}->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position};
  pthread\_mutex\_unlock( &(\hyperlink{lspmac_8c_af813a2eff0b7efa4c70633559054e84c}{blight\_ud}->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));

  \textcolor{keywordflow}{if}( blud > 0) \{
    \hyperlink{lspmac_8c_a7d601716497857c2b5c072c1aed37b71}{lspmac\_movedac\_queue}( \hyperlink{lspmac_8c_a85d6eaa4b4a82bb3112574f458d1dc50}{blight}, requested\_position)
      ;
  \}
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a68886d1b658e7b1d996c07e9dbcd9c15}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-next\-\_\-state@{lspmac\-\_\-next\-\_\-state}}
\index{lspmac\-\_\-next\-\_\-state@{lspmac\-\_\-next\-\_\-state}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-next\-\_\-state}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-next\-\_\-state (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a68886d1b658e7b1d996c07e9dbcd9c15}


State machine logic. 

Given the current state, generate the next one 

Definition at line 1610 of file lspmac.\-c.


\begin{DoxyCode}
                         \{


  \textcolor{comment}{//}
  \textcolor{comment}{// Connect to the pmac and perhaps initialize it.}
  \textcolor{comment}{// OK, this is slightly more than just the state}
  \textcolor{comment}{// machine logic...}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state} == \hyperlink{lspmac_8c_a7eb86ecf0789ab9555de1e03a4c73567}{LS\_PMAC\_STATE\_DETACHED}
      ) \{
    \textcolor{comment}{//}
    \textcolor{comment}{// TODO (eventually)}
    \textcolor{comment}{// This ip address wont change in a single PMAC installation}
    \textcolor{comment}{// We'll need to audit the code if we decide to implement}
    \textcolor{comment}{// multiple PMACs so might as well wait til then.}
    \textcolor{comment}{//}
    \hyperlink{lspmac_8c_aae020ea2478b41702ce8b7d20b2560be}{lsConnect}( \textcolor{stringliteral}{"192.6.94.5"});

    \textcolor{comment}{//}
    \textcolor{comment}{// If the connect was successful we can proceed with the initialization}
    \textcolor{comment}{//}
    \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state} != \hyperlink{lspmac_8c_a7eb86ecf0789ab9555de1e03a4c73567}{LS\_PMAC\_STATE\_DETACHED}
      ) \{
      \hyperlink{lspmac_8c_ac5745f25f242edf02f7b9b7c77ed6126}{lspmac\_SockFlush}();
      
      \textcolor{comment}{//}
      \textcolor{comment}{// Harvest the I and M variables in case we need them}
      \textcolor{comment}{// one day.}
      \textcolor{comment}{//}
      \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_a50e9c0a06654fd81b3446a6e54ff12c3}{getmvars}) \{
        \hyperlink{lspmac_8c_a983d291506dc387ba5d71a97766e8a25}{lspmac\_GetAllMVars}();
        \hyperlink{lspmac_8c_a50e9c0a06654fd81b3446a6e54ff12c3}{getmvars} = 0;
      \}
      
      \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_a07b7b8254772075e6a4ced500b589c36}{getivars}) \{
        \hyperlink{lspmac_8c_ac24bdffa893a9bf7c9cb084fe1417f6f}{lspmac\_GetAllIVars}();
        \hyperlink{lspmac_8c_a07b7b8254772075e6a4ced500b589c36}{getivars} = 0;
      \}
    \}
  \}

  \textcolor{comment}{//}
  \textcolor{comment}{// Check the command queue and perhaps go to the "Send Command" state.}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state} == \hyperlink{lspmac_8c_a37741af675425d61c876cc30ae6c99d0}{LS\_PMAC\_STATE\_IDLE} && 
      \hyperlink{lspmac_8c_ad62b1f9e907acc3de9f3d6a05d55829e}{ethCmdOn} != \hyperlink{lspmac_8c_ae85caec6f4ddb2fc52ca14a26549ab08}{ethCmdOff})
    \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state} = \hyperlink{lspmac_8c_a7d8f34fc599cc08c1a9d2cd62ccbb20a}{LS\_PMAC\_STATE\_SC};


  \textcolor{comment}{//}
  \textcolor{comment}{// Set the events flag}
  \textcolor{comment}{// to tell poll what we are waiting for.}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{switch}( \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state}) \{
  \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_a7eb86ecf0789ab9555de1e03a4c73567}{LS\_PMAC\_STATE\_DETACHED}:
    \textcolor{comment}{//}
    \textcolor{comment}{// there shouldn't be a valid fd, so ignore the events}
    \textcolor{comment}{//}
    \hyperlink{lspmac_8c_adba7f5f4bbeabc4dac859221d4c684ba}{pmacfd}.events = 0;
    \textcolor{keywordflow}{break};

  \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_a37741af675425d61c876cc30ae6c99d0}{LS\_PMAC\_STATE\_IDLE}:
    \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_ad62b1f9e907acc3de9f3d6a05d55829e}{ethCmdOn} == \hyperlink{lspmac_8c_ae85caec6f4ddb2fc52ca14a26549ab08}{ethCmdOff}) \{
      \textcolor{comment}{//}
      \textcolor{comment}{// Anytime we are idle we want to}
      \textcolor{comment}{// get the status of the PMAC}
      \textcolor{comment}{//}

      \hyperlink{lspmac_8c_a6dedca923b3a6904395ad02158e2e96f}{lspmac\_get\_status}();
    \}



  \textcolor{comment}{//}
  \textcolor{comment}{// These state require that we listen for packets}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_a63356b0c18fcb186f456c12c6e927d84}{LS\_PMAC\_STATE\_WACK\_NFR}:
  \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_a5eba9ef09d4316e803b9d75bd3104f43}{LS\_PMAC\_STATE\_WACK}:
  \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_adef540911028fda73e8bbf0aa6ad39e9}{LS\_PMAC\_STATE\_WACK\_CC}:
  \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_a3e0a62cd9a1212419ad3615c34bdc65a}{LS\_PMAC\_STATE\_WACK\_RR}:
  \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_a27ee6c39d58604c8aa9bd6c249c4833f}{LS\_PMAC\_STATE\_WCR}:
  \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_a591822cc92f76a39b293c2e90b322db2}{LS\_PMAC\_STATE\_WGB}:
  \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_a220b39710719cfe8b500d51819e8efeb}{LS\_PMAC\_STATE\_GMR}:
    \hyperlink{lspmac_8c_adba7f5f4bbeabc4dac859221d4c684ba}{pmacfd}.events = POLLIN;
    \textcolor{keywordflow}{break};
    
  \textcolor{comment}{//}
  \textcolor{comment}{// These state require that we send packets out.}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_a7d8f34fc599cc08c1a9d2cd62ccbb20a}{LS\_PMAC\_STATE\_SC}:
  \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_abbd709b56a71eb1fc6adc9063605d243}{LS\_PMAC\_STATE\_CR}:
  \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_add5325f4a84e4fe05f558880349485ea}{LS\_PMAC\_STATE\_RR}:
  \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_a5f4ff8874677aac48a4c675f2c1ca4e9}{LS\_PMAC\_STATE\_GB}:
    \textcolor{comment}{//}
    \textcolor{comment}{// Sad fact: PMAC will fail to process commands if we send them too
       quickly.}
    \textcolor{comment}{// We deal with that by waiting a tad before we let poll tell us the PMAC
       socket is ready to write.}
    \textcolor{comment}{//}
    gettimeofday( &\hyperlink{lspmac_8c_a4bed9053319d1d2cad5cc03d0549e17f}{now}, NULL);
    \textcolor{keywordflow}{if}(  ((\hyperlink{lspmac_8c_a4bed9053319d1d2cad5cc03d0549e17f}{now}.tv\_sec * 1000000. + \hyperlink{lspmac_8c_a4bed9053319d1d2cad5cc03d0549e17f}{now}.tv\_usec) - (pmac\_time\_sent.tv\_sec 
      * 1000000. + pmac\_time\_sent.tv\_usec)) < \hyperlink{lspmac_8c_a59f5f5218e25332dbf64f216aec116e5}{PMAC\_MIN\_CMD\_TIME}) \{
      \hyperlink{lspmac_8c_adba7f5f4bbeabc4dac859221d4c684ba}{pmacfd}.events = 0;
    \} \textcolor{keywordflow}{else} \{
      \hyperlink{lspmac_8c_adba7f5f4bbeabc4dac859221d4c684ba}{pmacfd}.events = POLLOUT;
    \}
    \textcolor{keywordflow}{break};
  \}
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a637fc023d1255f3519b2eee01913d64d}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-pmacmotor\-\_\-read@{lspmac\-\_\-pmacmotor\-\_\-read}}
\index{lspmac\-\_\-pmacmotor\-\_\-read@{lspmac\-\_\-pmacmotor\-\_\-read}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-pmacmotor\-\_\-read}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-pmacmotor\-\_\-read (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{mp}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a637fc023d1255f3519b2eee01913d64d}


Read the position and status of a normal P\-M\-A\-C motor. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em mp} & Our motor \\
\hline
\end{DoxyParams}


Definition at line 1212 of file lspmac.\-c.


\begin{DoxyCode}
                             \{
  \textcolor{keywordtype}{char} s[512], *sp;
  \textcolor{keywordtype}{int} homing1, homing2;

  pthread\_mutex\_lock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));

  \textcolor{comment}{//}
  \textcolor{comment}{// if this time and last time were both "in position"}
  \textcolor{comment}{// and the position changed significantly then log the event}
  \textcolor{comment}{//}
  \textcolor{comment}{// On E omega has been observed to change by 0x10000 on its own}
  \textcolor{comment}{// with no real motion.}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a6a412224c09268c1dc92de9c2a1a2512}{status2} & 1 && mp->\hyperlink{structlspmac__motor__struct_a6a412224c09268c1dc92de9c2a1a2512}{status2} == *mp->\hyperlink{structlspmac__motor__struct_a2b33ef6e12717459c1e9967cc6e659c6}{status2\_p} 
      && abs( mp->\hyperlink{structlspmac__motor__struct_ae5c7aea45b9637a1817be246688fd980}{actual\_pos\_cnts} - *mp->\hyperlink{structlspmac__motor__struct_a312047bb71def5cd2443fecd875eaea5}{actual\_pos\_cnts\_p}
      ) > 256) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Instantaneous change: %s old
       status1: %0x, new status1: %0x, old status2: %0x, new status2: %0x, old cnts:
       %0x, new cnts: %0x"},
                           mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name}, mp->\hyperlink{structlspmac__motor__struct_acb52b612b9237e8eec0b97fb1e76a35d}{status1}, *mp->\hyperlink{structlspmac__motor__struct_a56c41875faf19c643e97c10519e6eb8c}{status1\_p}
      , mp->\hyperlink{structlspmac__motor__struct_a6a412224c09268c1dc92de9c2a1a2512}{status2}, *mp->\hyperlink{structlspmac__motor__struct_a2b33ef6e12717459c1e9967cc6e659c6}{status2\_p}, mp->\hyperlink{structlspmac__motor__struct_ae5c7aea45b9637a1817be246688fd980}{actual\_pos\_cnts}
      , *mp->\hyperlink{structlspmac__motor__struct_a312047bb71def5cd2443fecd875eaea5}{actual\_pos\_cnts\_p});

    \textcolor{comment}{//}
    \textcolor{comment}{// At this point we'll just log the event and return}
    \textcolor{comment}{// There is no reason to believe the change is real.}
    \textcolor{comment}{//}
    \textcolor{comment}{// There is a non-zero probability that the first value is the bad one and
       any value afterwards will be taken as}
    \textcolor{comment}{// wrong.  Homing (or moving) the motor should fix this.  There is a
       non-zero probably that it can happen}
    \textcolor{comment}{// two or more times in a row after moving.}
    \textcolor{comment}{//}
    \textcolor{comment}{// TODO: account for the case where mp->actual\_pos\_cnts is the bad value.}
    \textcolor{comment}{//}
    \textcolor{comment}{// TODO: Is this a problem when the motor is moving?  Can we detect it?}
    \textcolor{comment}{//}
    \textcolor{comment}{// TODO: Think of the correct change value here (currently 256) that works
       for all motors}
    \textcolor{comment}{// or have this value configurable}
    \textcolor{comment}{//}
    pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
    \textcolor{keywordflow}{return};
  \}


  \textcolor{comment}{// Send an event if inPosition has changed}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( (mp->\hyperlink{structlspmac__motor__struct_a6a412224c09268c1dc92de9c2a1a2512}{status2} & 0x000001) != (*mp->\hyperlink{structlspmac__motor__struct_a2b33ef6e12717459c1e9967cc6e659c6}{status2\_p} & 0x000001)) 
      \{
    \hyperlink{lsevents_8c_a5c6f122382dea3dcc231b772e5e75b46}{lsevents\_send\_event}( \textcolor{stringliteral}{"%s %s"}, mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name}, (*mp->
      \hyperlink{structlspmac__motor__struct_a2b33ef6e12717459c1e9967cc6e659c6}{status2\_p} & 0x000001) ? \textcolor{stringliteral}{"In Position"} : \textcolor{stringliteral}{"Moving"});
  \}

  \textcolor{comment}{// Make local copies so we can inspect them in other threads}
  \textcolor{comment}{// without having to grab the status mutex}
  \textcolor{comment}{//}

  mp->\hyperlink{structlspmac__motor__struct_acb52b612b9237e8eec0b97fb1e76a35d}{status1} = *mp->\hyperlink{structlspmac__motor__struct_a56c41875faf19c643e97c10519e6eb8c}{status1\_p};
  mp->\hyperlink{structlspmac__motor__struct_a6a412224c09268c1dc92de9c2a1a2512}{status2} = *mp->\hyperlink{structlspmac__motor__struct_a2b33ef6e12717459c1e9967cc6e659c6}{status2\_p};
  mp->\hyperlink{structlspmac__motor__struct_ae5c7aea45b9637a1817be246688fd980}{actual\_pos\_cnts} = *mp->\hyperlink{structlspmac__motor__struct_a312047bb71def5cd2443fecd875eaea5}{actual\_pos\_cnts\_p};

  \textcolor{comment}{//}
  \textcolor{comment}{// See if we are done moving, ie, in position}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a6a412224c09268c1dc92de9c2a1a2512}{status2} & 0x000001) \{
    \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_ab7bd8bff48953ce05c758598d75877ac}{not\_done}) \{
      mp->\hyperlink{structlspmac__motor__struct_ab7bd8bff48953ce05c758598d75877ac}{not\_done} = 0;
      pthread\_cond\_signal( &(mp->\hyperlink{structlspmac__motor__struct_aa0ea4108b8fed5b41ff91ca7266f3d84}{cond}));
    \}
  \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_ab7bd8bff48953ce05c758598d75877ac}{not\_done} == 0) \{
    mp->\hyperlink{structlspmac__motor__struct_ab7bd8bff48953ce05c758598d75877ac}{not\_done} = 1;
  \}

  \textcolor{comment}{//}
  \textcolor{comment}{// See if homed or desired velocity zero}
  \textcolor{comment}{// TODO: What's going on here?  Does this logic do anything interesting?}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_acb52b612b9237e8eec0b97fb1e76a35d}{status1} & 0x020000 || mp->\hyperlink{structlspmac__motor__struct_acb52b612b9237e8eec0b97fb1e76a35d}{status1} & 0x000400) \{
    \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a68c471836f52707fa8582f7860cf500f}{motion\_seen} == 0) \{
      mp->\hyperlink{structlspmac__motor__struct_a68c471836f52707fa8582f7860cf500f}{motion\_seen} = 1;
      pthread\_cond\_signal( &(mp->\hyperlink{structlspmac__motor__struct_aa0ea4108b8fed5b41ff91ca7266f3d84}{cond}));
    \}
  \}

  mvwprintw( mp->\hyperlink{structlspmac__motor__struct_a133775154b0e008f3a2fde6f53bc0eff}{win}, 2, 1, \textcolor{stringliteral}{"%*s"}, \hyperlink{pgpmac_8h_a1f96754f00a1f82414cebc66f75ded78}{LS\_DISPLAY\_WINDOW\_WIDTH}
      -2, \textcolor{stringliteral}{" "});
  mvwprintw( mp->\hyperlink{structlspmac__motor__struct_a133775154b0e008f3a2fde6f53bc0eff}{win}, 2, 1, \textcolor{stringliteral}{"%*d cts"}, \hyperlink{pgpmac_8h_a1f96754f00a1f82414cebc66f75ded78}{LS\_DISPLAY\_WINDOW\_WIDTH}
      -6, mp->\hyperlink{structlspmac__motor__struct_ae5c7aea45b9637a1817be246688fd980}{actual\_pos\_cnts});
  mvwprintw( mp->\hyperlink{structlspmac__motor__struct_a133775154b0e008f3a2fde6f53bc0eff}{win}, 3, 1, \textcolor{stringliteral}{"%*s"}, \hyperlink{pgpmac_8h_a1f96754f00a1f82414cebc66f75ded78}{LS\_DISPLAY\_WINDOW\_WIDTH}
      -2, \textcolor{stringliteral}{" "});

  \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a11cbc6f50c150ed446e9a901cf7cc12b}{nlut} >0 && mp->\hyperlink{structlspmac__motor__struct_a7b43671f7f3e06521f6cf91fb9ac707d}{lut} != NULL) \{
    mp->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position} = \hyperlink{lspmac_8c_a5afe5cd407b44f9c05ad4f1c4e4d5f6a}{lspmac\_rlut}( mp->\hyperlink{structlspmac__motor__struct_a11cbc6f50c150ed446e9a901cf7cc12b}{nlut}, mp->\hyperlink{structlspmac__motor__struct_a7b43671f7f3e06521f6cf91fb9ac707d}{lut}, mp
      ->\hyperlink{structlspmac__motor__struct_ae5c7aea45b9637a1817be246688fd980}{actual\_pos\_cnts});
  \} \textcolor{keywordflow}{else} \{
    \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a61415627ab2dc0f438b190d117e532db}{u2c} != 0.0) \{
      mp->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position} = mp->\hyperlink{structlspmac__motor__struct_ae5c7aea45b9637a1817be246688fd980}{actual\_pos\_cnts} / mp->\hyperlink{structlspmac__motor__struct_a61415627ab2dc0f438b190d117e532db}{u2c};
    \} \textcolor{keywordflow}{else} \{
      mp->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position} = mp->\hyperlink{structlspmac__motor__struct_ae5c7aea45b9637a1817be246688fd980}{actual\_pos\_cnts};
    \}
  \}
  snprintf( s, \textcolor{keyword}{sizeof}(s)-1, mp->\hyperlink{structlspmac__motor__struct_aba3d9d00271187128506bbbb1d77da19}{format}, 8, mp->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position});

  \textcolor{comment}{// set flag if we are not homed}
  homing1 = 0;
  \textcolor{comment}{//                        ~(homed flag)}
  \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_aa74108855693f94fc2ff76333c9fb6ac}{homing} == 0  && (~mp->\hyperlink{structlspmac__motor__struct_a6a412224c09268c1dc92de9c2a1a2512}{status2} & 0x000400) != 0) \{
    homing1 = 1;
  \}

  \textcolor{comment}{// set flag if we are homing and in open loop}
  homing2 = 0;
  \textcolor{comment}{//                         open loop}
  \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_aa74108855693f94fc2ff76333c9fb6ac}{homing} == 1 && (mp->\hyperlink{structlspmac__motor__struct_acb52b612b9237e8eec0b97fb1e76a35d}{status1} & 0x040000) != 0) \{
    homing2 = 1;
  \}
  \textcolor{comment}{// maybe reset homing flag}
  \textcolor{comment}{//                        homed flag                       in position flag}
  \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_aa74108855693f94fc2ff76333c9fb6ac}{homing} == 2 && (mp->\hyperlink{structlspmac__motor__struct_a6a412224c09268c1dc92de9c2a1a2512}{status2} & 0x000400 != 0) && (mp->
      \hyperlink{structlspmac__motor__struct_a6a412224c09268c1dc92de9c2a1a2512}{status2} & 0x000001 != 0))
    mp->\hyperlink{structlspmac__motor__struct_aa74108855693f94fc2ff76333c9fb6ac}{homing} = 0;


  s[\textcolor{keyword}{sizeof}(s)-1] = 0;
  mvwprintw( mp->\hyperlink{structlspmac__motor__struct_a133775154b0e008f3a2fde6f53bc0eff}{win}, 3, 1, \textcolor{stringliteral}{"%*s"}, \hyperlink{pgpmac_8h_a1f96754f00a1f82414cebc66f75ded78}{LS\_DISPLAY\_WINDOW\_WIDTH}
      -6, s);

  mvwprintw( mp->\hyperlink{structlspmac__motor__struct_a133775154b0e008f3a2fde6f53bc0eff}{win}, 4, 1, \textcolor{stringliteral}{"%*x"}, \hyperlink{pgpmac_8h_a1f96754f00a1f82414cebc66f75ded78}{LS\_DISPLAY\_WINDOW\_WIDTH}
      -2, mp->\hyperlink{structlspmac__motor__struct_acb52b612b9237e8eec0b97fb1e76a35d}{status1});
  mvwprintw( mp->\hyperlink{structlspmac__motor__struct_a133775154b0e008f3a2fde6f53bc0eff}{win}, 5, 1, \textcolor{stringliteral}{"%*x"}, \hyperlink{pgpmac_8h_a1f96754f00a1f82414cebc66f75ded78}{LS\_DISPLAY\_WINDOW\_WIDTH}
      -2, mp->\hyperlink{structlspmac__motor__struct_a6a412224c09268c1dc92de9c2a1a2512}{status2});
  sp = \textcolor{stringliteral}{""};
  \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a6a412224c09268c1dc92de9c2a1a2512}{status2} & 0x000002)
    sp = \textcolor{stringliteral}{"Following Warning"};
  \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a6a412224c09268c1dc92de9c2a1a2512}{status2} & 0x000004)
    sp = \textcolor{stringliteral}{"Following Error"};
  \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a6a412224c09268c1dc92de9c2a1a2512}{status2} & 0x000020)
    sp = \textcolor{stringliteral}{"I2T Amp Fault"};
  \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a6a412224c09268c1dc92de9c2a1a2512}{status2} & 0x000008)
    sp = \textcolor{stringliteral}{"Amp. Fault"};
  \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a6a412224c09268c1dc92de9c2a1a2512}{status2} & 0x000800)
    sp = \textcolor{stringliteral}{"Stopped on Limit"};
  \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_acb52b612b9237e8eec0b97fb1e76a35d}{status1} & 0x040000)
    sp = \textcolor{stringliteral}{"Open Loop"};
  \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( ~(mp->\hyperlink{structlspmac__motor__struct_acb52b612b9237e8eec0b97fb1e76a35d}{status1}) & 0x080000)
    sp = \textcolor{stringliteral}{"Motor Disabled"};
  \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_acb52b612b9237e8eec0b97fb1e76a35d}{status1} & 0x000400)
    sp = \textcolor{stringliteral}{"Homing"};
  \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( (mp->\hyperlink{structlspmac__motor__struct_acb52b612b9237e8eec0b97fb1e76a35d}{status1} & 0x600000) == 0x600000)
    sp = \textcolor{stringliteral}{"Both Limits Tripped"};
  \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_acb52b612b9237e8eec0b97fb1e76a35d}{status1} & 0x200000)
    sp = \textcolor{stringliteral}{"Positive Limit"};
  \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_acb52b612b9237e8eec0b97fb1e76a35d}{status1} & 0x400000)
    sp = \textcolor{stringliteral}{"Negative Limit"};
  \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( ~(mp->\hyperlink{structlspmac__motor__struct_a6a412224c09268c1dc92de9c2a1a2512}{status2}) & 0x000400)
    sp = \textcolor{stringliteral}{"Not Homed"};
  \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a6a412224c09268c1dc92de9c2a1a2512}{status2} & 0x000001)
    sp = \textcolor{stringliteral}{"In Position"};

  mvwprintw( mp->\hyperlink{structlspmac__motor__struct_a133775154b0e008f3a2fde6f53bc0eff}{win}, 6, 1, \textcolor{stringliteral}{"%*s"}, \hyperlink{pgpmac_8h_a1f96754f00a1f82414cebc66f75ded78}{LS\_DISPLAY\_WINDOW\_WIDTH}
      -2, sp);
  wnoutrefresh( mp->\hyperlink{structlspmac__motor__struct_a133775154b0e008f3a2fde6f53bc0eff}{win});
  
  strncpy( mp->\hyperlink{structlspmac__motor__struct_ae4a6f54a98e7758d66228efebe8f3baa}{statuss}, sp, \textcolor{keyword}{sizeof}( mp->\hyperlink{structlspmac__motor__struct_ae4a6f54a98e7758d66228efebe8f3baa}{statuss})-1);
  mp->\hyperlink{structlspmac__motor__struct_ae4a6f54a98e7758d66228efebe8f3baa}{statuss}[\textcolor{keyword}{sizeof}(mp->\hyperlink{structlspmac__motor__struct_ae4a6f54a98e7758d66228efebe8f3baa}{statuss})-1] = 0;

  pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));

  \textcolor{keywordflow}{if}( homing1)
    \hyperlink{lspmac_8c_a9fbadf816a842c8f131cf8ee47b54e29}{lspmac\_home1\_queue}( mp);

  \textcolor{keywordflow}{if}( homing2)
    \hyperlink{lspmac_8c_a43e54631dc8de372854ebbb63ff28f70}{lspmac\_home2\_queue}( mp);

\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a9627f30135aa7007bc4ab8dde905739a}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-pop\-\_\-queue@{lspmac\-\_\-pop\-\_\-queue}}
\index{lspmac\-\_\-pop\-\_\-queue@{lspmac\-\_\-pop\-\_\-queue}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-pop\-\_\-queue}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pmac\-\_\-cmd\-\_\-queue\-\_\-t}$\ast$ lspmac\-\_\-pop\-\_\-queue (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a9627f30135aa7007bc4ab8dde905739a}


Remove the oldest queue item. 

Used to send command to P\-M\-A\-C. Note that there is a separate reply index to ensure we've know to what command a reply is refering. Returns the item. 

Definition at line 537 of file lspmac.\-c.


\begin{DoxyCode}
                                     \{
  \hyperlink{structlspmac__cmd__queue__struct}{pmac\_cmd\_queue\_t} *rtn;

  pthread\_mutex\_lock( &\hyperlink{lspmac_8c_acc1bb77b9bcbc4d970f841a41fd274b3}{pmac\_queue\_mutex});

  \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_ad62b1f9e907acc3de9f3d6a05d55829e}{ethCmdOn} == \hyperlink{lspmac_8c_ae85caec6f4ddb2fc52ca14a26549ab08}{ethCmdOff})
    rtn = NULL;
  \textcolor{keywordflow}{else} \{
    rtn = &(\hyperlink{lspmac_8c_a69e569a833fe7f202b92e860d1548f2b}{ethCmdQueue}[(\hyperlink{lspmac_8c_ae85caec6f4ddb2fc52ca14a26549ab08}{ethCmdOff}++) % 
      \hyperlink{lspmac_8c_a3fae557baafab24b7518dc84f5ef5a9b}{PMAC\_CMD\_QUEUE\_LENGTH}]);
    clock\_gettime( CLOCK\_REALTIME, &(rtn->\hyperlink{structlspmac__cmd__queue__struct_a276ebc4b35c2554e4cb7377b60fd89b7}{time\_sent}));
  \}
  pthread\_mutex\_unlock( &\hyperlink{lspmac_8c_acc1bb77b9bcbc4d970f841a41fd274b3}{pmac\_queue\_mutex});
  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a0f60f18dfe11c1c0299909521596be8f}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-pop\-\_\-reply@{lspmac\-\_\-pop\-\_\-reply}}
\index{lspmac\-\_\-pop\-\_\-reply@{lspmac\-\_\-pop\-\_\-reply}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-pop\-\_\-reply}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pmac\-\_\-cmd\-\_\-queue\-\_\-t}$\ast$ lspmac\-\_\-pop\-\_\-reply (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a0f60f18dfe11c1c0299909521596be8f}


Remove the next command queue item that is waiting for a reply. 

We always need a reply to know we are done with a given command. Returns the item. 

Definition at line 557 of file lspmac.\-c.


\begin{DoxyCode}
                                     \{
  \hyperlink{structlspmac__cmd__queue__struct}{pmac\_cmd\_queue\_t} *rtn;

  pthread\_mutex\_lock( &\hyperlink{lspmac_8c_acc1bb77b9bcbc4d970f841a41fd274b3}{pmac\_queue\_mutex});

  \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_ad62b1f9e907acc3de9f3d6a05d55829e}{ethCmdOn} == \hyperlink{lspmac_8c_a7a78524ada402bb74759a3dfc5f8a571}{ethCmdReply})
    rtn = NULL;
  \textcolor{keywordflow}{else}
    rtn = &(\hyperlink{lspmac_8c_a69e569a833fe7f202b92e860d1548f2b}{ethCmdQueue}[(\hyperlink{lspmac_8c_a7a78524ada402bb74759a3dfc5f8a571}{ethCmdReply}++) % 
      \hyperlink{lspmac_8c_a3fae557baafab24b7518dc84f5ef5a9b}{PMAC\_CMD\_QUEUE\_LENGTH}]);

  pthread\_mutex\_unlock( &\hyperlink{lspmac_8c_acc1bb77b9bcbc4d970f841a41fd274b3}{pmac\_queue\_mutex});
  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a84a6096d9bfff2bfb1506a216756ae28}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-push\-\_\-queue@{lspmac\-\_\-push\-\_\-queue}}
\index{lspmac\-\_\-push\-\_\-queue@{lspmac\-\_\-push\-\_\-queue}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-push\-\_\-queue}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pmac\-\_\-cmd\-\_\-queue\-\_\-t}$\ast$ lspmac\-\_\-push\-\_\-queue (
\begin{DoxyParamCaption}
\item[{{\bf pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$}]{cmd}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a84a6096d9bfff2bfb1506a216756ae28}


Put a new command on the queue. 

Pointer is returned so caller can evaluate the time command was actually sent. 
\begin{DoxyParams}{Parameters}
{\em cmd} & Command to send to the P\-M\-A\-C \\
\hline
\end{DoxyParams}


Definition at line 513 of file lspmac.\-c.


\begin{DoxyCode}
                                      \{
  \hyperlink{structlspmac__cmd__queue__struct}{pmac\_cmd\_queue\_t} *rtn;

  pthread\_mutex\_lock( &\hyperlink{lspmac_8c_acc1bb77b9bcbc4d970f841a41fd274b3}{pmac\_queue\_mutex});
  rtn = &(\hyperlink{lspmac_8c_a69e569a833fe7f202b92e860d1548f2b}{ethCmdQueue}[(\hyperlink{lspmac_8c_ad62b1f9e907acc3de9f3d6a05d55829e}{ethCmdOn}++) % \hyperlink{lspmac_8c_a3fae557baafab24b7518dc84f5ef5a9b}{PMAC\_CMD\_QUEUE\_LENGTH}
      ]);
  memcpy( rtn, cmd, \textcolor{keyword}{sizeof}( \hyperlink{structlspmac__cmd__queue__struct}{pmac\_cmd\_queue\_t}));
  rtn->\hyperlink{structlspmac__cmd__queue__struct_a276ebc4b35c2554e4cb7377b60fd89b7}{time\_sent}.tv\_sec  = 0;
  rtn->\hyperlink{structlspmac__cmd__queue__struct_a276ebc4b35c2554e4cb7377b60fd89b7}{time\_sent}.tv\_nsec = 0;
  pthread\_cond\_signal( &\hyperlink{lspmac_8c_a8a25bd9c593c6985107f90f999ce0b08}{pmac\_queue\_cond});
  pthread\_mutex\_unlock( &\hyperlink{lspmac_8c_acc1bb77b9bcbc4d970f841a41fd274b3}{pmac\_queue\_mutex});

  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_aaedae34bc18ac1742a232117c125d7b9}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-\-Reset@{lspmac\-\_\-\-Reset}}
\index{lspmac\-\_\-\-Reset@{lspmac\-\_\-\-Reset}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-\-Reset}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-\-Reset (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_aaedae34bc18ac1742a232117c125d7b9}


Clear the queue and put the P\-M\-A\-C into a known state. 



Definition at line 634 of file lspmac.\-c.


\begin{DoxyCode}
                    \{
  \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state} = \hyperlink{lspmac_8c_a37741af675425d61c876cc30ae6c99d0}{LS\_PMAC\_STATE\_IDLE};

  \textcolor{comment}{// clear queue}
  \hyperlink{lspmac_8c_a7a78524ada402bb74759a3dfc5f8a571}{ethCmdReply} = \hyperlink{lspmac_8c_ad62b1f9e907acc3de9f3d6a05d55829e}{ethCmdOn};
  \hyperlink{lspmac_8c_ae85caec6f4ddb2fc52ca14a26549ab08}{ethCmdOff}   = \hyperlink{lspmac_8c_ad62b1f9e907acc3de9f3d6a05d55829e}{ethCmdOn};

  \hyperlink{lspmac_8c_ac5745f25f242edf02f7b9b7c77ed6126}{lspmac\_SockFlush}();
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a5afe5cd407b44f9c05ad4f1c4e4d5f6a}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-rlut@{lspmac\-\_\-rlut}}
\index{lspmac\-\_\-rlut@{lspmac\-\_\-rlut}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-rlut}]{\setlength{\rightskip}{0pt plus 5cm}double lspmac\-\_\-rlut (
\begin{DoxyParamCaption}
\item[{int}]{nlut, }
\item[{double $\ast$}]{lut, }
\item[{double}]{y}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a5afe5cd407b44f9c05ad4f1c4e4d5f6a}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em nlut} & number of entries in lookup table \\
\hline
\mbox{\tt in}  & {\em lut} & our lookup table \\
\hline
\mbox{\tt in}  & {\em y} & the y value for which we need an x \\
\hline
\end{DoxyParams}


Definition at line 349 of file lspmac.\-c.


\begin{DoxyCode}
                     \{
  \textcolor{keywordtype}{int} i, foundone, up;
  \textcolor{keywordtype}{double} m;
  \textcolor{keywordtype}{double} y1, y2, x1, x2, x;

  foundone = 0;
  \textcolor{keywordflow}{if}( lut != NULL && nlut > 1) \{

    \textcolor{keywordflow}{if}( lut[1] < lut[2*nlut-1])
      up = 1;
    \textcolor{keywordflow}{else}
      up = 0;

    \textcolor{keywordflow}{for}( i=0; i < 2*nlut; i += 2) \{
      x1 = lut[i];
      y1 = lut[i+1];
      \textcolor{keywordflow}{if}( i < 2*nlut - 2) \{
        x2 = lut[i+2];
        y2 = lut[i+3];
      \}
      \textcolor{keywordflow}{if}( i==0 && ( up ? y1 > y : y1 < y)) \{
        x = x1;
        foundone = 1;
        \textcolor{keywordflow}{break};
      \}
      \textcolor{keywordflow}{if}( y1 == y) \{
        x = x1;
        foundone = 1;
        \textcolor{keywordflow}{break};
      \}
      \textcolor{keywordflow}{if}( (i < 2*nlut-2) && (up ? y < y2 : y > y2)) \{
        m = (x2 - x1) / (y2 - y1);
        x = m * (y - y1) + x1;
        foundone = 1;
        \textcolor{keywordflow}{break};
      \}
    \}
    \textcolor{keywordflow}{if}( foundone == 0 ) \{
      x = lut[2*(nlut-1)];
    \}
    \textcolor{keywordflow}{return} x;
  \}
  \textcolor{keywordflow}{return} 0.0;
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a3a7fb93fb3fb9c4454613f30bfb0b1ee}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-run@{lspmac\-\_\-run}}
\index{lspmac\-\_\-run@{lspmac\-\_\-run}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-run}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-run (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a3a7fb93fb3fb9c4454613f30bfb0b1ee}


Start up the lspmac thread. 



Definition at line 2190 of file lspmac.\-c.


\begin{DoxyCode}
                  \{
  pthread\_create( &\hyperlink{lspmac_8c_a6b7011dd7d2c2d3afadff8d3e50e7677}{pmac\_thread}, NULL, \hyperlink{lspmac_8c_abdec5883055967b1eda043670870f55f}{lspmac\_worker}, 
      NULL);
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a1e472a11df3765763c2fe92dd358bf0c}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-send\-\_\-command@{lspmac\-\_\-send\-\_\-command}}
\index{lspmac\-\_\-send\-\_\-command@{lspmac\-\_\-send\-\_\-command}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-send\-\_\-command}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pmac\-\_\-cmd\-\_\-queue\-\_\-t}$\ast$ lspmac\-\_\-send\-\_\-command (
\begin{DoxyParamCaption}
\item[{int}]{rq\-Type, }
\item[{int}]{rq, }
\item[{int}]{w\-Value, }
\item[{int}]{w\-Index, }
\item[{int}]{w\-Length, }
\item[{unsigned char $\ast$}]{data, }
\item[{void($\ast$)({\bf pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$, int, unsigned char $\ast$)}]{response\-C\-B, }
\item[{int}]{no\-\_\-reply}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a1e472a11df3765763c2fe92dd358bf0c}


Compose a packet and send it to the P\-M\-A\-C. 

This is the meat of the P\-M\-A\-C communications routines. The queued command is returned. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em rq\-Type} & V\-R\-\_\-\-U\-P\-L\-O\-A\-D or V\-R\-\_\-\-D\-O\-W\-N\-L\-O\-A\-D \\
\hline
\mbox{\tt in}  & {\em rq} & P\-M\-A\-C command (see P\-M\-A\-C User Manual \\
\hline
\mbox{\tt in}  & {\em w\-Value} & Command argument 1 \\
\hline
\mbox{\tt in}  & {\em w\-Index} & Command argument 2 \\
\hline
\mbox{\tt in}  & {\em w\-Length} & Length of data array \\
\hline
\mbox{\tt in}  & {\em data} & Data array (or N\-U\-L\-L) \\
\hline
\mbox{\tt in}  & {\em response\-C\-B} & Function to call when a response is read from the P\-M\-A\-C \\
\hline
\mbox{\tt in}  & {\em no\-\_\-reply} & Flag, non-\/zero means no reply is expected \\
\hline
\end{DoxyParams}


Definition at line 575 of file lspmac.\-c.


\begin{DoxyCode}
                                        \{
  \textcolor{keyword}{static} \hyperlink{structlspmac__cmd__queue__struct}{pmac\_cmd\_queue\_t} cmd;

  cmd.\hyperlink{structlspmac__cmd__queue__struct_a9ac7618bbe0faa3001e8efeb1d89010d}{pcmd}.\hyperlink{structtagEthernetCmd_a6a155eb3ae546dd29369c4a33ddb3310}{RequestType} = rqType;
  cmd.\hyperlink{structlspmac__cmd__queue__struct_a9ac7618bbe0faa3001e8efeb1d89010d}{pcmd}.\hyperlink{structtagEthernetCmd_a0dc566e7edbb226f1a4ea443d93d56e2}{Request}     = rq;
  cmd.\hyperlink{structlspmac__cmd__queue__struct_a9ac7618bbe0faa3001e8efeb1d89010d}{pcmd}.\hyperlink{structtagEthernetCmd_aec0ee9a5f6c7e3bc6e4bd98f1bd52783}{wValue}      = htons(wValue);
  cmd.\hyperlink{structlspmac__cmd__queue__struct_a9ac7618bbe0faa3001e8efeb1d89010d}{pcmd}.\hyperlink{structtagEthernetCmd_a92f5a374e87d4f496b64b4888850d6e6}{wIndex}      = htons(wIndex);
  cmd.\hyperlink{structlspmac__cmd__queue__struct_a9ac7618bbe0faa3001e8efeb1d89010d}{pcmd}.\hyperlink{structtagEthernetCmd_af5df25ff13ca30fa33719d0df1ab7e97}{wLength}     = htons(wLength);
  cmd.\hyperlink{structlspmac__cmd__queue__struct_afe92c0bab9f124314a6f3d8104c94364}{onResponse}       = responseCB;
  cmd.\hyperlink{structlspmac__cmd__queue__struct_a33f70b45f8b7c27935cd3efe28748479}{no\_reply}         = no\_reply;

  \textcolor{comment}{//}
  \textcolor{comment}{// Setting the message buff bData requires a bit more care to avoid over
       filling it}
  \textcolor{comment}{// or sending garbage in the unused bytes.}
  \textcolor{comment}{//}

  \textcolor{keywordflow}{if}( wLength > \textcolor{keyword}{sizeof}( cmd.\hyperlink{structlspmac__cmd__queue__struct_a9ac7618bbe0faa3001e8efeb1d89010d}{pcmd}.\hyperlink{structtagEthernetCmd_a872dab798127d6f589974a79c5d0aef1}{bData})) \{
    \textcolor{comment}{//}
    \textcolor{comment}{// Bad things happen if we do not catch this case.}
    \textcolor{comment}{//}
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Message Length %d longer than
       maximum of %ld, aborting"}, wLength, \textcolor{keyword}{sizeof}( cmd.\hyperlink{structlspmac__cmd__queue__struct_a9ac7618bbe0faa3001e8efeb1d89010d}{pcmd}.\hyperlink{structtagEthernetCmd_a872dab798127d6f589974a79c5d0aef1}{bData}));
    exit( -1);
  \}
  \textcolor{keywordflow}{if}( data == NULL) \{
    memset( cmd.\hyperlink{structlspmac__cmd__queue__struct_a9ac7618bbe0faa3001e8efeb1d89010d}{pcmd}.\hyperlink{structtagEthernetCmd_a872dab798127d6f589974a79c5d0aef1}{bData}, 0, \textcolor{keyword}{sizeof}( cmd.\hyperlink{structlspmac__cmd__queue__struct_a9ac7618bbe0faa3001e8efeb1d89010d}{pcmd}.\hyperlink{structtagEthernetCmd_a872dab798127d6f589974a79c5d0aef1}{bData}));
  \} \textcolor{keywordflow}{else} \{
    \textcolor{comment}{//}
    \textcolor{comment}{// This could leave bData non-null terminated.  I do not know if this is a
       problem.}
    \textcolor{comment}{//}
    \textcolor{keywordflow}{if}( wLength > 0)
      memcpy( cmd.\hyperlink{structlspmac__cmd__queue__struct_a9ac7618bbe0faa3001e8efeb1d89010d}{pcmd}.\hyperlink{structtagEthernetCmd_a872dab798127d6f589974a79c5d0aef1}{bData}, data, wLength);
    \textcolor{keywordflow}{if}( wLength < \textcolor{keyword}{sizeof}( cmd.\hyperlink{structlspmac__cmd__queue__struct_a9ac7618bbe0faa3001e8efeb1d89010d}{pcmd}.\hyperlink{structtagEthernetCmd_a872dab798127d6f589974a79c5d0aef1}{bData}))
      memset( cmd.\hyperlink{structlspmac__cmd__queue__struct_a9ac7618bbe0faa3001e8efeb1d89010d}{pcmd}.\hyperlink{structtagEthernetCmd_a872dab798127d6f589974a79c5d0aef1}{bData} + wLength, 0, \textcolor{keyword}{sizeof}( cmd.\hyperlink{structlspmac__cmd__queue__struct_a9ac7618bbe0faa3001e8efeb1d89010d}{pcmd}.\hyperlink{structtagEthernetCmd_a872dab798127d6f589974a79c5d0aef1}{bData}
      ) - wLength);
  \}

  \textcolor{keywordflow}{return} \hyperlink{lspmac_8c_a84a6096d9bfff2bfb1506a216756ae28}{lspmac\_push\_queue}( &cmd);
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_abc3ef9890ab5c4e00d14ccd0d360fb05}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-sendcmd@{lspmac\-\_\-sendcmd}}
\index{lspmac\-\_\-sendcmd@{lspmac\-\_\-sendcmd}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-sendcmd}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-sendcmd (
\begin{DoxyParamCaption}
\item[{void($\ast$)({\bf pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$, int, unsigned char $\ast$)}]{response\-C\-B, }
\item[{char $\ast$}]{fmt, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_abc3ef9890ab5c4e00d14ccd0d360fb05}


P\-M\-A\-C command with call back. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em response\-C\-B} & our callback routine \\
\hline
\mbox{\tt in}  & {\em fmt} & printf style format string \\
\hline
\end{DoxyParams}


Definition at line 1590 of file lspmac.\-c.


\begin{DoxyCode}
                          \{
  \textcolor{keyword}{static} \textcolor{keywordtype}{char} tmps[1024];
  va\_list arg\_ptr;

  va\_start( arg\_ptr, fmt);
  vsnprintf( tmps, \textcolor{keyword}{sizeof}(tmps)-1, fmt, arg\_ptr);
  tmps[\textcolor{keyword}{sizeof}(tmps)-1]=0;
  va\_end( arg\_ptr);

  \hyperlink{lspmac_8c_a1e472a11df3765763c2fe92dd358bf0c}{lspmac\_send\_command}( \hyperlink{lspmac_8c_af24ecdc10723dc8fd6320fef416ae514}{VR\_DOWNLOAD}, 
      \hyperlink{lspmac_8c_a772b2ea2ad93989ae4275c79a93525ee}{VR\_PMAC\_SENDLINE}, 0, 0, strlen(tmps), tmps, responseCB, 0);
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_aa9bbf5ae34ce793d3d72945c64c43948}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-sendcmd\-\_\-nocb@{lspmac\-\_\-sendcmd\-\_\-nocb}}
\index{lspmac\-\_\-sendcmd\-\_\-nocb@{lspmac\-\_\-sendcmd\-\_\-nocb}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-sendcmd\-\_\-nocb}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-sendcmd\-\_\-nocb (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{fmt, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_aa9bbf5ae34ce793d3d72945c64c43948}


Send a command that does not need to deal with the reply. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em fmt} & A printf style format string \\
\hline
\end{DoxyParams}


Definition at line 1571 of file lspmac.\-c.


\begin{DoxyCode}
                           \{
  \textcolor{keyword}{static} \textcolor{keywordtype}{char} tmps[1024];
  va\_list arg\_ptr;

  va\_start( arg\_ptr, fmt);
  vsnprintf( tmps, \textcolor{keyword}{sizeof}(tmps)-1, fmt, arg\_ptr);
  tmps[\textcolor{keyword}{sizeof}(tmps)-1]=0;
  va\_end( arg\_ptr);

  \hyperlink{lspmac_8c_a1e472a11df3765763c2fe92dd358bf0c}{lspmac\_send\_command}( \hyperlink{lspmac_8c_af24ecdc10723dc8fd6320fef416ae514}{VR\_DOWNLOAD}, 
      \hyperlink{lspmac_8c_a772b2ea2ad93989ae4275c79a93525ee}{VR\_PMAC\_SENDLINE}, 0, 0, strlen(tmps), tmps, NULL, 0);
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_ac23af52b8d3a8f2722d4804d5340fa6c}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-\-Send\-Control\-Reply\-Print\-C\-B@{lspmac\-\_\-\-Send\-Control\-Reply\-Print\-C\-B}}
\index{lspmac\-\_\-\-Send\-Control\-Reply\-Print\-C\-B@{lspmac\-\_\-\-Send\-Control\-Reply\-Print\-C\-B}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-\-Send\-Control\-Reply\-Print\-C\-B}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-\-Send\-Control\-Reply\-Print\-C\-B (
\begin{DoxyParamCaption}
\item[{{\bf pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$}]{cmd, }
\item[{int}]{nreceived, }
\item[{unsigned char $\ast$}]{buff}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_ac23af52b8d3a8f2722d4804d5340fa6c}


Receive a reply to a control character Print a \char`\"{}printable\char`\"{} version of the character to the terminal Followed by a hex dump of the response. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em cmd} & Queue item this is a reply to \\
\hline
\mbox{\tt in}  & {\em nreceived} & Number of bytes received \\
\hline
\mbox{\tt in}  & {\em buff} & Buffer of bytes received \\
\hline
\end{DoxyParams}


Definition at line 893 of file lspmac.\-c.


\begin{DoxyCode}
                                      \{
    pthread\_mutex\_lock( &\hyperlink{pgpmac_8c_ad128c64890c7c0d4f836d9ec6e99216a}{ncurses\_mutex});
    wprintw( \hyperlink{pgpmac_8c_a65daf0f4a5bc6def23a9df98ff5ca57e}{term\_output}, \textcolor{stringliteral}{"control-%c: "}, \textcolor{charliteral}{'@'}+ ntohs(cmd->\hyperlink{structlspmac__cmd__queue__struct_a9ac7618bbe0faa3001e8efeb1d89010d}{pcmd}.
      \hyperlink{structtagEthernetCmd_aec0ee9a5f6c7e3bc6e4bd98f1bd52783}{wValue}));
    pthread\_mutex\_unlock( &\hyperlink{pgpmac_8c_ad128c64890c7c0d4f836d9ec6e99216a}{ncurses\_mutex});
    \hyperlink{lspmac_8c_a1c3786f3a38724f497afc4fe6d82d8c4}{hex\_dump}( nreceived, buff);
    pthread\_mutex\_lock( &\hyperlink{pgpmac_8c_ad128c64890c7c0d4f836d9ec6e99216a}{ncurses\_mutex});
    wnoutrefresh( \hyperlink{pgpmac_8c_a65daf0f4a5bc6def23a9df98ff5ca57e}{term\_output});
    wnoutrefresh( \hyperlink{pgpmac_8c_ab0487111dbe3c05d0bd835eb2fb9a3f7}{term\_input});
    doupdate();
    pthread\_mutex\_unlock( &\hyperlink{pgpmac_8c_ad128c64890c7c0d4f836d9ec6e99216a}{ncurses\_mutex});
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_af3fa79868ba88f7c37f7b8f7d53149ff}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-\-Service@{lspmac\-\_\-\-Service}}
\index{lspmac\-\_\-\-Service@{lspmac\-\_\-\-Service}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-\-Service}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-\-Service (
\begin{DoxyParamCaption}
\item[{struct pollfd $\ast$}]{evt}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_af3fa79868ba88f7c37f7b8f7d53149ff}


Service routine for packet coming from the P\-M\-A\-C. 

All communications is asynchronous so this is the only place incomming packets are handled 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em evt} & pollfd object returned by poll \\
\hline
\end{DoxyParams}


Definition at line 681 of file lspmac.\-c.


\begin{DoxyCode}
                      \{
  \textcolor{keyword}{static} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *receiveBuffer = NULL;   \textcolor{comment}{// the buffer inwhich to stick
       our incomming characters}
  \textcolor{keyword}{static} \textcolor{keywordtype}{int} receiveBufferSize = 0;             \textcolor{comment}{// size of receiveBuffer}
  \textcolor{keyword}{static} \textcolor{keywordtype}{int} receiveBufferIn = 0;               \textcolor{comment}{// next location to write to in
       receiveBuffer}
  \hyperlink{structlspmac__cmd__queue__struct}{pmac\_cmd\_queue\_t} *cmd;                        \textcolor{comment}{// maybe the
       command we are servicing}
  ssize\_t nsent, nread;                         \textcolor{comment}{// nbytes dealt with}
  \textcolor{keywordtype}{int} i;                                        \textcolor{comment}{// loop counter}
  \textcolor{keywordtype}{int} foundEOCR;                                \textcolor{comment}{// end of command response flag}

  \textcolor{keywordflow}{if}( evt->revents & (POLLERR | POLLHUP | POLLNVAL)) \{
    \textcolor{keywordflow}{if}( evt->fd != -1) \{
      close( evt->fd);
      evt->fd = -1;
    \}
    \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state} = \hyperlink{lspmac_8c_a7eb86ecf0789ab9555de1e03a4c73567}{LS\_PMAC\_STATE\_DETACHED};
    \textcolor{keywordflow}{return};
  \}


  \textcolor{keywordflow}{if}( evt->revents & POLLOUT) \{

    \textcolor{keywordflow}{switch}( \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state}) \{
    \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_a7eb86ecf0789ab9555de1e03a4c73567}{LS\_PMAC\_STATE\_DETACHED}:
      \textcolor{keywordflow}{break};
    \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_a37741af675425d61c876cc30ae6c99d0}{LS\_PMAC\_STATE\_IDLE}:
      \textcolor{keywordflow}{break};

    \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_a7d8f34fc599cc08c1a9d2cd62ccbb20a}{LS\_PMAC\_STATE\_SC}:
      cmd = \hyperlink{lspmac_8c_a9627f30135aa7007bc4ab8dde905739a}{lspmac\_pop\_queue}();
      \textcolor{keywordflow}{if}( cmd != NULL) \{
        \textcolor{keywordflow}{if}( cmd->\hyperlink{structlspmac__cmd__queue__struct_a9ac7618bbe0faa3001e8efeb1d89010d}{pcmd}.\hyperlink{structtagEthernetCmd_a0dc566e7edbb226f1a4ea443d93d56e2}{Request} == \hyperlink{lspmac_8c_af9c53e7c5b2681a5ca1c5410a914a2dc}{VR\_PMAC\_GETMEM}) \{
          nsent = send( evt->fd, cmd, \hyperlink{lspmac_8c_abdc45e3f7106f84f688419e2da9b3627}{pmac\_cmd\_size}, 0);
          \textcolor{keywordflow}{if}( nsent != \hyperlink{lspmac_8c_abdc45e3f7106f84f688419e2da9b3627}{pmac\_cmd\_size}) \{
            \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Could only send %d of
       %d bytes....Not good."}, (\textcolor{keywordtype}{int})nsent, (\textcolor{keywordtype}{int})(\hyperlink{lspmac_8c_abdc45e3f7106f84f688419e2da9b3627}{pmac\_cmd\_size}));
          \}
        \} \textcolor{keywordflow}{else} \{
          nsent = send( evt->fd, cmd, \hyperlink{lspmac_8c_abdc45e3f7106f84f688419e2da9b3627}{pmac\_cmd\_size} + ntohs(cmd->
      \hyperlink{structlspmac__cmd__queue__struct_a9ac7618bbe0faa3001e8efeb1d89010d}{pcmd}.\hyperlink{structtagEthernetCmd_af5df25ff13ca30fa33719d0df1ab7e97}{wLength}), 0);
          gettimeofday( &pmac\_time\_sent, NULL);
          \textcolor{keywordflow}{if}( nsent != \hyperlink{lspmac_8c_abdc45e3f7106f84f688419e2da9b3627}{pmac\_cmd\_size} + ntohs(cmd->\hyperlink{structlspmac__cmd__queue__struct_a9ac7618bbe0faa3001e8efeb1d89010d}{pcmd}.\hyperlink{structtagEthernetCmd_af5df25ff13ca30fa33719d0df1ab7e97}{wLength}
      )) \{
            \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Could only send %d of
       %d bytes....Not good."}, (\textcolor{keywordtype}{int})nsent, (\textcolor{keywordtype}{int})(\hyperlink{lspmac_8c_abdc45e3f7106f84f688419e2da9b3627}{pmac\_cmd\_size} + ntohs(cmd
      ->\hyperlink{structlspmac__cmd__queue__struct_a9ac7618bbe0faa3001e8efeb1d89010d}{pcmd}.\hyperlink{structtagEthernetCmd_af5df25ff13ca30fa33719d0df1ab7e97}{wLength})));
          \}
        \}
      \}
      \textcolor{keywordflow}{if}( cmd->\hyperlink{structlspmac__cmd__queue__struct_a9ac7618bbe0faa3001e8efeb1d89010d}{pcmd}.\hyperlink{structtagEthernetCmd_a0dc566e7edbb226f1a4ea443d93d56e2}{Request} == \hyperlink{lspmac_8c_a76c1c401354826ac2ba8906578be930f}{VR\_PMAC\_SENDCTRLCHAR}
      )
        \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state} = \hyperlink{lspmac_8c_adef540911028fda73e8bbf0aa6ad39e9}{LS\_PMAC\_STATE\_WACK\_CC}
      ;
      \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( cmd->\hyperlink{structlspmac__cmd__queue__struct_a9ac7618bbe0faa3001e8efeb1d89010d}{pcmd}.\hyperlink{structtagEthernetCmd_a0dc566e7edbb226f1a4ea443d93d56e2}{Request} == \hyperlink{lspmac_8c_af9c53e7c5b2681a5ca1c5410a914a2dc}{VR\_PMAC\_GETMEM})
        \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state} = \hyperlink{lspmac_8c_a220b39710719cfe8b500d51819e8efeb}{LS\_PMAC\_STATE\_GMR};
      \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( cmd->\hyperlink{structlspmac__cmd__queue__struct_a33f70b45f8b7c27935cd3efe28748479}{no\_reply} == 0)
        \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state} = \hyperlink{lspmac_8c_a5eba9ef09d4316e803b9d75bd3104f43}{LS\_PMAC\_STATE\_WACK};
      \textcolor{keywordflow}{else}
        \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state} = \hyperlink{lspmac_8c_a63356b0c18fcb186f456c12c6e927d84}{LS\_PMAC\_STATE\_WACK\_NFR}
      ;
      \textcolor{keywordflow}{break};

    \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_abbd709b56a71eb1fc6adc9063605d243}{LS\_PMAC\_STATE\_CR}:
      nsent = send( evt->fd, &\hyperlink{lspmac_8c_a8908812f4ff25c196679e00d330edd81}{cr\_cmd}, \hyperlink{lspmac_8c_abdc45e3f7106f84f688419e2da9b3627}{pmac\_cmd\_size}, 0);
      gettimeofday( &pmac\_time\_sent, NULL);
      \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state} = \hyperlink{lspmac_8c_a27ee6c39d58604c8aa9bd6c249c4833f}{LS\_PMAC\_STATE\_WCR};
      \textcolor{keywordflow}{break};

    \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_add5325f4a84e4fe05f558880349485ea}{LS\_PMAC\_STATE\_RR}:
      nsent = send( evt->fd, &\hyperlink{lspmac_8c_a6fcbbe47fe9912533962601f5befdb29}{rr\_cmd}, \hyperlink{lspmac_8c_abdc45e3f7106f84f688419e2da9b3627}{pmac\_cmd\_size}, 0);
      gettimeofday( &pmac\_time\_sent, NULL);
      \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state} = \hyperlink{lspmac_8c_a3e0a62cd9a1212419ad3615c34bdc65a}{LS\_PMAC\_STATE\_WACK\_RR};
      \textcolor{keywordflow}{break};

    \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_a5f4ff8874677aac48a4c675f2c1ca4e9}{LS\_PMAC\_STATE\_GB}:
      nsent = send( evt->fd, &\hyperlink{lspmac_8c_ae7b21213b9c78b6745213409f1ef7320}{gb\_cmd}, \hyperlink{lspmac_8c_abdc45e3f7106f84f688419e2da9b3627}{pmac\_cmd\_size}, 0);
      gettimeofday( &pmac\_time\_sent, NULL);
      \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state} = \hyperlink{lspmac_8c_a591822cc92f76a39b293c2e90b322db2}{LS\_PMAC\_STATE\_WGB};
      \textcolor{keywordflow}{break};
    \}
  \}

  \textcolor{keywordflow}{if}( evt->revents & POLLIN) \{

    \textcolor{keywordflow}{if}( receiveBufferSize - receiveBufferIn < 1400) \{
      \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *newbuff;

      receiveBufferSize += 1400;
      newbuff = calloc( receiveBufferSize, \textcolor{keyword}{sizeof}( \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}));
      \textcolor{keywordflow}{if}( newbuff == NULL) \{
        \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Out of memory"});
        exit( -1);
      \}
      memcpy( newbuff, receiveBuffer, receiveBufferIn);
      receiveBuffer = newbuff;
    \}

    nread = read( evt->fd, receiveBuffer + receiveBufferIn, 1400);

    foundEOCR = 0;
    \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state} == \hyperlink{lspmac_8c_a220b39710719cfe8b500d51819e8efeb}{LS\_PMAC\_STATE\_GMR}) \{
      \textcolor{comment}{//}
      \textcolor{comment}{// get memory returns binary stuff, don't try to parse it}
      \textcolor{comment}{//}
      receiveBufferIn += nread;
    \} \textcolor{keywordflow}{else} \{
      \textcolor{comment}{//}
      \textcolor{comment}{// other commands end in 6 if OK, 7 if not}
      \textcolor{comment}{//}
      \textcolor{keywordflow}{for}( i=receiveBufferIn; i<receiveBufferIn+nread; i++) \{
        \textcolor{keywordflow}{if}( receiveBuffer[i] == 7) \{
          \textcolor{comment}{//}
          \textcolor{comment}{// Error condition}
          \textcolor{comment}{//}
          \hyperlink{lspmac_8c_a2442c529b024e9c23c4acef8c1eb8689}{lspmac\_Error}( &(receiveBuffer[i]));
          receiveBufferIn = 0;
          \textcolor{keywordflow}{return};
        \}
        \textcolor{keywordflow}{if}( receiveBuffer[i] == 6) \{
          \textcolor{comment}{//}
          \textcolor{comment}{// End of command response}
          \textcolor{comment}{//}
          foundEOCR = 1;
          receiveBuffer[i] = 0;
          \textcolor{keywordflow}{break};
        \}
      \}
      receiveBufferIn = i;
    \}

    cmd = NULL;

    \textcolor{keywordflow}{switch}( \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state}) \{
    \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_a63356b0c18fcb186f456c12c6e927d84}{LS\_PMAC\_STATE\_WACK\_NFR}:
      receiveBuffer[--receiveBufferIn] = 0;
      cmd = \hyperlink{lspmac_8c_a0f60f18dfe11c1c0299909521596be8f}{lspmac\_pop\_reply}();
      \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state} = \hyperlink{lspmac_8c_a37741af675425d61c876cc30ae6c99d0}{LS\_PMAC\_STATE\_IDLE};
      \textcolor{keywordflow}{break};
    \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_a5eba9ef09d4316e803b9d75bd3104f43}{LS\_PMAC\_STATE\_WACK}:
      receiveBuffer[--receiveBufferIn] = 0;
      \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state} = \hyperlink{lspmac_8c_add5325f4a84e4fe05f558880349485ea}{LS\_PMAC\_STATE\_RR};
      \textcolor{keywordflow}{break};
    \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_adef540911028fda73e8bbf0aa6ad39e9}{LS\_PMAC\_STATE\_WACK\_CC}:
      receiveBuffer[--receiveBufferIn] = 0;
      \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state} = \hyperlink{lspmac_8c_abbd709b56a71eb1fc6adc9063605d243}{LS\_PMAC\_STATE\_CR};
      \textcolor{keywordflow}{break};
    \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_a3e0a62cd9a1212419ad3615c34bdc65a}{LS\_PMAC\_STATE\_WACK\_RR}:
      receiveBufferIn -= 2;
      \textcolor{keywordflow}{if}( receiveBuffer[receiveBufferIn])
        \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state} = \hyperlink{lspmac_8c_a5f4ff8874677aac48a4c675f2c1ca4e9}{LS\_PMAC\_STATE\_GB};
      \textcolor{keywordflow}{else}
        \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state} = \hyperlink{lspmac_8c_add5325f4a84e4fe05f558880349485ea}{LS\_PMAC\_STATE\_RR};
      receiveBuffer[receiveBufferIn] = 0;
      \textcolor{keywordflow}{break};
    \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_a220b39710719cfe8b500d51819e8efeb}{LS\_PMAC\_STATE\_GMR}:
      cmd = \hyperlink{lspmac_8c_a0f60f18dfe11c1c0299909521596be8f}{lspmac\_pop\_reply}();
      \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state} = \hyperlink{lspmac_8c_a37741af675425d61c876cc30ae6c99d0}{LS\_PMAC\_STATE\_IDLE};
      \textcolor{keywordflow}{break};

    \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_a27ee6c39d58604c8aa9bd6c249c4833f}{LS\_PMAC\_STATE\_WCR}:
      cmd = \hyperlink{lspmac_8c_a0f60f18dfe11c1c0299909521596be8f}{lspmac\_pop\_reply}();
      \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state} = \hyperlink{lspmac_8c_a37741af675425d61c876cc30ae6c99d0}{LS\_PMAC\_STATE\_IDLE};
      \textcolor{keywordflow}{break};
    \textcolor{keywordflow}{case} \hyperlink{lspmac_8c_a591822cc92f76a39b293c2e90b322db2}{LS\_PMAC\_STATE\_WGB}:
      \textcolor{keywordflow}{if}( foundEOCR) \{
        cmd = \hyperlink{lspmac_8c_a0f60f18dfe11c1c0299909521596be8f}{lspmac\_pop\_reply}();
        \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state} = \hyperlink{lspmac_8c_a37741af675425d61c876cc30ae6c99d0}{LS\_PMAC\_STATE\_IDLE};
      \} \textcolor{keywordflow}{else} \{
        \hyperlink{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{ls\_pmac\_state} = \hyperlink{lspmac_8c_add5325f4a84e4fe05f558880349485ea}{LS\_PMAC\_STATE\_RR};
      \}
      \textcolor{keywordflow}{break};
    \}


    \textcolor{keywordflow}{if}( cmd != NULL && cmd->\hyperlink{structlspmac__cmd__queue__struct_afe92c0bab9f124314a6f3d8104c94364}{onResponse} != NULL) \{
      cmd->\hyperlink{structlspmac__cmd__queue__struct_afe92c0bab9f124314a6f3d8104c94364}{onResponse}( cmd, receiveBufferIn, receiveBuffer);
      receiveBufferIn = 0;
    \}
  \}
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_ab81f07dea6bb0e88103a05a380de1034}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-shutter\-\_\-read@{lspmac\-\_\-shutter\-\_\-read}}
\index{lspmac\-\_\-shutter\-\_\-read@{lspmac\-\_\-shutter\-\_\-read}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-shutter\-\_\-read}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-shutter\-\_\-read (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{mp}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_ab81f07dea6bb0e88103a05a380de1034}


Fast shutter read routine The shutter is mildly complicated in that we need to take into account the fact that the shutter can open and close again between status updates. 

This means that we need to rely on a P\-C\-L program running in the P\-M\-A\-C to monitor the shutter state and let us know that this has happened. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em mp} & The motor object associated with the fast shutter \\
\hline
\end{DoxyParams}


Definition at line 1053 of file lspmac.\-c.


\begin{DoxyCode}
                           \{
  \textcolor{comment}{//}
  \textcolor{comment}{// track the shutter state and signal if it has changed}
  \textcolor{comment}{//}
  pthread\_mutex\_lock( &\hyperlink{lspmac_8c_a1b78a13c654409333569815e1c109d38}{lspmac\_shutter\_mutex});
  \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_ab961c2ba24a1a8c95a88dec25319e712}{fs\_has\_opened} && !
      \hyperlink{lspmac_8c_a396fbf06208de3ecbe1b0df549f1cd46}{lspmac\_shutter\_has\_opened} && !\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.
      \hyperlink{structmd2StatusStruct_aca3722c109e6646bd41fb269a32261f2}{fs\_is\_open}) \{
    \textcolor{comment}{//}
    \textcolor{comment}{// Here the shutter opened and closed again before we got the memo}
    \textcolor{comment}{// Treat it as a shutter closed event}
    \textcolor{comment}{//}
    pthread\_cond\_signal( &\hyperlink{lspmac_8c_afbd51c2cefcee87afe994c9e9f372241}{lspmac\_shutter\_cond});
  \}
  \hyperlink{lspmac_8c_a396fbf06208de3ecbe1b0df549f1cd46}{lspmac\_shutter\_has\_opened} = \hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.
      \hyperlink{structmd2StatusStruct_ab961c2ba24a1a8c95a88dec25319e712}{fs\_has\_opened};

  \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_a112158e0cd50449a440ac55c7af7bea2}{lspmac\_shutter\_state} !=  \hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.
      \hyperlink{structmd2StatusStruct_aca3722c109e6646bd41fb269a32261f2}{fs\_is\_open}) \{
    \hyperlink{lspmac_8c_a112158e0cd50449a440ac55c7af7bea2}{lspmac\_shutter\_state} = \hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_aca3722c109e6646bd41fb269a32261f2}{fs\_is\_open}
      ;
    pthread\_cond\_signal( &\hyperlink{lspmac_8c_afbd51c2cefcee87afe994c9e9f372241}{lspmac\_shutter\_cond});
  \}

  \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_aca3722c109e6646bd41fb269a32261f2}{fs\_is\_open}) \{
    mvwprintw( \hyperlink{pgpmac_8c_ae2d7da3afeb756716e6e4ee9cab78f8a}{term\_status2}, 1, 1, \textcolor{stringliteral}{"Shutter Open  "});
    mp->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position} = 1;
  \} \textcolor{keywordflow}{else} \{
    mvwprintw( \hyperlink{pgpmac_8c_ae2d7da3afeb756716e6e4ee9cab78f8a}{term\_status2}, 1, 1, \textcolor{stringliteral}{"Shutter Closed"});
    mp->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position} = 0;
  \}

  \textcolor{comment}{// Not sure what kind of status makes sense to report}
  mp->\hyperlink{structlspmac__motor__struct_ae4a6f54a98e7758d66228efebe8f3baa}{statuss}[0] = 0;

  pthread\_mutex\_unlock( &\hyperlink{lspmac_8c_a1b78a13c654409333569815e1c109d38}{lspmac\_shutter\_mutex});
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_ac5745f25f242edf02f7b9b7c77ed6126}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-\-Sock\-Flush@{lspmac\-\_\-\-Sock\-Flush}}
\index{lspmac\-\_\-\-Sock\-Flush@{lspmac\-\_\-\-Sock\-Flush}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-\-Sock\-Flush}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-\-Sock\-Flush (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_ac5745f25f242edf02f7b9b7c77ed6126}


Reset the P\-M\-A\-C socket from the P\-M\-A\-C side. 

Puts the P\-M\-A\-C into a known communications state 

Definition at line 627 of file lspmac.\-c.


\begin{DoxyCode}
                        \{
  \hyperlink{lspmac_8c_a1e472a11df3765763c2fe92dd358bf0c}{lspmac\_send\_command}( \hyperlink{lspmac_8c_af24ecdc10723dc8fd6320fef416ae514}{VR\_DOWNLOAD}, \hyperlink{lspmac_8c_ac0e5588681366b52589cd321eabf12ff}{VR\_PMAC\_FLUSH}
      , 0, 0, 0, NULL, NULL, 1);
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a0a56c777b1469ad8c3d29d825a71e300}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-\-Sock\-Getmem@{lspmac\-\_\-\-Sock\-Getmem}}
\index{lspmac\-\_\-\-Sock\-Getmem@{lspmac\-\_\-\-Sock\-Getmem}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-\-Sock\-Getmem}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pmac\-\_\-cmd\-\_\-queue\-\_\-t}$\ast$ lspmac\-\_\-\-Sock\-Getmem (
\begin{DoxyParamCaption}
\item[{int}]{offset, }
\item[{int}]{nbytes}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a0a56c777b1469ad8c3d29d825a71e300}


Request a chunk of memory to be returned. 

Not currently used 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em offset} & Offset in P\-M\-A\-C Double Buffer \\
\hline
\mbox{\tt in}  & {\em nbytes} & Number of bytes to request \\
\hline
\end{DoxyParams}


Definition at line 930 of file lspmac.\-c.


\begin{DoxyCode}
                                       \{
  \textcolor{keywordflow}{return} \hyperlink{lspmac_8c_a1e472a11df3765763c2fe92dd358bf0c}{lspmac\_send\_command}( \hyperlink{lspmac_8c_a5485d08fdc80533b5cebadff63696ed2}{VR\_UPLOAD},   
      \hyperlink{lspmac_8c_af9c53e7c5b2681a5ca1c5410a914a2dc}{VR\_PMAC\_GETMEM}, offset, 0, nbytes, NULL, \hyperlink{lspmac_8c_aaa3323f952efd66e63ff864932da5ced}{lspmac\_GetmemReplyCB}
      , 0);
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_a53ee9ff1a8ca316901babf8314b423de}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-\-Sock\-Send\-Control\-Char\-Print@{lspmac\-\_\-\-Sock\-Send\-Control\-Char\-Print}}
\index{lspmac\-\_\-\-Sock\-Send\-Control\-Char\-Print@{lspmac\-\_\-\-Sock\-Send\-Control\-Char\-Print}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-\-Sock\-Send\-Control\-Char\-Print}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pmac\-\_\-cmd\-\_\-queue\-\_\-t}$\ast$ lspmac\-\_\-\-Sock\-Send\-Control\-Char\-Print (
\begin{DoxyParamCaption}
\item[{char}]{c}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_a53ee9ff1a8ca316901babf8314b423de}


Send a control character. 


\begin{DoxyParams}{Parameters}
{\em c} & The control character to send \\
\hline
\end{DoxyParams}


Definition at line 978 of file lspmac.\-c.


\begin{DoxyCode}
                                                    \{
  \textcolor{keywordflow}{return} \hyperlink{lspmac_8c_a1e472a11df3765763c2fe92dd358bf0c}{lspmac\_send\_command}( \hyperlink{lspmac_8c_af24ecdc10723dc8fd6320fef416ae514}{VR\_DOWNLOAD}, 
      \hyperlink{lspmac_8c_a76c1c401354826ac2ba8906578be930f}{VR\_PMAC\_SENDCTRLCHAR}, c, 0, 0, NULL, 
      \hyperlink{lspmac_8c_ac23af52b8d3a8f2722d4804d5340fa6c}{lspmac\_SendControlReplyPrintCB}, 0);
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_aaa442d9bc7a3cdee39adea0724f0e18c}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-\-Sock\-Sendline@{lspmac\-\_\-\-Sock\-Sendline}}
\index{lspmac\-\_\-\-Sock\-Sendline@{lspmac\-\_\-\-Sock\-Sendline}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-\-Sock\-Sendline}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pmac\-\_\-cmd\-\_\-queue\-\_\-t}$\ast$ lspmac\-\_\-\-Sock\-Sendline (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{fmt, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_aaa442d9bc7a3cdee39adea0724f0e18c}


Send a one line command. 

Uses printf style arguments. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em fmt} & Printf style format string \\
\hline
\end{DoxyParams}


Definition at line 940 of file lspmac.\-c.


\begin{DoxyCode}
                                         \{
  va\_list arg\_ptr;
  \textcolor{keywordtype}{char} payload[1400];

  va\_start( arg\_ptr, fmt);
  vsnprintf( payload, \textcolor{keyword}{sizeof}(payload)-1, fmt, arg\_ptr);
  payload[ \textcolor{keyword}{sizeof}(payload)-1] = 0;
  va\_end( arg\_ptr);

  \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( payload);

  \textcolor{keywordflow}{return} \hyperlink{lspmac_8c_a1e472a11df3765763c2fe92dd358bf0c}{lspmac\_send\_command}( \hyperlink{lspmac_8c_af24ecdc10723dc8fd6320fef416ae514}{VR\_DOWNLOAD}, 
      \hyperlink{lspmac_8c_a772b2ea2ad93989ae4275c79a93525ee}{VR\_PMAC\_SENDLINE}, 0, 0, strlen( payload), payload, 
      \hyperlink{lspmac_8c_ac89b615b3ecb738c902c3c090d7c1dc3}{lspmac\_GetShortReplyCB}, 0);
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_ac4cf3a79186859714d8a8293377526ba}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-\-Sock\-Sendline\-\_\-nr@{lspmac\-\_\-\-Sock\-Sendline\-\_\-nr}}
\index{lspmac\-\_\-\-Sock\-Sendline\-\_\-nr@{lspmac\-\_\-\-Sock\-Sendline\-\_\-nr}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-\-Sock\-Sendline\-\_\-nr}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pmac\-\_\-cmd\-\_\-queue\-\_\-t}$\ast$ lspmac\-\_\-\-Sock\-Sendline\-\_\-nr (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{fmt, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_ac4cf3a79186859714d8a8293377526ba}


Send a command and ignore the response. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em fmt} & Printf style format string \\
\hline
\end{DoxyParams}


Definition at line 959 of file lspmac.\-c.


\begin{DoxyCode}
                                           \{
  va\_list arg\_ptr;
  \textcolor{keywordtype}{char} s[512];

  va\_start( arg\_ptr, fmt);
  vsnprintf( s, \textcolor{keyword}{sizeof}(s)-1, fmt, arg\_ptr);
  s[\textcolor{keyword}{sizeof}(s)-1] = 0;
  va\_end( arg\_ptr);

  \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( s);

  \textcolor{keywordflow}{return} \hyperlink{lspmac_8c_a1e472a11df3765763c2fe92dd358bf0c}{lspmac\_send\_command}( \hyperlink{lspmac_8c_af24ecdc10723dc8fd6320fef416ae514}{VR\_DOWNLOAD}, 
      \hyperlink{lspmac_8c_a772b2ea2ad93989ae4275c79a93525ee}{VR\_PMAC\_SENDLINE}, 0, 0, strlen( s), s, NULL, 1);
\}
\end{DoxyCode}
\hypertarget{lspmac_8c_abdec5883055967b1eda043670870f55f}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-worker@{lspmac\-\_\-worker}}
\index{lspmac\-\_\-worker@{lspmac\-\_\-worker}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-worker}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ lspmac\-\_\-worker (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{dummy}
\end{DoxyParamCaption}
)}}\label{lspmac_8c_abdec5883055967b1eda043670870f55f}


Our lspmac worker thread. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em dummy} & Unused but required by pthread library \\
\hline
\end{DoxyParams}


Definition at line 1717 of file lspmac.\-c.


\begin{DoxyCode}
                      \{

  \textcolor{keywordflow}{while}( 1) \{
    \textcolor{keywordtype}{int} pollrtn;

    \hyperlink{lspmac_8c_a68886d1b658e7b1d996c07e9dbcd9c15}{lspmac\_next\_state}();

    \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_adba7f5f4bbeabc4dac859221d4c684ba}{pmacfd}.fd == -1) \{
      sleep( 10);       \textcolor{comment}{// The pmac is not connected.  Should we warn someone?}
      \textcolor{comment}{//}
      \textcolor{comment}{// This just puts us into a holding pattern until the pmac becomes
       connected again}
      \textcolor{comment}{//}
      \textcolor{comment}{// TODO:}
      \textcolor{comment}{// Check PMAC initialization logic and our queues to ensure that it is
       sane to}
      \textcolor{comment}{// re-initialize things.  Probably bad things will happen.}
      \textcolor{comment}{//}
      \textcolor{keywordflow}{continue};
    \}

    pollrtn = poll( &\hyperlink{lspmac_8c_adba7f5f4bbeabc4dac859221d4c684ba}{pmacfd}, 1, 10);
    \textcolor{keywordflow}{if}( pollrtn) \{
      \hyperlink{lspmac_8c_af3fa79868ba88f7c37f7b8f7d53149ff}{lspmac\_Service}( &\hyperlink{lspmac_8c_adba7f5f4bbeabc4dac859221d4c684ba}{pmacfd});
    \}
  \}
\}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{lspmac_8c_a6cb218bdccfe5a93471c161f15a15cab}{\index{lspmac.\-c@{lspmac.\-c}!alignx@{alignx}}
\index{alignx@{alignx}!lspmac.c@{lspmac.\-c}}
\subsubsection[{alignx}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ alignx}}\label{lspmac_8c_a6cb218bdccfe5a93471c161f15a15cab}


Alignment stage X. 



Definition at line 74 of file lspmac.\-c.

\hypertarget{lspmac_8c_a737c246c3948e644a18d191a931e1acd}{\index{lspmac.\-c@{lspmac.\-c}!aligny@{aligny}}
\index{aligny@{aligny}!lspmac.c@{lspmac.\-c}}
\subsubsection[{aligny}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ aligny}}\label{lspmac_8c_a737c246c3948e644a18d191a931e1acd}


Alignment stage Y. 



Definition at line 75 of file lspmac.\-c.

\hypertarget{lspmac_8c_ae7642b1da0f7c7f8448104c691d40a12}{\index{lspmac.\-c@{lspmac.\-c}!alignz@{alignz}}
\index{alignz@{alignz}!lspmac.c@{lspmac.\-c}}
\subsubsection[{alignz}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ alignz}}\label{lspmac_8c_ae7642b1da0f7c7f8448104c691d40a12}


Alignment stage X. 



Definition at line 76 of file lspmac.\-c.

\hypertarget{lspmac_8c_aa90d2363b744acbd4d45133b7a716d8f}{\index{lspmac.\-c@{lspmac.\-c}!anal@{anal}}
\index{anal@{anal}!lspmac.c@{lspmac.\-c}}
\subsubsection[{anal}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ anal}}\label{lspmac_8c_aa90d2363b744acbd4d45133b7a716d8f}


Polaroid analyzer motor. 



Definition at line 77 of file lspmac.\-c.

\hypertarget{lspmac_8c_a139200ddaa9856a7ffcec0e6cbaa8f1b}{\index{lspmac.\-c@{lspmac.\-c}!apery@{apery}}
\index{apery@{apery}!lspmac.c@{lspmac.\-c}}
\subsubsection[{apery}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ apery}}\label{lspmac_8c_a139200ddaa9856a7ffcec0e6cbaa8f1b}


Aperture Y. 



Definition at line 79 of file lspmac.\-c.

\hypertarget{lspmac_8c_ab93bd6ee850b285ca3a95e64d15e9477}{\index{lspmac.\-c@{lspmac.\-c}!aperz@{aperz}}
\index{aperz@{aperz}!lspmac.c@{lspmac.\-c}}
\subsubsection[{aperz}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ aperz}}\label{lspmac_8c_ab93bd6ee850b285ca3a95e64d15e9477}


Aperture Z. 



Definition at line 80 of file lspmac.\-c.

\hypertarget{lspmac_8c_a85d6eaa4b4a82bb3112574f458d1dc50}{\index{lspmac.\-c@{lspmac.\-c}!blight@{blight}}
\index{blight@{blight}!lspmac.c@{lspmac.\-c}}
\subsubsection[{blight}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ blight}}\label{lspmac_8c_a85d6eaa4b4a82bb3112574f458d1dc50}


Back Light D\-A\-C. 



Definition at line 91 of file lspmac.\-c.

\hypertarget{lspmac_8c_af813a2eff0b7efa4c70633559054e84c}{\index{lspmac.\-c@{lspmac.\-c}!blight\-\_\-ud@{blight\-\_\-ud}}
\index{blight\-\_\-ud@{blight\-\_\-ud}!lspmac.c@{lspmac.\-c}}
\subsubsection[{blight\-\_\-ud}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ blight\-\_\-ud}}\label{lspmac_8c_af813a2eff0b7efa4c70633559054e84c}


Back Light Up/\-Down actuator. 



Definition at line 94 of file lspmac.\-c.

\hypertarget{lspmac_8c_a51358daaea8b5236f08414877d8af6c2}{\index{lspmac.\-c@{lspmac.\-c}!capy@{capy}}
\index{capy@{capy}!lspmac.c@{lspmac.\-c}}
\subsubsection[{capy}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ capy}}\label{lspmac_8c_a51358daaea8b5236f08414877d8af6c2}


Capillary Y. 



Definition at line 81 of file lspmac.\-c.

\hypertarget{lspmac_8c_aa45f268d0af9f3d465acfab128919718}{\index{lspmac.\-c@{lspmac.\-c}!capz@{capz}}
\index{capz@{capz}!lspmac.c@{lspmac.\-c}}
\subsubsection[{capz}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ capz}}\label{lspmac_8c_aa45f268d0af9f3d465acfab128919718}


Capillary Z. 



Definition at line 82 of file lspmac.\-c.

\hypertarget{lspmac_8c_ac940d950d9efeaf3f0ae67e9bf331188}{\index{lspmac.\-c@{lspmac.\-c}!cenx@{cenx}}
\index{cenx@{cenx}!lspmac.c@{lspmac.\-c}}
\subsubsection[{cenx}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ cenx}}\label{lspmac_8c_ac940d950d9efeaf3f0ae67e9bf331188}


Centering Table X. 



Definition at line 84 of file lspmac.\-c.

\hypertarget{lspmac_8c_aaed18e738ba7bfb6c771a44f5d7ea827}{\index{lspmac.\-c@{lspmac.\-c}!ceny@{ceny}}
\index{ceny@{ceny}!lspmac.c@{lspmac.\-c}}
\subsubsection[{ceny}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ ceny}}\label{lspmac_8c_aaed18e738ba7bfb6c771a44f5d7ea827}


Centering Table Y. 



Definition at line 85 of file lspmac.\-c.

\hypertarget{lspmac_8c_a8908812f4ff25c196679e00d330edd81}{\index{lspmac.\-c@{lspmac.\-c}!cr\-\_\-cmd@{cr\-\_\-cmd}}
\index{cr\-\_\-cmd@{cr\-\_\-cmd}!lspmac.c@{lspmac.\-c}}
\subsubsection[{cr\-\_\-cmd}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pmac\-\_\-cmd\-\_\-t} cr\-\_\-cmd\hspace{0.3cm}{\ttfamily [static]}}}\label{lspmac_8c_a8908812f4ff25c196679e00d330edd81}


commands to send out \char`\"{}readready\char`\"{}, \char`\"{}getbuffer\char`\"{}, controlresponse (initialized in main) 



Definition at line 140 of file lspmac.\-c.

\hypertarget{lspmac_8c_ae78d9a757d4c85419fff9c94b15e25d7}{\index{lspmac.\-c@{lspmac.\-c}!cryo@{cryo}}
\index{cryo@{cryo}!lspmac.c@{lspmac.\-c}}
\subsubsection[{cryo}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ cryo}}\label{lspmac_8c_ae78d9a757d4c85419fff9c94b15e25d7}


Move the cryostream towards or away from the crystal. 



Definition at line 95 of file lspmac.\-c.

\hypertarget{lspmac_8c_a9da2795d11ccbc3a060c4811770ad04c}{\index{lspmac.\-c@{lspmac.\-c}!dbmem@{dbmem}}
\index{dbmem@{dbmem}!lspmac.c@{lspmac.\-c}}
\subsubsection[{dbmem}]{\setlength{\rightskip}{0pt plus 5cm}unsigned char dbmem\mbox{[}64 $\ast$1024\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}}\label{lspmac_8c_a9da2795d11ccbc3a060c4811770ad04c}


double buffered memory 



Definition at line 130 of file lspmac.\-c.

\hypertarget{lspmac_8c_aa0be2f26364c4d12c9c81c10913f0b26}{\index{lspmac.\-c@{lspmac.\-c}!dbmem\-In@{dbmem\-In}}
\index{dbmem\-In@{dbmem\-In}!lspmac.c@{lspmac.\-c}}
\subsubsection[{dbmem\-In}]{\setlength{\rightskip}{0pt plus 5cm}int dbmem\-In = 0\hspace{0.3cm}{\ttfamily [static]}}}\label{lspmac_8c_aa0be2f26364c4d12c9c81c10913f0b26}


next location 



Definition at line 131 of file lspmac.\-c.

\hypertarget{lspmac_8c_a9d9c5030d817483ca9518027c91adac4}{\index{lspmac.\-c@{lspmac.\-c}!dryer@{dryer}}
\index{dryer@{dryer}!lspmac.c@{lspmac.\-c}}
\subsubsection[{dryer}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ dryer}}\label{lspmac_8c_a9d9c5030d817483ca9518027c91adac4}


blow air on the scintilator to dry it off 



Definition at line 96 of file lspmac.\-c.

\hypertarget{lspmac_8c_ae85caec6f4ddb2fc52ca14a26549ab08}{\index{lspmac.\-c@{lspmac.\-c}!eth\-Cmd\-Off@{eth\-Cmd\-Off}}
\index{eth\-Cmd\-Off@{eth\-Cmd\-Off}!lspmac.c@{lspmac.\-c}}
\subsubsection[{eth\-Cmd\-Off}]{\setlength{\rightskip}{0pt plus 5cm}unsigned int eth\-Cmd\-Off = 0\hspace{0.3cm}{\ttfamily [static]}}}\label{lspmac_8c_ae85caec6f4ddb2fc52ca14a26549ab08}


points to current command (or none if == eth\-Cmd\-On) 



Definition at line 143 of file lspmac.\-c.

\hypertarget{lspmac_8c_ad62b1f9e907acc3de9f3d6a05d55829e}{\index{lspmac.\-c@{lspmac.\-c}!eth\-Cmd\-On@{eth\-Cmd\-On}}
\index{eth\-Cmd\-On@{eth\-Cmd\-On}!lspmac.c@{lspmac.\-c}}
\subsubsection[{eth\-Cmd\-On}]{\setlength{\rightskip}{0pt plus 5cm}unsigned int eth\-Cmd\-On = 0\hspace{0.3cm}{\ttfamily [static]}}}\label{lspmac_8c_ad62b1f9e907acc3de9f3d6a05d55829e}


points to next empty P\-M\-A\-C command queue position 



Definition at line 142 of file lspmac.\-c.

\hypertarget{lspmac_8c_a69e569a833fe7f202b92e860d1548f2b}{\index{lspmac.\-c@{lspmac.\-c}!eth\-Cmd\-Queue@{eth\-Cmd\-Queue}}
\index{eth\-Cmd\-Queue@{eth\-Cmd\-Queue}!lspmac.c@{lspmac.\-c}}
\subsubsection[{eth\-Cmd\-Queue}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pmac\-\_\-cmd\-\_\-queue\-\_\-t} eth\-Cmd\-Queue\mbox{[}{\bf P\-M\-A\-C\-\_\-\-C\-M\-D\-\_\-\-Q\-U\-E\-U\-E\-\_\-\-L\-E\-N\-G\-T\-H}\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}}\label{lspmac_8c_a69e569a833fe7f202b92e860d1548f2b}


P\-M\-A\-C command queue. 



Definition at line 141 of file lspmac.\-c.

\hypertarget{lspmac_8c_a7a78524ada402bb74759a3dfc5f8a571}{\index{lspmac.\-c@{lspmac.\-c}!eth\-Cmd\-Reply@{eth\-Cmd\-Reply}}
\index{eth\-Cmd\-Reply@{eth\-Cmd\-Reply}!lspmac.c@{lspmac.\-c}}
\subsubsection[{eth\-Cmd\-Reply}]{\setlength{\rightskip}{0pt plus 5cm}unsigned int eth\-Cmd\-Reply = 0\hspace{0.3cm}{\ttfamily [static]}}}\label{lspmac_8c_a7a78524ada402bb74759a3dfc5f8a571}


Used like eth\-Cmd\-Off only to deal with the pmac reply to a command. 



Definition at line 144 of file lspmac.\-c.

\hypertarget{lspmac_8c_aeb09895663eff333b7a75acb319a9fc1}{\index{lspmac.\-c@{lspmac.\-c}!flight@{flight}}
\index{flight@{flight}!lspmac.c@{lspmac.\-c}}
\subsubsection[{flight}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ flight}}\label{lspmac_8c_aeb09895663eff333b7a75acb319a9fc1}


Front Light D\-A\-C. 



Definition at line 90 of file lspmac.\-c.

\hypertarget{lspmac_8c_a8a3ca6fcf5e24dcc26170736843e53b2}{\index{lspmac.\-c@{lspmac.\-c}!fscint@{fscint}}
\index{fscint@{fscint}!lspmac.c@{lspmac.\-c}}
\subsubsection[{fscint}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ fscint}}\label{lspmac_8c_a8a3ca6fcf5e24dcc26170736843e53b2}


Scintillator Piezo D\-A\-C. 



Definition at line 92 of file lspmac.\-c.

\hypertarget{lspmac_8c_a26dec4623af9beed912b8e7e6f99822c}{\index{lspmac.\-c@{lspmac.\-c}!fshut@{fshut}}
\index{fshut@{fshut}!lspmac.c@{lspmac.\-c}}
\subsubsection[{fshut}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ fshut}}\label{lspmac_8c_a26dec4623af9beed912b8e7e6f99822c}


Fast shutter. 



Definition at line 89 of file lspmac.\-c.

\hypertarget{lspmac_8c_ae7b21213b9c78b6745213409f1ef7320}{\index{lspmac.\-c@{lspmac.\-c}!gb\-\_\-cmd@{gb\-\_\-cmd}}
\index{gb\-\_\-cmd@{gb\-\_\-cmd}!lspmac.c@{lspmac.\-c}}
\subsubsection[{gb\-\_\-cmd}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pmac\-\_\-cmd\-\_\-t} gb\-\_\-cmd\hspace{0.3cm}{\ttfamily [static]}}}\label{lspmac_8c_ae7b21213b9c78b6745213409f1ef7320}


Definition at line 140 of file lspmac.\-c.

\hypertarget{lspmac_8c_a07b7b8254772075e6a4ced500b589c36}{\index{lspmac.\-c@{lspmac.\-c}!getivars@{getivars}}
\index{getivars@{getivars}!lspmac.c@{lspmac.\-c}}
\subsubsection[{getivars}]{\setlength{\rightskip}{0pt plus 5cm}int getivars = 0\hspace{0.3cm}{\ttfamily [static]}}}\label{lspmac_8c_a07b7b8254772075e6a4ced500b589c36}


flag set at initialization to send i vars to db 



Definition at line 68 of file lspmac.\-c.

\hypertarget{lspmac_8c_a50e9c0a06654fd81b3446a6e54ff12c3}{\index{lspmac.\-c@{lspmac.\-c}!getmvars@{getmvars}}
\index{getmvars@{getmvars}!lspmac.c@{lspmac.\-c}}
\subsubsection[{getmvars}]{\setlength{\rightskip}{0pt plus 5cm}int getmvars = 0\hspace{0.3cm}{\ttfamily [static]}}}\label{lspmac_8c_a50e9c0a06654fd81b3446a6e54ff12c3}


flag set at initialization to send m vars to db 



Definition at line 69 of file lspmac.\-c.

\hypertarget{lspmac_8c_a0be79ccb7ebf3a665248fd856112b9fd}{\index{lspmac.\-c@{lspmac.\-c}!kappa@{kappa}}
\index{kappa@{kappa}!lspmac.c@{lspmac.\-c}}
\subsubsection[{kappa}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ kappa}}\label{lspmac_8c_a0be79ccb7ebf3a665248fd856112b9fd}


Kappa. 



Definition at line 86 of file lspmac.\-c.

\hypertarget{lspmac_8c_a1de136a293a8e4bd306e692218a81587}{\index{lspmac.\-c@{lspmac.\-c}!lines\-Received@{lines\-Received}}
\index{lines\-Received@{lines\-Received}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lines\-Received}]{\setlength{\rightskip}{0pt plus 5cm}int lines\-Received =0\hspace{0.3cm}{\ttfamily [static]}}}\label{lspmac_8c_a1de136a293a8e4bd306e692218a81587}


current number of lines received 



Definition at line 129 of file lspmac.\-c.

\hypertarget{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}{\index{lspmac.\-c@{lspmac.\-c}!ls\-\_\-pmac\-\_\-state@{ls\-\_\-pmac\-\_\-state}}
\index{ls\-\_\-pmac\-\_\-state@{ls\-\_\-pmac\-\_\-state}!lspmac.c@{lspmac.\-c}}
\subsubsection[{ls\-\_\-pmac\-\_\-state}]{\setlength{\rightskip}{0pt plus 5cm}int ls\-\_\-pmac\-\_\-state = {\bf L\-S\-\_\-\-P\-M\-A\-C\-\_\-\-S\-T\-A\-T\-E\-\_\-\-D\-E\-T\-A\-C\-H\-E\-D}\hspace{0.3cm}{\ttfamily [static]}}}\label{lspmac_8c_a6d9261680ee01b1e106d1ea1d7ffa390}


Current state of the P\-M\-A\-C communications state machine. 



Definition at line 52 of file lspmac.\-c.

\hypertarget{lspmac_8c_a9bffbf72495499b505543cd942f665da}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-motors@{lspmac\-\_\-motors}}
\index{lspmac\-\_\-motors@{lspmac\-\_\-motors}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-motors}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t} lspmac\-\_\-motors\mbox{[}32\mbox{]}}}\label{lspmac_8c_a9bffbf72495499b505543cd942f665da}


All our motors. 



Definition at line 71 of file lspmac.\-c.

\hypertarget{lspmac_8c_a57547d211906c981ef20257eba99f8df}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-moving\-\_\-cond@{lspmac\-\_\-moving\-\_\-cond}}
\index{lspmac\-\_\-moving\-\_\-cond@{lspmac\-\_\-moving\-\_\-cond}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-moving\-\_\-cond}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-cond\-\_\-t lspmac\-\_\-moving\-\_\-cond}}\label{lspmac_8c_a57547d211906c981ef20257eba99f8df}


Wait for motor(s) to finish moving condition. 



Definition at line 59 of file lspmac.\-c.

\hypertarget{lspmac_8c_a7a32c617c183166308241e270959df56}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-moving\-\_\-flags@{lspmac\-\_\-moving\-\_\-flags}}
\index{lspmac\-\_\-moving\-\_\-flags@{lspmac\-\_\-moving\-\_\-flags}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-moving\-\_\-flags}]{\setlength{\rightskip}{0pt plus 5cm}int lspmac\-\_\-moving\-\_\-flags}}\label{lspmac_8c_a7a32c617c183166308241e270959df56}


Flag used to implement motor moving condition. 



Definition at line 60 of file lspmac.\-c.

\hypertarget{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-moving\-\_\-mutex@{lspmac\-\_\-moving\-\_\-mutex}}
\index{lspmac\-\_\-moving\-\_\-mutex@{lspmac\-\_\-moving\-\_\-mutex}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-moving\-\_\-mutex}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-mutex\-\_\-t lspmac\-\_\-moving\-\_\-mutex}}\label{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}


Coordinate moving motors between threads. 



Definition at line 58 of file lspmac.\-c.

\hypertarget{lspmac_8c_a56260f012c50a591ee7f97e500f16994}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-nmotors@{lspmac\-\_\-nmotors}}
\index{lspmac\-\_\-nmotors@{lspmac\-\_\-nmotors}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-nmotors}]{\setlength{\rightskip}{0pt plus 5cm}int lspmac\-\_\-nmotors = 0}}\label{lspmac_8c_a56260f012c50a591ee7f97e500f16994}


The number of motors we manage. 



Definition at line 72 of file lspmac.\-c.

\hypertarget{lspmac_8c_afbd51c2cefcee87afe994c9e9f372241}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-shutter\-\_\-cond@{lspmac\-\_\-shutter\-\_\-cond}}
\index{lspmac\-\_\-shutter\-\_\-cond@{lspmac\-\_\-shutter\-\_\-cond}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-shutter\-\_\-cond}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-cond\-\_\-t lspmac\-\_\-shutter\-\_\-cond}}\label{lspmac_8c_afbd51c2cefcee87afe994c9e9f372241}


Allows waiting for the shutter status to change. 



Definition at line 57 of file lspmac.\-c.

\hypertarget{lspmac_8c_a396fbf06208de3ecbe1b0df549f1cd46}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-shutter\-\_\-has\-\_\-opened@{lspmac\-\_\-shutter\-\_\-has\-\_\-opened}}
\index{lspmac\-\_\-shutter\-\_\-has\-\_\-opened@{lspmac\-\_\-shutter\-\_\-has\-\_\-opened}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-shutter\-\_\-has\-\_\-opened}]{\setlength{\rightskip}{0pt plus 5cm}int lspmac\-\_\-shutter\-\_\-has\-\_\-opened}}\label{lspmac_8c_a396fbf06208de3ecbe1b0df549f1cd46}


Indicates that the shutter had opened, perhaps briefly even if the state did not change. 



Definition at line 55 of file lspmac.\-c.

\hypertarget{lspmac_8c_a1b78a13c654409333569815e1c109d38}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-shutter\-\_\-mutex@{lspmac\-\_\-shutter\-\_\-mutex}}
\index{lspmac\-\_\-shutter\-\_\-mutex@{lspmac\-\_\-shutter\-\_\-mutex}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-shutter\-\_\-mutex}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-mutex\-\_\-t lspmac\-\_\-shutter\-\_\-mutex}}\label{lspmac_8c_a1b78a13c654409333569815e1c109d38}


Coordinates threads reading shutter status. 



Definition at line 56 of file lspmac.\-c.

\hypertarget{lspmac_8c_a112158e0cd50449a440ac55c7af7bea2}{\index{lspmac.\-c@{lspmac.\-c}!lspmac\-\_\-shutter\-\_\-state@{lspmac\-\_\-shutter\-\_\-state}}
\index{lspmac\-\_\-shutter\-\_\-state@{lspmac\-\_\-shutter\-\_\-state}!lspmac.c@{lspmac.\-c}}
\subsubsection[{lspmac\-\_\-shutter\-\_\-state}]{\setlength{\rightskip}{0pt plus 5cm}int lspmac\-\_\-shutter\-\_\-state}}\label{lspmac_8c_a112158e0cd50449a440ac55c7af7bea2}


State of the shutter, used to detect changes. 



Definition at line 54 of file lspmac.\-c.

\hypertarget{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{\index{lspmac.\-c@{lspmac.\-c}!md2\-\_\-status@{md2\-\_\-status}}
\index{md2\-\_\-status@{md2\-\_\-status}!lspmac.c@{lspmac.\-c}}
\subsubsection[{md2\-\_\-status}]{\setlength{\rightskip}{0pt plus 5cm}{\bf md2\-\_\-status\-\_\-t} md2\-\_\-status\hspace{0.3cm}{\ttfamily [static]}}}\label{lspmac_8c_ad5bce7451d48127bace5af445d03b492}


Buffer for M\-D2 Status. 



Definition at line 278 of file lspmac.\-c.

\hypertarget{lspmac_8c_a7a3e763682bd7f987d07f149e94b3bf8}{\index{lspmac.\-c@{lspmac.\-c}!md2\-\_\-status\-\_\-mutex@{md2\-\_\-status\-\_\-mutex}}
\index{md2\-\_\-status\-\_\-mutex@{md2\-\_\-status\-\_\-mutex}!lspmac.c@{lspmac.\-c}}
\subsubsection[{md2\-\_\-status\-\_\-mutex}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-mutex\-\_\-t md2\-\_\-status\-\_\-mutex}}\label{lspmac_8c_a7a3e763682bd7f987d07f149e94b3bf8}


Synchronize reading/writting status buffer. 



Definition at line 279 of file lspmac.\-c.

\hypertarget{lspmac_8c_a4bed9053319d1d2cad5cc03d0549e17f}{\index{lspmac.\-c@{lspmac.\-c}!now@{now}}
\index{now@{now}!lspmac.c@{lspmac.\-c}}
\subsubsection[{now}]{\setlength{\rightskip}{0pt plus 5cm}struct timeval pmac\-\_\-time\-\_\-sent now\hspace{0.3cm}{\ttfamily [static]}}}\label{lspmac_8c_a4bed9053319d1d2cad5cc03d0549e17f}


used to ensure we do not send commands to the pmac too often. Only needed for non-\/\-D\-B commands. 



Definition at line 136 of file lspmac.\-c.

\hypertarget{lspmac_8c_a8237e646ce032a840637a4ef7bff49b9}{\index{lspmac.\-c@{lspmac.\-c}!omega@{omega}}
\index{omega@{omega}!lspmac.c@{lspmac.\-c}}
\subsubsection[{omega}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ omega}}\label{lspmac_8c_a8237e646ce032a840637a4ef7bff49b9}


M\-D2 omega axis (the air bearing) 



Definition at line 73 of file lspmac.\-c.

\hypertarget{lspmac_8c_ac8070dc568ad974a3db42b51eca828cc}{\index{lspmac.\-c@{lspmac.\-c}!phi@{phi}}
\index{phi@{phi}!lspmac.c@{lspmac.\-c}}
\subsubsection[{phi}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ phi}}\label{lspmac_8c_ac8070dc568ad974a3db42b51eca828cc}


Phi (not data collection axis) 



Definition at line 87 of file lspmac.\-c.

\hypertarget{lspmac_8c_aab5a76f1ac64049314f9836e5c01fb7e}{\index{lspmac.\-c@{lspmac.\-c}!pmac\-\_\-error\-\_\-strs@{pmac\-\_\-error\-\_\-strs}}
\index{pmac\-\_\-error\-\_\-strs@{pmac\-\_\-error\-\_\-strs}!lspmac.c@{lspmac.\-c}}
\subsubsection[{pmac\-\_\-error\-\_\-strs}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ pmac\-\_\-error\-\_\-strs\mbox{[}$\,$\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}}\label{lspmac_8c_aab5a76f1ac64049314f9836e5c01fb7e}
{\bfseries Initial value\-:}
\begin{DoxyCode}
= \{
  \textcolor{stringliteral}{"ERR000: Unknown error"},
  \textcolor{stringliteral}{"ERR001: Command not allowed during program execution"},
  \textcolor{stringliteral}{"ERR002: Password error"},
  \textcolor{stringliteral}{"ERR003: Data error or unrecognized command"},
  \textcolor{stringliteral}{"ERR004: Illegal character"},
  \textcolor{stringliteral}{"ERR005: Command not allowed unless buffer is open"},
  \textcolor{stringliteral}{"ERR006: No room in buffer for command"},
  \textcolor{stringliteral}{"ERR007: Buffer already in use"},
  \textcolor{stringliteral}{"ERR008: MACRO auziliary communication error"},
  \textcolor{stringliteral}{"ERR009: Program structure error (e.g. ENDIF without IF)"},
  \textcolor{stringliteral}{"ERR010: Both overtravel limits set for a motor in the C.S."},
  \textcolor{stringliteral}{"ERR011: Previous move not completed"},
  \textcolor{stringliteral}{"ERR012: A motor in the coordinate system is open-loop"},
  \textcolor{stringliteral}{"ERR013: A motor in the coordinate system is not activated"},
  \textcolor{stringliteral}{"ERR014: No motors in the coordinate system"},
  \textcolor{stringliteral}{"ERR015: Not pointer to valid program buffer"},
  \textcolor{stringliteral}{"ERR016: Running improperly structure program (e.g. missing ENDWHILE)"},
  \textcolor{stringliteral}{"ERR017: Trying to resume after H or Q with motors out of stopped position"},
  \textcolor{stringliteral}{"ERR018: Attempt to perform phase reference during move, move during phase
       reference, or enabling with phase clock error"},
  \textcolor{stringliteral}{"ERR019: Illegal position-chage command while moves stored in CCBUFFER"}
\}
\end{DoxyCode}


Decode the errors perhaps returned by the P\-M\-A\-C. 



Definition at line 147 of file lspmac.\-c.

\hypertarget{lspmac_8c_a8a25bd9c593c6985107f90f999ce0b08}{\index{lspmac.\-c@{lspmac.\-c}!pmac\-\_\-queue\-\_\-cond@{pmac\-\_\-queue\-\_\-cond}}
\index{pmac\-\_\-queue\-\_\-cond@{pmac\-\_\-queue\-\_\-cond}!lspmac.c@{lspmac.\-c}}
\subsubsection[{pmac\-\_\-queue\-\_\-cond}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-cond\-\_\-t pmac\-\_\-queue\-\_\-cond\hspace{0.3cm}{\ttfamily [static]}}}\label{lspmac_8c_a8a25bd9c593c6985107f90f999ce0b08}


wait for a command to be sent to P\-M\-A\-C before continuing 



Definition at line 65 of file lspmac.\-c.

\hypertarget{lspmac_8c_acc1bb77b9bcbc4d970f841a41fd274b3}{\index{lspmac.\-c@{lspmac.\-c}!pmac\-\_\-queue\-\_\-mutex@{pmac\-\_\-queue\-\_\-mutex}}
\index{pmac\-\_\-queue\-\_\-mutex@{pmac\-\_\-queue\-\_\-mutex}!lspmac.c@{lspmac.\-c}}
\subsubsection[{pmac\-\_\-queue\-\_\-mutex}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-mutex\-\_\-t pmac\-\_\-queue\-\_\-mutex\hspace{0.3cm}{\ttfamily [static]}}}\label{lspmac_8c_acc1bb77b9bcbc4d970f841a41fd274b3}


manage access to the pmac command queue 



Definition at line 64 of file lspmac.\-c.

\hypertarget{lspmac_8c_a6b7011dd7d2c2d3afadff8d3e50e7677}{\index{lspmac.\-c@{lspmac.\-c}!pmac\-\_\-thread@{pmac\-\_\-thread}}
\index{pmac\-\_\-thread@{pmac\-\_\-thread}!lspmac.c@{lspmac.\-c}}
\subsubsection[{pmac\-\_\-thread}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-t pmac\-\_\-thread\hspace{0.3cm}{\ttfamily [static]}}}\label{lspmac_8c_a6b7011dd7d2c2d3afadff8d3e50e7677}


our thread to manage access and communication to the pmac 



Definition at line 63 of file lspmac.\-c.

\hypertarget{lspmac_8c_adba7f5f4bbeabc4dac859221d4c684ba}{\index{lspmac.\-c@{lspmac.\-c}!pmacfd@{pmacfd}}
\index{pmacfd@{pmacfd}!lspmac.c@{lspmac.\-c}}
\subsubsection[{pmacfd}]{\setlength{\rightskip}{0pt plus 5cm}struct pollfd pmacfd\hspace{0.3cm}{\ttfamily [static]}}}\label{lspmac_8c_adba7f5f4bbeabc4dac859221d4c684ba}


our poll structure 



Definition at line 66 of file lspmac.\-c.

\hypertarget{lspmac_8c_a6fcbbe47fe9912533962601f5befdb29}{\index{lspmac.\-c@{lspmac.\-c}!rr\-\_\-cmd@{rr\-\_\-cmd}}
\index{rr\-\_\-cmd@{rr\-\_\-cmd}!lspmac.c@{lspmac.\-c}}
\subsubsection[{rr\-\_\-cmd}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pmac\-\_\-cmd\-\_\-t} rr\-\_\-cmd\hspace{0.3cm}{\ttfamily [static]}}}\label{lspmac_8c_a6fcbbe47fe9912533962601f5befdb29}


Definition at line 140 of file lspmac.\-c.

\hypertarget{lspmac_8c_ac0eeaffa0996271d8a38344a470d13d7}{\index{lspmac.\-c@{lspmac.\-c}!scinz@{scinz}}
\index{scinz@{scinz}!lspmac.c@{lspmac.\-c}}
\subsubsection[{scinz}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ scinz}}\label{lspmac_8c_ac0eeaffa0996271d8a38344a470d13d7}


Scintillator Z. 



Definition at line 83 of file lspmac.\-c.

\hypertarget{lspmac_8c_ad53a42cfaa04eff0336a44c8c9986333}{\index{lspmac.\-c@{lspmac.\-c}!zoom@{zoom}}
\index{zoom@{zoom}!lspmac.c@{lspmac.\-c}}
\subsubsection[{zoom}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ zoom}}\label{lspmac_8c_ad53a42cfaa04eff0336a44c8c9986333}


Optical zoom. 



Definition at line 78 of file lspmac.\-c.

