\hypertarget{lsredis_8c}{\section{lsredis.\-c File Reference}
\label{lsredis_8c}\index{lsredis.\-c@{lsredis.\-c}}
}


Support redis hash synchronization.  


{\ttfamily \#include \char`\"{}pgpmac.\-h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{lsredis_8c_a6ea1992251710763088d23f2a7f00f05}{lsredis\-\_\-isvalid} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p)
\item 
void \hyperlink{lsredis_8c_aef0c5c60fcae1461309789ce9816a805}{lsredis\-\_\-set\-\_\-invalid} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p)
\item 
void \hyperlink{lsredis_8c_a05c7ed2bb1b5702a5c83ed3b51abb546}{\-\_\-lsredis\-\_\-set\-\_\-value} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p, char $\ast$v)
\begin{DoxyCompactList}\small\item\em set\-\_\-value and setstr helper funciton p-\/$>$mutex must be locked before calling \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_ac3c27bda1c9b10e6db14665951746da8}{lsredis\-\_\-set\-\_\-value} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p, char $\ast$fmt,...)
\begin{DoxyCompactList}\small\item\em Set the value of a redis object and make it valid. \end{DoxyCompactList}\item 
char $\ast$ \hyperlink{lsredis_8c_ac1994e56114b2315294527d76311f829}{lsredis\-\_\-getstr} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p)
\begin{DoxyCompactList}\small\item\em return a copy of the key's string value \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\-\_\-setstr} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p, char $\ast$fmt,...)
\begin{DoxyCompactList}\small\item\em Set the value and update redis. \end{DoxyCompactList}\item 
double \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\-\_\-getd} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p)
\item 
long int \hyperlink{lsredis_8c_a1923f998441f4f451204dfd214d52218}{lsredis\-\_\-getl} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p)
\item 
void \hyperlink{lsredis_8c_a8d9719b362d1b38275d734971b7988af}{lsredis\-\_\-hget\-C\-B} (redis\-Async\-Context $\ast$ac, void $\ast$reply, void $\ast$privdata)
\item 
\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$ \hyperlink{lsredis_8c_ac3fb8589e280bfa18ecbca6619fea637}{\-\_\-lsredis\-\_\-get\-\_\-obj} (char $\ast$key)
\begin{DoxyCompactList}\small\item\em Maybe add a new object Used internally for this module. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$ \hyperlink{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{lsredis\-\_\-get\-\_\-obj} (char $\ast$fmt,...)
\item 
void \hyperlink{lsredis_8c_aa1941e6515a254f76cfd1f18d3c8fac3}{redis\-Disconnect\-C\-B} (const redis\-Async\-Context $\ast$ac, int status)
\begin{DoxyCompactList}\small\item\em call back incase a redis server becomes disconnected T\-O\-D\-O\-: reconnect \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_adee3bccecc86dd531ac5f89491632439}{lsredis\-\_\-add\-Read} (void $\ast$data)
\begin{DoxyCompactList}\small\item\em hook to mange read events \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_a2e1f2258b3cc864ce3eef4eda556e2a6}{lsredis\-\_\-del\-Read} (void $\ast$data)
\begin{DoxyCompactList}\small\item\em hook to manage \char`\"{}don't need to read\char`\"{} events \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_a3cb6eda5c8ae80019e7a1c078940e9e9}{lsredis\-\_\-add\-Write} (void $\ast$data)
\begin{DoxyCompactList}\small\item\em hook to manage write events \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_a04f0119cfa1156dc34d35b237358822a}{lsredis\-\_\-del\-Write} (void $\ast$data)
\begin{DoxyCompactList}\small\item\em hook to manage \char`\"{}don't need to write anymore\char`\"{} events \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_a45f946a5262c23b362be17c2cb0310c2}{lsredis\-\_\-cleanup} (void $\ast$data)
\begin{DoxyCompactList}\small\item\em hook to clean up T\-O\-D\-O\-: figure out what we are supposed to do here and do it \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_a8268fd06bda0e2c327b057a880b97b59}{lsredis\-\_\-debug\-C\-B} (redis\-Async\-Context $\ast$ac, void $\ast$reply, void $\ast$privdata)
\begin{DoxyCompactList}\small\item\em Log the reply. \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_a84611531459bf3d92c45b86308b4a300}{lsredis\-\_\-sub\-C\-B} (redis\-Async\-Context $\ast$ac, void $\ast$reply, void $\ast$privdata)
\begin{DoxyCompactList}\small\item\em Use the publication to request the new value. \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_ad3189a7329ca92efab0054921f608b97}{lsredis\-\_\-maybe\-\_\-add\-\_\-key} (char $\ast$k)
\item 
void \hyperlink{lsredis_8c_ace75c15c5308a0fcdafcb82c7506872a}{lsredis\-\_\-keys\-C\-B} (redis\-Async\-Context $\ast$ac, void $\ast$reply, void $\ast$privdata)
\begin{DoxyCompactList}\small\item\em Sift through the keys to find ones we like. \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_a07dc95184cac704740bfe16fe4c6a4f0}{lsredis\-\_\-select} (char $\ast$re)
\begin{DoxyCompactList}\small\item\em set regexp to select variables we are interested in following \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_aef0f12fda57e476a50b14acdc9f30b58}{lsredis\-\_\-init} (char $\ast$pub, char $\ast$re, char $\ast$head)
\begin{DoxyCompactList}\small\item\em Initialize this module, that is, set up the connections. \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_ae1478efc852fef71550e0f58d602fa2b}{lsredis\-\_\-fd\-\_\-service} (struct pollfd $\ast$evt)
\begin{DoxyCompactList}\small\item\em service the socket requests \end{DoxyCompactList}\item 
void $\ast$ \hyperlink{lsredis_8c_ade7b1ddfdc88c6964a4c90513e360f75}{lsredis\-\_\-worker} (void $\ast$dummy)
\begin{DoxyCompactList}\small\item\em subscribe to changes and service sockets \end{DoxyCompactList}\item 
void \hyperlink{lsredis_8c_ad438e4368d86bbe15a93dcf86deaded5}{lsredis\-\_\-run} ()
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static pthread\-\_\-t \hyperlink{lsredis_8c_a79c33eb11ad6819247930ade3a25671f}{lsredis\-\_\-thread}
\item 
static \hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$ \hyperlink{lsredis_8c_a3d206e1c119f1408a7cf1078139f8189}{lsredis\-\_\-objs} = N\-U\-L\-L
\item 
static pthread\-\_\-mutex\-\_\-t \hyperlink{lsredis_8c_ab3ace99b8775e2366da0cfe053b68607}{lsredis\-\_\-objs\-\_\-mutex}
\item 
static pthread\-\_\-mutex\-\_\-t \hyperlink{lsredis_8c_a4a3806596ef0d2baac37257033008ff2}{lsredis\-\_\-ro\-\_\-mutex}
\begin{DoxyCompactList}\small\item\em keep from having more than one thread send a rediscommand to the read/only server \end{DoxyCompactList}\item 
static pthread\-\_\-mutex\-\_\-t \hyperlink{lsredis_8c_ad650f89eb0d4fe24a32ea352ac404b27}{lsredis\-\_\-wr\-\_\-mutex}
\begin{DoxyCompactList}\small\item\em keep from having more than one thread send a rediscommand to the write/read server \end{DoxyCompactList}\item 
static redis\-Async\-Context $\ast$ \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}
\item 
static redis\-Async\-Context $\ast$ \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}
\item 
static redis\-Async\-Context $\ast$ \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}
\item 
static char $\ast$ \hyperlink{lsredis_8c_a0c81dce2e75584eeb14ab7d9dd86c72e}{lsredis\-\_\-publisher} = N\-U\-L\-L
\item 
static regex\-\_\-t \hyperlink{lsredis_8c_abee04898347f9b2551fa0435b1cc597e}{lsredis\-\_\-key\-\_\-select\-\_\-regex}
\item 
static char $\ast$ \hyperlink{lsredis_8c_acdca9095c7a3288d7febe9f4c440a6e9}{lsredis\-\_\-head} = N\-U\-L\-L
\item 
static struct pollfd \hyperlink{lsredis_8c_a0cd3bdc79d035eb1595371c845d14367}{subfd}
\item 
static struct pollfd \hyperlink{lsredis_8c_add819e43a356d0575ec64c346c6fed57}{rofd}
\item 
static struct pollfd \hyperlink{lsredis_8c_a13acbee14dbe8cdb98e238abb921d048}{wrfd}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Support redis hash synchronization. \begin{DoxyDate}{Date}
2012 
\end{DoxyDate}
\begin{DoxyAuthor}{Author}
Keith Brister 
\end{DoxyAuthor}
\begin{DoxyCopyright}{Copyright}
All Rights Reserved 
\end{DoxyCopyright}


Definition in file \hyperlink{lsredis_8c_source}{lsredis.\-c}.



\subsection{Function Documentation}
\hypertarget{lsredis_8c_ac3fb8589e280bfa18ecbca6619fea637}{\index{lsredis.\-c@{lsredis.\-c}!\-\_\-lsredis\-\_\-get\-\_\-obj@{\-\_\-lsredis\-\_\-get\-\_\-obj}}
\index{\-\_\-lsredis\-\_\-get\-\_\-obj@{\-\_\-lsredis\-\_\-get\-\_\-obj}!lsredis.c@{lsredis.\-c}}
\subsubsection[{\-\_\-lsredis\-\_\-get\-\_\-obj}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lsredis\-\_\-obj\-\_\-t}$\ast$ \-\_\-lsredis\-\_\-get\-\_\-obj (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{key}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_ac3fb8589e280bfa18ecbca6619fea637}


Maybe add a new object Used internally for this module. 



Definition at line 217 of file lsredis.\-c.


\begin{DoxyCode}
                                            \{
  \hyperlink{structlsredis__obj__struct}{lsredis\_obj\_t} *p;
  regmatch\_t pmatch[2];
  \textcolor{keywordtype}{int} err;
  \textcolor{keywordtype}{char} *name;

  \textcolor{comment}{// Dispense with obviously bad keys straight away}
  \textcolor{comment}{// unless p->valid == 0 in which case we call HGET first}
  \textcolor{comment}{//}
  \textcolor{comment}{// TODO: review logic: is there ever a time when valid is zero for a
       preexisting p and HGET has not been called?}
  \textcolor{comment}{//       If not then we should just return p without checking for validity.}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( key == NULL || *key == 0 || strchr( key, \textcolor{charliteral}{' '}) != NULL) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"\_lsredis\_get\_obj: bad key '%s'
      "}, key == NULL ? \textcolor{stringliteral}{"<NULL>"} : key);
    \textcolor{keywordflow}{return} NULL;
  \}

  \textcolor{comment}{//  printf( "\_lsredis\_get\_obj: received key '%s'", key);}
  \textcolor{comment}{//  fflush( stdout);}

  pthread\_mutex\_lock( &\hyperlink{lsredis_8c_ab3ace99b8775e2366da0cfe053b68607}{lsredis\_objs\_mutex});
  \textcolor{comment}{// If the key is already there then just return it}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{for}( p = \hyperlink{lsredis_8c_a3d206e1c119f1408a7cf1078139f8189}{lsredis\_objs}; p != NULL; p = p->\hyperlink{structlsredis__obj__struct_afb7259e8c3c1c83ccc234b2b2894f2b0}{next}) \{
    \textcolor{keywordflow}{if}( strcmp( key, p->\hyperlink{structlsredis__obj__struct_aa8c5a453b9424e5666320b8675a42f5c}{key}) == 0) \{
      \textcolor{keywordflow}{break};
    \}
  \}

  \textcolor{keywordflow}{if}( p != NULL) \{
    pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_ab3ace99b8775e2366da0cfe053b68607}{lsredis\_objs\_mutex});
    \textcolor{keywordflow}{return} p;
  \} \textcolor{keywordflow}{else} \{
    \textcolor{comment}{// make a new one.}
    p = calloc( 1, \textcolor{keyword}{sizeof}( \hyperlink{structlsredis__obj__struct}{lsredis\_obj\_t}));
    \textcolor{keywordflow}{if}( p == NULL) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"\_lsredis\_get\_obj: Out of
       memory"});
      exit( -1);
    \}
    
    err = regexec( &\hyperlink{lsredis_8c_abee04898347f9b2551fa0435b1cc597e}{lsredis\_key\_select\_regex}, key, 2, 
      pmatch, 0);
    \textcolor{keywordflow}{if}( err == 0 && pmatch[1].rm\_so != -1) \{
      p->\hyperlink{structlsredis__obj__struct_ad0a987a011b580eab739cda831f78fbb}{events\_name} = strndup( key+pmatch[1].rm\_so, pmatch[1].rm\_eo
       - pmatch[1].rm\_so);
    \} \textcolor{keywordflow}{else} \{
      p->\hyperlink{structlsredis__obj__struct_ad0a987a011b580eab739cda831f78fbb}{events\_name} = strdup( key);
    \}
    \textcolor{keywordflow}{if}( p->\hyperlink{structlsredis__obj__struct_ad0a987a011b580eab739cda831f78fbb}{events\_name} == NULL) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"\_lsredis\_get\_obj: Out of
       memory (evetns\_name)"});
      exit( -1);
    \}

    pthread\_mutex\_init( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex}, NULL);
    pthread\_cond\_init(  &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, NULL);
    p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} = 0;
    \hyperlink{lsevents_8c_a5c6f122382dea3dcc231b772e5e75b46}{lsevents\_send\_event}( \textcolor{stringliteral}{"%s Invalid"}, p->\hyperlink{structlsredis__obj__struct_ad0a987a011b580eab739cda831f78fbb}{events\_name}
      );
    p->\hyperlink{structlsredis__obj__struct_a8bc1a536b7155a1e2a749c7c434b898b}{wait\_for\_me} = 0;
    p->\hyperlink{structlsredis__obj__struct_aa8c5a453b9424e5666320b8675a42f5c}{key} = strdup( key);
    p->\hyperlink{structlsredis__obj__struct_aa61ab86f719e093af48810a3bd37b739}{getstr} = \hyperlink{lsredis_8c_ac1994e56114b2315294527d76311f829}{lsredis\_getstr};
    p->\hyperlink{structlsredis__obj__struct_a6e8586747a0453b16e5b5104c41eab76}{getd} = \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\_getd};
    p->\hyperlink{structlsredis__obj__struct_abcb9459a7d8edabaf8ff4e9f1a96aba7}{getl} = \hyperlink{lsredis_8c_a1923f998441f4f451204dfd214d52218}{lsredis\_getl};
    p->\hyperlink{structlsredis__obj__struct_a43fcbff584654ab086d973ce34cb6ddc}{hits} = 0;
  
    p->\hyperlink{structlsredis__obj__struct_afb7259e8c3c1c83ccc234b2b2894f2b0}{next} = \hyperlink{lsredis_8c_a3d206e1c119f1408a7cf1078139f8189}{lsredis\_objs};
    \hyperlink{lsredis_8c_a3d206e1c119f1408a7cf1078139f8189}{lsredis\_objs} = p;

    pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_ab3ace99b8775e2366da0cfe053b68607}{lsredis\_objs\_mutex});

    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"\_lsredis\_get\_obj: added %s"}, 
      key);
  \}
  \textcolor{comment}{//}
  \textcolor{comment}{// We arrive here with the valid flag lowered.  Go ahead and request the
       latest value.}
  \textcolor{comment}{//}
  pthread\_mutex\_lock( &\hyperlink{lsredis_8c_a4a3806596ef0d2baac37257033008ff2}{lsredis\_ro\_mutex});
  redisAsyncCommand( \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}, \hyperlink{lsredis_8c_a8d9719b362d1b38275d734971b7988af}{lsredis\_hgetCB}, p, \textcolor{stringliteral}{"HGET %s VALUE"}
      , key);
  pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_a4a3806596ef0d2baac37257033008ff2}{lsredis\_ro\_mutex});

  \textcolor{keywordflow}{return} p;
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a05c7ed2bb1b5702a5c83ed3b51abb546}{\index{lsredis.\-c@{lsredis.\-c}!\-\_\-lsredis\-\_\-set\-\_\-value@{\-\_\-lsredis\-\_\-set\-\_\-value}}
\index{\-\_\-lsredis\-\_\-set\-\_\-value@{\-\_\-lsredis\-\_\-set\-\_\-value}!lsredis.c@{lsredis.\-c}}
\subsubsection[{\-\_\-lsredis\-\_\-set\-\_\-value}]{\setlength{\rightskip}{0pt plus 5cm}void \-\_\-lsredis\-\_\-set\-\_\-value (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p, }
\item[{char $\ast$}]{v}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a05c7ed2bb1b5702a5c83ed3b51abb546}


set\-\_\-value and setstr helper funciton p-\/$>$mutex must be locked before calling 



Definition at line 48 of file lsredis.\-c.


\begin{DoxyCode}
                                                    \{

  \textcolor{keywordflow}{if}( strlen(v) >= p->\hyperlink{structlsredis__obj__struct_a664f0eaafb8dffc0dbde126e0340efb9}{value\_length}) \{
    \textcolor{keywordflow}{if}( p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value} != NULL)
      free( p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value});
    p->\hyperlink{structlsredis__obj__struct_a664f0eaafb8dffc0dbde126e0340efb9}{value\_length} = strlen(v) + 256;
    p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value} = calloc( p->\hyperlink{structlsredis__obj__struct_a664f0eaafb8dffc0dbde126e0340efb9}{value\_length}, \textcolor{keyword}{sizeof}( \textcolor{keywordtype}{char}));
    \textcolor{keywordflow}{if}( p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value} == NULL) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"\_lsredis\_set\_value: out of
       memory"});
      exit( -1);
    \}
  \}
  strcpy( p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value}, v);
  p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value}[p->\hyperlink{structlsredis__obj__struct_a664f0eaafb8dffc0dbde126e0340efb9}{value\_length}-1] = 0;

  p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} = 1;
  \hyperlink{lsevents_8c_a5c6f122382dea3dcc231b772e5e75b46}{lsevents\_send\_event}( \textcolor{stringliteral}{"%s Valid"}, p->\hyperlink{structlsredis__obj__struct_ad0a987a011b580eab739cda831f78fbb}{events\_name}
      );
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_adee3bccecc86dd531ac5f89491632439}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-add\-Read@{lsredis\-\_\-add\-Read}}
\index{lsredis\-\_\-add\-Read@{lsredis\-\_\-add\-Read}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-add\-Read}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-add\-Read (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{data}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_adee3bccecc86dd531ac5f89491632439}


hook to mange read events 



Definition at line 334 of file lsredis.\-c.


\begin{DoxyCode}
                                  \{
  \textcolor{keyword}{struct }pollfd *pfd;
  pfd = (\textcolor{keyword}{struct }pollfd *)data;
  pfd->events |= POLLIN;
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a3cb6eda5c8ae80019e7a1c078940e9e9}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-add\-Write@{lsredis\-\_\-add\-Write}}
\index{lsredis\-\_\-add\-Write@{lsredis\-\_\-add\-Write}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-add\-Write}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-add\-Write (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{data}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a3cb6eda5c8ae80019e7a1c078940e9e9}


hook to manage write events 



Definition at line 350 of file lsredis.\-c.


\begin{DoxyCode}
                                   \{
  \textcolor{keyword}{struct }pollfd *pfd;
  pfd = (\textcolor{keyword}{struct }pollfd *)data;
  pfd->events |= POLLOUT;
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a45f946a5262c23b362be17c2cb0310c2}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-cleanup@{lsredis\-\_\-cleanup}}
\index{lsredis\-\_\-cleanup@{lsredis\-\_\-cleanup}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-cleanup}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-cleanup (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{data}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a45f946a5262c23b362be17c2cb0310c2}


hook to clean up T\-O\-D\-O\-: figure out what we are supposed to do here and do it 



Definition at line 367 of file lsredis.\-c.


\begin{DoxyCode}
                                  \{
  \textcolor{keyword}{struct }pollfd *pfd;
  pfd = (\textcolor{keyword}{struct }pollfd *)data;
  pfd->events &= ~(POLLOUT | POLLIN);
  pfd->fd = -1;
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a8268fd06bda0e2c327b057a880b97b59}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-debug\-C\-B@{lsredis\-\_\-debug\-C\-B}}
\index{lsredis\-\_\-debug\-C\-B@{lsredis\-\_\-debug\-C\-B}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-debug\-C\-B}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-debug\-C\-B (
\begin{DoxyParamCaption}
\item[{redis\-Async\-Context $\ast$}]{ac, }
\item[{void $\ast$}]{reply, }
\item[{void $\ast$}]{privdata}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a8268fd06bda0e2c327b057a880b97b59}


Log the reply. 



Definition at line 377 of file lsredis.\-c.


\begin{DoxyCode}
                                                                          \{
  \textcolor{keyword}{static} \textcolor{keywordtype}{int} indentlevel = 0;
  redisReply *r;
  \textcolor{keywordtype}{int} i;

  r = (redisReply *)reply;

  \textcolor{keywordflow}{if}( r == NULL) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Null reply.  Odd"});
    \textcolor{keywordflow}{return};
  \}

  \textcolor{keywordflow}{switch}( r->type) \{
  \textcolor{keywordflow}{case} REDIS\_REPLY\_STATUS:
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"%*sSTATUS: %s"}, indentlevel*4,\textcolor{stringliteral}{
      ""}, r->str);
    \textcolor{keywordflow}{break};

  \textcolor{keywordflow}{case} REDIS\_REPLY\_ERROR:
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"%*sERROR: %s"}, indentlevel*4, \textcolor{stringliteral}{
      ""}, r->str);
    \textcolor{keywordflow}{break};

  \textcolor{keywordflow}{case} REDIS\_REPLY\_INTEGER:
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"%*sInteger: %lld"}, indentlevel
      *4, \textcolor{stringliteral}{""}, r->integer);
    \textcolor{keywordflow}{break};

  \textcolor{keywordflow}{case} REDIS\_REPLY\_NIL:
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"%*s(nil)"}, indentlevel*4, \textcolor{stringliteral}{""});
    \textcolor{keywordflow}{break};

  \textcolor{keywordflow}{case} REDIS\_REPLY\_STRING:
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"%*sSTRING: %s"}, indentlevel*4,
       \textcolor{stringliteral}{""}, r->str);
    \textcolor{keywordflow}{break};

  \textcolor{keywordflow}{case} REDIS\_REPLY\_ARRAY:
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"%*sARRAY of %d elements"}, 
      indentlevel*4, \textcolor{stringliteral}{""}, (\textcolor{keywordtype}{int})r->elements);
    indentlevel++;
    \textcolor{keywordflow}{for}( i=0; i<r->elements; i++)
      \hyperlink{lsredis_8c_a8268fd06bda0e2c327b057a880b97b59}{lsredis\_debugCB}( ac, r->element[i], NULL);
    indentlevel--;
    \textcolor{keywordflow}{break};

  \textcolor{keywordflow}{default}:
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"%*sUnknown type %d"}, 
      indentlevel*4,\textcolor{stringliteral}{""}, r->type);

  \}
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a2e1f2258b3cc864ce3eef4eda556e2a6}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-del\-Read@{lsredis\-\_\-del\-Read}}
\index{lsredis\-\_\-del\-Read@{lsredis\-\_\-del\-Read}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-del\-Read}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-del\-Read (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{data}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a2e1f2258b3cc864ce3eef4eda556e2a6}


hook to manage \char`\"{}don't need to read\char`\"{} events 



Definition at line 342 of file lsredis.\-c.


\begin{DoxyCode}
                                  \{
  \textcolor{keyword}{struct }pollfd *pfd;
  pfd = (\textcolor{keyword}{struct }pollfd *)data;
  pfd->events &= ~POLLIN;
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a04f0119cfa1156dc34d35b237358822a}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-del\-Write@{lsredis\-\_\-del\-Write}}
\index{lsredis\-\_\-del\-Write@{lsredis\-\_\-del\-Write}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-del\-Write}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-del\-Write (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{data}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a04f0119cfa1156dc34d35b237358822a}


hook to manage \char`\"{}don't need to write anymore\char`\"{} events 



Definition at line 358 of file lsredis.\-c.


\begin{DoxyCode}
                                   \{
  \textcolor{keyword}{struct }pollfd *pfd;
  pfd = (\textcolor{keyword}{struct }pollfd *)data;
  pfd->events &= ~POLLOUT;
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_ae1478efc852fef71550e0f58d602fa2b}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-fd\-\_\-service@{lsredis\-\_\-fd\-\_\-service}}
\index{lsredis\-\_\-fd\-\_\-service@{lsredis\-\_\-fd\-\_\-service}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-fd\-\_\-service}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-fd\-\_\-service (
\begin{DoxyParamCaption}
\item[{struct pollfd $\ast$}]{evt}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_ae1478efc852fef71550e0f58d602fa2b}


service the socket requests 



Definition at line 658 of file lsredis.\-c.


\begin{DoxyCode}
                                             \{
  \textcolor{keywordflow}{if}( evt->fd == \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->c.fd) \{
    \textcolor{keywordflow}{if}( evt->revents & POLLIN)
      redisAsyncHandleRead( \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac});
    \textcolor{keywordflow}{if}( evt->revents & POLLOUT)
      redisAsyncHandleWrite( \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac});
  \}
  \textcolor{keywordflow}{if}( evt->fd == \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->c.fd) \{
    \textcolor{keywordflow}{if}( evt->revents & POLLIN)
      redisAsyncHandleRead( \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac});
    \textcolor{keywordflow}{if}( evt->revents & POLLOUT)
      redisAsyncHandleWrite( \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac});
  \}
  \textcolor{keywordflow}{if}( evt->fd == \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->c.fd) \{
    \textcolor{keywordflow}{if}( evt->revents & POLLIN)
      redisAsyncHandleRead( \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac});
    \textcolor{keywordflow}{if}( evt->revents & POLLOUT)
      redisAsyncHandleWrite( \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac});
  \}
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-get\-\_\-obj@{lsredis\-\_\-get\-\_\-obj}}
\index{lsredis\-\_\-get\-\_\-obj@{lsredis\-\_\-get\-\_\-obj}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-get\-\_\-obj}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lsredis\-\_\-obj\-\_\-t}$\ast$ lsredis\-\_\-get\-\_\-obj (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{fmt, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}


Definition at line 297 of file lsredis.\-c.


\begin{DoxyCode}
                                                \{
  \hyperlink{structlsredis__obj__struct}{lsredis\_obj\_t} *rtn;
  va\_list arg\_ptr;
  \textcolor{keywordtype}{char} k[512];
  \textcolor{keywordtype}{char} *kp;
  \textcolor{keywordtype}{int} nkp;

  va\_start( arg\_ptr, fmt);
  vsnprintf( k, \textcolor{keyword}{sizeof}(k)-1, fmt, arg\_ptr);
  k[\textcolor{keyword}{sizeof}(k)-1] = 0;
  va\_end( arg\_ptr);

  nkp = strlen(k) + strlen( \hyperlink{lsredis_8c_acdca9095c7a3288d7febe9f4c440a6e9}{lsredis\_head}) + 16;             \textcolor{comment}{// 16
       is overkill, I know.  get over it.}
  kp = calloc( nkp, \textcolor{keyword}{sizeof}( \textcolor{keywordtype}{char}));
  \textcolor{keywordflow}{if}( kp == NULL) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_get\_obj: Out of memory
      "});
    exit( -1);
  \}
  
  snprintf( kp, nkp-1, \textcolor{stringliteral}{"%s.%s"}, \hyperlink{lsredis_8c_acdca9095c7a3288d7febe9f4c440a6e9}{lsredis\_head}, k);
  kp[nkp-1] = 0;
  rtn = \hyperlink{lsredis_8c_ac3fb8589e280bfa18ecbca6619fea637}{\_lsredis\_get\_obj}( kp);
  free( kp);
  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-getd@{lsredis\-\_\-getd}}
\index{lsredis\-\_\-getd@{lsredis\-\_\-getd}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-getd}]{\setlength{\rightskip}{0pt plus 5cm}double lsredis\-\_\-getd (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}


Definition at line 160 of file lsredis.\-c.


\begin{DoxyCode}
                                       \{
  \textcolor{keywordtype}{double} rtn;

  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{while}( p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} == 0)
    pthread\_cond\_wait( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

  errno = 0;
  rtn = strtod( p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value}, NULL);
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  
  \textcolor{keywordflow}{if}( errno != 0)
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_getd: %s"}, strerror);
  
  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a1923f998441f4f451204dfd214d52218}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-getl@{lsredis\-\_\-getl}}
\index{lsredis\-\_\-getl@{lsredis\-\_\-getl}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-getl}]{\setlength{\rightskip}{0pt plus 5cm}long int lsredis\-\_\-getl (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a1923f998441f4f451204dfd214d52218}


Definition at line 177 of file lsredis.\-c.


\begin{DoxyCode}
                                         \{
  \textcolor{keywordtype}{long} \textcolor{keywordtype}{int} rtn;

  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{while}( p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} == 0)
    pthread\_cond\_wait( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

  errno = 0;
  rtn = strtol( p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value}, NULL, 10);
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  
  \textcolor{keywordflow}{if}( errno != 0)
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_getd: %s"}, strerror);
  
  \textcolor{keywordflow}{return} rtn;
\}  
\end{DoxyCode}
\hypertarget{lsredis_8c_ac1994e56114b2315294527d76311f829}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-getstr@{lsredis\-\_\-getstr}}
\index{lsredis\-\_\-getstr@{lsredis\-\_\-getstr}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-getstr}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ lsredis\-\_\-getstr (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_ac1994e56114b2315294527d76311f829}


return a copy of the key's string value 



Definition at line 92 of file lsredis.\-c.


\begin{DoxyCode}
                                        \{
  \textcolor{keywordtype}{char} *rtn;

  \textcolor{comment}{//}
  \textcolor{comment}{// Have to use strdup since we cannot guarantee that p->value won't be freed
       while the caller is still using it}
  \textcolor{comment}{//}
  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{while}( p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} == 0)
    pthread\_cond\_wait( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

  rtn = strdup(p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value});
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a8d9719b362d1b38275d734971b7988af}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-hget\-C\-B@{lsredis\-\_\-hget\-C\-B}}
\index{lsredis\-\_\-hget\-C\-B@{lsredis\-\_\-hget\-C\-B}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-hget\-C\-B}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-hget\-C\-B (
\begin{DoxyParamCaption}
\item[{redis\-Async\-Context $\ast$}]{ac, }
\item[{void $\ast$}]{reply, }
\item[{void $\ast$}]{privdata}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a8d9719b362d1b38275d734971b7988af}


Definition at line 194 of file lsredis.\-c.


\begin{DoxyCode}
                                                                         \{
  redisReply *r;
  \hyperlink{structlsredis__obj__struct}{lsredis\_obj\_t} *p;

  r = reply;
  p =  privdata;

  \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"hgetCB: %s %s"}, p == NULL ? \textcolor{stringliteral}{"
      <NULL>"} : p->\hyperlink{structlsredis__obj__struct_aa8c5a453b9424e5666320b8675a42f5c}{key}, r->type == REDIS\_REPLY\_STRING ? r->str : \textcolor{stringliteral}{"Non-string value. 
       Why?"});

  \textcolor{keywordflow}{if}( p != NULL && r->type == REDIS\_REPLY\_STRING && r->str != NULL) \{
    pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

    \hyperlink{lsredis_8c_a05c7ed2bb1b5702a5c83ed3b51abb546}{\_lsredis\_set\_value}( p, r->str);

    pthread\_cond\_signal( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond});
    pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \}
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_aef0f12fda57e476a50b14acdc9f30b58}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-init@{lsredis\-\_\-init}}
\index{lsredis\-\_\-init@{lsredis\-\_\-init}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-init (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{pub, }
\item[{char $\ast$}]{re, }
\item[{char $\ast$}]{head}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_aef0f12fda57e476a50b14acdc9f30b58}


Initialize this module, that is, set up the connections. 


\begin{DoxyParams}{Parameters}
{\em pub} & Publish under this (unique) name \\
\hline
{\em re} & Regular expression to select keys we want to mirror \\
\hline
{\em head} & Prepend this (+ a dot) to the beginning of requested objects \\
\hline
\end{DoxyParams}


Definition at line 601 of file lsredis.\-c.


\begin{DoxyCode}
                                                    \{

  \hyperlink{lsredis_8c_acdca9095c7a3288d7febe9f4c440a6e9}{lsredis\_head} = strdup( head);
  \hyperlink{lsredis_8c_a0c81dce2e75584eeb14ab7d9dd86c72e}{lsredis\_publisher} = strdup( pub);

  pthread\_mutex\_init( &\hyperlink{lsredis_8c_ab3ace99b8775e2366da0cfe053b68607}{lsredis\_objs\_mutex}, NULL);
  pthread\_mutex\_init( &\hyperlink{lsredis_8c_a4a3806596ef0d2baac37257033008ff2}{lsredis\_ro\_mutex}, NULL);
  pthread\_mutex\_init( &\hyperlink{lsredis_8c_ad650f89eb0d4fe24a32ea352ac404b27}{lsredis\_wr\_mutex}, NULL);

  \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac} = redisAsyncConnect(\textcolor{stringliteral}{"127.0.0.1"}, 6379);
  \textcolor{keywordflow}{if}( \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->err) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Error: %s"}, \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->errstr
      );
  \}

  \hyperlink{lsredis_8c_a0cd3bdc79d035eb1595371c845d14367}{subfd}.fd           = \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->c.fd;
  \hyperlink{lsredis_8c_a0cd3bdc79d035eb1595371c845d14367}{subfd}.events       = 0;
  \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->ev.data     = &\hyperlink{lsredis_8c_a0cd3bdc79d035eb1595371c845d14367}{subfd};
  \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->ev.addRead  = \hyperlink{lsredis_8c_adee3bccecc86dd531ac5f89491632439}{lsredis\_addRead};
  \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->ev.delRead  = \hyperlink{lsredis_8c_a2e1f2258b3cc864ce3eef4eda556e2a6}{lsredis\_delRead};
  \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->ev.addWrite = \hyperlink{lsredis_8c_a3cb6eda5c8ae80019e7a1c078940e9e9}{lsredis\_addWrite};
  \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->ev.delWrite = \hyperlink{lsredis_8c_a04f0119cfa1156dc34d35b237358822a}{lsredis\_delWrite};
  \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->ev.cleanup  = \hyperlink{lsredis_8c_a45f946a5262c23b362be17c2cb0310c2}{lsredis\_cleanup};

  \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac} = redisAsyncConnect(\textcolor{stringliteral}{"127.0.0.1"}, 6379);
  \textcolor{keywordflow}{if}( \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->err) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Error: %s"}, \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->errstr);
  \}

  \hyperlink{lsredis_8c_add819e43a356d0575ec64c346c6fed57}{rofd}.fd           = \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->c.fd;
  \hyperlink{lsredis_8c_add819e43a356d0575ec64c346c6fed57}{rofd}.events       = 0;
  \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->ev.data     = &\hyperlink{lsredis_8c_add819e43a356d0575ec64c346c6fed57}{rofd};
  \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->ev.addRead  = \hyperlink{lsredis_8c_adee3bccecc86dd531ac5f89491632439}{lsredis\_addRead};
  \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->ev.delRead  = \hyperlink{lsredis_8c_a2e1f2258b3cc864ce3eef4eda556e2a6}{lsredis\_delRead};
  \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->ev.addWrite = \hyperlink{lsredis_8c_a3cb6eda5c8ae80019e7a1c078940e9e9}{lsredis\_addWrite};
  \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->ev.delWrite = \hyperlink{lsredis_8c_a04f0119cfa1156dc34d35b237358822a}{lsredis\_delWrite};
  \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->ev.cleanup  = \hyperlink{lsredis_8c_a45f946a5262c23b362be17c2cb0310c2}{lsredis\_cleanup};

  \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac} = redisAsyncConnect(\textcolor{stringliteral}{"10.1.0.3"}, 6379);
  \textcolor{keywordflow}{if}( \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->err) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Error: %s"}, \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->errstr);
  \}

  \hyperlink{lsredis_8c_a13acbee14dbe8cdb98e238abb921d048}{wrfd}.fd           = \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->c.fd;
  \hyperlink{lsredis_8c_a13acbee14dbe8cdb98e238abb921d048}{wrfd}.events       = 0;
  \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->ev.data     = &\hyperlink{lsredis_8c_a13acbee14dbe8cdb98e238abb921d048}{wrfd};
  \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->ev.addRead  = \hyperlink{lsredis_8c_adee3bccecc86dd531ac5f89491632439}{lsredis\_addRead};
  \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->ev.delRead  = \hyperlink{lsredis_8c_a2e1f2258b3cc864ce3eef4eda556e2a6}{lsredis\_delRead};
  \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->ev.addWrite = \hyperlink{lsredis_8c_a3cb6eda5c8ae80019e7a1c078940e9e9}{lsredis\_addWrite};
  \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->ev.delWrite = \hyperlink{lsredis_8c_a04f0119cfa1156dc34d35b237358822a}{lsredis\_delWrite};
  \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->ev.cleanup  = \hyperlink{lsredis_8c_a45f946a5262c23b362be17c2cb0310c2}{lsredis\_cleanup};

  \hyperlink{lsredis_8c_a07dc95184cac704740bfe16fe4c6a4f0}{lsredis\_select}( re);
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a6ea1992251710763088d23f2a7f00f05}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-isvalid@{lsredis\-\_\-isvalid}}
\index{lsredis\-\_\-isvalid@{lsredis\-\_\-isvalid}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-isvalid}]{\setlength{\rightskip}{0pt plus 5cm}int lsredis\-\_\-isvalid (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a6ea1992251710763088d23f2a7f00f05}


Definition at line 28 of file lsredis.\-c.


\begin{DoxyCode}
                                       \{
  \textcolor{keywordtype}{int} rtn;
  
  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  rtn = p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid};
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_ace75c15c5308a0fcdafcb82c7506872a}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-keys\-C\-B@{lsredis\-\_\-keys\-C\-B}}
\index{lsredis\-\_\-keys\-C\-B@{lsredis\-\_\-keys\-C\-B}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-keys\-C\-B}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-keys\-C\-B (
\begin{DoxyParamCaption}
\item[{redis\-Async\-Context $\ast$}]{ac, }
\item[{void $\ast$}]{reply, }
\item[{void $\ast$}]{privdata}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_ace75c15c5308a0fcdafcb82c7506872a}


Sift through the keys to find ones we like. 

Add them to our list of followed objects 

Definition at line 546 of file lsredis.\-c.


\begin{DoxyCode}
                                                                         \{
  redisReply *r;
  \textcolor{keywordtype}{int} i;
  
  r = reply;
  \textcolor{keywordflow}{if}( r->type != REDIS\_REPLY\_ARRAY) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_keysCB: exepected
       array..."});
    \hyperlink{lsredis_8c_a8268fd06bda0e2c327b057a880b97b59}{lsredis\_debugCB}( ac, reply, privdata);
    \textcolor{keywordflow}{return};
  \}
  
  \textcolor{keywordflow}{for}( i=0; i<r->elements; i++) \{
    \textcolor{keywordflow}{if}( r->element[i]->type != REDIS\_REPLY\_STRING) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_keysCB: exected
       string..."});
      \hyperlink{lsredis_8c_a8268fd06bda0e2c327b057a880b97b59}{lsredis\_debugCB}( ac, r->element[i], privdata);
    \} \textcolor{keywordflow}{else} \{
      \hyperlink{lsredis_8c_ad3189a7329ca92efab0054921f608b97}{lsredis\_maybe\_add\_key}( r->element[i]->str);
    \}
  \}
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_ad3189a7329ca92efab0054921f608b97}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-maybe\-\_\-add\-\_\-key@{lsredis\-\_\-maybe\-\_\-add\-\_\-key}}
\index{lsredis\-\_\-maybe\-\_\-add\-\_\-key@{lsredis\-\_\-maybe\-\_\-add\-\_\-key}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-maybe\-\_\-add\-\_\-key}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-maybe\-\_\-add\-\_\-key (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{k}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_ad3189a7329ca92efab0054921f608b97}


Definition at line 538 of file lsredis.\-c.


\begin{DoxyCode}
                                     \{
  \textcolor{keywordflow}{if}( regexec( &\hyperlink{lsredis_8c_abee04898347f9b2551fa0435b1cc597e}{lsredis\_key\_select\_regex}, k, 0, NULL, 0
      ) == 0) \{
    \hyperlink{lsredis_8c_ac3fb8589e280bfa18ecbca6619fea637}{\_lsredis\_get\_obj}( k);
  \}
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_ad438e4368d86bbe15a93dcf86deaded5}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-run@{lsredis\-\_\-run}}
\index{lsredis\-\_\-run@{lsredis\-\_\-run}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-run}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-run (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_ad438e4368d86bbe15a93dcf86deaded5}


Definition at line 731 of file lsredis.\-c.


\begin{DoxyCode}
                   \{
  pthread\_create( &\hyperlink{lsredis_8c_a79c33eb11ad6819247930ade3a25671f}{lsredis\_thread}, NULL, \hyperlink{lsredis_8c_ade7b1ddfdc88c6964a4c90513e360f75}{lsredis\_worker}
      , NULL);
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a07dc95184cac704740bfe16fe4c6a4f0}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-select@{lsredis\-\_\-select}}
\index{lsredis\-\_\-select@{lsredis\-\_\-select}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-select}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-select (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{re}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a07dc95184cac704740bfe16fe4c6a4f0}


set regexp to select variables we are interested in following 

Note that redis only supports glob matching while we'd prefer something a tad more useful. See \href{http://xkcd.com/208}{\tt http\-://xkcd.\-com/208} 

Definition at line 575 of file lsredis.\-c.


\begin{DoxyCode}
                               \{
  \textcolor{keywordtype}{int} err;
  \textcolor{keywordtype}{char} *errmsg;
  \textcolor{keywordtype}{int}  nerrmsg;

  err = regcomp( &\hyperlink{lsredis_8c_abee04898347f9b2551fa0435b1cc597e}{lsredis\_key\_select\_regex}, re, 
      REG\_EXTENDED);
  \textcolor{keywordflow}{if}( err != 0) \{
    nerrmsg = regerror( err, &\hyperlink{lsredis_8c_abee04898347f9b2551fa0435b1cc597e}{lsredis\_key\_select\_regex},
       NULL, 0);
    \textcolor{keywordflow}{if}( nerrmsg > 0) \{
      errmsg = calloc( nerrmsg, \textcolor{keyword}{sizeof}( \textcolor{keywordtype}{char}));
      nerrmsg = regerror( err, &\hyperlink{lsredis_8c_abee04898347f9b2551fa0435b1cc597e}{lsredis\_key\_select\_regex}
      , errmsg, nerrmsg);
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_select: %s"}, errmsg)
      ;
      free( errmsg);
    \}
  \}
  
  pthread\_mutex\_lock( &\hyperlink{lsredis_8c_a4a3806596ef0d2baac37257033008ff2}{lsredis\_ro\_mutex});
  redisAsyncCommand( \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}, \hyperlink{lsredis_8c_ace75c15c5308a0fcdafcb82c7506872a}{lsredis\_keysCB}, NULL, \textcolor{stringliteral}{"KEYS *"});
  pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_a4a3806596ef0d2baac37257033008ff2}{lsredis\_ro\_mutex});
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_aef0c5c60fcae1461309789ce9816a805}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-set\-\_\-invalid@{lsredis\-\_\-set\-\_\-invalid}}
\index{lsredis\-\_\-set\-\_\-invalid@{lsredis\-\_\-set\-\_\-invalid}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-set\-\_\-invalid}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-set\-\_\-invalid (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_aef0c5c60fcae1461309789ce9816a805}


Definition at line 38 of file lsredis.\-c.


\begin{DoxyCode}
                                            \{
  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} = 0;
  \hyperlink{lsevents_8c_a5c6f122382dea3dcc231b772e5e75b46}{lsevents\_send\_event}( \textcolor{stringliteral}{"%s Invalid"}, p->\hyperlink{structlsredis__obj__struct_ad0a987a011b580eab739cda831f78fbb}{events\_name}
      );
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_ac3c27bda1c9b10e6db14665951746da8}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-set\-\_\-value@{lsredis\-\_\-set\-\_\-value}}
\index{lsredis\-\_\-set\-\_\-value@{lsredis\-\_\-set\-\_\-value}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-set\-\_\-value}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-set\-\_\-value (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p, }
\item[{char $\ast$}]{fmt, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_ac3c27bda1c9b10e6db14665951746da8}


Set the value of a redis object and make it valid. 

Called by mget\-C\-B to set the value as it is in redis Maybe T\-O\-D\-O\-: we've arbitrarily set the maximum size of a value here. Although I cannot imagine needed bigger values it would not be a big deal to enable it. 

Definition at line 72 of file lsredis.\-c.


\begin{DoxyCode}
                                                          \{
  va\_list arg\_ptr;
  \textcolor{keywordtype}{char} v[512];
  
  va\_start( arg\_ptr, fmt);
  vsnprintf( v, \textcolor{keyword}{sizeof}(v)-1, fmt, arg\_ptr);
  va\_end( arg\_ptr);

  v[\textcolor{keyword}{sizeof}(v)-1] = 0;

  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

  \hyperlink{lsredis_8c_a05c7ed2bb1b5702a5c83ed3b51abb546}{\_lsredis\_set\_value}( p, v);

  pthread\_cond\_signal( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond});
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-setstr@{lsredis\-\_\-setstr}}
\index{lsredis\-\_\-setstr@{lsredis\-\_\-setstr}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-setstr}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-setstr (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p, }
\item[{char $\ast$}]{fmt, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}


Set the value and update redis. 

Note that lsredis\-\_\-set\-\_\-value sets the value based on redis while here we set redis based on the value Arbitray maximum string length set here. T\-O\-D\-O\-: Probably this limit should be removed at some point.

redis\-Async\-Command\-Argv used instead of redis\-Async\-Command 'cause it's easier (and possible) to deal with strings that would otherwise cause hiredis to emit a bad command, like those containing spaces. $<$ invalidate the current value\-: set\-\_\-value will fix this and signal waiting threads

$<$ up the count of times we need to see ourselves published before we start listening to others again

$<$ key is \char`\"{}immutable\char`\"{} (not really a C feature). In any case no one is going to be changing it so it's cool to read it without mutex protection.

$<$ redis\-Async\-Command\-Argv shouldn't need to access this after it's made up it's packet (before it returns) so we should be O\-K with this location disappearing soon. 

Definition at line 116 of file lsredis.\-c.


\begin{DoxyCode}
                                                       \{
  va\_list arg\_ptr;
  \textcolor{keywordtype}{char} v[512];
  \textcolor{keywordtype}{char} *argv[4];

  va\_start( arg\_ptr, fmt);
  vsnprintf( v, \textcolor{keyword}{sizeof}(v)-1, fmt, arg\_ptr);
  v[\textcolor{keyword}{sizeof}(v)-1] = 0;
  va\_end( arg\_ptr);
  
  pthread\_mutex\_lock(   &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

  \textcolor{keywordflow}{if}( p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} && strcmp( v, p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value}) == 0) \{
    \textcolor{comment}{// nothing to do}
    pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
    \textcolor{keywordflow}{return};
  \}

  p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid}       = 0;                                              
  \hyperlink{lsevents_8c_a5c6f122382dea3dcc231b772e5e75b46}{lsevents\_send\_event}( \textcolor{stringliteral}{"%s Invalid"}, p->\hyperlink{structlsredis__obj__struct_ad0a987a011b580eab739cda831f78fbb}{events\_name}
      );
  p->\hyperlink{structlsredis__obj__struct_a8bc1a536b7155a1e2a749c7c434b898b}{wait\_for\_me}++;                                          


  argv[0] = \textcolor{stringliteral}{"HSET"};
  argv[1] = p->\hyperlink{structlsredis__obj__struct_aa8c5a453b9424e5666320b8675a42f5c}{key};  
  argv[2] = \textcolor{stringliteral}{"VALUE"};
  argv[3] = v;          

  pthread\_mutex\_lock( &\hyperlink{lsredis_8c_ad650f89eb0d4fe24a32ea352ac404b27}{lsredis\_wr\_mutex});
  redisAsyncCommand( \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}, NULL, NULL, \textcolor{stringliteral}{"MULTI"});
  redisAsyncCommandArgv( \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}, NULL, NULL, 4, (\textcolor{keyword}{const} \textcolor{keywordtype}{char} **)argv, NULL);

  redisAsyncCommand( \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}, NULL, NULL, \textcolor{stringliteral}{"PUBLISH %s %s"}, \hyperlink{lsredis_8c_a0c81dce2e75584eeb14ab7d9dd86c72e}{lsredis\_publisher}
      , p->\hyperlink{structlsredis__obj__struct_aa8c5a453b9424e5666320b8675a42f5c}{key});
  redisAsyncCommand( \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}, NULL, NULL, \textcolor{stringliteral}{"EXEC"});
  pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_ad650f89eb0d4fe24a32ea352ac404b27}{lsredis\_wr\_mutex});

  \textcolor{comment}{// Assume redis will take exactly the value we sent it}
  \textcolor{comment}{//}
  \hyperlink{lsredis_8c_a05c7ed2bb1b5702a5c83ed3b51abb546}{\_lsredis\_set\_value}( p, v);
  pthread\_cond\_signal( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond});
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_a84611531459bf3d92c45b86308b4a300}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-sub\-C\-B@{lsredis\-\_\-sub\-C\-B}}
\index{lsredis\-\_\-sub\-C\-B@{lsredis\-\_\-sub\-C\-B}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-sub\-C\-B}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-sub\-C\-B (
\begin{DoxyParamCaption}
\item[{redis\-Async\-Context $\ast$}]{ac, }
\item[{void $\ast$}]{reply, }
\item[{void $\ast$}]{privdata}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_a84611531459bf3d92c45b86308b4a300}


Use the publication to request the new value. 



Definition at line 429 of file lsredis.\-c.


\begin{DoxyCode}
                                                                        \{
  redisReply *r;
  \hyperlink{structlsredis__obj__struct}{lsredis\_obj\_t} *p, *last, *last2;
  \textcolor{keywordtype}{char} *k;
  \textcolor{keywordtype}{char} *publisher;

  r = (redisReply *)reply;

  \textcolor{comment}{// Ignore our psubscribe reply}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( r->type == REDIS\_REPLY\_ARRAY && r->elements == 3 && r->element[0]->type 
      == REDIS\_REPLY\_STRING && strcmp( r->element[0]->str, \textcolor{stringliteral}{"psubscribe"})==0)
    \textcolor{keywordflow}{return};

  \textcolor{comment}{// But log other stuff we don't understand}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( r->type != REDIS\_REPLY\_ARRAY ||
      r->elements != 4 ||
      r->element[3]->type != REDIS\_REPLY\_STRING ||
      r->element[2]->type != REDIS\_REPLY\_STRING) \{

    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_subCB: unexpected
       reply"});
    \hyperlink{lsredis_8c_a8268fd06bda0e2c327b057a880b97b59}{lsredis\_debugCB}( ac, reply, privdata);
    \textcolor{keywordflow}{return};
  \}

  \textcolor{comment}{//}
  \textcolor{comment}{// Ignore obvious junk}
  \textcolor{comment}{//}
  k = r->element[3]->str;

  \textcolor{keywordflow}{if}( k == NULL || *k == 0)
    \textcolor{keywordflow}{return};
  
  \textcolor{comment}{//}
  \textcolor{comment}{// see if we care}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( regexec( &\hyperlink{lsredis_8c_abee04898347f9b2551fa0435b1cc597e}{lsredis\_key\_select\_regex}, k, 0, NULL, 0
      ) == 0) \{
    \textcolor{comment}{//}
    \textcolor{comment}{// We should know about this one}
    \textcolor{comment}{//}
    pthread\_mutex\_lock( &\hyperlink{lsredis_8c_ab3ace99b8775e2366da0cfe053b68607}{lsredis\_objs\_mutex});
    last  = NULL;
    last2 = NULL;
    \textcolor{keywordflow}{for}( p=\hyperlink{lsredis_8c_a3d206e1c119f1408a7cf1078139f8189}{lsredis\_objs}; p != NULL; p = p->\hyperlink{structlsredis__obj__struct_afb7259e8c3c1c83ccc234b2b2894f2b0}{next}) \{
      \textcolor{keywordflow}{if}( strcmp( p->\hyperlink{structlsredis__obj__struct_aa8c5a453b9424e5666320b8675a42f5c}{key}, k) == 0) \{
        p->\hyperlink{structlsredis__obj__struct_a43fcbff584654ab086d973ce34cb6ddc}{hits}++;
        \textcolor{comment}{//}
        \textcolor{comment}{// Maybe reorder our list so the most often updated objects}
        \textcolor{comment}{// eventually bump up to the beginning of the list.}
        \textcolor{comment}{// That "hits+4" keeps us from oscillating when objects are accessed
       equally}
        \textcolor{comment}{//}
        \textcolor{keywordflow}{if}( last != NULL && last->\hyperlink{structlsredis__obj__struct_a43fcbff584654ab086d973ce34cb6ddc}{hits} < p->\hyperlink{structlsredis__obj__struct_a43fcbff584654ab086d973ce34cb6ddc}{hits}+4) \{
          last->\hyperlink{structlsredis__obj__struct_afb7259e8c3c1c83ccc234b2b2894f2b0}{next} = p->\hyperlink{structlsredis__obj__struct_afb7259e8c3c1c83ccc234b2b2894f2b0}{next};
          p->\hyperlink{structlsredis__obj__struct_afb7259e8c3c1c83ccc234b2b2894f2b0}{next}    = last;
          \textcolor{keywordflow}{if}( last2 != NULL)
            last2->\hyperlink{structlsredis__obj__struct_afb7259e8c3c1c83ccc234b2b2894f2b0}{next} = p;
          \textcolor{keywordflow}{else}
            \hyperlink{lsredis_8c_a3d206e1c119f1408a7cf1078139f8189}{lsredis\_objs} = p;
        \}
        \textcolor{keywordflow}{break};
      \}
      last2 = last;
      last  = p;
    \}    
    pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_ab3ace99b8775e2366da0cfe053b68607}{lsredis\_objs\_mutex});

    \textcolor{keywordflow}{if}( p == NULL) \{
      \textcolor{comment}{//}
      \textcolor{comment}{// Regardless of who the publisher is, apparently there is a key we've
       not seen before}
      \textcolor{comment}{//}
      \hyperlink{lsredis_8c_ac3fb8589e280bfa18ecbca6619fea637}{\_lsredis\_get\_obj}( k);
    \} \textcolor{keywordflow}{else} \{
      \textcolor{comment}{// Look who's talk'n}
      publisher = r->element[2]->str;

      pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
      \textcolor{keywordflow}{if}( p->\hyperlink{structlsredis__obj__struct_a8bc1a536b7155a1e2a749c7c434b898b}{wait\_for\_me}) \{
        \textcolor{comment}{//}
        \textcolor{comment}{// see if we are done waiting}
        \textcolor{comment}{//}
        \textcolor{keywordflow}{if}( strcmp( publisher, \hyperlink{lsredis_8c_a0c81dce2e75584eeb14ab7d9dd86c72e}{lsredis\_publisher})==0)
          p->\hyperlink{structlsredis__obj__struct_a8bc1a536b7155a1e2a749c7c434b898b}{wait\_for\_me}--;

        pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
        \textcolor{comment}{//}
        \textcolor{comment}{// Don't get a new value, either we set it last or we are still waiting
       for redis to report}
        \textcolor{comment}{// our publication}
        \textcolor{comment}{//}
        \textcolor{keywordflow}{return};
      \}

      \textcolor{comment}{// Here we know our value is out of date}
      \textcolor{comment}{//}
      p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} = 0;
      \hyperlink{lsevents_8c_a5c6f122382dea3dcc231b772e5e75b46}{lsevents\_send\_event}( \textcolor{stringliteral}{"%s Invalid"}, p->\hyperlink{structlsredis__obj__struct_ad0a987a011b580eab739cda831f78fbb}{events\_name}
      );
      pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

      \textcolor{comment}{//}
      \textcolor{comment}{// We shouldn't get here if wait\_for\_me is zero and we are the publisher.}
      \textcolor{comment}{// If somehow we did (ie we did an hset with out incrementing wait\_for\_me
       or if we published too many times), it shouldn't hurt to get the value again.}
      \textcolor{comment}{//}
      pthread\_mutex\_lock( &\hyperlink{lsredis_8c_a4a3806596ef0d2baac37257033008ff2}{lsredis\_ro\_mutex});
      redisAsyncCommand( \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}, \hyperlink{lsredis_8c_a8d9719b362d1b38275d734971b7988af}{lsredis\_hgetCB}, p, \textcolor{stringliteral}{"HGET %s
       VALUE"}, k);
      pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_a4a3806596ef0d2baac37257033008ff2}{lsredis\_ro\_mutex});
    \}
  \}
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_ade7b1ddfdc88c6964a4c90513e360f75}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-worker@{lsredis\-\_\-worker}}
\index{lsredis\-\_\-worker@{lsredis\-\_\-worker}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-worker}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ lsredis\-\_\-worker (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{dummy}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_ade7b1ddfdc88c6964a4c90513e360f75}


subscribe to changes and service sockets 

$<$ array of pollfd's for the poll function, one entry per connection

$<$ number of active elements in fda

$<$ poll timeout, in millisecs (of course) 

Definition at line 682 of file lsredis.\-c.


\begin{DoxyCode}
                                    \{
  \textcolor{keyword}{static} \textcolor{keyword}{struct }pollfd fda[3];          
  \textcolor{keyword}{static} \textcolor{keywordtype}{int} nfda = 0;                  
  \textcolor{keyword}{static} \textcolor{keywordtype}{int} poll\_timeout\_ms = -1;      
  \textcolor{keywordtype}{int} pollrtn;
  \textcolor{keywordtype}{int} i;

  pthread\_mutex\_lock( &\hyperlink{lsredis_8c_a4a3806596ef0d2baac37257033008ff2}{lsredis\_ro\_mutex});
  \textcolor{keywordflow}{if}( redisAsyncCommand( \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}, \hyperlink{lsredis_8c_a84611531459bf3d92c45b86308b4a300}{lsredis\_subCB}, NULL, \textcolor{stringliteral}{"
      PSUBSCRIBE REDIS\_KV\_CONNECTOR UI*"}) == REDIS\_ERR) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Error sending PSUBSCRIBE
       command"});
  \}
  pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_a4a3806596ef0d2baac37257033008ff2}{lsredis\_ro\_mutex});

  
  \textcolor{keywordflow}{while}(1) \{
    nfda = 0;

    \textcolor{keywordflow}{if}( \hyperlink{lsredis_8c_a0cd3bdc79d035eb1595371c845d14367}{subfd}.fd != -1) \{
      fda[nfda].fd      = \hyperlink{lsredis_8c_a0cd3bdc79d035eb1595371c845d14367}{subfd}.fd;
      fda[nfda].events  = \hyperlink{lsredis_8c_a0cd3bdc79d035eb1595371c845d14367}{subfd}.events;
      fda[nfda].revents = 0;
      nfda++;
    \}

    \textcolor{keywordflow}{if}( \hyperlink{lsredis_8c_add819e43a356d0575ec64c346c6fed57}{rofd}.fd != -1) \{
      fda[nfda].fd      = \hyperlink{lsredis_8c_add819e43a356d0575ec64c346c6fed57}{rofd}.fd;
      fda[nfda].events  = \hyperlink{lsredis_8c_add819e43a356d0575ec64c346c6fed57}{rofd}.events;
      fda[nfda].revents = 0;
      nfda++;
    \}

    \textcolor{keywordflow}{if}( \hyperlink{lsredis_8c_a13acbee14dbe8cdb98e238abb921d048}{wrfd}.fd != -1) \{
      fda[nfda].fd      = \hyperlink{lsredis_8c_a13acbee14dbe8cdb98e238abb921d048}{wrfd}.fd;
      fda[nfda].events  = \hyperlink{lsredis_8c_a13acbee14dbe8cdb98e238abb921d048}{wrfd}.events;
      fda[nfda].revents = 0;
      nfda++;
    \}

    pollrtn = poll( fda, nfda, poll\_timeout\_ms);

    \textcolor{keywordflow}{for}( i=0; i<nfda; i++) \{
      \textcolor{keywordflow}{if}( fda[i].revents) \{
        \hyperlink{lsredis_8c_ae1478efc852fef71550e0f58d602fa2b}{lsredis\_fd\_service}( &(fda[i]));
      \}
    \}
  \}
\}
\end{DoxyCode}
\hypertarget{lsredis_8c_aa1941e6515a254f76cfd1f18d3c8fac3}{\index{lsredis.\-c@{lsredis.\-c}!redis\-Disconnect\-C\-B@{redis\-Disconnect\-C\-B}}
\index{redis\-Disconnect\-C\-B@{redis\-Disconnect\-C\-B}!lsredis.c@{lsredis.\-c}}
\subsubsection[{redis\-Disconnect\-C\-B}]{\setlength{\rightskip}{0pt plus 5cm}void redis\-Disconnect\-C\-B (
\begin{DoxyParamCaption}
\item[{const redis\-Async\-Context $\ast$}]{ac, }
\item[{int}]{status}
\end{DoxyParamCaption}
)}}\label{lsredis_8c_aa1941e6515a254f76cfd1f18d3c8fac3}


call back incase a redis server becomes disconnected T\-O\-D\-O\-: reconnect 



Definition at line 326 of file lsredis.\-c.


\begin{DoxyCode}
                                                                \{
  \textcolor{keywordflow}{if}( status != REDIS\_OK) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis: Disconnected with
       status %d"}, status);
  \}
\}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{lsredis_8c_acdca9095c7a3288d7febe9f4c440a6e9}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-head@{lsredis\-\_\-head}}
\index{lsredis\-\_\-head@{lsredis\-\_\-head}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-head}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ lsredis\-\_\-head = N\-U\-L\-L\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_acdca9095c7a3288d7febe9f4c440a6e9}


Definition at line 22 of file lsredis.\-c.

\hypertarget{lsredis_8c_abee04898347f9b2551fa0435b1cc597e}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-key\-\_\-select\-\_\-regex@{lsredis\-\_\-key\-\_\-select\-\_\-regex}}
\index{lsredis\-\_\-key\-\_\-select\-\_\-regex@{lsredis\-\_\-key\-\_\-select\-\_\-regex}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-key\-\_\-select\-\_\-regex}]{\setlength{\rightskip}{0pt plus 5cm}regex\-\_\-t lsredis\-\_\-key\-\_\-select\-\_\-regex\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_abee04898347f9b2551fa0435b1cc597e}


Definition at line 21 of file lsredis.\-c.

\hypertarget{lsredis_8c_a3d206e1c119f1408a7cf1078139f8189}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-objs@{lsredis\-\_\-objs}}
\index{lsredis\-\_\-objs@{lsredis\-\_\-objs}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-objs}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lsredis\-\_\-obj\-\_\-t}$\ast$ lsredis\-\_\-objs = N\-U\-L\-L\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_a3d206e1c119f1408a7cf1078139f8189}


Definition at line 11 of file lsredis.\-c.

\hypertarget{lsredis_8c_ab3ace99b8775e2366da0cfe053b68607}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-objs\-\_\-mutex@{lsredis\-\_\-objs\-\_\-mutex}}
\index{lsredis\-\_\-objs\-\_\-mutex@{lsredis\-\_\-objs\-\_\-mutex}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-objs\-\_\-mutex}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-mutex\-\_\-t lsredis\-\_\-objs\-\_\-mutex\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_ab3ace99b8775e2366da0cfe053b68607}


Definition at line 12 of file lsredis.\-c.

\hypertarget{lsredis_8c_a0c81dce2e75584eeb14ab7d9dd86c72e}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-publisher@{lsredis\-\_\-publisher}}
\index{lsredis\-\_\-publisher@{lsredis\-\_\-publisher}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-publisher}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ lsredis\-\_\-publisher = N\-U\-L\-L\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_a0c81dce2e75584eeb14ab7d9dd86c72e}


Definition at line 20 of file lsredis.\-c.

\hypertarget{lsredis_8c_a4a3806596ef0d2baac37257033008ff2}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-ro\-\_\-mutex@{lsredis\-\_\-ro\-\_\-mutex}}
\index{lsredis\-\_\-ro\-\_\-mutex@{lsredis\-\_\-ro\-\_\-mutex}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-ro\-\_\-mutex}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-mutex\-\_\-t lsredis\-\_\-ro\-\_\-mutex\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_a4a3806596ef0d2baac37257033008ff2}


keep from having more than one thread send a rediscommand to the read/only server 



Definition at line 13 of file lsredis.\-c.

\hypertarget{lsredis_8c_a79c33eb11ad6819247930ade3a25671f}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-thread@{lsredis\-\_\-thread}}
\index{lsredis\-\_\-thread@{lsredis\-\_\-thread}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-thread}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-t lsredis\-\_\-thread\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_a79c33eb11ad6819247930ade3a25671f}


Definition at line 9 of file lsredis.\-c.

\hypertarget{lsredis_8c_ad650f89eb0d4fe24a32ea352ac404b27}{\index{lsredis.\-c@{lsredis.\-c}!lsredis\-\_\-wr\-\_\-mutex@{lsredis\-\_\-wr\-\_\-mutex}}
\index{lsredis\-\_\-wr\-\_\-mutex@{lsredis\-\_\-wr\-\_\-mutex}!lsredis.c@{lsredis.\-c}}
\subsubsection[{lsredis\-\_\-wr\-\_\-mutex}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-mutex\-\_\-t lsredis\-\_\-wr\-\_\-mutex\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_ad650f89eb0d4fe24a32ea352ac404b27}


keep from having more than one thread send a rediscommand to the write/read server 



Definition at line 14 of file lsredis.\-c.

\hypertarget{lsredis_8c_afc92245910ec04f9a341c092def45564}{\index{lsredis.\-c@{lsredis.\-c}!roac@{roac}}
\index{roac@{roac}!lsredis.c@{lsredis.\-c}}
\subsubsection[{roac}]{\setlength{\rightskip}{0pt plus 5cm}redis\-Async\-Context$\ast$ roac\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_afc92245910ec04f9a341c092def45564}


Definition at line 17 of file lsredis.\-c.

\hypertarget{lsredis_8c_add819e43a356d0575ec64c346c6fed57}{\index{lsredis.\-c@{lsredis.\-c}!rofd@{rofd}}
\index{rofd@{rofd}!lsredis.c@{lsredis.\-c}}
\subsubsection[{rofd}]{\setlength{\rightskip}{0pt plus 5cm}struct pollfd rofd\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_add819e43a356d0575ec64c346c6fed57}


Definition at line 25 of file lsredis.\-c.

\hypertarget{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{\index{lsredis.\-c@{lsredis.\-c}!subac@{subac}}
\index{subac@{subac}!lsredis.c@{lsredis.\-c}}
\subsubsection[{subac}]{\setlength{\rightskip}{0pt plus 5cm}redis\-Async\-Context$\ast$ subac\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}


Definition at line 16 of file lsredis.\-c.

\hypertarget{lsredis_8c_a0cd3bdc79d035eb1595371c845d14367}{\index{lsredis.\-c@{lsredis.\-c}!subfd@{subfd}}
\index{subfd@{subfd}!lsredis.c@{lsredis.\-c}}
\subsubsection[{subfd}]{\setlength{\rightskip}{0pt plus 5cm}struct pollfd subfd\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_a0cd3bdc79d035eb1595371c845d14367}


Definition at line 24 of file lsredis.\-c.

\hypertarget{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{\index{lsredis.\-c@{lsredis.\-c}!wrac@{wrac}}
\index{wrac@{wrac}!lsredis.c@{lsredis.\-c}}
\subsubsection[{wrac}]{\setlength{\rightskip}{0pt plus 5cm}redis\-Async\-Context$\ast$ wrac\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}


Definition at line 18 of file lsredis.\-c.

\hypertarget{lsredis_8c_a13acbee14dbe8cdb98e238abb921d048}{\index{lsredis.\-c@{lsredis.\-c}!wrfd@{wrfd}}
\index{wrfd@{wrfd}!lsredis.c@{lsredis.\-c}}
\subsubsection[{wrfd}]{\setlength{\rightskip}{0pt plus 5cm}struct pollfd wrfd\hspace{0.3cm}{\ttfamily [static]}}}\label{lsredis_8c_a13acbee14dbe8cdb98e238abb921d048}


Definition at line 26 of file lsredis.\-c.

