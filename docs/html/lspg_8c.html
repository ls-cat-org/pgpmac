<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LS-CAT PGPMAC: lspg.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LS-CAT PGPMAC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lspg_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">lspg.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Postgresql support for the LS-CAT pgpmac project.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="pgpmac_8h_source.html">pgpmac.h</a>&quot;</code><br/>
</div>
<p><a href="lspg_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlspgQueryQueueStruct.html">lspgQueryQueueStruct</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Store each query along with it's callback function.  <a href="structlspgQueryQueueStruct.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlspg__wait__for__detector__struct.html">lspg_wait_for_detector_struct</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Object that implements detector / spindle timing We use database locks for exposure control and this implements the md2 portion of this handshake.  <a href="structlspg__wait__for__detector__struct.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlspg__lock__diffractometer__struct.html">lspg_lock_diffractometer_struct</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Object used to impliment locking the diffractometer Critical to exposure timing.  <a href="structlspg__lock__diffractometer__struct.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlspg__lock__detector__struct.html">lspg_lock_detector_struct</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">lock detector object Implements detector lock for exposure control  <a href="structlspg__lock__detector__struct.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlspg__seq__run__prep__struct.html">lspg_seq_run_prep_struct</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Data collection running object.  <a href="structlspg__seq__run__prep__struct.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:af443092447378c73bf93aa143576aba4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a>&#160;&#160;&#160;-4</td></tr>
<tr class="separator:af443092447378c73bf93aa143576aba4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7ea5876846b5f04c419aee22d3c0aa1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ae7ea5876846b5f04c419aee22d3c0aa1">LS_PG_STATE_INIT_POLL</a>&#160;&#160;&#160;-3</td></tr>
<tr class="separator:ae7ea5876846b5f04c419aee22d3c0aa1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:accda8c3a598dc7f5b107b04986d8ab50"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>&#160;&#160;&#160;-2</td></tr>
<tr class="separator:accda8c3a598dc7f5b107b04986d8ab50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac70a1141f3b138055ea7143bd493187c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ac70a1141f3b138055ea7143bd493187c">LS_PG_STATE_RESET_POLL</a>&#160;&#160;&#160;-1</td></tr>
<tr class="separator:ac70a1141f3b138055ea7143bd493187c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf1dd8ba4dafb91c296554c4cbf312e3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:aaf1dd8ba4dafb91c296554c4cbf312e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c6eb19f262a990e1f9ba630d9edc309"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a3c6eb19f262a990e1f9ba630d9edc309">LS_PG_STATE_SEND</a>&#160;&#160;&#160;2</td></tr>
<tr class="separator:a3c6eb19f262a990e1f9ba630d9edc309"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88a7e80c12fb0449c4b0857a0c7deb21"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a88a7e80c12fb0449c4b0857a0c7deb21">LS_PG_STATE_SEND_FLUSH</a>&#160;&#160;&#160;3</td></tr>
<tr class="separator:a88a7e80c12fb0449c4b0857a0c7deb21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a373e668840b4795ff9a71bc3f744d209"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a373e668840b4795ff9a71bc3f744d209">LS_PG_STATE_RECV</a>&#160;&#160;&#160;4</td></tr>
<tr class="separator:a373e668840b4795ff9a71bc3f744d209"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08fe83fe8226002ee8b80ce0a914fd11"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a08fe83fe8226002ee8b80ce0a914fd11">LS_PG_QUERY_QUEUE_LENGTH</a>&#160;&#160;&#160;16384</td></tr>
<tr class="memdesc:a08fe83fe8226002ee8b80ce0a914fd11"><td class="mdescLeft">&#160;</td><td class="mdescRight">Queue length should be long enough that we do not ordinarly bump into the end We should be safe as long as the thread the adds stuff to the queue is not the one that removes it.  <a href="#a08fe83fe8226002ee8b80ce0a914fd11"></a><br/></td></tr>
<tr class="separator:a08fe83fe8226002ee8b80ce0a914fd11"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ae57432c0a6ac48a50457815dab2c5b4c"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structlspgQueryQueueStruct.html">lspgQueryQueueStruct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a></td></tr>
<tr class="memdesc:ae57432c0a6ac48a50457815dab2c5b4c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Store each query along with it's callback function.  <a href="#ae57432c0a6ac48a50457815dab2c5b4c"></a><br/></td></tr>
<tr class="separator:ae57432c0a6ac48a50457815dab2c5b4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f273a499bf316de95df3816a9b1bc06"><td class="memItemLeft" align="right" valign="top">typedef struct <br class="typebreak"/>
<a class="el" href="structlspg__wait__for__detector__struct.html">lspg_wait_for_detector_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a6f273a499bf316de95df3816a9b1bc06">lspg_wait_for_detector_t</a></td></tr>
<tr class="memdesc:a6f273a499bf316de95df3816a9b1bc06"><td class="mdescLeft">&#160;</td><td class="mdescRight">Object that implements detector / spindle timing We use database locks for exposure control and this implements the md2 portion of this handshake.  <a href="#a6f273a499bf316de95df3816a9b1bc06"></a><br/></td></tr>
<tr class="separator:a6f273a499bf316de95df3816a9b1bc06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7232a0d630558f0c4c081d087150973d"><td class="memItemLeft" align="right" valign="top">typedef struct <br class="typebreak"/>
<a class="el" href="structlspg__lock__diffractometer__struct.html">lspg_lock_diffractometer_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a7232a0d630558f0c4c081d087150973d">lspg_lock_diffractometer_t</a></td></tr>
<tr class="memdesc:a7232a0d630558f0c4c081d087150973d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Object used to impliment locking the diffractometer Critical to exposure timing.  <a href="#a7232a0d630558f0c4c081d087150973d"></a><br/></td></tr>
<tr class="separator:a7232a0d630558f0c4c081d087150973d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3442e66a1f05457eb22a0d4a5d295f3a"><td class="memItemLeft" align="right" valign="top">typedef struct <br class="typebreak"/>
<a class="el" href="structlspg__lock__detector__struct.html">lspg_lock_detector_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a3442e66a1f05457eb22a0d4a5d295f3a">lspg_lock_detector_t</a></td></tr>
<tr class="memdesc:a3442e66a1f05457eb22a0d4a5d295f3a"><td class="mdescLeft">&#160;</td><td class="mdescRight">lock detector object Implements detector lock for exposure control  <a href="#a3442e66a1f05457eb22a0d4a5d295f3a"></a><br/></td></tr>
<tr class="separator:a3442e66a1f05457eb22a0d4a5d295f3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab2da550aea6388c835abe0ee0b226eb0"><td class="memItemLeft" align="right" valign="top">typedef struct <br class="typebreak"/>
<a class="el" href="structlspg__seq__run__prep__struct.html">lspg_seq_run_prep_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ab2da550aea6388c835abe0ee0b226eb0">lspg_seq_run_prep_t</a></td></tr>
<tr class="memdesc:ab2da550aea6388c835abe0ee0b226eb0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Data collection running object.  <a href="#ab2da550aea6388c835abe0ee0b226eb0"></a><br/></td></tr>
<tr class="separator:ab2da550aea6388c835abe0ee0b226eb0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad5f3ec8f197cc330c83dba70f310533c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ad5f3ec8f197cc330c83dba70f310533c">lspg_query_next</a> ()</td></tr>
<tr class="memdesc:ad5f3ec8f197cc330c83dba70f310533c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the next item in the postgresql queue.  <a href="#ad5f3ec8f197cc330c83dba70f310533c"></a><br/></td></tr>
<tr class="separator:ad5f3ec8f197cc330c83dba70f310533c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3847589e641f7e16a0cd68ef30e37cca"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a3847589e641f7e16a0cd68ef30e37cca">lspg_query_reply_next</a> ()</td></tr>
<tr class="memdesc:a3847589e641f7e16a0cd68ef30e37cca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove the oldest item in the queue.  <a href="#a3847589e641f7e16a0cd68ef30e37cca"></a><br/></td></tr>
<tr class="separator:a3847589e641f7e16a0cd68ef30e37cca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6bf4f54117bedf903360883bb32699f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ae6bf4f54117bedf903360883bb32699f">lspg_query_reply_peek</a> ()</td></tr>
<tr class="memdesc:ae6bf4f54117bedf903360883bb32699f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the next item in the reply queue but don't pop it since we may need it more than once.  <a href="#ae6bf4f54117bedf903360883bb32699f"></a><br/></td></tr>
<tr class="separator:ae6bf4f54117bedf903360883bb32699f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0bb9ef42da8fa21c4df48ec384ab69f4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4">lspg_query_push</a> (void(*cb)(<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *, PGresult *), char *fmt,...)</td></tr>
<tr class="memdesc:a0bb9ef42da8fa21c4df48ec384ab69f4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Place a query on the queue.  <a href="#a0bb9ef42da8fa21c4df48ec384ab69f4"></a><br/></td></tr>
<tr class="separator:a0bb9ef42da8fa21c4df48ec384ab69f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46f23ae999129d6fd5712d7975b99aed"><td class="memItemLeft" align="right" valign="top">char **&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a46f23ae999129d6fd5712d7975b99aed">lspg_array2ptrs</a> (char *a)</td></tr>
<tr class="memdesc:a46f23ae999129d6fd5712d7975b99aed"><td class="mdescLeft">&#160;</td><td class="mdescRight">returns a null terminated list of strings parsed from postgresql array  <a href="#a46f23ae999129d6fd5712d7975b99aed"></a><br/></td></tr>
<tr class="separator:a46f23ae999129d6fd5712d7975b99aed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e92a204f606761d368ac7e06ef0f09c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a9e92a204f606761d368ac7e06ef0f09c">lspg_nextshot_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="memdesc:a9e92a204f606761d368ac7e06ef0f09c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Next Shot Callback.  <a href="#a9e92a204f606761d368ac7e06ef0f09c"></a><br/></td></tr>
<tr class="separator:a9e92a204f606761d368ac7e06ef0f09c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff91db7d60e6c832684c023813e36dbf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aff91db7d60e6c832684c023813e36dbf">lspg_nextshot_init</a> ()</td></tr>
<tr class="memdesc:aff91db7d60e6c832684c023813e36dbf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the nextshot variable, mutex, and condition.  <a href="#aff91db7d60e6c832684c023813e36dbf"></a><br/></td></tr>
<tr class="separator:aff91db7d60e6c832684c023813e36dbf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af17ef79544ca5d78fd477010fe90d538"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#af17ef79544ca5d78fd477010fe90d538">lspg_nextshot_call</a> ()</td></tr>
<tr class="memdesc:af17ef79544ca5d78fd477010fe90d538"><td class="mdescLeft">&#160;</td><td class="mdescRight">Queue up a nextshot query.  <a href="#af17ef79544ca5d78fd477010fe90d538"></a><br/></td></tr>
<tr class="separator:af17ef79544ca5d78fd477010fe90d538"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a784a6de32a86fec9efb3ef3ae4b6e3ac"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a784a6de32a86fec9efb3ef3ae4b6e3ac">lspg_nextshot_wait</a> ()</td></tr>
<tr class="memdesc:a784a6de32a86fec9efb3ef3ae4b6e3ac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for the next shot query to get processed.  <a href="#a784a6de32a86fec9efb3ef3ae4b6e3ac"></a><br/></td></tr>
<tr class="separator:a784a6de32a86fec9efb3ef3ae4b6e3ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50458a014041a4118452802dfb303960"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a50458a014041a4118452802dfb303960">lspg_nextshot_done</a> ()</td></tr>
<tr class="memdesc:a50458a014041a4118452802dfb303960"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called when the next shot query has been processed.  <a href="#a50458a014041a4118452802dfb303960"></a><br/></td></tr>
<tr class="separator:a50458a014041a4118452802dfb303960"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3517f8fbed91c998f6036284f9bd0c48"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a3517f8fbed91c998f6036284f9bd0c48">lspg_wait_for_detector_init</a> ()</td></tr>
<tr class="memdesc:a3517f8fbed91c998f6036284f9bd0c48"><td class="mdescLeft">&#160;</td><td class="mdescRight">initialize the detector timing object  <a href="#a3517f8fbed91c998f6036284f9bd0c48"></a><br/></td></tr>
<tr class="separator:a3517f8fbed91c998f6036284f9bd0c48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5747c519d1aa4c310010a862cae8a823"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a5747c519d1aa4c310010a862cae8a823">lspg_wait_for_detector_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="memdesc:a5747c519d1aa4c310010a862cae8a823"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback for the wait for detector query.  <a href="#a5747c519d1aa4c310010a862cae8a823"></a><br/></td></tr>
<tr class="separator:a5747c519d1aa4c310010a862cae8a823"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b5222b859a44eae616804a1e990b86d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a4b5222b859a44eae616804a1e990b86d">lspg_wait_for_detector_call</a> ()</td></tr>
<tr class="memdesc:a4b5222b859a44eae616804a1e990b86d"><td class="mdescLeft">&#160;</td><td class="mdescRight">initiate the wait for detector query  <a href="#a4b5222b859a44eae616804a1e990b86d"></a><br/></td></tr>
<tr class="separator:a4b5222b859a44eae616804a1e990b86d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af094e01be121ce8e14abb679abd17e19"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#af094e01be121ce8e14abb679abd17e19">lspg_wait_for_detector_wait</a> ()</td></tr>
<tr class="memdesc:af094e01be121ce8e14abb679abd17e19"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pause the calling thread until the detector is ready Called by the MD2 thread.  <a href="#af094e01be121ce8e14abb679abd17e19"></a><br/></td></tr>
<tr class="separator:af094e01be121ce8e14abb679abd17e19"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb3645dee7c4514b650ab02f27570a69"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#abb3645dee7c4514b650ab02f27570a69">lspg_wait_for_detector_done</a> ()</td></tr>
<tr class="memdesc:abb3645dee7c4514b650ab02f27570a69"><td class="mdescLeft">&#160;</td><td class="mdescRight">Done waiting for the detector.  <a href="#abb3645dee7c4514b650ab02f27570a69"></a><br/></td></tr>
<tr class="separator:abb3645dee7c4514b650ab02f27570a69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab9780e15924a50b2a5545e10806000b3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ab9780e15924a50b2a5545e10806000b3">lspg_wait_for_detector_all</a> ()</td></tr>
<tr class="memdesc:ab9780e15924a50b2a5545e10806000b3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Combined call to wait for the detector.  <a href="#ab9780e15924a50b2a5545e10806000b3"></a><br/></td></tr>
<tr class="separator:ab9780e15924a50b2a5545e10806000b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39bb94f8e0d47702b2b920a3dee61ebc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a39bb94f8e0d47702b2b920a3dee61ebc">lspg_lock_diffractometer_init</a> ()</td></tr>
<tr class="memdesc:a39bb94f8e0d47702b2b920a3dee61ebc"><td class="mdescLeft">&#160;</td><td class="mdescRight">initialize the diffractometer locking object  <a href="#a39bb94f8e0d47702b2b920a3dee61ebc"></a><br/></td></tr>
<tr class="separator:a39bb94f8e0d47702b2b920a3dee61ebc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad4f378f37c0030634dafa0d9445d916"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aad4f378f37c0030634dafa0d9445d916">lspg_lock_diffractometer_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="memdesc:aad4f378f37c0030634dafa0d9445d916"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback routine for a lock diffractometer query.  <a href="#aad4f378f37c0030634dafa0d9445d916"></a><br/></td></tr>
<tr class="separator:aad4f378f37c0030634dafa0d9445d916"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5ebeb38e8e9926a52f024fe76201175"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ac5ebeb38e8e9926a52f024fe76201175">lspg_lock_diffractometer_call</a> ()</td></tr>
<tr class="memdesc:ac5ebeb38e8e9926a52f024fe76201175"><td class="mdescLeft">&#160;</td><td class="mdescRight">Request that the database grab the diffractometer lock.  <a href="#ac5ebeb38e8e9926a52f024fe76201175"></a><br/></td></tr>
<tr class="separator:ac5ebeb38e8e9926a52f024fe76201175"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8445e1dec753f2c517b87fcb9c5b5943"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a8445e1dec753f2c517b87fcb9c5b5943">lspg_lock_diffractometer_wait</a> ()</td></tr>
<tr class="memdesc:a8445e1dec753f2c517b87fcb9c5b5943"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for the diffractometer lock.  <a href="#a8445e1dec753f2c517b87fcb9c5b5943"></a><br/></td></tr>
<tr class="separator:a8445e1dec753f2c517b87fcb9c5b5943"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75aaf0b3fe33530062226c69a33ce821"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a75aaf0b3fe33530062226c69a33ce821">lspg_lock_diffractometer_done</a> ()</td></tr>
<tr class="memdesc:a75aaf0b3fe33530062226c69a33ce821"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finish up the lock diffractometer call.  <a href="#a75aaf0b3fe33530062226c69a33ce821"></a><br/></td></tr>
<tr class="separator:a75aaf0b3fe33530062226c69a33ce821"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88b33e75c42197740b157a51ea726f21"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a88b33e75c42197740b157a51ea726f21">lspg_lock_diffractometer_all</a> ()</td></tr>
<tr class="memdesc:a88b33e75c42197740b157a51ea726f21"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convience function that combines lock diffractometer calls.  <a href="#a88b33e75c42197740b157a51ea726f21"></a><br/></td></tr>
<tr class="separator:a88b33e75c42197740b157a51ea726f21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e9bbf847dadfe0d10830d67824d9be8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a0e9bbf847dadfe0d10830d67824d9be8">lspg_lock_detector_init</a> ()</td></tr>
<tr class="memdesc:a0e9bbf847dadfe0d10830d67824d9be8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize detector lock object.  <a href="#a0e9bbf847dadfe0d10830d67824d9be8"></a><br/></td></tr>
<tr class="separator:a0e9bbf847dadfe0d10830d67824d9be8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa760191c2b443170cebbcbf5ea5345f3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aa760191c2b443170cebbcbf5ea5345f3">lspg_lock_detector_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="memdesc:aa760191c2b443170cebbcbf5ea5345f3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback for when the detector lock has be grabbed.  <a href="#aa760191c2b443170cebbcbf5ea5345f3"></a><br/></td></tr>
<tr class="separator:aa760191c2b443170cebbcbf5ea5345f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f71a20cc297684b2afe28e7bd8e8383"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a5f71a20cc297684b2afe28e7bd8e8383">lspg_lock_detector_call</a> ()</td></tr>
<tr class="memdesc:a5f71a20cc297684b2afe28e7bd8e8383"><td class="mdescLeft">&#160;</td><td class="mdescRight">Request (demand) a detector lock.  <a href="#a5f71a20cc297684b2afe28e7bd8e8383"></a><br/></td></tr>
<tr class="separator:a5f71a20cc297684b2afe28e7bd8e8383"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3d9c56bd3ca6bcc43db30872cc441cc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ad3d9c56bd3ca6bcc43db30872cc441cc">lspg_lock_detector_wait</a> ()</td></tr>
<tr class="memdesc:ad3d9c56bd3ca6bcc43db30872cc441cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for the detector lock.  <a href="#ad3d9c56bd3ca6bcc43db30872cc441cc"></a><br/></td></tr>
<tr class="separator:ad3d9c56bd3ca6bcc43db30872cc441cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b567040693ff6e2932a2477045d75fa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a1b567040693ff6e2932a2477045d75fa">lspg_lock_detector_done</a> ()</td></tr>
<tr class="memdesc:a1b567040693ff6e2932a2477045d75fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finish waiting.  <a href="#a1b567040693ff6e2932a2477045d75fa"></a><br/></td></tr>
<tr class="separator:a1b567040693ff6e2932a2477045d75fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff93d2f5ac31aa249a0bef40a3837c84"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aff93d2f5ac31aa249a0bef40a3837c84">lspg_lock_detector_all</a> ()</td></tr>
<tr class="memdesc:aff93d2f5ac31aa249a0bef40a3837c84"><td class="mdescLeft">&#160;</td><td class="mdescRight">Detector lock convinence function.  <a href="#aff93d2f5ac31aa249a0bef40a3837c84"></a><br/></td></tr>
<tr class="separator:aff93d2f5ac31aa249a0bef40a3837c84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31823ecb2b44d4a6674f804059a27bce"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a31823ecb2b44d4a6674f804059a27bce">lspg_seq_run_prep_init</a> ()</td></tr>
<tr class="memdesc:a31823ecb2b44d4a6674f804059a27bce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the data collection object.  <a href="#a31823ecb2b44d4a6674f804059a27bce"></a><br/></td></tr>
<tr class="separator:a31823ecb2b44d4a6674f804059a27bce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a11cda12050dc9a86188e15e2155a6013"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a11cda12050dc9a86188e15e2155a6013">lspg_seq_run_prep_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="memdesc:a11cda12050dc9a86188e15e2155a6013"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback for the seq_run_prep query.  <a href="#a11cda12050dc9a86188e15e2155a6013"></a><br/></td></tr>
<tr class="separator:a11cda12050dc9a86188e15e2155a6013"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7d6efd861b152a371442791deb42bd3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#af7d6efd861b152a371442791deb42bd3">lspg_seq_run_prep_call</a> (long long skey, double <a class="el" href="pgpmac_8h.html#a0be79ccb7ebf3a665248fd856112b9fd">kappa</a>, double <a class="el" href="pgpmac_8h.html#ac8070dc568ad974a3db42b51eca828cc">phi</a>, double cx, double cy, double ax, double ay, double az)</td></tr>
<tr class="memdesc:af7d6efd861b152a371442791deb42bd3"><td class="mdescLeft">&#160;</td><td class="mdescRight">queue up the seq_run_prep query  <a href="#af7d6efd861b152a371442791deb42bd3"></a><br/></td></tr>
<tr class="separator:af7d6efd861b152a371442791deb42bd3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0b01f501322432a8fa37f31898c3499"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ac0b01f501322432a8fa37f31898c3499">lspg_seq_run_prep_wait</a> ()</td></tr>
<tr class="memdesc:ac0b01f501322432a8fa37f31898c3499"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for seq run prep query to return.  <a href="#ac0b01f501322432a8fa37f31898c3499"></a><br/></td></tr>
<tr class="separator:ac0b01f501322432a8fa37f31898c3499"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a472b09ddf716c80207f97e2bb5d37d66"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a472b09ddf716c80207f97e2bb5d37d66">lspg_seq_run_prep_done</a> ()</td></tr>
<tr class="memdesc:a472b09ddf716c80207f97e2bb5d37d66"><td class="mdescLeft">&#160;</td><td class="mdescRight">Indicate we are done waiting.  <a href="#a472b09ddf716c80207f97e2bb5d37d66"></a><br/></td></tr>
<tr class="separator:a472b09ddf716c80207f97e2bb5d37d66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4253474d4dd305aec0afdd5552b3ddd5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a4253474d4dd305aec0afdd5552b3ddd5">lspg_seq_run_prep_all</a> (long long skey, double <a class="el" href="pgpmac_8h.html#a0be79ccb7ebf3a665248fd856112b9fd">kappa</a>, double <a class="el" href="pgpmac_8h.html#ac8070dc568ad974a3db42b51eca828cc">phi</a>, double cx, double cy, double ax, double ay, double az)</td></tr>
<tr class="memdesc:a4253474d4dd305aec0afdd5552b3ddd5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convinence function to call seq run prep.  <a href="#a4253474d4dd305aec0afdd5552b3ddd5"></a><br/></td></tr>
<tr class="separator:a4253474d4dd305aec0afdd5552b3ddd5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8184824f2b71b1d35141d7922ca69cd7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a8184824f2b71b1d35141d7922ca69cd7">lspg_getcenter_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="memdesc:a8184824f2b71b1d35141d7922ca69cd7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve the data to center the crystal.  <a href="#a8184824f2b71b1d35141d7922ca69cd7"></a><br/></td></tr>
<tr class="separator:a8184824f2b71b1d35141d7922ca69cd7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad31db17587a02302ac4e40fb7d260b1b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ad31db17587a02302ac4e40fb7d260b1b">lspg_getcenter_init</a> ()</td></tr>
<tr class="memdesc:ad31db17587a02302ac4e40fb7d260b1b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize getcenter object.  <a href="#ad31db17587a02302ac4e40fb7d260b1b"></a><br/></td></tr>
<tr class="separator:ad31db17587a02302ac4e40fb7d260b1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f7cd0a06f6a266ef65b3604cf33d6c4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a6f7cd0a06f6a266ef65b3604cf33d6c4">lspg_getcenter_call</a> ()</td></tr>
<tr class="memdesc:a6f7cd0a06f6a266ef65b3604cf33d6c4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Request a getcenter query.  <a href="#a6f7cd0a06f6a266ef65b3604cf33d6c4"></a><br/></td></tr>
<tr class="separator:a6f7cd0a06f6a266ef65b3604cf33d6c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e0e4b3cb9fa03961ee0c104e0b06754"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a3e0e4b3cb9fa03961ee0c104e0b06754">lspg_getcenter_wait</a> ()</td></tr>
<tr class="memdesc:a3e0e4b3cb9fa03961ee0c104e0b06754"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for a getcenter query to return.  <a href="#a3e0e4b3cb9fa03961ee0c104e0b06754"></a><br/></td></tr>
<tr class="separator:a3e0e4b3cb9fa03961ee0c104e0b06754"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c678553b44c874d08ec9966ed7bb1c0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a7c678553b44c874d08ec9966ed7bb1c0">lspg_getcenter_done</a> ()</td></tr>
<tr class="memdesc:a7c678553b44c874d08ec9966ed7bb1c0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Done with getcenter query.  <a href="#a7c678553b44c874d08ec9966ed7bb1c0"></a><br/></td></tr>
<tr class="separator:a7c678553b44c874d08ec9966ed7bb1c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a523b492d9cd4970853eabee2d3c31578"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a523b492d9cd4970853eabee2d3c31578">lspg_getcenter_all</a> ()</td></tr>
<tr class="memdesc:a523b492d9cd4970853eabee2d3c31578"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convenience function to complete synchronous getcenter query.  <a href="#a523b492d9cd4970853eabee2d3c31578"></a><br/></td></tr>
<tr class="separator:a523b492d9cd4970853eabee2d3c31578"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeda8dad89b03d7d61cc994dd63ee5db6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aeda8dad89b03d7d61cc994dd63ee5db6">lspg_nextaction_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="memdesc:aeda8dad89b03d7d61cc994dd63ee5db6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Queue the next MD2 instruction.  <a href="#aeda8dad89b03d7d61cc994dd63ee5db6"></a><br/></td></tr>
<tr class="separator:aeda8dad89b03d7d61cc994dd63ee5db6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e11f525ca0f9ac9ab71f9fbe983c42b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a1e11f525ca0f9ac9ab71f9fbe983c42b">lspg_cmd_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="memdesc:a1e11f525ca0f9ac9ab71f9fbe983c42b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send strings directly to PMAC queue.  <a href="#a1e11f525ca0f9ac9ab71f9fbe983c42b"></a><br/></td></tr>
<tr class="separator:a1e11f525ca0f9ac9ab71f9fbe983c42b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6485ac1749c5de3008dd0e0badaa09c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#af6485ac1749c5de3008dd0e0badaa09c">lspg_flush</a> ()</td></tr>
<tr class="memdesc:af6485ac1749c5de3008dd0e0badaa09c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flush psql output buffer (ie, send the query)  <a href="#af6485ac1749c5de3008dd0e0badaa09c"></a><br/></td></tr>
<tr class="separator:af6485ac1749c5de3008dd0e0badaa09c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a714b15e117ffe7bfce4f2f2ce4725b0a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a714b15e117ffe7bfce4f2f2ce4725b0a">lspg_send_next_query</a> ()</td></tr>
<tr class="memdesc:a714b15e117ffe7bfce4f2f2ce4725b0a"><td class="mdescLeft">&#160;</td><td class="mdescRight">send the next queued query to the DB server  <a href="#a714b15e117ffe7bfce4f2f2ce4725b0a"></a><br/></td></tr>
<tr class="separator:a714b15e117ffe7bfce4f2f2ce4725b0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a038c5af23469b789fc1c55d21cb43029"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a038c5af23469b789fc1c55d21cb43029">lspg_receive</a> ()</td></tr>
<tr class="memdesc:a038c5af23469b789fc1c55d21cb43029"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receive a result of a query.  <a href="#a038c5af23469b789fc1c55d21cb43029"></a><br/></td></tr>
<tr class="separator:a038c5af23469b789fc1c55d21cb43029"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a049f4422994aa2eb2b841ffb2937f895"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a049f4422994aa2eb2b841ffb2937f895">lspg_sig_service</a> (struct pollfd *evt)</td></tr>
<tr class="memdesc:a049f4422994aa2eb2b841ffb2937f895"><td class="mdescLeft">&#160;</td><td class="mdescRight">Service a signal Signals here are treated as file descriptors and fits into our poll scheme.  <a href="#a049f4422994aa2eb2b841ffb2937f895"></a><br/></td></tr>
<tr class="separator:a049f4422994aa2eb2b841ffb2937f895"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8d1fed4b461c2139a21826d524777d5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aa8d1fed4b461c2139a21826d524777d5">lspg_pg_service</a> (struct pollfd *evt)</td></tr>
<tr class="memdesc:aa8d1fed4b461c2139a21826d524777d5"><td class="mdescLeft">&#160;</td><td class="mdescRight">I/O control to/from the postgresql server.  <a href="#aa8d1fed4b461c2139a21826d524777d5"></a><br/></td></tr>
<tr class="separator:aa8d1fed4b461c2139a21826d524777d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62b110949d206fb22789191207e1d066"><td class="memItemLeft" align="right" valign="top">PQnoticeProcessor&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a62b110949d206fb22789191207e1d066">lspg_notice_processor</a> (void *arg, const char *msg)</td></tr>
<tr class="separator:a62b110949d206fb22789191207e1d066"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a581c18be0368425665a40b4b7f7d9714"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a581c18be0368425665a40b4b7f7d9714">lspg_pg_connect</a> ()</td></tr>
<tr class="memdesc:a581c18be0368425665a40b4b7f7d9714"><td class="mdescLeft">&#160;</td><td class="mdescRight">Connect to the pg server.  <a href="#a581c18be0368425665a40b4b7f7d9714"></a><br/></td></tr>
<tr class="separator:a581c18be0368425665a40b4b7f7d9714"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab52a8c8245bf6561f40c0f224fc07ff4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ab52a8c8245bf6561f40c0f224fc07ff4">lspg_next_state</a> ()</td></tr>
<tr class="memdesc:ab52a8c8245bf6561f40c0f224fc07ff4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implements our state machine Does not strictly only set the next state as it also calls some functions that, perhaps, alters the state mid-function.  <a href="#ab52a8c8245bf6561f40c0f224fc07ff4"></a><br/></td></tr>
<tr class="separator:ab52a8c8245bf6561f40c0f224fc07ff4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf4fadd2943fa3a2ecb5d840e84d68fa"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aaf4fadd2943fa3a2ecb5d840e84d68fa">lspg_worker</a> (void *dummy)</td></tr>
<tr class="memdesc:aaf4fadd2943fa3a2ecb5d840e84d68fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">The main loop for the lspg thread.  <a href="#aaf4fadd2943fa3a2ecb5d840e84d68fa"></a><br/></td></tr>
<tr class="separator:aaf4fadd2943fa3a2ecb5d840e84d68fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a77972df14166e05c94ed0792baa09b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a8a77972df14166e05c94ed0792baa09b">lspg_init</a> ()</td></tr>
<tr class="memdesc:a8a77972df14166e05c94ed0792baa09b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initiallize the lspg module.  <a href="#a8a77972df14166e05c94ed0792baa09b"></a><br/></td></tr>
<tr class="separator:a8a77972df14166e05c94ed0792baa09b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1adfdb5ca9fdb5060849d726bf540117"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a1adfdb5ca9fdb5060849d726bf540117">lspg_run</a> ()</td></tr>
<tr class="memdesc:a1adfdb5ca9fdb5060849d726bf540117"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start 'er runnin'.  <a href="#a1adfdb5ca9fdb5060849d726bf540117"></a><br/></td></tr>
<tr class="separator:a1adfdb5ca9fdb5060849d726bf540117"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a4937baac0cc78ea306d58b5f027867f1"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1">ls_pg_state</a> = <a class="el" href="lspg_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a></td></tr>
<tr class="memdesc:a4937baac0cc78ea306d58b5f027867f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">State of the lspg state machine.  <a href="#a4937baac0cc78ea306d58b5f027867f1"></a><br/></td></tr>
<tr class="separator:a4937baac0cc78ea306d58b5f027867f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad40ac52086f6b774928af45b09d54c6e"><td class="memItemLeft" align="right" valign="top">static struct timeval <br class="typebreak"/>
lspg_time_sent&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ad40ac52086f6b774928af45b09d54c6e">now</a></td></tr>
<tr class="memdesc:ad40ac52086f6b774928af45b09d54c6e"><td class="mdescLeft">&#160;</td><td class="mdescRight">used to ensure we do not inundate the db server with connection requests  <a href="#ad40ac52086f6b774928af45b09d54c6e"></a><br/></td></tr>
<tr class="separator:ad40ac52086f6b774928af45b09d54c6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04eb0cda0d5e5afeae7c393b51689765"><td class="memItemLeft" align="right" valign="top">static pthread_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a04eb0cda0d5e5afeae7c393b51689765">lspg_thread</a></td></tr>
<tr class="memdesc:a04eb0cda0d5e5afeae7c393b51689765"><td class="mdescLeft">&#160;</td><td class="mdescRight">our worker thread  <a href="#a04eb0cda0d5e5afeae7c393b51689765"></a><br/></td></tr>
<tr class="separator:a04eb0cda0d5e5afeae7c393b51689765"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed46a94106c583796e3a8ca0e89aa8e4"><td class="memItemLeft" align="right" valign="top">static pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4">lspg_queue_mutex</a></td></tr>
<tr class="memdesc:aed46a94106c583796e3a8ca0e89aa8e4"><td class="mdescLeft">&#160;</td><td class="mdescRight">keep the queue from getting tangled  <a href="#aed46a94106c583796e3a8ca0e89aa8e4"></a><br/></td></tr>
<tr class="separator:aed46a94106c583796e3a8ca0e89aa8e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61a308b6a37afd645beb422653b95baa"><td class="memItemLeft" align="right" valign="top">static pthread_cond_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a61a308b6a37afd645beb422653b95baa">lspg_queue_cond</a></td></tr>
<tr class="memdesc:a61a308b6a37afd645beb422653b95baa"><td class="mdescLeft">&#160;</td><td class="mdescRight">keeps the queue from overflowing  <a href="#a61a308b6a37afd645beb422653b95baa"></a><br/></td></tr>
<tr class="separator:a61a308b6a37afd645beb422653b95baa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af3f897b8ffa020ca54289bc5b28cb64d"><td class="memItemLeft" align="right" valign="top">static struct pollfd&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d">lspgfd</a></td></tr>
<tr class="memdesc:af3f897b8ffa020ca54289bc5b28cb64d"><td class="mdescLeft">&#160;</td><td class="mdescRight">our poll info  <a href="#af3f897b8ffa020ca54289bc5b28cb64d"></a><br/></td></tr>
<tr class="separator:af3f897b8ffa020ca54289bc5b28cb64d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a357d9d98f0b8c9625ccebcebfcdce955"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a357d9d98f0b8c9625ccebcebfcdce955">lspg_query_queue</a> [<a class="el" href="lspg_8c.html#a08fe83fe8226002ee8b80ce0a914fd11">LS_PG_QUERY_QUEUE_LENGTH</a>]</td></tr>
<tr class="memdesc:a357d9d98f0b8c9625ccebcebfcdce955"><td class="mdescLeft">&#160;</td><td class="mdescRight">Our query queue.  <a href="#a357d9d98f0b8c9625ccebcebfcdce955"></a><br/></td></tr>
<tr class="separator:a357d9d98f0b8c9625ccebcebfcdce955"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3cbe7f3161b3c1838ebc56a3bbcfd8a6"><td class="memItemLeft" align="right" valign="top">static unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6">lspg_query_queue_on</a> = 0</td></tr>
<tr class="memdesc:a3cbe7f3161b3c1838ebc56a3bbcfd8a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Next position to add something to the queue.  <a href="#a3cbe7f3161b3c1838ebc56a3bbcfd8a6"></a><br/></td></tr>
<tr class="separator:a3cbe7f3161b3c1838ebc56a3bbcfd8a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca86bb77d6cecfae9251743f4171bafb"><td class="memItemLeft" align="right" valign="top">static unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aca86bb77d6cecfae9251743f4171bafb">lspg_query_queue_off</a> = 0</td></tr>
<tr class="memdesc:aca86bb77d6cecfae9251743f4171bafb"><td class="mdescLeft">&#160;</td><td class="mdescRight">The last item still being used (on == off means nothing in queue)  <a href="#aca86bb77d6cecfae9251743f4171bafb"></a><br/></td></tr>
<tr class="separator:aca86bb77d6cecfae9251743f4171bafb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2603b071afdbff7c0924b13de2454264"><td class="memItemLeft" align="right" valign="top">static unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a2603b071afdbff7c0924b13de2454264">lspg_query_queue_reply</a> = 0</td></tr>
<tr class="memdesc:a2603b071afdbff7c0924b13de2454264"><td class="mdescLeft">&#160;</td><td class="mdescRight">The current item being digested.  <a href="#a2603b071afdbff7c0924b13de2454264"></a><br/></td></tr>
<tr class="separator:a2603b071afdbff7c0924b13de2454264"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9012783dbbadf652a81649a289697cf3"><td class="memItemLeft" align="right" valign="top">static PGconn *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3">q</a> = NULL</td></tr>
<tr class="memdesc:a9012783dbbadf652a81649a289697cf3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Database connector.  <a href="#a9012783dbbadf652a81649a289697cf3"></a><br/></td></tr>
<tr class="separator:a9012783dbbadf652a81649a289697cf3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69ae04978986e6413ca7cefcb692b645"><td class="memItemLeft" align="right" valign="top">static PostgresPollingStatusType&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a69ae04978986e6413ca7cefcb692b645">lspg_connectPoll_response</a></td></tr>
<tr class="memdesc:a69ae04978986e6413ca7cefcb692b645"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used to determine state while connecting.  <a href="#a69ae04978986e6413ca7cefcb692b645"></a><br/></td></tr>
<tr class="separator:a69ae04978986e6413ca7cefcb692b645"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06c5a937e41a6c706a247777642ec1fb"><td class="memItemLeft" align="right" valign="top">static PostgresPollingStatusType&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a06c5a937e41a6c706a247777642ec1fb">lspg_resetPoll_response</a></td></tr>
<tr class="memdesc:a06c5a937e41a6c706a247777642ec1fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used to determine state while reconnecting.  <a href="#a06c5a937e41a6c706a247777642ec1fb"></a><br/></td></tr>
<tr class="separator:a06c5a937e41a6c706a247777642ec1fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8d8e2f578ca79189a80c1fd5b60cefd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#a17ea2bf07a0b3b892baa00bd392607b3">lspg_nextshot_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd">lspg_nextshot</a></td></tr>
<tr class="memdesc:ad8d8e2f578ca79189a80c1fd5b60cefd"><td class="mdescLeft">&#160;</td><td class="mdescRight">the nextshot object  <a href="#ad8d8e2f578ca79189a80c1fd5b60cefd"></a><br/></td></tr>
<tr class="separator:ad8d8e2f578ca79189a80c1fd5b60cefd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ef8a09203117578c9b2ce4719519f36"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pgpmac_8h.html#a48b627e412dd038c1f17cdb0501eec33">lspg_getcenter_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36">lspg_getcenter</a></td></tr>
<tr class="memdesc:a7ef8a09203117578c9b2ce4719519f36"><td class="mdescLeft">&#160;</td><td class="mdescRight">the getcenter object  <a href="#a7ef8a09203117578c9b2ce4719519f36"></a><br/></td></tr>
<tr class="separator:a7ef8a09203117578c9b2ce4719519f36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0dfc8d0410cd2d7f7da7a70d3ef88e58"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="lspg_8c.html#a6f273a499bf316de95df3816a9b1bc06">lspg_wait_for_detector_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58">lspg_wait_for_detector</a></td></tr>
<tr class="memdesc:a0dfc8d0410cd2d7f7da7a70d3ef88e58"><td class="mdescLeft">&#160;</td><td class="mdescRight">Instance of the detector timing object.  <a href="#a0dfc8d0410cd2d7f7da7a70d3ef88e58"></a><br/></td></tr>
<tr class="separator:a0dfc8d0410cd2d7f7da7a70d3ef88e58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaae7ce3ecd7d54a9e46c41d7a742a454"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="lspg_8c.html#a7232a0d630558f0c4c081d087150973d">lspg_lock_diffractometer_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a></td></tr>
<tr class="separator:aaae7ce3ecd7d54a9e46c41d7a742a454"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbf3b3652c6531c3d194320d1abc1c80"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="lspg_8c.html#a3442e66a1f05457eb22a0d4a5d295f3a">lspg_lock_detector_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a></td></tr>
<tr class="separator:adbf3b3652c6531c3d194320d1abc1c80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b0d9fc30bcea6905b075d2362149172"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="lspg_8c.html#ab2da550aea6388c835abe0ee0b226eb0">lspg_seq_run_prep_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a></td></tr>
<tr class="separator:a1b0d9fc30bcea6905b075d2362149172"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Postgresql support for the LS-CAT pgpmac project. </p>
<pre class="fragment">\date 2012
\author Keith Brister
\copyright All Rights Reserved
</pre><pre>
  Database state machine</pre><pre>State           Description</pre><pre> -4             Initiate connection
 -3             Poll until connection initialization is complete
 -2             Initiate reset
 -1             Poll until connection reset is complete
  1             Idle (wait for a notify from the server)
  2             Send a query to the server
  3             Continue flushing a command to the server
  4             Waiting for a reply
</pre> 
<p>Definition in file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a08fe83fe8226002ee8b80ce0a914fd11"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_QUERY_QUEUE_LENGTH&#160;&#160;&#160;16384</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Queue length should be long enough that we do not ordinarly bump into the end We should be safe as long as the thread the adds stuff to the queue is not the one that removes it. </p>
<p>(And we can tolerate the adding thread being paused.) </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00060">60</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="aaf1dd8ba4dafb91c296554c4cbf312e3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_STATE_IDLE&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00034">34</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="af443092447378c73bf93aa143576aba4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_STATE_INIT&#160;&#160;&#160;-4</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00030">30</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae7ea5876846b5f04c419aee22d3c0aa1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_STATE_INIT_POLL&#160;&#160;&#160;-3</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00031">31</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a373e668840b4795ff9a71bc3f744d209"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_STATE_RECV&#160;&#160;&#160;4</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00037">37</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="accda8c3a598dc7f5b107b04986d8ab50"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_STATE_RESET&#160;&#160;&#160;-2</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00032">32</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac70a1141f3b138055ea7143bd493187c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_STATE_RESET_POLL&#160;&#160;&#160;-1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00033">33</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3c6eb19f262a990e1f9ba630d9edc309"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_STATE_SEND&#160;&#160;&#160;2</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00035">35</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a88a7e80c12fb0449c4b0857a0c7deb21"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_STATE_SEND_FLUSH&#160;&#160;&#160;3</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00036">36</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="a3442e66a1f05457eb22a0d4a5d295f3a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlspg__lock__detector__struct.html">lspg_lock_detector_struct</a>  <a class="el" href="lspg_8c.html#a3442e66a1f05457eb22a0d4a5d295f3a">lspg_lock_detector_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>lock detector object Implements detector lock for exposure control </p>

</div>
</div>
<a class="anchor" id="a7232a0d630558f0c4c081d087150973d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlspg__lock__diffractometer__struct.html">lspg_lock_diffractometer_struct</a>  <a class="el" href="lspg_8c.html#a7232a0d630558f0c4c081d087150973d">lspg_lock_diffractometer_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Object used to impliment locking the diffractometer Critical to exposure timing. </p>

</div>
</div>
<a class="anchor" id="ae57432c0a6ac48a50457815dab2c5b4c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlspgQueryQueueStruct.html">lspgQueryQueueStruct</a>  <a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Store each query along with it's callback function. </p>
<p>All calls are asynchronous </p>

</div>
</div>
<a class="anchor" id="ab2da550aea6388c835abe0ee0b226eb0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlspg__seq__run__prep__struct.html">lspg_seq_run_prep_struct</a>  <a class="el" href="lspg_8c.html#ab2da550aea6388c835abe0ee0b226eb0">lspg_seq_run_prep_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Data collection running object. </p>

</div>
</div>
<a class="anchor" id="a6f273a499bf316de95df3816a9b1bc06"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlspg__wait__for__detector__struct.html">lspg_wait_for_detector_struct</a>  <a class="el" href="lspg_8c.html#a6f273a499bf316de95df3816a9b1bc06">lspg_wait_for_detector_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Object that implements detector / spindle timing We use database locks for exposure control and this implements the md2 portion of this handshake. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a46f23ae999129d6fd5712d7975b99aed"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char** lspg_array2ptrs </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>a</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>returns a null terminated list of strings parsed from postgresql array </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00165">165</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                 {</div>
<div class="line">  <span class="keywordtype">char</span> **rtn, *sp, *acums;</div>
<div class="line">  <span class="keywordtype">int</span> i, n, inquote, havebackslash, rtni;;</div>
<div class="line">  <span class="keywordtype">int</span> mxsz;</div>
<div class="line">  </div>
<div class="line">  inquote       = 0;</div>
<div class="line">  havebackslash = 0;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Despense with the null input condition before we complicate the code below</span></div>
<div class="line">  <span class="keywordflow">if</span>( a == NULL || a[0] == 0)</div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Count the maximum number of strings</span></div>
<div class="line">  <span class="comment">// Actual number will be less if there are quoted commas</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  n = 1;</div>
<div class="line">  <span class="keywordflow">for</span>( i=0; a[i]; i++) {</div>
<div class="line">    <span class="keywordflow">if</span>( a[i] == <span class="charliteral">&#39;,&#39;</span>)</div>
<div class="line">      n++;</div>
<div class="line">  }</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// The maximum size of any string is the length of a (+1)</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  mxsz = strlen(a) + 1;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// This is the accumulation string to make up the array elements</span></div>
<div class="line">  acums = (<span class="keywordtype">char</span> *)calloc( mxsz, <span class="keyword">sizeof</span>( <span class="keywordtype">char</span>));</div>
<div class="line">  <span class="keywordflow">if</span>( acums == NULL) {</div>
<div class="line">    <span class="comment">// TODO: print or otherwise log this condition</span></div>
<div class="line">    <span class="comment">// out of memory</span></div>
<div class="line">    exit( 1);</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// allocate storage for the pointer array and the null terminator</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  rtn = (<span class="keywordtype">char</span> **)calloc( n+1, <span class="keyword">sizeof</span>( <span class="keywordtype">char</span> *));</div>
<div class="line">  <span class="keywordflow">if</span>( rtn == NULL) {</div>
<div class="line">    <span class="comment">// TODO: print or otherwise log this condition</span></div>
<div class="line">    <span class="comment">// out of memory</span></div>
<div class="line">    exit( 1);</div>
<div class="line">  }</div>
<div class="line">  rtni = 0;</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Go through and create the individual strings</span></div>
<div class="line">  sp = acums;</div>
<div class="line">  *sp = 0;</div>
<div class="line">  <span class="keywordflow">if</span>( a[0] != <span class="charliteral">&#39;{&#39;</span>) {</div>
<div class="line">    <span class="comment">// oh no!  This isn&#39;t an array after all!</span></div>
<div class="line">    <span class="comment">// Zounds!</span></div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">  }</div>
<div class="line">  inquote = 0;</div>
<div class="line">  havebackslash = 0;</div>
<div class="line">  <span class="keywordflow">for</span>( i=1; a[i] != 0; i++) {</div>
<div class="line">    <span class="keywordflow">switch</span>( a[i]) {</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;&quot;&#39;</span>:</div>
<div class="line">      <span class="keywordflow">if</span>( havebackslash) {</div>
<div class="line">        <span class="comment">// a quoted quote.  Cool</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        *(sp++) = a[i];</div>
<div class="line">        *sp = 0;</div>
<div class="line">        havebackslash = 0;</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">// Toggle the flag</span></div>
<div class="line">        inquote = 1 - inquote;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;\\&#39;</span>:</div>
<div class="line">      <span class="keywordflow">if</span>( havebackslash) {</div>
<div class="line">        *(sp++) = a[i];</div>
<div class="line">        *sp = 0;</div>
<div class="line">        havebackslash = 0;</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        havebackslash = 1;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;,&#39;</span>:</div>
<div class="line">      <span class="keywordflow">if</span>( inquote || havebackslash) {</div>
<div class="line">        *(sp++) = a[i];</div>
<div class="line">        *sp = 0;</div>
<div class="line">        havebackslash = 0;</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        rtn[rtni++] = strdup( acums);</div>
<div class="line">        sp = acums;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">      </div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;}&#39;</span>:</div>
<div class="line">      <span class="keywordflow">if</span>( inquote || havebackslash) {</div>
<div class="line">        *(sp++) = a[i];</div>
<div class="line">        *sp = 0;</div>
<div class="line">        havebackslash = 0;</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        rtn[rtni++] = strdup( acums);</div>
<div class="line">        rtn[rtni]   = NULL;</div>
<div class="line">        <span class="keywordflow">return</span>( rtn);</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">      *(sp++) = a[i];</div>
<div class="line">      *sp = 0;</div>
<div class="line">      havebackslash = 0;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Getting here means the final &#39;}&#39; was missing</span></div>
<div class="line">  <span class="comment">// Probably we should throw an error or log it or something.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  rtn[rtni++] = strdup( acums);</div>
<div class="line">  rtn[rtni]   = NULL;</div>
<div class="line">  <span class="keywordflow">return</span>( rtn);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1e11f525ca0f9ac9ab71f9fbe983c42b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_cmd_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send strings directly to PMAC queue. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">qqp</td><td>Our query </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pgr</td><td>Our result </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00958">958</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                   {</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Call back funciton assumes query results in zero or more commands to send to the PMAC</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordtype">int</span> i;</div>
<div class="line">  <span class="keywordtype">char</span> *sp;</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;PQntuples( pgr); i++) {</div>
<div class="line">    sp = PQgetvalue( pgr, i, 0);</div>
<div class="line">    <span class="keywordflow">if</span>( sp != NULL &amp;&amp; *sp != 0) {</div>
<div class="line">      <a class="code" href="lspmac_8c.html#aaa442d9bc7a3cdee39adea0724f0e18c" title="Send a one line command.">lspmac_SockSendline</a>( sp);</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Keep asking for more until</span></div>
<div class="line">      <span class="comment">// there are no commands left</span></div>
<div class="line">      <span class="comment">// </span></div>
<div class="line">      <span class="comment">// This should solve a potential problem where</span></div>
<div class="line">      <span class="comment">// more than one command is put on the queue for a given notify.</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#a1e11f525ca0f9ac9ab71f9fbe983c42b" title="Send strings directly to PMAC queue.">lspg_cmd_cb</a>, <span class="stringliteral">&quot;select pmac.md2_queue_next()&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af6485ac1749c5de3008dd0e0badaa09c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_flush </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Flush psql output buffer (ie, send the query) </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00987">987</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                  {</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line"></div>
<div class="line">  err = PQflush( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">  <span class="keywordflow">switch</span>( err) {</div>
<div class="line">  <span class="keywordflow">case</span> -1:</div>
<div class="line">    <span class="comment">// an error occured</span></div>
<div class="line"></div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;flush failed: %s&quot;</span>, PQerrorMessage( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>));</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a>;</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// We should probably reset the connection and start from scratch.  Probably the connection died.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">          </div>
<div class="line">  <span class="keywordflow">case</span> 0:</div>
<div class="line">    <span class="comment">// goodness and joy.</span></div>
<div class="line">    <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#a373e668840b4795ff9a71bc3f744d209">LS_PG_STATE_RECV</a>;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> 1:</div>
<div class="line">    <span class="comment">// more sending to do</span></div>
<div class="line">    <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#a88a7e80c12fb0449c4b0857a0c7deb21">LS_PG_STATE_SEND_FLUSH</a>;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a523b492d9cd4970853eabee2d3c31578"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_getcenter_all </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convenience function to complete synchronous getcenter query. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00921">921</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  <a class="code" href="lspg_8c.html#a6f7cd0a06f6a266ef65b3604cf33d6c4" title="Request a getcenter query.">lspg_getcenter_call</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a3e0e4b3cb9fa03961ee0c104e0b06754" title="Wait for a getcenter query to return.">lspg_getcenter_wait</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a7c678553b44c874d08ec9966ed7bb1c0" title="Done with getcenter query.">lspg_getcenter_done</a>();</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6f7cd0a06f6a266ef65b3604cf33d6c4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_getcenter_call </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Request a getcenter query. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00897">897</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                           {</div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a214bb7e88b137162f13f41f2c43002a9" title="don&#39;t let the threads collide!">mutex</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a4b350f11f1e375b9e9e839caaffbcb6b" title="used with condition">new_value_ready</a> = 0;</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a214bb7e88b137162f13f41f2c43002a9" title="don&#39;t let the threads collide!">mutex</a>);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#a8184824f2b71b1d35141d7922ca69cd7" title="Retrieve the data to center the crystal.">lspg_getcenter_cb</a>, <span class="stringliteral">&quot;SELECT * FROM px.getcenter2()&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8184824f2b71b1d35141d7922ca69cd7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_getcenter_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieve the data to center the crystal. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00832">832</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                                                {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">    zoom_c, dcx_c, dcy_c, dax_c, day_c, daz_c;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a214bb7e88b137162f13f41f2c43002a9" title="don&#39;t let the threads collide!">mutex</a>));</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#aaeb0ccf4289b4fb306c2bc04ae85b237" title="flag in case no centering information was forthcoming">no_rows_returned</a> = PQntuples( pgr) &lt;= 0;</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#aaeb0ccf4289b4fb306c2bc04ae85b237" title="flag in case no centering information was forthcoming">no_rows_returned</a>) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// No particular reason this path should ever be taken</span></div>
<div class="line">    <span class="comment">// but if we don&#39;t get rows then we had better not move anything.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a4b350f11f1e375b9e9e839caaffbcb6b" title="used with condition">new_value_ready</a> = 1;</div>
<div class="line">    pthread_cond_signal( &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#ae0db0ff2608ab5ba3e7c1b4ad3fc0e91" title="provides signaling for when the query is done">cond</a>));</div>
<div class="line">    pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a214bb7e88b137162f13f41f2c43002a9" title="don&#39;t let the threads collide!">mutex</a>));</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  zoom_c = PQfnumber( pgr, <span class="stringliteral">&quot;zoom&quot;</span>);</div>
<div class="line">  dcx_c  = PQfnumber( pgr, <span class="stringliteral">&quot;dcx&quot;</span>);</div>
<div class="line">  dcy_c  = PQfnumber( pgr, <span class="stringliteral">&quot;dcy&quot;</span>);</div>
<div class="line">  dax_c  = PQfnumber( pgr, <span class="stringliteral">&quot;dax&quot;</span>);</div>
<div class="line">  day_c  = PQfnumber( pgr, <span class="stringliteral">&quot;day&quot;</span>);</div>
<div class="line">  daz_c  = PQfnumber( pgr, <span class="stringliteral">&quot;daz&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a6ca85a8de29039188357b2814acd7803">zoom_isnull</a> = PQgetisnull( pgr, 0, zoom_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a6ca85a8de29039188357b2814acd7803">zoom_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a63e640a925611d2404a1529aea30a853" title="the next zoom level to go to before taking the next movie">zoom</a> = atoi( PQgetvalue( pgr, 0, zoom_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#aa404da85af654998f039c81a77626748">dcx_isnull</a> = PQgetisnull( pgr, 0, dcx_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#aa404da85af654998f039c81a77626748">dcx_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#ade0534056296e9ed568404c538be9227" title="center x change">dcx</a> = atof( PQgetvalue( pgr, 0, dcx_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a352c48c8d443c52f18ebd13019d01684">dcy_isnull</a> = PQgetisnull( pgr, 0, dcy_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a352c48c8d443c52f18ebd13019d01684">dcy_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a55b1a488b714e6a40d8e06a6e182bd0a" title="center y change">dcy</a> = atof( PQgetvalue( pgr, 0, dcy_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a621b489777d61e9db8b33b784b8d70f9">dax_isnull</a> = PQgetisnull( pgr, 0, dax_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a621b489777d61e9db8b33b784b8d70f9">dax_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a17db52848c28852a470222ec93ae8886" title="alignment x change">dax</a> = atof( PQgetvalue( pgr, 0, dax_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a36f57a319288810caf365cca7827ff96">day_isnull</a> = PQgetisnull( pgr, 0, day_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a36f57a319288810caf365cca7827ff96">day_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a9ce0f29540f2ff47be9788565d19f1b8" title="alignment y change">day</a> = atof( PQgetvalue( pgr, 0, day_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a36742b6bd0f4bf9356414930ba893617">daz_isnull</a> = PQgetisnull( pgr, 0, daz_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a36742b6bd0f4bf9356414930ba893617">daz_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a1170bab2161f03ab29c39f79519ed9ae" title="alignment z change">daz</a> = atof( PQgetvalue( pgr, 0, daz_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a4b350f11f1e375b9e9e839caaffbcb6b" title="used with condition">new_value_ready</a> = 1;</div>
<div class="line"></div>
<div class="line">  pthread_cond_signal( &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#ae0db0ff2608ab5ba3e7c1b4ad3fc0e91" title="provides signaling for when the query is done">cond</a>));</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a214bb7e88b137162f13f41f2c43002a9" title="don&#39;t let the threads collide!">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7c678553b44c874d08ec9966ed7bb1c0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_getcenter_done </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Done with getcenter query. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00915">915</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                           {</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a214bb7e88b137162f13f41f2c43002a9" title="don&#39;t let the threads collide!">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad31db17587a02302ac4e40fb7d260b1b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_getcenter_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize getcenter object. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00889">889</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                           {</div>
<div class="line">  memset( &amp;<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>, 0, <span class="keyword">sizeof</span>( <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>));</div>
<div class="line">  pthread_mutex_init( &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a214bb7e88b137162f13f41f2c43002a9" title="don&#39;t let the threads collide!">mutex</a>), NULL);</div>
<div class="line">  pthread_cond_init( &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#ae0db0ff2608ab5ba3e7c1b4ad3fc0e91" title="provides signaling for when the query is done">cond</a>), NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3e0e4b3cb9fa03961ee0c104e0b06754"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_getcenter_wait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for a getcenter query to return. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00907">907</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                           {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a214bb7e88b137162f13f41f2c43002a9" title="don&#39;t let the threads collide!">mutex</a>));</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a4b350f11f1e375b9e9e839caaffbcb6b" title="used with condition">new_value_ready</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#ae0db0ff2608ab5ba3e7c1b4ad3fc0e91" title="provides signaling for when the query is done">cond</a>), &amp;(<a class="code" href="lspg_8c.html#a7ef8a09203117578c9b2ce4719519f36" title="the getcenter object">lspg_getcenter</a>.<a class="code" href="structlspg__getcenter__struct.html#a214bb7e88b137162f13f41f2c43002a9" title="don&#39;t let the threads collide!">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8a77972df14166e05c94ed0792baa09b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initiallize the lspg module. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01471">1471</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                 {</div>
<div class="line">  pthread_mutex_init( &amp;<a class="code" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4" title="keep the queue from getting tangled">lspg_queue_mutex</a>, NULL);</div>
<div class="line">  pthread_cond_init( &amp;<a class="code" href="lspg_8c.html#a61a308b6a37afd645beb422653b95baa" title="keeps the queue from overflowing">lspg_queue_cond</a>, NULL);</div>
<div class="line">  <a class="code" href="lspg_8c.html#aff91db7d60e6c832684c023813e36dbf" title="Initialize the nextshot variable, mutex, and condition.">lspg_nextshot_init</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad31db17587a02302ac4e40fb7d260b1b" title="Initialize getcenter object.">lspg_getcenter_init</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a3517f8fbed91c998f6036284f9bd0c48" title="initialize the detector timing object">lspg_wait_for_detector_init</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a39bb94f8e0d47702b2b920a3dee61ebc" title="initialize the diffractometer locking object">lspg_lock_diffractometer_init</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a0e9bbf847dadfe0d10830d67824d9be8" title="Initialize detector lock object.">lspg_lock_detector_init</a>();</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aff93d2f5ac31aa249a0bef40a3837c84"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_detector_all </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Detector lock convinence function. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00744">744</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                              {</div>
<div class="line">  <a class="code" href="lspg_8c.html#a5f71a20cc297684b2afe28e7bd8e8383" title="Request (demand) a detector lock.">lspg_lock_detector_call</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad3d9c56bd3ca6bcc43db30872cc441cc" title="Wait for the detector lock.">lspg_lock_detector_wait</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a1b567040693ff6e2932a2477045d75fa" title="Finish waiting.">lspg_lock_detector_done</a>();</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5f71a20cc297684b2afe28e7bd8e8383"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_detector_call </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Request (demand) a detector lock. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00720">720</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                               {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#ab5ab5534b376a8fbafdd0b54cec4483c">mutex</a>));</div>
<div class="line">  <a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#a62373414b815fe178edd8522b3bd4d78">new_value_ready</a> = 0;</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#ab5ab5534b376a8fbafdd0b54cec4483c">mutex</a>));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#aa760191c2b443170cebbcbf5ea5345f3" title="Callback for when the detector lock has be grabbed.">lspg_lock_detector_cb</a>, <span class="stringliteral">&quot;SELECT px.lock_detector()&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa760191c2b443170cebbcbf5ea5345f3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_detector_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback for when the detector lock has be grabbed. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00711">711</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                                                    {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#ab5ab5534b376a8fbafdd0b54cec4483c">mutex</a>));</div>
<div class="line">  <a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#a62373414b815fe178edd8522b3bd4d78">new_value_ready</a> = 1;</div>
<div class="line">  pthread_cond_signal( &amp;(<a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#adc90c859665dccc8717219e824cba0b8">cond</a>));</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#ab5ab5534b376a8fbafdd0b54cec4483c">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1b567040693ff6e2932a2477045d75fa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_detector_done </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Finish waiting. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00738">738</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                               {</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#ab5ab5534b376a8fbafdd0b54cec4483c">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0e9bbf847dadfe0d10830d67824d9be8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_detector_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize detector lock object. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00703">703</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                               {</div>
<div class="line">  <a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#a62373414b815fe178edd8522b3bd4d78">new_value_ready</a> = 0;</div>
<div class="line">  pthread_mutex_init( &amp;(<a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#ab5ab5534b376a8fbafdd0b54cec4483c">mutex</a>), NULL);</div>
<div class="line">  pthread_cond_init(  &amp;(<a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#adc90c859665dccc8717219e824cba0b8">cond</a>),  NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad3d9c56bd3ca6bcc43db30872cc441cc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_detector_wait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for the detector lock. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00730">730</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                               {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#ab5ab5534b376a8fbafdd0b54cec4483c">mutex</a>));</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#a62373414b815fe178edd8522b3bd4d78">new_value_ready</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;(<a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#adc90c859665dccc8717219e824cba0b8">cond</a>), &amp;(<a class="code" href="lspg_8c.html#adbf3b3652c6531c3d194320d1abc1c80">lspg_lock_detector</a>.<a class="code" href="structlspg__lock__detector__struct.html#ab5ab5534b376a8fbafdd0b54cec4483c">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a88b33e75c42197740b157a51ea726f21"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_diffractometer_all </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convience function that combines lock diffractometer calls. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00685">685</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                    {</div>
<div class="line">  <a class="code" href="lspg_8c.html#ac5ebeb38e8e9926a52f024fe76201175" title="Request that the database grab the diffractometer lock.">lspg_lock_diffractometer_call</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a8445e1dec753f2c517b87fcb9c5b5943" title="Wait for the diffractometer lock.">lspg_lock_diffractometer_wait</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a88b33e75c42197740b157a51ea726f21" title="Convience function that combines lock diffractometer calls.">lspg_lock_diffractometer_all</a>();</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac5ebeb38e8e9926a52f024fe76201175"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_diffractometer_call </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Request that the database grab the diffractometer lock. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00661">661</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                     {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a362e848dfd1551428b8d12d8776fd2ed">mutex</a>));</div>
<div class="line">  <a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#ae94acdf44008ce48930e3083f08f5b6c">new_value_ready</a> = 0;</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a362e848dfd1551428b8d12d8776fd2ed">mutex</a>));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#aad4f378f37c0030634dafa0d9445d916" title="Callback routine for a lock diffractometer query.">lspg_lock_diffractometer_cb</a>, <span class="stringliteral">&quot;SELECT px.lock_diffractomter()&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aad4f378f37c0030634dafa0d9445d916"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_diffractometer_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback routine for a lock diffractometer query. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00652">652</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                                                          {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a362e848dfd1551428b8d12d8776fd2ed">mutex</a>));</div>
<div class="line">  <a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#ae94acdf44008ce48930e3083f08f5b6c">new_value_ready</a> = 1;</div>
<div class="line">  pthread_cond_signal( &amp;(<a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a7614c802af37c1d3358479a2c13ac898">cond</a>));</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a362e848dfd1551428b8d12d8776fd2ed">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a75aaf0b3fe33530062226c69a33ce821"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_diffractometer_done </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Finish up the lock diffractometer call. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00679">679</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                     {</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a362e848dfd1551428b8d12d8776fd2ed">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a39bb94f8e0d47702b2b920a3dee61ebc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_diffractometer_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>initialize the diffractometer locking object </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00644">644</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                     {</div>
<div class="line">  <a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#ae94acdf44008ce48930e3083f08f5b6c">new_value_ready</a> = 0;</div>
<div class="line">  pthread_mutex_init( &amp;(<a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a362e848dfd1551428b8d12d8776fd2ed">mutex</a>), NULL);</div>
<div class="line">  pthread_cond_init(  &amp;(<a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a7614c802af37c1d3358479a2c13ac898">cond</a>), NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8445e1dec753f2c517b87fcb9c5b5943"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_lock_diffractometer_wait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for the diffractometer lock. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00671">671</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                     {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a362e848dfd1551428b8d12d8776fd2ed">mutex</a>));</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#ae94acdf44008ce48930e3083f08f5b6c">new_value_ready</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;(<a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a7614c802af37c1d3358479a2c13ac898">cond</a>), &amp;(<a class="code" href="lspg_8c.html#aaae7ce3ecd7d54a9e46c41d7a742a454">lspg_lock_diffractometer</a>.<a class="code" href="structlspg__lock__diffractometer__struct.html#a362e848dfd1551428b8d12d8776fd2ed">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab52a8c8245bf6561f40c0f224fc07ff4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_next_state </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Implements our state machine Does not strictly only set the next state as it also calls some functions that, perhaps, alters the state mid-function. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01340">1340</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                       {</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// connect to the database</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a> == NULL ||</div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a> ||</div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a> ||</div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#ae7ea5876846b5f04c419aee22d3c0aa1">LS_PG_STATE_INIT_POLL</a> ||</div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#ac70a1141f3b138055ea7143bd493187c">LS_PG_STATE_RESET_POLL</a>)</div>
<div class="line">    <a class="code" href="kvredis_8c.html#a581c18be0368425665a40b4b7f7d9714" title="Connect to the pg server.">lspg_pg_connect</a>( <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a> &amp;&amp; <a class="code" href="lspg_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6" title="Next position to add something to the queue.">lspg_query_queue_on</a> != <a class="code" href="lspg_8c.html#aca86bb77d6cecfae9251743f4171bafb" title="The last item still being used (on == off means nothing in queue)">lspg_query_queue_off</a>)</div>
<div class="line">    <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#a3c6eb19f262a990e1f9ba630d9edc309">LS_PG_STATE_SEND</a>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">switch</span>( <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a>) {</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspg_8c.html#ae7ea5876846b5f04c419aee22d3c0aa1">LS_PG_STATE_INIT_POLL</a>:</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> == PGRES_POLLING_WRITING)</div>
<div class="line">      <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = POLLOUT;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> == PGRES_POLLING_READING)</div>
<div class="line">      <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = POLLIN;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = 0;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">      </div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspg_8c.html#ac70a1141f3b138055ea7143bd493187c">LS_PG_STATE_RESET_POLL</a>:</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> == PGRES_POLLING_WRITING)</div>
<div class="line">      <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = POLLOUT;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> == PGRES_POLLING_READING)</div>
<div class="line">      <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = POLLIN;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = 0;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspg_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a>:</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspg_8c.html#a373e668840b4795ff9a71bc3f744d209">LS_PG_STATE_RECV</a>:</div>
<div class="line">    <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = POLLIN;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspg_8c.html#a3c6eb19f262a990e1f9ba630d9edc309">LS_PG_STATE_SEND</a>:</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspg_8c.html#a88a7e80c12fb0449c4b0857a0c7deb21">LS_PG_STATE_SEND_FLUSH</a>:</div>
<div class="line">    <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = POLLOUT;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">default</span>:</div>
<div class="line">    <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = 0;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aeda8dad89b03d7d61cc994dd63ee5db6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_nextaction_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Queue the next MD2 instruction. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">qqp</td><td>The query that generated this result </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pgr</td><td>The result </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00930">930</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  <span class="keywordtype">char</span> *action;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( PQntuples( pgr) &lt;= 0)</div>
<div class="line">    <span class="keywordflow">return</span>;             <span class="comment">// Note: nextaction should always return at least &quot;noAction&quot;, so this branch should never be taken</span></div>
<div class="line"></div>
<div class="line">  action = PQgetvalue( pgr, 0, 0);      <span class="comment">// next action only returns one row</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( strcmp( action, <span class="stringliteral">&quot;noAction&quot;</span>) == 0)</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">if</span>( pthread_mutex_trylock( &amp;<a class="code" href="md2cmds_8c.html#ad67304bb851dc6268b0cda2f40fc5aa8" title="mutex for the condition">md2cmds_mutex</a>) == 0) {</div>
<div class="line">    strncpy( <a class="code" href="md2cmds_8c.html#a5f0fe1e2dfa92cf345b8c29134ab1ede" title="our command;">md2cmds_cmd</a>, action, <a class="code" href="pgpmac_8h.html#a30f0f377b0f0695284145d420ea51846">MD2CMDS_CMD_LENGTH</a>-1);</div>
<div class="line">    <a class="code" href="md2cmds_8c.html#a5f0fe1e2dfa92cf345b8c29134ab1ede" title="our command;">md2cmds_cmd</a>[<a class="code" href="pgpmac_8h.html#a30f0f377b0f0695284145d420ea51846">MD2CMDS_CMD_LENGTH</a>-1] = 0;</div>
<div class="line">    pthread_cond_signal( &amp;<a class="code" href="md2cmds_8c.html#a08d5b18ec9478d753c46a3e28d1f2126" title="condition to signal when it&#39;s time to run an md2 command">md2cmds_cond</a>);</div>
<div class="line">    pthread_mutex_unlock( &amp;<a class="code" href="md2cmds_8c.html#ad67304bb851dc6268b0cda2f40fc5aa8" title="mutex for the condition">md2cmds_mutex</a>);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;MD2 command &#39;%s&#39; ignored.  Already running &#39;%s&#39;&quot;</span>, action, <a class="code" href="md2cmds_8c.html#a5f0fe1e2dfa92cf345b8c29134ab1ede" title="our command;">md2cmds_cmd</a>);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af17ef79544ca5d78fd477010fe90d538"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_nextshot_call </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Queue up a nextshot query. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00544">544</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a38b657155fbee9b73278f76912cf2333" title="Our mutex for sanity in the multi-threaded program.">mutex</a>));</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#adb8da14444b98f556dba9420dd4666dc" title="Our flag for the condition to wait for.">new_value_ready</a> = 0;</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a38b657155fbee9b73278f76912cf2333" title="Our mutex for sanity in the multi-threaded program.">mutex</a>));</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#a9e92a204f606761d368ac7e06ef0f09c" title="Next Shot Callback.">lspg_nextshot_cb</a>, <span class="stringliteral">&quot;SELECT * FROM px.nextshot()&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9e92a204f606761d368ac7e06ef0f09c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_nextshot_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Next Shot Callback. </p>
<p>This is a long and tedious routine as there are a large number of variables returned. Suck it up. Return with the global variable lspg_nextshot set. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">qqp</td><td>Our nextshot query </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pgr</td><td>result of the query </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00289">289</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                        {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> got_col_nums=0;</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">    dsdir_c, dspid_c, dsowidth_c, dsoscaxis_c, dsexp_c, skey_c, sstart_c, sfn_c, dsphi_c,</div>
<div class="line">    dsomega_c, dskappa_c, dsdist_c, dsnrg_c, dshpid_c, cx_c, cy_c, ax_c, ay_c, az_c,</div>
<div class="line">    active_c, sindex_c, stype_c,</div>
<div class="line">    dsowidth2_c, dsoscaxis2_c, dsexp2_c, sstart2_c, dsphi2_c, dsomega2_c, dskappa2_c, dsdist2_c, dsnrg2_c,</div>
<div class="line">    cx2_c, cy2_c, ax2_c, ay2_c, az2_c, active2_c, sindex2_c, stype2_c;</div>
<div class="line">  </div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a38b657155fbee9b73278f76912cf2333" title="Our mutex for sanity in the multi-threaded program.">mutex</a>));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#abc9242805729f70b83df79706c394c71" title="flag indicating that no rows were returned.">no_rows_returned</a> = PQntuples( pgr) &lt;= 0;</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#abc9242805729f70b83df79706c394c71" title="flag indicating that no rows were returned.">no_rows_returned</a>) {</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#adb8da14444b98f556dba9420dd4666dc" title="Our flag for the condition to wait for.">new_value_ready</a> = 1;</div>
<div class="line">    pthread_cond_signal( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#afc773a9eefc173aa98d5c2889e1d7669" title="Condition to wait for a response from our postgresql server.">cond</a>));</div>
<div class="line">    pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a38b657155fbee9b73278f76912cf2333" title="Our mutex for sanity in the multi-threaded program.">mutex</a>));</div>
<div class="line">    <span class="keywordflow">return</span>;                     <span class="comment">// I guess there was no shot after all</span></div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( got_col_nums == 0) {</div>
<div class="line">    dsdir_c      = PQfnumber( pgr, <span class="stringliteral">&quot;dsdir&quot;</span>);</div>
<div class="line">    dspid_c      = PQfnumber( pgr, <span class="stringliteral">&quot;dspid&quot;</span>);</div>
<div class="line">    dsowidth_c   = PQfnumber( pgr, <span class="stringliteral">&quot;dsowidth&quot;</span>);</div>
<div class="line">    dsoscaxis_c  = PQfnumber( pgr, <span class="stringliteral">&quot;dsoscaxis&quot;</span>);</div>
<div class="line">    dsexp_c      = PQfnumber( pgr, <span class="stringliteral">&quot;dsexp&quot;</span>);</div>
<div class="line">    skey_c       = PQfnumber( pgr, <span class="stringliteral">&quot;skey&quot;</span>);</div>
<div class="line">    sstart_c     = PQfnumber( pgr, <span class="stringliteral">&quot;sstart&quot;</span>);</div>
<div class="line">    sfn_c        = PQfnumber( pgr, <span class="stringliteral">&quot;sfn&quot;</span>);</div>
<div class="line">    dsphi_c      = PQfnumber( pgr, <span class="stringliteral">&quot;dsphi&quot;</span>);</div>
<div class="line">    dsomega_c    = PQfnumber( pgr, <span class="stringliteral">&quot;dsomega&quot;</span>);</div>
<div class="line">    dskappa_c    = PQfnumber( pgr, <span class="stringliteral">&quot;dskappa&quot;</span>);</div>
<div class="line">    dsdist_c     = PQfnumber( pgr, <span class="stringliteral">&quot;dsdist&quot;</span>);</div>
<div class="line">    dsnrg_c      = PQfnumber( pgr, <span class="stringliteral">&quot;dsnrg&quot;</span>);</div>
<div class="line">    dshpid_c     = PQfnumber( pgr, <span class="stringliteral">&quot;dshpid&quot;</span>);</div>
<div class="line">    cx_c         = PQfnumber( pgr, <span class="stringliteral">&quot;cx&quot;</span>);</div>
<div class="line">    cy_c         = PQfnumber( pgr, <span class="stringliteral">&quot;cy&quot;</span>);</div>
<div class="line">    ax_c         = PQfnumber( pgr, <span class="stringliteral">&quot;ax&quot;</span>);</div>
<div class="line">    ay_c         = PQfnumber( pgr, <span class="stringliteral">&quot;ay&quot;</span>);</div>
<div class="line">    az_c         = PQfnumber( pgr, <span class="stringliteral">&quot;az&quot;</span>);</div>
<div class="line">    active_c     = PQfnumber( pgr, <span class="stringliteral">&quot;active&quot;</span>);</div>
<div class="line">    sindex_c     = PQfnumber( pgr, <span class="stringliteral">&quot;sindex&quot;</span>);</div>
<div class="line">    stype_c      = PQfnumber( pgr, <span class="stringliteral">&quot;stype&quot;</span>);</div>
<div class="line">    dsowidth2_c  = PQfnumber( pgr, <span class="stringliteral">&quot;dsowidth2&quot;</span>);</div>
<div class="line">    dsoscaxis2_c = PQfnumber( pgr, <span class="stringliteral">&quot;dsoscaxis2&quot;</span>);</div>
<div class="line">    dsexp2_c     = PQfnumber( pgr, <span class="stringliteral">&quot;dsexp2&quot;</span>);</div>
<div class="line">    sstart2_c    = PQfnumber( pgr, <span class="stringliteral">&quot;sstart2&quot;</span>);</div>
<div class="line">    dsphi2_c     = PQfnumber( pgr, <span class="stringliteral">&quot;dsphi2&quot;</span>);</div>
<div class="line">    dsomega2_c   = PQfnumber( pgr, <span class="stringliteral">&quot;dsomega2&quot;</span>);</div>
<div class="line">    dskappa2_c   = PQfnumber( pgr, <span class="stringliteral">&quot;dskappa2&quot;</span>);</div>
<div class="line">    dsdist2_c    = PQfnumber( pgr, <span class="stringliteral">&quot;dsdist2&quot;</span>);</div>
<div class="line">    dsnrg2_c     = PQfnumber( pgr, <span class="stringliteral">&quot;dsnrg2&quot;</span>);</div>
<div class="line">    cx2_c        = PQfnumber( pgr, <span class="stringliteral">&quot;cx2&quot;</span>);</div>
<div class="line">    cy2_c        = PQfnumber( pgr, <span class="stringliteral">&quot;cy2&quot;</span>);</div>
<div class="line">    ax2_c        = PQfnumber( pgr, <span class="stringliteral">&quot;ax2&quot;</span>);</div>
<div class="line">    ay2_c        = PQfnumber( pgr, <span class="stringliteral">&quot;ay2&quot;</span>);</div>
<div class="line">    az2_c        = PQfnumber( pgr, <span class="stringliteral">&quot;az2&quot;</span>);</div>
<div class="line">    active2_c    = PQfnumber( pgr, <span class="stringliteral">&quot;active2&quot;</span>);</div>
<div class="line">    sindex2_c    = PQfnumber( pgr, <span class="stringliteral">&quot;sindex2&quot;</span>);</div>
<div class="line">    stype2_c     = PQfnumber( pgr, <span class="stringliteral">&quot;stype2&quot;</span>);</div>
<div class="line">    </div>
<div class="line">    got_col_nums = 1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// NULL string values come back as empty strings</span></div>
<div class="line">  <span class="comment">// Mark the null flag but allocate the empty string anyway</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a8dea57b78b92d67d83ccbb6ed6da13ca">dsdir_isnull</a> = PQgetisnull( pgr, 0, dsdir_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ac372e1774a25b3d4bfbb9169762eb39e" title="Directory for data relative to the ESAF home directory.">dsdir</a> != NULL)</div>
<div class="line">    free( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ac372e1774a25b3d4bfbb9169762eb39e" title="Directory for data relative to the ESAF home directory.">dsdir</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ac372e1774a25b3d4bfbb9169762eb39e" title="Directory for data relative to the ESAF home directory.">dsdir</a> = strdup( PQgetvalue( pgr, 0, dsdir_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a7665485395487756ab448d0c81c84d10">dspid_isnull</a> = PQgetisnull( pgr, 0, dspid_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a4487e718c2b55a8ab9ebb18329574ae1" title="ID string identifying this dataset.">dspid</a> != NULL)</div>
<div class="line">    free( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a4487e718c2b55a8ab9ebb18329574ae1" title="ID string identifying this dataset.">dspid</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a4487e718c2b55a8ab9ebb18329574ae1" title="ID string identifying this dataset.">dspid</a> = strdup( PQgetvalue( pgr, 0, dspid_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a51a26391afcacfb4c946fb9e8e9ab6b0">dsoscaxis_isnull</a> = PQgetisnull( pgr, 0, dsoscaxis_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a9a62c304e66013e8e5e5618a44f0b6d4" title="dataset defined oscillation axis (always omega)">dsoscaxis</a> != NULL)</div>
<div class="line">    free( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a9a62c304e66013e8e5e5618a44f0b6d4" title="dataset defined oscillation axis (always omega)">dsoscaxis</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a9a62c304e66013e8e5e5618a44f0b6d4" title="dataset defined oscillation axis (always omega)">dsoscaxis</a> = strdup( PQgetvalue( pgr, 0, dsoscaxis_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a98e280e99ae847559bb82836df3c32d1">dsoscaxis2_isnull</a> = PQgetisnull( pgr, 0, dsoscaxis2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ac86005a6e90ff502da9e95b59d0b7a5f" title="next image ascillation axis (always &quot;omega&quot;)">dsoscaxis2</a> != NULL)</div>
<div class="line">    free( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ac86005a6e90ff502da9e95b59d0b7a5f" title="next image ascillation axis (always &quot;omega&quot;)">dsoscaxis2</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ac86005a6e90ff502da9e95b59d0b7a5f" title="next image ascillation axis (always &quot;omega&quot;)">dsoscaxis2</a> = strdup( PQgetvalue( pgr, 0, dsoscaxis2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a56f32eb413b1fca9f085874eb86294de">sfn_isnull</a> = PQgetisnull(pgr, 0, sfn_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a03252bba597b081edc9d08b20b558cc7" title="file name">sfn</a> != NULL)</div>
<div class="line">    free( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a03252bba597b081edc9d08b20b558cc7" title="file name">sfn</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a03252bba597b081edc9d08b20b558cc7" title="file name">sfn</a> = strdup( PQgetvalue( pgr, 0, sfn_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a79f48c452a4aca8506bae22f897c7441">stype_isnull</a> = PQgetisnull( pgr, 0, stype_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ab5a70b189c2fe516ca0c84bd06f3e564" title="&quot;Normal&quot; or &quot;Gridsearch&quot;">stype</a> != NULL)</div>
<div class="line">    free( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ab5a70b189c2fe516ca0c84bd06f3e564" title="&quot;Normal&quot; or &quot;Gridsearch&quot;">stype</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ab5a70b189c2fe516ca0c84bd06f3e564" title="&quot;Normal&quot; or &quot;Gridsearch&quot;">stype</a> = strdup( PQgetvalue( pgr, 0, stype_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a203e29ed0bb403aaab6d7f95f690cc0d">stype2_isnull</a> = PQgetisnull( pgr, 0, stype2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ae08ef74ea76e6e099a3ff6c7f845d337" title="next image type (&quot;Normal&quot; or &quot;Gridsearch&quot;)">stype2</a> != NULL)</div>
<div class="line">    free( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ae08ef74ea76e6e099a3ff6c7f845d337" title="next image type (&quot;Normal&quot; or &quot;Gridsearch&quot;)">stype2</a>);</div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ae08ef74ea76e6e099a3ff6c7f845d337" title="next image type (&quot;Normal&quot; or &quot;Gridsearch&quot;)">stype2</a> = strdup( PQgetvalue( pgr, 0, stype2_c));</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Probably shouldn&#39;t try to convert null number values</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a5dd3db64790e09bc03499e521bbaa126">dsowidth_isnull</a> = PQgetisnull( pgr, 0, dsowidth_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a5dd3db64790e09bc03499e521bbaa126">dsowidth_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ad5a8f568a04aa6a13767933062b28f19" title="dataset defined oscillation width">dsowidth</a> = atof( PQgetvalue( pgr,0, dsowidth_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ae07498f62ea9c0e2f702b78c87500794">dsexp_isnull</a> = PQgetisnull( pgr, 0, dsexp_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ae07498f62ea9c0e2f702b78c87500794">dsexp_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a063e4c99201a763c2eb048acfc855efa" title="dataset defined exposure time">dsexp</a>    = atof( PQgetvalue( pgr,0, dsexp_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#aa53094de91e2f69d7174ab119df1cdac">sstart_isnull</a> = PQgetisnull( pgr, 0, sstart_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#aa53094de91e2f69d7174ab119df1cdac">sstart_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a8dc11eaa094d59f61642c4abc226918f" title="starting angle">sstart</a>   = atof( PQgetvalue( pgr,0, sstart_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a2d1f51cb1bb575a214344773136be878">dsphi_isnull</a> = PQgetisnull( pgr, 0, dsphi_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a2d1f51cb1bb575a214344773136be878">dsphi_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a64ebde597ca97a3b98145dc2d580c64f" title="dataset defined starting phi angle">dsphi</a>    = atof( PQgetvalue( pgr,0, dsphi_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ad1da3548dc642d415aed53dc165c44fc">dsomega_isnull</a> = PQgetisnull( pgr, 0, dsomega_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ad1da3548dc642d415aed53dc165c44fc">dsomega_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a4be525bb32fb0232c21a91529f1e8c73" title="dataset defined starting omega angle">dsomega</a>  = atof( PQgetvalue( pgr,0, dsomega_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a1686a72509cc1c3383ee95a790ddff14">dskappa_isnull</a> = PQgetisnull( pgr, 0, dskappa_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a1686a72509cc1c3383ee95a790ddff14">dskappa_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a59355281e8eb935cd7bfac597fdc5289" title="dataset defined starting kappa angle">dskappa</a>  = atof( PQgetvalue( pgr,0, dskappa_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ac6f2bdc7b023d933509bf74af7b169f9">dsdist_isnull</a> = PQgetisnull( pgr, 0, dsdist_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ac6f2bdc7b023d933509bf74af7b169f9">dsdist_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#acab9431a911f5bb11296cbfb271fb83a" title="dataset defined detector distance">dsdist</a>   = atof( PQgetvalue( pgr,0, dsdist_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ad14d8bb50290ec12e58f4aaec5cc5aab">dsnrg_isnull</a> = PQgetisnull( pgr, 0, dsnrg_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ad14d8bb50290ec12e58f4aaec5cc5aab">dsnrg_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a371e574055fec7660b8f2e637eaf9f25" title="dataset defined energy">dsnrg</a>    = atof( PQgetvalue( pgr,0, dsnrg_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a779b99533f0ed4e659177afb0b791ad2">cx_isnull</a> = PQgetisnull( pgr, 0, cx_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a779b99533f0ed4e659177afb0b791ad2">cx_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ad9eb2013fa6f295f72f0891fe98c863f" title="centering table x position">cx</a>       = atof( PQgetvalue( pgr,0, cx_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a3895d645420848aed05b95694ec8c6c7">cy_isnull</a> = PQgetisnull( pgr, 0, cy_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a3895d645420848aed05b95694ec8c6c7">cy_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ab7a7b37a17f06c4e9ebdcdf056946098" title="centering table y position">cy</a>       = atof( PQgetvalue( pgr,0, cy_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#aae46c7911b2b218497ad4a68f3dbb7d9">ax_isnull</a> = PQgetisnull( pgr, 0, ax_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#aae46c7911b2b218497ad4a68f3dbb7d9">ax_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a7f57874223897ab7d9c7531a9522904d" title="alignment table x position">ax</a>       = atof( PQgetvalue( pgr,0, ax_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a9da91abc8090532ed98ccd47a3bab775">ay_isnull</a> = PQgetisnull( pgr, 0, ay_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a9da91abc8090532ed98ccd47a3bab775">ay_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a9e20b9a0aeb41f7f7d653a1c60335bf1" title="alignment table y position">ay</a>       = atof( PQgetvalue( pgr,0, ay_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#aaebd6d432810313294b5fed5f4445cb1">az_isnull</a> = PQgetisnull( pgr, 0, az_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#aaebd6d432810313294b5fed5f4445cb1">az_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a66e678866ce79f6398b66d033ae45a17" title="alignment table z position">az</a>       = atof( PQgetvalue( pgr,0, az_c));</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a9f777671ec617a0f533b3c51f28babb3">active_isnull</a> = PQgetisnull( pgr, 0, active_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a9f777671ec617a0f533b3c51f28babb3">active_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a1a94eefbad713976a3d9213695a6ca28" title="flag: 1=move to indicated center position, 0=don&#39;t move center or alignment tables">active</a> = atoi( PQgetvalue( pgr, 0, active_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a7ca4fbc86974d1b75a681ba5ecaaf5af">sindex_isnull</a> = PQgetisnull( pgr, 0, sindex_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a7ca4fbc86974d1b75a681ba5ecaaf5af">sindex_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a5d096f2c2bf9be29c44129b54eaf01da" title="index of frame (used to generate the file extension)">sindex</a> = atoi( PQgetvalue( pgr, 0, sindex_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#afe16be0382423aa3f25cb3d6cf99430b">dshpid_isnull</a> = PQgetisnull( pgr, 0, dshpid_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#afe16be0382423aa3f25cb3d6cf99430b">dshpid_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a5e260a420176f2973cdb100d0a5c4c09" title="sample holder ID">dshpid</a> = atoi( PQgetvalue( pgr, 0, dshpid_c));</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#abd3c69357470052eb79ddd8eddd57b2c">skey_isnull</a> = PQgetisnull( pgr, 0, skey_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#abd3c69357470052eb79ddd8eddd57b2c">skey_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#af64a4e3f17752b5f1f05fb15d6f48382" title="key identifying a particulary image">skey</a>   = atoll( PQgetvalue( pgr, 0, skey_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a5ffd27b8063506fd54162658e5c2ce8a">dsowidth2_isnull</a> = PQgetisnull( pgr, 0, dsowidth2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a5ffd27b8063506fd54162658e5c2ce8a">dsowidth2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a5378e13735a5392a9fcd853ce8c9e929" title="next image oscillation width">dsowidth2</a> = atof( PQgetvalue( pgr,0, dsowidth2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a45091283dc073e5b7da2cfbe5a75fade">dsexp2_isnull</a> = PQgetisnull( pgr, 0, dsexp2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a45091283dc073e5b7da2cfbe5a75fade">dsexp2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a4d8c34309572875352ddabe9cc9001ee" title="next image exposure time">dsexp2</a>    = atof( PQgetvalue( pgr,0, dsexp2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a240c8532d5ce48dbc872d5123a4e721c">sstart2_isnull</a> = PQgetisnull( pgr, 0, sstart2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a240c8532d5ce48dbc872d5123a4e721c">sstart2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a8445cbd2206dc6d62b6bd433f5218c98" title="next image start angle">sstart2</a>   = atof( PQgetvalue( pgr,0, sstart2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a57a9c43be86188f65b96d59c2adec674">dsphi2_isnull</a> = PQgetisnull( pgr, 0, dsphi2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a57a9c43be86188f65b96d59c2adec674">dsphi2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a98857616b6bbb6ba861e96b6b7551756" title="next image phi position">dsphi2</a>    = atof( PQgetvalue( pgr,0, dsphi2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#afaf9bdf89a68e7f479969072643e55eb">dsomega2_isnull</a> = PQgetisnull( pgr, 0, dsomega2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#afaf9bdf89a68e7f479969072643e55eb">dsomega2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a84ae35abfa725d1bdbff5403f6384ee4" title="next image omega position">dsomega2</a>  = atof( PQgetvalue( pgr,0, dsomega2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a9a7e47372f4f6e0e48a0cb3c78fa8437">dskappa2_isnull</a> = PQgetisnull( pgr, 0, dskappa2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a9a7e47372f4f6e0e48a0cb3c78fa8437">dskappa2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a8571a0b95fb6ea6356fd7204b9c9e371" title="next image kappa position">dskappa2</a>  = atof( PQgetvalue( pgr,0, dskappa2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a7fce65f4719a4a8110006f8b72eec3f7">dsdist2_isnull</a> = PQgetisnull( pgr, 0, dsdist2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a7fce65f4719a4a8110006f8b72eec3f7">dsdist2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a516827749068577217b27860a01e6041" title="next image distance">dsdist2</a>   = atof( PQgetvalue( pgr,0, dsdist2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#aee9f8196dd9bcea832a60f2f0ea3a999">dsnrg2_isnull</a> = PQgetisnull( pgr, 0, dsnrg2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#aee9f8196dd9bcea832a60f2f0ea3a999">dsnrg2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ae461439c2af31255227765c0fb61850f" title="next image energy">dsnrg2</a>    = atof( PQgetvalue( pgr,0, dsnrg2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a3ad947f4efe2cb5c338244b019334749">cx2_isnull</a> = PQgetisnull( pgr, 0, cx2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a3ad947f4efe2cb5c338244b019334749">cx2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a10d45763100bc59f9a5f68f1b48db6d3" title="next image centering table x position">cx2</a>       = atof( PQgetvalue( pgr,0, cx2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a57d78a389413827302df6ebe3dcb3c89">cy2_isnull</a> = PQgetisnull( pgr, 0, cy2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a57d78a389413827302df6ebe3dcb3c89">cy2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a3644e5c3f12af18a3b426d4d4d7e16a5" title="next image centering table y position">cy2</a>       = atof( PQgetvalue( pgr,0, cy2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a846845b0b9ecf6517ef85554771ec71d">ax2_isnull</a> = PQgetisnull( pgr, 0, ax2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a846845b0b9ecf6517ef85554771ec71d">ax2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ab76bd38d2a098bc7eda82aff5dcb9c66" title="next image alignment x position">ax2</a>       = atof( PQgetvalue( pgr,0, ax2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ad0f50ec6339296d3d39c8d95131ab6b5">ay2_isnull</a> = PQgetisnull( pgr, 0, ay2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ad0f50ec6339296d3d39c8d95131ab6b5">ay2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ad13759740204b42e379161f98815f3d0" title="next image alignment y position">ay2</a>       = atof( PQgetvalue( pgr,0, ay2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a95d080f13a4e02b9aa883821ee3e721c">az2_isnull</a> = PQgetisnull( pgr, 0, az2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a95d080f13a4e02b9aa883821ee3e721c">az2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a94698a030fd5b2abf1f10a2ad33476a4" title="next image alignment z position">az2</a>       = atof( PQgetvalue( pgr,0, az2_c));</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a1aa11ff4a4c8d69695786b4349e84e6b">active2_isnull</a> = PQgetisnull( pgr, 0, active2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a1aa11ff4a4c8d69695786b4349e84e6b">active2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a2875aa18df587806a3d8c05220fd62b5" title="flag: 1 if next image should use the above centering parameters">active2</a> = atoi( PQgetvalue( pgr, 0, active2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a28e0b5c32a2741ef22edeb9d35b04e4d">sindex2_isnull</a> = PQgetisnull( pgr, 0, sindex2_c);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a28e0b5c32a2741ef22edeb9d35b04e4d">sindex2_isnull</a> == 0)</div>
<div class="line">    <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#ae9d0cfdff6868e0ba9cd5acafbe133db" title="next image index number">sindex2</a> = atoi( PQgetvalue( pgr, 0, sindex2_c));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#adb8da14444b98f556dba9420dd4666dc" title="Our flag for the condition to wait for.">new_value_ready</a> = 1;</div>
<div class="line"></div>
<div class="line">  pthread_cond_signal( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#afc773a9eefc173aa98d5c2889e1d7669" title="Condition to wait for a response from our postgresql server.">cond</a>));</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a38b657155fbee9b73278f76912cf2333" title="Our mutex for sanity in the multi-threaded program.">mutex</a>));</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a50458a014041a4118452802dfb303960"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_nextshot_done </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Called when the next shot query has been processed. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00562">562</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a38b657155fbee9b73278f76912cf2333" title="Our mutex for sanity in the multi-threaded program.">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aff91db7d60e6c832684c023813e36dbf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_nextshot_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the nextshot variable, mutex, and condition. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00536">536</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  memset( &amp;<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>, 0, <span class="keyword">sizeof</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>));</div>
<div class="line">  pthread_mutex_init( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a38b657155fbee9b73278f76912cf2333" title="Our mutex for sanity in the multi-threaded program.">mutex</a>), NULL);</div>
<div class="line">  pthread_cond_init( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#afc773a9eefc173aa98d5c2889e1d7669" title="Condition to wait for a response from our postgresql server.">cond</a>), NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a784a6de32a86fec9efb3ef3ae4b6e3ac"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_nextshot_wait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for the next shot query to get processed. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00554">554</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a38b657155fbee9b73278f76912cf2333" title="Our mutex for sanity in the multi-threaded program.">mutex</a>));</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#adb8da14444b98f556dba9420dd4666dc" title="Our flag for the condition to wait for.">new_value_ready</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#afc773a9eefc173aa98d5c2889e1d7669" title="Condition to wait for a response from our postgresql server.">cond</a>), &amp;(<a class="code" href="lspg_8c.html#ad8d8e2f578ca79189a80c1fd5b60cefd" title="the nextshot object">lspg_nextshot</a>.<a class="code" href="structlspg__nextshot__struct.html#a38b657155fbee9b73278f76912cf2333" title="Our mutex for sanity in the multi-threaded program.">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a62b110949d206fb22789191207e1d066"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PQnoticeProcessor lspg_notice_processor </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01242">1242</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                                                     {</div>
<div class="line">  <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;lspg: %s&quot;</span>, msg);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a581c18be0368425665a40b4b7f7d9714"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_pg_connect </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Connect to the pg server. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01248">1248</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                       {</div>
<div class="line">  PGresult *pgr;</div>
<div class="line">  <span class="keywordtype">int</span> wait_interval = 1;</div>
<div class="line">  <span class="keywordtype">int</span> connection_init = 0;</div>
<div class="line">  <span class="keywordtype">int</span> i, err;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a> == NULL)</div>
<div class="line">    <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">switch</span>( <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a>) {</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspg_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a>:</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( lspg_time_sent.tv_sec != 0) {</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Reality check: if it&#39;s less the about 10 seconds since the last failed attempt</span></div>
<div class="line">      <span class="comment">// the just chill.</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      gettimeofday( &amp;<a class="code" href="lspg_8c.html#ad40ac52086f6b774928af45b09d54c6e" title="used to ensure we do not inundate the db server with connection requests">now</a>, NULL);</div>
<div class="line">      <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#ad40ac52086f6b774928af45b09d54c6e" title="used to ensure we do not inundate the db server with connection requests">now</a>.tv_sec - lspg_time_sent.tv_sec &lt; 10) {</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a> = PQconnectStart( <span class="stringliteral">&quot;dbname=ls user=lsuser hostaddr=10.1.0.3&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a> == NULL) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Out of memory (lspg_pg_connect)&quot;</span>);</div>
<div class="line">      exit( -1);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    err = PQstatus( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( err == CONNECTION_BAD) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Trouble connecting to database&quot;</span>);</div>
<div class="line"></div>
<div class="line">      gettimeofday( &amp;lspg_time_sent, NULL);</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    err = PQsetnonblocking( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>, 1);</div>
<div class="line">    <span class="keywordflow">if</span>( err != 0) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Odd, could not set database connection to nonblocking&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#ae7ea5876846b5f04c419aee22d3c0aa1">LS_PG_STATE_INIT_POLL</a>;</div>
<div class="line">    <a class="code" href="lspg_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> = PGRES_POLLING_WRITING;</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// set up the connection for poll</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.fd = PQsocket( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspg_8c.html#ae7ea5876846b5f04c419aee22d3c0aa1">LS_PG_STATE_INIT_POLL</a>:</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> == PGRES_POLLING_FAILED) {</div>
<div class="line">      PQfinish( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">      <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a> = NULL;</div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a>;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> == PGRES_POLLING_OK) {</div>
<div class="line">      PQsetNoticeProcessor( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>, (PQnoticeProcessor)<a class="code" href="kvredis_8c.html#a62b110949d206fb22789191207e1d066">lspg_notice_processor</a>, NULL);</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( NULL, <span class="stringliteral">&quot;select pmac.md2_init()&quot;</span>);</div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspg_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>:</div>
<div class="line">    err = PQresetStart( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( err == 0) {</div>
<div class="line">      PQfinish( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">      <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a> = NULL;</div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a>;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#ac70a1141f3b138055ea7143bd493187c">LS_PG_STATE_RESET_POLL</a>;</div>
<div class="line">      <a class="code" href="lspg_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> = PGRES_POLLING_WRITING;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="lspg_8c.html#ac70a1141f3b138055ea7143bd493187c">LS_PG_STATE_RESET_POLL</a>:</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> == PGRES_POLLING_FAILED) {</div>
<div class="line">      PQfinish( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">      <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a> = NULL;</div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a>;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> == PGRES_POLLING_OK) {</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( NULL, <span class="stringliteral">&quot;select pmac.md2_init()&quot;</span>);</div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa8d1fed4b461c2139a21826d524777d5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_pg_service </td>
          <td>(</td>
          <td class="paramtype">struct pollfd *&#160;</td>
          <td class="paramname"><em>evt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>I/O control to/from the postgresql server. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">evt</td><td>The pollfd object that we are responding to </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01147">1147</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                       {</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Currently just used to check for notifies</span></div>
<div class="line">  <span class="comment">// Other socket communication is done syncronously</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( evt-&gt;revents &amp; POLLIN) {</div>
<div class="line">    <span class="keywordtype">int</span> err;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#ae7ea5876846b5f04c419aee22d3c0aa1">LS_PG_STATE_INIT_POLL</a>) {</div>
<div class="line">      <a class="code" href="lspg_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> = PQconnectPoll( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">      <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> == PGRES_POLLING_FAILED) {</div>
<div class="line">        <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#ac70a1141f3b138055ea7143bd493187c">LS_PG_STATE_RESET_POLL</a>) {</div>
<div class="line">      <a class="code" href="lspg_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> = PQresetPoll( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">      <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> == PGRES_POLLING_FAILED) {</div>
<div class="line">        <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// if in IDLE or RECV we need to call consumeInput first</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a>) {</div>
<div class="line">      err = PQconsumeInput( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">      <span class="keywordflow">if</span>( err != 1) {</div>
<div class="line">        <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;consume input failed: %s&quot;</span>, PQerrorMessage( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>));</div>
<div class="line">        <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>;</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">      }</div>
<div class="line">    }      </div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#a373e668840b4795ff9a71bc3f744d209">LS_PG_STATE_RECV</a>) {</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a038c5af23469b789fc1c55d21cb43029" title="Receive a result of a query.">lspg_receive</a>();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Check for notifies regardless of our state</span></div>
<div class="line">    <span class="comment">// Push as many requests as we have notifies.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    {</div>
<div class="line">      PGnotify *pgn;</div>
<div class="line"></div>
<div class="line">      <span class="keywordflow">while</span>( 1) {</div>
<div class="line">        pgn = PQnotifies( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">        <span class="keywordflow">if</span>( pgn == NULL)</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span>( strstr( pgn-&gt;relname, <span class="stringliteral">&quot;_pmac&quot;</span>) != NULL) {</div>
<div class="line">          <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#a1e11f525ca0f9ac9ab71f9fbe983c42b" title="Send strings directly to PMAC queue.">lspg_cmd_cb</a>, <span class="stringliteral">&quot;SELECT pmac.md2_queue_next()&quot;</span>);</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strstr( pgn-&gt;relname, <span class="stringliteral">&quot;_diff&quot;</span>) != NULL) {</div>
<div class="line">          <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#aeda8dad89b03d7d61cc994dd63ee5db6" title="Queue the next MD2 instruction.">lspg_nextaction_cb</a>, <span class="stringliteral">&quot;SELECT action FROM px.nextaction()&quot;</span>);</div>
<div class="line">        } </div>
<div class="line">        PQfreemem( pgn);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( evt-&gt;revents &amp; POLLOUT) {</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#ae7ea5876846b5f04c419aee22d3c0aa1">LS_PG_STATE_INIT_POLL</a>) {</div>
<div class="line">      <a class="code" href="lspg_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> = PQconnectPoll( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">      <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> == PGRES_POLLING_FAILED) {</div>
<div class="line">        <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#ac70a1141f3b138055ea7143bd493187c">LS_PG_STATE_RESET_POLL</a>) {</div>
<div class="line">      <a class="code" href="lspg_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> = PQresetPoll( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">      <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> == PGRES_POLLING_FAILED) {</div>
<div class="line">        <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#a3c6eb19f262a990e1f9ba630d9edc309">LS_PG_STATE_SEND</a>) {</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a714b15e117ffe7bfce4f2f2ce4725b0a" title="send the next queued query to the DB server">lspg_send_next_query</a>();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#a88a7e80c12fb0449c4b0857a0c7deb21">LS_PG_STATE_SEND_FLUSH</a>) {</div>
<div class="line">      <a class="code" href="kvredis_8c.html#af6485ac1749c5de3008dd0e0badaa09c" title="Flush psql output buffer (ie, send the query)">lspg_flush</a>();</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad5f3ec8f197cc330c83dba70f310533c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a>* lspg_query_next </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the next item in the postgresql queue. </p>
<p>If there is an item left in the queue then it is returned. Otherwise, NULL is returned. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00079">79</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                      {</div>
<div class="line">  <a class="code" href="structlspgQueryQueueStruct.html" title="Store each query along with it&#39;s callback function.">lspg_query_queue_t</a> *rtn;</div>
<div class="line">  </div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4" title="keep the queue from getting tangled">lspg_queue_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#aca86bb77d6cecfae9251743f4171bafb" title="The last item still being used (on == off means nothing in queue)">lspg_query_queue_off</a> == <a class="code" href="lspg_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6" title="Next position to add something to the queue.">lspg_query_queue_on</a>)</div>
<div class="line">    <span class="comment">// Queue is empty</span></div>
<div class="line">    rtn = NULL;</div>
<div class="line">  <span class="keywordflow">else</span> {</div>
<div class="line">    rtn = &amp;(<a class="code" href="lspg_8c.html#a357d9d98f0b8c9625ccebcebfcdce955" title="Our query queue.">lspg_query_queue</a>[(<a class="code" href="lspg_8c.html#aca86bb77d6cecfae9251743f4171bafb" title="The last item still being used (on == off means nothing in queue)">lspg_query_queue_off</a>++) % <a class="code" href="lspg_8c.html#a08fe83fe8226002ee8b80ce0a914fd11" title="Queue length should be long enough that we do not ordinarly bump into the end We should be safe as lo...">LS_PG_QUERY_QUEUE_LENGTH</a>]); </div>
<div class="line">    pthread_cond_signal( &amp;<a class="code" href="lspg_8c.html#a61a308b6a37afd645beb422653b95baa" title="keeps the queue from overflowing">lspg_queue_cond</a>);</div>
<div class="line">  }</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4" title="keep the queue from getting tangled">lspg_queue_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0bb9ef42da8fa21c4df48ec384ab69f4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_query_push </td>
          <td>(</td>
          <td class="paramtype">void(*)(<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *, PGresult *)&#160;</td>
          <td class="paramname"><em>cb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Place a query on the queue. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cb</td><td>Our callback function that deals with the response </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fmt</td><td>Printf style function to generate the query </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00132">132</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                       {</div>
<div class="line">  <span class="keywordtype">int</span> idx;</div>
<div class="line">  va_list arg_ptr;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4" title="keep the queue from getting tangled">lspg_queue_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Pause the thread while we service the queue</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lspg_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6" title="Next position to add something to the queue.">lspg_query_queue_on</a> + 1 == <a class="code" href="lspg_8c.html#aca86bb77d6cecfae9251743f4171bafb" title="The last item still being used (on == off means nothing in queue)">lspg_query_queue_off</a>) {</div>
<div class="line">    pthread_cond_wait( &amp;<a class="code" href="lspg_8c.html#a61a308b6a37afd645beb422653b95baa" title="keeps the queue from overflowing">lspg_queue_cond</a>, &amp;<a class="code" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4" title="keep the queue from getting tangled">lspg_queue_mutex</a>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  idx = <a class="code" href="lspg_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6" title="Next position to add something to the queue.">lspg_query_queue_on</a> % <a class="code" href="lspg_8c.html#a08fe83fe8226002ee8b80ce0a914fd11" title="Queue length should be long enough that we do not ordinarly bump into the end We should be safe as lo...">LS_PG_QUERY_QUEUE_LENGTH</a>;</div>
<div class="line"></div>
<div class="line">  va_start( arg_ptr, fmt);</div>
<div class="line">  vsnprintf( <a class="code" href="lspg_8c.html#a357d9d98f0b8c9625ccebcebfcdce955" title="Our query queue.">lspg_query_queue</a>[idx].qs, <a class="code" href="kvredis_8c.html#a3a8ef1b4b5994d6dd12bf74454ea891b">LS_PG_QUERY_STRING_LENGTH</a>-1, fmt, arg_ptr);</div>
<div class="line">  va_end( arg_ptr);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="lspg_8c.html#a357d9d98f0b8c9625ccebcebfcdce955" title="Our query queue.">lspg_query_queue</a>[idx].<a class="code" href="structlspgQueryQueueStruct.html#a1389b3ec4ddf9ed5cc0344d229a7ff9e" title="our queries should all be pretty short as we&#39;ll just be calling functions: fixed length here simplifi...">qs</a>[<a class="code" href="kvredis_8c.html#a3a8ef1b4b5994d6dd12bf74454ea891b">LS_PG_QUERY_STRING_LENGTH</a> - 1] = 0;</div>
<div class="line">  <a class="code" href="lspg_8c.html#a357d9d98f0b8c9625ccebcebfcdce955" title="Our query queue.">lspg_query_queue</a>[idx].<a class="code" href="structlspgQueryQueueStruct.html#a53bac5ae4cab775423940bff5092a831" title="Callback function for when a query returns a result.">onResponse</a> = cb;</div>
<div class="line">  <a class="code" href="lspg_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6" title="Next position to add something to the queue.">lspg_query_queue_on</a>++;</div>
<div class="line"></div>
<div class="line">  pthread_kill( <a class="code" href="lspg_8c.html#a04eb0cda0d5e5afeae7c393b51689765" title="our worker thread">lspg_thread</a>, SIGUSR1);</div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4" title="keep the queue from getting tangled">lspg_queue_mutex</a>);</div>
<div class="line">};</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3847589e641f7e16a0cd68ef30e37cca"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_query_reply_next </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove the oldest item in the queue. </p>
<p>this is called only when there is nothing else to service the reply: this pop does not return anything. We use the ...reply_peek function to return the next item in the reply queue </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00103">103</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                             {</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4" title="keep the queue from getting tangled">lspg_queue_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a2603b071afdbff7c0924b13de2454264" title="The current item being digested.">lspg_query_queue_reply</a> != <a class="code" href="lspg_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6" title="Next position to add something to the queue.">lspg_query_queue_on</a>)</div>
<div class="line">    <a class="code" href="lspg_8c.html#a2603b071afdbff7c0924b13de2454264" title="The current item being digested.">lspg_query_queue_reply</a>++;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4" title="keep the queue from getting tangled">lspg_queue_mutex</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae6bf4f54117bedf903360883bb32699f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a>* lspg_query_reply_peek </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the next item in the reply queue but don't pop it since we may need it more than once. </p>
<p>Call <a class="el" href="kvredis_8c.html#a3847589e641f7e16a0cd68ef30e37cca" title="Remove the oldest item in the queue.">lspg_query_reply_next()</a> when done. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00116">116</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                            {</div>
<div class="line">  <a class="code" href="structlspgQueryQueueStruct.html" title="Store each query along with it&#39;s callback function.">lspg_query_queue_t</a> *rtn;</div>
<div class="line"></div>
<div class="line">  pthread_mutex_lock( &amp;<a class="code" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4" title="keep the queue from getting tangled">lspg_queue_mutex</a>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#a2603b071afdbff7c0924b13de2454264" title="The current item being digested.">lspg_query_queue_reply</a> == <a class="code" href="lspg_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6" title="Next position to add something to the queue.">lspg_query_queue_on</a>)</div>
<div class="line">    rtn = NULL;</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    rtn = &amp;(<a class="code" href="lspg_8c.html#a357d9d98f0b8c9625ccebcebfcdce955" title="Our query queue.">lspg_query_queue</a>[(<a class="code" href="lspg_8c.html#a2603b071afdbff7c0924b13de2454264" title="The current item being digested.">lspg_query_queue_reply</a>) % <a class="code" href="lspg_8c.html#a08fe83fe8226002ee8b80ce0a914fd11" title="Queue length should be long enough that we do not ordinarly bump into the end We should be safe as lo...">LS_PG_QUERY_QUEUE_LENGTH</a>]);</div>
<div class="line"></div>
<div class="line">  pthread_mutex_unlock( &amp;<a class="code" href="lspg_8c.html#aed46a94106c583796e3a8ca0e89aa8e4" title="keep the queue from getting tangled">lspg_queue_mutex</a>);</div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a038c5af23469b789fc1c55d21cb43029"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_receive </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Receive a result of a query. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01064">1064</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                    {</div>
<div class="line">  PGresult *pgr;</div>
<div class="line">  <a class="code" href="structlspgQueryQueueStruct.html" title="Store each query along with it&#39;s callback function.">lspg_query_queue_t</a> *qqp;</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line"></div>
<div class="line">  err = PQconsumeInput( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">  <span class="keywordflow">if</span>( err != 1) {</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;consume input failed: %s&quot;</span>, PQerrorMessage( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>));</div>
<div class="line">    <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>;</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// We must call PQgetResult until it returns NULL before sending the next query</span></div>
<div class="line">  <span class="comment">// This implies that only one query can ever be active at a time and our queue</span></div>
<div class="line">  <span class="comment">// management should be simple</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// We should be in the LS_PG_STATE_RECV here</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span>( !PQisBusy( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>)) {</div>
<div class="line">    pgr = PQgetResult( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( pgr == NULL) {</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a3847589e641f7e16a0cd68ef30e37cca" title="Remove the oldest item in the queue.">lspg_query_reply_next</a>();</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// we are now done reading the response from the database</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      ExecStatusType es;</div>
<div class="line"></div>
<div class="line">      qqp = <a class="code" href="kvredis_8c.html#ae6bf4f54117bedf903360883bb32699f" title="Return the next item in the reply queue but don&#39;t pop it since we may need it more than once...">lspg_query_reply_peek</a>();</div>
<div class="line">      es = PQresultStatus( pgr);</div>
<div class="line"></div>
<div class="line">      <span class="keywordflow">if</span>( es != PGRES_COMMAND_OK &amp;&amp; es != PGRES_TUPLES_OK) {</div>
<div class="line">        <span class="keywordtype">char</span> *emess;</div>
<div class="line">        emess = PQresultErrorMessage( pgr);</div>
<div class="line">        <span class="keywordflow">if</span>( emess != NULL &amp;&amp; emess[0] != 0) {</div>
<div class="line">          <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Error from query &#39;%s&#39;:\n%s&quot;</span>, qqp-&gt;<a class="code" href="structlspgQueryQueueStruct.html#a1389b3ec4ddf9ed5cc0344d229a7ff9e" title="our queries should all be pretty short as we&#39;ll just be calling functions: fixed length here simplifi...">qs</a>, emess);</div>
<div class="line">        }</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// Deal with the response</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// If the response is likely to take awhile we should probably</span></div>
<div class="line">        <span class="comment">// add a new state and put something in the main look to run the onResponse</span></div>
<div class="line">        <span class="comment">// routine in the main loop.  For now, though, we only expect very brief onResponse routines</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="keywordflow">if</span>( qqp != NULL &amp;&amp; qqp-&gt;<a class="code" href="structlspgQueryQueueStruct.html#a53bac5ae4cab775423940bff5092a831" title="Callback function for when a query returns a result.">onResponse</a> != NULL)</div>
<div class="line">          qqp-&gt;<a class="code" href="structlspgQueryQueueStruct.html#a53bac5ae4cab775423940bff5092a831" title="Callback function for when a query returns a result.">onResponse</a>( qqp, pgr);</div>
<div class="line">      }</div>
<div class="line">      PQclear( pgr);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1adfdb5ca9fdb5060849d726bf540117"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_run </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start 'er runnin'. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01483">1483</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                {</div>
<div class="line">  pthread_create( &amp;<a class="code" href="lspg_8c.html#a04eb0cda0d5e5afeae7c393b51689765" title="our worker thread">lspg_thread</a>, NULL, <a class="code" href="lspg_8c.html#aaf4fadd2943fa3a2ecb5d840e84d68fa" title="The main loop for the lspg thread.">lspg_worker</a>, NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a714b15e117ffe7bfce4f2f2ce4725b0a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_send_next_query </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>send the next queued query to the DB server </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01017">1017</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                            {</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Normally we should be in the &quot;send&quot; state</span></div>
<div class="line">  <span class="comment">// but we can also send if we are servicing</span></div>
<div class="line">  <span class="comment">// a reply</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  <a class="code" href="structlspgQueryQueueStruct.html" title="Store each query along with it&#39;s callback function.">lspg_query_queue_t</a> *qqp;</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line"></div>
<div class="line">  qqp = <a class="code" href="kvredis_8c.html#ad5f3ec8f197cc330c83dba70f310533c" title="Return the next item in the postgresql queue.">lspg_query_next</a>();</div>
<div class="line">  <span class="keywordflow">if</span>( qqp == NULL) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// A send without a query?  Should never happen.</span></div>
<div class="line">    <span class="comment">// But at least we shouldn&#39;t segfault if it does.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( qqp-&gt;<a class="code" href="structlspgQueryQueueStruct.html#a1389b3ec4ddf9ed5cc0344d229a7ff9e" title="our queries should all be pretty short as we&#39;ll just be calling functions: fixed length here simplifi...">qs</a>[0] == 0) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Do we really have to check this case?</span></div>
<div class="line">    <span class="comment">// It would only come up if we stupidly pushed an empty query string</span></div>
<div class="line">    <span class="comment">// or ran off the end of the queue</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Popped empty query string.  Probably bad things are going on.&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="kvredis_8c.html#a3847589e641f7e16a0cd68ef30e37cca" title="Remove the oldest item in the queue.">lspg_query_reply_next</a>();</div>
<div class="line">    <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a>;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    err = PQsendQuery( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>, qqp-&gt;<a class="code" href="structlspgQueryQueueStruct.html#a1389b3ec4ddf9ed5cc0344d229a7ff9e" title="our queries should all be pretty short as we&#39;ll just be calling functions: fixed length here simplifi...">qs</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( err == 0) {</div>
<div class="line">      <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;query failed: %s\n&quot;</span>, PQerrorMessage( <a class="code" href="lspg_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>));</div>
<div class="line"></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Don&#39;t wait for a reply, just reset the connection</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <a class="code" href="kvredis_8c.html#a3847589e641f7e16a0cd68ef30e37cca" title="Remove the oldest item in the queue.">lspg_query_reply_next</a>();</div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="lspg_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <a class="code" href="lspg_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="lspg_8c.html#a88a7e80c12fb0449c4b0857a0c7deb21">LS_PG_STATE_SEND_FLUSH</a>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4253474d4dd305aec0afdd5552b3ddd5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_seq_run_prep_all </td>
          <td>(</td>
          <td class="paramtype">long long&#160;</td>
          <td class="paramname"><em>skey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>kappa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>phi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>cx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>cy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>ax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>ay</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>az</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convinence function to call seq run prep. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">skey</td><td>px.shots key for this image </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">kappa</td><td>current kappa postion </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phi</td><td>current phi postition </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cx</td><td>current center table x </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cy</td><td>current center table y </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ax</td><td>current alignment table x </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ay</td><td>current alignment table y </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">az</td><td>current alignment table z </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00815">815</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                             {</div>
<div class="line">  <a class="code" href="lspg_8c.html#af7d6efd861b152a371442791deb42bd3" title="queue up the seq_run_prep query">lspg_seq_run_prep_call</a>( skey, <a class="code" href="lspmac_8c.html#a0be79ccb7ebf3a665248fd856112b9fd" title="Kappa.">kappa</a>, <a class="code" href="lspmac_8c.html#ac8070dc568ad974a3db42b51eca828cc" title="Phi (not data collection axis)">phi</a>, cx, cy, ax, ay, az);</div>
<div class="line">  <a class="code" href="lspg_8c.html#ac0b01f501322432a8fa37f31898c3499" title="Wait for seq run prep query to return.">lspg_seq_run_prep_wait</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#a472b09ddf716c80207f97e2bb5d37d66" title="Indicate we are done waiting.">lspg_seq_run_prep_done</a>();</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af7d6efd861b152a371442791deb42bd3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_seq_run_prep_call </td>
          <td>(</td>
          <td class="paramtype">long long&#160;</td>
          <td class="paramname"><em>skey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>kappa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>phi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>cx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>cy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>ax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>ay</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>az</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>queue up the seq_run_prep query </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">skey</td><td>px.shots key for this image </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">kappa</td><td>current kappa postion </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phi</td><td>current phi postition </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cx</td><td>current center table x </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cy</td><td>current center table y </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ax</td><td>current alignment table x </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ay</td><td>current alignment table y </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">az</td><td>current alignment table z </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00781">781</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                              {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#ad146cb91b5f7dd8bb283092c28781fe7">mutex</a>));</div>
<div class="line">  <a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#a42d08888327e9059ddd69ddfec31b8a9">new_value_ready</a> = 0;</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#ad146cb91b5f7dd8bb283092c28781fe7">mutex</a>));</div>
<div class="line"></div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#a11cda12050dc9a86188e15e2155a6013" title="Callback for the seq_run_prep query.">lspg_seq_run_prep_cb</a>, <span class="stringliteral">&quot;SELECT px.seq_run_prep( %lld, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f, %.3f)&quot;</span>,</div>
<div class="line">                   skey, <a class="code" href="lspmac_8c.html#a0be79ccb7ebf3a665248fd856112b9fd" title="Kappa.">kappa</a>, <a class="code" href="lspmac_8c.html#ac8070dc568ad974a3db42b51eca828cc" title="Phi (not data collection axis)">phi</a>, cx, cy, ax, ay, az);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a11cda12050dc9a86188e15e2155a6013"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_seq_run_prep_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback for the seq_run_prep query. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">qqp</td><td>The query item that generated this callback </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pgr</td><td>The result of the query </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00769">769</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                            {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#ad146cb91b5f7dd8bb283092c28781fe7">mutex</a>));</div>
<div class="line">  <a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#a42d08888327e9059ddd69ddfec31b8a9">new_value_ready</a> = 1;</div>
<div class="line">  pthread_cond_signal( &amp;(<a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#acd83ea6994f57377716ff01c8ee7ce43">cond</a>));</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#ad146cb91b5f7dd8bb283092c28781fe7">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a472b09ddf716c80207f97e2bb5d37d66"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_seq_run_prep_done </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Indicate we are done waiting. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00809">809</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                              {</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#ad146cb91b5f7dd8bb283092c28781fe7">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a31823ecb2b44d4a6674f804059a27bce"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_seq_run_prep_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the data collection object. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00761">761</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                              {</div>
<div class="line">  <a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#a42d08888327e9059ddd69ddfec31b8a9">new_value_ready</a> = 0;</div>
<div class="line">  pthread_mutex_init( &amp;(<a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#ad146cb91b5f7dd8bb283092c28781fe7">mutex</a>), NULL);</div>
<div class="line">  pthread_cond_init(  &amp;(<a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#acd83ea6994f57377716ff01c8ee7ce43">cond</a>),  NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac0b01f501322432a8fa37f31898c3499"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_seq_run_prep_wait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for seq run prep query to return. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00801">801</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                              {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#ad146cb91b5f7dd8bb283092c28781fe7">mutex</a>));</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#a42d08888327e9059ddd69ddfec31b8a9">new_value_ready</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;(<a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#acd83ea6994f57377716ff01c8ee7ce43">cond</a>), &amp;(<a class="code" href="lspg_8c.html#a1b0d9fc30bcea6905b075d2362149172">lspg_seq_run_prep</a>.<a class="code" href="structlspg__seq__run__prep__struct.html#ad146cb91b5f7dd8bb283092c28781fe7">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a049f4422994aa2eb2b841ffb2937f895"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_sig_service </td>
          <td>(</td>
          <td class="paramtype">struct pollfd *&#160;</td>
          <td class="paramname"><em>evt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Service a signal Signals here are treated as file descriptors and fits into our poll scheme. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">evt</td><td>The pollfd object that triggered this call </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01125">1125</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                        {</div>
<div class="line">  <span class="keyword">struct </span>signalfd_siginfo fdsi;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Really, we don&#39;t care about the signal,</span></div>
<div class="line">  <span class="comment">// it&#39;s just used to drop out of the poll</span></div>
<div class="line">  <span class="comment">// function when there is something for us</span></div>
<div class="line">  <span class="comment">// to do that didn&#39;t invovle something coming</span></div>
<div class="line">  <span class="comment">// from our postgresql server.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// This is accompished by the query_push function</span></div>
<div class="line">  <span class="comment">// to notify us that a new query is ready.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  read( evt-&gt;fd, &amp;fdsi, <span class="keyword">sizeof</span>( <span class="keyword">struct</span> signalfd_siginfo));</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab9780e15924a50b2a5545e10806000b3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_wait_for_detector_all </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Combined call to wait for the detector. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00625">625</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                  {</div>
<div class="line">  <a class="code" href="lspg_8c.html#a4b5222b859a44eae616804a1e990b86d" title="initiate the wait for detector query">lspg_wait_for_detector_call</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#af094e01be121ce8e14abb679abd17e19" title="Pause the calling thread until the detector is ready Called by the MD2 thread.">lspg_wait_for_detector_wait</a>();</div>
<div class="line">  <a class="code" href="lspg_8c.html#abb3645dee7c4514b650ab02f27570a69" title="Done waiting for the detector.">lspg_wait_for_detector_done</a>();</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4b5222b859a44eae616804a1e990b86d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_wait_for_detector_call </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>initiate the wait for detector query </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00599">599</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                   {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#a958e9fe59e671e61f95c2ce796ba24ce">mutex</a>));</div>
<div class="line">  <a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#ad950e85c70c4473c5c7c40f8ceeae61d">new_value_ready</a> = 0;</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#a958e9fe59e671e61f95c2ce796ba24ce">mutex</a>));</div>
<div class="line">  </div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="lspg_8c.html#a5747c519d1aa4c310010a862cae8a823" title="Callback for the wait for detector query.">lspg_wait_for_detector_cb</a>, <span class="stringliteral">&quot;SELECT px.lock_detector_test_block()&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5747c519d1aa4c310010a862cae8a823"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_wait_for_detector_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback for the wait for detector query. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00590">590</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                                                        {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#a958e9fe59e671e61f95c2ce796ba24ce">mutex</a>));</div>
<div class="line">  <a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#ad950e85c70c4473c5c7c40f8ceeae61d">new_value_ready</a> = 1;</div>
<div class="line">  pthread_cond_signal(  &amp;(<a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#aa97388f93ca5099196ba0da1e4a5b7bb">cond</a>));</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#a958e9fe59e671e61f95c2ce796ba24ce">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="abb3645dee7c4514b650ab02f27570a69"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_wait_for_detector_done </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Done waiting for the detector. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00618">618</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                   {</div>
<div class="line">  pthread_mutex_unlock( &amp;(<a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#a958e9fe59e671e61f95c2ce796ba24ce">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3517f8fbed91c998f6036284f9bd0c48"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_wait_for_detector_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>initialize the detector timing object </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00582">582</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                   {</div>
<div class="line">  <a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#ad950e85c70c4473c5c7c40f8ceeae61d">new_value_ready</a> = 0;</div>
<div class="line">  pthread_mutex_init( &amp;(<a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#a958e9fe59e671e61f95c2ce796ba24ce">mutex</a>), NULL);</div>
<div class="line">  pthread_cond_init(  &amp;(<a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#aa97388f93ca5099196ba0da1e4a5b7bb">cond</a>), NULL);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af094e01be121ce8e14abb679abd17e19"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_wait_for_detector_wait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Pause the calling thread until the detector is ready Called by the MD2 thread. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00610">610</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                                   {</div>
<div class="line">  pthread_mutex_lock( &amp;(<a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#a958e9fe59e671e61f95c2ce796ba24ce">mutex</a>));</div>
<div class="line">  <span class="keywordflow">while</span>( <a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#ad950e85c70c4473c5c7c40f8ceeae61d">new_value_ready</a> == 0)</div>
<div class="line">    pthread_cond_wait( &amp;(<a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#aa97388f93ca5099196ba0da1e4a5b7bb">cond</a>), &amp;(<a class="code" href="lspg_8c.html#a0dfc8d0410cd2d7f7da7a70d3ef88e58" title="Instance of the detector timing object.">lspg_wait_for_detector</a>.<a class="code" href="structlspg__wait__for__detector__struct.html#a958e9fe59e671e61f95c2ce796ba24ce">mutex</a>));</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aaf4fadd2943fa3a2ecb5d840e84d68fa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* lspg_worker </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>dummy</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The main loop for the lspg thread. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">dummy</td><td>Required by pthreads but unused </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l01391">1391</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>
<div class="fragment"><div class="line">                    {</div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">struct </span>pollfd fda[2];  <span class="comment">// 0=signal handler, 1=pg socket</span></div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> nfda = 0;</div>
<div class="line">  <span class="keyword">static</span> sigset_t our_sigset;</div>
<div class="line">  <span class="keywordtype">int</span> sigfd;</div>
<div class="line"></div>
<div class="line">  sigemptyset( &amp;our_sigset);</div>
<div class="line">  sigaddset( &amp;our_sigset, SIGUSR1);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// block ordinary signal mechanism</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  sigprocmask(SIG_BLOCK, &amp;our_sigset, NULL);</div>
<div class="line"></div>
<div class="line">    </div>
<div class="line">  fda[0].fd = signalfd( -1, &amp;our_sigset, SFD_NONBLOCK);</div>
<div class="line">  <span class="keywordflow">if</span>( fda[0].fd == -1) {</div>
<div class="line">    <span class="keywordtype">char</span> *es;</div>
<div class="line"></div>
<div class="line">    es = strerror( errno);</div>
<div class="line">    <a class="code" href="lslogging_8c.html#a0e756b36671055ef02a8f04d2ba8a93b" title="The routine everyone will be talking about.">lslogging_log_message</a>( <span class="stringliteral">&quot;Signalfd trouble: %s&quot;</span>, es);</div>
<div class="line">  }</div>
<div class="line">  fda[0].events = POLLIN;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">//  make sure file descriptor is not legal until it&#39;s been conneceted</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.fd   = -1;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span>( 1) {</div>
<div class="line">    <span class="keywordtype">int</span> pollrtn;</div>
<div class="line">    <span class="keywordtype">int</span> poll_timeout_ms;</div>
<div class="line"></div>
<div class="line">   <a class="code" href="kvredis_8c.html#ab52a8c8245bf6561f40c0f224fc07ff4" title="Implements our state machine Does not strictly only set the next state as it also calls some function...">lspg_next_state</a>();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.fd == -1) {</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Here a connection to the database is not established.</span></div>
<div class="line">      <span class="comment">// Periodicaly try again.  Should possibly arrange to reconnect</span></div>
<div class="line">      <span class="comment">// to signalfd but that&#39;s unlikely to be nessesary.</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      nfda = 1;</div>
<div class="line">      poll_timeout_ms = 10000;</div>
<div class="line">      fda[1].revents = 0;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Arrange to peacfully do nothing until either the pg server sends us something</span></div>
<div class="line">      <span class="comment">// or someone pushs something onto our queue</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      nfda = 2;</div>
<div class="line">      fda[1].fd      = <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.fd;</div>
<div class="line">      fda[1].events  = <a class="code" href="lspg_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events;</div>
<div class="line">      fda[1].revents = 0;</div>
<div class="line">      poll_timeout_ms = -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    pollrtn = poll( fda, nfda, poll_timeout_ms);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( pollrtn &amp;&amp; fda[0].revents) {</div>
<div class="line">      <a class="code" href="lspg_8c.html#a049f4422994aa2eb2b841ffb2937f895" title="Service a signal Signals here are treated as file descriptors and fits into our poll scheme...">lspg_sig_service</a>( &amp;(fda[0]));</div>
<div class="line">      pollrtn--;</div>
<div class="line">    } </div>
<div class="line">    <span class="keywordflow">if</span>( pollrtn &amp;&amp; fda[1].revents) {</div>
<div class="line">      <a class="code" href="kvredis_8c.html#aa8d1fed4b461c2139a21826d524777d5" title="I/O control to/from the postgresql server.">lspg_pg_service</a>( &amp;(fda[1]));</div>
<div class="line">      pollrtn--;</div>
<div class="line">    } </div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a4937baac0cc78ea306d58b5f027867f1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int ls_pg_state = <a class="el" href="lspg_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>State of the lspg state machine. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00039">39</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a69ae04978986e6413ca7cefcb692b645"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">PostgresPollingStatusType lspg_connectPoll_response</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Used to determine state while connecting. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00069">69</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7ef8a09203117578c9b2ce4719519f36"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a48b627e412dd038c1f17cdb0501eec33">lspg_getcenter_t</a> lspg_getcenter</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>the getcenter object </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00073">73</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="adbf3b3652c6531c3d194320d1abc1c80"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lspg_8c.html#a3442e66a1f05457eb22a0d4a5d295f3a">lspg_lock_detector_t</a> lspg_lock_detector</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00699">699</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="aaae7ce3ecd7d54a9e46c41d7a742a454"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lspg_8c.html#a7232a0d630558f0c4c081d087150973d">lspg_lock_diffractometer_t</a> lspg_lock_diffractometer</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00640">640</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad8d8e2f578ca79189a80c1fd5b60cefd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pgpmac_8h.html#a17ea2bf07a0b3b892baa00bd392607b3">lspg_nextshot_t</a> lspg_nextshot</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>the nextshot object </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00072">72</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a357d9d98f0b8c9625ccebcebfcdce955"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> lspg_query_queue[<a class="el" href="lspg_8c.html#a08fe83fe8226002ee8b80ce0a914fd11">LS_PG_QUERY_QUEUE_LENGTH</a>]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Our query queue. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00061">61</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="aca86bb77d6cecfae9251743f4171bafb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int lspg_query_queue_off = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The last item still being used (on == off means nothing in queue) </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00063">63</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3cbe7f3161b3c1838ebc56a3bbcfd8a6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int lspg_query_queue_on = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Next position to add something to the queue. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00062">62</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2603b071afdbff7c0924b13de2454264"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int lspg_query_queue_reply = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The current item being digested. </p>
<p>Normally off &lt;= reply &lt;= on. Corner case of queue wrap arround works because we only increment and compare for equality. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00064">64</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a61a308b6a37afd645beb422653b95baa"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pthread_cond_t lspg_queue_cond</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>keeps the queue from overflowing </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00044">44</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="aed46a94106c583796e3a8ca0e89aa8e4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pthread_mutex_t lspg_queue_mutex</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>keep the queue from getting tangled </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00043">43</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a06c5a937e41a6c706a247777642ec1fb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">PostgresPollingStatusType lspg_resetPoll_response</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Used to determine state while reconnecting. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00070">70</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1b0d9fc30bcea6905b075d2362149172"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lspg_8c.html#ab2da550aea6388c835abe0ee0b226eb0">lspg_seq_run_prep_t</a> lspg_seq_run_prep</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00757">757</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a04eb0cda0d5e5afeae7c393b51689765"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pthread_t lspg_thread</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>our worker thread </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00042">42</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a0dfc8d0410cd2d7f7da7a70d3ef88e58"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lspg_8c.html#a6f273a499bf316de95df3816a9b1bc06">lspg_wait_for_detector_t</a> lspg_wait_for_detector</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Instance of the detector timing object. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00578">578</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="af3f897b8ffa020ca54289bc5b28cb64d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct pollfd lspgfd</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>our poll info </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00045">45</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad40ac52086f6b774928af45b09d54c6e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct timeval lspg_time_sent now</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>used to ensure we do not inundate the db server with connection requests </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00040">40</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9012783dbbadf652a81649a289697cf3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">PGconn* q = NULL</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Database connector. </p>

<p>Definition at line <a class="el" href="lspg_8c_source.html#l00068">68</a> of file <a class="el" href="lspg_8c_source.html">lspg.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="lspg_8c.html">lspg.c</a></li>
    <li class="footer">Generated on Sun Dec 16 2012 17:35:47 for LS-CAT PGPMAC by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 </li>
  </ul>
</div>
</body>
</html>
