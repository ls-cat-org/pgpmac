\hypertarget{pgpmac_8h}{\section{pgpmac.\-h File Reference}
\label{pgpmac_8h}\index{pgpmac.\-h@{pgpmac.\-h}}
}


Headers for the entire pgpmac project.  


{\ttfamily \#include $<$stdint.\-h$>$}\\*
{\ttfamily \#include $<$stdio.\-h$>$}\\*
{\ttfamily \#include $<$stdlib.\-h$>$}\\*
{\ttfamily \#include $<$unistd.\-h$>$}\\*
{\ttfamily \#include $<$sys/types.\-h$>$}\\*
{\ttfamily \#include $<$sys/socket.\-h$>$}\\*
{\ttfamily \#include $<$netdb.\-h$>$}\\*
{\ttfamily \#include $<$string.\-h$>$}\\*
{\ttfamily \#include $<$netinet/in.\-h$>$}\\*
{\ttfamily \#include $<$errno.\-h$>$}\\*
{\ttfamily \#include $<$poll.\-h$>$}\\*
{\ttfamily \#include $<$libpq-\/fe.\-h$>$}\\*
{\ttfamily \#include $<$ncurses.\-h$>$}\\*
{\ttfamily \#include $<$math.\-h$>$}\\*
{\ttfamily \#include $<$pthread.\-h$>$}\\*
{\ttfamily \#include $<$signal.\-h$>$}\\*
{\ttfamily \#include $<$sys/signalfd.\-h$>$}\\*
{\ttfamily \#include $<$sys/time.\-h$>$}\\*
{\ttfamily \#include $<$time.\-h$>$}\\*
{\ttfamily \#include $<$getopt.\-h$>$}\\*
{\ttfamily \#include $<$regex.\-h$>$}\\*
{\ttfamily \#include $<$hiredis/hiredis.\-h$>$}\\*
{\ttfamily \#include $<$hiredis/async.\-h$>$}\\*
{\ttfamily \#include $<$search.\-h$>$}\\*
{\ttfamily \#include $<$ctype.\-h$>$}\\*
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structlsredis__obj__struct}{lsredis\-\_\-obj\-\_\-struct}
\begin{DoxyCompactList}\small\item\em Redis Object Basic object whose value is sychronized with our redis db. \end{DoxyCompactList}\item 
struct \hyperlink{structtagEthernetCmd}{tag\-Ethernet\-Cmd}
\begin{DoxyCompactList}\small\item\em P\-M\-A\-C ethernet packet definition. \end{DoxyCompactList}\item 
struct \hyperlink{structlspmac__cmd__queue__struct}{lspmac\-\_\-cmd\-\_\-queue\-\_\-struct}
\begin{DoxyCompactList}\small\item\em P\-M\-A\-C command queue item. \end{DoxyCompactList}\item 
struct \hyperlink{structlspmac__motor__struct}{lspmac\-\_\-motor\-\_\-struct}
\begin{DoxyCompactList}\small\item\em Motor information. \end{DoxyCompactList}\item 
struct \hyperlink{structlspmac__bi__struct}{lspmac\-\_\-bi\-\_\-struct}
\begin{DoxyCompactList}\small\item\em Storage for binary inputs. \end{DoxyCompactList}\item 
struct \hyperlink{structlspgQueryQueueStruct}{lspg\-Query\-Queue\-Struct}
\begin{DoxyCompactList}\small\item\em Store each query along with it's callback function. \end{DoxyCompactList}\item 
struct \hyperlink{structlspg__waitcryo__struct}{lspg\-\_\-waitcryo\-\_\-struct}
\item 
struct \hyperlink{structlspg__getcurrentsampleid__struct}{lspg\-\_\-getcurrentsampleid\-\_\-struct}
\item 
struct \hyperlink{structlspg__demandairrights__struct}{lspg\-\_\-demandairrights\-\_\-struct}
\item 
struct \hyperlink{structlspg__getcenter__struct}{lspg\-\_\-getcenter\-\_\-struct}
\begin{DoxyCompactList}\small\item\em Storage for getcenter query Used for the md2 R\-O\-T\-A\-T\-E command that generates the centering movies. \end{DoxyCompactList}\item 
struct \hyperlink{structlspg__starttransfer__struct}{lspg\-\_\-starttransfer\-\_\-struct}
\begin{DoxyCompactList}\small\item\em returns 1 if transfer can continue 0 to abort \end{DoxyCompactList}\item 
struct \hyperlink{structlspg__nextsample__struct}{lspg\-\_\-nextsample\-\_\-struct}
\begin{DoxyCompactList}\small\item\em Returns the next sample number Just a 32 bit int (Ha!, take that, nextshot!) \end{DoxyCompactList}\item 
struct \hyperlink{structlspg__nextshot__struct}{lspg\-\_\-nextshot\-\_\-struct}
\begin{DoxyCompactList}\small\item\em Storage definition for nextshot query. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{pgpmac_8h_a369266c24eacffb87046522897a570d5}{\-\_\-\-G\-N\-U\-\_\-\-S\-O\-U\-R\-C\-E}
\item 
\#define \hyperlink{pgpmac_8h_a3bae94e8e4e4347dd5f87b6bda058de6}{L\-S\-\_\-\-D\-I\-S\-P\-L\-A\-Y\-\_\-\-W\-I\-N\-D\-O\-W\-\_\-\-H\-E\-I\-G\-H\-T}~8
\begin{DoxyCompactList}\small\item\em Number of status box rows. \end{DoxyCompactList}\item 
\#define \hyperlink{pgpmac_8h_a1f96754f00a1f82414cebc66f75ded78}{L\-S\-\_\-\-D\-I\-S\-P\-L\-A\-Y\-\_\-\-W\-I\-N\-D\-O\-W\-\_\-\-W\-I\-D\-T\-H}~24
\begin{DoxyCompactList}\small\item\em Number of status box columns. \end{DoxyCompactList}\item 
\#define \hyperlink{pgpmac_8h_a3a8ef1b4b5994d6dd12bf74454ea891b}{L\-S\-\_\-\-P\-G\-\_\-\-Q\-U\-E\-R\-Y\-\_\-\-S\-T\-R\-I\-N\-G\-\_\-\-L\-E\-N\-G\-T\-H}~1024
\begin{DoxyCompactList}\small\item\em Fixed length postgresql query strings. Queries should all be function calls so this is not as weird as one might think. \end{DoxyCompactList}\item 
\#define \hyperlink{pgpmac_8h_ab61d790b5572f116e091babfda53627b}{L\-S\-E\-V\-E\-N\-T\-S\-\_\-\-E\-V\-E\-N\-T\-\_\-\-L\-E\-N\-G\-T\-H}~256
\begin{DoxyCompactList}\small\item\em Fixed length for event names\-: simplifies string handling. \end{DoxyCompactList}\item 
\#define \hyperlink{pgpmac_8h_abe2a74d23400d8d8fe02dc407c242035}{L\-S\-P\-M\-A\-C\-\_\-\-M\-A\-G\-I\-C\-\_\-\-N\-U\-M\-B\-E\-R}~0x9700436
\item 
\#define \hyperlink{pgpmac_8h_a30f0f377b0f0695284145d420ea51846}{M\-D2\-C\-M\-D\-S\-\_\-\-C\-M\-D\-\_\-\-L\-E\-N\-G\-T\-H}~32
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef struct \hyperlink{structlsredis__obj__struct}{lsredis\-\_\-obj\-\_\-struct} \hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t}
\begin{DoxyCompactList}\small\item\em Redis Object Basic object whose value is sychronized with our redis db. \end{DoxyCompactList}\item 
typedef struct \hyperlink{structtagEthernetCmd}{tag\-Ethernet\-Cmd} \hyperlink{pgpmac_8h_a2d163436571135a457f4a4e2fbd09633}{pmac\-\_\-cmd\-\_\-t}
\begin{DoxyCompactList}\small\item\em P\-M\-A\-C ethernet packet definition. \end{DoxyCompactList}\item 
typedef struct \\*
\hyperlink{structlspmac__cmd__queue__struct}{lspmac\-\_\-cmd\-\_\-queue\-\_\-struct} \hyperlink{pgpmac_8h_a99c275e32ad897dca34d196b91f038cb}{pmac\-\_\-cmd\-\_\-queue\-\_\-t}
\begin{DoxyCompactList}\small\item\em P\-M\-A\-C command queue item. \end{DoxyCompactList}\item 
typedef struct \hyperlink{structlspmac__motor__struct}{lspmac\-\_\-motor\-\_\-struct} \hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t}
\begin{DoxyCompactList}\small\item\em Motor information. \end{DoxyCompactList}\item 
typedef struct \hyperlink{structlspmac__bi__struct}{lspmac\-\_\-bi\-\_\-struct} \hyperlink{pgpmac_8h_ac48984832ef73cf145e5f08bc65bd3a0}{lspmac\-\_\-bi\-\_\-t}
\begin{DoxyCompactList}\small\item\em Storage for binary inputs. \end{DoxyCompactList}\item 
typedef struct \hyperlink{structlspgQueryQueueStruct}{lspg\-Query\-Queue\-Struct} \hyperlink{pgpmac_8h_ae57432c0a6ac48a50457815dab2c5b4c}{lspg\-\_\-query\-\_\-queue\-\_\-t}
\begin{DoxyCompactList}\small\item\em Store each query along with it's callback function. \end{DoxyCompactList}\item 
typedef struct \hyperlink{structlspg__waitcryo__struct}{lspg\-\_\-waitcryo\-\_\-struct} \hyperlink{pgpmac_8h_a779e2acce8b5e748c184caf23ed0db57}{lspg\-\_\-waitcryo\-\_\-t}
\item 
typedef struct \\*
\hyperlink{structlspg__getcurrentsampleid__struct}{lspg\-\_\-getcurrentsampleid\-\_\-struct} \hyperlink{pgpmac_8h_a7a794370785ff015d5ee035917e3bee8}{lspg\-\_\-getcurrentsampleid\-\_\-t}
\item 
typedef struct \\*
\hyperlink{structlspg__demandairrights__struct}{lspg\-\_\-demandairrights\-\_\-struct} \hyperlink{pgpmac_8h_a7f71abc6fdfd1839e2e3213d78aaf766}{lspg\-\_\-demandairrights\-\_\-t}
\item 
typedef struct \\*
\hyperlink{structlspg__getcenter__struct}{lspg\-\_\-getcenter\-\_\-struct} \hyperlink{pgpmac_8h_a48b627e412dd038c1f17cdb0501eec33}{lspg\-\_\-getcenter\-\_\-t}
\begin{DoxyCompactList}\small\item\em Storage for getcenter query Used for the md2 R\-O\-T\-A\-T\-E command that generates the centering movies. \end{DoxyCompactList}\item 
typedef struct \\*
\hyperlink{structlspg__starttransfer__struct}{lspg\-\_\-starttransfer\-\_\-struct} \hyperlink{pgpmac_8h_aa1f0e602ae9509005c62fb2d73bc1c5a}{lspg\-\_\-starttransfer\-\_\-t}
\begin{DoxyCompactList}\small\item\em returns 1 if transfer can continue 0 to abort \end{DoxyCompactList}\item 
typedef struct \\*
\hyperlink{structlspg__nextsample__struct}{lspg\-\_\-nextsample\-\_\-struct} \hyperlink{pgpmac_8h_a9dda9014cd0e39fba8d523e37cf9f982}{lspg\-\_\-nextsample\-\_\-t}
\begin{DoxyCompactList}\small\item\em Returns the next sample number Just a 32 bit int (Ha!, take that, nextshot!) \end{DoxyCompactList}\item 
typedef struct \hyperlink{structlspg__nextshot__struct}{lspg\-\_\-nextshot\-\_\-struct} \hyperlink{pgpmac_8h_a17ea2bf07a0b3b892baa00bd392607b3}{lspg\-\_\-nextshot\-\_\-t}
\begin{DoxyCompactList}\small\item\em Storage definition for nextshot query. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
double \hyperlink{pgpmac_8h_a6a1b639686b771c1213b6e23716a7898}{lspmac\-\_\-get\-Position} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$)
\begin{DoxyCompactList}\small\item\em get the motor position (with locking) \end{DoxyCompactList}\item 
char $\ast$$\ast$ \hyperlink{pgpmac_8h_a4ee000bfeef9380d479464a9500af311}{lspg\-\_\-array2ptrs} (char $\ast$)
\begin{DoxyCompactList}\small\item\em returns a null terminated list of strings parsed from postgresql array \end{DoxyCompactList}\item 
char $\ast$$\ast$ \hyperlink{pgpmac_8h_abe31d0e11c41b2235307612c963bb652}{lsredis\-\_\-get\-\_\-string\-\_\-array} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p)
\item 
void \hyperlink{pgpmac_8h_a49a53bb92535ca2b62208dce41760fbb}{lspmac\-\_\-\-Sock\-Send\-D\-Pline} (char $\ast$, char $\ast$fmt,...)
\begin{DoxyCompactList}\small\item\em prepare (queue up) a line to send the dpram ascii command interface \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_a99c275e32ad897dca34d196b91f038cb}{pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a79f86193e36c823157049061b94627a7}{lspmac\-\_\-\-Sock\-Sendline} (char $\ast$, char $\ast$,...)
\begin{DoxyCompactList}\small\item\em Send a one line command. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a6d9f550b9ba36acd237925164abe3ffc}{lsredis\-\_\-get\-\_\-obj} (char $\ast$,...)
\item 
char $\ast$ \hyperlink{pgpmac_8h_ac1994e56114b2315294527d76311f829}{lsredis\-\_\-getstr} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p)
\begin{DoxyCompactList}\small\item\em return a copy of the key's string value be sure to free the result \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_a76b11c62b122ee0fd8399435d4260681}{Pmac\-Sock\-Sendline} (char $\ast$s)
\item 
unsigned int \hyperlink{pgpmac_8h_a4cc866393eda0cf20276d035f6fbe206}{lspg\-\_\-nextsample\-\_\-all} (int $\ast$err)
\item 
char \hyperlink{pgpmac_8h_a0b7600b1c9a4550b32d4be019d25f941}{lsredis\-\_\-getc} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p)
\item 
long int \hyperlink{pgpmac_8h_a1923f998441f4f451204dfd214d52218}{lsredis\-\_\-getl} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p)
\item 
void \hyperlink{pgpmac_8h_aac89b916c1152c44042875feac35a9e4}{lsevents\-\_\-add\-\_\-listener} (char $\ast$, void($\ast$cb)(char $\ast$))
\begin{DoxyCompactList}\small\item\em Add a callback routine to listen for a specific event. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_af19a77187e7406fc87d36bd26e672e6d}{lsevents\-\_\-init} ()
\begin{DoxyCompactList}\small\item\em Initialize this module. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_a024b08c7820bb31c3d5b8f281e07f3e8}{lsevents\-\_\-remove\-\_\-listener} (char $\ast$, void($\ast$cb)(char $\ast$))
\begin{DoxyCompactList}\small\item\em Remove a listener previously added with lsevents\-\_\-add\-\_\-listener. \end{DoxyCompactList}\item 
pthread\-\_\-t $\ast$ \hyperlink{pgpmac_8h_a7f2ed970b1c3b340b79311e73c5f1e11}{lsevents\-\_\-run} ()
\begin{DoxyCompactList}\small\item\em Start up the thread and get out of the way. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_a3661dfc51537c05b11f4fd184fdff07d}{lsevents\-\_\-send\-\_\-event} (char $\ast$,...)
\begin{DoxyCompactList}\small\item\em Call the callback routines for the given event. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_ae09cfa92dba806d8f8808e5822ea713c}{lsevents\-\_\-preregister\-\_\-event} (char $\ast$fmt,...)
\item 
void \hyperlink{pgpmac_8h_a3418b9ab57811d28632794236e056408}{lslogging\-\_\-init} ()
\begin{DoxyCompactList}\small\item\em Initialize the lslogging objects. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\-\_\-log\-\_\-message} (char $\ast$fmt,...)
\begin{DoxyCompactList}\small\item\em The routine everyone will be talking about. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_a065d09eb6914c057383980d3d786affc}{lsredis\-\_\-log} (char $\ast$fmt,...)
\begin{DoxyCompactList}\small\item\em send log message to our redis log key \end{DoxyCompactList}\item 
pthread\-\_\-t $\ast$ \hyperlink{pgpmac_8h_ab5d6951193d8b2df1e4dd61c53de76cc}{lslogging\-\_\-run} ()
\begin{DoxyCompactList}\small\item\em Start up the worker thread. \end{DoxyCompactList}\item 
int \hyperlink{pgpmac_8h_aa4cad634cac645d0366acbb25cef7b96}{lspg\-\_\-demandairrights\-\_\-all} ()
\begin{DoxyCompactList}\small\item\em do nothing until we get airrights \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_a6f7cd0a06f6a266ef65b3604cf33d6c4}{lspg\-\_\-getcenter\-\_\-call} ()
\begin{DoxyCompactList}\small\item\em Request a getcenter query. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_a7c678553b44c874d08ec9966ed7bb1c0}{lspg\-\_\-getcenter\-\_\-done} ()
\begin{DoxyCompactList}\small\item\em Done with getcenter query. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_a3e0e4b3cb9fa03961ee0c104e0b06754}{lspg\-\_\-getcenter\-\_\-wait} ()
\begin{DoxyCompactList}\small\item\em Wait for a getcenter query to return. \end{DoxyCompactList}\item 
unsigned int \hyperlink{pgpmac_8h_a39ff432056655f9dbe0f0239668caf74}{lspg\-\_\-getcurrentsampleid\-\_\-all} ()
\begin{DoxyCompactList}\small\item\em return the current sampleid \end{DoxyCompactList}\item 
int \hyperlink{pgpmac_8h_a02d7dc2b8b8667b07b48d9147eb4621d}{lspg\-\_\-getcurrentsampleid\-\_\-wait\-\_\-for\-\_\-id} (unsigned int test)
\item 
void \hyperlink{pgpmac_8h_a8a77972df14166e05c94ed0792baa09b}{lspg\-\_\-init} ()
\begin{DoxyCompactList}\small\item\em Initiallize the lspg module. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_af17ef79544ca5d78fd477010fe90d538}{lspg\-\_\-nextshot\-\_\-call} ()
\begin{DoxyCompactList}\small\item\em Queue up a nextshot query. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_a50458a014041a4118452802dfb303960}{lspg\-\_\-nextshot\-\_\-done} ()
\begin{DoxyCompactList}\small\item\em Called when the next shot query has been processed. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_a784a6de32a86fec9efb3ef3ae4b6e3ac}{lspg\-\_\-nextshot\-\_\-wait} ()
\begin{DoxyCompactList}\small\item\em Wait for the next shot query to get processed. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_a5c9f2cdd05a9a7fc2c1e03ffebec9d9f}{lspg\-\_\-query\-\_\-push} (void($\ast$cb)(\hyperlink{kvredis_8c_ae57432c0a6ac48a50457815dab2c5b4c}{lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$, P\-Gresult $\ast$), void($\ast$ecb)(), char $\ast$fmt,...)
\begin{DoxyCompactList}\small\item\em Place a query on the queue. \end{DoxyCompactList}\item 
pthread\-\_\-t $\ast$ \hyperlink{pgpmac_8h_a80df49750b61bb2526618db4253fc4ce}{lspg\-\_\-run} ()
\begin{DoxyCompactList}\small\item\em Start 'er runnin'. \end{DoxyCompactList}\item 
int \hyperlink{pgpmac_8h_a5d3cf153b086f5252f248d17db824917}{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-all} (long long skey, double \hyperlink{pgpmac_8h_a0be79ccb7ebf3a665248fd856112b9fd}{kappa}, double \hyperlink{pgpmac_8h_ac8070dc568ad974a3db42b51eca828cc}{phi}, double cx, double cy, double ax, double ay, double az)
\begin{DoxyCompactList}\small\item\em Convinence function to call seq run prep. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_af72c4b037347737df09348ab703f6802}{lspg\-\_\-starttransfer\-\_\-call} (unsigned int nextsample, int \hyperlink{pgpmac_8h_ac59ab990e48033a811aeb0281fb588fc}{sample\-\_\-detected}, double ax, double ay, double az, double horz, double vert, double esttime)
\item 
void \hyperlink{pgpmac_8h_ad989179281d8b65b940250a4580007d0}{lspg\-\_\-starttransfer\-\_\-done} ()
\item 
void \hyperlink{pgpmac_8h_a189e9fd5cbc06dd09e5549f6e229fa5e}{lspg\-\_\-starttransfer\-\_\-wait} ()
\item 
int \hyperlink{pgpmac_8h_a68d367d98c780a95b2c347d09e9ddec3}{lspg\-\_\-waitcryo\-\_\-all} ()
\begin{DoxyCompactList}\small\item\em no need to get fancy with the wait cryo command It should not return until the robot is almost ready for air rights \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_a7497a7c924b31c727ea487a3efb77fb6}{lspg\-\_\-waitcryo\-\_\-cb} (\hyperlink{kvredis_8c_ae57432c0a6ac48a50457815dab2c5b4c}{lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$qqp, P\-Gresult $\ast$pgr)
\item 
void \hyperlink{pgpmac_8h_a95e3fd7c1685d7e6ab6d0a295ab42f78}{lspg\-\_\-zoom\-\_\-lut\-\_\-call} ()
\item 
int \hyperlink{pgpmac_8h_ac4bf3a54deeaeb6e93dc3183388ad104}{lspmac\-\_\-get\-B\-I\-Position} (\hyperlink{pgpmac_8h_ac48984832ef73cf145e5f08bc65bd3a0}{lspmac\-\_\-bi\-\_\-t} $\ast$)
\begin{DoxyCompactList}\small\item\em get binary input value \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_a9fbadf816a842c8f131cf8ee47b54e29}{lspmac\-\_\-home1\-\_\-queue} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$mp)
\begin{DoxyCompactList}\small\item\em Home the motor. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_a43e54631dc8de372854ebbb63ff28f70}{lspmac\-\_\-home2\-\_\-queue} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$mp)
\begin{DoxyCompactList}\small\item\em Second stage of homing. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_a85f7a5e4d853b7a86ddde1006dd4dc1f}{lspmac\-\_\-abort} ()
\begin{DoxyCompactList}\small\item\em abort motion and try to recover \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_aca5a35903f027178fd9698a5a10537e7}{lspmac\-\_\-spin} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$)
\item 
void \hyperlink{pgpmac_8h_ae3e30b0ba9b5d5a291fa29b77ba920d8}{lspmac\-\_\-init} (int, int)
\begin{DoxyCompactList}\small\item\em Initialize this module. \end{DoxyCompactList}\item 
int \hyperlink{pgpmac_8h_ae2df697311878e1b93d1b26169ff06fc}{lspmac\-\_\-jogabs\-\_\-queue} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$, double)
\begin{DoxyCompactList}\small\item\em Use jog to move motor to requested position. \end{DoxyCompactList}\item 
int \hyperlink{pgpmac_8h_a565d1106e02cd035deacf10395ddefb9}{lspmac\-\_\-move\-\_\-or\-\_\-jog\-\_\-abs\-\_\-queue} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$mp, double requested\-\_\-position, int use\-\_\-jo)
\begin{DoxyCompactList}\small\item\em Move method for normal stepper and servo motor objects Returns non-\/zero on abort, zero if O\-K. \end{DoxyCompactList}\item 
int \hyperlink{pgpmac_8h_a763ce40da7c28bc54a8b1a85199a7914}{lspmac\-\_\-move\-\_\-or\-\_\-jog\-\_\-preset\-\_\-queue} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$, char $\ast$, int)
\begin{DoxyCompactList}\small\item\em move using a preset value returns 0 on success, non-\/zero on error \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_a6809c317931c4af226e0a0217764afae}{lspmac\-\_\-move\-\_\-or\-\_\-jog\-\_\-queue} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$, double, int)
\item 
int \hyperlink{pgpmac_8h_acd26454acc150847b01717f60f956674}{lspmac\-\_\-move\-\_\-preset\-\_\-queue} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$mp, char $\ast$preset\-\_\-name)
\begin{DoxyCompactList}\small\item\em Move a given motor to one of its preset positions. \end{DoxyCompactList}\item 
int \hyperlink{pgpmac_8h_a24786013266b84cba5abae6503c77f02}{lspmac\-\_\-moveabs\-\_\-queue} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$, double)
\begin{DoxyCompactList}\small\item\em Use coordinate system motion program, if available, to move motor to requested position. \end{DoxyCompactList}\item 
int \hyperlink{pgpmac_8h_a750a7a4f3b02365877979e4f3e06ce7e}{lspmac\-\_\-moveabs\-\_\-wait} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$mp, double timeout)
\begin{DoxyCompactList}\small\item\em Wait for motor to finish moving. \end{DoxyCompactList}\item 
pthread\-\_\-t $\ast$ \hyperlink{pgpmac_8h_a7101ae7b7aad35767a1d6a7093138bd4}{lspmac\-\_\-run} ()
\begin{DoxyCompactList}\small\item\em Start up the lspmac thread. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_aa8bf745a9ec388783009e2275a8b56f8}{lspmac\-\_\-video\-\_\-rotate} (double secs)
\begin{DoxyCompactList}\small\item\em Special motion program to collect centering video. \end{DoxyCompactList}\item 
int \hyperlink{pgpmac_8h_ac356cd43e46799929242dcf5214df7f6}{lsredis\-\_\-cmpnstr} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p, char $\ast$s, int n)
\item 
int \hyperlink{pgpmac_8h_a9fc8fd0db4c71c5eae68682b43103078}{lsredis\-\_\-cmpstr} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p, char $\ast$s)
\item 
int \hyperlink{pgpmac_8h_a1ad60526a09ca679f39174ce5d773abe}{lsredis\-\_\-find\-\_\-preset} (char $\ast$base, char $\ast$preset\-\_\-name, double $\ast$dval)
\begin{DoxyCompactList}\small\item\em Get the value of the given preset and return it in dval Returns 0 on error, non-\/zero on success;. \end{DoxyCompactList}\item 
int \hyperlink{pgpmac_8h_abbb4e5ece19ebd130e1be18036752a08}{lsredis\-\_\-getb} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p)
\item 
double \hyperlink{pgpmac_8h_aa8daf63b794b6b6341018feec205cb7d}{lsredis\-\_\-getd} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p)
\item 
void \hyperlink{pgpmac_8h_a4a7466a8c5b90df6dfc78aef625220f4}{lsredis\-\_\-init} ()
\begin{DoxyCompactList}\small\item\em Initialize this module, that is, set up the connections. \end{DoxyCompactList}\item 
int \hyperlink{pgpmac_8h_ac58fca47533e695c8775e0d2b9128766}{lsredis\-\_\-regexec} (const regex\-\_\-t $\ast$preg, \hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p, size\-\_\-t nmatch, regmatch\-\_\-t $\ast$pmatch, int eflags)
\item 
pthread\-\_\-t $\ast$ \hyperlink{pgpmac_8h_ac3db3d5f91bf5723bd94748ce0d88731}{lsredis\-\_\-run} ()
\item 
void \hyperlink{pgpmac_8h_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\-\_\-setstr} (\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$p, char $\ast$fmt,...)
\begin{DoxyCompactList}\small\item\em Set the value and update redis. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_a264897effdf49ed8d5aa34e8ed05c2d3}{lstimer\-\_\-set\-\_\-timer} (char $\ast$, int, unsigned long int, unsigned long int)
\begin{DoxyCompactList}\small\item\em Create a timer. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_a5738e4146b4691aad038b622b0381cac}{lstimer\-\_\-unset\-\_\-timer} (char $\ast$event)
\begin{DoxyCompactList}\small\item\em Unsets all timers for the given event. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_a8cd37a8fb0f061456456a5d79bdd5189}{lstimer\-\_\-init} ()
\begin{DoxyCompactList}\small\item\em Initialize the timer list and pthread stuff. \end{DoxyCompactList}\item 
pthread\-\_\-t $\ast$ \hyperlink{pgpmac_8h_aa9fdc057e219c162d67c5cb77a2bf7a4}{lstimer\-\_\-run} ()
\begin{DoxyCompactList}\small\item\em Start up our thread. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_adf63440ffbc65024fef87ea6a11ea8b0}{lsupdate\-\_\-init} ()
\item 
pthread\-\_\-t $\ast$ \hyperlink{pgpmac_8h_aebca330b67b5150d8fd5ae57bec80bf6}{lsupdate\-\_\-run} ()
\item 
void \hyperlink{pgpmac_8h_a0851b1baecda6a67993efde41d77b1c1}{md2cmds\-\_\-init} ()
\begin{DoxyCompactList}\small\item\em Initialize the md2cmds module. \end{DoxyCompactList}\item 
pthread\-\_\-t $\ast$ \hyperlink{pgpmac_8h_abc5270ece18fe48a49947378438049cf}{md2cmds\-\_\-run} ()
\begin{DoxyCompactList}\small\item\em Start up the thread. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_a7762ca7b97b44b979e23ce88ca3b4249}{pgpmac\-\_\-printf} (char $\ast$fmt,...)
\begin{DoxyCompactList}\small\item\em Terminal output routine ala printf. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_a7b84b6a923167d84c1aefbd2241864c3}{lstest\-\_\-main} ()
\item 
int \hyperlink{pgpmac_8h_a83ba40e81c04ecc11009be6cbed0c5e1}{lspmac\-\_\-est\-\_\-move\-\_\-time} (double $\ast$est\-\_\-time, int $\ast$mmask, \hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$mp\-\_\-1, int jog\-\_\-1, char $\ast$preset\-\_\-1, double end\-\_\-point\-\_\-1,...)
\begin{DoxyCompactList}\small\item\em Move the motors and estimate the time it'll take to finish the job. \end{DoxyCompactList}\item 
int \hyperlink{pgpmac_8h_a570b4a359adc4da4ab80d53506d06963}{lspmac\-\_\-est\-\_\-move\-\_\-time\-\_\-wait} (double move\-\_\-time, int cmask, \hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$mp\-\_\-1,...)
\begin{DoxyCompactList}\small\item\em wait for motion to stop returns non-\/zero if the wait timed out \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_ad4c059ab8209b87131b5c94883a05f39}{lsredis\-\_\-set\-\_\-preset} (char $\ast$base, char $\ast$preset\-\_\-name, double dval)
\begin{DoxyCompactList}\small\item\em set the given preset to the given value create a new preset if we can't find it \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_ac3fb8589e280bfa18ecbca6619fea637}{\-\_\-lsredis\-\_\-get\-\_\-obj} (char $\ast$key)
\begin{DoxyCompactList}\small\item\em Maybe add a new object Used internally for this module Must be called with lsredis\-\_\-mutex locked. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a22ef36819bdee963712691e660cfc101}{lspmac\-\_\-find\-\_\-motor\-\_\-by\-\_\-name} (char $\ast$name)
\item 
int \hyperlink{pgpmac_8h_adfe823e3ccec7e37ac4697179bd65b10}{lsredis\-\_\-find\-\_\-preset\-\_\-index\-\_\-by\-\_\-position} (\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$mp)
\begin{DoxyCompactList}\small\item\em For the given motor object return the index of the current preset or -\/1 if we are not at a preset position. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_a0575fc751cecf35ffe8b290ab483ac21}{lspmac\-\_\-\-Sock\-Send\-D\-P\-Control\-Char} (char $\ast$event, char c)
\begin{DoxyCompactList}\small\item\em use dpram ascii interface to send a control character \end{DoxyCompactList}\item 
int \hyperlink{pgpmac_8h_ad7cd6c8e4ea1132ac4a4b90e6468e2d6}{lspmac\-\_\-set\-\_\-motion\-\_\-flags} (int $\ast$mmaskp, \hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$mp\-\_\-1,...)
\begin{DoxyCompactList}\small\item\em Set the coordinate system motion flags (m5075) for the null terminated list of motors that we are planning on running a motion program with. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_af48b297b5679750a131fa1e982a078b7}{lsredis\-\_\-load\-\_\-presets} (char $\ast$motor\-\_\-name)
\begin{DoxyCompactList}\small\item\em update the presets hash table for the named motor \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_a6168e3ced6ec5fc80862d27002e4cd5b}{pgpmac\-\_\-request\-\_\-stay\-\_\-of\-\_\-execution} (int secs)
\begin{DoxyCompactList}\small\item\em Postpone the day of reckoning This assumes the quit\-\_\-cb routine is called once a second. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_ae2ecf1ddb756452728eba479f36b486b}{md2cmds\-\_\-push\-\_\-queue} (char $\ast$action)
\item 
\hyperlink{pgpmac_8h_a99c275e32ad897dca34d196b91f038cb}{pmac\-\_\-cmd\-\_\-queue\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a8707477f9799b4cc8c6f465ecfeee24b}{lspmac\-\_\-\-Sock\-Send\-Control\-Char\-Print} (char $\ast$event, char c)
\begin{DoxyCompactList}\small\item\em Send a control character. \end{DoxyCompactList}\item 
void \hyperlink{pgpmac_8h_aaabcee808dcf48a60898798a45516b68}{lsredis\-\_\-config} ()
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{pgpmac_8h_a779e2acce8b5e748c184caf23ed0db57}{lspg\-\_\-waitcryo\-\_\-t} \hyperlink{pgpmac_8h_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\-\_\-waitcryo}
\begin{DoxyCompactList}\small\item\em signal the robot \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_a7a794370785ff015d5ee035917e3bee8}{lspg\-\_\-getcurrentsampleid\-\_\-t} \hyperlink{pgpmac_8h_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\-\_\-getcurrentsampleid}
\begin{DoxyCompactList}\small\item\em our currentsample id \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_a7f71abc6fdfd1839e2e3213d78aaf766}{lspg\-\_\-demandairrights\-\_\-t} \hyperlink{pgpmac_8h_adf89a0299edd6a99992b95dff8992eba}{lspg\-\_\-demandairrights}
\begin{DoxyCompactList}\small\item\em our demandairrights object \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_a48b627e412dd038c1f17cdb0501eec33}{lspg\-\_\-getcenter\-\_\-t} \hyperlink{pgpmac_8h_a7ef8a09203117578c9b2ce4719519f36}{lspg\-\_\-getcenter}
\begin{DoxyCompactList}\small\item\em the getcenter object \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa1f0e602ae9509005c62fb2d73bc1c5a}{lspg\-\_\-starttransfer\-\_\-t} \hyperlink{pgpmac_8h_af18499d17171eff473cfc49d4a0a5562}{lspg\-\_\-starttransfer}
\begin{DoxyCompactList}\small\item\em start a sample transfer \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_a9dda9014cd0e39fba8d523e37cf9f982}{lspg\-\_\-nextsample\-\_\-t} \hyperlink{pgpmac_8h_adbf70f382e469e02dce77833981f9547}{lspg\-\_\-nextsample}
\begin{DoxyCompactList}\small\item\em the very next sample \end{DoxyCompactList}\item 
int \hyperlink{pgpmac_8h_ae002f31c03cce9bf96cf0e0c2907cb2b}{pgpmac\-\_\-use\-\_\-pg}
\begin{DoxyCompactList}\small\item\em non-\/zero to start up lspg thread, 0 to not (reids hash P\-G in config.\-H\-O\-S\-T\-N\-A\-M\-E sets this) \end{DoxyCompactList}\item 
int \hyperlink{pgpmac_8h_ad163e2bc6ebe322058c113dee76c11ff}{pgpmac\-\_\-use\-\_\-autoscint}
\begin{DoxyCompactList}\small\item\em non-\/zero to automatically move the alignment stage when the scintillator moves (redis hash A\-U\-T\-O\-S\-C\-I\-N\-T in config.\-H\-O\-S\-T\-N\-A\-M\-E sets this) \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_a17ea2bf07a0b3b892baa00bd392607b3}{lspg\-\_\-nextshot\-\_\-t} \hyperlink{pgpmac_8h_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\-\_\-nextshot}
\begin{DoxyCompactList}\small\item\em the nextshot object \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} \hyperlink{pgpmac_8h_aebfce5f9cbc8ba7bd4e2ee4880f303e8}{lspmac\-\_\-motors} \mbox{[}$\,$\mbox{]}
\begin{DoxyCompactList}\small\item\em All our motors. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a8237e646ce032a840637a4ef7bff49b9}{omega}
\begin{DoxyCompactList}\small\item\em M\-D2 omega axis (the air bearing) \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a6cb218bdccfe5a93471c161f15a15cab}{alignx}
\begin{DoxyCompactList}\small\item\em Alignment stage X. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a737c246c3948e644a18d191a931e1acd}{aligny}
\begin{DoxyCompactList}\small\item\em Alignment stage Y. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_ae7642b1da0f7c7f8448104c691d40a12}{alignz}
\begin{DoxyCompactList}\small\item\em Alignment stage X. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_aa90d2363b744acbd4d45133b7a716d8f}{anal}
\begin{DoxyCompactList}\small\item\em Polaroid analyzer motor. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_ad53a42cfaa04eff0336a44c8c9986333}{zoom}
\begin{DoxyCompactList}\small\item\em Optical zoom. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a139200ddaa9856a7ffcec0e6cbaa8f1b}{apery}
\begin{DoxyCompactList}\small\item\em Aperture Y. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_ab93bd6ee850b285ca3a95e64d15e9477}{aperz}
\begin{DoxyCompactList}\small\item\em Aperture Z. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a51358daaea8b5236f08414877d8af6c2}{capy}
\begin{DoxyCompactList}\small\item\em Capillary Y. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_aa45f268d0af9f3d465acfab128919718}{capz}
\begin{DoxyCompactList}\small\item\em Capillary Z. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a589431b3a79c21c251fcb97cc9126991}{scint}
\begin{DoxyCompactList}\small\item\em Scintillator Z. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_ac940d950d9efeaf3f0ae67e9bf331188}{cenx}
\begin{DoxyCompactList}\small\item\em Centering Table X. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_aaed18e738ba7bfb6c771a44f5d7ea827}{ceny}
\begin{DoxyCompactList}\small\item\em Centering Table Y. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a0be79ccb7ebf3a665248fd856112b9fd}{kappa}
\begin{DoxyCompactList}\small\item\em Kappa. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_ac8070dc568ad974a3db42b51eca828cc}{phi}
\begin{DoxyCompactList}\small\item\em Phi (not data collection axis) \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a26dec4623af9beed912b8e7e6f99822c}{fshut}
\begin{DoxyCompactList}\small\item\em Fast shutter. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_aeb09895663eff333b7a75acb319a9fc1}{flight}
\begin{DoxyCompactList}\small\item\em Front Light D\-A\-C. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a85d6eaa4b4a82bb3112574f458d1dc50}{blight}
\begin{DoxyCompactList}\small\item\em Back Light D\-A\-C. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a8a3ca6fcf5e24dcc26170736843e53b2}{fscint}
\begin{DoxyCompactList}\small\item\em Scintillator Piezo D\-A\-C. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_abee73a0d9e5f3af9eb88d5cfd6b953c3}{smart\-\_\-mag\-\_\-oo}
\begin{DoxyCompactList}\small\item\em Smart Magnet on/off. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_af813a2eff0b7efa4c70633559054e84c}{blight\-\_\-ud}
\begin{DoxyCompactList}\small\item\em Back light Up/\-Down actuator. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_ae78d9a757d4c85419fff9c94b15e25d7}{cryo}
\begin{DoxyCompactList}\small\item\em Move the cryostream towards or away from the crystal. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a9d9c5030d817483ca9518027c91adac4}{dryer}
\begin{DoxyCompactList}\small\item\em blow air on the scintilator to dry it off \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_addb26c80065506faa1de3c1b468fe03f}{fluo}
\begin{DoxyCompactList}\small\item\em Move the fluorescence detector in/out. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a6630442dc65ce8a30a24ed718b301971}{flight\-\_\-oo}
\begin{DoxyCompactList}\small\item\em Turn front light on/off. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_af55c51d52c4586b647114f95d7ac1f42}{blight\-\_\-f}
\begin{DoxyCompactList}\small\item\em Back light scale factor. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{lspmac\-\_\-motor\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_aabf4ec595b5183c1777d029ca56134b0}{flight\-\_\-f}
\begin{DoxyCompactList}\small\item\em Front light scale factor. \end{DoxyCompactList}\item 
int \hyperlink{pgpmac_8h_a56260f012c50a591ee7f97e500f16994}{lspmac\-\_\-nmotors}
\begin{DoxyCompactList}\small\item\em The number of motors we manage. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_ac48984832ef73cf145e5f08bc65bd3a0}{lspmac\-\_\-bi\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_aade15098d213bb25522048e4a231941a}{lp\-\_\-air}
\begin{DoxyCompactList}\small\item\em Low pressure air O\-K. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_ac48984832ef73cf145e5f08bc65bd3a0}{lspmac\-\_\-bi\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_abb29b117ad38156ba16fcf44eeb427af}{hp\-\_\-air}
\begin{DoxyCompactList}\small\item\em High pressure air O\-K. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_ac48984832ef73cf145e5f08bc65bd3a0}{lspmac\-\_\-bi\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a28df32fd6be9160603aa1bb74a823574}{cryo\-\_\-switch}
\begin{DoxyCompactList}\small\item\em that little toggle switch for the cryo \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_ac48984832ef73cf145e5f08bc65bd3a0}{lspmac\-\_\-bi\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_ac0d0bc95bcbcbd154b30c72a9645c8b2}{blight\-\_\-down}
\begin{DoxyCompactList}\small\item\em Backlight is down. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_ac48984832ef73cf145e5f08bc65bd3a0}{lspmac\-\_\-bi\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a7fba65f6555c5c7908852c6cf1ad0c94}{blight\-\_\-up}
\begin{DoxyCompactList}\small\item\em Backlight is up. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_ac48984832ef73cf145e5f08bc65bd3a0}{lspmac\-\_\-bi\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a871d4cdea0a1a8db85b8658a07655212}{cryo\-\_\-back}
\begin{DoxyCompactList}\small\item\em cryo is in the back position \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_ac48984832ef73cf145e5f08bc65bd3a0}{lspmac\-\_\-bi\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a67092de6f3fcc0b245e4970437eaff6b}{fluor\-\_\-back}
\begin{DoxyCompactList}\small\item\em fluor is in the back position \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_ac48984832ef73cf145e5f08bc65bd3a0}{lspmac\-\_\-bi\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_ac59ab990e48033a811aeb0281fb588fc}{sample\-\_\-detected}
\begin{DoxyCompactList}\small\item\em smart magnet detected sample \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_ac48984832ef73cf145e5f08bc65bd3a0}{lspmac\-\_\-bi\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a5538a6aa526eeed65ff237303da2d348}{etel\-\_\-ready}
\begin{DoxyCompactList}\small\item\em E\-T\-E\-L is ready. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_ac48984832ef73cf145e5f08bc65bd3a0}{lspmac\-\_\-bi\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_ab48d4a2cf0225796db9aad49f034dc59}{etel\-\_\-on}
\begin{DoxyCompactList}\small\item\em E\-T\-E\-L is on. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_ac48984832ef73cf145e5f08bc65bd3a0}{lspmac\-\_\-bi\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a1e690d4ad981d020ea2c850282dca3be}{etel\-\_\-init\-\_\-ok}
\begin{DoxyCompactList}\small\item\em E\-T\-E\-L initialized O\-K. \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_ac48984832ef73cf145e5f08bc65bd3a0}{lspmac\-\_\-bi\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_ab552f2e28dd9cccefafe01f27717101b}{minikappa\-\_\-ok}
\begin{DoxyCompactList}\small\item\em Minikappa is O\-K (whatever that means) \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_ac48984832ef73cf145e5f08bc65bd3a0}{lspmac\-\_\-bi\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a2dc6fa78bb6313fe8b696d646eaa2443}{smart\-\_\-mag\-\_\-on}
\begin{DoxyCompactList}\small\item\em smart magnet is on \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_ac48984832ef73cf145e5f08bc65bd3a0}{lspmac\-\_\-bi\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_afaff4fbb5f03b0d2469fc7a14f174d69}{arm\-\_\-parked}
\begin{DoxyCompactList}\small\item\em (whose arm? parked where?) \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_ac48984832ef73cf145e5f08bc65bd3a0}{lspmac\-\_\-bi\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_ae98a0792d6b4b96a33df0a31bdec6342}{shutter\-\_\-open}
\begin{DoxyCompactList}\small\item\em shutter is open (note in pmc says this is a slow input) \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_ac48984832ef73cf145e5f08bc65bd3a0}{lspmac\-\_\-bi\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a4892e918830dd12093d28c53a1c2df98}{smart\-\_\-mag\-\_\-off}
\begin{DoxyCompactList}\small\item\em smart magnet is off \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_ac48984832ef73cf145e5f08bc65bd3a0}{lspmac\-\_\-bi\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a37903ed8430ac4d9ead609a78eb62f32}{smart\-\_\-mag\-\_\-err}
\begin{DoxyCompactList}\small\item\em smart magnet error (coil broken perhaps) \end{DoxyCompactList}\item 
struct timespec \hyperlink{pgpmac_8h_ae6631a094accc469661805bdf80fc6d8}{omega\-\_\-zero\-\_\-time}
\begin{DoxyCompactList}\small\item\em Time we believe that omega crossed zero. \end{DoxyCompactList}\item 
W\-I\-N\-D\-O\-W $\ast$ \hyperlink{pgpmac_8h_a65daf0f4a5bc6def23a9df98ff5ca57e}{term\-\_\-output}
\begin{DoxyCompactList}\small\item\em place to print stuff out \end{DoxyCompactList}\item 
W\-I\-N\-D\-O\-W $\ast$ \hyperlink{pgpmac_8h_ab0487111dbe3c05d0bd835eb2fb9a3f7}{term\-\_\-input}
\begin{DoxyCompactList}\small\item\em place to put the cursor \end{DoxyCompactList}\item 
W\-I\-N\-D\-O\-W $\ast$ \hyperlink{pgpmac_8h_ae746a6903fb8a4ea216def88eccedc3c}{term\-\_\-status}
\begin{DoxyCompactList}\small\item\em shutter, lamp, air, etc status \end{DoxyCompactList}\item 
W\-I\-N\-D\-O\-W $\ast$ \hyperlink{pgpmac_8h_ae2d7da3afeb756716e6e4ee9cab78f8a}{term\-\_\-status2}
\begin{DoxyCompactList}\small\item\em shutter, lamp, air, etc status \end{DoxyCompactList}\item 
pthread\-\_\-mutex\-\_\-t \hyperlink{pgpmac_8h_ad128c64890c7c0d4f836d9ec6e99216a}{ncurses\-\_\-mutex}
\begin{DoxyCompactList}\small\item\em allow more than one thread access to the screen \end{DoxyCompactList}\item 
pthread\-\_\-cond\-\_\-t \hyperlink{pgpmac_8h_a08d5b18ec9478d753c46a3e28d1f2126}{md2cmds\-\_\-cond}
\begin{DoxyCompactList}\small\item\em condition to signal when it's time to run an md2 command \end{DoxyCompactList}\item 
pthread\-\_\-mutex\-\_\-t \hyperlink{pgpmac_8h_ad67304bb851dc6268b0cda2f40fc5aa8}{md2cmds\-\_\-mutex}
\begin{DoxyCompactList}\small\item\em mutex for the condition \end{DoxyCompactList}\item 
pthread\-\_\-cond\-\_\-t \hyperlink{pgpmac_8h_ab517a930528e2b7d0993e11087765b03}{md2cmds\-\_\-pg\-\_\-cond}
\item 
pthread\-\_\-mutex\-\_\-t \hyperlink{pgpmac_8h_a4d2c3ac81d4b13eb21f4ddcdda8c7308}{md2cmds\-\_\-pg\-\_\-mutex}
\item 
pthread\-\_\-mutex\-\_\-t \hyperlink{pgpmac_8h_acc1bb77b9bcbc4d970f841a41fd274b3}{pmac\-\_\-queue\-\_\-mutex}
\begin{DoxyCompactList}\small\item\em manage access to the pmac command queue \end{DoxyCompactList}\item 
pthread\-\_\-cond\-\_\-t \hyperlink{pgpmac_8h_a8a25bd9c593c6985107f90f999ce0b08}{pmac\-\_\-queue\-\_\-cond}
\begin{DoxyCompactList}\small\item\em wait for a command to be sent to P\-M\-A\-C before continuing \end{DoxyCompactList}\item 
pthread\-\_\-mutex\-\_\-t \hyperlink{pgpmac_8h_a1b78a13c654409333569815e1c109d38}{lspmac\-\_\-shutter\-\_\-mutex}
\begin{DoxyCompactList}\small\item\em Coordinates threads reading shutter status. \end{DoxyCompactList}\item 
pthread\-\_\-cond\-\_\-t \hyperlink{pgpmac_8h_afbd51c2cefcee87afe994c9e9f372241}{lspmac\-\_\-shutter\-\_\-cond}
\begin{DoxyCompactList}\small\item\em Allows waiting for the shutter status to change. \end{DoxyCompactList}\item 
int \hyperlink{pgpmac_8h_a112158e0cd50449a440ac55c7af7bea2}{lspmac\-\_\-shutter\-\_\-state}
\begin{DoxyCompactList}\small\item\em State of the shutter, used to detect changes. \end{DoxyCompactList}\item 
int \hyperlink{pgpmac_8h_a396fbf06208de3ecbe1b0df549f1cd46}{lspmac\-\_\-shutter\-\_\-has\-\_\-opened}
\begin{DoxyCompactList}\small\item\em Indicates that the shutter had opened, perhaps briefly even if the state did not change. \end{DoxyCompactList}\item 
pthread\-\_\-mutex\-\_\-t \hyperlink{pgpmac_8h_a85679cac947e199c88794f8e5a12bf5f}{lspmac\-\_\-moving\-\_\-mutex}
\begin{DoxyCompactList}\small\item\em Coordinate moving motors between threads. \end{DoxyCompactList}\item 
pthread\-\_\-cond\-\_\-t \hyperlink{pgpmac_8h_a57547d211906c981ef20257eba99f8df}{lspmac\-\_\-moving\-\_\-cond}
\begin{DoxyCompactList}\small\item\em Wait for motor(s) to finish moving condition. \end{DoxyCompactList}\item 
int \hyperlink{pgpmac_8h_a7a32c617c183166308241e270959df56}{lspmac\-\_\-moving\-\_\-flags}
\begin{DoxyCompactList}\small\item\em Flag used to implement motor moving condition. \end{DoxyCompactList}\item 
pthread\-\_\-mutex\-\_\-t \hyperlink{pgpmac_8h_a7a3e763682bd7f987d07f149e94b3bf8}{md2\-\_\-status\-\_\-mutex}
\begin{DoxyCompactList}\small\item\em Synchronize reading/writting status buffer. \end{DoxyCompactList}\item 
char \hyperlink{pgpmac_8h_a1ccf455563dc8d828558b6a230e164a6}{md2cmds\-\_\-cmd} \mbox{[}$\,$\mbox{]}
\begin{DoxyCompactList}\small\item\em our command; \end{DoxyCompactList}\item 
\hyperlink{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{lsredis\-\_\-obj\-\_\-t} $\ast$ \hyperlink{pgpmac_8h_a6a34fb6876abbd580629d3708c805e7f}{md2cmds\-\_\-md\-\_\-status\-\_\-code}
\item 
pthread\-\_\-mutex\-\_\-t \hyperlink{pgpmac_8h_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\-\_\-mutex}
\item 
pthread\-\_\-cond\-\_\-t \hyperlink{pgpmac_8h_a2f63408d16b5603541b124a78f36a5a8}{lsredis\-\_\-cond}
\item 
int \hyperlink{pgpmac_8h_a7461eb2b5974a2ffac2189007d39193c}{lsredis\-\_\-running}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Headers for the entire pgpmac project. \begin{DoxyDate}{Date}
2012 
\end{DoxyDate}
\begin{DoxyAuthor}{Author}
Keith Brister 
\end{DoxyAuthor}
\begin{DoxyCopyright}{Copyright}
All Rights Reserved 
\end{DoxyCopyright}


Definition in file \hyperlink{pgpmac_8h_source}{pgpmac.\-h}.



\subsection{Macro Definition Documentation}
\hypertarget{pgpmac_8h_a369266c24eacffb87046522897a570d5}{\index{pgpmac.\-h@{pgpmac.\-h}!\-\_\-\-G\-N\-U\-\_\-\-S\-O\-U\-R\-C\-E@{\-\_\-\-G\-N\-U\-\_\-\-S\-O\-U\-R\-C\-E}}
\index{\-\_\-\-G\-N\-U\-\_\-\-S\-O\-U\-R\-C\-E@{\-\_\-\-G\-N\-U\-\_\-\-S\-O\-U\-R\-C\-E}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{\-\_\-\-G\-N\-U\-\_\-\-S\-O\-U\-R\-C\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define \-\_\-\-G\-N\-U\-\_\-\-S\-O\-U\-R\-C\-E}}\label{pgpmac_8h_a369266c24eacffb87046522897a570d5}


Definition at line 7 of file pgpmac.\-h.

\hypertarget{pgpmac_8h_a3bae94e8e4e4347dd5f87b6bda058de6}{\index{pgpmac.\-h@{pgpmac.\-h}!L\-S\-\_\-\-D\-I\-S\-P\-L\-A\-Y\-\_\-\-W\-I\-N\-D\-O\-W\-\_\-\-H\-E\-I\-G\-H\-T@{L\-S\-\_\-\-D\-I\-S\-P\-L\-A\-Y\-\_\-\-W\-I\-N\-D\-O\-W\-\_\-\-H\-E\-I\-G\-H\-T}}
\index{L\-S\-\_\-\-D\-I\-S\-P\-L\-A\-Y\-\_\-\-W\-I\-N\-D\-O\-W\-\_\-\-H\-E\-I\-G\-H\-T@{L\-S\-\_\-\-D\-I\-S\-P\-L\-A\-Y\-\_\-\-W\-I\-N\-D\-O\-W\-\_\-\-H\-E\-I\-G\-H\-T}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{L\-S\-\_\-\-D\-I\-S\-P\-L\-A\-Y\-\_\-\-W\-I\-N\-D\-O\-W\-\_\-\-H\-E\-I\-G\-H\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-D\-I\-S\-P\-L\-A\-Y\-\_\-\-W\-I\-N\-D\-O\-W\-\_\-\-H\-E\-I\-G\-H\-T~8}}\label{pgpmac_8h_a3bae94e8e4e4347dd5f87b6bda058de6}


Number of status box rows. 



Definition at line 58 of file pgpmac.\-h.

\hypertarget{pgpmac_8h_a1f96754f00a1f82414cebc66f75ded78}{\index{pgpmac.\-h@{pgpmac.\-h}!L\-S\-\_\-\-D\-I\-S\-P\-L\-A\-Y\-\_\-\-W\-I\-N\-D\-O\-W\-\_\-\-W\-I\-D\-T\-H@{L\-S\-\_\-\-D\-I\-S\-P\-L\-A\-Y\-\_\-\-W\-I\-N\-D\-O\-W\-\_\-\-W\-I\-D\-T\-H}}
\index{L\-S\-\_\-\-D\-I\-S\-P\-L\-A\-Y\-\_\-\-W\-I\-N\-D\-O\-W\-\_\-\-W\-I\-D\-T\-H@{L\-S\-\_\-\-D\-I\-S\-P\-L\-A\-Y\-\_\-\-W\-I\-N\-D\-O\-W\-\_\-\-W\-I\-D\-T\-H}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{L\-S\-\_\-\-D\-I\-S\-P\-L\-A\-Y\-\_\-\-W\-I\-N\-D\-O\-W\-\_\-\-W\-I\-D\-T\-H}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-D\-I\-S\-P\-L\-A\-Y\-\_\-\-W\-I\-N\-D\-O\-W\-\_\-\-W\-I\-D\-T\-H~24}}\label{pgpmac_8h_a1f96754f00a1f82414cebc66f75ded78}


Number of status box columns. 



Definition at line 62 of file pgpmac.\-h.

\hypertarget{pgpmac_8h_a3a8ef1b4b5994d6dd12bf74454ea891b}{\index{pgpmac.\-h@{pgpmac.\-h}!L\-S\-\_\-\-P\-G\-\_\-\-Q\-U\-E\-R\-Y\-\_\-\-S\-T\-R\-I\-N\-G\-\_\-\-L\-E\-N\-G\-T\-H@{L\-S\-\_\-\-P\-G\-\_\-\-Q\-U\-E\-R\-Y\-\_\-\-S\-T\-R\-I\-N\-G\-\_\-\-L\-E\-N\-G\-T\-H}}
\index{L\-S\-\_\-\-P\-G\-\_\-\-Q\-U\-E\-R\-Y\-\_\-\-S\-T\-R\-I\-N\-G\-\_\-\-L\-E\-N\-G\-T\-H@{L\-S\-\_\-\-P\-G\-\_\-\-Q\-U\-E\-R\-Y\-\_\-\-S\-T\-R\-I\-N\-G\-\_\-\-L\-E\-N\-G\-T\-H}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{L\-S\-\_\-\-P\-G\-\_\-\-Q\-U\-E\-R\-Y\-\_\-\-S\-T\-R\-I\-N\-G\-\_\-\-L\-E\-N\-G\-T\-H}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-\_\-\-P\-G\-\_\-\-Q\-U\-E\-R\-Y\-\_\-\-S\-T\-R\-I\-N\-G\-\_\-\-L\-E\-N\-G\-T\-H~1024}}\label{pgpmac_8h_a3a8ef1b4b5994d6dd12bf74454ea891b}


Fixed length postgresql query strings. Queries should all be function calls so this is not as weird as one might think. 



Definition at line 65 of file pgpmac.\-h.

\hypertarget{pgpmac_8h_ab61d790b5572f116e091babfda53627b}{\index{pgpmac.\-h@{pgpmac.\-h}!L\-S\-E\-V\-E\-N\-T\-S\-\_\-\-E\-V\-E\-N\-T\-\_\-\-L\-E\-N\-G\-T\-H@{L\-S\-E\-V\-E\-N\-T\-S\-\_\-\-E\-V\-E\-N\-T\-\_\-\-L\-E\-N\-G\-T\-H}}
\index{L\-S\-E\-V\-E\-N\-T\-S\-\_\-\-E\-V\-E\-N\-T\-\_\-\-L\-E\-N\-G\-T\-H@{L\-S\-E\-V\-E\-N\-T\-S\-\_\-\-E\-V\-E\-N\-T\-\_\-\-L\-E\-N\-G\-T\-H}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{L\-S\-E\-V\-E\-N\-T\-S\-\_\-\-E\-V\-E\-N\-T\-\_\-\-L\-E\-N\-G\-T\-H}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-E\-V\-E\-N\-T\-S\-\_\-\-E\-V\-E\-N\-T\-\_\-\-L\-E\-N\-G\-T\-H~256}}\label{pgpmac_8h_ab61d790b5572f116e091babfda53627b}


Fixed length for event names\-: simplifies string handling. 



Definition at line 68 of file pgpmac.\-h.

\hypertarget{pgpmac_8h_abe2a74d23400d8d8fe02dc407c242035}{\index{pgpmac.\-h@{pgpmac.\-h}!L\-S\-P\-M\-A\-C\-\_\-\-M\-A\-G\-I\-C\-\_\-\-N\-U\-M\-B\-E\-R@{L\-S\-P\-M\-A\-C\-\_\-\-M\-A\-G\-I\-C\-\_\-\-N\-U\-M\-B\-E\-R}}
\index{L\-S\-P\-M\-A\-C\-\_\-\-M\-A\-G\-I\-C\-\_\-\-N\-U\-M\-B\-E\-R@{L\-S\-P\-M\-A\-C\-\_\-\-M\-A\-G\-I\-C\-\_\-\-N\-U\-M\-B\-E\-R}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{L\-S\-P\-M\-A\-C\-\_\-\-M\-A\-G\-I\-C\-\_\-\-N\-U\-M\-B\-E\-R}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\-S\-P\-M\-A\-C\-\_\-\-M\-A\-G\-I\-C\-\_\-\-N\-U\-M\-B\-E\-R~0x9700436}}\label{pgpmac_8h_abe2a74d23400d8d8fe02dc407c242035}


Definition at line 97 of file pgpmac.\-h.

\hypertarget{pgpmac_8h_a30f0f377b0f0695284145d420ea51846}{\index{pgpmac.\-h@{pgpmac.\-h}!M\-D2\-C\-M\-D\-S\-\_\-\-C\-M\-D\-\_\-\-L\-E\-N\-G\-T\-H@{M\-D2\-C\-M\-D\-S\-\_\-\-C\-M\-D\-\_\-\-L\-E\-N\-G\-T\-H}}
\index{M\-D2\-C\-M\-D\-S\-\_\-\-C\-M\-D\-\_\-\-L\-E\-N\-G\-T\-H@{M\-D2\-C\-M\-D\-S\-\_\-\-C\-M\-D\-\_\-\-L\-E\-N\-G\-T\-H}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{M\-D2\-C\-M\-D\-S\-\_\-\-C\-M\-D\-\_\-\-L\-E\-N\-G\-T\-H}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\-D2\-C\-M\-D\-S\-\_\-\-C\-M\-D\-\_\-\-L\-E\-N\-G\-T\-H~32}}\label{pgpmac_8h_a30f0f377b0f0695284145d420ea51846}


Definition at line 508 of file pgpmac.\-h.



\subsection{Typedef Documentation}
\hypertarget{pgpmac_8h_a7f71abc6fdfd1839e2e3213d78aaf766}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-demandairrights\-\_\-t@{lspg\-\_\-demandairrights\-\_\-t}}
\index{lspg\-\_\-demandairrights\-\_\-t@{lspg\-\_\-demandairrights\-\_\-t}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-demandairrights\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf lspg\-\_\-demandairrights\-\_\-struct}  {\bf lspg\-\_\-demandairrights\-\_\-t}}}\label{pgpmac_8h_a7f71abc6fdfd1839e2e3213d78aaf766}
\hypertarget{pgpmac_8h_a48b627e412dd038c1f17cdb0501eec33}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-getcenter\-\_\-t@{lspg\-\_\-getcenter\-\_\-t}}
\index{lspg\-\_\-getcenter\-\_\-t@{lspg\-\_\-getcenter\-\_\-t}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-getcenter\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf lspg\-\_\-getcenter\-\_\-struct}  {\bf lspg\-\_\-getcenter\-\_\-t}}}\label{pgpmac_8h_a48b627e412dd038c1f17cdb0501eec33}


Storage for getcenter query Used for the md2 R\-O\-T\-A\-T\-E command that generates the centering movies. 

\hypertarget{pgpmac_8h_a7a794370785ff015d5ee035917e3bee8}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-getcurrentsampleid\-\_\-t@{lspg\-\_\-getcurrentsampleid\-\_\-t}}
\index{lspg\-\_\-getcurrentsampleid\-\_\-t@{lspg\-\_\-getcurrentsampleid\-\_\-t}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-getcurrentsampleid\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf lspg\-\_\-getcurrentsampleid\-\_\-struct}  {\bf lspg\-\_\-getcurrentsampleid\-\_\-t}}}\label{pgpmac_8h_a7a794370785ff015d5ee035917e3bee8}
\hypertarget{pgpmac_8h_a9dda9014cd0e39fba8d523e37cf9f982}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-nextsample\-\_\-t@{lspg\-\_\-nextsample\-\_\-t}}
\index{lspg\-\_\-nextsample\-\_\-t@{lspg\-\_\-nextsample\-\_\-t}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-nextsample\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf lspg\-\_\-nextsample\-\_\-struct}  {\bf lspg\-\_\-nextsample\-\_\-t}}}\label{pgpmac_8h_a9dda9014cd0e39fba8d523e37cf9f982}


Returns the next sample number Just a 32 bit int (Ha!, take that, nextshot!) 

\hypertarget{pgpmac_8h_a17ea2bf07a0b3b892baa00bd392607b3}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-nextshot\-\_\-t@{lspg\-\_\-nextshot\-\_\-t}}
\index{lspg\-\_\-nextshot\-\_\-t@{lspg\-\_\-nextshot\-\_\-t}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-nextshot\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf lspg\-\_\-nextshot\-\_\-struct}  {\bf lspg\-\_\-nextshot\-\_\-t}}}\label{pgpmac_8h_a17ea2bf07a0b3b892baa00bd392607b3}


Storage definition for nextshot query. 

The next shot query returns all the information needed to collect the next data frame. Since S\-Q\-L allows for null fields independently from blank strings a separate integer is used as a flag for this case. This adds to the program complexity but allows for some important cases. Suck it up.\-definition of the next image to be taken (and the one after that, too!) \hypertarget{pgpmac_8h_ae57432c0a6ac48a50457815dab2c5b4c}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-query\-\_\-queue\-\_\-t@{lspg\-\_\-query\-\_\-queue\-\_\-t}}
\index{lspg\-\_\-query\-\_\-queue\-\_\-t@{lspg\-\_\-query\-\_\-queue\-\_\-t}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-query\-\_\-queue\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf lspg\-Query\-Queue\-Struct}  {\bf lspg\-\_\-query\-\_\-queue\-\_\-t}}}\label{pgpmac_8h_ae57432c0a6ac48a50457815dab2c5b4c}


Store each query along with it's callback function. 

All calls are asynchronous \hypertarget{pgpmac_8h_aa1f0e602ae9509005c62fb2d73bc1c5a}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-starttransfer\-\_\-t@{lspg\-\_\-starttransfer\-\_\-t}}
\index{lspg\-\_\-starttransfer\-\_\-t@{lspg\-\_\-starttransfer\-\_\-t}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-starttransfer\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf lspg\-\_\-starttransfer\-\_\-struct}  {\bf lspg\-\_\-starttransfer\-\_\-t}}}\label{pgpmac_8h_aa1f0e602ae9509005c62fb2d73bc1c5a}


returns 1 if transfer can continue 0 to abort 

\hypertarget{pgpmac_8h_a779e2acce8b5e748c184caf23ed0db57}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-waitcryo\-\_\-t@{lspg\-\_\-waitcryo\-\_\-t}}
\index{lspg\-\_\-waitcryo\-\_\-t@{lspg\-\_\-waitcryo\-\_\-t}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-waitcryo\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf lspg\-\_\-waitcryo\-\_\-struct}  {\bf lspg\-\_\-waitcryo\-\_\-t}}}\label{pgpmac_8h_a779e2acce8b5e748c184caf23ed0db57}
\hypertarget{pgpmac_8h_ac48984832ef73cf145e5f08bc65bd3a0}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-bi\-\_\-t@{lspmac\-\_\-bi\-\_\-t}}
\index{lspmac\-\_\-bi\-\_\-t@{lspmac\-\_\-bi\-\_\-t}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-bi\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf lspmac\-\_\-bi\-\_\-struct}  {\bf lspmac\-\_\-bi\-\_\-t}}}\label{pgpmac_8h_ac48984832ef73cf145e5f08bc65bd3a0}


Storage for binary inputs. 

\hypertarget{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-motor\-\_\-t@{lspmac\-\_\-motor\-\_\-t}}
\index{lspmac\-\_\-motor\-\_\-t@{lspmac\-\_\-motor\-\_\-t}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-motor\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf lspmac\-\_\-motor\-\_\-struct}  {\bf lspmac\-\_\-motor\-\_\-t}}}\label{pgpmac_8h_aa5067fcbaabc5bbfdc52492495518c96}


Motor information. 

A catchall for motors and motor like objects. Not all members are used by all objects. \hypertarget{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}{\index{pgpmac.\-h@{pgpmac.\-h}!lsredis\-\_\-obj\-\_\-t@{lsredis\-\_\-obj\-\_\-t}}
\index{lsredis\-\_\-obj\-\_\-t@{lsredis\-\_\-obj\-\_\-t}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsredis\-\_\-obj\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf lsredis\-\_\-obj\-\_\-struct}  {\bf lsredis\-\_\-obj\-\_\-t}}}\label{pgpmac_8h_ad449de06d02791adf2498d2a1e1f909c}


Redis Object Basic object whose value is sychronized with our redis db. 

\hypertarget{pgpmac_8h_a99c275e32ad897dca34d196b91f038cb}{\index{pgpmac.\-h@{pgpmac.\-h}!pmac\-\_\-cmd\-\_\-queue\-\_\-t@{pmac\-\_\-cmd\-\_\-queue\-\_\-t}}
\index{pmac\-\_\-cmd\-\_\-queue\-\_\-t@{pmac\-\_\-cmd\-\_\-queue\-\_\-t}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{pmac\-\_\-cmd\-\_\-queue\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf lspmac\-\_\-cmd\-\_\-queue\-\_\-struct}  {\bf pmac\-\_\-cmd\-\_\-queue\-\_\-t}}}\label{pgpmac_8h_a99c275e32ad897dca34d196b91f038cb}


P\-M\-A\-C command queue item. 

Command queue items are fixed length to simplify memory management. \hypertarget{pgpmac_8h_a2d163436571135a457f4a4e2fbd09633}{\index{pgpmac.\-h@{pgpmac.\-h}!pmac\-\_\-cmd\-\_\-t@{pmac\-\_\-cmd\-\_\-t}}
\index{pmac\-\_\-cmd\-\_\-t@{pmac\-\_\-cmd\-\_\-t}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{pmac\-\_\-cmd\-\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf tag\-Ethernet\-Cmd}  {\bf pmac\-\_\-cmd\-\_\-t}}}\label{pgpmac_8h_a2d163436571135a457f4a4e2fbd09633}


P\-M\-A\-C ethernet packet definition. 

Taken directly from the Delta Tau documentation. 

\subsection{Function Documentation}
\hypertarget{pgpmac_8h_ac3fb8589e280bfa18ecbca6619fea637}{\index{pgpmac.\-h@{pgpmac.\-h}!\-\_\-lsredis\-\_\-get\-\_\-obj@{\-\_\-lsredis\-\_\-get\-\_\-obj}}
\index{\-\_\-lsredis\-\_\-get\-\_\-obj@{\-\_\-lsredis\-\_\-get\-\_\-obj}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{\-\_\-lsredis\-\_\-get\-\_\-obj}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lsredis\-\_\-obj\-\_\-t}$\ast$ \-\_\-lsredis\-\_\-get\-\_\-obj (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{key}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_ac3fb8589e280bfa18ecbca6619fea637}


Maybe add a new object Used internally for this module Must be called with lsredis\-\_\-mutex locked. 



Definition at line 544 of file lsredis.\-c.


\begin{DoxyCode}
                                            \{
  \hyperlink{structlsredis__obj__struct}{lsredis\_obj\_t} *\hyperlink{namespacemk__pgpmac__redis_a11daf2847f2dc94562b5b61b3f412574}{p};
  regmatch\_t pmatch[2];
  \textcolor{keywordtype}{int} err;
  ENTRY htab\_input, *htab\_output;

  \textcolor{comment}{// Dispense with obviously bad keys straight away}
  \textcolor{comment}{// unless p->valid == 0 in which case we call HGET first}
  \textcolor{comment}{//}
  \textcolor{comment}{// TODO: review logic: is there ever a time when valid is zero for a
       preexisting p and HGET has not been called?}
  \textcolor{comment}{//       If not then we should just return p without checking for validity.}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( key == NULL || *key == 0 || strchr( key, \textcolor{charliteral}{' '}) != NULL) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"\_lsredis\_get\_obj: bad key '%s'
      "}, key == NULL ? \textcolor{stringliteral}{"<NULL>"} : key);
    \textcolor{keywordflow}{return} NULL;
  \}

  \textcolor{comment}{// If the key is already there then just return it}
  \textcolor{comment}{//}

  htab\_input.key  = key;
  htab\_input.data = NULL;
  errno = 0;
  err = hsearch\_r( htab\_input, FIND, &htab\_output, &\hyperlink{lsredis_8c_a42aec6aa74072797ec0344847b0e9e39}{lsredis\_htab});

  \textcolor{keywordflow}{if}( err == 0)
    p = NULL;
  \textcolor{keywordflow}{else}
    p = htab\_output->data;


  \textcolor{keywordflow}{if}( p != NULL) \{
    \textcolor{keywordflow}{return} \hyperlink{namespacemk__pgpmac__redis_a11daf2847f2dc94562b5b61b3f412574}{p};
  \} \textcolor{keywordflow}{else} \{
    \textcolor{comment}{// make a new one.}
    p = calloc( 1, \textcolor{keyword}{sizeof}( \hyperlink{structlsredis__obj__struct}{lsredis\_obj\_t}));
    \textcolor{keywordflow}{if}( p == NULL) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"\_lsredis\_get\_obj: Out of
       memory"});
      exit( -1);
    \}
    
    err = regexec( &\hyperlink{lsredis_8c_abee04898347f9b2551fa0435b1cc597e}{lsredis\_key\_select\_regex}, key, 2, 
      pmatch, 0);
    \textcolor{keywordflow}{if}( err == 0 && pmatch[1].rm\_so != -1) \{
      p->\hyperlink{structlsredis__obj__struct_ad0a987a011b580eab739cda831f78fbb}{events\_name} = strndup( key+pmatch[1].rm\_so, pmatch[1].rm\_eo
       - pmatch[1].rm\_so);
    \} \textcolor{keywordflow}{else} \{
      p->\hyperlink{structlsredis__obj__struct_ad0a987a011b580eab739cda831f78fbb}{events\_name} = strdup( key);
    \}
    \textcolor{keywordflow}{if}( p->\hyperlink{structlsredis__obj__struct_ad0a987a011b580eab739cda831f78fbb}{events\_name} == NULL) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"\_lsredis\_get\_obj: Out of
       memory (events\_name)"});
      exit( -1);
    \}

    pthread\_mutex\_init( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex}, &\hyperlink{lsredis_8c_a71c9f418904364d65c22d786f4dc5d39}{mutex\_initializer});
    pthread\_cond\_init(  &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, NULL);
    p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value} = NULL;
    p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} = 0;
    \textcolor{comment}{// lsevents\_send\_event( "%s Invalid", p->events\_name);}
    p->\hyperlink{structlsredis__obj__struct_a8bc1a536b7155a1e2a749c7c434b898b}{wait\_for\_me} = 0;
    p->\hyperlink{structlsredis__obj__struct_aa8c5a453b9424e5666320b8675a42f5c}{key} = strdup( key);
    p->\hyperlink{structlsredis__obj__struct_a43fcbff584654ab086d973ce34cb6ddc}{hits} = 0;
  
    htab\_input.key  = p->\hyperlink{structlsredis__obj__struct_aa8c5a453b9424e5666320b8675a42f5c}{key};
    htab\_input.data = \hyperlink{namespacemk__pgpmac__redis_a11daf2847f2dc94562b5b61b3f412574}{p};

    errno = 0;
    err = hsearch\_r( htab\_input, ENTER, &htab\_output, &\hyperlink{lsredis_8c_a42aec6aa74072797ec0344847b0e9e39}{lsredis\_htab}
      );
    \textcolor{keywordflow}{if}( err == 0) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"\_lsredis\_get\_obj: hseach
       error on enter.  errno=%d"}, errno);
    \}

    \textcolor{comment}{//}
    \textcolor{comment}{// Shouldn't need the linked list unless we need to rebuild the hash table
       when, for example, we run out of room.}
    \textcolor{comment}{// TODO: resize hash table when needed.}
    \textcolor{comment}{//}
    p->\hyperlink{structlsredis__obj__struct_afb7259e8c3c1c83ccc234b2b2894f2b0}{next} = \hyperlink{lsredis_8c_a3d206e1c119f1408a7cf1078139f8189}{lsredis\_objs};
    \hyperlink{lsredis_8c_a3d206e1c119f1408a7cf1078139f8189}{lsredis\_objs} = \hyperlink{namespacemk__pgpmac__redis_a11daf2847f2dc94562b5b61b3f412574}{p};
  \}
  \textcolor{comment}{//}
  \textcolor{comment}{// We arrive here with the valid flag lowered.  Go ahead and request the
       latest value.}
  \textcolor{comment}{//}
  redisAsyncCommand( \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}, \hyperlink{lsredis_8c_a8d9719b362d1b38275d734971b7988af}{lsredis\_hgetCB}, p, \textcolor{stringliteral}{"HGET %s VALUE"}
      , key);

  \textcolor{keywordflow}{return} \hyperlink{namespacemk__pgpmac__redis_a11daf2847f2dc94562b5b61b3f412574}{p};
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_aac89b916c1152c44042875feac35a9e4}{\index{pgpmac.\-h@{pgpmac.\-h}!lsevents\-\_\-add\-\_\-listener@{lsevents\-\_\-add\-\_\-listener}}
\index{lsevents\-\_\-add\-\_\-listener@{lsevents\-\_\-add\-\_\-listener}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsevents\-\_\-add\-\_\-listener}]{\setlength{\rightskip}{0pt plus 5cm}void lsevents\-\_\-add\-\_\-listener (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{raw\-\_\-regexp, }
\item[{void($\ast$)(char $\ast$)}]{cb}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_aac89b916c1152c44042875feac35a9e4}


Add a callback routine to listen for a specific event. 


\begin{DoxyParams}{Parameters}
{\em raw\-\_\-regexp} & String value of regular expression to listen to \\
\hline
{\em cb} & the routine to call \\
\hline
\end{DoxyParams}


Definition at line 99 of file lsevents.\-c.


\begin{DoxyCode}
                                                                  \{
  \hyperlink{structlsevents__listener__struct}{lsevents\_listener\_t}    *\textcolor{keyword}{new};
  \hyperlink{structlsevents__event__names__struct}{lsevents\_event\_names\_t} *enp;
  \hyperlink{structlsevents__callbacks__struct}{lsevents\_callbacks\_t}   *cbp;
  \textcolor{keywordtype}{int} err;
  \textcolor{keywordtype}{char} *errbuf;
  \textcolor{keywordtype}{int} nerrbuf;



  \textcolor{keyword}{new} = calloc( 1, \textcolor{keyword}{sizeof}( \hyperlink{structlsevents__listener__struct}{lsevents\_listener\_t}));
  \textcolor{keywordflow}{if}( \textcolor{keyword}{new} == NULL) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsevents\_add\_listener: out of
       memory"});
    exit( -1);
  \}

  err = regcomp( &new->re, raw\_regexp, REG\_EXTENDED | REG\_NOSUB);
  \textcolor{keywordflow}{if}( err != 0) \{
    nerrbuf = regerror( err, &new->re, NULL, 0);
    errbuf = calloc( nerrbuf, \textcolor{keyword}{sizeof}( \textcolor{keywordtype}{char}));
    \textcolor{keywordflow}{if}( errbuf == NULL) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsevents\_add\_listener: out
       of memory (re)"});
      exit( -1);
    \}
    regerror( err, &new->re, errbuf, nerrbuf);
    free( errbuf);
    free( \textcolor{keyword}{new});
    \textcolor{keywordflow}{return};
  \}

  \textcolor{keyword}{new}->raw\_regexp = strdup( raw\_regexp);
  \textcolor{keyword}{new}->cb   = cb;

  pthread\_mutex\_lock( &\hyperlink{lsevents_8c_a70bba59930a1c7d7d181aa03cdfb6c00}{lsevents\_listener\_mutex});
  \textcolor{keyword}{new}->next = \hyperlink{lsevents_8c_a300dc3edfa8546d75e9f8bab8fa06c5c}{lsevents\_listeners\_p};
  \hyperlink{lsevents_8c_a300dc3edfa8546d75e9f8bab8fa06c5c}{lsevents\_listeners\_p} = \textcolor{keyword}{new};

  \textcolor{keywordflow}{for}( enp = \hyperlink{lsevents_8c_abec6bcf8613a6268e59e6c5409ee344c}{lsevents\_event\_names}; enp != NULL; enp = enp->
      \hyperlink{structlsevents__event__names__struct_a748e63bd8825f239936c5bf165ca869e}{next}) \{
    \textcolor{keywordflow}{if}( regexec( &new->re, enp->\hyperlink{structlsevents__event__names__struct_a07e5a0f2b74c08f388626f18b37cd1b0}{event}, 0, NULL, 0) == 0) \{
      cbp       = calloc( 1, \textcolor{keyword}{sizeof}( \hyperlink{structlsevents__callbacks__struct}{lsevents\_callbacks\_t}))
      ;
      cbp->\hyperlink{structlsevents__callbacks__struct_a523024faf274afe9056748ddbe6def5c}{cb}   = cb;
      cbp->\hyperlink{structlsevents__callbacks__struct_a6d673746e36b16df34d53e143c1ba881}{next} = enp->\hyperlink{structlsevents__event__names__struct_afdd17d4d473fcf095a279953ea5e0f1c}{cbl};
      enp->\hyperlink{structlsevents__event__names__struct_afdd17d4d473fcf095a279953ea5e0f1c}{cbl}  = cbp;
    \}
  \}
  

  pthread\_mutex\_unlock( &\hyperlink{lsevents_8c_a70bba59930a1c7d7d181aa03cdfb6c00}{lsevents\_listener\_mutex});

\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_af19a77187e7406fc87d36bd26e672e6d}{\index{pgpmac.\-h@{pgpmac.\-h}!lsevents\-\_\-init@{lsevents\-\_\-init}}
\index{lsevents\-\_\-init@{lsevents\-\_\-init}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsevents\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void lsevents\-\_\-init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_af19a77187e7406fc87d36bd26e672e6d}


Initialize this module. 



Definition at line 367 of file lsevents.\-c.


\begin{DoxyCode}
                     \{
  pthread\_mutexattr\_t \hyperlink{lsredis_8c_a71c9f418904364d65c22d786f4dc5d39}{mutex\_initializer};

  \textcolor{comment}{// Use recursive mutexs}
  \textcolor{comment}{//}
  pthread\_mutexattr\_init( &mutex\_initializer);
  pthread\_mutexattr\_settype( &mutex\_initializer, PTHREAD\_MUTEX\_RECURSIVE);

  pthread\_mutex\_init( &\hyperlink{lsevents_8c_ab46f4ebda5e926a213faedac1a545ec1}{lsevents\_queue\_mutex},    &
      mutex\_initializer);
  pthread\_cond\_init(  &\hyperlink{lsevents_8c_a8079d9fb8c35db3ca5f83be5aeb2a747}{lsevents\_queue\_cond},     NULL);
  pthread\_mutex\_init( &\hyperlink{lsevents_8c_a70bba59930a1c7d7d181aa03cdfb6c00}{lsevents\_listener\_mutex}, &
      mutex\_initializer);

  hcreate\_r( 2*\hyperlink{lsevents_8c_ad09b507c9a79282374a0474470454bb8}{lsevents\_max\_events}, &\hyperlink{lsevents_8c_a274c60d870a1b91ab606dcf024be1bf7}{lsevents\_event\_name\_ht}
      );
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_ae09cfa92dba806d8f8808e5822ea713c}{\index{pgpmac.\-h@{pgpmac.\-h}!lsevents\-\_\-preregister\-\_\-event@{lsevents\-\_\-preregister\-\_\-event}}
\index{lsevents\-\_\-preregister\-\_\-event@{lsevents\-\_\-preregister\-\_\-event}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsevents\-\_\-preregister\-\_\-event}]{\setlength{\rightskip}{0pt plus 5cm}void lsevents\-\_\-preregister\-\_\-event (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{fmt, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_ae09cfa92dba806d8f8808e5822ea713c}


Definition at line 308 of file lsevents.\-c.


\begin{DoxyCode}
                                                 \{
  \textcolor{keywordtype}{char}  s[128];
  va\_list arg\_ptr;

  va\_start( arg\_ptr, fmt);
  vsnprintf( s, \textcolor{keyword}{sizeof}( s) - 1, fmt, arg\_ptr);
  s[\textcolor{keyword}{sizeof}(s)-1] = 0;
  va\_end( arg\_ptr);

  \hyperlink{lsevents_8c_a5e3fd5e3c6d11f8a74d79978e00f8835}{lsevents\_register\_event}( s);
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a024b08c7820bb31c3d5b8f281e07f3e8}{\index{pgpmac.\-h@{pgpmac.\-h}!lsevents\-\_\-remove\-\_\-listener@{lsevents\-\_\-remove\-\_\-listener}}
\index{lsevents\-\_\-remove\-\_\-listener@{lsevents\-\_\-remove\-\_\-listener}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsevents\-\_\-remove\-\_\-listener}]{\setlength{\rightskip}{0pt plus 5cm}void lsevents\-\_\-remove\-\_\-listener (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{event, }
\item[{void($\ast$)(char $\ast$)}]{cb}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a024b08c7820bb31c3d5b8f281e07f3e8}


Remove a listener previously added with lsevents\-\_\-add\-\_\-listener. 


\begin{DoxyParams}{Parameters}
{\em event} & The name of the event (possibly a regular expression string) \\
\hline
{\em cb} & The callback routine to remove \\
\hline
\end{DoxyParams}


Definition at line 154 of file lsevents.\-c.


\begin{DoxyCode}
                                                                \{
  
  \hyperlink{structlsevents__listener__struct}{lsevents\_listener\_t} *last, *current;
  \hyperlink{structlsevents__event__names__struct}{lsevents\_event\_names\_t} *enp;
  \hyperlink{structlsevents__callbacks__struct}{lsevents\_callbacks\_t}   *cbp, *last\_cbp;

  \textcolor{comment}{//}
  \textcolor{comment}{// Find the listener to remove}
  \textcolor{comment}{// and unlink it from the list}
  \textcolor{comment}{//}
  pthread\_mutex\_lock( &\hyperlink{lsevents_8c_a70bba59930a1c7d7d181aa03cdfb6c00}{lsevents\_listener\_mutex});
  last = NULL;
  \textcolor{keywordflow}{for}( current = \hyperlink{lsevents_8c_a300dc3edfa8546d75e9f8bab8fa06c5c}{lsevents\_listeners\_p}; current != NULL; 
      current = current->\hyperlink{structlsevents__listener__struct_a8aed9196b0deab84e018b96c0cc59305}{next}) \{
    \textcolor{keywordflow}{if}( strcmp( last->\hyperlink{structlsevents__listener__struct_afffe7a6889fda47a3a7a91beefed9168}{raw\_regexp}, event) == 0 && last->\hyperlink{structlsevents__listener__struct_a005906c1c9f0647e6ed1fb4592d8c5d0}{cb} == cb) \{
      \textcolor{keywordflow}{if}( last == NULL) \{
        \hyperlink{lsevents_8c_a300dc3edfa8546d75e9f8bab8fa06c5c}{lsevents\_listeners\_p} = current->\hyperlink{structlsevents__listener__struct_a8aed9196b0deab84e018b96c0cc59305}{next};
      \} \textcolor{keywordflow}{else} \{
        last->\hyperlink{structlsevents__listener__struct_a8aed9196b0deab84e018b96c0cc59305}{next} = current->\hyperlink{structlsevents__listener__struct_a8aed9196b0deab84e018b96c0cc59305}{next};
      \}
      \textcolor{keywordflow}{break};
    \}
    last = current;
  \}

  \textcolor{keywordflow}{if}( current == NULL) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsevents\_remove\_listener:
       Could not find this listener for event '%s'"}, event);
    pthread\_mutex\_unlock( &\hyperlink{lsevents_8c_a70bba59930a1c7d7d181aa03cdfb6c00}{lsevents\_listener\_mutex});
    \textcolor{keywordflow}{return};
  \}

  \textcolor{comment}{//}
  \textcolor{comment}{// Remove callback from lists of event names}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{for}( enp = \hyperlink{lsevents_8c_abec6bcf8613a6268e59e6c5409ee344c}{lsevents\_event\_names}; enp != NULL; enp = enp->
      \hyperlink{structlsevents__event__names__struct_a748e63bd8825f239936c5bf165ca869e}{next}) \{
    \textcolor{keywordflow}{if}( regexec( &current->\hyperlink{structlsevents__listener__struct_a60b0f9e188a08e6101c494af89052d3f}{re}, enp->\hyperlink{structlsevents__event__names__struct_a07e5a0f2b74c08f388626f18b37cd1b0}{event}, 0, NULL, 0) == 0) \{
      last\_cbp = NULL;
      \textcolor{keywordflow}{for}( cbp = enp->\hyperlink{structlsevents__event__names__struct_afdd17d4d473fcf095a279953ea5e0f1c}{cbl}; cbp != NULL; cbp = cbp->\hyperlink{structlsevents__callbacks__struct_a6d673746e36b16df34d53e143c1ba881}{next}) \{
        \textcolor{keywordflow}{if}( cbp->\hyperlink{structlsevents__callbacks__struct_a523024faf274afe9056748ddbe6def5c}{cb} == cb) \{
          \textcolor{keywordflow}{if}( last\_cbp == NULL)
            enp->\hyperlink{structlsevents__event__names__struct_afdd17d4d473fcf095a279953ea5e0f1c}{cbl} = NULL;
          \textcolor{keywordflow}{else}
            last\_cbp->\hyperlink{structlsevents__callbacks__struct_a6d673746e36b16df34d53e143c1ba881}{next} = cbp->\hyperlink{structlsevents__callbacks__struct_a6d673746e36b16df34d53e143c1ba881}{next};
          free( cbp);
          \textcolor{keywordflow}{break};
        \}
      \}
    \}
  \}


  pthread\_mutex\_unlock( &\hyperlink{lsevents_8c_a70bba59930a1c7d7d181aa03cdfb6c00}{lsevents\_listener\_mutex});

  \textcolor{comment}{//}
  \textcolor{comment}{// Now remove it}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( current->\hyperlink{structlsevents__listener__struct_afffe7a6889fda47a3a7a91beefed9168}{raw\_regexp} != NULL)
    free( current->\hyperlink{structlsevents__listener__struct_afffe7a6889fda47a3a7a91beefed9168}{raw\_regexp});
  free(current);

\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a7f2ed970b1c3b340b79311e73c5f1e11}{\index{pgpmac.\-h@{pgpmac.\-h}!lsevents\-\_\-run@{lsevents\-\_\-run}}
\index{lsevents\-\_\-run@{lsevents\-\_\-run}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsevents\-\_\-run}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-t$\ast$ lsevents\-\_\-run (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a7f2ed970b1c3b340b79311e73c5f1e11}


Start up the thread and get out of the way. 



Definition at line 384 of file lsevents.\-c.


\begin{DoxyCode}
                          \{
  pthread\_create( &\hyperlink{lsevents_8c_a314640d7c3cb4fa90823ab2418fbac9b}{lsevents\_thread}, NULL, \hyperlink{lsevents_8c_a48e8f9dee00710bbe293b4bbded37a39}{lsevents\_worker}
      , NULL);
  \textcolor{keywordflow}{return} &\hyperlink{lsevents_8c_a314640d7c3cb4fa90823ab2418fbac9b}{lsevents\_thread};
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a3661dfc51537c05b11f4fd184fdff07d}{\index{pgpmac.\-h@{pgpmac.\-h}!lsevents\-\_\-send\-\_\-event@{lsevents\-\_\-send\-\_\-event}}
\index{lsevents\-\_\-send\-\_\-event@{lsevents\-\_\-send\-\_\-event}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsevents\-\_\-send\-\_\-event}]{\setlength{\rightskip}{0pt plus 5cm}void lsevents\-\_\-send\-\_\-event (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{fmt, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a3661dfc51537c05b11f4fd184fdff07d}


Call the callback routines for the given event. 


\begin{DoxyParams}{Parameters}
{\em fmt} & a printf style formating string \\
\hline
{\em ...} & list of arguments specified by the format string \\
\hline
\end{DoxyParams}


Definition at line 73 of file lsevents.\-c.


\begin{DoxyCode}
                                          \{
  \textcolor{keywordtype}{char} \textcolor{keyword}{event}[\hyperlink{pgpmac_8h_ab61d790b5572f116e091babfda53627b}{LSEVENTS\_EVENT\_LENGTH}];
  va\_list arg\_ptr;

  va\_start( arg\_ptr, fmt);
  vsnprintf( event, \textcolor{keyword}{sizeof}(event)-1, fmt, arg\_ptr);
  \textcolor{keyword}{event}[\textcolor{keyword}{sizeof}(event)-1]=0;
  va\_end( arg\_ptr);

  pthread\_mutex\_lock( &\hyperlink{lsevents_8c_ab46f4ebda5e926a213faedac1a545ec1}{lsevents\_queue\_mutex});

  \textcolor{comment}{// maybe wait for room on the queue}
  \textcolor{keywordflow}{while}( (\hyperlink{lsevents_8c_a3bccf603d56d5b2f4a92fad341d37e2c}{lsevents\_queue\_on} + 1) % \hyperlink{lsevents_8c_a75469307c70790f04b9b2bfcb1473a48}{LSEVENTS\_QUEUE\_LENGTH}
       == \hyperlink{lsevents_8c_a50ad47e12cc4fc2d88659230b2fd44ff}{lsevents\_queue\_off} % \hyperlink{lsevents_8c_a75469307c70790f04b9b2bfcb1473a48}{LSEVENTS\_QUEUE\_LENGTH}
      )
    pthread\_cond\_wait( &\hyperlink{lsevents_8c_a8079d9fb8c35db3ca5f83be5aeb2a747}{lsevents\_queue\_cond}, &
      \hyperlink{lsevents_8c_ab46f4ebda5e926a213faedac1a545ec1}{lsevents\_queue\_mutex});
  
  \hyperlink{lsevents_8c_ad1ff5e895b4016113c8414d9a5daa2f2}{lsevents\_queue}[(\hyperlink{lsevents_8c_a3bccf603d56d5b2f4a92fad341d37e2c}{lsevents\_queue\_on}++) % 
      LSEVENTS\_QUEUE\_LENGTH].evp = strdup(event);

  pthread\_cond\_signal(  &\hyperlink{lsevents_8c_a8079d9fb8c35db3ca5f83be5aeb2a747}{lsevents\_queue\_cond});
  pthread\_mutex\_unlock( &\hyperlink{lsevents_8c_ab46f4ebda5e926a213faedac1a545ec1}{lsevents\_queue\_mutex});
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a3418b9ab57811d28632794236e056408}{\index{pgpmac.\-h@{pgpmac.\-h}!lslogging\-\_\-init@{lslogging\-\_\-init}}
\index{lslogging\-\_\-init@{lslogging\-\_\-init}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lslogging\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void lslogging\-\_\-init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a3418b9ab57811d28632794236e056408}


Initialize the lslogging objects. 



Definition at line 37 of file lslogging.\-c.


\begin{DoxyCode}
                      \{
  pthread\_mutex\_init( &\hyperlink{lslogging_8c_a4a97ffe8731ae437f014ada051301be3}{lslogging\_mutex}, NULL);
  pthread\_cond\_init(  &\hyperlink{lslogging_8c_afa5f05c4337683edc3c88ab56aa5ea6f}{lslogging\_cond}, NULL);

  \hyperlink{lslogging_8c_a5709d6eb68a8eebf78ba58bb78da0649}{lslogging\_file} = fopen( \hyperlink{lslogging_8c_ade1e95a32a49f0fd1b3e635c4d15ccd3}{LSLOGGING\_FILE\_NAME},
       \textcolor{stringliteral}{"w"});
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a0e756b36671055ef02a8f04d2ba8a93b}{\index{pgpmac.\-h@{pgpmac.\-h}!lslogging\-\_\-log\-\_\-message@{lslogging\-\_\-log\-\_\-message}}
\index{lslogging\-\_\-log\-\_\-message@{lslogging\-\_\-log\-\_\-message}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lslogging\-\_\-log\-\_\-message}]{\setlength{\rightskip}{0pt plus 5cm}void lslogging\-\_\-log\-\_\-message (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{fmt, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a0e756b36671055ef02a8f04d2ba8a93b}


The routine everyone will be talking about. 


\begin{DoxyParams}{Parameters}
{\em fmt} & A printf style formating string. \\
\hline
{\em ...} & The arguments specified by fmt \\
\hline
\end{DoxyParams}


Definition at line 48 of file lslogging.\-c.


\begin{DoxyCode}
                                            \{
  \textcolor{keywordtype}{char} msg[\hyperlink{lslogging_8c_a0526e4aa12fbaf357fe315d6b3209c54}{LSLOGGING\_MSG\_LENGTH}];
  \textcolor{keyword}{struct }timespec theTime;
  va\_list arg\_ptr;
  \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} on;

  clock\_gettime( CLOCK\_REALTIME, &theTime);

  va\_start( arg\_ptr, fmt);
  vsnprintf( msg, \textcolor{keyword}{sizeof}(msg)-1, fmt, arg\_ptr);
  va\_end( arg\_ptr);
  msg[\textcolor{keyword}{sizeof}(msg)-1]=0;

  pthread\_mutex\_lock( &\hyperlink{lslogging_8c_a4a97ffe8731ae437f014ada051301be3}{lslogging\_mutex});
  
  on = (\hyperlink{lslogging_8c_a1f6e69ade57a17755e6b74a6286505df}{lslogging\_on}++) % \hyperlink{lslogging_8c_a5b1cb610bee26b000a2d64caa7d77a8d}{LSLOGGING\_QUEUE\_LENGTH}
      ;
  strncpy( \hyperlink{lslogging_8c_af98f94aec3e4501328da1b71f706c652}{lslogging\_queue}[on].lmsg, msg, \hyperlink{lslogging_8c_a0526e4aa12fbaf357fe315d6b3209c54}{LSLOGGING\_MSG\_LENGTH}
       - 1);
  \hyperlink{lslogging_8c_af98f94aec3e4501328da1b71f706c652}{lslogging\_queue}[on].\hyperlink{structlslogging__queue__struct_a5e83db0116b1289a84683ce48626d99d}{lmsg}[\hyperlink{lslogging_8c_a0526e4aa12fbaf357fe315d6b3209c54}{LSLOGGING\_MSG\_LENGTH}
      -1] = 0;
  
  memcpy( &(\hyperlink{lslogging_8c_af98f94aec3e4501328da1b71f706c652}{lslogging\_queue}[on].ltime), &theTime, \textcolor{keyword}{sizeof}(theTime
      ));

  pthread\_cond\_signal(  &\hyperlink{lslogging_8c_afa5f05c4337683edc3c88ab56aa5ea6f}{lslogging\_cond});
  pthread\_mutex\_unlock( &\hyperlink{lslogging_8c_a4a97ffe8731ae437f014ada051301be3}{lslogging\_mutex});

\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_ab5d6951193d8b2df1e4dd61c53de76cc}{\index{pgpmac.\-h@{pgpmac.\-h}!lslogging\-\_\-run@{lslogging\-\_\-run}}
\index{lslogging\-\_\-run@{lslogging\-\_\-run}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lslogging\-\_\-run}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-t$\ast$ lslogging\-\_\-run (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_ab5d6951193d8b2df1e4dd61c53de76cc}


Start up the worker thread. 



Definition at line 123 of file lslogging.\-c.


\begin{DoxyCode}
                           \{
  pthread\_create( &\hyperlink{lslogging_8c_ad7629be92d1bec1c621b5cc0800f497f}{lslogging\_thread}, NULL, &\hyperlink{lslogging_8c_a33ec49aea69b5e4b1b551a34e7bacfca}{lslogging\_worker}
      , NULL);
  \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Start up"});
  \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{".+"}, \hyperlink{lslogging_8c_a775318b2753a8b5be9f235589a78797b}{lslogging\_event\_cb}
      );
  \textcolor{keywordflow}{return} &\hyperlink{lslogging_8c_ad7629be92d1bec1c621b5cc0800f497f}{lslogging\_thread};
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a4ee000bfeef9380d479464a9500af311}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-array2ptrs@{lspg\-\_\-array2ptrs}}
\index{lspg\-\_\-array2ptrs@{lspg\-\_\-array2ptrs}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-array2ptrs}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$$\ast$ lspg\-\_\-array2ptrs (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a4ee000bfeef9380d479464a9500af311}


returns a null terminated list of strings parsed from postgresql array 



Definition at line 165 of file lspg.\-c.


\begin{DoxyCode}
                                 \{
  \textcolor{keywordtype}{char} **rtn, *sp, *acums;
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}, n, inquote, havebackslash, rtni;;
  \textcolor{keywordtype}{int} mxsz;
  
  inquote       = 0;
  havebackslash = 0;

  \textcolor{comment}{// Despense with the null input condition before we complicate the code below}
  \textcolor{keywordflow}{if}( a == NULL || a[0] != \textcolor{charliteral}{'\{'} || a[strlen(a)-1] != \textcolor{charliteral}{'\}'})
    \textcolor{keywordflow}{return} NULL;

  \textcolor{comment}{// Count the maximum number of strings}
  \textcolor{comment}{// Actual number will be less if there are quoted commas}
  \textcolor{comment}{//}
  n = 1;
  \textcolor{keywordflow}{for}( i=0; a[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}]; i++) \{
    \textcolor{keywordflow}{if}( a[i] == \textcolor{charliteral}{','})
      n++;
  \}
  \textcolor{comment}{//}
  \textcolor{comment}{// The maximum size of any string is the length of a (+1)}
  \textcolor{comment}{//}
  mxsz = strlen(a) + 1;

  \textcolor{comment}{// This is the accumulation string to make up the array elements}
  acums = (\textcolor{keywordtype}{char} *)calloc( mxsz, \textcolor{keyword}{sizeof}( \textcolor{keywordtype}{char}));
  \textcolor{keywordflow}{if}( acums == NULL) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspg\_array2ptrs: out of memory
       (acums)"});
    exit( 1);
  \}
  
  \textcolor{comment}{//}
  \textcolor{comment}{// allocate storage for the pointer array and the null terminator}
  \textcolor{comment}{//}
  rtn = (\textcolor{keywordtype}{char} **)calloc( n+1, \textcolor{keyword}{sizeof}( \textcolor{keywordtype}{char} *));
  \textcolor{keywordflow}{if}( rtn == NULL) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspg\_array2ptrs: out of memory
       (rtn)"});
    exit( 1);
  \}
  rtni = 0;
  
  \textcolor{comment}{// Go through and create the individual strings}
  sp = acums;
  *sp = 0;

  inquote = 0;
  havebackslash = 0;
  \textcolor{keywordflow}{for}( i=1; a[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}] != 0; i++) \{
    \textcolor{keywordflow}{switch}( a[i]) \{
    \textcolor{keywordflow}{case} \textcolor{charliteral}{'"'}:
      \textcolor{keywordflow}{if}( havebackslash) \{
        \textcolor{comment}{// a quoted quote.  Cool}
        \textcolor{comment}{//}
        *(sp++) = a[i];
        *sp = 0;
        havebackslash = 0;
      \} \textcolor{keywordflow}{else} \{
        \textcolor{comment}{// Toggle the flag}
        inquote = 1 - inquote;
      \}
      \textcolor{keywordflow}{break};

    \textcolor{keywordflow}{case} \textcolor{charliteral}{'\(\backslash\)\(\backslash\)'}:
      \textcolor{keywordflow}{if}( havebackslash) \{
        *(sp++) = a[i];
        *sp = 0;
        havebackslash = 0;
      \} \textcolor{keywordflow}{else} \{
        havebackslash = 1;
      \}
      \textcolor{keywordflow}{break};

    \textcolor{keywordflow}{case} \textcolor{charliteral}{','}:
      \textcolor{keywordflow}{if}( inquote || havebackslash) \{
        *(sp++) = a[i];
        *sp = 0;
        havebackslash = 0;
      \} \textcolor{keywordflow}{else} \{
        rtn[rtni++] = strdup( acums);
        sp = acums;
      \}
      \textcolor{keywordflow}{break};
      
    \textcolor{keywordflow}{case} \textcolor{charliteral}{'\}'}:
      \textcolor{keywordflow}{if}( inquote || havebackslash) \{
        *(sp++) = a[i];
        *sp = 0;
        havebackslash = 0;
      \} \textcolor{keywordflow}{else} \{
        rtn[rtni++] = strdup( acums);
        rtn[rtni]   = NULL;
        free( acums);
        \textcolor{keywordflow}{return}( rtn);
      \}
      \textcolor{keywordflow}{break};

    \textcolor{keywordflow}{default}:
      *(sp++) = a[i];
      *sp = 0;
      havebackslash = 0;
    \}
  \}
  \textcolor{comment}{//}
  \textcolor{comment}{// Getting here means the final '\}' was missing}
  \textcolor{comment}{// Probably we should throw an error or log it or something.}
  \textcolor{comment}{// Through out the last entry since this there is not resonable expectation
       that}
  \textcolor{comment}{// we should be parsing it anyway.}
  \textcolor{comment}{//}
  rtn[rtni]   = NULL;
  free( acums);
  \textcolor{keywordflow}{return}( rtn);
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_aa4cad634cac645d0366acbb25cef7b96}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-demandairrights\-\_\-all@{lspg\-\_\-demandairrights\-\_\-all}}
\index{lspg\-\_\-demandairrights\-\_\-all@{lspg\-\_\-demandairrights\-\_\-all}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-demandairrights\-\_\-all}]{\setlength{\rightskip}{0pt plus 5cm}int lspg\-\_\-demandairrights\-\_\-all (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_aa4cad634cac645d0366acbb25cef7b96}


do nothing until we get airrights 



Definition at line 724 of file lspg.\-c.


\begin{DoxyCode}
                               \{
  \hyperlink{lspg_8c_ae3f3ae783042eb1f5f2c37b517b7404a}{lspg\_demandairrights\_call}();
  \textcolor{keywordflow}{return} \hyperlink{lspg_8c_a79cc363874905f76f5607cca5dc9773a}{lspg\_demandairrights\_wait}();
  \textcolor{comment}{// there is no "done" version}
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a6f7cd0a06f6a266ef65b3604cf33d6c4}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-getcenter\-\_\-call@{lspg\-\_\-getcenter\-\_\-call}}
\index{lspg\-\_\-getcenter\-\_\-call@{lspg\-\_\-getcenter\-\_\-call}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-getcenter\-\_\-call}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-getcenter\-\_\-call (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a6f7cd0a06f6a266ef65b3604cf33d6c4}


Request a getcenter query. 



Definition at line 1424 of file lspg.\-c.


\begin{DoxyCode}
                           \{
  pthread\_mutex\_lock( &\hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a214bb7e88b137162f13f41f2c43002a9}{mutex});
  \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a4b350f11f1e375b9e9e839caaffbcb6b}{new\_value\_ready} = 0;
  \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a0d1be4b8199bc5ec781c3df2211335aa}{query\_error}     = 0;
  pthread\_mutex\_unlock( &\hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a214bb7e88b137162f13f41f2c43002a9}{mutex});

  \hyperlink{kvredis_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( \hyperlink{lspg_8c_a8184824f2b71b1d35141d7922ca69cd7}{lspg\_getcenter\_cb}, 
      \hyperlink{lspg_8c_a42a5e614dc36938e4897ea3c038d4dc2}{lspg\_getcenter\_error\_cb}, \textcolor{stringliteral}{"SELECT * FROM px.getcenter2()"}
      );
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a7c678553b44c874d08ec9966ed7bb1c0}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-getcenter\-\_\-done@{lspg\-\_\-getcenter\-\_\-done}}
\index{lspg\-\_\-getcenter\-\_\-done@{lspg\-\_\-getcenter\-\_\-done}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-getcenter\-\_\-done}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-getcenter\-\_\-done (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a7c678553b44c874d08ec9966ed7bb1c0}


Done with getcenter query. 



Definition at line 1443 of file lspg.\-c.


\begin{DoxyCode}
                           \{
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a214bb7e88b137162f13f41f2c43002a9}{mutex}));
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a3e0e4b3cb9fa03961ee0c104e0b06754}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-getcenter\-\_\-wait@{lspg\-\_\-getcenter\-\_\-wait}}
\index{lspg\-\_\-getcenter\-\_\-wait@{lspg\-\_\-getcenter\-\_\-wait}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-getcenter\-\_\-wait}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-getcenter\-\_\-wait (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a3e0e4b3cb9fa03961ee0c104e0b06754}


Wait for a getcenter query to return. 



Definition at line 1435 of file lspg.\-c.


\begin{DoxyCode}
                           \{
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a214bb7e88b137162f13f41f2c43002a9}{mutex}));
  \textcolor{keywordflow}{while}( \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a4b350f11f1e375b9e9e839caaffbcb6b}{new\_value\_ready} == 0 && 
      \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a0d1be4b8199bc5ec781c3df2211335aa}{query\_error} == 0)
    pthread\_cond\_wait( &(\hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_ae0db0ff2608ab5ba3e7c1b4ad3fc0e91}{cond}), &(
      \hyperlink{lspg_8c_a7ef8a09203117578c9b2ce4719519f36}{lspg\_getcenter}.\hyperlink{structlspg__getcenter__struct_a214bb7e88b137162f13f41f2c43002a9}{mutex}));
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a39ff432056655f9dbe0f0239668caf74}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-getcurrentsampleid\-\_\-all@{lspg\-\_\-getcurrentsampleid\-\_\-all}}
\index{lspg\-\_\-getcurrentsampleid\-\_\-all@{lspg\-\_\-getcurrentsampleid\-\_\-all}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-getcurrentsampleid\-\_\-all}]{\setlength{\rightskip}{0pt plus 5cm}unsigned int lspg\-\_\-getcurrentsampleid\-\_\-all (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a39ff432056655f9dbe0f0239668caf74}


return the current sampleid 



Definition at line 510 of file lspg.\-c.


\begin{DoxyCode}
                                           \{
  \hyperlink{lspg_8c_acf98a9e2adec05a69847045f444a5c77}{lspg\_getcurrentsampleid\_call}();
  \textcolor{keywordflow}{return} \hyperlink{lspg_8c_a7b070b4891f485b7f74c95e0e60471f3}{lspg\_getcurrentsampleid\_read}();
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a02d7dc2b8b8667b07b48d9147eb4621d}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-getcurrentsampleid\-\_\-wait\-\_\-for\-\_\-id@{lspg\-\_\-getcurrentsampleid\-\_\-wait\-\_\-for\-\_\-id}}
\index{lspg\-\_\-getcurrentsampleid\-\_\-wait\-\_\-for\-\_\-id@{lspg\-\_\-getcurrentsampleid\-\_\-wait\-\_\-for\-\_\-id}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-getcurrentsampleid\-\_\-wait\-\_\-for\-\_\-id}]{\setlength{\rightskip}{0pt plus 5cm}int lspg\-\_\-getcurrentsampleid\-\_\-wait\-\_\-for\-\_\-id (
\begin{DoxyParamCaption}
\item[{unsigned int}]{test}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a02d7dc2b8b8667b07b48d9147eb4621d}


Definition at line 517 of file lspg.\-c.


\begin{DoxyCode}
                                                            \{
  \textcolor{keywordtype}{int} rtn;

  pthread\_mutex\_lock( &\hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_ace54acbdcbce620437962858ba04e256}{mutex}
      );
  \textcolor{keywordflow}{while}( \hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_af629de1e076fd6763bccea3547ef24e7}{getcurrentsampleid}
       != test && \hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_ac81d3b649befe470ef32453c9b83d334}{query\_error}
       == 0)
    pthread\_cond\_wait( &\hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_a289960e45fdc9339a05dc8607f1b7563}{cond}
      , &\hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_ace54acbdcbce620437962858ba04e256}{mutex});
  
  rtn = \hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_ac81d3b649befe470ef32453c9b83d334}{query\_error};
  pthread\_mutex\_unlock( &\hyperlink{lspg_8c_a5c50804e6019d47d91f3f1cb3ebd1f00}{lspg\_getcurrentsampleid}.\hyperlink{structlspg__getcurrentsampleid__struct_ace54acbdcbce620437962858ba04e256}{mutex}
      );

  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a8a77972df14166e05c94ed0792baa09b}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-init@{lspg\-\_\-init}}
\index{lspg\-\_\-init@{lspg\-\_\-init}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a8a77972df14166e05c94ed0792baa09b}


Initiallize the lspg module. 



Definition at line 2161 of file lspg.\-c.


\begin{DoxyCode}
                 \{
  pthread\_mutex\_init( &\hyperlink{lspg_8c_aed46a94106c583796e3a8ca0e89aa8e4}{lspg\_queue\_mutex}, NULL);
  pthread\_cond\_init( &\hyperlink{lspg_8c_a61a308b6a37afd645beb422653b95baa}{lspg\_queue\_cond}, NULL);

  \hyperlink{lspg_8c_a61e47be0d5d7154700e7e5edb889852e}{lspg\_demandairrights\_init}();
  \hyperlink{lspg_8c_ad31db17587a02302ac4e40fb7d260b1b}{lspg\_getcenter\_init}();
  \hyperlink{lspg_8c_a5d6f6c4733629fc14e4f0bc128a1ffb7}{lspg\_getcurrentsampleid\_init}();
  \hyperlink{lspg_8c_a0e9bbf847dadfe0d10830d67824d9be8}{lspg\_lock\_detector\_init}();
  \hyperlink{lspg_8c_a39bb94f8e0d47702b2b920a3dee61ebc}{lspg\_lock\_diffractometer\_init}();
  \hyperlink{lspg_8c_a2faa901ea0a8ef00cfd93a893b34b446}{lspg\_nextsample\_init}();
  \hyperlink{lspg_8c_aff91db7d60e6c832684c023813e36dbf}{lspg\_nextshot\_init}();
  \hyperlink{lspg_8c_a31823ecb2b44d4a6674f804059a27bce}{lspg\_seq\_run\_prep\_init}();
  \hyperlink{lspg_8c_ab98f7d254fa0f5f4826f9427ca8b4f03}{lspg\_starttransfer\_init}();
  \hyperlink{lspg_8c_a3517f8fbed91c998f6036284f9bd0c48}{lspg\_wait\_for\_detector\_init}();
  \hyperlink{lspg_8c_a32b2bf00d66ee5fca130ee616a09cf7b}{lspg\_waitcryo\_init}();
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a4cc866393eda0cf20276d035f6fbe206}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-nextsample\-\_\-all@{lspg\-\_\-nextsample\-\_\-all}}
\index{lspg\-\_\-nextsample\-\_\-all@{lspg\-\_\-nextsample\-\_\-all}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-nextsample\-\_\-all}]{\setlength{\rightskip}{0pt plus 5cm}unsigned int lspg\-\_\-nextsample\-\_\-all (
\begin{DoxyParamCaption}
\item[{int $\ast$}]{err}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a4cc866393eda0cf20276d035f6fbe206}


Definition at line 608 of file lspg.\-c.


\begin{DoxyCode}
                                            \{
  \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} rtn;

  \hyperlink{lspg_8c_aab1c441d22126ea4334b3c61b7e4b4c2}{lspg\_nextsample\_call}();
  \hyperlink{lspg_8c_a32878d3d29f4595d1d2b861d7e871726}{lspg\_nextsample\_wait}();

  \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_aeee8110133db9f1895237ed9b54dd873}{no\_rows\_returned} || 
      \hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_ade2772532d53709c5144d07332966a4a}{query\_error}) \{
    rtn = 0;
    *err = \hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_ade2772532d53709c5144d07332966a4a}{query\_error} ? 2 : 1;
  \} \textcolor{keywordflow}{else} \{
    \textcolor{keywordflow}{if}( \hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_a2ca6e2a667c9fe7f1a54329de04d2a3c}{nextsample\_isnull}) \{
      rtn = 0;
      *err = 1;
    \} \textcolor{keywordflow}{else} \{
      rtn = \hyperlink{lspg_8c_adbf70f382e469e02dce77833981f9547}{lspg\_nextsample}.\hyperlink{structlspg__nextsample__struct_aecd82b329462ae06bc2f0d162985a086}{nextsample};
      *err = 0;
    \}
  \}
  \hyperlink{lspg_8c_ac52207cc8f4c14494ae6f4972b6a3b23}{lspg\_nextsample\_done}();

  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_af17ef79544ca5d78fd477010fe90d538}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-nextshot\-\_\-call@{lspg\-\_\-nextshot\-\_\-call}}
\index{lspg\-\_\-nextshot\-\_\-call@{lspg\-\_\-nextshot\-\_\-call}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-nextshot\-\_\-call}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-nextshot\-\_\-call (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_af17ef79544ca5d78fd477010fe90d538}


Queue up a nextshot query. 



Definition at line 1001 of file lspg.\-c.


\begin{DoxyCode}
                          \{
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a38b657155fbee9b73278f76912cf2333}{mutex}));
  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_adb8da14444b98f556dba9420dd4666dc}{new\_value\_ready} = 0;
  \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_aa50fbe34bd93ccc3762a804e95f8fd10}{query\_error}     = 0;
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a38b657155fbee9b73278f76912cf2333}{mutex}));
  
  \hyperlink{kvredis_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( \hyperlink{lspg_8c_a9e92a204f606761d368ac7e06ef0f09c}{lspg\_nextshot\_cb}, 
      \hyperlink{lspg_8c_a83677bfe7aab92df2d6d93fdf8cd2280}{lspg\_nextshot\_error\_cb}, \textcolor{stringliteral}{"SELECT * FROM px.nextshot2()"});
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a50458a014041a4118452802dfb303960}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-nextshot\-\_\-done@{lspg\-\_\-nextshot\-\_\-done}}
\index{lspg\-\_\-nextshot\-\_\-done@{lspg\-\_\-nextshot\-\_\-done}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-nextshot\-\_\-done}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-nextshot\-\_\-done (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a50458a014041a4118452802dfb303960}


Called when the next shot query has been processed. 



Definition at line 1020 of file lspg.\-c.


\begin{DoxyCode}
                          \{
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a38b657155fbee9b73278f76912cf2333}{mutex}));
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a784a6de32a86fec9efb3ef3ae4b6e3ac}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-nextshot\-\_\-wait@{lspg\-\_\-nextshot\-\_\-wait}}
\index{lspg\-\_\-nextshot\-\_\-wait@{lspg\-\_\-nextshot\-\_\-wait}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-nextshot\-\_\-wait}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-nextshot\-\_\-wait (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a784a6de32a86fec9efb3ef3ae4b6e3ac}


Wait for the next shot query to get processed. 



Definition at line 1012 of file lspg.\-c.


\begin{DoxyCode}
                          \{
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_a38b657155fbee9b73278f76912cf2333}{mutex}));
  \textcolor{keywordflow}{while}( \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_adb8da14444b98f556dba9420dd4666dc}{new\_value\_ready} == 0 && 
      \hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_aa50fbe34bd93ccc3762a804e95f8fd10}{query\_error} == 0)
    pthread\_cond\_wait( &(\hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}.\hyperlink{structlspg__nextshot__struct_afc773a9eefc173aa98d5c2889e1d7669}{cond}), &(\hyperlink{lspg_8c_ad8d8e2f578ca79189a80c1fd5b60cefd}{lspg\_nextshot}
      .\hyperlink{structlspg__nextshot__struct_a38b657155fbee9b73278f76912cf2333}{mutex}));
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a5c9f2cdd05a9a7fc2c1e03ffebec9d9f}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-query\-\_\-push@{lspg\-\_\-query\-\_\-push}}
\index{lspg\-\_\-query\-\_\-push@{lspg\-\_\-query\-\_\-push}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-query\-\_\-push}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-query\-\_\-push (
\begin{DoxyParamCaption}
\item[{void($\ast$)({\bf lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$, P\-Gresult $\ast$)}]{cb, }
\item[{void($\ast$)()}]{ecb, }
\item[{char $\ast$}]{fmt, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a5c9f2cdd05a9a7fc2c1e03ffebec9d9f}


Place a query on the queue. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em cb} & Our callback function that deals with the response \\
\hline
\mbox{\tt in}  & {\em ecb} & error response \\
\hline
\mbox{\tt in}  & {\em fmt} & Printf style function to generate the query \\
\hline
\end{DoxyParams}


Definition at line 130 of file lspg.\-c.


\begin{DoxyCode}
                       \{
  \textcolor{keywordtype}{int} idx;
  va\_list arg\_ptr;

  pthread\_mutex\_lock( &\hyperlink{lspg_8c_aed46a94106c583796e3a8ca0e89aa8e4}{lspg\_queue\_mutex});

  \textcolor{comment}{//}
  \textcolor{comment}{// Pause the thread while we service the queue}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{while}( (\hyperlink{lspg_8c_a3cbe7f3161b3c1838ebc56a3bbcfd8a6}{lspg\_query\_queue\_on} + 1) % \hyperlink{lspg_8c_a08fe83fe8226002ee8b80ce0a914fd11}{
      LS\_PG\_QUERY\_QUEUE\_LENGTH} == \hyperlink{lspg_8c_aca86bb77d6cecfae9251743f4171bafb}{lspg\_query\_queue\_off} % 
      \hyperlink{lspg_8c_a08fe83fe8226002ee8b80ce0a914fd11}{LS\_PG\_QUERY\_QUEUE\_LENGTH}) \{
    pthread\_cond\_wait( &\hyperlink{lspg_8c_a61a308b6a37afd645beb422653b95baa}{lspg\_queue\_cond}, &\hyperlink{lspg_8c_aed46a94106c583796e3a8ca0e89aa8e4}{lspg\_queue\_mutex}
      );
  \}

  idx = \hyperlink{lspg_8c_a3cbe7f3161b3c1838ebc56a3bbcfd8a6}{lspg\_query\_queue\_on} % \hyperlink{lspg_8c_a08fe83fe8226002ee8b80ce0a914fd11}{LS\_PG\_QUERY\_QUEUE\_LENGTH}
      ;

  va\_start( arg\_ptr, fmt);
  vsnprintf( \hyperlink{lspg_8c_a357d9d98f0b8c9625ccebcebfcdce955}{lspg\_query\_queue}[idx].qs, \hyperlink{kvredis_8c_a3a8ef1b4b5994d6dd12bf74454ea891b}{
      LS\_PG\_QUERY\_STRING\_LENGTH}-1, fmt, arg\_ptr);
  va\_end( arg\_ptr);

  \hyperlink{lspg_8c_a357d9d98f0b8c9625ccebcebfcdce955}{lspg\_query\_queue}[idx].\hyperlink{structlspgQueryQueueStruct_a1389b3ec4ddf9ed5cc0344d229a7ff9e}{qs}[\hyperlink{kvredis_8c_a3a8ef1b4b5994d6dd12bf74454ea891b}{LS\_PG\_QUERY\_STRING\_LENGTH}
       - 1] = 0;
  \hyperlink{lspg_8c_a357d9d98f0b8c9625ccebcebfcdce955}{lspg\_query\_queue}[idx].\hyperlink{structlspgQueryQueueStruct_a53bac5ae4cab775423940bff5092a831}{onResponse} = cb;
  \hyperlink{lspg_8c_a357d9d98f0b8c9625ccebcebfcdce955}{lspg\_query\_queue}[idx].\hyperlink{structlspgQueryQueueStruct_ac7e4b4a8c59d7c814670ed1004154c2c}{onError}    = er;
  \hyperlink{lspg_8c_a3cbe7f3161b3c1838ebc56a3bbcfd8a6}{lspg\_query\_queue\_on}++;

  pthread\_kill( \hyperlink{lspg_8c_a04eb0cda0d5e5afeae7c393b51689765}{lspg\_thread}, SIGUSR1);
  pthread\_mutex\_unlock( &\hyperlink{lspg_8c_aed46a94106c583796e3a8ca0e89aa8e4}{lspg\_queue\_mutex});
\};
\end{DoxyCode}
\hypertarget{pgpmac_8h_a80df49750b61bb2526618db4253fc4ce}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-run@{lspg\-\_\-run}}
\index{lspg\-\_\-run@{lspg\-\_\-run}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-run}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-t$\ast$ lspg\-\_\-run (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a80df49750b61bb2526618db4253fc4ce}


Start 'er runnin'. 



Definition at line 2180 of file lspg.\-c.


\begin{DoxyCode}
                      \{

  pthread\_create( &\hyperlink{lspg_8c_a04eb0cda0d5e5afeae7c393b51689765}{lspg\_thread}, NULL, \hyperlink{lspg_8c_aaf4fadd2943fa3a2ecb5d840e84d68fa}{lspg\_worker}, NULL);
  \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^(appy|appz|capy|capz|scint) In
       Position$"}, \hyperlink{lspg_8c_a4710c50945fce26b4ac5dc01ed61459d}{lspg\_check\_preset\_in\_position\_cb});
  \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^(appy|appz|capy|capz|scint)
       Moving$"},      \hyperlink{lspg_8c_abcdcee6ef5ed0865056d42a6cf9da8bd}{lspg\_unset\_current\_preset\_moving\_cb}
      );
  \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^Preset Changed (.+)"},          
                  \hyperlink{lspg_8c_a69a792e1981af00b2818bcda89bdaa02}{lspg\_preset\_changed\_cb});
  \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^Sample(Detected|Absent)$"},     
                  \hyperlink{lspg_8c_a14546bac5695b536cd348d5e0a1661fa}{lspg\_sample\_detector\_cb});
  \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^Timer Update KVs$"},            
                  \hyperlink{lspg_8c_ad503cefdaee8112ea2129d33db2ec7fa}{lspg\_update\_kvs\_cb});
  \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^cam.zoom In Position$"},        
                  \hyperlink{lspg_8c_af61ae1cf46d67e29dfc690b9a98b1b4d}{lspg\_set\_scale\_cb});
  \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^Quitting Program$"},            
                  \hyperlink{lspg_8c_a91e910f7ab9b340bea598b01450e9c6b}{lspg\_quitting\_cb});
  \hyperlink{lstimer_8c_a7b3e725fbe1bb3cc9f8465941cf1e381}{lstimer\_set\_timer}(     \textcolor{stringliteral}{"Timer Update KVs"}, -1, 0, 500000000)
      ;

  \textcolor{comment}{//}
  \textcolor{comment}{// Make sure we own the airrights}
  \textcolor{comment}{//}
  \hyperlink{lspg_8c_aa4cad634cac645d0366acbb25cef7b96}{lspg\_demandairrights\_all}();

  \textcolor{keywordflow}{return}( &\hyperlink{lspg_8c_a04eb0cda0d5e5afeae7c393b51689765}{lspg\_thread});
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a5d3cf153b086f5252f248d17db824917}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-all@{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-all}}
\index{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-all@{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-all}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-all}]{\setlength{\rightskip}{0pt plus 5cm}int lspg\-\_\-seq\-\_\-run\-\_\-prep\-\_\-all (
\begin{DoxyParamCaption}
\item[{long long}]{skey, }
\item[{double}]{kappa, }
\item[{double}]{phi, }
\item[{double}]{cx, }
\item[{double}]{cy, }
\item[{double}]{ax, }
\item[{double}]{ay, }
\item[{double}]{az}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a5d3cf153b086f5252f248d17db824917}


Convinence function to call seq run prep. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em skey} & px.\-shots key for this image \\
\hline
\mbox{\tt in}  & {\em kappa} & current kappa postion \\
\hline
\mbox{\tt in}  & {\em phi} & current phi postition \\
\hline
\mbox{\tt in}  & {\em cx} & current center table x \\
\hline
\mbox{\tt in}  & {\em cy} & current center table y \\
\hline
\mbox{\tt in}  & {\em ax} & current alignment table x \\
\hline
\mbox{\tt in}  & {\em ay} & current alignment table y \\
\hline
\mbox{\tt in}  & {\em az} & current alignment table z \\
\hline
\end{DoxyParams}


Definition at line 1324 of file lspg.\-c.


\begin{DoxyCode}
                             \{
  \textcolor{keywordtype}{int} rtn;
  \hyperlink{lspg_8c_af7d6efd861b152a371442791deb42bd3}{lspg\_seq\_run\_prep\_call}( skey, \hyperlink{lspmac_8c_a0be79ccb7ebf3a665248fd856112b9fd}{kappa}, \hyperlink{lspmac_8c_ac8070dc568ad974a3db42b51eca828cc}{phi}, cx, 
      cy, ax, ay, az);
  \hyperlink{lspg_8c_ac0b01f501322432a8fa37f31898c3499}{lspg\_seq\_run\_prep\_wait}();
  rtn = \hyperlink{lspg_8c_a1b0d9fc30bcea6905b075d2362149172}{lspg\_seq\_run\_prep}.\hyperlink{structlspg__seq__run__prep__struct_af7ff6fa6075cabb2bf51ce63afaeee25}{query\_error};
  \hyperlink{lspg_8c_a472b09ddf716c80207f97e2bb5d37d66}{lspg\_seq\_run\_prep\_done}();
  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_af72c4b037347737df09348ab703f6802}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-starttransfer\-\_\-call@{lspg\-\_\-starttransfer\-\_\-call}}
\index{lspg\-\_\-starttransfer\-\_\-call@{lspg\-\_\-starttransfer\-\_\-call}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-starttransfer\-\_\-call}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-starttransfer\-\_\-call (
\begin{DoxyParamCaption}
\item[{unsigned int}]{nextsample, }
\item[{int}]{sample\-\_\-detected, }
\item[{double}]{ax, }
\item[{double}]{ay, }
\item[{double}]{az, }
\item[{double}]{horz, }
\item[{double}]{vert, }
\item[{double}]{esttime}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_af72c4b037347737df09348ab703f6802}


Definition at line 405 of file lspg.\-c.


\begin{DoxyCode}
                                                                               
                                                                              \{
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_a47824bb2701a699d43a7a916e2010705}{mutex}));
  \hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_ad3a6356e5ccce15c982ddecf9634999f}{new\_value\_ready} = 0;
  \hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_a5ef1d5a6708b3872761b86aef34d7aeb}{query\_error}     = 0;
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_a47824bb2701a699d43a7a916e2010705}{mutex}));

  \hyperlink{kvredis_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( \hyperlink{lspg_8c_a289005bed571909f5ce4de2ff4e70e36}{lspg\_starttransfer\_cb}, 
      \hyperlink{lspg_8c_aed6571a457cde0cd7c1ef1250d8f0a75}{lspg\_starttransfer\_error\_cb},
                   \textcolor{stringliteral}{"SELECT px.starttransfer( %d, %s, %.3f, %.3f, %.3f, %.3f,
       %.3f, %.3f)"},
                   nextsample, \hyperlink{lspmac_8c_ac59ab990e48033a811aeb0281fb588fc}{sample\_detected} ? \textcolor{stringliteral}{"True"} : \textcolor{stringliteral}{"False
      "}, ax, ay, az, horz, vert, esttime);
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_ad989179281d8b65b940250a4580007d0}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-starttransfer\-\_\-done@{lspg\-\_\-starttransfer\-\_\-done}}
\index{lspg\-\_\-starttransfer\-\_\-done@{lspg\-\_\-starttransfer\-\_\-done}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-starttransfer\-\_\-done}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-starttransfer\-\_\-done (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_ad989179281d8b65b940250a4580007d0}


Definition at line 422 of file lspg.\-c.


\begin{DoxyCode}
                               \{
  pthread\_mutex\_unlock( &(\hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_a47824bb2701a699d43a7a916e2010705}{mutex}));
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a189e9fd5cbc06dd09e5549f6e229fa5e}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-starttransfer\-\_\-wait@{lspg\-\_\-starttransfer\-\_\-wait}}
\index{lspg\-\_\-starttransfer\-\_\-wait@{lspg\-\_\-starttransfer\-\_\-wait}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-starttransfer\-\_\-wait}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-starttransfer\-\_\-wait (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a189e9fd5cbc06dd09e5549f6e229fa5e}


Definition at line 416 of file lspg.\-c.


\begin{DoxyCode}
                               \{
  pthread\_mutex\_lock( &(\hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_a47824bb2701a699d43a7a916e2010705}{mutex}));
  \textcolor{keywordflow}{while}( \hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_ad3a6356e5ccce15c982ddecf9634999f}{new\_value\_ready} ==
       0 && \hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_a5ef1d5a6708b3872761b86aef34d7aeb}{query\_error} == 0)
    pthread\_cond\_wait( &(\hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_a1a569a2afabd7910219ff9d2d48c1b38}{cond}), &(
      \hyperlink{lspg_8c_af18499d17171eff473cfc49d4a0a5562}{lspg\_starttransfer}.\hyperlink{structlspg__starttransfer__struct_a47824bb2701a699d43a7a916e2010705}{mutex}));
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a68d367d98c780a95b2c347d09e9ddec3}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-waitcryo\-\_\-all@{lspg\-\_\-waitcryo\-\_\-all}}
\index{lspg\-\_\-waitcryo\-\_\-all@{lspg\-\_\-waitcryo\-\_\-all}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-waitcryo\-\_\-all}]{\setlength{\rightskip}{0pt plus 5cm}int lspg\-\_\-waitcryo\-\_\-all (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a68d367d98c780a95b2c347d09e9ddec3}


no need to get fancy with the wait cryo command It should not return until the robot is almost ready for air rights 



Definition at line 655 of file lspg.\-c.


\begin{DoxyCode}
                        \{
  \textcolor{keywordtype}{int} rtn;
  pthread\_mutex\_lock( &\hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}.\hyperlink{structlspg__waitcryo__struct_a62b50ead380fc8a6be35956eba384ba6}{mutex});
  \hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}.\hyperlink{structlspg__waitcryo__struct_a97298b773fd8c1f2ef20159093a08246}{new\_value\_ready} = 0;
  \hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}.\hyperlink{structlspg__waitcryo__struct_a562f641a86142566aa67dc41f2676fb7}{query\_error}     = 0;

  \hyperlink{kvredis_8c_a0bb9ef42da8fa21c4df48ec384ab69f4}{lspg\_query\_push}( \hyperlink{lspg_8c_a7497a7c924b31c727ea487a3efb77fb6}{lspg\_waitcryo\_cb}, 
      \hyperlink{lspg_8c_a21393baf18a3934474b40e0006d93d50}{lspg\_waitcryo\_error\_cb}, \textcolor{stringliteral}{"SELECT px.waitcryo()"});

  \textcolor{keywordflow}{while}( \hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}.\hyperlink{structlspg__waitcryo__struct_a97298b773fd8c1f2ef20159093a08246}{new\_value\_ready} == 0 && 
      \hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}.\hyperlink{structlspg__waitcryo__struct_a562f641a86142566aa67dc41f2676fb7}{query\_error} == 0)
    pthread\_cond\_wait( &\hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}.\hyperlink{structlspg__waitcryo__struct_a54c275159d9f096e0d1884e64d099298}{cond}, &\hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}
      .\hyperlink{structlspg__waitcryo__struct_a62b50ead380fc8a6be35956eba384ba6}{mutex});

  rtn = \hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}.\hyperlink{structlspg__waitcryo__struct_a562f641a86142566aa67dc41f2676fb7}{query\_error};
  pthread\_mutex\_unlock( &\hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}.\hyperlink{structlspg__waitcryo__struct_a62b50ead380fc8a6be35956eba384ba6}{mutex});

  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a7497a7c924b31c727ea487a3efb77fb6}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-waitcryo\-\_\-cb@{lspg\-\_\-waitcryo\-\_\-cb}}
\index{lspg\-\_\-waitcryo\-\_\-cb@{lspg\-\_\-waitcryo\-\_\-cb}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-waitcryo\-\_\-cb}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-waitcryo\-\_\-cb (
\begin{DoxyParamCaption}
\item[{{\bf lspg\-\_\-query\-\_\-queue\-\_\-t} $\ast$}]{qqp, }
\item[{P\-Gresult $\ast$}]{pgr}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a7497a7c924b31c727ea487a3efb77fb6}


Definition at line 638 of file lspg.\-c.


\begin{DoxyCode}
                                                               \{
  pthread\_mutex\_lock( &\hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}.\hyperlink{structlspg__waitcryo__struct_a62b50ead380fc8a6be35956eba384ba6}{mutex});
  \hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}.\hyperlink{structlspg__waitcryo__struct_a97298b773fd8c1f2ef20159093a08246}{new\_value\_ready} = 1;
  pthread\_cond\_signal( &\hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}.\hyperlink{structlspg__waitcryo__struct_a54c275159d9f096e0d1884e64d099298}{cond});
  pthread\_mutex\_unlock( &\hyperlink{lspg_8c_a5f699604dcc5d3d64fd6cb5c363d29c9}{lspg\_waitcryo}.\hyperlink{structlspg__waitcryo__struct_a62b50ead380fc8a6be35956eba384ba6}{mutex});
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a95e3fd7c1685d7e6ab6d0a295ab42f78}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-zoom\-\_\-lut\-\_\-call@{lspg\-\_\-zoom\-\_\-lut\-\_\-call}}
\index{lspg\-\_\-zoom\-\_\-lut\-\_\-call@{lspg\-\_\-zoom\-\_\-lut\-\_\-call}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-zoom\-\_\-lut\-\_\-call}]{\setlength{\rightskip}{0pt plus 5cm}void lspg\-\_\-zoom\-\_\-lut\-\_\-call (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a95e3fd7c1685d7e6ab6d0a295ab42f78}
\hypertarget{pgpmac_8h_a85f7a5e4d853b7a86ddde1006dd4dc1f}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-abort@{lspmac\-\_\-abort}}
\index{lspmac\-\_\-abort@{lspmac\-\_\-abort}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-abort}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-abort (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a85f7a5e4d853b7a86ddde1006dd4dc1f}


abort motion and try to recover 



Definition at line 2115 of file lspmac.\-c.


\begin{DoxyCode}
                    \{
  \textcolor{comment}{//}
  \textcolor{comment}{// Stop everything!  (consider ^O instead of ^A)}
  \textcolor{comment}{//}
  \hyperlink{lspmac_8c_a0575fc751cecf35ffe8b290ab483ac21}{lspmac\_SockSendDPControlChar}( \textcolor{stringliteral}{"Abort Request"}, 0
      x01);

  \textcolor{comment}{//}
  \textcolor{comment}{// and reset motion flag}
  \textcolor{comment}{//}
  \hyperlink{lspmac_8c_afab9e8f0502a92ee5cf93209af710f81}{lspmac\_SockSendDPline}( \textcolor{stringliteral}{"Reset"}, \textcolor{stringliteral}{"%s"}, \textcolor{stringliteral}{"M5075=0"});

\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a83ba40e81c04ecc11009be6cbed0c5e1}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-est\-\_\-move\-\_\-time@{lspmac\-\_\-est\-\_\-move\-\_\-time}}
\index{lspmac\-\_\-est\-\_\-move\-\_\-time@{lspmac\-\_\-est\-\_\-move\-\_\-time}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-est\-\_\-move\-\_\-time}]{\setlength{\rightskip}{0pt plus 5cm}int lspmac\-\_\-est\-\_\-move\-\_\-time (
\begin{DoxyParamCaption}
\item[{double $\ast$}]{est\-\_\-time, }
\item[{int $\ast$}]{mmaskp, }
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{mp\-\_\-1, }
\item[{int}]{jog\-\_\-1, }
\item[{char $\ast$}]{preset\-\_\-1, }
\item[{double}]{end\-\_\-point\-\_\-1, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a83ba40e81c04ecc11009be6cbed0c5e1}


Move the motors and estimate the time it'll take to finish the job. 

Returns the estimate time and the coordinate system mask to waite for 
\begin{DoxyParams}{Parameters}
{\em est\-\_\-time} & Returns number of seconds we estimate the move(s) will take \\
\hline
{\em mmaskp} & Mask of coordinate systems we are trying to move, excluding jogs. Used to wait for motions to complete \\
\hline
{\em mp\-\_\-1} & Pointer to first motor \\
\hline
{\em jog\-\_\-1} & 1 to force a jog, 0 to try a motion program D\-O N\-O\-T M\-I\-X J\-O\-G\-S A\-N\-D M\-O\-T\-I\-O\-N P\-R\-O\-G\-R\-A\-M\-S I\-N T\-H\-E S\-A\-M\-E C\-O\-O\-R\-D\-I\-N\-A\-T\-E S\-Y\-S\-T\-E\-M! \\
\hline
{\em preset\-\_\-1} & Name of preset we'd like to move to or N\-U\-L\-L if end\-\_\-point\-\_\-1 should be used instead \\
\hline
{\em end\-\_\-point\-\_\-1} & End point for the first motor. Ignored if preset\-\_\-1 is non null and identifies a valid preset for this motor \\
\hline
{\em ...} & Perhaps more quads of motors, jog flags, preset names, and end points. End is a N\-U\-L\-L motor pointer M\-U\-S\-T E\-N\-D A\-R\-G L\-I\-S\-T W\-I\-T\-H N\-U\-L\-L \\
\hline
\end{DoxyParams}
$<$ units to counts

$<$ The total distance we need to go

$<$ Our maximum velocity

$<$ Our maximum acceleration

$<$ Total time for this motor

$<$ coordinate system motion flags 

Definition at line 2840 of file lspmac.\-c.


\begin{DoxyCode}
                                                                               
                                                          \{
  \textcolor{keyword}{static} \textcolor{keywordtype}{char} axes[] = \textcolor{stringliteral}{"XYZUVWABC"};
  \textcolor{keywordtype}{int} qs[9];
  \hyperlink{structlspmac__combined__move__struct}{lspmac\_combined\_move\_t} motions[32];
  \textcolor{keywordtype}{char} s[256];
  \textcolor{keywordtype}{int} foundone;
  \textcolor{keywordtype}{int} moving\_flags;
  \textcolor{keyword}{struct }timespec timeout;
  \textcolor{keywordtype}{int} j;
  va\_list arg\_ptr;
  \hyperlink{structlspmac__motor__struct}{lspmac\_motor\_t} *mp;
  \textcolor{keywordtype}{double} ep, maybe\_ep;
  \textcolor{keywordtype}{char} *ps;
  \textcolor{keywordtype}{double}
    min\_pos,
    max\_pos,
    neutral\_pos,
    u2c,                
    D,                  
    V,                  
    A,                  
    Tt;                 
  \textcolor{keywordtype}{int} err;
  \textcolor{keywordtype}{int} jog;
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};
  uint32\_t m5075;               

  \textcolor{comment}{// reset our coordinate flags and command strings}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{for}( i=0; i<32; i++) \{
    motions[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}].\hyperlink{structlspmac__combined__move__struct_a650f35e534bd22bdb45d5361f75eaae8}{moveme} = 0;
  \}
  m5075  = 0;
  \textcolor{keywordflow}{if}( mmaskp != NULL)
    *mmaskp = 0;

  \textcolor{comment}{//}
  \textcolor{comment}{// Initialze first iteration}
  \textcolor{comment}{//}
  *est\_time = 0.0;
  mp  = mp\_1;
  ps  = preset\_1;
  ep  = end\_point\_1;
  jog = jog\_1;

  va\_start( arg\_ptr, end\_point\_1);
  \textcolor{keywordflow}{while}( 1) \{
    \textcolor{comment}{/*}
\textcolor{comment}{     *    :                  |       Constant       |}
\textcolor{comment}{     *    :                  |<---   Velocity   --->|}
\textcolor{comment}{     *    :                  |       Time (Ct)      |}
\textcolor{comment}{     *  V :                   ----------------------              ---------}
\textcolor{comment}{     *  e :                 /                        \(\backslash\)               ^}
\textcolor{comment}{     *  l :                /                          \(\backslash\)              |}
\textcolor{comment}{     *  o :               /                            \(\backslash\)             |}
\textcolor{comment}{     *  c :              /                              \(\backslash\)            V}
\textcolor{comment}{     *  i :             /                                \(\backslash\)           |}
\textcolor{comment}{     *  t :            /                                  \(\backslash\)          |}
\textcolor{comment}{     *  y :\_\_\_\_\_\_\_\_\_\_\_/
      ....................................\(\backslash\)\_\_\_\_\_\_\_\_\_v\_\_\_\_\_\_\_\_\_\_\_}
\textcolor{comment}{     *                |      |         Time              }
\textcolor{comment}{     *                |      |}
\textcolor{comment}{     *             -->|      |<-- Acceleration Time  (At)}
\textcolor{comment}{     *                |}
\textcolor{comment}{     *                |<-----    Total  Time (Tt)  ------->|}
\textcolor{comment}{     *}
\textcolor{comment}{     *      Assumption 1: We can replace S curve acceleration with linear
       acceleration}
\textcolor{comment}{     *      for the purposes of distance and time calculations for the timeout}
\textcolor{comment}{     *      period that we are attempting to calculate here.}
\textcolor{comment}{     *}
\textcolor{comment}{     *      Ct  = Constant Velocity Time.  The time spent at constant velocity.}
\textcolor{comment}{     *}
\textcolor{comment}{     *      At  = Acceleration Time.  Time spent accelerating at either end of
       the ramp, that is,}
\textcolor{comment}{     *      1/2 the total time spent accelerating and decelerating.}
\textcolor{comment}{     *}
\textcolor{comment}{     *      D   = the total distance we need to travel}
\textcolor{comment}{     *}
\textcolor{comment}{     *      V   = constant velocity.  Here we use the motor's maximum velocity.}
\textcolor{comment}{     *}
\textcolor{comment}{     *      A   = the motor acceleration, Here it's the maximum acceleration.}
\textcolor{comment}{     *}
\textcolor{comment}{     *      V = A * At   }
\textcolor{comment}{     *}
\textcolor{comment}{     *      or  At = V/A}
\textcolor{comment}{     *}
\textcolor{comment}{     *      The Total Time (Tt) is}
\textcolor{comment}{     *}
\textcolor{comment}{     *      Tt = Ct + 2 * At}
\textcolor{comment}{     *}
\textcolor{comment}{     *}
\textcolor{comment}{     *}
\textcolor{comment}{     *      If we had infinite acceleration the total time would be D/V.  To
       account for finite acceleration we just need to}
\textcolor{comment}{     *      adjust this for the average velocity while accelerating (0.5 V). 
       This neatly adds a single V/A term:}
\textcolor{comment}{     *}
\textcolor{comment}{     *      (1)     Tt = D/V  + V/A}
\textcolor{comment}{     *}
\textcolor{comment}{     *      When the distance is short, we need a different calculation:}
\textcolor{comment}{     *}
\textcolor{comment}{     *      D = 0.5 * A * T1^2  + 0.5 * A * T2^2  (T1 = acceleration time and
       T2 = deceleration time)}
\textcolor{comment}{     *}
\textcolor{comment}{     *      or, since total time  Tt = T1 + T2 and T1 = T2,}
\textcolor{comment}{     *}
\textcolor{comment}{     *      D = A * (0.5*Tt)^2}
\textcolor{comment}{     *}
\textcolor{comment}{     *      or}
\textcolor{comment}{     *      }
\textcolor{comment}{     *      (2)    Tt = 2 * sqrt( D/A)}
\textcolor{comment}{     *}
\textcolor{comment}{     *}
\textcolor{comment}{     *      When we accelerate to the maximum speed the time it takes is V/A so
       the distance we travel (Da) is}
\textcolor{comment}{     *}
\textcolor{comment}{     *      Da = 0.5 * A * (V/A)^2}
\textcolor{comment}{     *}
\textcolor{comment}{     *      or}
\textcolor{comment}{     *}
\textcolor{comment}{     *      Da = 0.5 * V^2 / A}
\textcolor{comment}{     *}
\textcolor{comment}{     *      So when D > 2 * Da, or}
\textcolor{comment}{     *}
\textcolor{comment}{     *      D > V^2 / A}
\textcolor{comment}{     *         }
\textcolor{comment}{     *      we need to use equation (1) otherwise we need to use equation (2)}
\textcolor{comment}{     *}
\textcolor{comment}{     */}

    \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a3342670c97c0b2646409f2ef28f63d1c}{magic} != \hyperlink{pgpmac_8h_abe2a74d23400d8d8fe02dc407c242035}{LSPMAC\_MAGIC\_NUMBER}) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspmac\_est\_move\_time:
       WARNING: bad motor structure.  Check that your motor list is NULL terminated."});
      \textcolor{keywordflow}{break};
    \}


    \textcolor{comment}{//lslogging\_log\_message( "lspmac\_est\_move\_time: find motor %s, jog %d,
       preset %s, endpoint %f",}
    \textcolor{comment}{//mp->name, jog, ps == NULL ? "NULL" : ps, ep);}

    Tt = 0.0;
    \textcolor{keywordflow}{if}( mp != NULL && mp->\hyperlink{structlspmac__motor__struct_a69e49769a1001665377efc7193d88a0a}{max\_speed} != NULL && mp->\hyperlink{structlspmac__motor__struct_a50cf4c0711cea164e332bc34705a1a68}{max\_accel} 
      != NULL && mp->\hyperlink{structlspmac__motor__struct_a8838915ebb6f9989944117c8197d5e86}{u2c} != NULL) \{

      \textcolor{comment}{//}
      \textcolor{comment}{// get the real endpoint if a preset was mentioned}
      \textcolor{comment}{//}
      \textcolor{keywordflow}{if}( ps != NULL && *ps != 0) \{
        err = \hyperlink{lsredis_8c_a87d7bb0ade6f247edfbb7803aac9e694}{lsredis\_find\_preset}( mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name}, ps, &
      maybe\_ep);
        \textcolor{keywordflow}{if}( err != 0)
          ep = maybe\_ep;
      \}

      u2c = \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\_getd}( mp->\hyperlink{structlspmac__motor__struct_a8838915ebb6f9989944117c8197d5e86}{u2c});

      \textcolor{comment}{//}
      \textcolor{comment}{// For look up tables user units are (or should be) counts and u2c should
       be 1}
      \textcolor{comment}{//}
      \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a11cbc6f50c150ed446e9a901cf7cc12b}{nlut} > 0 && mp->\hyperlink{structlspmac__motor__struct_a7b43671f7f3e06521f6cf91fb9ac707d}{lut} != NULL) \{
        u2c = 1.0;
        D = \hyperlink{lspmac_8c_a55b882be15d56a2a777f2b1f92901b7d}{lspmac\_lut}( mp->\hyperlink{structlspmac__motor__struct_a11cbc6f50c150ed446e9a901cf7cc12b}{nlut}, mp->\hyperlink{structlspmac__motor__struct_a7b43671f7f3e06521f6cf91fb9ac707d}{lut}, ep) - \hyperlink{lspmac_8c_a55b882be15d56a2a777f2b1f92901b7d}{lspmac\_lut}
      ( mp->\hyperlink{structlspmac__motor__struct_a11cbc6f50c150ed446e9a901cf7cc12b}{nlut}, mp->\hyperlink{structlspmac__motor__struct_a7b43671f7f3e06521f6cf91fb9ac707d}{lut}, \hyperlink{lspmac_8c_acc46bdddee59bd8c5ad662b3fd445e9f}{lspmac\_getPosition}( mp));
      \} \textcolor{keywordflow}{else} \{
        D = ep - \hyperlink{lspmac_8c_acc46bdddee59bd8c5ad662b3fd445e9f}{lspmac\_getPosition}( mp);                             \textcolor{comment}{
      // User units}
      \}

      V = \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\_getd}( mp->\hyperlink{structlspmac__motor__struct_a69e49769a1001665377efc7193d88a0a}{max\_speed}) / u2c * 1000.;              \textcolor{comment}{
      // User units per second}
      A = \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\_getd}( mp->\hyperlink{structlspmac__motor__struct_a50cf4c0711cea164e332bc34705a1a68}{max\_accel}) / u2c * 1000. * 
      1000;       \textcolor{comment}{// User units per second per second}


      neutral\_pos = \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\_getd}( mp->\hyperlink{structlspmac__motor__struct_ae931e9bc9fc2fa82ca649334fc052fbe}{neutral\_pos});
      min\_pos     = \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\_getd}( mp->\hyperlink{structlspmac__motor__struct_a7c1f2f67c64d26b12d6bb0d681797d8d}{min\_pos}) - neutral\_pos
      ;
      max\_pos     = \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\_getd}( mp->\hyperlink{structlspmac__motor__struct_aac8c31a857910cdcbb409331e128e766}{max\_pos}) - neutral\_pos
      ;

      \textcolor{keywordflow}{if}( ep < min\_pos || ep > max\_pos) \{
        \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspmac\_est\_move\_time:
       Motor %s Requested position %f out of range: min=%f, max=%f"}, mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name}, ep, 
      min\_pos, max\_pos);
        \hyperlink{lsevents_8c_a5c6f122382dea3dcc231b772e5e75b46}{lsevents\_send\_event}( \textcolor{stringliteral}{"%s Move Aborted"}, mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name}
      );
        \textcolor{keywordflow}{return} 1;
      \}

      mp->\hyperlink{structlspmac__motor__struct_af8cdc94c6e2478b12ce942d4cf1d7499}{requested\_position} = ep;
      mp->\hyperlink{structlspmac__motor__struct_a6e8dc9c11dc52a439fe9837230f93ce2}{requested\_pos\_cnts} = u2c * (mp->\hyperlink{structlspmac__motor__struct_af8cdc94c6e2478b12ce942d4cf1d7499}{requested\_position}
       + neutral\_pos);


      \textcolor{comment}{//}
      \textcolor{comment}{// Don't bother with motors without velocity or acceleration defined}
      \textcolor{comment}{//}
      \textcolor{keywordflow}{if}( V > 0.0 && A > 0.0) \{
        \textcolor{keywordflow}{if}( fabs(D) > V*V/A) \{
          \textcolor{comment}{//}
          \textcolor{comment}{// Normal ramp up, constant velocity, and ramp down}
          \textcolor{comment}{//}
          Tt = fabs(D)/V + V/A;
        \} \textcolor{keywordflow}{else} \{
          \textcolor{comment}{//}
          \textcolor{comment}{// Never reach constantant velocity, just ramp up a bit and back down}
          \textcolor{comment}{//}
          Tt = 2.0 * sqrt( fabs(D)/A);
        \}

        \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspmac\_est\_move\_time:
       Motor: %s  D: %f  VV/A: %f  Tt: %f"}, mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name}, D, V*V/A, Tt);
      \}  \textcolor{keywordflow}{else} \{
        \textcolor{comment}{//}
        \textcolor{comment}{// TODO: insert move time based for DAC or BO motor like objects;}
        \textcolor{comment}{// For now assume 100 msec;}
        \textcolor{comment}{//}
        Tt = 0.1;
      \}

      \textcolor{comment}{// Perhaps flag a coordinate system}
      \textcolor{comment}{//}
      \textcolor{comment}{// We can move a motor that's not in a coordinate system but we cannot
       move a motor that is but does not}
      \textcolor{comment}{// have an axis defined if we are also moving one that does.  It's a
       limitation, I guess.}
      \textcolor{comment}{//}
      \textcolor{keywordflow}{if}( jog != 1 &&
          mp->\hyperlink{structlspmac__motor__struct_a5614e003272e8323f8809bf7b6559532}{coord\_num} != NULL && \hyperlink{lsredis_8c_a1923f998441f4f451204dfd214d52218}{lsredis\_getl}( mp->
      \hyperlink{structlspmac__motor__struct_a5614e003272e8323f8809bf7b6559532}{coord\_num}) > 0 && \hyperlink{lsredis_8c_a1923f998441f4f451204dfd214d52218}{lsredis\_getl}( mp->\hyperlink{structlspmac__motor__struct_a5614e003272e8323f8809bf7b6559532}{coord\_num}) <=
       16 &&
          mp->\hyperlink{structlspmac__motor__struct_ad6a51cca3c7e5f79168e5c33fd9e736b}{motor\_num} != NULL && \hyperlink{lsredis_8c_a1923f998441f4f451204dfd214d52218}{lsredis\_getl}( mp->
      \hyperlink{structlspmac__motor__struct_ad6a51cca3c7e5f79168e5c33fd9e736b}{motor\_num}) > 0 && mp->\hyperlink{structlspmac__motor__struct_a7437ef16c2dce65bde4dda1ea00e9df3}{axis} != NULL && \hyperlink{lsredis_8c_a0b7600b1c9a4550b32d4be019d25f941}{lsredis\_getc}( mp
      ->\hyperlink{structlspmac__motor__struct_a7437ef16c2dce65bde4dda1ea00e9df3}{axis}) != 0) \{
        \textcolor{keywordtype}{int} axis;
        \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_a292515b2acabb0dcade5b16584cdb011}{motor\_num};

        motor\_num = \hyperlink{lsredis_8c_a1923f998441f4f451204dfd214d52218}{lsredis\_getl}( mp->\hyperlink{structlspmac__motor__struct_ad6a51cca3c7e5f79168e5c33fd9e736b}{motor\_num});

        axis = \hyperlink{lsredis_8c_a0b7600b1c9a4550b32d4be019d25f941}{lsredis\_getc}( mp->\hyperlink{structlspmac__motor__struct_a7437ef16c2dce65bde4dda1ea00e9df3}{axis});
        \textcolor{keywordflow}{for}( j=0; j<\textcolor{keyword}{sizeof}(axes); j++) \{
          \textcolor{keywordflow}{if}( axis == axes[j])
            \textcolor{keywordflow}{break};
        \}

        \textcolor{keywordflow}{if}( j < \textcolor{keyword}{sizeof}( axes)) \{
          \textcolor{comment}{//}
          \textcolor{comment}{// Store the motion request for a normal PMAC motor}
          \textcolor{comment}{//}
          \textcolor{keywordtype}{int} cn;
          \textcolor{keywordtype}{int} in\_position\_band;

          cn = \hyperlink{lsredis_8c_a1923f998441f4f451204dfd214d52218}{lsredis\_getl}( mp->\hyperlink{structlspmac__motor__struct_a5614e003272e8323f8809bf7b6559532}{coord\_num});
          in\_position\_band = \hyperlink{lsredis_8c_a1923f998441f4f451204dfd214d52218}{lsredis\_getl}( mp->\hyperlink{structlspmac__motor__struct_a48de72c2442bd5aa9420fcfe6b4f265f}{in\_position\_band}
      );

          motions[motor\_num - 1].\hyperlink{structlspmac__combined__move__struct_a2ae011832de3009f7a08b3081b51b7a3}{coord\_num} = cn;
          motions[motor\_num - 1].\hyperlink{structlspmac__combined__move__struct_afedb95467295e8a6aa535974f5ad6300}{axis}      = j;
          motions[motor\_num - 1].\hyperlink{structlspmac__combined__move__struct_a5389f07fcf2b24b0e912aefb4141001d}{Delta}     = D * u2c;
          \textcolor{comment}{//}
          \textcolor{comment}{// Don't ask to run a motion program if we are already where we want
       to be}
          \textcolor{comment}{//}
          \textcolor{comment}{// Deadband is 10 counts except for zoom which is 100.}
          \textcolor{comment}{// We use Ixx28 In-Position Band which has units of 1/16 count}
          \textcolor{comment}{//}
          \textcolor{comment}{//}
          \textcolor{keywordflow}{if}( abs(motions[motor\_num - 1].Delta)*16 >= in\_position\_band) \{
            m5075 |= (1 << (cn - 1));
            motions[motor\_num - 1].\hyperlink{structlspmac__combined__move__struct_a650f35e534bd22bdb45d5361f75eaae8}{moveme}    = 1;
          \}       
          \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspmac\_est\_move\_time:
       moveme=%d  motor '%s' motions index=%d coord\_num=%d axis=%d Delta=%d   m5075=%u"},
                                 motions[motor\_num-1].moveme,  mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name}, 
      motor\_num -1, motions[motor\_num-1].\hyperlink{structlspmac__combined__move__struct_a2ae011832de3009f7a08b3081b51b7a3}{coord\_num}, motions[motor\_num-1].\hyperlink{structlspmac__combined__move__struct_afedb95467295e8a6aa535974f5ad6300}{axis}
      , motions[motor\_num-1].\hyperlink{structlspmac__combined__move__struct_a5389f07fcf2b24b0e912aefb4141001d}{Delta},
                                 m5075);
        \}
      \} \textcolor{keywordflow}{else} \{
        \textcolor{comment}{//}
        \textcolor{comment}{// Here we are dealing with a DAC or BO motor or just want to jog.}
        \textcolor{comment}{//}
        \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a86380d221e4b17eb8cf87a5ac656b669}{jogAbs}( mp, ep)) \{
          \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspmac\_est\_move\_time:
       motor %s failed to queue move of distance %f from %f"}, mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name}, D, 
      \hyperlink{lspmac_8c_acc46bdddee59bd8c5ad662b3fd445e9f}{lspmac\_getPosition}(mp));
          \hyperlink{lsevents_8c_a5c6f122382dea3dcc231b772e5e75b46}{lsevents\_send\_event}( \textcolor{stringliteral}{"Move Aborted"});
          \textcolor{keywordflow}{return} 1;
        \}
      \}
      \textcolor{comment}{//}
      \textcolor{comment}{// Update the estimated time}
      \textcolor{comment}{//}
      *est\_time = *est\_time < Tt ? Tt : *est\_time;
      
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspmac\_est\_move\_time:
       est\_time=%f"}, *est\_time);

    \}


    mp = va\_arg( arg\_ptr, \hyperlink{structlspmac__motor__struct}{lspmac\_motor\_t} *);
    \textcolor{keywordflow}{if}( mp == NULL)
      \textcolor{keywordflow}{break};

    jog = va\_arg( arg\_ptr, \textcolor{keywordtype}{int});
    ps  = va\_arg( arg\_ptr, \textcolor{keywordtype}{char} *);
    ep  = va\_arg( arg\_ptr, \textcolor{keywordtype}{double});

  \}
  va\_end( arg\_ptr);

  
  \textcolor{comment}{// Set the motion program flags}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( m5075 != 0) \{
    \textcolor{keywordflow}{if}( mmaskp != NULL)
      *mmaskp |= m5075; \textcolor{comment}{// Tell the caller about our new mask}

    
    pthread\_mutex\_lock( &\hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex});
    moving\_flags = \hyperlink{lspmac_8c_a7a32c617c183166308241e270959df56}{lspmac\_moving\_flags};
    pthread\_mutex\_unlock( &\hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex});

    \textcolor{keywordflow}{if}( (moving\_flags & m5075) != m5075) \{
      \hyperlink{lspmac_8c_afab9e8f0502a92ee5cf93209af710f81}{lspmac\_SockSendDPline}( NULL, \textcolor{stringliteral}{"M5075=(M5075 | %d)"}, 
      m5075);
    

      pthread\_mutex\_lock( &\hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex});
      clock\_gettime( CLOCK\_REALTIME, &timeout);
      \textcolor{comment}{//}
      timeout.tv\_sec += 2;      \textcolor{comment}{// 2 seconds should be more than enough time to
       set the flags}
      err = 0;
      \textcolor{keywordflow}{while}( err == 0 && ((\hyperlink{lspmac_8c_a7a32c617c183166308241e270959df56}{lspmac\_moving\_flags} & m5075) != 
      m5075))
        err = pthread\_cond\_timedwait( &\hyperlink{lspmac_8c_a57547d211906c981ef20257eba99f8df}{lspmac\_moving\_cond}, &
      \hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex}, &timeout);
      moving\_flags = \hyperlink{lspmac_8c_a7a32c617c183166308241e270959df56}{lspmac\_moving\_flags};
      pthread\_mutex\_unlock( &\hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex});
    
      \textcolor{keywordflow}{if}( ((moving\_flags & m5075) != m5075) && err == ETIMEDOUT) \{
        \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspmac\_est\_move\_time:
       Timed out waiting for moving flags.  lspmac\_moving\_flags = 0x%0x, looking for 0x%0x 
       test exp: 0x%0x  test: %d"},
                               moving\_flags, m5075, (moving\_flags & m5075), (
      moving\_flags & m5075) != m5075);
        \hyperlink{lsevents_8c_a5c6f122382dea3dcc231b772e5e75b46}{lsevents\_send\_event}( \textcolor{stringliteral}{"Combined Move Aborted"});
        \textcolor{keywordflow}{return} 1;
      \}
    \}
  \}


  \textcolor{keywordflow}{for}( i=1; i<=16; i++) \{
    \textcolor{comment}{//}
    \textcolor{comment}{// Loop over coordinate systems}
    \textcolor{comment}{//}
    foundone = 0;
    
    \textcolor{keywordflow}{for}( j=0; j<9; j++)
      qs[j] = 0;
    
    \textcolor{keywordflow}{for}( j=0; j<31; j++) \{
      \textcolor{comment}{//}
      \textcolor{comment}{// Loop over motors}
      \textcolor{comment}{//}
      \textcolor{keywordflow}{if}( motions[j].moveme && motions[j].coord\_num == i) \{
        \textcolor{keywordflow}{if}( abs(motions[j].Delta) > 0) \{
          qs[(int)(motions[j].axis)] = motions[j].\hyperlink{structlspmac__combined__move__struct_a5389f07fcf2b24b0e912aefb4141001d}{Delta};
          foundone=1;
        \}
      \}
    \}
    
    \textcolor{keywordflow}{if}( foundone) \{
      sprintf( s, \textcolor{stringliteral}{"&%d Q40=%d Q41=%d Q42=%d Q43=%d Q44=%d Q45=%d Q46=%d Q47=%d
       Q48=%d Q49=%.1f Q100=%d B180R"},
               i, qs[0], qs[1], qs[2], qs[3], qs[4], qs[5], qs[6], qs[7], qs[8]
      , *est\_time * 1000., 1 << (i-1));
      
      \hyperlink{lspmac_8c_afab9e8f0502a92ee5cf93209af710f81}{lspmac\_SockSendDPline}( NULL, s);
      
    \}
  \}
  \textcolor{keywordflow}{return} 0;
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a570b4a359adc4da4ab80d53506d06963}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-est\-\_\-move\-\_\-time\-\_\-wait@{lspmac\-\_\-est\-\_\-move\-\_\-time\-\_\-wait}}
\index{lspmac\-\_\-est\-\_\-move\-\_\-time\-\_\-wait@{lspmac\-\_\-est\-\_\-move\-\_\-time\-\_\-wait}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-est\-\_\-move\-\_\-time\-\_\-wait}]{\setlength{\rightskip}{0pt plus 5cm}int lspmac\-\_\-est\-\_\-move\-\_\-time\-\_\-wait (
\begin{DoxyParamCaption}
\item[{double}]{move\-\_\-time, }
\item[{int}]{cmask, }
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{mp\-\_\-1, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a570b4a359adc4da4ab80d53506d06963}


wait for motion to stop returns non-\/zero if the wait timed out 


\begin{DoxyParams}{Parameters}
{\em move\-\_\-time} & The time out in seconds \\
\hline
{\em cmask} & A coordinate system mask to wait for \\
\hline
{\em mp\-\_\-1} & N\-U\-L\-L terminated list of individual motors to wait for\\
\hline
\end{DoxyParams}
Both values are returned from lspmac\-\_\-est\-\_\-move\-\_\-time 

Definition at line 3195 of file lspmac.\-c.


\begin{DoxyCode}
                                                                               
              \{
  \textcolor{keywordtype}{int} err;
  \textcolor{keywordtype}{double} isecs, fsecs;
  \textcolor{keyword}{struct }timespec timeout;
  va\_list arg\_ptr;
  \hyperlink{structlspmac__motor__struct}{lspmac\_motor\_t} *mp;

  clock\_gettime( CLOCK\_REALTIME, &timeout);
  fsecs = modf( move\_time, &isecs);
  timeout.tv\_sec  += (long)floor(isecs);
  timeout.tv\_nsec += (long)floor(fsecs * 1.e9);
  timeout.tv\_sec  += timeout.tv\_nsec / 1000000000;
  timeout.tv\_nsec %= 1000000000;

  err = 0;
  pthread\_mutex\_lock( &\hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex});
  \textcolor{keywordflow}{while}( err == 0 && (\hyperlink{lspmac_8c_a7a32c617c183166308241e270959df56}{lspmac\_moving\_flags} & cmask) != 0)
    err = pthread\_cond\_timedwait( &\hyperlink{lspmac_8c_a57547d211906c981ef20257eba99f8df}{lspmac\_moving\_cond}, &
      \hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex}, &timeout);
  pthread\_mutex\_unlock( &\hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex});

  \textcolor{keywordflow}{if}( err != 0) \{
    \textcolor{keywordflow}{if}( err == ETIMEDOUT) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"
      lstest\_lspmac\_est\_move\_time\_wait: timed out waiting %f seconds, cmask = 0x%0x"}, move\_time, cmask);
    \}
    \hyperlink{lspmac_8c_a85f7a5e4d853b7a86ddde1006dd4dc1f}{lspmac\_abort}();
    \textcolor{keywordflow}{return} 1;
  \}

  va\_start( arg\_ptr, mp\_1);
  \textcolor{keywordflow}{for}( mp = mp\_1; mp != NULL; mp = va\_arg( arg\_ptr, \hyperlink{structlspmac__motor__struct}{lspmac\_motor\_t}
       *)) \{
    \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a3342670c97c0b2646409f2ef28f63d1c}{magic} != \hyperlink{pgpmac_8h_abe2a74d23400d8d8fe02dc407c242035}{LSPMAC\_MAGIC\_NUMBER}) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspmac\_est\_move\_time\_wait:
       WARNING: motor list must be NULL terminated.  Check your call to
       lspmac\_est\_move\_time\_wait."});
    \}

    \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_a55ffe2b135854f75079ecd39d507d3b4}{lspmac\_moveabs\_wait}( mp, move\_time)) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspmac\_est\_move\_time\_wait:
       timed out waiting %f seconds for motor %s"}, move\_time, mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name});
      \textcolor{keywordflow}{return} 1;
    \}
  \}
  va\_end( arg\_ptr);

  \textcolor{keywordflow}{return} 0;
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a22ef36819bdee963712691e660cfc101}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-find\-\_\-motor\-\_\-by\-\_\-name@{lspmac\-\_\-find\-\_\-motor\-\_\-by\-\_\-name}}
\index{lspmac\-\_\-find\-\_\-motor\-\_\-by\-\_\-name@{lspmac\-\_\-find\-\_\-motor\-\_\-by\-\_\-name}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-find\-\_\-motor\-\_\-by\-\_\-name}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ lspmac\-\_\-find\-\_\-motor\-\_\-by\-\_\-name (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{name}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a22ef36819bdee963712691e660cfc101}


Definition at line 4353 of file lspmac.\-c.


\begin{DoxyCode}
                                                       \{
  \hyperlink{structlspmac__motor__struct}{lspmac\_motor\_t} *rtn;
  ENTRY entry\_in, *entry\_outp;
  \textcolor{keywordtype}{int} err;
  
  entry\_in.key  = name;
  entry\_in.data = NULL;
  err = hsearch\_r( entry\_in, FIND, &entry\_outp, &\hyperlink{lspmac_8c_af12c92fd31b325808127fcd14bb1b329}{motors\_ht});
  \textcolor{keywordflow}{if}( err == 0) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspmac\_find\_motor\_by\_name:
       hsearch\_r failed for motor '%s': %s"}, name, strerror( errno));
    \textcolor{keywordflow}{return} NULL;
  \}    
  rtn = entry\_outp->data;

  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_ac4bf3a54deeaeb6e93dc3183388ad104}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-get\-B\-I\-Position@{lspmac\-\_\-get\-B\-I\-Position}}
\index{lspmac\-\_\-get\-B\-I\-Position@{lspmac\-\_\-get\-B\-I\-Position}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-get\-B\-I\-Position}]{\setlength{\rightskip}{0pt plus 5cm}int lspmac\-\_\-get\-B\-I\-Position (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-bi\-\_\-t} $\ast$}]{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_ac4bf3a54deeaeb6e93dc3183388ad104}


get binary input value 



Definition at line 1649 of file lspmac.\-c.


\begin{DoxyCode}
                                            \{
  \textcolor{keywordtype}{int} rtn;
  pthread\_mutex\_lock( &bip->mutex);
  rtn = bip->position;
  pthread\_mutex\_unlock( &bip->mutex);
  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a6a1b639686b771c1213b6e23716a7898}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-get\-Position@{lspmac\-\_\-get\-Position}}
\index{lspmac\-\_\-get\-Position@{lspmac\-\_\-get\-Position}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-get\-Position}]{\setlength{\rightskip}{0pt plus 5cm}double lspmac\-\_\-get\-Position (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{mp}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a6a1b639686b771c1213b6e23716a7898}


get the motor position (with locking) 


\begin{DoxyParams}{Parameters}
{\em mp} & the motor object \\
\hline
\end{DoxyParams}


Definition at line 1402 of file lspmac.\-c.


\begin{DoxyCode}
                                               \{
  \textcolor{keywordtype}{double} rtn;
  pthread\_mutex\_lock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
  rtn = mp->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position};
  pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a9fbadf816a842c8f131cf8ee47b54e29}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-home1\-\_\-queue@{lspmac\-\_\-home1\-\_\-queue}}
\index{lspmac\-\_\-home1\-\_\-queue@{lspmac\-\_\-home1\-\_\-queue}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-home1\-\_\-queue}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-home1\-\_\-queue (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{mp}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a9fbadf816a842c8f131cf8ee47b54e29}


Home the motor. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em mp} & motor we are concerned about \\
\hline
\end{DoxyParams}


Definition at line 1272 of file lspmac.\-c.


\begin{DoxyCode}
                          \{
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_a292515b2acabb0dcade5b16584cdb011}{motor\_num};
  \textcolor{keywordtype}{int} coord\_num;
  \textcolor{keywordtype}{char} **home;

  pthread\_mutex\_lock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));

  motor\_num = \hyperlink{lsredis_8c_a1923f998441f4f451204dfd214d52218}{lsredis\_getl}( mp->\hyperlink{structlspmac__motor__struct_ad6a51cca3c7e5f79168e5c33fd9e736b}{motor\_num});
  coord\_num = \hyperlink{lsredis_8c_a1923f998441f4f451204dfd214d52218}{lsredis\_getl}( mp->\hyperlink{structlspmac__motor__struct_a5614e003272e8323f8809bf7b6559532}{coord\_num});
  home      = \hyperlink{lsredis_8c_abe31d0e11c41b2235307612c963bb652}{lsredis\_get\_string\_array}( mp->\hyperlink{structlspmac__motor__struct_a6dc1ceab86687f741d4c4a574501959c}{home});
  
  \textcolor{comment}{// Each of the motors should have this defined}
  \textcolor{comment}{// but let's not seg fault if home is missing}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( home == NULL || *home == NULL) \{
    \textcolor{comment}{//}
    \textcolor{comment}{// Note we are already initialized}
    \textcolor{comment}{// so if we are here there is something wrong.}
    \textcolor{comment}{//}
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspmac\_home1\_queue: null or
       empty home strings for motor %s"}, mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name});
    pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
    \textcolor{keywordflow}{return};
  \}

  \textcolor{comment}{// We've already been called.  Don't home again until}
  \textcolor{comment}{// we're finish with the last time.}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_aa74108855693f94fc2ff76333c9fb6ac}{homing}) \{
    pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
    \textcolor{keywordflow}{return};
  \}    


  \textcolor{comment}{//}
  \textcolor{comment}{// Don't go on if any other motors in this coordinate system are homing.}
  \textcolor{comment}{// It's possible to write the homing program to home all the motors in the
       coordinate}
  \textcolor{comment}{// system.  TODO  (hint hint)}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( coord\_num > 0) \{
    \textcolor{keywordflow}{for}( i=0; i<\hyperlink{lspmac_8c_a56260f012c50a591ee7f97e500f16994}{lspmac\_nmotors}; i++) \{
      \textcolor{keywordflow}{if}( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}[i]) == mp)
        \textcolor{keywordflow}{continue};
      \textcolor{keywordflow}{if}( \hyperlink{lsredis_8c_a1923f998441f4f451204dfd214d52218}{lsredis\_getl}(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}[i].coord\_num) == 
      coord\_num) \{
        \textcolor{keywordtype}{int} nogo;
        nogo = 0;
        pthread\_mutex\_lock( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}[i].mutex));
        \textcolor{comment}{//}
        \textcolor{comment}{//  Don't go on if}
        \textcolor{comment}{//}
        \textcolor{comment}{//    we are homing         or      ( not in position               
       while     in open loop)}
        \textcolor{comment}{//}
        \textcolor{keywordflow}{if}( \hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}[i].homing || (((\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [i].status2 & 0x01)==0) && ((\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}[i].status1 & 0x040000) 
      != 0)))
          nogo = 1;
        pthread\_mutex\_unlock( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}[i].mutex));
        \textcolor{keywordflow}{if}( nogo) \{
          pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
          \textcolor{keywordflow}{return};
        \}
      \}
    \}
  \}
  mp->\hyperlink{structlspmac__motor__struct_aa74108855693f94fc2ff76333c9fb6ac}{homing}   = 1;
  mp->\hyperlink{structlspmac__motor__struct_ab7bd8bff48953ce05c758598d75877ac}{not\_done} = 1;     \textcolor{comment}{// set up waiting for cond}
  mp->\hyperlink{structlspmac__motor__struct_a68c471836f52707fa8582f7860cf500f}{motion\_seen} = 0;
  \textcolor{comment}{// This opens the control loop.}
  \textcolor{comment}{// The status routine should notice this and the fact that}
  \textcolor{comment}{// the homing flag is set and call on the home2 routine}
  \textcolor{comment}{//}
  \textcolor{comment}{// Only send the open loop command if we are not in}
  \textcolor{comment}{// open loop mode already.  This test might prevent a race condition}
  \textcolor{comment}{// where we've already moved the home2 routine (and queue the homing program
       motion)}
  \textcolor{comment}{// before the open loop command is dequeued and acted on.}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( ~(mp->\hyperlink{structlspmac__motor__struct_acb52b612b9237e8eec0b97fb1e76a35d}{status1}) & 0x040000) \{
    \hyperlink{lspmac_8c_afab9e8f0502a92ee5cf93209af710f81}{lspmac\_SockSendDPline}( mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name}, \textcolor{stringliteral}{"#%d$*"}, 
      motor\_num);
  \}

  pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));

  \hyperlink{lsevents_8c_a5c6f122382dea3dcc231b772e5e75b46}{lsevents\_send\_event}( \textcolor{stringliteral}{"%s Homing"}, mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name});
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a43e54631dc8de372854ebbb63ff28f70}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-home2\-\_\-queue@{lspmac\-\_\-home2\-\_\-queue}}
\index{lspmac\-\_\-home2\-\_\-queue@{lspmac\-\_\-home2\-\_\-queue}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-home2\-\_\-queue}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-home2\-\_\-queue (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{mp}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a43e54631dc8de372854ebbb63ff28f70}


Second stage of homing. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em mp} & motor we are concerned about \\
\hline
\end{DoxyParams}


Definition at line 1360 of file lspmac.\-c.


\begin{DoxyCode}
                          \{

  \textcolor{keywordtype}{char} **spp;
  \textcolor{keywordtype}{char} **home;

  \textcolor{comment}{//}
  \textcolor{comment}{// At this point we are in open loop.}
  \textcolor{comment}{// Run the motor specific commands}
  \textcolor{comment}{//}

  pthread\_mutex\_lock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));

  home = \hyperlink{lsredis_8c_abe31d0e11c41b2235307612c963bb652}{lsredis\_get\_string\_array}( mp->\hyperlink{structlspmac__motor__struct_a6dc1ceab86687f741d4c4a574501959c}{home});

  \textcolor{comment}{//}
  \textcolor{comment}{// We don't have any motors that have a null home text array so }
  \textcolor{comment}{// there is currently no need to worry about this case other than}
  \textcolor{comment}{// not to seg fault}
  \textcolor{comment}{//}
  \textcolor{comment}{// Also, Only go on if the first homing phase has been started}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( home == NULL || mp->\hyperlink{structlspmac__motor__struct_aa74108855693f94fc2ff76333c9fb6ac}{homing} != 1) \{
    pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
    \textcolor{keywordflow}{return};
  \}

  \textcolor{keywordflow}{for}( spp = home; *spp != NULL; spp++) \{

    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"home2 is queuing '%s'\(\backslash\)n"}, *spp
      );

    \hyperlink{lspmac_8c_afab9e8f0502a92ee5cf93209af710f81}{lspmac\_SockSendDPline}( mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name}, *spp);
  \}

  mp->\hyperlink{structlspmac__motor__struct_aa74108855693f94fc2ff76333c9fb6ac}{homing} = 2;
  pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_ae3e30b0ba9b5d5a291fa29b77ba920d8}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-init@{lspmac\-\_\-init}}
\index{lspmac\-\_\-init@{lspmac\-\_\-init}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-init (
\begin{DoxyParamCaption}
\item[{int}]{, }
\item[{int}]{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_ae3e30b0ba9b5d5a291fa29b77ba920d8}


Initialize this module. 



Definition at line 3843 of file lspmac.\-c.


\begin{DoxyCode}
                   \{
  \textcolor{keyword}{static} \textcolor{keywordtype}{int} first\_time = 1;
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};
  \textcolor{keywordtype}{int} err;
  ENTRY entry\_in, *entry\_outp;
  \hyperlink{structmd2StatusStruct}{md2\_status\_t} *\hyperlink{namespacemk__pgpmac__redis_a11daf2847f2dc94562b5b61b3f412574}{p};
  pthread\_mutexattr\_t \hyperlink{lsredis_8c_a71c9f418904364d65c22d786f4dc5d39}{mutex\_initializer};

  \textcolor{keywordflow}{if}( first\_time) \{
    \textcolor{comment}{// Set our global harvest flags}
    \hyperlink{lspmac_8c_a07b7b8254772075e6a4ced500b589c36}{getivars} = ivarsflag;
    \hyperlink{lspmac_8c_a50e9c0a06654fd81b3446a6e54ff12c3}{getmvars} = mvarsflag;

    \textcolor{comment}{// Use recursive mutexs}
    \textcolor{comment}{//}
    pthread\_mutexattr\_init( &mutex\_initializer);
    pthread\_mutexattr\_settype( &mutex\_initializer, PTHREAD\_MUTEX\_RECURSIVE);

    \textcolor{comment}{// All important status mutex}
    pthread\_mutex\_init( &\hyperlink{lspmac_8c_a7a3e763682bd7f987d07f149e94b3bf8}{md2\_status\_mutex}, &mutex\_initializer);

    \textcolor{comment}{//}
    \textcolor{comment}{// Initialize the motor objects}
    \textcolor{comment}{//}

    p = &\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status};

    \hyperlink{lspmac_8c_a8237e646ce032a840637a4ef7bff49b9}{omega}  = \hyperlink{lspmac_8c_a38a28b74c706dcdbee2a5968e2c1f539}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [ 0]), 0, 0, &p->\hyperlink{structmd2StatusStruct_a6ce303bec89082cae1e9b1fddf6b6c10}{omega\_act\_pos},     &p->\hyperlink{structmd2StatusStruct_af6cf3cd65b9ef205685a0d970f168907}{omega\_status\_1}
      ,     &p->\hyperlink{structmd2StatusStruct_a8577c9df7b663b548b2759ac3db721cd}{omega\_status\_2},     \textcolor{stringliteral}{"Omega   #1 &1 X"}, \textcolor{stringliteral}{"omega"},       
      \hyperlink{lspmac_8c_a1ef1fd07d6dfe8071eb0f696945bcab5}{lspmac\_moveabs\_queue}, \hyperlink{lspmac_8c_a51216d824b3693de350f3be1ab30a7e0}{lspmac\_jogabs\_queue}
      );
    \hyperlink{lspmac_8c_a6cb218bdccfe5a93471c161f15a15cab}{alignx} = \hyperlink{lspmac_8c_a38a28b74c706dcdbee2a5968e2c1f539}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [ 1]), 0, 1, &p->\hyperlink{structmd2StatusStruct_a9653a75bc0b66c5f86d8b0206dc39b4f}{alignx\_act\_pos},    &p->\hyperlink{structmd2StatusStruct_a56accf8cb00c59bff87ed75df7dafbbe}{alignx\_status\_1}
      ,    &p->\hyperlink{structmd2StatusStruct_a2feb35ceab8129fd2cc34d1104af8b8f}{alignx\_status\_2},    \textcolor{stringliteral}{"Align X #2 &3 X"}, \textcolor{stringliteral}{"align.x"},     
      \hyperlink{lspmac_8c_a1ef1fd07d6dfe8071eb0f696945bcab5}{lspmac\_moveabs\_queue}, \hyperlink{lspmac_8c_a51216d824b3693de350f3be1ab30a7e0}{lspmac\_jogabs\_queue}
      );
    \hyperlink{lspmac_8c_a737c246c3948e644a18d191a931e1acd}{aligny} = \hyperlink{lspmac_8c_a38a28b74c706dcdbee2a5968e2c1f539}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [ 2]), 0, 2, &p->\hyperlink{structmd2StatusStruct_a0d40a01d2aa93c443526e826440f77fc}{aligny\_act\_pos},    &p->\hyperlink{structmd2StatusStruct_a2f2a11fe2fc7a446323def2be465185a}{aligny\_status\_1}
      ,    &p->\hyperlink{structmd2StatusStruct_a1f98d8b9831e32d77129f9b0f1d7d255}{aligny\_status\_2},    \textcolor{stringliteral}{"Align Y #3 &3 Y"}, \textcolor{stringliteral}{"align.y"},     
      \hyperlink{lspmac_8c_a1ef1fd07d6dfe8071eb0f696945bcab5}{lspmac\_moveabs\_queue}, \hyperlink{lspmac_8c_a51216d824b3693de350f3be1ab30a7e0}{lspmac\_jogabs\_queue}
      );
    \hyperlink{lspmac_8c_ae7642b1da0f7c7f8448104c691d40a12}{alignz} = \hyperlink{lspmac_8c_a38a28b74c706dcdbee2a5968e2c1f539}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [ 3]), 0, 3, &p->\hyperlink{structmd2StatusStruct_a480f892fe91b05b2980fb00064807e2b}{alignz\_act\_pos},    &p->\hyperlink{structmd2StatusStruct_aadbfac5709de57e449a37e2937d6ade7}{alignz\_status\_1}
      ,    &p->\hyperlink{structmd2StatusStruct_ac378da16eeaab2bc47f3f8f88f7411ed}{alignz\_status\_2},    \textcolor{stringliteral}{"Align Z #4 &3 Z"}, \textcolor{stringliteral}{"align.z"},     
      \hyperlink{lspmac_8c_a1ef1fd07d6dfe8071eb0f696945bcab5}{lspmac\_moveabs\_queue}, \hyperlink{lspmac_8c_a51216d824b3693de350f3be1ab30a7e0}{lspmac\_jogabs\_queue}
      );
    \hyperlink{lspmac_8c_aa90d2363b744acbd4d45133b7a716d8f}{anal}   = \hyperlink{lspmac_8c_a38a28b74c706dcdbee2a5968e2c1f539}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [ 4]), 0, 4, &p->\hyperlink{structmd2StatusStruct_a49d1151b0e819646587be0ca9c9d612a}{analyzer\_act\_pos},  &p->\hyperlink{structmd2StatusStruct_ab876b484f55bcce576fcd89dcc3f7267}{analyzer\_status\_1}
      ,  &p->\hyperlink{structmd2StatusStruct_a4f88bb778e4e18f1fbf7672ac11e7433}{analyzer\_status\_2},  \textcolor{stringliteral}{"Anal    #5"},      \textcolor{stringliteral}{"lightPolar"},  
      \hyperlink{lspmac_8c_a1ef1fd07d6dfe8071eb0f696945bcab5}{lspmac\_moveabs\_queue}, \hyperlink{lspmac_8c_a51216d824b3693de350f3be1ab30a7e0}{lspmac\_jogabs\_queue}
      );
    \hyperlink{lspmac_8c_ad53a42cfaa04eff0336a44c8c9986333}{zoom}   = \hyperlink{lspmac_8c_a38a28b74c706dcdbee2a5968e2c1f539}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [ 5]), 1, 0, &p->\hyperlink{structmd2StatusStruct_a920b80e9f5f08aedac3ad541d5ffc8ae}{zoom\_act\_pos},      &p->\hyperlink{structmd2StatusStruct_af28e978b761dc07eefed3971547cfd4d}{zoom\_status\_1}, 
           &p->\hyperlink{structmd2StatusStruct_a34e4200315a083deb8a970e21bbbe277}{zoom\_status\_2},      \textcolor{stringliteral}{"Zoom    #6 &4 Z"}, \textcolor{stringliteral}{"cam.zoom"},    
      \hyperlink{lspmac_8c_a82cf6576d41c31fce48a59db2d22188b}{lspmac\_movezoom\_queue}, \hyperlink{lspmac_8c_a82cf6576d41c31fce48a59db2d22188b}{lspmac\_movezoom\_queue}
      );
    \hyperlink{lspmac_8c_a139200ddaa9856a7ffcec0e6cbaa8f1b}{apery}  = \hyperlink{lspmac_8c_a38a28b74c706dcdbee2a5968e2c1f539}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [ 6]), 1, 1, &p->\hyperlink{structmd2StatusStruct_a2a434d2b57dbb669de0765486a1516ff}{aperturey\_act\_pos}, &p->\hyperlink{structmd2StatusStruct_a2ef953eaddf7058bf4276585e6ff066b}{aperturey\_status\_1}
      , &p->\hyperlink{structmd2StatusStruct_a0a7738f13a0fa80626cafc2299b104b4}{aperturey\_status\_2}, \textcolor{stringliteral}{"Aper Y  #7 &5 Y"}, \textcolor{stringliteral}{"appy"},        
      \hyperlink{lspmac_8c_a1ef1fd07d6dfe8071eb0f696945bcab5}{lspmac\_moveabs\_queue}, \hyperlink{lspmac_8c_a51216d824b3693de350f3be1ab30a7e0}{lspmac\_jogabs\_queue}
      );
    \hyperlink{lspmac_8c_ab93bd6ee850b285ca3a95e64d15e9477}{aperz}  = \hyperlink{lspmac_8c_a38a28b74c706dcdbee2a5968e2c1f539}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [ 7]), 1, 2, &p->\hyperlink{structmd2StatusStruct_a62d584ce23cfd9aa626d3c03649b455c}{aperturez\_act\_pos}, &p->\hyperlink{structmd2StatusStruct_a27880dd795e1ba4fea4870c64ee3aa84}{aperturez\_status\_1}
      , &p->\hyperlink{structmd2StatusStruct_ae407a99e428d9f4a7444a02c8bc3414e}{aperturez\_status\_2}, \textcolor{stringliteral}{"Aper Z  #8 &5 Z"}, \textcolor{stringliteral}{"appz"},        
      \hyperlink{lspmac_8c_a1ef1fd07d6dfe8071eb0f696945bcab5}{lspmac\_moveabs\_queue}, \hyperlink{lspmac_8c_a51216d824b3693de350f3be1ab30a7e0}{lspmac\_jogabs\_queue}
      );
    \hyperlink{lspmac_8c_a51358daaea8b5236f08414877d8af6c2}{capy}   = \hyperlink{lspmac_8c_a38a28b74c706dcdbee2a5968e2c1f539}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [ 8]), 1, 3, &p->\hyperlink{structmd2StatusStruct_ae25122a6db146501b51609b9cb59b044}{capy\_act\_pos},      &p->\hyperlink{structmd2StatusStruct_a7f4e945e80b1980b9e69366a69ad79cc}{capy\_status\_1}, 
           &p->\hyperlink{structmd2StatusStruct_a5d7c10d9a16ebcc53ac4a0770ab2ef62}{capy\_status\_2},      \textcolor{stringliteral}{"Cap Y   #9 &5 U"}, \textcolor{stringliteral}{"capy"},        
      \hyperlink{lspmac_8c_a1ef1fd07d6dfe8071eb0f696945bcab5}{lspmac\_moveabs\_queue}, \hyperlink{lspmac_8c_a51216d824b3693de350f3be1ab30a7e0}{lspmac\_jogabs\_queue}
      );
    \hyperlink{lspmac_8c_aa45f268d0af9f3d465acfab128919718}{capz}   = \hyperlink{lspmac_8c_a38a28b74c706dcdbee2a5968e2c1f539}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [ 9]), 1, 4, &p->\hyperlink{structmd2StatusStruct_a257c04efac3a33d5d34b21d64c6f1266}{capz\_act\_pos},      &p->\hyperlink{structmd2StatusStruct_a719db4477f35331eaa8b7b44150e88a2}{capz\_status\_1}, 
           &p->\hyperlink{structmd2StatusStruct_a3abb998bb89433aed16121d0dae6275a}{capz\_status\_2},      \textcolor{stringliteral}{"Cap Z  #10 &5 V"}, \textcolor{stringliteral}{"capz"},        
      \hyperlink{lspmac_8c_a1ef1fd07d6dfe8071eb0f696945bcab5}{lspmac\_moveabs\_queue}, \hyperlink{lspmac_8c_a51216d824b3693de350f3be1ab30a7e0}{lspmac\_jogabs\_queue}
      );
    \hyperlink{lspmac_8c_a589431b3a79c21c251fcb97cc9126991}{scint}  = \hyperlink{lspmac_8c_a38a28b74c706dcdbee2a5968e2c1f539}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [10]), 2, 0, &p->\hyperlink{structmd2StatusStruct_a1c146fc792c4285eed5b2c446c214f98}{scint\_act\_pos},     &p->\hyperlink{structmd2StatusStruct_a1723870357f428ac5c2758a2c9a475c7}{scint\_status\_1}
      ,     &p->\hyperlink{structmd2StatusStruct_a4e5bc72e2f4007370f1c29ea272c952f}{scint\_status\_2},     \textcolor{stringliteral}{"Scin Z #11 &5 W"}, \textcolor{stringliteral}{"scint"},       
      \hyperlink{lspmac_8c_a1ef1fd07d6dfe8071eb0f696945bcab5}{lspmac\_moveabs\_queue}, \hyperlink{lspmac_8c_a51216d824b3693de350f3be1ab30a7e0}{lspmac\_jogabs\_queue}
      );
    \hyperlink{lspmac_8c_ac940d950d9efeaf3f0ae67e9bf331188}{cenx}   = \hyperlink{lspmac_8c_a38a28b74c706dcdbee2a5968e2c1f539}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [11]), 2, 1, &p->\hyperlink{structmd2StatusStruct_ae7924b6e91e1de82f6f7910cb3a9c9bd}{centerx\_act\_pos},   &p->\hyperlink{structmd2StatusStruct_aa619cdbd7a563408c6b825ddc4f74ebb}{centerx\_status\_1}
      ,   &p->\hyperlink{structmd2StatusStruct_ae4fad6debe138ed7815d463e83f8d0f6}{centerx\_status\_2},   \textcolor{stringliteral}{"Cen X  #17 &2 X"}, \textcolor{stringliteral}{"centering.x"}, 
      \hyperlink{lspmac_8c_a1ef1fd07d6dfe8071eb0f696945bcab5}{lspmac\_moveabs\_queue}, \hyperlink{lspmac_8c_a51216d824b3693de350f3be1ab30a7e0}{lspmac\_jogabs\_queue}
      );
    \hyperlink{lspmac_8c_aaed18e738ba7bfb6c771a44f5d7ea827}{ceny}   = \hyperlink{lspmac_8c_a38a28b74c706dcdbee2a5968e2c1f539}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [12]), 2, 2, &p->\hyperlink{structmd2StatusStruct_a6be71a92a599d490ca808af8c7e7faa0}{centery\_act\_pos},   &p->\hyperlink{structmd2StatusStruct_a57f65ebe28ef88f1c632d9f35d9167eb}{centery\_status\_1}
      ,   &p->\hyperlink{structmd2StatusStruct_aa242098c185cce8f852cd6e081ef0b1d}{centery\_status\_2},   \textcolor{stringliteral}{"Cen Y  #18 &2 Y"}, \textcolor{stringliteral}{"centering.y"}, 
      \hyperlink{lspmac_8c_a1ef1fd07d6dfe8071eb0f696945bcab5}{lspmac\_moveabs\_queue}, \hyperlink{lspmac_8c_a51216d824b3693de350f3be1ab30a7e0}{lspmac\_jogabs\_queue}
      );
    \hyperlink{lspmac_8c_a0be79ccb7ebf3a665248fd856112b9fd}{kappa}  = \hyperlink{lspmac_8c_a38a28b74c706dcdbee2a5968e2c1f539}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [13]), 2, 3, &p->\hyperlink{structmd2StatusStruct_ac384fb7073387dd5dcb2e85a00ec8a77}{kappa\_act\_pos},     &p->\hyperlink{structmd2StatusStruct_ab152694bc32d37c1d180f55e8d282020}{kappa\_status\_1}
      ,     &p->\hyperlink{structmd2StatusStruct_af6891f5f8dcfc62668f64c583042c6bc}{kappa\_status\_2},     \textcolor{stringliteral}{"Kappa  #19 &7 X"}, \textcolor{stringliteral}{"kappa"},       
      \hyperlink{lspmac_8c_a1ef1fd07d6dfe8071eb0f696945bcab5}{lspmac\_moveabs\_queue}, \hyperlink{lspmac_8c_a51216d824b3693de350f3be1ab30a7e0}{lspmac\_jogabs\_queue}
      );
    \hyperlink{lspmac_8c_ac8070dc568ad974a3db42b51eca828cc}{phi}    = \hyperlink{lspmac_8c_a38a28b74c706dcdbee2a5968e2c1f539}{lspmac\_motor\_init}( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [14]), 2, 4, &p->\hyperlink{structmd2StatusStruct_a4de22995a72ff6e72a1a9ccab6d00620}{phi\_act\_pos},       &p->\hyperlink{structmd2StatusStruct_ad8b8fd90ffff43016e2adaab5ccbfa02}{phi\_status\_1},    
         &p->\hyperlink{structmd2StatusStruct_a0e6cea4c32cb34e602b9ac3d21259219}{phi\_status\_2},       \textcolor{stringliteral}{"Phi    #20 &7 Y"}, \textcolor{stringliteral}{"phi"},         
      \hyperlink{lspmac_8c_a1ef1fd07d6dfe8071eb0f696945bcab5}{lspmac\_moveabs\_queue}, \hyperlink{lspmac_8c_a51216d824b3693de350f3be1ab30a7e0}{lspmac\_jogabs\_queue}
      );

    \hyperlink{lspmac_8c_a26dec4623af9beed912b8e7e6f99822c}{fshut}  = \hyperlink{lspmac_8c_a40aa4aeb5c799a6a3a089137da4fd6a8}{lspmac\_fshut\_init}( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [15]));
    \hyperlink{lspmac_8c_aeb09895663eff333b7a75acb319a9fc1}{flight} = \hyperlink{lspmac_8c_acea9dfc6367bbcf16f49e664e0fc3774}{lspmac\_dac\_init}( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [16]), &p->\hyperlink{structmd2StatusStruct_a3be73c48b09190241a2bcb801af5b97c}{front\_dac},   \textcolor{stringliteral}{"M1200"}, \textcolor{stringliteral}{"frontLight.intensity"}, 
      \hyperlink{lspmac_8c_a98ad3d807b8826439b710e97bf53b478}{lspmac\_movedac\_queue});
    \hyperlink{lspmac_8c_a85d6eaa4b4a82bb3112574f458d1dc50}{blight} = \hyperlink{lspmac_8c_acea9dfc6367bbcf16f49e664e0fc3774}{lspmac\_dac\_init}( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [17]), &p->\hyperlink{structmd2StatusStruct_a33ce490348c8de255cf49b96469d3d4e}{back\_dac},    \textcolor{stringliteral}{"M1201"}, \textcolor{stringliteral}{"backLight.intensity"},  
      \hyperlink{lspmac_8c_a98ad3d807b8826439b710e97bf53b478}{lspmac\_movedac\_queue});
    \hyperlink{lspmac_8c_a8a3ca6fcf5e24dcc26170736843e53b2}{fscint} = \hyperlink{lspmac_8c_acea9dfc6367bbcf16f49e664e0fc3774}{lspmac\_dac\_init}( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [18]), &p->\hyperlink{structmd2StatusStruct_a031be48adfa016c637d6eae49054c435}{scint\_piezo}, \textcolor{stringliteral}{"M1203"}, \textcolor{stringliteral}{"scint.focus"},          
      \hyperlink{lspmac_8c_a98ad3d807b8826439b710e97bf53b478}{lspmac\_movedac\_queue});

    \hyperlink{lspmac_8c_abee73a0d9e5f3af9eb88d5cfd6b953c3}{smart\_mag\_oo}  = \hyperlink{lspmac_8c_aeaa263af25d139f249d8b825a058d0ce}{lspmac\_bo\_init}( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [19]), \textcolor{stringliteral}{"smartMagnet"},\textcolor{stringliteral}{"M1100=%d"}, &(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_ab09c1342dc12052b8f5b35f78ef95000}{acc11c\_5}), 0x01)
      ;
    \hyperlink{lspmac_8c_af813a2eff0b7efa4c70633559054e84c}{blight\_ud}     = \hyperlink{lspmac_8c_aeaa263af25d139f249d8b825a058d0ce}{lspmac\_bo\_init}( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [20]), \textcolor{stringliteral}{"backLight"},  \textcolor{stringliteral}{"M1101=%d"}, &(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_ab09c1342dc12052b8f5b35f78ef95000}{acc11c\_5}), 0x02)
      ;
    \hyperlink{lspmac_8c_ae78d9a757d4c85419fff9c94b15e25d7}{cryo}          = \hyperlink{lspmac_8c_aeaa263af25d139f249d8b825a058d0ce}{lspmac\_bo\_init}( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [21]), \textcolor{stringliteral}{"cryo"},       \textcolor{stringliteral}{"M1102=%d"}, &(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_ab09c1342dc12052b8f5b35f78ef95000}{acc11c\_5}), 0x04)
      ;
    \hyperlink{lspmac_8c_a9d9c5030d817483ca9518027c91adac4}{dryer}         = \hyperlink{lspmac_8c_aeaa263af25d139f249d8b825a058d0ce}{lspmac\_bo\_init}( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [22]), \textcolor{stringliteral}{"dryer"},      \textcolor{stringliteral}{"M1103=%d"}, &(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_ab09c1342dc12052b8f5b35f78ef95000}{acc11c\_5}), 0x08)
      ;
    \hyperlink{lspmac_8c_addb26c80065506faa1de3c1b468fe03f}{fluo}          = \hyperlink{lspmac_8c_aeaa263af25d139f249d8b825a058d0ce}{lspmac\_bo\_init}( &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [23]), \textcolor{stringliteral}{"fluo"},       \textcolor{stringliteral}{"M1104=%d"}, &(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_ab09c1342dc12052b8f5b35f78ef95000}{acc11c\_5}), 0x10)
      ;
    \hyperlink{lspmac_8c_a6630442dc65ce8a30a24ed718b301971}{flight\_oo}     = \hyperlink{lspmac_8c_a698719a7ce58e2052fa70ab87b1fb293}{lspmac\_soft\_motor\_init}( &(
      \hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}[24]), \textcolor{stringliteral}{"frontLight"},        
      \hyperlink{lspmac_8c_aa3c75b8bbde4b8b8ff2b416eabe45552}{lspmac\_moveabs\_frontlight\_oo\_queue});
    \hyperlink{lspmac_8c_af55c51d52c4586b647114f95d7ac1f42}{blight\_f}      = \hyperlink{lspmac_8c_a698719a7ce58e2052fa70ab87b1fb293}{lspmac\_soft\_motor\_init}( &(
      \hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}[25]), \textcolor{stringliteral}{"backLight.factor"},  
      \hyperlink{lspmac_8c_a4c4e5e996755d21603e0afdd41ab9cd4}{lspmac\_moveabs\_blight\_factor\_queue});
    \hyperlink{lspmac_8c_aabf4ec595b5183c1777d029ca56134b0}{flight\_f}      = \hyperlink{lspmac_8c_a698719a7ce58e2052fa70ab87b1fb293}{lspmac\_soft\_motor\_init}( &(
      \hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}[26]), \textcolor{stringliteral}{"frontLight.factor"}, 
      \hyperlink{lspmac_8c_acbe3a8e54208048506e77b365b4c0f58}{lspmac\_moveabs\_flight\_factor\_queue});

    \hyperlink{lspmac_8c_aade15098d213bb25522048e4a231941a}{lp\_air}          = \hyperlink{lspmac_8c_a98e729f27252bcbe803e020d5d3d1845}{lspmac\_bi\_init}( &(\hyperlink{lspmac_8c_a37c46609cb32aea5178c4d59d7892d13}{lspmac\_bis}
      [ 0]), \textcolor{stringliteral}{"lowpressureair"},   &(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_a69fc2e30a5de0a11c992d133e7a761cd}{acc11c\_1}),  0x01, \textcolor{stringliteral}{"Low
       Pressure Air OK"},  \textcolor{stringliteral}{"Low Pressure Air Failed"},  \textcolor{stringliteral}{"OK"},      \textcolor{stringliteral}{"Failed"});
    \hyperlink{lspmac_8c_abb29b117ad38156ba16fcf44eeb427af}{hp\_air}          = \hyperlink{lspmac_8c_a98e729f27252bcbe803e020d5d3d1845}{lspmac\_bi\_init}( &(\hyperlink{lspmac_8c_a37c46609cb32aea5178c4d59d7892d13}{lspmac\_bis}
      [ 1]), \textcolor{stringliteral}{"highpressureair"},  &(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_a69fc2e30a5de0a11c992d133e7a761cd}{acc11c\_1}),  0x02, \textcolor{stringliteral}{"
      High Pressure Air OK"}, \textcolor{stringliteral}{"High Pressure Air Failed"}, \textcolor{stringliteral}{"OK"},      \textcolor{stringliteral}{"Failed"});
    \hyperlink{lspmac_8c_a28df32fd6be9160603aa1bb74a823574}{cryo\_switch}     = \hyperlink{lspmac_8c_a98e729f27252bcbe803e020d5d3d1845}{lspmac\_bi\_init}( &(\hyperlink{lspmac_8c_a37c46609cb32aea5178c4d59d7892d13}{lspmac\_bis}
      [ 2]), \textcolor{stringliteral}{"cryoswitch"},       &(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_a69fc2e30a5de0a11c992d133e7a761cd}{acc11c\_1}),  0x04, \textcolor{stringliteral}{"
      CryoSwitchChanged"},    \textcolor{stringliteral}{"CryoSwitchChanged"},        \textcolor{stringliteral}{"On"},      \textcolor{stringliteral}{"Off"});
    \hyperlink{lspmac_8c_ac0d0bc95bcbcbd154b30c72a9645c8b2}{blight\_down}     = \hyperlink{lspmac_8c_a98e729f27252bcbe803e020d5d3d1845}{lspmac\_bi\_init}( &(\hyperlink{lspmac_8c_a37c46609cb32aea5178c4d59d7892d13}{lspmac\_bis}
      [ 3]), \textcolor{stringliteral}{"backLightDown"},    &(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_a69fc2e30a5de0a11c992d133e7a761cd}{acc11c\_1}),  0x08, \textcolor{stringliteral}{"
      Backlight Down"},       \textcolor{stringliteral}{"Backlight Not Down"},       \textcolor{stringliteral}{"Down"},    \textcolor{stringliteral}{"Not Down"});
    \hyperlink{lspmac_8c_a7fba65f6555c5c7908852c6cf1ad0c94}{blight\_up}       = \hyperlink{lspmac_8c_a98e729f27252bcbe803e020d5d3d1845}{lspmac\_bi\_init}( &(\hyperlink{lspmac_8c_a37c46609cb32aea5178c4d59d7892d13}{lspmac\_bis}
      [ 4]), \textcolor{stringliteral}{"backLightUp"},      &(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_a69fc2e30a5de0a11c992d133e7a761cd}{acc11c\_1}),  0x10, \textcolor{stringliteral}{"
      Backlight Up"},         \textcolor{stringliteral}{"Backlight Not Up"},         \textcolor{stringliteral}{"Up"},      \textcolor{stringliteral}{"Not Up"});
    \hyperlink{lspmac_8c_a871d4cdea0a1a8db85b8658a07655212}{cryo\_back}       = \hyperlink{lspmac_8c_a98e729f27252bcbe803e020d5d3d1845}{lspmac\_bi\_init}( &(\hyperlink{lspmac_8c_a37c46609cb32aea5178c4d59d7892d13}{lspmac\_bis}
      [ 5]), \textcolor{stringliteral}{"cryoBack"},         &(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_a69fc2e30a5de0a11c992d133e7a761cd}{acc11c\_1}),  0x40, \textcolor{stringliteral}{"
      Cryo Back"},            \textcolor{stringliteral}{"Cryo Not Back"},            \textcolor{stringliteral}{"Back"},    \textcolor{stringliteral}{"Not Back"});
    \hyperlink{lspmac_8c_a67092de6f3fcc0b245e4970437eaff6b}{fluor\_back}            = \hyperlink{lspmac_8c_a98e729f27252bcbe803e020d5d3d1845}{lspmac\_bi\_init}( &(\hyperlink{lspmac_8c_a37c46609cb32aea5178c4d59d7892d13}{
      lspmac\_bis}[ 6]), \textcolor{stringliteral}{"detectorParked"},   &(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_ad186f06cb4670b00b8af8264d1da66a4}{acc11c\_2}), 
       0x01, \textcolor{stringliteral}{"Fluor. Det. Parked"},   \textcolor{stringliteral}{"Fluor. Det. Not Parked"},   \textcolor{stringliteral}{"Parked"},  \textcolor{stringliteral}{"Not
       Parked"});
    \hyperlink{lspmac_8c_ac59ab990e48033a811aeb0281fb588fc}{sample\_detected} = \hyperlink{lspmac_8c_a98e729f27252bcbe803e020d5d3d1845}{lspmac\_bi\_init}( &(\hyperlink{lspmac_8c_a37c46609cb32aea5178c4d59d7892d13}{lspmac\_bis}
      [ 7]), \textcolor{stringliteral}{"sampleDetector"},   &(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_ad186f06cb4670b00b8af8264d1da66a4}{acc11c\_2}),  0x02, \textcolor{stringliteral}{"
      SamplePresent"},        \textcolor{stringliteral}{"SampleAbsent"},             \textcolor{stringliteral}{"Present"}, \textcolor{stringliteral}{"Absent"} );
    \hyperlink{lspmac_8c_a5538a6aa526eeed65ff237303da2d348}{etel\_ready}      = \hyperlink{lspmac_8c_a98e729f27252bcbe803e020d5d3d1845}{lspmac\_bi\_init}( &(\hyperlink{lspmac_8c_a37c46609cb32aea5178c4d59d7892d13}{lspmac\_bis}
      [ 8]), \textcolor{stringliteral}{"etelReady"},        &(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_ad186f06cb4670b00b8af8264d1da66a4}{acc11c\_2}),  0x20, \textcolor{stringliteral}{"
      ETEL Ready"},           \textcolor{stringliteral}{"ETEL Not Ready"},           \textcolor{stringliteral}{"Ready"},   \textcolor{stringliteral}{"Not Ready"});
    \hyperlink{lspmac_8c_ab48d4a2cf0225796db9aad49f034dc59}{etel\_on}         = \hyperlink{lspmac_8c_a98e729f27252bcbe803e020d5d3d1845}{lspmac\_bi\_init}( &(\hyperlink{lspmac_8c_a37c46609cb32aea5178c4d59d7892d13}{lspmac\_bis}
      [ 9]), \textcolor{stringliteral}{"etelOn"},           &(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_ad186f06cb4670b00b8af8264d1da66a4}{acc11c\_2}),  0x40, \textcolor{stringliteral}{"
      ETEL On"},              \textcolor{stringliteral}{"ETEL Off"},                 \textcolor{stringliteral}{"On"},      \textcolor{stringliteral}{"Off"});
    \hyperlink{lspmac_8c_a1e690d4ad981d020ea2c850282dca3be}{etel\_init\_ok}    = \hyperlink{lspmac_8c_a98e729f27252bcbe803e020d5d3d1845}{lspmac\_bi\_init}( &(\hyperlink{lspmac_8c_a37c46609cb32aea5178c4d59d7892d13}{lspmac\_bis}
      [10]), \textcolor{stringliteral}{"etelOk"},           &(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_ad186f06cb4670b00b8af8264d1da66a4}{acc11c\_2}),  0x80, \textcolor{stringliteral}{"
      ETEL Init OK"},         \textcolor{stringliteral}{"ETEL Init Not OK"},         \textcolor{stringliteral}{"OK"},      \textcolor{stringliteral}{"Not OK"});
    \hyperlink{lspmac_8c_ab552f2e28dd9cccefafe01f27717101b}{minikappa\_ok}    = \hyperlink{lspmac_8c_a98e729f27252bcbe803e020d5d3d1845}{lspmac\_bi\_init}( &(\hyperlink{lspmac_8c_a37c46609cb32aea5178c4d59d7892d13}{lspmac\_bis}
      [11]), \textcolor{stringliteral}{"miniKappaOk"},      &(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_a20a15620e12888f61c0aed1e47e97932}{acc11c\_3}),  0x01, \textcolor{stringliteral}{"
      Minikappa OK"},         \textcolor{stringliteral}{"Minikappa Not OK"},         \textcolor{stringliteral}{"OK"},      \textcolor{stringliteral}{"Not OK"});
    \hyperlink{lspmac_8c_a2dc6fa78bb6313fe8b696d646eaa2443}{smart\_mag\_on}    = \hyperlink{lspmac_8c_a98e729f27252bcbe803e020d5d3d1845}{lspmac\_bi\_init}( &(\hyperlink{lspmac_8c_a37c46609cb32aea5178c4d59d7892d13}{lspmac\_bis}
      [12]), \textcolor{stringliteral}{"smartMagnetOn"},    &(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_a20a15620e12888f61c0aed1e47e97932}{acc11c\_3}),  0x04, \textcolor{stringliteral}{"
      Smart Magnet On"},      \textcolor{stringliteral}{"Smart Magnet Not On"},      \textcolor{stringliteral}{"On"},      \textcolor{stringliteral}{"Not On"});
    \hyperlink{lspmac_8c_afaff4fbb5f03b0d2469fc7a14f174d69}{arm\_parked}      = \hyperlink{lspmac_8c_a98e729f27252bcbe803e020d5d3d1845}{lspmac\_bi\_init}( &(\hyperlink{lspmac_8c_a37c46609cb32aea5178c4d59d7892d13}{lspmac\_bis}
      [13]), \textcolor{stringliteral}{"armParked"},        &(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_a20a15620e12888f61c0aed1e47e97932}{acc11c\_3}),  0x08, \textcolor{stringliteral}{"Arm
       Parked"},           \textcolor{stringliteral}{"Arm Not Parked"},           \textcolor{stringliteral}{"Parked"},  \textcolor{stringliteral}{"Not Parked"});
    \hyperlink{lspmac_8c_a37903ed8430ac4d9ead609a78eb62f32}{smart\_mag\_err}   = \hyperlink{lspmac_8c_a98e729f27252bcbe803e020d5d3d1845}{lspmac\_bi\_init}( &(\hyperlink{lspmac_8c_a37c46609cb32aea5178c4d59d7892d13}{lspmac\_bis}
      [14]), \textcolor{stringliteral}{"smartMagnetError"}, &(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_a20a15620e12888f61c0aed1e47e97932}{acc11c\_3}),  0x10, \textcolor{stringliteral}{"
      Smart Magnet Error"},   \textcolor{stringliteral}{"Smart Magnet OK"},          \textcolor{stringliteral}{"Error"},   \textcolor{stringliteral}{"OK"});
    \hyperlink{lspmac_8c_ae98a0792d6b4b96a33df0a31bdec6342}{shutter\_open}    = \hyperlink{lspmac_8c_a98e729f27252bcbe803e020d5d3d1845}{lspmac\_bi\_init}( &(\hyperlink{lspmac_8c_a37c46609cb32aea5178c4d59d7892d13}{lspmac\_bis}
      [15]), \textcolor{stringliteral}{"shutterOpen"},      &(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_a20a15620e12888f61c0aed1e47e97932}{acc11c\_3}), 0x100, \textcolor{stringliteral}{"
      Shutter Open"},         \textcolor{stringliteral}{"Shutter Not Open"},         \textcolor{stringliteral}{"Open"},    \textcolor{stringliteral}{"Not Open"});
    \hyperlink{lspmac_8c_a4892e918830dd12093d28c53a1c2df98}{smart\_mag\_off}   = \hyperlink{lspmac_8c_a98e729f27252bcbe803e020d5d3d1845}{lspmac\_bi\_init}( &(\hyperlink{lspmac_8c_a37c46609cb32aea5178c4d59d7892d13}{lspmac\_bis}
      [16]), \textcolor{stringliteral}{"smartMagnetOff"},   &(\hyperlink{lspmac_8c_ad5bce7451d48127bace5af445d03b492}{md2\_status}.\hyperlink{structmd2StatusStruct_ab09c1342dc12052b8f5b35f78ef95000}{acc11c\_5}),  0x01, \textcolor{stringliteral}{"
      Smart Magnet Off"},     \textcolor{stringliteral}{"Smart Magnet Not Off"},     \textcolor{stringliteral}{"Off"},     \textcolor{stringliteral}{"Not Off"});
  


    \textcolor{comment}{// Set up hash table}
    \textcolor{comment}{//}
    err = hcreate\_r( \hyperlink{lspmac_8c_a633db3afda918c8cd29f9728d45b9f73}{LSPMAC\_MAX\_MOTORS} * 2, &\hyperlink{lspmac_8c_af12c92fd31b325808127fcd14bb1b329}{motors\_ht}
      );
    \textcolor{keywordflow}{if}( err == 0) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspmac\_init: hcreate\_r
       failed: '%s'"}, strerror( errno));
      exit( -1);
    \}
    \textcolor{keywordflow}{for}( i=0; i<\hyperlink{lspmac_8c_a56260f012c50a591ee7f97e500f16994}{lspmac\_nmotors}; i++) \{
      entry\_in.key   = \hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}].\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name};
      entry\_in.data  = &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}]);
      err = hsearch\_r( entry\_in, ENTER, &entry\_outp, &\hyperlink{lspmac_8c_af12c92fd31b325808127fcd14bb1b329}{motors\_ht});
      \textcolor{keywordflow}{if}( err == 0) \{
        \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspmac\_init: hsearch\_r
       failed for motor %s: '%s'"}, \hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}[i].name, strerror( errno));
        exit( -1);
      \}
    \}



    \textcolor{comment}{//}
    \textcolor{comment}{// Initialize several commands that get called, perhaps, alot}
    \textcolor{comment}{//}
    \hyperlink{lspmac_8c_a6fcbbe47fe9912533962601f5befdb29}{rr\_cmd}.\hyperlink{structtagEthernetCmd_a6a155eb3ae546dd29369c4a33ddb3310}{RequestType} = \hyperlink{lspmac_8c_a5485d08fdc80533b5cebadff63696ed2}{VR\_UPLOAD};
    \hyperlink{lspmac_8c_a6fcbbe47fe9912533962601f5befdb29}{rr\_cmd}.\hyperlink{structtagEthernetCmd_a0dc566e7edbb226f1a4ea443d93d56e2}{Request}     = \hyperlink{lspmac_8c_aad3c7b4a9403e56c09eceadcf21252c0}{VR\_PMAC\_READREADY};
    \hyperlink{lspmac_8c_a6fcbbe47fe9912533962601f5befdb29}{rr\_cmd}.\hyperlink{structtagEthernetCmd_aec0ee9a5f6c7e3bc6e4bd98f1bd52783}{wValue}      = 0;
    \hyperlink{lspmac_8c_a6fcbbe47fe9912533962601f5befdb29}{rr\_cmd}.\hyperlink{structtagEthernetCmd_a92f5a374e87d4f496b64b4888850d6e6}{wIndex}      = 0;
    \hyperlink{lspmac_8c_a6fcbbe47fe9912533962601f5befdb29}{rr\_cmd}.\hyperlink{structtagEthernetCmd_af5df25ff13ca30fa33719d0df1ab7e97}{wLength}     = htons(2);
    memset( \hyperlink{lspmac_8c_a6fcbbe47fe9912533962601f5befdb29}{rr\_cmd}.\hyperlink{structtagEthernetCmd_a872dab798127d6f589974a79c5d0aef1}{bData}, 0, \textcolor{keyword}{sizeof}(\hyperlink{lspmac_8c_a6fcbbe47fe9912533962601f5befdb29}{rr\_cmd}.\hyperlink{structtagEthernetCmd_a872dab798127d6f589974a79c5d0aef1}{bData}));

    \hyperlink{lspmac_8c_ae7b21213b9c78b6745213409f1ef7320}{gb\_cmd}.\hyperlink{structtagEthernetCmd_a6a155eb3ae546dd29369c4a33ddb3310}{RequestType} = \hyperlink{lspmac_8c_a5485d08fdc80533b5cebadff63696ed2}{VR\_UPLOAD};
    \hyperlink{lspmac_8c_ae7b21213b9c78b6745213409f1ef7320}{gb\_cmd}.\hyperlink{structtagEthernetCmd_a0dc566e7edbb226f1a4ea443d93d56e2}{Request}     = \hyperlink{lspmac_8c_a50e444b5ceb6d62a1be43c88c55c549c}{VR\_PMAC\_GETBUFFER};
    \hyperlink{lspmac_8c_ae7b21213b9c78b6745213409f1ef7320}{gb\_cmd}.\hyperlink{structtagEthernetCmd_aec0ee9a5f6c7e3bc6e4bd98f1bd52783}{wValue}      = 0;
    \hyperlink{lspmac_8c_ae7b21213b9c78b6745213409f1ef7320}{gb\_cmd}.\hyperlink{structtagEthernetCmd_a92f5a374e87d4f496b64b4888850d6e6}{wIndex}      = 0;
    \hyperlink{lspmac_8c_ae7b21213b9c78b6745213409f1ef7320}{gb\_cmd}.\hyperlink{structtagEthernetCmd_af5df25ff13ca30fa33719d0df1ab7e97}{wLength}     = htons(1400);
    memset( \hyperlink{lspmac_8c_ae7b21213b9c78b6745213409f1ef7320}{gb\_cmd}.\hyperlink{structtagEthernetCmd_a872dab798127d6f589974a79c5d0aef1}{bData}, 0, \textcolor{keyword}{sizeof}(\hyperlink{lspmac_8c_ae7b21213b9c78b6745213409f1ef7320}{gb\_cmd}.\hyperlink{structtagEthernetCmd_a872dab798127d6f589974a79c5d0aef1}{bData}));

    \hyperlink{lspmac_8c_a8908812f4ff25c196679e00d330edd81}{cr\_cmd}.\hyperlink{structtagEthernetCmd_a6a155eb3ae546dd29369c4a33ddb3310}{RequestType} = \hyperlink{lspmac_8c_a5485d08fdc80533b5cebadff63696ed2}{VR\_UPLOAD};
    \hyperlink{lspmac_8c_a8908812f4ff25c196679e00d330edd81}{cr\_cmd}.\hyperlink{structtagEthernetCmd_a0dc566e7edbb226f1a4ea443d93d56e2}{Request}     = \hyperlink{lspmac_8c_a8f4ce4666a23a3fb153d680bd1cb6556}{VR\_CTRL\_RESPONSE};
    \hyperlink{lspmac_8c_a8908812f4ff25c196679e00d330edd81}{cr\_cmd}.\hyperlink{structtagEthernetCmd_aec0ee9a5f6c7e3bc6e4bd98f1bd52783}{wValue}      = 0;
    \hyperlink{lspmac_8c_a8908812f4ff25c196679e00d330edd81}{cr\_cmd}.\hyperlink{structtagEthernetCmd_a92f5a374e87d4f496b64b4888850d6e6}{wIndex}      = 0;
    \hyperlink{lspmac_8c_a8908812f4ff25c196679e00d330edd81}{cr\_cmd}.\hyperlink{structtagEthernetCmd_af5df25ff13ca30fa33719d0df1ab7e97}{wLength}     = htons(1400);
    memset( \hyperlink{lspmac_8c_a8908812f4ff25c196679e00d330edd81}{cr\_cmd}.\hyperlink{structtagEthernetCmd_a872dab798127d6f589974a79c5d0aef1}{bData}, 0, \textcolor{keyword}{sizeof}(\hyperlink{lspmac_8c_a8908812f4ff25c196679e00d330edd81}{cr\_cmd}.\hyperlink{structtagEthernetCmd_a872dab798127d6f589974a79c5d0aef1}{bData}));

    \textcolor{comment}{//}
    \textcolor{comment}{// Initialize some mutexs and conditions}
    \textcolor{comment}{//}

    pthread\_mutex\_init( &\hyperlink{lspmac_8c_acc1bb77b9bcbc4d970f841a41fd274b3}{pmac\_queue\_mutex}, &mutex\_initializer);
    pthread\_cond\_init(  &\hyperlink{lspmac_8c_a8a25bd9c593c6985107f90f999ce0b08}{pmac\_queue\_cond}, NULL);

    \hyperlink{lspmac_8c_a112158e0cd50449a440ac55c7af7bea2}{lspmac\_shutter\_state} = 0;                               \textcolor{comment}{
      // assume the shutter is now closed: not a big deal if we are wrong}
    pthread\_mutex\_init( &\hyperlink{lspmac_8c_a1b78a13c654409333569815e1c109d38}{lspmac\_shutter\_mutex}, &
      mutex\_initializer);
    pthread\_cond\_init(  &\hyperlink{lspmac_8c_afbd51c2cefcee87afe994c9e9f372241}{lspmac\_shutter\_cond}, NULL);
    \hyperlink{lspmac_8c_adba7f5f4bbeabc4dac859221d4c684ba}{pmacfd}.fd = -1;

    pthread\_mutex\_init( &\hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex}, &
      mutex\_initializer);
    pthread\_cond\_init(  &\hyperlink{lspmac_8c_a57547d211906c981ef20257eba99f8df}{lspmac\_moving\_cond}, NULL);

    pthread\_mutex\_init( &\hyperlink{lspmac_8c_a2ff142105e17d933871d09759e7082f8}{lspmac\_ascii\_mutex}, &
      mutex\_initializer);

    pthread\_mutex\_init( &\hyperlink{lspmac_8c_a3e7ae750b8988cd2eb93895e3ea1a49e}{lspmac\_ascii\_buffers\_mutex}, 
      &mutex\_initializer);

    \hyperlink{lsevents_8c_ae09cfa92dba806d8f8808e5822ea713c}{lsevents\_preregister\_event}( \textcolor{stringliteral}{"omega crossed zero"})
      ;
    \hyperlink{lsevents_8c_ae09cfa92dba806d8f8808e5822ea713c}{lsevents\_preregister\_event}( \textcolor{stringliteral}{"Move Aborted"});
    \hyperlink{lsevents_8c_ae09cfa92dba806d8f8808e5822ea713c}{lsevents\_preregister\_event}( \textcolor{stringliteral}{"Combined Move
       Aborted"});
    \hyperlink{lsevents_8c_ae09cfa92dba806d8f8808e5822ea713c}{lsevents\_preregister\_event}( \textcolor{stringliteral}{"Abort Request queued
      "});
    \hyperlink{lsevents_8c_ae09cfa92dba806d8f8808e5822ea713c}{lsevents\_preregister\_event}( \textcolor{stringliteral}{"Abort Request
       accepted"});
    \hyperlink{lsevents_8c_ae09cfa92dba806d8f8808e5822ea713c}{lsevents\_preregister\_event}( \textcolor{stringliteral}{"Reset queued"});
    \hyperlink{lsevents_8c_ae09cfa92dba806d8f8808e5822ea713c}{lsevents\_preregister\_event}( \textcolor{stringliteral}{"Reset command
       accepted"});
  

    \textcolor{keywordflow}{for}( i=1; i<=16; i++) \{
      \hyperlink{lsevents_8c_ae09cfa92dba806d8f8808e5822ea713c}{lsevents\_preregister\_event}( \textcolor{stringliteral}{"Coordsys %d
       Stopped"}, i);
    \}
    first\_time = 0;
  \}
  \textcolor{comment}{//}
  \textcolor{comment}{// clear the ascii communications buffers}
  \textcolor{comment}{//}
  \{
    uint32\_t cc;
    cc = 0;
    \hyperlink{lspmac_8c_ac60f32e1ab6d81a60155e355db752726}{lspmac\_send\_command}( \hyperlink{lspmac_8c_a5485d08fdc80533b5cebadff63696ed2}{VR\_UPLOAD}, \hyperlink{lspmac_8c_ab79207cc3145740f8c070a24c91b11e0}{VR\_PMAC\_SETMEM}
      , 0x0e9e, 0, 4, (\textcolor{keywordtype}{char} *)&cc, NULL, 1, NULL);

    cc = 0x18;
    \hyperlink{lspmac_8c_ac60f32e1ab6d81a60155e355db752726}{lspmac\_send\_command}( \hyperlink{lspmac_8c_a5485d08fdc80533b5cebadff63696ed2}{VR\_UPLOAD}, \hyperlink{lspmac_8c_ab79207cc3145740f8c070a24c91b11e0}{VR\_PMAC\_SETMEM}
      , 0x0e9e, 0, 4, (\textcolor{keywordtype}{char} *)&cc, NULL, 1, NULL);
  \}

  \hyperlink{lspmac_8c_afab9e8f0502a92ee5cf93209af710f81}{lspmac\_SockSendDPline}( NULL, \textcolor{stringliteral}{"I5=0"});                    \textcolor{comment}{
      // disable plcc's}
  \hyperlink{lspmac_8c_afab9e8f0502a92ee5cf93209af710f81}{lspmac\_SockSendDPline}( NULL, \textcolor{stringliteral}{"P2100=0"});         \textcolor{comment}{//
       Don't let plcc0 control the shutter}
  \hyperlink{lspmac_8c_afab9e8f0502a92ee5cf93209af710f81}{lspmac\_SockSendDPline}( NULL, \textcolor{stringliteral}{"I36=1"});                \textcolor{comment}{//
       Don't let ^A put a disabled motor into closed loop mode}
  \hyperlink{lspmac_8c_afab9e8f0502a92ee5cf93209af710f81}{lspmac\_SockSendDPline}( NULL, \textcolor{stringliteral}{"ENABLE PLCC 0,2"}); \textcolor{comment}{// use
       plcc0 (Probably not needed but allows easy reset with M2000=0) plcc2 is ours
       used to fill db memory with status}
  \hyperlink{lspmac_8c_afab9e8f0502a92ee5cf93209af710f81}{lspmac\_SockSendDPline}( NULL, \textcolor{stringliteral}{"DISABLE PLCC 1"});  \textcolor{comment}{//
       Don't use plcc 1, it's embl's status routine for old md2 code}
  \hyperlink{lspmac_8c_afab9e8f0502a92ee5cf93209af710f81}{lspmac\_SockSendDPline}( NULL, \textcolor{stringliteral}{"I5=3"});                    \textcolor{comment}{
      // allow the enabled plcc's to run}


\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_ae2df697311878e1b93d1b26169ff06fc}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-jogabs\-\_\-queue@{lspmac\-\_\-jogabs\-\_\-queue}}
\index{lspmac\-\_\-jogabs\-\_\-queue@{lspmac\-\_\-jogabs\-\_\-queue}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-jogabs\-\_\-queue}]{\setlength{\rightskip}{0pt plus 5cm}int lspmac\-\_\-jogabs\-\_\-queue (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{, }
\item[{double}]{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_ae2df697311878e1b93d1b26169ff06fc}


Use jog to move motor to requested position. 



Definition at line 3523 of file lspmac.\-c.


\begin{DoxyCode}
                            \{
  
  \textcolor{keywordflow}{return} \hyperlink{lspmac_8c_a2ab30559739e0232331f53d16c0cb5ac}{lspmac\_move\_or\_jog\_abs\_queue}( mp, 
      requested\_position, 1);
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a565d1106e02cd035deacf10395ddefb9}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-move\-\_\-or\-\_\-jog\-\_\-abs\-\_\-queue@{lspmac\-\_\-move\-\_\-or\-\_\-jog\-\_\-abs\-\_\-queue}}
\index{lspmac\-\_\-move\-\_\-or\-\_\-jog\-\_\-abs\-\_\-queue@{lspmac\-\_\-move\-\_\-or\-\_\-jog\-\_\-abs\-\_\-queue}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-move\-\_\-or\-\_\-jog\-\_\-abs\-\_\-queue}]{\setlength{\rightskip}{0pt plus 5cm}int lspmac\-\_\-move\-\_\-or\-\_\-jog\-\_\-abs\-\_\-queue (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{mp, }
\item[{double}]{requested\-\_\-position, }
\item[{int}]{use\-\_\-jo}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a565d1106e02cd035deacf10395ddefb9}


Move method for normal stepper and servo motor objects Returns non-\/zero on abort, zero if O\-K. 

$<$ format string for coordinate system move

$<$ coordinate system bit

$<$ the requested position in units of \char`\"{}counts\char`\"{}

$<$ motor and coordinate system;

$<$ 0= don't use this motor, 1= do use it

$<$ our axis 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em mp} & The motor to move \\
\hline
\mbox{\tt in}  & {\em requested\-\_\-position} & Where to move it \\
\hline
\mbox{\tt in}  & {\em use\-\_\-jo} & 1 to force jog, 0 for motion prog \\
\hline
\end{DoxyParams}


Definition at line 3246 of file lspmac.\-c.


\begin{DoxyCode}
                                   \{
  \textcolor{keywordtype}{char} *fmt;                    
  \textcolor{keywordtype}{int} q100;                     
  \textcolor{keywordtype}{int} requested\_pos\_cnts;       
  \textcolor{keywordtype}{int} coord\_num, \hyperlink{namespacemk__pgpmac__redis_a292515b2acabb0dcade5b16584cdb011}{motor\_num};    
  \textcolor{keywordtype}{int} active;                   
  \textcolor{keywordtype}{char} *axis;                   
  \textcolor{keywordtype}{double} u2c;
  \textcolor{keywordtype}{double} neutral\_pos;
  \textcolor{keywordtype}{double} min\_pos, max\_pos;
  \textcolor{keywordtype}{int} pos\_limit\_hit, neg\_limit\_hit, in\_position\_band;
  \textcolor{keyword}{struct }timespec timeout, \hyperlink{lspmac_8c_a4bed9053319d1d2cad5cc03d0549e17f}{now};
  \textcolor{keywordtype}{int} err;

  pthread\_mutex\_lock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));

  active           = \hyperlink{lsredis_8c_abbb4e5ece19ebd130e1be18036752a08}{lsredis\_getb}(   mp->\hyperlink{structlspmac__motor__struct_aed4998885bcd5a2a30069637180f58e3}{active});
  u2c              = \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\_getd}(   mp->\hyperlink{structlspmac__motor__struct_a8838915ebb6f9989944117c8197d5e86}{u2c});
  motor\_num        = \hyperlink{lsredis_8c_a1923f998441f4f451204dfd214d52218}{lsredis\_getl}(   mp->\hyperlink{structlspmac__motor__struct_ad6a51cca3c7e5f79168e5c33fd9e736b}{motor\_num});
  coord\_num        = \hyperlink{lsredis_8c_a1923f998441f4f451204dfd214d52218}{lsredis\_getl}(   mp->\hyperlink{structlspmac__motor__struct_a5614e003272e8323f8809bf7b6559532}{coord\_num});
  axis             = \hyperlink{lsredis_8c_ac1994e56114b2315294527d76311f829}{lsredis\_getstr}( mp->\hyperlink{structlspmac__motor__struct_a7437ef16c2dce65bde4dda1ea00e9df3}{axis});
  neutral\_pos      = \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\_getd}(   mp->\hyperlink{structlspmac__motor__struct_ae931e9bc9fc2fa82ca649334fc052fbe}{neutral\_pos});
  min\_pos          = \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\_getd}(   mp->\hyperlink{structlspmac__motor__struct_a7c1f2f67c64d26b12d6bb0d681797d8d}{min\_pos}) - 
      neutral\_pos;
  max\_pos          = \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\_getd}(   mp->\hyperlink{structlspmac__motor__struct_aac8c31a857910cdcbb409331e128e766}{max\_pos}) - 
      neutral\_pos;
  pos\_limit\_hit    = \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\_getd}(   mp->\hyperlink{structlspmac__motor__struct_af39d2e7a681d7c2fbdc39d53fab1a475}{pos\_limit\_hit}
      );
  neg\_limit\_hit    = \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\_getd}(   mp->\hyperlink{structlspmac__motor__struct_afe13c86941928d20357f4f3e2a4d915a}{neg\_limit\_hit}
      );
  in\_position\_band = \hyperlink{lsredis_8c_a1923f998441f4f451204dfd214d52218}{lsredis\_getl}(   mp->\hyperlink{structlspmac__motor__struct_a48de72c2442bd5aa9420fcfe6b4f265f}{in\_position\_band}
      );

  \textcolor{keywordflow}{if}( u2c == 0.0 || requested\_position < min\_pos || requested\_position > 
      max\_pos) \{
    \textcolor{comment}{//}
    \textcolor{comment}{// Shouldn't try moving a motor that's in trouble}
    \textcolor{comment}{//}
    pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspmac\_move\_or\_jog\_abs\_queue:
       %s  u2c=%f  requested position=%f  min allowed=%f  max allowed=%f"}, mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name}
      , u2c, requested\_position, min\_pos, max\_pos);
    \hyperlink{lsevents_8c_a5c6f122382dea3dcc231b772e5e75b46}{lsevents\_send\_event}( \textcolor{stringliteral}{"%s Move Aborted"}, mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name});
    \textcolor{keywordflow}{return} 1;
  \}

  \textcolor{keywordflow}{if}( active != 1) \{
    \textcolor{comment}{//}
    \textcolor{comment}{// Don't really move this motor}
    \textcolor{comment}{// although it's not an error to try}
    \textcolor{comment}{// This is here since we want to check the soft limits (above) but ignore
       the hard limits (below)}
    \textcolor{comment}{// We'll fake the move.}
    \textcolor{comment}{//}
    mp->\hyperlink{structlspmac__motor__struct_af8cdc94c6e2478b12ce942d4cf1d7499}{requested\_position} = requested\_position;
    \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a11cbc6f50c150ed446e9a901cf7cc12b}{nlut} > 0 && mp->\hyperlink{structlspmac__motor__struct_a7b43671f7f3e06521f6cf91fb9ac707d}{lut} != NULL) \{
      mp->\hyperlink{structlspmac__motor__struct_a6e8dc9c11dc52a439fe9837230f93ce2}{requested\_pos\_cnts} = \hyperlink{lspmac_8c_a55b882be15d56a2a777f2b1f92901b7d}{lspmac\_lut}( mp->\hyperlink{structlspmac__motor__struct_a11cbc6f50c150ed446e9a901cf7cc12b}{nlut}
      , mp->\hyperlink{structlspmac__motor__struct_a7b43671f7f3e06521f6cf91fb9ac707d}{lut}, requested\_position);
    \} \textcolor{keywordflow}{else} \{
      mp->\hyperlink{structlspmac__motor__struct_a6e8dc9c11dc52a439fe9837230f93ce2}{requested\_pos\_cnts} = u2c * (requested\_position + 
      neutral\_pos);
    \}
    requested\_pos\_cnts = mp->\hyperlink{structlspmac__motor__struct_a6e8dc9c11dc52a439fe9837230f93ce2}{requested\_pos\_cnts};

    mp->\hyperlink{structlspmac__motor__struct_ab7bd8bff48953ce05c758598d75877ac}{not\_done}     = 1;
    mp->\hyperlink{structlspmac__motor__struct_a68c471836f52707fa8582f7860cf500f}{motion\_seen}  = 0;
    mp->\hyperlink{structlspmac__motor__struct_a59a7f007476b2428fd3c5bd7f24440e8}{command\_sent} = 0;

    \hyperlink{lsevents_8c_a5c6f122382dea3dcc231b772e5e75b46}{lsevents\_send\_event}( \textcolor{stringliteral}{"%s Moving"}, mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name});

    mp->\hyperlink{structlspmac__motor__struct_ab7bd8bff48953ce05c758598d75877ac}{not\_done}     = 0;
    mp->\hyperlink{structlspmac__motor__struct_a68c471836f52707fa8582f7860cf500f}{motion\_seen}  = 1;
    mp->\hyperlink{structlspmac__motor__struct_a59a7f007476b2428fd3c5bd7f24440e8}{command\_sent} = 1;

    mp->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position} = requested\_position;
    mp->\hyperlink{structlspmac__motor__struct_ae5c7aea45b9637a1817be246688fd980}{actual\_pos\_cnts} = requested\_pos\_cnts;

    pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));

    \hyperlink{lsevents_8c_a5c6f122382dea3dcc231b772e5e75b46}{lsevents\_send\_event}( \textcolor{stringliteral}{"%s In Position"}, mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name});
    \textcolor{keywordflow}{return} 0;

  \}


  \textcolor{keywordflow}{if}( (neg\_limit\_hit && (requested\_position < mp->position)) || (pos\_limit\_hit 
      && (requested\_position > mp->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position}))) \{
    pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspmac\_move\_or\_jog\_abs\_queue:
       %s Moving wrong way on limit: requested position=%f  current position=%f  low
       limit=%d high limit=%d"},
                           mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name}, requested\_position, mp->\hyperlink{structlspmac__motor__struct_af8ffb3aed907d8664b65b37601954411}{position}
      , neg\_limit\_hit, pos\_limit\_hit);
    \hyperlink{lsevents_8c_a5c6f122382dea3dcc231b772e5e75b46}{lsevents\_send\_event}( \textcolor{stringliteral}{"%s Move Aborted"}, mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name});
    \textcolor{keywordflow}{return} 2;
  \}


  mp->\hyperlink{structlspmac__motor__struct_af8cdc94c6e2478b12ce942d4cf1d7499}{requested\_position} = requested\_position;
  \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a11cbc6f50c150ed446e9a901cf7cc12b}{nlut} > 0 && mp->\hyperlink{structlspmac__motor__struct_a7b43671f7f3e06521f6cf91fb9ac707d}{lut} != NULL) \{
    mp->\hyperlink{structlspmac__motor__struct_a6e8dc9c11dc52a439fe9837230f93ce2}{requested\_pos\_cnts} = \hyperlink{lspmac_8c_a55b882be15d56a2a777f2b1f92901b7d}{lspmac\_lut}( mp->\hyperlink{structlspmac__motor__struct_a11cbc6f50c150ed446e9a901cf7cc12b}{nlut}
      , mp->\hyperlink{structlspmac__motor__struct_a7b43671f7f3e06521f6cf91fb9ac707d}{lut}, requested\_position);
  \} \textcolor{keywordflow}{else} \{
    mp->\hyperlink{structlspmac__motor__struct_a6e8dc9c11dc52a439fe9837230f93ce2}{requested\_pos\_cnts} = u2c * (requested\_position + 
      neutral\_pos);
  \}
  requested\_pos\_cnts = mp->\hyperlink{structlspmac__motor__struct_a6e8dc9c11dc52a439fe9837230f93ce2}{requested\_pos\_cnts};

  \textcolor{comment}{//}
  \textcolor{comment}{// Bluff if we are already there}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( (abs( requested\_pos\_cnts - mp->\hyperlink{structlspmac__motor__struct_ae5c7aea45b9637a1817be246688fd980}{actual\_pos\_cnts}) * 16 < 
      in\_position\_band)) \{
    \textcolor{comment}{//}
    \textcolor{comment}{// Lie and say we moved even though we didn't.  Who will know? We are
       within the deadband or not active.}
    \textcolor{comment}{//}
    mp->\hyperlink{structlspmac__motor__struct_ab7bd8bff48953ce05c758598d75877ac}{not\_done}     = 1;
    mp->\hyperlink{structlspmac__motor__struct_a68c471836f52707fa8582f7860cf500f}{motion\_seen}  = 0;
    mp->\hyperlink{structlspmac__motor__struct_a59a7f007476b2428fd3c5bd7f24440e8}{command\_sent} = 0;

    \hyperlink{lsevents_8c_a5c6f122382dea3dcc231b772e5e75b46}{lsevents\_send\_event}( \textcolor{stringliteral}{"%s Moving"}, mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name});

    mp->\hyperlink{structlspmac__motor__struct_ab7bd8bff48953ce05c758598d75877ac}{not\_done}     = 0;
    mp->\hyperlink{structlspmac__motor__struct_a68c471836f52707fa8582f7860cf500f}{motion\_seen}  = 1;
    mp->\hyperlink{structlspmac__motor__struct_a59a7f007476b2428fd3c5bd7f24440e8}{command\_sent} = 1;
    
    pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));

    \hyperlink{lsevents_8c_a5c6f122382dea3dcc231b772e5e75b46}{lsevents\_send\_event}( \textcolor{stringliteral}{"%s In Position"}, mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name});
    \textcolor{keywordflow}{return} 0;
  \}

  mp->\hyperlink{structlspmac__motor__struct_ab7bd8bff48953ce05c758598d75877ac}{not\_done}     = 1;
  mp->\hyperlink{structlspmac__motor__struct_a68c471836f52707fa8582f7860cf500f}{motion\_seen}  = 0;
  mp->\hyperlink{structlspmac__motor__struct_a59a7f007476b2428fd3c5bd7f24440e8}{command\_sent} = 0;


  \textcolor{keywordflow}{if}( use\_jog || axis == NULL || *axis == 0) \{
    use\_jog = 1;
  \} \textcolor{keywordflow}{else} \{
    use\_jog = 0;
    q100 = 1 << (coord\_num -1);
  \}


  pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));

  \textcolor{keywordflow}{if}( !use\_jog) \{
    \textcolor{comment}{//}
    \textcolor{comment}{// Make sure the coordinate system is not moving something, wait if it is}
    \textcolor{comment}{//}
    pthread\_mutex\_lock( &\hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex});

    clock\_gettime( CLOCK\_REALTIME, &\hyperlink{lspmac_8c_a4bed9053319d1d2cad5cc03d0549e17f}{now});
    \textcolor{comment}{//}
    \textcolor{comment}{// TODO: Have all moves estimate how long they'll take and use that here}
    \textcolor{comment}{//}
    timeout.tv\_sec  = \hyperlink{lspmac_8c_a4bed9053319d1d2cad5cc03d0549e17f}{now}.tv\_sec + 60.0;             \textcolor{comment}{// a long timeout, but
       we might really be moving something that takes this long (or longer)}
    timeout.tv\_nsec = \hyperlink{lspmac_8c_a4bed9053319d1d2cad5cc03d0549e17f}{now}.tv\_nsec;

    err = 0;
    \textcolor{keywordflow}{while}( err == 0 &&  (\hyperlink{lspmac_8c_a7a32c617c183166308241e270959df56}{lspmac\_moving\_flags} & q100) != 0)
      err = pthread\_cond\_timedwait( &\hyperlink{lspmac_8c_a57547d211906c981ef20257eba99f8df}{lspmac\_moving\_cond}, &
      \hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex}, &timeout);
    
    pthread\_mutex\_unlock( &\hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex});

    \textcolor{keywordflow}{if}( err == ETIMEDOUT) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"
      lspmac\_move\_or\_jog\_abs\_queue: Timed Out.  lspmac\_moving\_flags = %0x"}, \hyperlink{lspmac_8c_a7a32c617c183166308241e270959df56}{lspmac\_moving\_flags}
      );
      \hyperlink{lsevents_8c_a5c6f122382dea3dcc231b772e5e75b46}{lsevents\_send\_event}( \textcolor{stringliteral}{"%s Move Aborted"}, mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name});
      \textcolor{keywordflow}{return} 1;
    \}

    \textcolor{comment}{//}
    \textcolor{comment}{// Set the "we are moving this coordinate system" flag}
    \textcolor{comment}{//}
    \hyperlink{lspmac_8c_afab9e8f0502a92ee5cf93209af710f81}{lspmac\_SockSendDPline}( NULL, \textcolor{stringliteral}{"M5075=(M5075 | %d)"}, 
      q100);
    
    \textcolor{keywordflow}{switch}( *axis) \{
    \textcolor{keywordflow}{case} \textcolor{charliteral}{'A'}:
      fmt = \textcolor{stringliteral}{"&%d Q16=%d Q100=%d B146R"};
      \textcolor{keywordflow}{break};

    \textcolor{keywordflow}{case} \textcolor{charliteral}{'B'}:
      fmt = \textcolor{stringliteral}{"&%d Q17=%d Q100=%d B147R"};
      \textcolor{keywordflow}{break};

    \textcolor{keywordflow}{case} \textcolor{charliteral}{'C'}:
      fmt = \textcolor{stringliteral}{"&%d Q18=%d Q100=%d B148R"};
      \textcolor{keywordflow}{break};
    \textcolor{keywordflow}{case} \textcolor{charliteral}{'X'}:
      fmt = \textcolor{stringliteral}{"&%d Q10=%d Q100=%d B140R"};
      \textcolor{keywordflow}{break};

    \textcolor{keywordflow}{case} \textcolor{charliteral}{'Y'}:
      fmt = \textcolor{stringliteral}{"&%d Q11=%d Q100=%d B141R"};
      \textcolor{keywordflow}{break};

    \textcolor{keywordflow}{case} \textcolor{charliteral}{'Z'}:
      fmt = \textcolor{stringliteral}{"&%d Q12=%d Q100=%d B142R"};
      \textcolor{keywordflow}{break};

    \textcolor{keywordflow}{case} \textcolor{charliteral}{'U'}:
      fmt = \textcolor{stringliteral}{"&%d Q13=%d Q100=%d B143R"};
      \textcolor{keywordflow}{break};

    \textcolor{keywordflow}{case} \textcolor{charliteral}{'V'}:
      fmt = \textcolor{stringliteral}{"&%d Q14=%d Q100=%d B144R"};
      \textcolor{keywordflow}{break};

    \textcolor{keywordflow}{case} \textcolor{charliteral}{'W'}:
      fmt = \textcolor{stringliteral}{"&%d Q15=%d Q100=%d B145R"};
      \textcolor{keywordflow}{break};
    \}

    \textcolor{comment}{//}
    \textcolor{comment}{// Make sure the flag has been seen}
    \textcolor{comment}{//}

    clock\_gettime( CLOCK\_REALTIME, &\hyperlink{lspmac_8c_a4bed9053319d1d2cad5cc03d0549e17f}{now});
    timeout.tv\_sec  = \hyperlink{lspmac_8c_a4bed9053319d1d2cad5cc03d0549e17f}{now}.tv\_sec + 4.0;              \textcolor{comment}{// also a long timeout.
        This should really only take a few milliseconds on a slow day}
    timeout.tv\_nsec = \hyperlink{lspmac_8c_a4bed9053319d1d2cad5cc03d0549e17f}{now}.tv\_nsec;

    pthread\_mutex\_lock( &\hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex});

    err = 0;
    \textcolor{keywordflow}{while}( err == 0 && (\hyperlink{lspmac_8c_a7a32c617c183166308241e270959df56}{lspmac\_moving\_flags} & q100) == 0)
      err = pthread\_cond\_timedwait( &\hyperlink{lspmac_8c_a57547d211906c981ef20257eba99f8df}{lspmac\_moving\_cond}, &
      \hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex}, &timeout);
    pthread\_mutex\_unlock( &\hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex});

    \textcolor{keywordflow}{if}( err == ETIMEDOUT) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"
      lspmac\_move\_or\_jog\_abs\_queue: Did not see flag propagate.  Move aborted."});
      \hyperlink{lsevents_8c_a5c6f122382dea3dcc231b772e5e75b46}{lsevents\_send\_event}( \textcolor{stringliteral}{"%s Move Aborted"}, mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name});
      \textcolor{keywordflow}{return} 1;
    \}
  \}

  pthread\_mutex\_lock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
  \textcolor{keywordflow}{if}( use\_jog) \{
    \hyperlink{lspmac_8c_afab9e8f0502a92ee5cf93209af710f81}{lspmac\_SockSendDPline}( mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name}, \textcolor{stringliteral}{"#%d j=%d"}, 
      motor\_num, requested\_pos\_cnts);
  \} \textcolor{keywordflow}{else} \{
    \hyperlink{lspmac_8c_afab9e8f0502a92ee5cf93209af710f81}{lspmac\_SockSendDPline}( mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name}, fmt, coord\_num, 
      requested\_pos\_cnts, q100);
  \}
  pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));

  free( axis);

  \textcolor{keywordflow}{return} 0;
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a763ce40da7c28bc54a8b1a85199a7914}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-move\-\_\-or\-\_\-jog\-\_\-preset\-\_\-queue@{lspmac\-\_\-move\-\_\-or\-\_\-jog\-\_\-preset\-\_\-queue}}
\index{lspmac\-\_\-move\-\_\-or\-\_\-jog\-\_\-preset\-\_\-queue@{lspmac\-\_\-move\-\_\-or\-\_\-jog\-\_\-preset\-\_\-queue}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-move\-\_\-or\-\_\-jog\-\_\-preset\-\_\-queue}]{\setlength{\rightskip}{0pt plus 5cm}int lspmac\-\_\-move\-\_\-or\-\_\-jog\-\_\-preset\-\_\-queue (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{, }
\item[{char $\ast$}]{, }
\item[{int}]{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a763ce40da7c28bc54a8b1a85199a7914}


move using a preset value returns 0 on success, non-\/zero on error 



Definition at line 3484 of file lspmac.\-c.


\begin{DoxyCode}
                                       \{
  \textcolor{keywordtype}{double} pos;
  \textcolor{keywordtype}{int} err;
  \textcolor{keywordtype}{int} rtn;

  \textcolor{keywordflow}{if}( preset == NULL || *preset == 0) \{
    \hyperlink{lsevents_8c_a5c6f122382dea3dcc231b772e5e75b46}{lsevents\_send\_event}( \textcolor{stringliteral}{"%s Move Aborted"}, mp->name);
    \textcolor{keywordflow}{return} 0;
  \}

  err = \hyperlink{lsredis_8c_a87d7bb0ade6f247edfbb7803aac9e694}{lsredis\_find\_preset}( mp->name, preset, &pos);

  \textcolor{keywordflow}{if}( err != 0)
    rtn = \hyperlink{lspmac_8c_a2ab30559739e0232331f53d16c0cb5ac}{lspmac\_move\_or\_jog\_abs\_queue}( mp, pos, 
      use\_jog);
  \textcolor{keywordflow}{else} \{
    \hyperlink{lsevents_8c_a5c6f122382dea3dcc231b772e5e75b46}{lsevents\_send\_event}( \textcolor{stringliteral}{"%s Move Aborted"}, mp->name);
    rtn = 1;
  \}
  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a6809c317931c4af226e0a0217764afae}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-move\-\_\-or\-\_\-jog\-\_\-queue@{lspmac\-\_\-move\-\_\-or\-\_\-jog\-\_\-queue}}
\index{lspmac\-\_\-move\-\_\-or\-\_\-jog\-\_\-queue@{lspmac\-\_\-move\-\_\-or\-\_\-jog\-\_\-queue}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-move\-\_\-or\-\_\-jog\-\_\-queue}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-move\-\_\-or\-\_\-jog\-\_\-queue (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{, }
\item[{double}]{, }
\item[{int}]{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a6809c317931c4af226e0a0217764afae}
\hypertarget{pgpmac_8h_acd26454acc150847b01717f60f956674}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-move\-\_\-preset\-\_\-queue@{lspmac\-\_\-move\-\_\-preset\-\_\-queue}}
\index{lspmac\-\_\-move\-\_\-preset\-\_\-queue@{lspmac\-\_\-move\-\_\-preset\-\_\-queue}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-move\-\_\-preset\-\_\-queue}]{\setlength{\rightskip}{0pt plus 5cm}int lspmac\-\_\-move\-\_\-preset\-\_\-queue (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{mp, }
\item[{char $\ast$}]{preset\-\_\-name}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_acd26454acc150847b01717f60f956674}


Move a given motor to one of its preset positions. 

No movement if the preset is not found. 
\begin{DoxyParams}{Parameters}
{\em mp} & lspmac motor pointer \\
\hline
{\em preset\-\_\-name} & Name of the preset to use \\
\hline
\end{DoxyParams}


Definition at line 2484 of file lspmac.\-c.


\begin{DoxyCode}
                                                                     \{
  \textcolor{keywordtype}{double} pos;
  \textcolor{keywordtype}{int} err;

  \textcolor{comment}{//lslogging\_log\_message( "lspmac\_move\_preset\_queue: Called with motor %s and
       preset named '%s'", mp->name, preset\_name);}

  err = \hyperlink{lsredis_8c_a87d7bb0ade6f247edfbb7803aac9e694}{lsredis\_find\_preset}( mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name}, preset\_name, &pos
      );
  \textcolor{keywordflow}{if}( err == 0)
    \textcolor{keywordflow}{return} 1;

  err = mp->\hyperlink{structlspmac__motor__struct_a86380d221e4b17eb8cf87a5ac656b669}{jogAbs}( mp, pos);
  \textcolor{keywordflow}{if}( !err)
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspmac\_move\_preset\_queue:
       moving %s to preset '%s' (%f)"}, mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name}, preset\_name, pos);
  \textcolor{comment}{//}
  \textcolor{comment}{// the abort event should have been sent in moveAbs}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{return} err;
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a24786013266b84cba5abae6503c77f02}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-moveabs\-\_\-queue@{lspmac\-\_\-moveabs\-\_\-queue}}
\index{lspmac\-\_\-moveabs\-\_\-queue@{lspmac\-\_\-moveabs\-\_\-queue}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-moveabs\-\_\-queue}]{\setlength{\rightskip}{0pt plus 5cm}int lspmac\-\_\-moveabs\-\_\-queue (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{, }
\item[{double}]{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a24786013266b84cba5abae6503c77f02}


Use coordinate system motion program, if available, to move motor to requested position. 



Definition at line 3512 of file lspmac.\-c.


\begin{DoxyCode}
                            \{
  
  \textcolor{keywordflow}{return} \hyperlink{lspmac_8c_a2ab30559739e0232331f53d16c0cb5ac}{lspmac\_move\_or\_jog\_abs\_queue}( mp, 
      requested\_position, 0);
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a750a7a4f3b02365877979e4f3e06ce7e}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-moveabs\-\_\-wait@{lspmac\-\_\-moveabs\-\_\-wait}}
\index{lspmac\-\_\-moveabs\-\_\-wait@{lspmac\-\_\-moveabs\-\_\-wait}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-moveabs\-\_\-wait}]{\setlength{\rightskip}{0pt plus 5cm}int lspmac\-\_\-moveabs\-\_\-wait (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{mp, }
\item[{double}]{timeout\-\_\-secs}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a750a7a4f3b02365877979e4f3e06ce7e}


Wait for motor to finish moving. 

Assume motion already queued, now just wait


\begin{DoxyParams}{Parameters}
{\em mp} & The motor object to wait for \\
\hline
{\em timeout\-\_\-secs} & The number of seconds to wait for. Fractional values fine. \\
\hline
\end{DoxyParams}


Definition at line 3538 of file lspmac.\-c.


\begin{DoxyCode}
                                                                  \{
  \textcolor{keyword}{struct }timespec timeout, \hyperlink{lspmac_8c_a4bed9053319d1d2cad5cc03d0549e17f}{now};
  \textcolor{keywordtype}{double} isecs, fsecs;
  \textcolor{keywordtype}{int} err;

  \textcolor{comment}{//}
  \textcolor{comment}{// Copy the queue item for the most recent move request}
  \textcolor{comment}{//}
  clock\_gettime( CLOCK\_REALTIME, &\hyperlink{lspmac_8c_a4bed9053319d1d2cad5cc03d0549e17f}{now});

  fsecs = modf( timeout\_secs, &isecs);

  timeout.tv\_sec  = \hyperlink{lspmac_8c_a4bed9053319d1d2cad5cc03d0549e17f}{now}.tv\_sec  + (long)floor( isecs);
  timeout.tv\_nsec = \hyperlink{lspmac_8c_a4bed9053319d1d2cad5cc03d0549e17f}{now}.tv\_nsec + (long)floor( fsecs * 1.0e9);
  
  timeout.tv\_sec  += timeout.tv\_nsec / 1000000000;
  timeout.tv\_nsec %= 1000000000;

  err = 0;
  pthread\_mutex\_lock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
  
  \textcolor{keywordflow}{while}( err == 0 && mp->\hyperlink{structlspmac__motor__struct_a59a7f007476b2428fd3c5bd7f24440e8}{command\_sent} == 0)
    err = pthread\_cond\_timedwait( &mp->\hyperlink{structlspmac__motor__struct_aa0ea4108b8fed5b41ff91ca7266f3d84}{cond}, &mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}, &timeout);
  pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
  \textcolor{keywordflow}{if}( err != 0) \{
    \textcolor{keywordflow}{if}( err != ETIMEDOUT) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspmac\_moveabs\_wait:
       unexpected error from timedwait %d  tv\_sec %ld   tv\_nsec %ld"}, err, timeout.tv\_sec, 
      timeout.tv\_nsec);
    \}
    \textcolor{keywordflow}{return} 1;
  \}

  \textcolor{comment}{//}
  \textcolor{comment}{// wait for the motion to have started}
  \textcolor{comment}{// This will time out if the motion ends before we can read the status back}
  \textcolor{comment}{// hence the added complication of time stamp of the sent packet.}

  err = 0;
  pthread\_mutex\_lock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
  \textcolor{keywordflow}{while}( err == 0 && mp->\hyperlink{structlspmac__motor__struct_a68c471836f52707fa8582f7860cf500f}{motion\_seen} == 0)
    err = pthread\_cond\_timedwait( &(mp->\hyperlink{structlspmac__motor__struct_aa0ea4108b8fed5b41ff91ca7266f3d84}{cond}), &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}), &timeout)
      ;
  
  \textcolor{keywordflow}{if}( err != 0) \{
    \textcolor{keywordflow}{if}( err != ETIMEDOUT) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspmac\_moveabs\_wait:
       unexpected error from timedwait: %d  tv\_sec %ld   tv\_nsec %ld"}, err, timeout.tv\_sec, 
      timeout.tv\_nsec);
    \}
    pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
    \textcolor{keywordflow}{return} 1;
  \}

  \textcolor{comment}{//}
  \textcolor{comment}{// wait for the motion that we know has started to finish}
  \textcolor{comment}{//}
  err = 0;
  \textcolor{keywordflow}{while}( err == 0 && mp->\hyperlink{structlspmac__motor__struct_ab7bd8bff48953ce05c758598d75877ac}{not\_done})
    err = pthread\_cond\_timedwait( &(mp->\hyperlink{structlspmac__motor__struct_aa0ea4108b8fed5b41ff91ca7266f3d84}{cond}), &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}), &timeout)
      ;

  
  \textcolor{keywordflow}{if}( err != 0) \{
    \textcolor{keywordflow}{if}( err != ETIMEDOUT) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspmac\_moveabs\_wait:
       unexpected error from timedwait: %d  tv\_sec %ld   tv\_nsec %ld"}, err, timeout.tv\_sec, 
      timeout.tv\_nsec);
    \}
    pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
    \textcolor{keywordflow}{return} 1;
  \}

  \textcolor{comment}{//}
  \textcolor{comment}{// if return code was not 0 then we know we shouldn't wait for not\_done flag.}
  \textcolor{comment}{// In this case the motion ended before we read the status registers}
  \textcolor{comment}{//}
  pthread\_mutex\_unlock( &(mp->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
  \textcolor{keywordflow}{return} 0;
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a7101ae7b7aad35767a1d6a7093138bd4}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-run@{lspmac\-\_\-run}}
\index{lspmac\-\_\-run@{lspmac\-\_\-run}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-run}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-t$\ast$ lspmac\-\_\-run (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a7101ae7b7aad35767a1d6a7093138bd4}


Start up the lspmac thread. 



Definition at line 4412 of file lspmac.\-c.


\begin{DoxyCode}
                        \{
  \textcolor{keyword}{static} \textcolor{keywordtype}{int} first\_time = 1;
  \textcolor{keywordtype}{char} **inits;
  \hyperlink{structlspmac__motor__struct}{lspmac\_motor\_t} *mp;
  \textcolor{keywordtype}{char} evts[64];
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};
  \textcolor{keywordtype}{int} active;
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_a292515b2acabb0dcade5b16584cdb011}{motor\_num};

  pthread\_create( &\hyperlink{lspmac_8c_a6b7011dd7d2c2d3afadff8d3e50e7677}{pmac\_thread}, NULL, \hyperlink{lspmac_8c_abdec5883055967b1eda043670870f55f}{lspmac\_worker}, 
      NULL);

  \textcolor{keywordflow}{if}( first\_time) \{
    first\_time = 0;
    \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^CryoSwitchChanged$"},        
      \hyperlink{lspmac_8c_afc00ddac633f8c8a3a699e3d22de2770}{lspmac\_cryoSwitchChanged\_cb});
    \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^scint In Position$"},        
      \hyperlink{lspmac_8c_af06c25c2ff55f63a621847a5d06f735f}{lspmac\_scint\_maybe\_turn\_on\_dryer\_cb});
    \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^scint Moving$"},             
      \hyperlink{lspmac_8c_a107f77bf42c0f86eb29ddad9119e2b3b}{lspmac\_scint\_maybe\_turn\_off\_dryer\_cb});
    \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^scintDried$"},               
      \hyperlink{lspmac_8c_a585676eb411025c7b44da958d4e98eb2}{lspmac\_scint\_dried\_cb});
    \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^backLight 1$"} ,              
      \hyperlink{lspmac_8c_a094f66824c57b27c9dad2ca36bd75e44}{lspmac\_backLight\_up\_cb});
    \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^backLight 0$"} ,              
      \hyperlink{lspmac_8c_a571cf14b82b5aae163af5aec3201cd3e}{lspmac\_backLight\_down\_cb});
    \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^cam.zoom Moving$"},          
      \hyperlink{lspmac_8c_a55791bd8a07e5ca1dd2aeedf3c23942c}{lspmac\_light\_zoom\_cb});
    \textcolor{comment}{//    lsevents\_add\_listener( "^Quitting Program$",        
       lspmac\_quitting\_cb);}
    \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^Control-[BCFGV] accepted$"}, 
      \hyperlink{lspmac_8c_a328ffc22db94e417645384ee2007bcf8}{lspmac\_request\_control\_response\_cb});
    \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^Full Card Reset$"},          
      \hyperlink{lspmac_8c_a4b398420dcf558e332a14f9dc54f59bd}{lspmac\_full\_card\_reset\_cb});

    \textcolor{keywordflow}{if}( \hyperlink{pgpmac_8c_ad163e2bc6ebe322058c113dee76c11ff}{pgpmac\_use\_autoscint}) \{
      \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^scint In Position$"},       
       \hyperlink{lspmac_8c_ac3da09d0a08834c22a20d907275ae403}{lspmac\_scint\_maybe\_return\_sample\_cb});
      \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^scint Moving$"},            
       \hyperlink{lspmac_8c_a05d91f9bef2b669640935fa140a07934}{lspmac\_scint\_maybe\_move\_sample\_cb});
    \}

    \textcolor{keywordflow}{for}( i=0; i<\hyperlink{lspmac_8c_a56260f012c50a591ee7f97e500f16994}{lspmac\_nmotors}; i++) \{
      snprintf( evts, \textcolor{keyword}{sizeof}( evts)-1, \textcolor{stringliteral}{"^%s command accepted$"}, \hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}
      [i].name);
      evts[\textcolor{keyword}{sizeof}(evts)-1] = 0;
      \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( evts, \hyperlink{lspmac_8c_a611168a1076b2de45c596ed95c68445a}{lspmac\_command\_done\_cb}
      );
    \}



    \hyperlink{lspmac_8c_a3816a9a1a3bb5bb89fcec8a30d863970}{lspmac\_zoom\_lut\_setup}();
    \hyperlink{lspmac_8c_ad52a5dbc2f06247eca7619195936b85f}{lspmac\_flight\_lut\_setup}();
    \hyperlink{lspmac_8c_a4aa8c178a56276eb64138d52fe65dc8c}{lspmac\_blight\_lut\_setup}();
    \hyperlink{lspmac_8c_a54ceac41b127ad8bbad07bd90c6729dc}{lspmac\_fscint\_lut\_setup}();
  \}

  \textcolor{comment}{//}
  \textcolor{comment}{// Clear the command interfaces}
  \textcolor{comment}{//}
  \textcolor{comment}{// lspmac\_SockSendControlCharPrint( "Control-X", '\(\backslash\)x18'); // why does this
       kill the initialzation?}

  \{
    uint32\_t cc;
    cc = 0;
    \hyperlink{lspmac_8c_ac60f32e1ab6d81a60155e355db752726}{lspmac\_send\_command}( \hyperlink{lspmac_8c_a5485d08fdc80533b5cebadff63696ed2}{VR\_UPLOAD}, \hyperlink{lspmac_8c_ab79207cc3145740f8c070a24c91b11e0}{VR\_PMAC\_SETMEM}
      , 0x0e9e, 0, 4, (\textcolor{keywordtype}{char} *)&cc, NULL, 1, NULL);

    cc = 0x18;
    \hyperlink{lspmac_8c_ac60f32e1ab6d81a60155e355db752726}{lspmac\_send\_command}( \hyperlink{lspmac_8c_a5485d08fdc80533b5cebadff63696ed2}{VR\_UPLOAD}, \hyperlink{lspmac_8c_ab79207cc3145740f8c070a24c91b11e0}{VR\_PMAC\_SETMEM}
      , 0x0e9e, 0, 4, (\textcolor{keywordtype}{char} *)&cc, NULL, 1, NULL);
  \}

  \textcolor{comment}{//}
  \textcolor{comment}{// Initialize the pmac's support for each motor}
  \textcolor{comment}{// (ie, set the various flag for when a motor is active or not)}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{for}( i=0; i<\hyperlink{lspmac_8c_a56260f012c50a591ee7f97e500f16994}{lspmac\_nmotors}; i++) \{
    mp        = &(\hyperlink{lspmac_8c_afbfbc3160d5ed6afefdb07f6a25924f7}{lspmac\_motors}[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}]);
    active    = \hyperlink{lsredis_8c_abbb4e5ece19ebd130e1be18036752a08}{lsredis\_getb}( mp->\hyperlink{structlspmac__motor__struct_aed4998885bcd5a2a30069637180f58e3}{active});
    motor\_num = \hyperlink{lsredis_8c_a1923f998441f4f451204dfd214d52218}{lsredis\_getl}( mp->\hyperlink{structlspmac__motor__struct_ad6a51cca3c7e5f79168e5c33fd9e736b}{motor\_num});

    \textcolor{keywordflow}{if}( motor\_num >= 1 && motor\_num <= 32) \{
      
      \textcolor{comment}{//}
      \textcolor{comment}{// Set the PMAC to be consistant with redis}
      \textcolor{comment}{//}
      \hyperlink{lspmac_8c_afab9e8f0502a92ee5cf93209af710f81}{lspmac\_SockSendDPline}( NULL, \textcolor{stringliteral}{"I%d16=%f I%d17=%f
       I%d28=%d"}, motor\_num, \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\_getd}( mp->\hyperlink{structlspmac__motor__struct_a69e49769a1001665377efc7193d88a0a}{max\_speed}), motor\_num, 
      \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\_getd}( mp->\hyperlink{structlspmac__motor__struct_a50cf4c0711cea164e332bc34705a1a68}{max\_accel}), motor\_num, \hyperlink{lsredis_8c_a1923f998441f4f451204dfd214d52218}{lsredis\_getl}
      ( mp->\hyperlink{structlspmac__motor__struct_a48de72c2442bd5aa9420fcfe6b4f265f}{in\_position\_band}));
    \}    

    \textcolor{comment}{// if there is a problem with "active" then don't do anything}
    \textcolor{comment}{// On the other hand, various combinations of yes/no true/fals 1/0 should
       work}
    \textcolor{comment}{//}
    \textcolor{keywordflow}{switch}( active) \{
    \textcolor{keywordflow}{case} 1:
      inits = \hyperlink{lsredis_8c_abe31d0e11c41b2235307612c963bb652}{lsredis\_get\_string\_array}( mp->\hyperlink{structlspmac__motor__struct_ac2a02f137e4a35db816bc728290d3558}{active\_init}
      );
      \textcolor{keywordflow}{break};

    \textcolor{keywordflow}{case} 0:
      inits = \hyperlink{lsredis_8c_abe31d0e11c41b2235307612c963bb652}{lsredis\_get\_string\_array}( mp->
      \hyperlink{structlspmac__motor__struct_ab329ce9b277eca9984c18417dece7bf7}{inactive\_init});
      \textcolor{keywordflow}{break};

    \textcolor{keywordflow}{default}:
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspmac\_run: motor %s is
       neither active nor inactive (!?)"}, mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name});
      inits = NULL;
    \}
    \textcolor{keywordflow}{if}( inits != NULL) \{
      \textcolor{keywordflow}{while}( *inits != NULL) \{
        \hyperlink{lspmac_8c_afab9e8f0502a92ee5cf93209af710f81}{lspmac\_SockSendDPline}( NULL, *inits);
        inits++;
      \}
    \}
  \}
  \textcolor{keywordflow}{return} &\hyperlink{lspmac_8c_a6b7011dd7d2c2d3afadff8d3e50e7677}{pmac\_thread};
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_ad7cd6c8e4ea1132ac4a4b90e6468e2d6}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-set\-\_\-motion\-\_\-flags@{lspmac\-\_\-set\-\_\-motion\-\_\-flags}}
\index{lspmac\-\_\-set\-\_\-motion\-\_\-flags@{lspmac\-\_\-set\-\_\-motion\-\_\-flags}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-set\-\_\-motion\-\_\-flags}]{\setlength{\rightskip}{0pt plus 5cm}int lspmac\-\_\-set\-\_\-motion\-\_\-flags (
\begin{DoxyParamCaption}
\item[{int $\ast$}]{mmaskp, }
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{mp\-\_\-1, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_ad7cd6c8e4ea1132ac4a4b90e6468e2d6}


Set the coordinate system motion flags (m5075) for the null terminated list of motors that we are planning on running a motion program with. 

Note that lspmac\-\_\-est\-\_\-move\-\_\-time already takes care of this, use when calling a motion program directly


\begin{DoxyParams}{Parameters}
{\em mmaskp} & Returned value of the mask generated. Ignored if null. \\
\hline
{\em mp\-\_\-1} & start of null terminated list of motors. \\
\hline
\end{DoxyParams}


Definition at line 2754 of file lspmac.\-c.


\begin{DoxyCode}
                                                                     \{
  va\_list arg\_ptr;
  \textcolor{keyword}{struct }timespec timeout;
  \textcolor{keywordtype}{int} err;
  \textcolor{keywordtype}{int} cn;
  \textcolor{keywordtype}{int} need\_flag;
  \hyperlink{structlspmac__motor__struct}{lspmac\_motor\_t} *mp;
  \textcolor{keywordtype}{int} mmask;

  mmask = 0;
  \textcolor{keywordflow}{if}( mmaskp != NULL)
    *mmaskp = 0;

  \textcolor{keywordflow}{if}( mp\_1==NULL)
    \textcolor{keywordflow}{return} 0;
  
  
  \textcolor{comment}{//}
  \textcolor{comment}{// add the coordinate system flags to mmask}
  \textcolor{comment}{//}
  va\_start( arg\_ptr, mp\_1);
  \textcolor{keywordflow}{for}( mp = mp\_1; mp!=NULL; mp = va\_arg( arg\_ptr, \hyperlink{structlspmac__motor__struct}{lspmac\_motor\_t} 
      *)) \{
    \textcolor{keywordflow}{if}( mp->\hyperlink{structlspmac__motor__struct_a3342670c97c0b2646409f2ef28f63d1c}{magic} != \hyperlink{pgpmac_8h_abe2a74d23400d8d8fe02dc407c242035}{LSPMAC\_MAGIC\_NUMBER}) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspmac\_set\_motion\_flags:
       WARNING: motor list must be NULL terminated.  Check your call to
       lspmac\_set\_motion\_flags."});
      \textcolor{keywordflow}{break};
    \}
    cn = \hyperlink{lsredis_8c_a1923f998441f4f451204dfd214d52218}{lsredis\_getl}( mp->\hyperlink{structlspmac__motor__struct_a5614e003272e8323f8809bf7b6559532}{coord\_num});
    \textcolor{keywordflow}{if}( cn < 1 || cn > 16)
      \textcolor{keywordflow}{continue};
    
    mmask |= 1 << (cn - 1);
  \}
  va\_end( arg\_ptr);

  \textcolor{keywordflow}{if}( mmaskp != NULL)
    *mmaskp = mmask;
    
  \textcolor{comment}{//}
  \textcolor{comment}{// It could be the flag is already what we want.  We might set up a race
       condition if we}
  \textcolor{comment}{// try to set it again.  (so don't)}
  \textcolor{comment}{//}
  pthread\_mutex\_lock( &\hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex});

  \textcolor{keywordflow}{if}( (\hyperlink{lspmac_8c_a7a32c617c183166308241e270959df56}{lspmac\_moving\_flags} & mmask) != 0)
    need\_flag = 0;
  \textcolor{keywordflow}{else}
    need\_flag = 1;
  
  pthread\_mutex\_unlock( &\hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex});

  \textcolor{keywordflow}{if}( !need\_flag)
    \textcolor{keywordflow}{return} 0;
  
  \textcolor{comment}{//}
  \textcolor{comment}{// Set m5075 and make sure it propagates}
  \textcolor{comment}{//}
  \hyperlink{lspmac_8c_afab9e8f0502a92ee5cf93209af710f81}{lspmac\_SockSendDPline}( NULL, \textcolor{stringliteral}{"M5075=(M5075 | %d)"}, mmask
      );
  clock\_gettime( CLOCK\_REALTIME, &timeout);
  timeout.tv\_sec += 2;

  err = 0;
  pthread\_mutex\_lock( &\hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex});
  \textcolor{keywordflow}{while}( err == 0 && (\hyperlink{lspmac_8c_a7a32c617c183166308241e270959df56}{lspmac\_moving\_flags} & mmask) != mmask)
    err = pthread\_cond\_timedwait( &\hyperlink{lspmac_8c_a57547d211906c981ef20257eba99f8df}{lspmac\_moving\_cond}, &
      \hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex}, &timeout);

  pthread\_mutex\_unlock( &\hyperlink{lspmac_8c_a85679cac947e199c88794f8e5a12bf5f}{lspmac\_moving\_mutex});
  
  \textcolor{keywordflow}{if}( err == ETIMEDOUT) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lspmac\_set\_motion\_flags: timed
       out waiting for motion %d flag to be set"}, mmask);
    \textcolor{keywordflow}{return} 1;
  \}
  \textcolor{keywordflow}{return} 0;
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a8707477f9799b4cc8c6f465ecfeee24b}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-\-Sock\-Send\-Control\-Char\-Print@{lspmac\-\_\-\-Sock\-Send\-Control\-Char\-Print}}
\index{lspmac\-\_\-\-Sock\-Send\-Control\-Char\-Print@{lspmac\-\_\-\-Sock\-Send\-Control\-Char\-Print}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-\-Sock\-Send\-Control\-Char\-Print}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pmac\-\_\-cmd\-\_\-queue\-\_\-t}$\ast$ lspmac\-\_\-\-Sock\-Send\-Control\-Char\-Print (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{event, }
\item[{char}]{c}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a8707477f9799b4cc8c6f465ecfeee24b}


Send a control character. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em event} & base name for events \\
\hline
 & {\em c} & The control character to send \\
\hline
\end{DoxyParams}


Definition at line 1133 of file lspmac.\-c.


\begin{DoxyCode}
                                                    \{
  \hyperlink{lspmac_8c_a9fbc6333cfd364eff48202376e0f9862}{lspmac\_control\_char} = c;
  \textcolor{comment}{//  return lspmac\_send\_command( VR\_DOWNLOAD, VR\_PMAC\_SENDCTRLCHAR, c, 0,
       1400, NULL, lspmac\_SendControlReplyPrintCB, 0, event);}
  \textcolor{keywordflow}{return} \hyperlink{lspmac_8c_ac60f32e1ab6d81a60155e355db752726}{lspmac\_send\_command}( \hyperlink{lspmac_8c_a5485d08fdc80533b5cebadff63696ed2}{VR\_UPLOAD}, 
      \hyperlink{lspmac_8c_a8f4ce4666a23a3fb153d680bd1cb6556}{VR\_CTRL\_RESPONSE}, c, 0, 1400, NULL, 
      \hyperlink{lspmac_8c_ae2dd5e31cb4a69470b061aa56473be14}{lspmac\_SendControlReplyPrintCB}, 0, event);
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a0575fc751cecf35ffe8b290ab483ac21}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-\-Sock\-Send\-D\-P\-Control\-Char@{lspmac\-\_\-\-Sock\-Send\-D\-P\-Control\-Char}}
\index{lspmac\-\_\-\-Sock\-Send\-D\-P\-Control\-Char@{lspmac\-\_\-\-Sock\-Send\-D\-P\-Control\-Char}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-\-Sock\-Send\-D\-P\-Control\-Char}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-\-Sock\-Send\-D\-P\-Control\-Char (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{event, }
\item[{char}]{c}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a0575fc751cecf35ffe8b290ab483ac21}


use dpram ascii interface to send a control character 



Definition at line 2078 of file lspmac.\-c.


\begin{DoxyCode}
                                                        \{
  uint16\_t buff;

  buff = 0x07 & c;
  \hyperlink{lspmac_8c_ac60f32e1ab6d81a60155e355db752726}{lspmac\_send\_command}( \hyperlink{lspmac_8c_a5485d08fdc80533b5cebadff63696ed2}{VR\_UPLOAD}, \hyperlink{lspmac_8c_ab79207cc3145740f8c070a24c91b11e0}{VR\_PMAC\_SETMEM}
      , 0x0e9e, 0, 2, (\textcolor{keywordtype}{char} *)&buff, \hyperlink{lspmac_8c_afb3caf2837d7bcb702c26fc8f08259b3}{lspmac\_SockSendDPControlCharCB}
      , 1, event);
  \textcolor{keywordflow}{if}( event != NULL)
    \hyperlink{lsevents_8c_a5c6f122382dea3dcc231b772e5e75b46}{lsevents\_send\_event}( \textcolor{stringliteral}{"%s queued"}, event);
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a49a53bb92535ca2b62208dce41760fbb}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-\-Sock\-Send\-D\-Pline@{lspmac\-\_\-\-Sock\-Send\-D\-Pline}}
\index{lspmac\-\_\-\-Sock\-Send\-D\-Pline@{lspmac\-\_\-\-Sock\-Send\-D\-Pline}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-\-Sock\-Send\-D\-Pline}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-\-Sock\-Send\-D\-Pline (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{, }
\item[{char $\ast$}]{fmt, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a49a53bb92535ca2b62208dce41760fbb}


prepare (queue up) a line to send the dpram ascii command interface 



Definition at line 2035 of file lspmac.\-c.


\begin{DoxyCode}
                                                         \{
  va\_list arg\_ptr;
  uint32\_t index;
  \textcolor{keywordtype}{char} *pl;
  
  pthread\_mutex\_lock( &\hyperlink{lspmac_8c_a2ff142105e17d933871d09759e7082f8}{lspmac\_ascii\_mutex});
  index = \hyperlink{lspmac_8c_a09701de0235acaeae5abf4e04268be33}{lspmac\_dpascii\_on}++ % \hyperlink{lspmac_8c_a3a407e2e4d57ac45ecd700f8bad3d3b5}{LSPMAC\_DPASCII\_QUEUE\_LENGTH}
      ;

  pl = \hyperlink{lspmac_8c_a2bd5340143f40b5e6404a381fb438710}{lspmac\_dpascii\_queue}[index].\hyperlink{structlspmac__dpascii__queue__struct_a318d65317b14eba9e38efd0ab0133a5c}{pl};

  va\_start( arg\_ptr, fmt);
  vsnprintf( pl, 159, fmt, arg\_ptr);
  pl[159] = 0;
  va\_end( arg\_ptr);

  \hyperlink{lspmac_8c_a2bd5340143f40b5e6404a381fb438710}{lspmac\_dpascii\_queue}[index].\hyperlink{structlspmac__dpascii__queue__struct_a8775c09713a917f4ddd80a3a5a8a4668}{event} = event;

  pthread\_mutex\_unlock( &\hyperlink{lspmac_8c_a2ff142105e17d933871d09759e7082f8}{lspmac\_ascii\_mutex});
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a79f86193e36c823157049061b94627a7}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-\-Sock\-Sendline@{lspmac\-\_\-\-Sock\-Sendline}}
\index{lspmac\-\_\-\-Sock\-Sendline@{lspmac\-\_\-\-Sock\-Sendline}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-\-Sock\-Sendline}]{\setlength{\rightskip}{0pt plus 5cm}{\bf pmac\-\_\-cmd\-\_\-queue\-\_\-t}$\ast$ lspmac\-\_\-\-Sock\-Sendline (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{event, }
\item[{char $\ast$}]{fmt, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a79f86193e36c823157049061b94627a7}


Send a one line command. 

Uses printf style arguments. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em event} & base name for events \\
\hline
\mbox{\tt in}  & {\em fmt} & Printf style format string \\
\hline
\end{DoxyParams}


Definition at line 1090 of file lspmac.\-c.


\begin{DoxyCode}
                                         \{
  va\_list arg\_ptr;
  \textcolor{keywordtype}{char} payload[1400];

  va\_start( arg\_ptr, fmt);
  vsnprintf( payload, \textcolor{keyword}{sizeof}(payload)-1, fmt, arg\_ptr);
  payload[ \textcolor{keyword}{sizeof}(payload)-1] = 0;
  va\_end( arg\_ptr);

  \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"%s"}, payload);

  \textcolor{keywordflow}{return} \hyperlink{lspmac_8c_ac60f32e1ab6d81a60155e355db752726}{lspmac\_send\_command}( \hyperlink{lspmac_8c_af24ecdc10723dc8fd6320fef416ae514}{VR\_DOWNLOAD}, 
      \hyperlink{lspmac_8c_a772b2ea2ad93989ae4275c79a93525ee}{VR\_PMAC\_SENDLINE}, 0, 0, strlen( payload), payload, 
      \hyperlink{lspmac_8c_a81e8e315099cf9b6eef0335b01f97bfd}{lspmac\_GetShortReplyCB}, 0, event);
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_aca5a35903f027178fd9698a5a10537e7}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-spin@{lspmac\-\_\-spin}}
\index{lspmac\-\_\-spin@{lspmac\-\_\-spin}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-spin}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-spin (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_aca5a35903f027178fd9698a5a10537e7}


Definition at line 4400 of file lspmac.\-c.


\begin{DoxyCode}
                                      \{
  \textcolor{keywordflow}{if}( strcmp( mp->name, \textcolor{stringliteral}{"omega"})==0) \{
    \hyperlink{lspmac_8c_afab9e8f0502a92ee5cf93209af710f81}{lspmac\_SockSendDPline}( NULL, \textcolor{stringliteral}{"&%d"}, \hyperlink{lsredis_8c_a1923f998441f4f451204dfd214d52218}{lsredis\_getl}
      ( mp->coord\_num));
    \hyperlink{lspmac_8c_afab9e8f0502a92ee5cf93209af710f81}{lspmac\_SockSendDPline}( NULL, \textcolor{stringliteral}{"#%d"}, \hyperlink{lsredis_8c_a1923f998441f4f451204dfd214d52218}{lsredis\_getl}
      ( mp->motor\_num));
    \hyperlink{lspmac_8c_afab9e8f0502a92ee5cf93209af710f81}{lspmac\_SockSendDPline}( NULL, \textcolor{stringliteral}{"j+"});
  \}
  \textcolor{keywordflow}{return};
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_aa8bf745a9ec388783009e2275a8b56f8}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-video\-\_\-rotate@{lspmac\-\_\-video\-\_\-rotate}}
\index{lspmac\-\_\-video\-\_\-rotate@{lspmac\-\_\-video\-\_\-rotate}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-video\-\_\-rotate}]{\setlength{\rightskip}{0pt plus 5cm}void lspmac\-\_\-video\-\_\-rotate (
\begin{DoxyParamCaption}
\item[{double}]{secs}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_aa8bf745a9ec388783009e2275a8b56f8}


Special motion program to collect centering video. 



Definition at line 2716 of file lspmac.\-c.


\begin{DoxyCode}
                                       \{
  \textcolor{keywordtype}{double} q10;           \textcolor{comment}{// starting position (counts)}
  \textcolor{keywordtype}{double} q11;           \textcolor{comment}{// delta counts}
  \textcolor{keywordtype}{double} q12;           \textcolor{comment}{// milliseconds to run over delta}
  
  \textcolor{keywordtype}{double} u2c;
  \textcolor{keywordtype}{double} neutral\_pos;

  \textcolor{keywordflow}{if}( secs <= 0.0)
    \textcolor{keywordflow}{return};

  \hyperlink{lspmac_8c_ae06d2291c1996ffb7dcf7d132e25b038}{omega\_zero\_search} = 1;

  pthread\_mutex\_lock( &(\hyperlink{lspmac_8c_a8237e646ce032a840637a4ef7bff49b9}{omega}->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
  u2c         = \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\_getd}( \hyperlink{lspmac_8c_a8237e646ce032a840637a4ef7bff49b9}{omega}->\hyperlink{structlspmac__motor__struct_a8838915ebb6f9989944117c8197d5e86}{u2c});
  neutral\_pos = \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\_getd}( \hyperlink{lspmac_8c_a8237e646ce032a840637a4ef7bff49b9}{omega}->\hyperlink{structlspmac__motor__struct_ae931e9bc9fc2fa82ca649334fc052fbe}{neutral\_pos});

  q10 = neutral\_pos * u2c;
  q11 = 360.0 * u2c;
  q12 = 1000 * secs;
  

  \hyperlink{lspmac_8c_aea11895d2ec4a3324f4baa9d24cd192d}{omega\_zero\_velocity} = 360.0 * u2c / secs;  \textcolor{comment}{//
       counts/second to back calculate zero crossing time}

  \hyperlink{lspmac_8c_afab9e8f0502a92ee5cf93209af710f81}{lspmac\_SockSendDPline}( \hyperlink{lspmac_8c_a8237e646ce032a840637a4ef7bff49b9}{omega}->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name}, \textcolor{stringliteral}{"&1
       Q10=%.1f Q11=%.1f Q12=%.1f Q13=(I117) Q14=(I116) B240R"}, q10, q11, q12);
  pthread\_mutex\_unlock( &(\hyperlink{lspmac_8c_a8237e646ce032a840637a4ef7bff49b9}{omega}->\hyperlink{structlspmac__motor__struct_a188c5b1e991750ce2ffd53e0192e0907}{mutex}));
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_ac356cd43e46799929242dcf5214df7f6}{\index{pgpmac.\-h@{pgpmac.\-h}!lsredis\-\_\-cmpnstr@{lsredis\-\_\-cmpnstr}}
\index{lsredis\-\_\-cmpnstr@{lsredis\-\_\-cmpnstr}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsredis\-\_\-cmpnstr}]{\setlength{\rightskip}{0pt plus 5cm}int lsredis\-\_\-cmpnstr (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p, }
\item[{char $\ast$}]{s, }
\item[{int}]{n}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_ac356cd43e46799929242dcf5214df7f6}


Definition at line 254 of file lsredis.\-c.


\begin{DoxyCode}
                                                       \{
  \textcolor{keywordtype}{int} rtn;
  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{while}( p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} == 0)
    pthread\_cond\_wait( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  
  rtn = strncmp( p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value}, s, n);
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a9fc8fd0db4c71c5eae68682b43103078}{\index{pgpmac.\-h@{pgpmac.\-h}!lsredis\-\_\-cmpstr@{lsredis\-\_\-cmpstr}}
\index{lsredis\-\_\-cmpstr@{lsredis\-\_\-cmpstr}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsredis\-\_\-cmpstr}]{\setlength{\rightskip}{0pt plus 5cm}int lsredis\-\_\-cmpstr (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p, }
\item[{char $\ast$}]{s}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a9fc8fd0db4c71c5eae68682b43103078}


Definition at line 243 of file lsredis.\-c.


\begin{DoxyCode}
                                               \{
  \textcolor{keywordtype}{int} rtn;
  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{while}( p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} == 0)
    pthread\_cond\_wait( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  
  rtn = strcmp( p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value}, s);
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_aaabcee808dcf48a60898798a45516b68}{\index{pgpmac.\-h@{pgpmac.\-h}!lsredis\-\_\-config@{lsredis\-\_\-config}}
\index{lsredis\-\_\-config@{lsredis\-\_\-config}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsredis\-\_\-config}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-config (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_aaabcee808dcf48a60898798a45516b68}


Definition at line 1188 of file lsredis.\-c.


\begin{DoxyCode}
                      \{
  \textcolor{keywordtype}{char} hostname[128], lhostname[128];
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};

  pthread\_mutexattr\_init( &\hyperlink{lsredis_8c_a71c9f418904364d65c22d786f4dc5d39}{mutex\_initializer});
  pthread\_mutexattr\_settype( &\hyperlink{lsredis_8c_a71c9f418904364d65c22d786f4dc5d39}{mutex\_initializer}, 
      PTHREAD\_MUTEX\_RECURSIVE);

  \textcolor{keywordflow}{if}( gethostname( hostname, \textcolor{keyword}{sizeof}(hostname)-1)) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_init: cannot get our
       own host name.  Cannot configure redis variables."});
  \} \textcolor{keywordflow}{else} \{
    \textcolor{keywordflow}{for}( i=0; i<strlen(hostname); i++) \{
      lhostname[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}] = tolower( hostname[i]);
    \}
    lhostname[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}] = 0;

    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_init: our host name is
       '%s'"}, lhostname);
    redisAsyncCommand( \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}, \hyperlink{lsredis_8c_a75e500f4f9df969ca9994d6889944f47}{lsredis\_configCB}, NULL, \textcolor{stringliteral}{"
      hgetall config.%s"}, lhostname);
  \}
  
  pthread\_mutex\_lock( &\hyperlink{lsredis_8c_a0c5cbd80d59d69603f123621cc6ddc30}{lsredis\_config\_mutex});
  \textcolor{keywordflow}{while}( \hyperlink{lsredis_8c_acdca9095c7a3288d7febe9f4c440a6e9}{lsredis\_head} == NULL)
    pthread\_cond\_wait( &\hyperlink{lsredis_8c_a6fa076f1004c85a8a1dc400f45547f32}{lsredis\_config\_cond}, &
      \hyperlink{lsredis_8c_a0c5cbd80d59d69603f123621cc6ddc30}{lsredis\_config\_mutex});
  pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_a0c5cbd80d59d69603f123621cc6ddc30}{lsredis\_config\_mutex});

\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a1ad60526a09ca679f39174ce5d773abe}{\index{pgpmac.\-h@{pgpmac.\-h}!lsredis\-\_\-find\-\_\-preset@{lsredis\-\_\-find\-\_\-preset}}
\index{lsredis\-\_\-find\-\_\-preset@{lsredis\-\_\-find\-\_\-preset}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsredis\-\_\-find\-\_\-preset}]{\setlength{\rightskip}{0pt plus 5cm}int lsredis\-\_\-find\-\_\-preset (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{base, }
\item[{char $\ast$}]{preset\-\_\-name, }
\item[{double $\ast$}]{dval}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a1ad60526a09ca679f39174ce5d773abe}


Get the value of the given preset and return it in dval Returns 0 on error, non-\/zero on success;. 



Definition at line 937 of file lsredis.\-c.


\begin{DoxyCode}
                                                                            \{
  \textcolor{keywordtype}{char} s[512];
  \textcolor{keywordtype}{int} err;
  ENTRY entry\_in, *entry\_outp;
  \hyperlink{structlsredis__preset__list__struct}{lsredis\_preset\_list\_t} *pl;

  snprintf( s, \textcolor{keyword}{sizeof}( s)-1, \textcolor{stringliteral}{"%s%s"}, motor\_name, preset\_name);
  s[\textcolor{keyword}{sizeof}(s)-1] = 0;

  entry\_in.key  = s;
  entry\_in.data = NULL;
  err = hsearch\_r( entry\_in, FIND, &entry\_outp, &\hyperlink{lsredis_8c_ade00a383533fdefb2af9f3f53f37cf97}{lsredis\_preset\_ht}
      );

  \textcolor{keywordflow}{if}( err == 0) \{
    \textcolor{comment}{// not found (or some other problem that means we don't have an answer}
    \textcolor{comment}{//}
    \textcolor{comment}{// Maybe someone added a new preset and we don't know about it yet}
    \textcolor{comment}{//}
    \hyperlink{lsredis_8c_af48b297b5679750a131fa1e982a078b7}{lsredis\_load\_presets}( motor\_name);
    err = hsearch\_r( entry\_in, FIND, &entry\_outp, &\hyperlink{lsredis_8c_ade00a383533fdefb2af9f3f53f37cf97}{lsredis\_preset\_ht}
      );
    \textcolor{keywordflow}{if}( err == 0) \{
      \textcolor{comment}{//}
      \textcolor{comment}{// Guess not.  Give up.  We tried}
      \textcolor{comment}{//}
      *dval = 0.0;
      \textcolor{keywordflow}{return} 0;
    \}
  \}
  pl = entry\_outp->data;
  *dval = \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\_getd}( pl->\hyperlink{structlsredis__preset__list__struct_ae365a576448adeccb66fbb85cfcf4b23}{position});
  \textcolor{keywordflow}{return} 1;
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_adfe823e3ccec7e37ac4697179bd65b10}{\index{pgpmac.\-h@{pgpmac.\-h}!lsredis\-\_\-find\-\_\-preset\-\_\-index\-\_\-by\-\_\-position@{lsredis\-\_\-find\-\_\-preset\-\_\-index\-\_\-by\-\_\-position}}
\index{lsredis\-\_\-find\-\_\-preset\-\_\-index\-\_\-by\-\_\-position@{lsredis\-\_\-find\-\_\-preset\-\_\-index\-\_\-by\-\_\-position}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsredis\-\_\-find\-\_\-preset\-\_\-index\-\_\-by\-\_\-position}]{\setlength{\rightskip}{0pt plus 5cm}int lsredis\-\_\-find\-\_\-preset\-\_\-index\-\_\-by\-\_\-position (
\begin{DoxyParamCaption}
\item[{{\bf lspmac\-\_\-motor\-\_\-t} $\ast$}]{mp}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_adfe823e3ccec7e37ac4697179bd65b10}


For the given motor object return the index of the current preset or -\/1 if we are not at a preset position. 



Definition at line 1035 of file lsredis.\-c.


\begin{DoxyCode}
                                                               \{
  \hyperlink{structlsredis__obj__struct}{lsredis\_obj\_t} *\hyperlink{namespacemk__pgpmac__redis_a11daf2847f2dc94562b5b61b3f412574}{p};
  \textcolor{keywordtype}{int} plength;
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};
  \textcolor{keywordtype}{double} ur, pos;

  p = \hyperlink{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{lsredis\_get\_obj}( \textcolor{stringliteral}{"%s.presets.length"}, mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name});
  plength = \hyperlink{lsredis_8c_a71689006ffc015be6a0705a7c0aef1be}{lsredis\_get\_or\_set\_l}( p, 0);
  
  \textcolor{keywordflow}{if}( plength <= 0) \{
    \textcolor{keywordflow}{return} -1;
  \}

  ur = \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\_getd}( mp->\hyperlink{structlspmac__motor__struct_aefa84c7592369090eec8b211caaa3a51}{update\_resolution});
  pos = \hyperlink{lspmac_8c_acc46bdddee59bd8c5ad662b3fd445e9f}{lspmac\_getPosition}( mp);

  \textcolor{keywordflow}{for}( i=0; i<plength; i++) \{
    p = \hyperlink{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{lsredis\_get\_obj}( \textcolor{stringliteral}{"%s.presets.%d.position"}, mp->\hyperlink{structlspmac__motor__struct_aa90af2f6f1489f1befe1d0891e51575a}{name},
       i);
    \textcolor{keywordflow}{if}( fabs( pos - \hyperlink{lsredis_8c_aa8daf63b794b6b6341018feec205cb7d}{lsredis\_getd}( p)) <= ur) \{
      \textcolor{keywordflow}{return} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};
    \}
  \}
  \textcolor{keywordflow}{return} -1;
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a6d9f550b9ba36acd237925164abe3ffc}{\index{pgpmac.\-h@{pgpmac.\-h}!lsredis\-\_\-get\-\_\-obj@{lsredis\-\_\-get\-\_\-obj}}
\index{lsredis\-\_\-get\-\_\-obj@{lsredis\-\_\-get\-\_\-obj}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsredis\-\_\-get\-\_\-obj}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lsredis\-\_\-obj\-\_\-t}$\ast$ lsredis\-\_\-get\-\_\-obj (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a6d9f550b9ba36acd237925164abe3ffc}


Definition at line 630 of file lsredis.\-c.


\begin{DoxyCode}
                                                \{
  \hyperlink{structlsredis__obj__struct}{lsredis\_obj\_t} *rtn;
  va\_list arg\_ptr;
  \textcolor{keywordtype}{char} k[512];
  \textcolor{keywordtype}{char} *kp;
  \textcolor{keywordtype}{int} nkp;

  va\_start( arg\_ptr, fmt);
  vsnprintf( k, \textcolor{keyword}{sizeof}(k)-1, fmt, arg\_ptr);
  k[\textcolor{keyword}{sizeof}(k)-1] = 0;
  va\_end( arg\_ptr);

  nkp = strlen(k) + strlen( \hyperlink{lsredis_8c_acdca9095c7a3288d7febe9f4c440a6e9}{lsredis\_head}) + 16;             \textcolor{comment}{// 16
       is overkill. I know. Get over it.}
  kp = calloc( nkp, \textcolor{keyword}{sizeof}( \textcolor{keywordtype}{char}));
  \textcolor{keywordflow}{if}( kp == NULL) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_get\_obj: Out of memory
      "});
    exit( -1);
  \}
  
  snprintf( kp, nkp-1, \textcolor{stringliteral}{"%s.%s"}, \hyperlink{lsredis_8c_acdca9095c7a3288d7febe9f4c440a6e9}{lsredis\_head}, k);
  kp[nkp-1] = 0;

  pthread\_mutex\_lock( &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex});
  \textcolor{keywordflow}{while}( \hyperlink{lsredis_8c_a7461eb2b5974a2ffac2189007d39193c}{lsredis\_running} == 0)
    pthread\_cond\_wait( &\hyperlink{lsredis_8c_a2f63408d16b5603541b124a78f36a5a8}{lsredis\_cond}, &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex});

  rtn = \hyperlink{lsredis_8c_ac3fb8589e280bfa18ecbca6619fea637}{\_lsredis\_get\_obj}( kp);
  pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex});

  free( kp);
  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_abe31d0e11c41b2235307612c963bb652}{\index{pgpmac.\-h@{pgpmac.\-h}!lsredis\-\_\-get\-\_\-string\-\_\-array@{lsredis\-\_\-get\-\_\-string\-\_\-array}}
\index{lsredis\-\_\-get\-\_\-string\-\_\-array@{lsredis\-\_\-get\-\_\-string\-\_\-array}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsredis\-\_\-get\-\_\-string\-\_\-array}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$$\ast$ lsredis\-\_\-get\-\_\-string\-\_\-array (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_abe31d0e11c41b2235307612c963bb652}


Definition at line 448 of file lsredis.\-c.


\begin{DoxyCode}
                                                   \{
  \textcolor{keywordtype}{char} **rtn;

  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{if}( p->\hyperlink{structlsredis__obj__struct_ae0aa00ad745ee5bbc598c23ab794ed8a}{creating} != 0) \{
    pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
    \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\_setstr}( p, \textcolor{stringliteral}{""});
    pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \}

  \textcolor{keywordflow}{while}( p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} == 0)
    pthread\_cond\_wait( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

  rtn = p->\hyperlink{structlsredis__obj__struct_ac065eeede0e08f25bcfedd45022fe593}{avalue};
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  
  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_abbb4e5ece19ebd130e1be18036752a08}{\index{pgpmac.\-h@{pgpmac.\-h}!lsredis\-\_\-getb@{lsredis\-\_\-getb}}
\index{lsredis\-\_\-getb@{lsredis\-\_\-getb}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsredis\-\_\-getb}]{\setlength{\rightskip}{0pt plus 5cm}int lsredis\-\_\-getb (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_abbb4e5ece19ebd130e1be18036752a08}


Definition at line 467 of file lsredis.\-c.


\begin{DoxyCode}
                                    \{
  \textcolor{keywordtype}{int} rtn;

  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{if}( p->\hyperlink{structlsredis__obj__struct_ae0aa00ad745ee5bbc598c23ab794ed8a}{creating} != 0) \{
    pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
    \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\_setstr}( p, \textcolor{stringliteral}{""});
    pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \}
  \textcolor{keywordflow}{while}( p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} == 0)
    pthread\_cond\_wait( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

  rtn = p->\hyperlink{structlsredis__obj__struct_ac3df3eaa275c1e8e333024c1fa8353af}{bvalue};
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  
  \textcolor{keywordflow}{return} rtn;
\}  
\end{DoxyCode}
\hypertarget{pgpmac_8h_a0b7600b1c9a4550b32d4be019d25f941}{\index{pgpmac.\-h@{pgpmac.\-h}!lsredis\-\_\-getc@{lsredis\-\_\-getc}}
\index{lsredis\-\_\-getc@{lsredis\-\_\-getc}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsredis\-\_\-getc}]{\setlength{\rightskip}{0pt plus 5cm}char lsredis\-\_\-getc (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a0b7600b1c9a4550b32d4be019d25f941}


Definition at line 485 of file lsredis.\-c.


\begin{DoxyCode}
                                     \{
  \textcolor{keywordtype}{int} rtn;

  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{if}( p->\hyperlink{structlsredis__obj__struct_ae0aa00ad745ee5bbc598c23ab794ed8a}{creating} != 0) \{
    pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
    \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\_setstr}( p, \textcolor{stringliteral}{""});
    pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \}
  \textcolor{keywordflow}{while}( p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} == 0)
    pthread\_cond\_wait( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

  rtn = p->\hyperlink{structlsredis__obj__struct_a4a5933dbd44d33d9f594f6020a443b69}{cvalue};
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  
  \textcolor{keywordflow}{return} rtn;
\}  
\end{DoxyCode}
\hypertarget{pgpmac_8h_aa8daf63b794b6b6341018feec205cb7d}{\index{pgpmac.\-h@{pgpmac.\-h}!lsredis\-\_\-getd@{lsredis\-\_\-getd}}
\index{lsredis\-\_\-getd@{lsredis\-\_\-getd}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsredis\-\_\-getd}]{\setlength{\rightskip}{0pt plus 5cm}double lsredis\-\_\-getd (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_aa8daf63b794b6b6341018feec205cb7d}


Definition at line 384 of file lsredis.\-c.


\begin{DoxyCode}
                                       \{
  \textcolor{keywordtype}{double} rtn;

  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{if}( p->\hyperlink{structlsredis__obj__struct_ae0aa00ad745ee5bbc598c23ab794ed8a}{creating} != 0) \{
    pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
    \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\_setstr}( p, \textcolor{stringliteral}{""});
    pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \}

  \textcolor{keywordflow}{while}( p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} == 0)
    pthread\_cond\_wait( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

  rtn = p->\hyperlink{structlsredis__obj__struct_ab60d0a71cabad6b921b6edb5a8f68996}{dvalue};
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  
  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a1923f998441f4f451204dfd214d52218}{\index{pgpmac.\-h@{pgpmac.\-h}!lsredis\-\_\-getl@{lsredis\-\_\-getl}}
\index{lsredis\-\_\-getl@{lsredis\-\_\-getl}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsredis\-\_\-getl}]{\setlength{\rightskip}{0pt plus 5cm}long int lsredis\-\_\-getl (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a1923f998441f4f451204dfd214d52218}


Definition at line 403 of file lsredis.\-c.


\begin{DoxyCode}
                                         \{
  \textcolor{keywordtype}{long} \textcolor{keywordtype}{int} rtn;

  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{if}( p->\hyperlink{structlsredis__obj__struct_ae0aa00ad745ee5bbc598c23ab794ed8a}{creating} != 0) \{
    pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
    \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\_setstr}( p, \textcolor{stringliteral}{""});
    pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \}

  \textcolor{keywordflow}{while}( p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} == 0)
    pthread\_cond\_wait( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

  rtn = p->\hyperlink{structlsredis__obj__struct_a26211a0ab3fc02e7776e24dbc1f1256c}{lvalue};
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  
  \textcolor{keywordflow}{return} rtn;
\}  
\end{DoxyCode}
\hypertarget{pgpmac_8h_ac1994e56114b2315294527d76311f829}{\index{pgpmac.\-h@{pgpmac.\-h}!lsredis\-\_\-getstr@{lsredis\-\_\-getstr}}
\index{lsredis\-\_\-getstr@{lsredis\-\_\-getstr}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsredis\-\_\-getstr}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ lsredis\-\_\-getstr (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_ac1994e56114b2315294527d76311f829}


return a copy of the key's string value be sure to free the result 



Definition at line 282 of file lsredis.\-c.


\begin{DoxyCode}
                                        \{
  \textcolor{keywordtype}{char} *rtn;

  \textcolor{comment}{//}
  \textcolor{comment}{// Have to use strdup since we cannot guarantee that p->value won't be freed
       while the caller is still using it}
  \textcolor{comment}{//}
  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{while}( p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} == 0)
    pthread\_cond\_wait( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

  rtn = strdup(p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value});
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a4a7466a8c5b90df6dfc78aef625220f4}{\index{pgpmac.\-h@{pgpmac.\-h}!lsredis\-\_\-init@{lsredis\-\_\-init}}
\index{lsredis\-\_\-init@{lsredis\-\_\-init}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsredis\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a4a7466a8c5b90df6dfc78aef625220f4}


Initialize this module, that is, set up the connections. 


\begin{DoxyParams}{Parameters}
{\em pub} & Publish under this (unique) name \\
\hline
{\em re} & Regular expression to select keys we want to mirror \\
\hline
{\em head} & Prepend this (+ a dot) to the beginning of requested objects \\
\hline
\end{DoxyParams}


Definition at line 1220 of file lsredis.\-c.


\begin{DoxyCode}
                    \{
  \textcolor{keywordtype}{int} err;

  \textcolor{comment}{//}
  \textcolor{comment}{// set up hash map to store redis objects}
  \textcolor{comment}{//}
  err = hcreate\_r( 8192, &\hyperlink{lsredis_8c_a42aec6aa74072797ec0344847b0e9e39}{lsredis\_htab});
  \textcolor{keywordflow}{if}( err == 0) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_init: Cannot create
       hash table.  Really bad things are going to happen.  hcreate\_r returned %d"}, err);
  \}

  pthread\_cond\_init( &\hyperlink{lsredis_8c_a2f63408d16b5603541b124a78f36a5a8}{lsredis\_cond}, NULL);

  \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac} = redisAsyncConnect(\textcolor{stringliteral}{"127.0.0.1"}, 6379);
  \textcolor{keywordflow}{if}( \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->err) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Error: %s"}, \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->errstr
      );
  \}

  \hyperlink{lsredis_8c_a0cd3bdc79d035eb1595371c845d14367}{subfd}.fd           = \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->c.fd;
  \hyperlink{lsredis_8c_a0cd3bdc79d035eb1595371c845d14367}{subfd}.events       = 0;
  \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->ev.data     = &\hyperlink{lsredis_8c_a0cd3bdc79d035eb1595371c845d14367}{subfd};
  \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->ev.addRead  = \hyperlink{lsredis_8c_adee3bccecc86dd531ac5f89491632439}{lsredis\_addRead};
  \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->ev.delRead  = \hyperlink{lsredis_8c_a2e1f2258b3cc864ce3eef4eda556e2a6}{lsredis\_delRead};
  \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->ev.addWrite = \hyperlink{lsredis_8c_a3cb6eda5c8ae80019e7a1c078940e9e9}{lsredis\_addWrite};
  \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->ev.delWrite = \hyperlink{lsredis_8c_a04f0119cfa1156dc34d35b237358822a}{lsredis\_delWrite};
  \hyperlink{lsredis_8c_a4d65536cb1094fb5deda0a852b181232}{subac}->ev.cleanup  = \hyperlink{lsredis_8c_a45f946a5262c23b362be17c2cb0310c2}{lsredis\_cleanup};

  \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac} = redisAsyncConnect(\textcolor{stringliteral}{"127.0.0.1"}, 6379);
  \textcolor{keywordflow}{if}( \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->err) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Error: %s"}, \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->errstr);
  \}

  \hyperlink{lsredis_8c_add819e43a356d0575ec64c346c6fed57}{rofd}.fd           = \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->c.fd;
  \hyperlink{lsredis_8c_add819e43a356d0575ec64c346c6fed57}{rofd}.events       = 0;
  \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->ev.data     = &\hyperlink{lsredis_8c_add819e43a356d0575ec64c346c6fed57}{rofd};
  \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->ev.addRead  = \hyperlink{lsredis_8c_adee3bccecc86dd531ac5f89491632439}{lsredis\_addRead};
  \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->ev.delRead  = \hyperlink{lsredis_8c_a2e1f2258b3cc864ce3eef4eda556e2a6}{lsredis\_delRead};
  \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->ev.addWrite = \hyperlink{lsredis_8c_a3cb6eda5c8ae80019e7a1c078940e9e9}{lsredis\_addWrite};
  \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->ev.delWrite = \hyperlink{lsredis_8c_a04f0119cfa1156dc34d35b237358822a}{lsredis\_delWrite};
  \hyperlink{lsredis_8c_afc92245910ec04f9a341c092def45564}{roac}->ev.cleanup  = \hyperlink{lsredis_8c_a45f946a5262c23b362be17c2cb0310c2}{lsredis\_cleanup};

  \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac} = redisAsyncConnect(\textcolor{stringliteral}{"127.0.0.1"}, 6379);
  \textcolor{keywordflow}{if}( \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->err) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"Error: %s"}, \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->errstr);
  \}

  \hyperlink{lsredis_8c_a13acbee14dbe8cdb98e238abb921d048}{wrfd}.fd           = \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->c.fd;
  \hyperlink{lsredis_8c_a13acbee14dbe8cdb98e238abb921d048}{wrfd}.events       = 0;
  \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->ev.data     = &\hyperlink{lsredis_8c_a13acbee14dbe8cdb98e238abb921d048}{wrfd};
  \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->ev.addRead  = \hyperlink{lsredis_8c_adee3bccecc86dd531ac5f89491632439}{lsredis\_addRead};
  \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->ev.delRead  = \hyperlink{lsredis_8c_a2e1f2258b3cc864ce3eef4eda556e2a6}{lsredis\_delRead};
  \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->ev.addWrite = \hyperlink{lsredis_8c_a3cb6eda5c8ae80019e7a1c078940e9e9}{lsredis\_addWrite};
  \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->ev.delWrite = \hyperlink{lsredis_8c_a04f0119cfa1156dc34d35b237358822a}{lsredis\_delWrite};
  \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}->ev.cleanup  = \hyperlink{lsredis_8c_a45f946a5262c23b362be17c2cb0310c2}{lsredis\_cleanup};


  \textcolor{comment}{// separate hash table for the presets}
  \textcolor{comment}{//}
  hcreate\_r( \hyperlink{lsredis_8c_ace88a236f88278adaac5419a7281c490}{lsredis\_preset\_max\_n} * 2, &\hyperlink{lsredis_8c_ade00a383533fdefb2af9f3f53f37cf97}{lsredis\_preset\_ht}
      );

  pthread\_mutex\_init( &\hyperlink{lsredis_8c_a1d0b14b31b12d1b2a79dc50eac09de39}{lsredis\_preset\_list\_mutex}, &
      \hyperlink{lsredis_8c_a71c9f418904364d65c22d786f4dc5d39}{mutex\_initializer});
  pthread\_mutex\_init( &\hyperlink{lsredis_8c_a0c5cbd80d59d69603f123621cc6ddc30}{lsredis\_config\_mutex}, &
      \hyperlink{lsredis_8c_a71c9f418904364d65c22d786f4dc5d39}{mutex\_initializer});
  pthread\_cond\_init(  &\hyperlink{lsredis_8c_a6fa076f1004c85a8a1dc400f45547f32}{lsredis\_config\_cond},  NULL);
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_af48b297b5679750a131fa1e982a078b7}{\index{pgpmac.\-h@{pgpmac.\-h}!lsredis\-\_\-load\-\_\-presets@{lsredis\-\_\-load\-\_\-presets}}
\index{lsredis\-\_\-load\-\_\-presets@{lsredis\-\_\-load\-\_\-presets}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsredis\-\_\-load\-\_\-presets}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-load\-\_\-presets (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{motor\-\_\-name}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_af48b297b5679750a131fa1e982a078b7}


update the presets hash table for the named motor 



Definition at line 864 of file lsredis.\-c.


\begin{DoxyCode}
                                             \{
  \hyperlink{structlsredis__obj__struct}{lsredis\_obj\_t} *\hyperlink{namespacemk__pgpmac__redis_a11daf2847f2dc94562b5b61b3f412574}{p};
  \hyperlink{structlsredis__preset__list__struct}{lsredis\_preset\_list\_t} *pl;
  \textcolor{keywordtype}{int} plength;
  \textcolor{keywordtype}{char} *preset\_name;
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};
  \textcolor{keywordtype}{int} key\_length;
  ENTRY entry\_in, *entry\_outp;

  p = \hyperlink{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{lsredis\_get\_obj}( \textcolor{stringliteral}{"%s.presets.length"}, motor\_name);
  plength = \hyperlink{lsredis_8c_a71689006ffc015be6a0705a7c0aef1be}{lsredis\_get\_or\_set\_l}( p, 0);
  \textcolor{keywordflow}{if}( plength <= 0)
    \textcolor{keywordflow}{return};

  pthread\_mutex\_lock( &\hyperlink{lsredis_8c_a1d0b14b31b12d1b2a79dc50eac09de39}{lsredis\_preset\_list\_mutex});

  \textcolor{keywordflow}{for}( i=0; i<plength; i++) \{
    pl = calloc( 1, \textcolor{keyword}{sizeof}( \hyperlink{structlsredis__preset__list__struct}{lsredis\_preset\_list\_t}));
    pl->\hyperlink{structlsredis__preset__list__struct_a285a79dd419ae70c5b75ef57914d3331}{name}      = \hyperlink{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{lsredis\_get\_obj}( \textcolor{stringliteral}{"%s.presets.%d.name"},  
         motor\_name, i);
    pl->\hyperlink{structlsredis__preset__list__struct_ae365a576448adeccb66fbb85cfcf4b23}{position}  = \hyperlink{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{lsredis\_get\_obj}( \textcolor{stringliteral}{"
      %s.presets.%d.position"}, motor\_name, i);
    pl->\hyperlink{structlsredis__preset__list__struct_abadcee1d288db4b988946f62bb28d5df}{index}     = \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};
    
    preset\_name   = \hyperlink{lsredis_8c_ac1994e56114b2315294527d76311f829}{lsredis\_getstr}( pl->\hyperlink{structlsredis__preset__list__struct_a285a79dd419ae70c5b75ef57914d3331}{name});
    key\_length    = strlen( motor\_name) + strlen( preset\_name) + 1;
    pl->\hyperlink{structlsredis__preset__list__struct_ab3a50b52cf845fa70667d8be9ea7d73b}{key}       = calloc( key\_length, 1);

    pl->\hyperlink{structlsredis__preset__list__struct_a14422c8bfa270e5620c66be871091f67}{next}            = \hyperlink{lsredis_8c_a232f994f0d91ba8157cbcfe429fc90de}{lsredis\_preset\_list};
    \hyperlink{lsredis_8c_a232f994f0d91ba8157cbcfe429fc90de}{lsredis\_preset\_list} = pl;

    snprintf( pl->\hyperlink{structlsredis__preset__list__struct_ab3a50b52cf845fa70667d8be9ea7d73b}{key}, key\_length, \textcolor{stringliteral}{"%s%s"}, motor\_name, preset\_name);

    entry\_in.key  = pl->\hyperlink{structlsredis__preset__list__struct_ab3a50b52cf845fa70667d8be9ea7d73b}{key};
    entry\_in.data = pl;
    hsearch\_r( entry\_in, ENTER, &entry\_outp, &\hyperlink{lsredis_8c_ade00a383533fdefb2af9f3f53f37cf97}{lsredis\_preset\_ht}
      );
    \textcolor{keywordflow}{if}( entry\_outp->data != pl) \{
      \textcolor{comment}{//}
      \textcolor{comment}{// The key was already there or we couldn't add it}
      \textcolor{comment}{//}
      \textcolor{keywordflow}{if}( entry\_outp->data == NULL)
        \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_load\_presets:
       could not add preset '%s' for motor '%s'"}, preset\_name, motor\_name);

      free( pl->\hyperlink{structlsredis__preset__list__struct_ab3a50b52cf845fa70667d8be9ea7d73b}{key});
      free( pl);
    \} \textcolor{keywordflow}{else} \{
      \textcolor{comment}{//}
      \textcolor{comment}{// We've successfully added the new key}
      \textcolor{comment}{//}
      \hyperlink{lsredis_8c_adace74d8fa7d2dd58854fa09e66da807}{lsredis\_preset\_n}++;
      \textcolor{comment}{//}
      \textcolor{comment}{// Resize the hash table if we are starting to fill it up}
      \textcolor{comment}{// Generally we prefer a sparse table}
      \textcolor{comment}{//}
      \textcolor{keywordflow}{if}( \hyperlink{lsredis_8c_adace74d8fa7d2dd58854fa09e66da807}{lsredis\_preset\_n} >= \hyperlink{lsredis_8c_ace88a236f88278adaac5419a7281c490}{lsredis\_preset\_max\_n}
      ) \{
        \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_load\_presets:
       increasing preset hash table size.  max now %d"}, \hyperlink{lsredis_8c_ace88a236f88278adaac5419a7281c490}{lsredis\_preset\_max\_n}
      );
        hdestroy\_r( &\hyperlink{lsredis_8c_ade00a383533fdefb2af9f3f53f37cf97}{lsredis\_preset\_ht});
        \hyperlink{lsredis_8c_ace88a236f88278adaac5419a7281c490}{lsredis\_preset\_max\_n} *= 2;
        hcreate\_r( 2 * \hyperlink{lsredis_8c_ace88a236f88278adaac5419a7281c490}{lsredis\_preset\_max\_n}, &
      \hyperlink{lsredis_8c_ade00a383533fdefb2af9f3f53f37cf97}{lsredis\_preset\_ht});
        \textcolor{keywordflow}{for}( pl = \hyperlink{lsredis_8c_a232f994f0d91ba8157cbcfe429fc90de}{lsredis\_preset\_list}; pl != NULL; pl = pl->
      \hyperlink{structlsredis__preset__list__struct_a14422c8bfa270e5620c66be871091f67}{next}) \{
          entry\_in.key  = pl->\hyperlink{structlsredis__preset__list__struct_ab3a50b52cf845fa70667d8be9ea7d73b}{key};
          entry\_in.data = pl;
          hsearch\_r( entry\_in, ENTER, &entry\_outp, &\hyperlink{lsredis_8c_ade00a383533fdefb2af9f3f53f37cf97}{lsredis\_preset\_ht}
      );
        \}
        \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_load\_presets: done
       increasing preset hash table size."}, \hyperlink{lsredis_8c_ace88a236f88278adaac5419a7281c490}{lsredis\_preset\_max\_n});
      \}
    \}
    free( preset\_name);
  \}
  pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_a1d0b14b31b12d1b2a79dc50eac09de39}{lsredis\_preset\_list\_mutex});
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a065d09eb6914c057383980d3d786affc}{\index{pgpmac.\-h@{pgpmac.\-h}!lsredis\-\_\-log@{lsredis\-\_\-log}}
\index{lsredis\-\_\-log@{lsredis\-\_\-log}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsredis\-\_\-log}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-log (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{fmt, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a065d09eb6914c057383980d3d786affc}


send log message to our redis log key 



Definition at line 1064 of file lsredis.\-c.


\begin{DoxyCode}
                                  \{
  \textcolor{keyword}{static} \hyperlink{structlsredis__obj__struct}{lsredis\_obj\_t} *loghashs[32];
  \textcolor{keyword}{static} \textcolor{keywordtype}{int} firstTime = 1;
  \textcolor{keyword}{static} \textcolor{keywordtype}{int} lhi = 0;
  \textcolor{keywordtype}{char} msg[2048+64];
  va\_list arg\_ptr;
  
  
  
  \textcolor{keywordflow}{if}( pthread\_mutex\_trylock( &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex}) == 0) \{
    
    
    \textcolor{keywordflow}{if}( \hyperlink{lsredis_8c_acdca9095c7a3288d7febe9f4c440a6e9}{lsredis\_head} == NULL) \{                     \textcolor{comment}{// Ignore
       messages that come before redis is initiallized}
      pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex});
      \textcolor{keywordflow}{return};
    \}
    
    \textcolor{keywordflow}{if}( firstTime) \{
      \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};
      \textcolor{keywordflow}{for}( i=0; i<\textcolor{keyword}{sizeof}(loghashs)/\textcolor{keyword}{sizeof}(loghashs[0]); i++) \{
        loghashs[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}] = \hyperlink{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{lsredis\_get\_obj}( \textcolor{stringliteral}{"log.message.%d"}, i);
      \}
      lhi = 0;
      firstTime=0;
    \}
    
    va\_start( arg\_ptr, fmt);
    vsnprintf( msg, \textcolor{keyword}{sizeof}(msg)-1, fmt, arg\_ptr);
    va\_end( arg\_ptr);
    msg[\textcolor{keyword}{sizeof}(msg)-1]=0;
    
    \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\_setstr}( loghashs[lhi], \textcolor{stringliteral}{"%s"}, msg);
    lhi = (lhi+1) % (\textcolor{keyword}{sizeof}(loghashs)/\textcolor{keyword}{sizeof}(loghashs[0]));
    pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex});
    
  \}
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_ac58fca47533e695c8775e0d2b9128766}{\index{pgpmac.\-h@{pgpmac.\-h}!lsredis\-\_\-regexec@{lsredis\-\_\-regexec}}
\index{lsredis\-\_\-regexec@{lsredis\-\_\-regexec}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsredis\-\_\-regexec}]{\setlength{\rightskip}{0pt plus 5cm}int lsredis\-\_\-regexec (
\begin{DoxyParamCaption}
\item[{const regex\-\_\-t $\ast$}]{preg, }
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p, }
\item[{size\-\_\-t}]{nmatch, }
\item[{regmatch\-\_\-t $\ast$}]{pmatch, }
\item[{int}]{eflags}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_ac58fca47533e695c8775e0d2b9128766}


Definition at line 265 of file lsredis.\-c.


\begin{DoxyCode}
                                                                               
                                  \{
  \textcolor{keywordtype}{int} rtn;

  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \textcolor{keywordflow}{while}( p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} == 0) 
    pthread\_cond\_wait( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond}, &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

  rtn = regexec( preg, p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value}, nmatch, pmatch, eflags);

  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

  \textcolor{keywordflow}{return} rtn;
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_ac3db3d5f91bf5723bd94748ce0d88731}{\index{pgpmac.\-h@{pgpmac.\-h}!lsredis\-\_\-run@{lsredis\-\_\-run}}
\index{lsredis\-\_\-run@{lsredis\-\_\-run}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsredis\-\_\-run}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-t$\ast$ lsredis\-\_\-run (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_ac3db3d5f91bf5723bd94748ce0d88731}


Definition at line 1437 of file lsredis.\-c.


\begin{DoxyCode}
                         \{
  pthread\_create( &\hyperlink{lsredis_8c_a79c33eb11ad6819247930ade3a25671f}{lsredis\_thread}, NULL, \hyperlink{lsredis_8c_ade7b1ddfdc88c6964a4c90513e360f75}{lsredis\_worker}
      , NULL);
  \textcolor{keywordflow}{return} &\hyperlink{lsredis_8c_a79c33eb11ad6819247930ade3a25671f}{lsredis\_thread};
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_ad4c059ab8209b87131b5c94883a05f39}{\index{pgpmac.\-h@{pgpmac.\-h}!lsredis\-\_\-set\-\_\-preset@{lsredis\-\_\-set\-\_\-preset}}
\index{lsredis\-\_\-set\-\_\-preset@{lsredis\-\_\-set\-\_\-preset}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsredis\-\_\-set\-\_\-preset}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-set\-\_\-preset (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{base, }
\item[{char $\ast$}]{preset\-\_\-name, }
\item[{double}]{dval}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_ad4c059ab8209b87131b5c94883a05f39}


set the given preset to the given value create a new preset if we can't find it 



Definition at line 974 of file lsredis.\-c.


\begin{DoxyCode}
                                                                           \{
  \textcolor{keywordtype}{char} s[512];
  \textcolor{keywordtype}{int} plength;
  \textcolor{keywordtype}{int} err;
  ENTRY entry\_in, *entry\_outp;
  \hyperlink{structlsredis__obj__struct}{lsredis\_obj\_t} *p1, *p2, *presets\_length\_p;
  \hyperlink{structlsredis__preset__list__struct}{lsredis\_preset\_list\_t} *pl;
  \textcolor{keyword}{struct }timespec timeout;

  snprintf( s, \textcolor{keyword}{sizeof}( s)-1, \textcolor{stringliteral}{"%s%s"}, motor\_name, preset\_name);
  s[\textcolor{keyword}{sizeof}(s)-1] = 0;

  entry\_in.key  = s;
  entry\_in.data = NULL;
  pthread\_mutex\_lock( &\hyperlink{lsredis_8c_a1d0b14b31b12d1b2a79dc50eac09de39}{lsredis\_preset\_list\_mutex});
  err = hsearch\_r( entry\_in, FIND, &entry\_outp, &\hyperlink{lsredis_8c_ade00a383533fdefb2af9f3f53f37cf97}{lsredis\_preset\_ht}
      );
  \textcolor{keywordflow}{if}( err != 0) \{
    \textcolor{comment}{//}
    \textcolor{comment}{// Found it.  Things are simple.}
    \textcolor{comment}{//}
    pthread\_mutex\_unlock( &p1->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});


    pl = entry\_outp->data;
    \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\_setstr}( pl->\hyperlink{structlsredis__preset__list__struct_ae365a576448adeccb66fbb85cfcf4b23}{position}, \textcolor{stringliteral}{"%.3f"}, dval);
    pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_a1d0b14b31b12d1b2a79dc50eac09de39}{lsredis\_preset\_list\_mutex});
    \textcolor{keywordflow}{return};
  \}
  \textcolor{comment}{//}
  \textcolor{comment}{// OK, our preset was not found, add it}
  \textcolor{comment}{//}
  presets\_length\_p = \hyperlink{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{lsredis\_get\_obj}(  \textcolor{stringliteral}{"%s.presets.length"}, 
      motor\_name);
  plength = \hyperlink{lsredis_8c_a71689006ffc015be6a0705a7c0aef1be}{lsredis\_get\_or\_set\_l}( presets\_length\_p, 0);
  plength += 1;

  snprintf( s, \textcolor{keyword}{sizeof}( s)-1, \textcolor{stringliteral}{"%s.%s.presets.%d.name"}, \hyperlink{lsredis_8c_acdca9095c7a3288d7febe9f4c440a6e9}{lsredis\_head},
       motor\_name, plength-1);
  s[\textcolor{keyword}{sizeof}(s)-1] = 0;

  p1 = \hyperlink{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{lsredis\_get\_obj}( \textcolor{stringliteral}{"%s.presets.%d.name"}, motor\_name, 
      plength-1);
  pthread\_mutex\_lock( &p1->mutex);
  err = 0;
  \textcolor{keywordflow}{while}( err == 0 && p1->valid == 0)
    err = pthread\_cond\_timedwait( &p1->cond, &p1->mutex, &timeout);

  \textcolor{keywordflow}{if}( err == ETIMEDOUT) \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lsredis\_set\_preset: timed out
       waiting for name to become valid"});
  \}
  pthread\_mutex\_unlock( &p1->mutex);
  \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\_setstr}( p1, \textcolor{stringliteral}{"%s"}, preset\_name);
  
  p2 = \hyperlink{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{lsredis\_get\_obj}( \textcolor{stringliteral}{"%s.presets.%d.position"}, motor\_name, 
      plength-1);
  \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\_setstr}( p2, \textcolor{stringliteral}{"%.3f"}, dval);
  
  \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\_setstr}( presets\_length\_p, \textcolor{stringliteral}{"%ld"}, plength);

  pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_a1d0b14b31b12d1b2a79dc50eac09de39}{lsredis\_preset\_list\_mutex});
  \hyperlink{lsredis_8c_af48b297b5679750a131fa1e982a078b7}{lsredis\_load\_presets}( motor\_name);
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a9b9c64f883c7ded60badfe89cb15fa78}{\index{pgpmac.\-h@{pgpmac.\-h}!lsredis\-\_\-setstr@{lsredis\-\_\-setstr}}
\index{lsredis\-\_\-setstr@{lsredis\-\_\-setstr}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsredis\-\_\-setstr}]{\setlength{\rightskip}{0pt plus 5cm}void lsredis\-\_\-setstr (
\begin{DoxyParamCaption}
\item[{{\bf lsredis\-\_\-obj\-\_\-t} $\ast$}]{p, }
\item[{char $\ast$}]{fmt, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a9b9c64f883c7ded60badfe89cb15fa78}


Set the value and update redis. 

Note that lsredis\-\_\-set\-\_\-value sets the value based on redis while here we set redis based on the value Arbitray maximum string length set here. T\-O\-D\-O\-: Probably this limit should be removed at some point.

redis\-Async\-Command\-Argv used instead of redis\-Async\-Command 'cause it's easier (and possible) to deal with strings that would otherwise cause hiredis to emit a bad command, like those containing spaces. $<$ up the count of times we need to see ourselves published before we start listening to others again

$<$ Unlock to prevent deadlock in case the service routine needs to set our value

$<$ redis\-Async\-Command\-Argv shouldn't need to access this after it's made up it's packet (before it returns) so we should be O\-K with this location disappearing soon.

$<$ At this point the key is considered created 

Definition at line 307 of file lsredis.\-c.


\begin{DoxyCode}
                                                       \{
  va\_list arg\_ptr;
  \textcolor{keywordtype}{char} \hyperlink{namespacemk__pgpmac__redis_ac732d49b0afca9a9951e3a252bae42fc}{v}[512];
  \textcolor{keywordtype}{char} *argv[4];

  va\_start( arg\_ptr, fmt);
  vsnprintf( v, \textcolor{keyword}{sizeof}(v)-1, fmt, arg\_ptr);
  v[\textcolor{keyword}{sizeof}(\hyperlink{namespacemk__pgpmac__redis_ac732d49b0afca9a9951e3a252bae42fc}{v})-1] = 0;
  va\_end( arg\_ptr);
  
  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});

  \textcolor{comment}{//}
  \textcolor{comment}{// Don't send an update if a good value has not changed}
  \textcolor{comment}{//}
  \textcolor{keywordflow}{if}( p->\hyperlink{structlsredis__obj__struct_ae0aa00ad745ee5bbc598c23ab794ed8a}{creating} != 0 && p->\hyperlink{structlsredis__obj__struct_a338ffa4123bd06b39c8b58f5e695575e}{valid} && strcmp( v, p->\hyperlink{structlsredis__obj__struct_a0465c65288e8101805a6f91049164517}{value}) ==
       0) \{
    \textcolor{comment}{// nothing to do}
    pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
    \textcolor{keywordflow}{return};
  \}

  p->\hyperlink{structlsredis__obj__struct_a8bc1a536b7155a1e2a749c7c434b898b}{wait\_for\_me}++;                  
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});        


  argv[0] = \textcolor{stringliteral}{"HSET"};
  argv[1] = p->\hyperlink{structlsredis__obj__struct_aa8c5a453b9424e5666320b8675a42f5c}{key};
  argv[2] = \textcolor{stringliteral}{"VALUE"};
  argv[3] = \hyperlink{namespacemk__pgpmac__redis_ac732d49b0afca9a9951e3a252bae42fc}{v};         


  pthread\_mutex\_lock( &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex});
  \textcolor{keywordflow}{while}( \hyperlink{lsredis_8c_a7461eb2b5974a2ffac2189007d39193c}{lsredis\_running} == 0)
    pthread\_cond\_wait( &\hyperlink{lsredis_8c_a2f63408d16b5603541b124a78f36a5a8}{lsredis\_cond}, &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex});

  redisAsyncCommand( \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}, NULL, NULL, \textcolor{stringliteral}{"MULTI"});
  redisAsyncCommandArgv( \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}, NULL, NULL, 4, (\textcolor{keyword}{const} \textcolor{keywordtype}{char} **)argv, NULL);

  redisAsyncCommand( \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}, NULL, NULL, \textcolor{stringliteral}{"PUBLISH %s %s"}, \hyperlink{lsredis_8c_a0c81dce2e75584eeb14ab7d9dd86c72e}{lsredis\_publisher}
      , p->\hyperlink{structlsredis__obj__struct_aa8c5a453b9424e5666320b8675a42f5c}{key});
  redisAsyncCommand( \hyperlink{lsredis_8c_a7ea13129ad9e41a0ed2fc19fa75ffb0d}{wrac}, NULL, NULL, \textcolor{stringliteral}{"EXEC"});
  pthread\_mutex\_unlock( &\hyperlink{lsredis_8c_a390e8acf789b0fa41b43a794dd27e28f}{lsredis\_mutex});

  \textcolor{comment}{// Assume redis will take exactly the value we sent it}
  \textcolor{comment}{//}
  pthread\_mutex\_lock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
  \hyperlink{lsredis_8c_a05c7ed2bb1b5702a5c83ed3b51abb546}{\_lsredis\_set\_value}( p, v);
  p->\hyperlink{structlsredis__obj__struct_ae0aa00ad745ee5bbc598c23ab794ed8a}{creating} = 0;                      
  pthread\_cond\_signal( &p->\hyperlink{structlsredis__obj__struct_a356f6a228bb19ac7d66fdb1c875d68be}{cond});
  pthread\_mutex\_unlock( &p->\hyperlink{structlsredis__obj__struct_a0da18e7d0f7d52459bbc6fbc696d5252}{mutex});
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a7b84b6a923167d84c1aefbd2241864c3}{\index{pgpmac.\-h@{pgpmac.\-h}!lstest\-\_\-main@{lstest\-\_\-main}}
\index{lstest\-\_\-main@{lstest\-\_\-main}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lstest\-\_\-main}]{\setlength{\rightskip}{0pt plus 5cm}void lstest\-\_\-main (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a7b84b6a923167d84c1aefbd2241864c3}


Definition at line 92 of file lstest.\-c.


\begin{DoxyCode}
                   \{
  \hyperlink{lstest_8c_acaa27d0c837aa325ad6b6212e67b182d}{lstest\_lspmac\_est\_move\_time}();
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a8cd37a8fb0f061456456a5d79bdd5189}{\index{pgpmac.\-h@{pgpmac.\-h}!lstimer\-\_\-init@{lstimer\-\_\-init}}
\index{lstimer\-\_\-init@{lstimer\-\_\-init}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lstimer\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void lstimer\-\_\-init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a8cd37a8fb0f061456456a5d79bdd5189}


Initialize the timer list and pthread stuff. 



Definition at line 270 of file lstimer.\-c.


\begin{DoxyCode}
                    \{
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};

  \textcolor{keywordflow}{for}( i=0; i<\hyperlink{lstimer_8c_af020a0f708e86162a32d2ca6373c96bb}{LSTIMER\_LIST\_LENGTH}; i++) \{
    \hyperlink{lstimer_8c_a35b456765fe2c955cef445768d12ca6c}{lstimer\_list}[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}].\hyperlink{structlstimer__list__struct_ac7ab4cd1f3065156f95b49e66bf05283}{shots} = 0;
  \}


  pthread\_mutex\_init( &\hyperlink{lstimer_8c_a170993cbed9b9ec8bc64b6642a3ed581}{lstimer\_mutex}, NULL);
  pthread\_cond\_init(  &\hyperlink{lstimer_8c_a96b7516e4a15c4b879de82a569cd5f0a}{lstimer\_cond}, NULL);
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_aa9fdc057e219c162d67c5cb77a2bf7a4}{\index{pgpmac.\-h@{pgpmac.\-h}!lstimer\-\_\-run@{lstimer\-\_\-run}}
\index{lstimer\-\_\-run@{lstimer\-\_\-run}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lstimer\-\_\-run}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-t$\ast$ lstimer\-\_\-run (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_aa9fdc057e219c162d67c5cb77a2bf7a4}


Start up our thread. 



Definition at line 284 of file lstimer.\-c.


\begin{DoxyCode}
                         \{
  pthread\_create( &\hyperlink{lstimer_8c_a76660e8720b08f4adee2be9f44b5f419}{lstimer\_thread}, NULL, \hyperlink{lstimer_8c_ab8b409bb2a7ff78da22d988cfb3b537a}{lstimer\_worker}
      , NULL);
  \textcolor{keywordflow}{return} &\hyperlink{lstimer_8c_a76660e8720b08f4adee2be9f44b5f419}{lstimer\_thread};
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a264897effdf49ed8d5aa34e8ed05c2d3}{\index{pgpmac.\-h@{pgpmac.\-h}!lstimer\-\_\-set\-\_\-timer@{lstimer\-\_\-set\-\_\-timer}}
\index{lstimer\-\_\-set\-\_\-timer@{lstimer\-\_\-set\-\_\-timer}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lstimer\-\_\-set\-\_\-timer}]{\setlength{\rightskip}{0pt plus 5cm}void lstimer\-\_\-set\-\_\-timer (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{event, }
\item[{int}]{shots, }
\item[{unsigned long int}]{secs, }
\item[{unsigned long int}]{nsecs}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a264897effdf49ed8d5aa34e8ed05c2d3}


Create a timer. 


\begin{DoxyParams}{Parameters}
{\em event} & Name of the event to send when the timer goes off \\
\hline
{\em shots} & Number of times to run. 0 means never, -\/1 means forever \\
\hline
{\em secs} & Number of seconds to wait \\
\hline
{\em nsecs} & Number of nano-\/seconds to run in addition to secs \\
\hline
\end{DoxyParams}


Definition at line 63 of file lstimer.\-c.


\begin{DoxyCode}
                                                                               
                        \{
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};
  \textcolor{keyword}{struct }timespec \hyperlink{kvredis_8c_ad40ac52086f6b774928af45b09d54c6e}{now};

  \textcolor{comment}{// Time we were called.  Delay is based on call time, not queued time}
  \textcolor{comment}{//}
  clock\_gettime( CLOCK\_REALTIME, &\hyperlink{kvredis_8c_ad40ac52086f6b774928af45b09d54c6e}{now});
  

  \textcolor{comment}{// Make sure our event is registered (saves a tiny bit of time later)}
  \textcolor{comment}{//}
  \hyperlink{lsevents_8c_ae09cfa92dba806d8f8808e5822ea713c}{lsevents\_preregister\_event}( event);

  pthread\_mutex\_lock( &\hyperlink{lstimer_8c_a170993cbed9b9ec8bc64b6642a3ed581}{lstimer\_mutex});

  \textcolor{keywordflow}{for}( i=0; i<\hyperlink{lstimer_8c_af020a0f708e86162a32d2ca6373c96bb}{LSTIMER\_LIST\_LENGTH}; i++) \{
    \textcolor{keywordflow}{if}( \hyperlink{lstimer_8c_a35b456765fe2c955cef445768d12ca6c}{lstimer\_list}[i].shots == 0)
      \textcolor{keywordflow}{break};
  \}

  \textcolor{keywordflow}{if}( i == LSTIMER\_LIST\_LENGTH) \{
    pthread\_mutex\_unlock( &\hyperlink{lstimer_8c_a170993cbed9b9ec8bc64b6642a3ed581}{lstimer\_mutex});
    
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"lstimer\_set\_timer: out of
       timers for event: %s, shots: %d,  secs: %u, nsecs: %u"},
                          event, shots, secs, nsecs);
    \textcolor{keywordflow}{return};
  \}

  strncpy( \hyperlink{lstimer_8c_a35b456765fe2c955cef445768d12ca6c}{lstimer\_list}[i].event, event, \hyperlink{pgpmac_8h_ab61d790b5572f116e091babfda53627b}{LSEVENTS\_EVENT\_LENGTH}
       - 1);
  \hyperlink{lstimer_8c_a35b456765fe2c955cef445768d12ca6c}{lstimer\_list}[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}].\hyperlink{structlstimer__list__struct_a54d564e392315b2730278bb925803184}{event}[\hyperlink{pgpmac_8h_ab61d790b5572f116e091babfda53627b}{LSEVENTS\_EVENT\_LENGTH}
       - 1] = 0;
  \hyperlink{lstimer_8c_a35b456765fe2c955cef445768d12ca6c}{lstimer\_list}[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}].\hyperlink{structlstimer__list__struct_ac7ab4cd1f3065156f95b49e66bf05283}{shots}        = shots;
  \hyperlink{lstimer_8c_a35b456765fe2c955cef445768d12ca6c}{lstimer\_list}[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}].\hyperlink{structlstimer__list__struct_aa5eac664fe8159916bc3cdfbf583f818}{delay\_secs}   = secs;
  \hyperlink{lstimer_8c_a35b456765fe2c955cef445768d12ca6c}{lstimer\_list}[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}].\hyperlink{structlstimer__list__struct_a45e9fc0b669a1b2831d46b465822344c}{delay\_nsecs}  = nsecs;

  \hyperlink{lstimer_8c_a35b456765fe2c955cef445768d12ca6c}{lstimer\_list}[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}].\hyperlink{structlstimer__list__struct_a6a7538fafa77c5769c8dd2bdd34500b7}{next\_secs}    = secs + \hyperlink{kvredis_8c_ad40ac52086f6b774928af45b09d54c6e}{now}.tv\_sec + (
      \hyperlink{kvredis_8c_ad40ac52086f6b774928af45b09d54c6e}{now}.tv\_nsec + nsecs) / 1000000000;
  \hyperlink{lstimer_8c_a35b456765fe2c955cef445768d12ca6c}{lstimer\_list}[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}].\hyperlink{structlstimer__list__struct_acf993c87ab0ee8ffd74c3907022d6996}{next\_nsecs}   = (\hyperlink{kvredis_8c_ad40ac52086f6b774928af45b09d54c6e}{now}.tv\_nsec + nsecs
      ) % 1000000000;
  \hyperlink{lstimer_8c_a35b456765fe2c955cef445768d12ca6c}{lstimer\_list}[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}].\hyperlink{structlstimer__list__struct_a8f881e66431efbed84b6ad029757bc67}{last\_secs}    = 0;
  \hyperlink{lstimer_8c_a35b456765fe2c955cef445768d12ca6c}{lstimer\_list}[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}].\hyperlink{structlstimer__list__struct_a0b2ab04246481397116ac9770c3c6603}{last\_nsecs}   = 0;
  
  \hyperlink{lstimer_8c_a35b456765fe2c955cef445768d12ca6c}{lstimer\_list}[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}].\hyperlink{structlstimer__list__struct_aa56c5b8ce7fa0ae93132cb9908195836}{ncalls}       = 0;
  \hyperlink{lstimer_8c_a35b456765fe2c955cef445768d12ca6c}{lstimer\_list}[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}].\hyperlink{structlstimer__list__struct_a9633d830ecdce7852530079bb09a6d3c}{init\_secs}    = \hyperlink{kvredis_8c_ad40ac52086f6b774928af45b09d54c6e}{now}.tv\_sec;
  \hyperlink{lstimer_8c_a35b456765fe2c955cef445768d12ca6c}{lstimer\_list}[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}].\hyperlink{structlstimer__list__struct_a72665e0a227b5ee0c82aee43dfaf440a}{init\_nsecs}   = \hyperlink{kvredis_8c_ad40ac52086f6b774928af45b09d54c6e}{now}.tv\_nsec;

  \textcolor{keywordflow}{if}( shots != 0) \{
    \hyperlink{lstimer_8c_a1a47dadbec1776920ab83409234c1833}{lstimer\_active\_timers}++;
    \hyperlink{lstimer_8c_a5a3c6ef3507448d284d91958878d3f75}{new\_timer}++;
  \}

  pthread\_cond\_signal(  &\hyperlink{lstimer_8c_a96b7516e4a15c4b879de82a569cd5f0a}{lstimer\_cond});
  pthread\_mutex\_unlock( &\hyperlink{lstimer_8c_a170993cbed9b9ec8bc64b6642a3ed581}{lstimer\_mutex});
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a5738e4146b4691aad038b622b0381cac}{\index{pgpmac.\-h@{pgpmac.\-h}!lstimer\-\_\-unset\-\_\-timer@{lstimer\-\_\-unset\-\_\-timer}}
\index{lstimer\-\_\-unset\-\_\-timer@{lstimer\-\_\-unset\-\_\-timer}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lstimer\-\_\-unset\-\_\-timer}]{\setlength{\rightskip}{0pt plus 5cm}void lstimer\-\_\-unset\-\_\-timer (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{event}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a5738e4146b4691aad038b622b0381cac}


Unsets all timers for the given event. 



Definition at line 46 of file lstimer.\-c.


\begin{DoxyCode}
                                       \{
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i};

  \textcolor{keywordflow}{for}( i=0; i<\hyperlink{lstimer_8c_af020a0f708e86162a32d2ca6373c96bb}{LSTIMER\_LIST\_LENGTH}; i++) \{
    \textcolor{keywordflow}{if}( strcmp( event, \hyperlink{lstimer_8c_a35b456765fe2c955cef445768d12ca6c}{lstimer\_list}[i].event) == 0) \{
      \hyperlink{lstimer_8c_a35b456765fe2c955cef445768d12ca6c}{lstimer\_list}[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}].\hyperlink{structlstimer__list__struct_ac7ab4cd1f3065156f95b49e66bf05283}{shots} = 0;
    \}
  \}
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_adf63440ffbc65024fef87ea6a11ea8b0}{\index{pgpmac.\-h@{pgpmac.\-h}!lsupdate\-\_\-init@{lsupdate\-\_\-init}}
\index{lsupdate\-\_\-init@{lsupdate\-\_\-init}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsupdate\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void lsupdate\-\_\-init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_adf63440ffbc65024fef87ea6a11ea8b0}
\hypertarget{pgpmac_8h_aebca330b67b5150d8fd5ae57bec80bf6}{\index{pgpmac.\-h@{pgpmac.\-h}!lsupdate\-\_\-run@{lsupdate\-\_\-run}}
\index{lsupdate\-\_\-run@{lsupdate\-\_\-run}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsupdate\-\_\-run}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-t$\ast$ lsupdate\-\_\-run (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_aebca330b67b5150d8fd5ae57bec80bf6}
\hypertarget{pgpmac_8h_a0851b1baecda6a67993efde41d77b1c1}{\index{pgpmac.\-h@{pgpmac.\-h}!md2cmds\-\_\-init@{md2cmds\-\_\-init}}
\index{md2cmds\-\_\-init@{md2cmds\-\_\-init}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{md2cmds\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void md2cmds\-\_\-init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a0851b1baecda6a67993efde41d77b1c1}


Initialize the md2cmds module. 



Definition at line 1984 of file md2cmds.\-c.


\begin{DoxyCode}
                    \{
  ENTRY hloader, *hrtnval;
  \textcolor{keywordtype}{int} \hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}, err;
  \textcolor{keywordtype}{int} ncmds;

  pthread\_mutexattr\_t \hyperlink{lsredis_8c_a71c9f418904364d65c22d786f4dc5d39}{mutex\_initializer};

  pthread\_mutexattr\_init( &mutex\_initializer);
  pthread\_mutexattr\_settype( &mutex\_initializer, PTHREAD\_MUTEX\_RECURSIVE);

  pthread\_mutex\_init( &\hyperlink{md2cmds_8c_ad67304bb851dc6268b0cda2f40fc5aa8}{md2cmds\_mutex}, &mutex\_initializer);
  pthread\_cond\_init( &\hyperlink{md2cmds_8c_a08d5b18ec9478d753c46a3e28d1f2126}{md2cmds\_cond}, NULL);


  pthread\_mutex\_init( &\hyperlink{md2cmds_8c_a4ea6e6bf63aefcd49f87c3921029451d}{md2cmds\_moving\_mutex}, &
      mutex\_initializer);
  pthread\_cond\_init(  &\hyperlink{md2cmds_8c_adeebdb8f552bff14bd666c187505ee9e}{md2cmds\_moving\_cond}, NULL);

  pthread\_mutex\_init( &\hyperlink{md2cmds_8c_acb54710bbbc6ea638326e93071900d1b}{md2cmds\_homing\_mutex}, &
      mutex\_initializer);
  pthread\_cond\_init(  &\hyperlink{md2cmds_8c_ac8e45a64495062e32b7887651627f46d}{md2cmds\_homing\_cond}, NULL);

  err = regcomp( &\hyperlink{md2cmds_8c_ad07af354194cb9a8eac1f200257dcacd}{md2cmds\_cmd\_regex}, \textcolor{stringliteral}{" *([^ ]+) (([^ ]+)\(\backslash\)\(\backslash\)
      .presets\(\backslash\)\(\backslash\)..)*([^ ]*) *([^ ]*)"}, REG\_EXTENDED);
  \textcolor{keywordflow}{if}( err != 0) \{
    \textcolor{keywordtype}{int} nerrmsg;
    \textcolor{keywordtype}{char} *errmsg;

    nerrmsg = regerror( err, &\hyperlink{md2cmds_8c_ad07af354194cb9a8eac1f200257dcacd}{md2cmds\_cmd\_regex}, NULL, 0);
    \textcolor{keywordflow}{if}( nerrmsg > 0) \{
      errmsg = calloc( nerrmsg, \textcolor{keyword}{sizeof}( \textcolor{keywordtype}{char}));
      nerrmsg = regerror( err, &\hyperlink{md2cmds_8c_ad07af354194cb9a8eac1f200257dcacd}{md2cmds\_cmd\_regex}, errmsg, 
      nerrmsg);
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"md2cmds\_init: %s"}, errmsg);
      free( errmsg);
    \}
  \}

  \hyperlink{md2cmds_8c_a6a34fb6876abbd580629d3708c805e7f}{md2cmds\_md\_status\_code} = \hyperlink{lsredis_8c_ad3bb3ebbae1ffbd03e062ecdd663cc6a}{lsredis\_get\_obj}
      ( \textcolor{stringliteral}{"md2\_status\_code"});
  \hyperlink{lsredis_8c_a9b9c64f883c7ded60badfe89cb15fa78}{lsredis\_setstr}( \hyperlink{md2cmds_8c_a6a34fb6876abbd580629d3708c805e7f}{md2cmds\_md\_status\_code}, \textcolor{stringliteral}{"
      7"});

  ncmds = \textcolor{keyword}{sizeof}(\hyperlink{md2cmds_8c_a2bb0a14593ac87833ec2151282098d64}{md2cmds\_cmd\_kvs})/\textcolor{keyword}{sizeof}(\hyperlink{md2cmds_8c_a2bb0a14593ac87833ec2151282098d64}{md2cmds\_cmd\_kvs}
      [0]);
  \textcolor{keywordflow}{if}( \hyperlink{pgpmac_8c_ae002f31c03cce9bf96cf0e0c2907cb2b}{pgpmac\_use\_pg}) \{
    ncmds += \textcolor{keyword}{sizeof}(\hyperlink{md2cmds_8c_a536297b42e6510e136b202957da7244f}{md2cmds\_cmd\_pg\_kvs})/\textcolor{keyword}{sizeof}(
      \hyperlink{md2cmds_8c_a536297b42e6510e136b202957da7244f}{md2cmds\_cmd\_pg\_kvs}[0]);
  \}

  hcreate\_r( 2 * ncmds, &\hyperlink{md2cmds_8c_a625a7f2c3447a5ed7b6a1f9b0827d0c1}{md2cmds\_hmap});

  \textcolor{keywordflow}{for}( i=0; i<\textcolor{keyword}{sizeof}(\hyperlink{md2cmds_8c_a2bb0a14593ac87833ec2151282098d64}{md2cmds\_cmd\_kvs})/\textcolor{keyword}{sizeof}(\hyperlink{md2cmds_8c_a2bb0a14593ac87833ec2151282098d64}{md2cmds\_cmd\_kvs}
      [0]); i++) \{
    hloader.key  = \hyperlink{md2cmds_8c_a2bb0a14593ac87833ec2151282098d64}{md2cmds\_cmd\_kvs}[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}].\hyperlink{structmd2cmds__cmd__kv__struct_a4cd5cce8339ed8cc9f0a5835a9bc5c69}{k};
    hloader.data = \hyperlink{md2cmds_8c_a2bb0a14593ac87833ec2151282098d64}{md2cmds\_cmd\_kvs}[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}].\hyperlink{structmd2cmds__cmd__kv__struct_ab12171e8ea4148dedcb13673e05ca92c}{v};
    err = hsearch\_r( hloader, ENTER, &hrtnval, &\hyperlink{md2cmds_8c_a625a7f2c3447a5ed7b6a1f9b0827d0c1}{md2cmds\_hmap});
    \textcolor{keywordflow}{if}( err == 0) \{
      \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"md2cmds\_init: hsearch\_r
       returned an error for item %d: %s"}, i, strerror( errno));
    \}
  \}

  \textcolor{keywordflow}{if}( \hyperlink{pgpmac_8c_ae002f31c03cce9bf96cf0e0c2907cb2b}{pgpmac\_use\_pg}) \{
    \textcolor{keywordflow}{for}( i=0; i<\textcolor{keyword}{sizeof}(\hyperlink{md2cmds_8c_a536297b42e6510e136b202957da7244f}{md2cmds\_cmd\_pg\_kvs})/\textcolor{keyword}{sizeof}(
      \hyperlink{md2cmds_8c_a536297b42e6510e136b202957da7244f}{md2cmds\_cmd\_pg\_kvs}[0]); i++) \{
      hloader.key  = \hyperlink{md2cmds_8c_a536297b42e6510e136b202957da7244f}{md2cmds\_cmd\_pg\_kvs}[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}].\hyperlink{structmd2cmds__cmd__kv__struct_a4cd5cce8339ed8cc9f0a5835a9bc5c69}{k};
      hloader.data = \hyperlink{md2cmds_8c_a536297b42e6510e136b202957da7244f}{md2cmds\_cmd\_pg\_kvs}[\hyperlink{namespacemk__pgpmac__redis_afa643a23a5984fe44c2182ada3dfa401}{i}].\hyperlink{structmd2cmds__cmd__kv__struct_ab12171e8ea4148dedcb13673e05ca92c}{v};
      err = hsearch\_r( hloader, ENTER, &hrtnval, &\hyperlink{md2cmds_8c_a625a7f2c3447a5ed7b6a1f9b0827d0c1}{md2cmds\_hmap});
      \textcolor{keywordflow}{if}( err == 0) \{
        \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"md2cmds\_init: hsearch\_r
       returned an error for item %d: %s"}, i, strerror( errno));
      \}
    \}
  \}
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_ae2ecf1ddb756452728eba479f36b486b}{\index{pgpmac.\-h@{pgpmac.\-h}!md2cmds\-\_\-push\-\_\-queue@{md2cmds\-\_\-push\-\_\-queue}}
\index{md2cmds\-\_\-push\-\_\-queue@{md2cmds\-\_\-push\-\_\-queue}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{md2cmds\-\_\-push\-\_\-queue}]{\setlength{\rightskip}{0pt plus 5cm}void md2cmds\-\_\-push\-\_\-queue (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{action}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_ae2ecf1ddb756452728eba479f36b486b}


Definition at line 79 of file md2cmds.\-c.


\begin{DoxyCode}
                                       \{

  \textcolor{keywordflow}{if}( pthread\_mutex\_trylock( &\hyperlink{md2cmds_8c_ad67304bb851dc6268b0cda2f40fc5aa8}{md2cmds\_mutex}) == 0) \{
    strncpy( \hyperlink{md2cmds_8c_a5f0fe1e2dfa92cf345b8c29134ab1ede}{md2cmds\_cmd}, action, \hyperlink{pgpmac_8h_a30f0f377b0f0695284145d420ea51846}{MD2CMDS\_CMD\_LENGTH}
      -1);
    \hyperlink{md2cmds_8c_a5f0fe1e2dfa92cf345b8c29134ab1ede}{md2cmds\_cmd}[\hyperlink{pgpmac_8h_a30f0f377b0f0695284145d420ea51846}{MD2CMDS\_CMD\_LENGTH}-1] = 0;
    pthread\_cond\_signal( &\hyperlink{md2cmds_8c_a08d5b18ec9478d753c46a3e28d1f2126}{md2cmds\_cond});
    pthread\_mutex\_unlock( &\hyperlink{md2cmds_8c_ad67304bb851dc6268b0cda2f40fc5aa8}{md2cmds\_mutex});
  \} \textcolor{keywordflow}{else} \{
    \hyperlink{lslogging_8c_a0e756b36671055ef02a8f04d2ba8a93b}{lslogging\_log\_message}( \textcolor{stringliteral}{"md2cmds\_push\_queue: MD2
       command '%s' ignored.  Already running '%s'"}, action, \hyperlink{md2cmds_8c_a5f0fe1e2dfa92cf345b8c29134ab1ede}{md2cmds\_cmd});
  \}
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_abc5270ece18fe48a49947378438049cf}{\index{pgpmac.\-h@{pgpmac.\-h}!md2cmds\-\_\-run@{md2cmds\-\_\-run}}
\index{md2cmds\-\_\-run@{md2cmds\-\_\-run}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{md2cmds\-\_\-run}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-t$\ast$ md2cmds\-\_\-run (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_abc5270ece18fe48a49947378438049cf}


Start up the thread. 



Definition at line 2051 of file md2cmds.\-c.


\begin{DoxyCode}
                         \{
  pthread\_create( &\hyperlink{md2cmds_8c_aa230921945149692de98fff15c01962f}{md2cmds\_thread}, NULL,                
      \hyperlink{md2cmds_8c_ae967e769d23555a631f615e630f25b00}{md2cmds\_worker}, NULL);
  \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^omega crossed zero$"},        
      \hyperlink{md2cmds_8c_aa43887b7c9799bc88d51df13745d0e5c}{md2cmds\_rotate\_cb});
  \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^omega In Position$"},         
      \hyperlink{md2cmds_8c_a136f278c9f5a2742b2e9b4987b063faa}{md2cmds\_maybe\_rotate\_done\_cb});
  \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{".+ (Moving|In Position)$"},    
      \hyperlink{md2cmds_8c_a3970ef1a233dabcc5c1408e9d3865f13}{md2cmds\_maybe\_done\_moving\_cb});
  \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"(.+) (Homing|Homed)$"},        
      \hyperlink{md2cmds_8c_ad0618ee44e2e800c445d7d8726ec8ec2}{md2cmds\_maybe\_done\_homing\_cb});
  \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^capz (Moving|In Position)$"}, 
      \hyperlink{md2cmds_8c_aab9e2aa02903648acc342068f0664a96}{md2cmds\_time\_capz\_cb});
  \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^Coordsys 1 Stopped$"},        
      \hyperlink{md2cmds_8c_a4cf5215fdb88407144f582d829c03c7b}{md2cmds\_coordsys\_1\_stopped\_cb});
  \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^Coordsys 2 Stopped$"},        
      \hyperlink{md2cmds_8c_a1ab8f6d08c82ee2130202d65d44ef3fe}{md2cmds\_coordsys\_2\_stopped\_cb});
  \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^Coordsys 3 Stopped$"},        
      \hyperlink{md2cmds_8c_a3640785c2fc9cd2f27ce0bafd7959179}{md2cmds\_coordsys\_3\_stopped\_cb});
  \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^Coordsys 4 Stopped$"},        
      \hyperlink{md2cmds_8c_a6069cb2f6e9f662edd54e1aeb6e78370}{md2cmds\_coordsys\_4\_stopped\_cb});
  \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^Coordsys 5 Stopped$"},        
      \hyperlink{md2cmds_8c_a846ed10de4e5ad48cfa429a93c853308}{md2cmds\_coordsys\_5\_stopped\_cb});
  \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^Coordsys 7 Stopped$"},        
      \hyperlink{md2cmds_8c_ab172a83eaf3e74799159e6720e4f5268}{md2cmds\_coordsys\_7\_stopped\_cb});
  \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^cam.zoom Moving$"},             
       \hyperlink{md2cmds_8c_a4eb608d012f8a471671e10fb19b366d6}{md2cmds\_set\_scale\_cb});
  \hyperlink{lsevents_8c_a1efedb183d9558ae0f3573712e7918b2}{lsevents\_add\_listener}( \textcolor{stringliteral}{"^(align\(\backslash\)\(\backslash\)
      .(x|y|z)|centering.(x|y)) In Position$"}, \hyperlink{md2cmds_8c_ad6a28dfbe2ca3180364be779a461ae1d}{md2cmds\_ca\_last\_cb});


  \textcolor{keywordflow}{return} &\hyperlink{md2cmds_8c_aa230921945149692de98fff15c01962f}{md2cmds\_thread};
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a7762ca7b97b44b979e23ce88ca3b4249}{\index{pgpmac.\-h@{pgpmac.\-h}!pgpmac\-\_\-printf@{pgpmac\-\_\-printf}}
\index{pgpmac\-\_\-printf@{pgpmac\-\_\-printf}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{pgpmac\-\_\-printf}]{\setlength{\rightskip}{0pt plus 5cm}void pgpmac\-\_\-printf (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{fmt, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a7762ca7b97b44b979e23ce88ca3b4249}


Terminal output routine ala printf. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em fmt} & Printf style formating string \\
\hline
\end{DoxyParams}


Definition at line 477 of file pgpmac.\-c.


\begin{DoxyCode}
                     \{
  va\_list arg\_ptr;

  pthread\_mutex\_lock( &\hyperlink{pgpmac_8c_ad128c64890c7c0d4f836d9ec6e99216a}{ncurses\_mutex});

  va\_start( arg\_ptr, fmt);
  vwprintw( \hyperlink{pgpmac_8c_a65daf0f4a5bc6def23a9df98ff5ca57e}{term\_output}, fmt, arg\_ptr);
  va\_end( arg\_ptr);

  wnoutrefresh( \hyperlink{pgpmac_8c_a65daf0f4a5bc6def23a9df98ff5ca57e}{term\_output});
  doupdate();
  pthread\_mutex\_unlock( &\hyperlink{pgpmac_8c_ad128c64890c7c0d4f836d9ec6e99216a}{ncurses\_mutex});

\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a6168e3ced6ec5fc80862d27002e4cd5b}{\index{pgpmac.\-h@{pgpmac.\-h}!pgpmac\-\_\-request\-\_\-stay\-\_\-of\-\_\-execution@{pgpmac\-\_\-request\-\_\-stay\-\_\-of\-\_\-execution}}
\index{pgpmac\-\_\-request\-\_\-stay\-\_\-of\-\_\-execution@{pgpmac\-\_\-request\-\_\-stay\-\_\-of\-\_\-execution}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{pgpmac\-\_\-request\-\_\-stay\-\_\-of\-\_\-execution}]{\setlength{\rightskip}{0pt plus 5cm}void pgpmac\-\_\-request\-\_\-stay\-\_\-of\-\_\-execution (
\begin{DoxyParamCaption}
\item[{int}]{secs}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a6168e3ced6ec5fc80862d27002e4cd5b}


Postpone the day of reckoning This assumes the quit\-\_\-cb routine is called once a second. 



Definition at line 498 of file pgpmac.\-c.


\begin{DoxyCode}
                                                 \{
  pthread\_mutex\_lock( &\hyperlink{pgpmac_8c_a75c9d50c347e9021784ee2529a0a1a70}{doomsday\_mutex});
  \textcolor{keywordflow}{if}( secs > \hyperlink{pgpmac_8c_aa687f0df65c1d87ffd5635742c1eab94}{doomsday\_count})
    \hyperlink{pgpmac_8c_aa687f0df65c1d87ffd5635742c1eab94}{doomsday\_count} = secs;
  pthread\_mutex\_unlock( &\hyperlink{pgpmac_8c_a75c9d50c347e9021784ee2529a0a1a70}{doomsday\_mutex});
\}
\end{DoxyCode}
\hypertarget{pgpmac_8h_a76b11c62b122ee0fd8399435d4260681}{\index{pgpmac.\-h@{pgpmac.\-h}!Pmac\-Sock\-Sendline@{Pmac\-Sock\-Sendline}}
\index{Pmac\-Sock\-Sendline@{Pmac\-Sock\-Sendline}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{Pmac\-Sock\-Sendline}]{\setlength{\rightskip}{0pt plus 5cm}void Pmac\-Sock\-Sendline (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{s}
\end{DoxyParamCaption}
)}}\label{pgpmac_8h_a76b11c62b122ee0fd8399435d4260681}


\subsection{Variable Documentation}
\hypertarget{pgpmac_8h_a6cb218bdccfe5a93471c161f15a15cab}{\index{pgpmac.\-h@{pgpmac.\-h}!alignx@{alignx}}
\index{alignx@{alignx}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{alignx}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ alignx}}\label{pgpmac_8h_a6cb218bdccfe5a93471c161f15a15cab}


Alignment stage X. 



Definition at line 101 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a737c246c3948e644a18d191a931e1acd}{\index{pgpmac.\-h@{pgpmac.\-h}!aligny@{aligny}}
\index{aligny@{aligny}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{aligny}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ aligny}}\label{pgpmac_8h_a737c246c3948e644a18d191a931e1acd}


Alignment stage Y. 



Definition at line 102 of file lspmac.\-c.

\hypertarget{pgpmac_8h_ae7642b1da0f7c7f8448104c691d40a12}{\index{pgpmac.\-h@{pgpmac.\-h}!alignz@{alignz}}
\index{alignz@{alignz}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{alignz}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ alignz}}\label{pgpmac_8h_ae7642b1da0f7c7f8448104c691d40a12}


Alignment stage X. 



Definition at line 103 of file lspmac.\-c.

\hypertarget{pgpmac_8h_aa90d2363b744acbd4d45133b7a716d8f}{\index{pgpmac.\-h@{pgpmac.\-h}!anal@{anal}}
\index{anal@{anal}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{anal}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ anal}}\label{pgpmac_8h_aa90d2363b744acbd4d45133b7a716d8f}


Polaroid analyzer motor. 



Definition at line 104 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a139200ddaa9856a7ffcec0e6cbaa8f1b}{\index{pgpmac.\-h@{pgpmac.\-h}!apery@{apery}}
\index{apery@{apery}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{apery}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ apery}}\label{pgpmac_8h_a139200ddaa9856a7ffcec0e6cbaa8f1b}


Aperture Y. 



Definition at line 106 of file lspmac.\-c.

\hypertarget{pgpmac_8h_ab93bd6ee850b285ca3a95e64d15e9477}{\index{pgpmac.\-h@{pgpmac.\-h}!aperz@{aperz}}
\index{aperz@{aperz}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{aperz}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ aperz}}\label{pgpmac_8h_ab93bd6ee850b285ca3a95e64d15e9477}


Aperture Z. 



Definition at line 107 of file lspmac.\-c.

\hypertarget{pgpmac_8h_afaff4fbb5f03b0d2469fc7a14f174d69}{\index{pgpmac.\-h@{pgpmac.\-h}!arm\-\_\-parked@{arm\-\_\-parked}}
\index{arm\-\_\-parked@{arm\-\_\-parked}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{arm\-\_\-parked}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-bi\-\_\-t}$\ast$ arm\-\_\-parked}}\label{pgpmac_8h_afaff4fbb5f03b0d2469fc7a14f174d69}


(whose arm? parked where?) 



Definition at line 144 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a85d6eaa4b4a82bb3112574f458d1dc50}{\index{pgpmac.\-h@{pgpmac.\-h}!blight@{blight}}
\index{blight@{blight}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{blight}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ blight}}\label{pgpmac_8h_a85d6eaa4b4a82bb3112574f458d1dc50}


Back Light D\-A\-C. 



Definition at line 118 of file lspmac.\-c.

\hypertarget{pgpmac_8h_ac0d0bc95bcbcbd154b30c72a9645c8b2}{\index{pgpmac.\-h@{pgpmac.\-h}!blight\-\_\-down@{blight\-\_\-down}}
\index{blight\-\_\-down@{blight\-\_\-down}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{blight\-\_\-down}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-bi\-\_\-t}$\ast$ blight\-\_\-down}}\label{pgpmac_8h_ac0d0bc95bcbcbd154b30c72a9645c8b2}


Backlight is down. 



Definition at line 134 of file lspmac.\-c.

\hypertarget{pgpmac_8h_af55c51d52c4586b647114f95d7ac1f42}{\index{pgpmac.\-h@{pgpmac.\-h}!blight\-\_\-f@{blight\-\_\-f}}
\index{blight\-\_\-f@{blight\-\_\-f}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{blight\-\_\-f}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ blight\-\_\-f}}\label{pgpmac_8h_af55c51d52c4586b647114f95d7ac1f42}


Back light scale factor. 



Definition at line 127 of file lspmac.\-c.

\hypertarget{pgpmac_8h_af813a2eff0b7efa4c70633559054e84c}{\index{pgpmac.\-h@{pgpmac.\-h}!blight\-\_\-ud@{blight\-\_\-ud}}
\index{blight\-\_\-ud@{blight\-\_\-ud}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{blight\-\_\-ud}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ blight\-\_\-ud}}\label{pgpmac_8h_af813a2eff0b7efa4c70633559054e84c}


Back light Up/\-Down actuator. 



Definition at line 122 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a7fba65f6555c5c7908852c6cf1ad0c94}{\index{pgpmac.\-h@{pgpmac.\-h}!blight\-\_\-up@{blight\-\_\-up}}
\index{blight\-\_\-up@{blight\-\_\-up}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{blight\-\_\-up}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-bi\-\_\-t}$\ast$ blight\-\_\-up}}\label{pgpmac_8h_a7fba65f6555c5c7908852c6cf1ad0c94}


Backlight is up. 



Definition at line 135 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a51358daaea8b5236f08414877d8af6c2}{\index{pgpmac.\-h@{pgpmac.\-h}!capy@{capy}}
\index{capy@{capy}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{capy}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ capy}}\label{pgpmac_8h_a51358daaea8b5236f08414877d8af6c2}


Capillary Y. 



Definition at line 108 of file lspmac.\-c.

\hypertarget{pgpmac_8h_aa45f268d0af9f3d465acfab128919718}{\index{pgpmac.\-h@{pgpmac.\-h}!capz@{capz}}
\index{capz@{capz}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{capz}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ capz}}\label{pgpmac_8h_aa45f268d0af9f3d465acfab128919718}


Capillary Z. 



Definition at line 109 of file lspmac.\-c.

\hypertarget{pgpmac_8h_ac940d950d9efeaf3f0ae67e9bf331188}{\index{pgpmac.\-h@{pgpmac.\-h}!cenx@{cenx}}
\index{cenx@{cenx}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{cenx}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ cenx}}\label{pgpmac_8h_ac940d950d9efeaf3f0ae67e9bf331188}


Centering Table X. 



Definition at line 111 of file lspmac.\-c.

\hypertarget{pgpmac_8h_aaed18e738ba7bfb6c771a44f5d7ea827}{\index{pgpmac.\-h@{pgpmac.\-h}!ceny@{ceny}}
\index{ceny@{ceny}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{ceny}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ ceny}}\label{pgpmac_8h_aaed18e738ba7bfb6c771a44f5d7ea827}


Centering Table Y. 



Definition at line 112 of file lspmac.\-c.

\hypertarget{pgpmac_8h_ae78d9a757d4c85419fff9c94b15e25d7}{\index{pgpmac.\-h@{pgpmac.\-h}!cryo@{cryo}}
\index{cryo@{cryo}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{cryo}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ cryo}}\label{pgpmac_8h_ae78d9a757d4c85419fff9c94b15e25d7}


Move the cryostream towards or away from the crystal. 



Definition at line 123 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a871d4cdea0a1a8db85b8658a07655212}{\index{pgpmac.\-h@{pgpmac.\-h}!cryo\-\_\-back@{cryo\-\_\-back}}
\index{cryo\-\_\-back@{cryo\-\_\-back}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{cryo\-\_\-back}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-bi\-\_\-t}$\ast$ cryo\-\_\-back}}\label{pgpmac_8h_a871d4cdea0a1a8db85b8658a07655212}


cryo is in the back position 



Definition at line 136 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a28df32fd6be9160603aa1bb74a823574}{\index{pgpmac.\-h@{pgpmac.\-h}!cryo\-\_\-switch@{cryo\-\_\-switch}}
\index{cryo\-\_\-switch@{cryo\-\_\-switch}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{cryo\-\_\-switch}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-bi\-\_\-t}$\ast$ cryo\-\_\-switch}}\label{pgpmac_8h_a28df32fd6be9160603aa1bb74a823574}


that little toggle switch for the cryo 



Definition at line 133 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a9d9c5030d817483ca9518027c91adac4}{\index{pgpmac.\-h@{pgpmac.\-h}!dryer@{dryer}}
\index{dryer@{dryer}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{dryer}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ dryer}}\label{pgpmac_8h_a9d9c5030d817483ca9518027c91adac4}


blow air on the scintilator to dry it off 



Definition at line 124 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a1e690d4ad981d020ea2c850282dca3be}{\index{pgpmac.\-h@{pgpmac.\-h}!etel\-\_\-init\-\_\-ok@{etel\-\_\-init\-\_\-ok}}
\index{etel\-\_\-init\-\_\-ok@{etel\-\_\-init\-\_\-ok}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{etel\-\_\-init\-\_\-ok}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-bi\-\_\-t}$\ast$ etel\-\_\-init\-\_\-ok}}\label{pgpmac_8h_a1e690d4ad981d020ea2c850282dca3be}


E\-T\-E\-L initialized O\-K. 



Definition at line 141 of file lspmac.\-c.

\hypertarget{pgpmac_8h_ab48d4a2cf0225796db9aad49f034dc59}{\index{pgpmac.\-h@{pgpmac.\-h}!etel\-\_\-on@{etel\-\_\-on}}
\index{etel\-\_\-on@{etel\-\_\-on}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{etel\-\_\-on}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-bi\-\_\-t}$\ast$ etel\-\_\-on}}\label{pgpmac_8h_ab48d4a2cf0225796db9aad49f034dc59}


E\-T\-E\-L is on. 



Definition at line 140 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a5538a6aa526eeed65ff237303da2d348}{\index{pgpmac.\-h@{pgpmac.\-h}!etel\-\_\-ready@{etel\-\_\-ready}}
\index{etel\-\_\-ready@{etel\-\_\-ready}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{etel\-\_\-ready}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-bi\-\_\-t}$\ast$ etel\-\_\-ready}}\label{pgpmac_8h_a5538a6aa526eeed65ff237303da2d348}


E\-T\-E\-L is ready. 



Definition at line 139 of file lspmac.\-c.

\hypertarget{pgpmac_8h_aeb09895663eff333b7a75acb319a9fc1}{\index{pgpmac.\-h@{pgpmac.\-h}!flight@{flight}}
\index{flight@{flight}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{flight}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ flight}}\label{pgpmac_8h_aeb09895663eff333b7a75acb319a9fc1}


Front Light D\-A\-C. 



Definition at line 117 of file lspmac.\-c.

\hypertarget{pgpmac_8h_aabf4ec595b5183c1777d029ca56134b0}{\index{pgpmac.\-h@{pgpmac.\-h}!flight\-\_\-f@{flight\-\_\-f}}
\index{flight\-\_\-f@{flight\-\_\-f}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{flight\-\_\-f}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ flight\-\_\-f}}\label{pgpmac_8h_aabf4ec595b5183c1777d029ca56134b0}


Front light scale factor. 



Definition at line 128 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a6630442dc65ce8a30a24ed718b301971}{\index{pgpmac.\-h@{pgpmac.\-h}!flight\-\_\-oo@{flight\-\_\-oo}}
\index{flight\-\_\-oo@{flight\-\_\-oo}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{flight\-\_\-oo}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ flight\-\_\-oo}}\label{pgpmac_8h_a6630442dc65ce8a30a24ed718b301971}


Turn front light on/off. 



Definition at line 126 of file lspmac.\-c.

\hypertarget{pgpmac_8h_addb26c80065506faa1de3c1b468fe03f}{\index{pgpmac.\-h@{pgpmac.\-h}!fluo@{fluo}}
\index{fluo@{fluo}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{fluo}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ fluo}}\label{pgpmac_8h_addb26c80065506faa1de3c1b468fe03f}


Move the fluorescence detector in/out. 



Definition at line 125 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a67092de6f3fcc0b245e4970437eaff6b}{\index{pgpmac.\-h@{pgpmac.\-h}!fluor\-\_\-back@{fluor\-\_\-back}}
\index{fluor\-\_\-back@{fluor\-\_\-back}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{fluor\-\_\-back}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-bi\-\_\-t}$\ast$ fluor\-\_\-back}}\label{pgpmac_8h_a67092de6f3fcc0b245e4970437eaff6b}


fluor is in the back position 



Definition at line 137 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a8a3ca6fcf5e24dcc26170736843e53b2}{\index{pgpmac.\-h@{pgpmac.\-h}!fscint@{fscint}}
\index{fscint@{fscint}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{fscint}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ fscint}}\label{pgpmac_8h_a8a3ca6fcf5e24dcc26170736843e53b2}


Scintillator Piezo D\-A\-C. 



Definition at line 119 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a26dec4623af9beed912b8e7e6f99822c}{\index{pgpmac.\-h@{pgpmac.\-h}!fshut@{fshut}}
\index{fshut@{fshut}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{fshut}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ fshut}}\label{pgpmac_8h_a26dec4623af9beed912b8e7e6f99822c}


Fast shutter. 



Definition at line 116 of file lspmac.\-c.

\hypertarget{pgpmac_8h_abb29b117ad38156ba16fcf44eeb427af}{\index{pgpmac.\-h@{pgpmac.\-h}!hp\-\_\-air@{hp\-\_\-air}}
\index{hp\-\_\-air@{hp\-\_\-air}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{hp\-\_\-air}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-bi\-\_\-t}$\ast$ hp\-\_\-air}}\label{pgpmac_8h_abb29b117ad38156ba16fcf44eeb427af}


High pressure air O\-K. 



Definition at line 132 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a0be79ccb7ebf3a665248fd856112b9fd}{\index{pgpmac.\-h@{pgpmac.\-h}!kappa@{kappa}}
\index{kappa@{kappa}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{kappa}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ kappa}}\label{pgpmac_8h_a0be79ccb7ebf3a665248fd856112b9fd}


Kappa. 



Definition at line 113 of file lspmac.\-c.

\hypertarget{pgpmac_8h_aade15098d213bb25522048e4a231941a}{\index{pgpmac.\-h@{pgpmac.\-h}!lp\-\_\-air@{lp\-\_\-air}}
\index{lp\-\_\-air@{lp\-\_\-air}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lp\-\_\-air}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-bi\-\_\-t}$\ast$ lp\-\_\-air}}\label{pgpmac_8h_aade15098d213bb25522048e4a231941a}


Low pressure air O\-K. 



Definition at line 131 of file lspmac.\-c.

\hypertarget{pgpmac_8h_adf89a0299edd6a99992b95dff8992eba}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-demandairrights@{lspg\-\_\-demandairrights}}
\index{lspg\-\_\-demandairrights@{lspg\-\_\-demandairrights}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-demandairrights}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspg\-\_\-demandairrights\-\_\-t} lspg\-\_\-demandairrights}}\label{pgpmac_8h_adf89a0299edd6a99992b95dff8992eba}


our demandairrights object 



Definition at line 68 of file lspg.\-c.

\hypertarget{pgpmac_8h_a7ef8a09203117578c9b2ce4719519f36}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-getcenter@{lspg\-\_\-getcenter}}
\index{lspg\-\_\-getcenter@{lspg\-\_\-getcenter}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-getcenter}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspg\-\_\-getcenter\-\_\-t} lspg\-\_\-getcenter}}\label{pgpmac_8h_a7ef8a09203117578c9b2ce4719519f36}


the getcenter object 



Definition at line 67 of file lspg.\-c.

\hypertarget{pgpmac_8h_a5c50804e6019d47d91f3f1cb3ebd1f00}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-getcurrentsampleid@{lspg\-\_\-getcurrentsampleid}}
\index{lspg\-\_\-getcurrentsampleid@{lspg\-\_\-getcurrentsampleid}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-getcurrentsampleid}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspg\-\_\-getcurrentsampleid\-\_\-t} lspg\-\_\-getcurrentsampleid}}\label{pgpmac_8h_a5c50804e6019d47d91f3f1cb3ebd1f00}


our currentsample id 



Definition at line 69 of file lspg.\-c.

\hypertarget{pgpmac_8h_adbf70f382e469e02dce77833981f9547}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-nextsample@{lspg\-\_\-nextsample}}
\index{lspg\-\_\-nextsample@{lspg\-\_\-nextsample}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-nextsample}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspg\-\_\-nextsample\-\_\-t} lspg\-\_\-nextsample}}\label{pgpmac_8h_adbf70f382e469e02dce77833981f9547}


the very next sample 



Definition at line 65 of file lspg.\-c.

\hypertarget{pgpmac_8h_ad8d8e2f578ca79189a80c1fd5b60cefd}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-nextshot@{lspg\-\_\-nextshot}}
\index{lspg\-\_\-nextshot@{lspg\-\_\-nextshot}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-nextshot}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspg\-\_\-nextshot\-\_\-t} lspg\-\_\-nextshot}}\label{pgpmac_8h_ad8d8e2f578ca79189a80c1fd5b60cefd}


the nextshot object 



Definition at line 66 of file lspg.\-c.

\hypertarget{pgpmac_8h_af18499d17171eff473cfc49d4a0a5562}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-starttransfer@{lspg\-\_\-starttransfer}}
\index{lspg\-\_\-starttransfer@{lspg\-\_\-starttransfer}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-starttransfer}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspg\-\_\-starttransfer\-\_\-t} lspg\-\_\-starttransfer}}\label{pgpmac_8h_af18499d17171eff473cfc49d4a0a5562}


start a sample transfer 



Definition at line 70 of file lspg.\-c.

\hypertarget{pgpmac_8h_a5f699604dcc5d3d64fd6cb5c363d29c9}{\index{pgpmac.\-h@{pgpmac.\-h}!lspg\-\_\-waitcryo@{lspg\-\_\-waitcryo}}
\index{lspg\-\_\-waitcryo@{lspg\-\_\-waitcryo}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspg\-\_\-waitcryo}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspg\-\_\-waitcryo\-\_\-t} lspg\-\_\-waitcryo}}\label{pgpmac_8h_a5f699604dcc5d3d64fd6cb5c363d29c9}


signal the robot 



Definition at line 71 of file lspg.\-c.

\hypertarget{pgpmac_8h_aebfce5f9cbc8ba7bd4e2ee4880f303e8}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-motors@{lspmac\-\_\-motors}}
\index{lspmac\-\_\-motors@{lspmac\-\_\-motors}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-motors}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t} lspmac\-\_\-motors\mbox{[}$\,$\mbox{]}}}\label{pgpmac_8h_aebfce5f9cbc8ba7bd4e2ee4880f303e8}


All our motors. 



Definition at line 96 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a57547d211906c981ef20257eba99f8df}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-moving\-\_\-cond@{lspmac\-\_\-moving\-\_\-cond}}
\index{lspmac\-\_\-moving\-\_\-cond@{lspmac\-\_\-moving\-\_\-cond}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-moving\-\_\-cond}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-cond\-\_\-t lspmac\-\_\-moving\-\_\-cond}}\label{pgpmac_8h_a57547d211906c981ef20257eba99f8df}


Wait for motor(s) to finish moving condition. 



Definition at line 70 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a7a32c617c183166308241e270959df56}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-moving\-\_\-flags@{lspmac\-\_\-moving\-\_\-flags}}
\index{lspmac\-\_\-moving\-\_\-flags@{lspmac\-\_\-moving\-\_\-flags}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-moving\-\_\-flags}]{\setlength{\rightskip}{0pt plus 5cm}int lspmac\-\_\-moving\-\_\-flags}}\label{pgpmac_8h_a7a32c617c183166308241e270959df56}


Flag used to implement motor moving condition. 



Definition at line 71 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a85679cac947e199c88794f8e5a12bf5f}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-moving\-\_\-mutex@{lspmac\-\_\-moving\-\_\-mutex}}
\index{lspmac\-\_\-moving\-\_\-mutex@{lspmac\-\_\-moving\-\_\-mutex}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-moving\-\_\-mutex}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-mutex\-\_\-t lspmac\-\_\-moving\-\_\-mutex}}\label{pgpmac_8h_a85679cac947e199c88794f8e5a12bf5f}


Coordinate moving motors between threads. 



Definition at line 69 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a56260f012c50a591ee7f97e500f16994}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-nmotors@{lspmac\-\_\-nmotors}}
\index{lspmac\-\_\-nmotors@{lspmac\-\_\-nmotors}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-nmotors}]{\setlength{\rightskip}{0pt plus 5cm}int lspmac\-\_\-nmotors}}\label{pgpmac_8h_a56260f012c50a591ee7f97e500f16994}


The number of motors we manage. 



Definition at line 97 of file lspmac.\-c.

\hypertarget{pgpmac_8h_afbd51c2cefcee87afe994c9e9f372241}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-shutter\-\_\-cond@{lspmac\-\_\-shutter\-\_\-cond}}
\index{lspmac\-\_\-shutter\-\_\-cond@{lspmac\-\_\-shutter\-\_\-cond}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-shutter\-\_\-cond}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-cond\-\_\-t lspmac\-\_\-shutter\-\_\-cond}}\label{pgpmac_8h_afbd51c2cefcee87afe994c9e9f372241}


Allows waiting for the shutter status to change. 



Definition at line 68 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a396fbf06208de3ecbe1b0df549f1cd46}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-shutter\-\_\-has\-\_\-opened@{lspmac\-\_\-shutter\-\_\-has\-\_\-opened}}
\index{lspmac\-\_\-shutter\-\_\-has\-\_\-opened@{lspmac\-\_\-shutter\-\_\-has\-\_\-opened}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-shutter\-\_\-has\-\_\-opened}]{\setlength{\rightskip}{0pt plus 5cm}int lspmac\-\_\-shutter\-\_\-has\-\_\-opened}}\label{pgpmac_8h_a396fbf06208de3ecbe1b0df549f1cd46}


Indicates that the shutter had opened, perhaps briefly even if the state did not change. 



Definition at line 66 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a1b78a13c654409333569815e1c109d38}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-shutter\-\_\-mutex@{lspmac\-\_\-shutter\-\_\-mutex}}
\index{lspmac\-\_\-shutter\-\_\-mutex@{lspmac\-\_\-shutter\-\_\-mutex}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-shutter\-\_\-mutex}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-mutex\-\_\-t lspmac\-\_\-shutter\-\_\-mutex}}\label{pgpmac_8h_a1b78a13c654409333569815e1c109d38}


Coordinates threads reading shutter status. 



Definition at line 67 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a112158e0cd50449a440ac55c7af7bea2}{\index{pgpmac.\-h@{pgpmac.\-h}!lspmac\-\_\-shutter\-\_\-state@{lspmac\-\_\-shutter\-\_\-state}}
\index{lspmac\-\_\-shutter\-\_\-state@{lspmac\-\_\-shutter\-\_\-state}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lspmac\-\_\-shutter\-\_\-state}]{\setlength{\rightskip}{0pt plus 5cm}int lspmac\-\_\-shutter\-\_\-state}}\label{pgpmac_8h_a112158e0cd50449a440ac55c7af7bea2}


State of the shutter, used to detect changes. 



Definition at line 65 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a2f63408d16b5603541b124a78f36a5a8}{\index{pgpmac.\-h@{pgpmac.\-h}!lsredis\-\_\-cond@{lsredis\-\_\-cond}}
\index{lsredis\-\_\-cond@{lsredis\-\_\-cond}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsredis\-\_\-cond}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-cond\-\_\-t lsredis\-\_\-cond}}\label{pgpmac_8h_a2f63408d16b5603541b124a78f36a5a8}


Definition at line 75 of file lsredis.\-c.

\hypertarget{pgpmac_8h_a390e8acf789b0fa41b43a794dd27e28f}{\index{pgpmac.\-h@{pgpmac.\-h}!lsredis\-\_\-mutex@{lsredis\-\_\-mutex}}
\index{lsredis\-\_\-mutex@{lsredis\-\_\-mutex}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsredis\-\_\-mutex}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-mutex\-\_\-t lsredis\-\_\-mutex}}\label{pgpmac_8h_a390e8acf789b0fa41b43a794dd27e28f}


Definition at line 74 of file lsredis.\-c.

\hypertarget{pgpmac_8h_a7461eb2b5974a2ffac2189007d39193c}{\index{pgpmac.\-h@{pgpmac.\-h}!lsredis\-\_\-running@{lsredis\-\_\-running}}
\index{lsredis\-\_\-running@{lsredis\-\_\-running}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{lsredis\-\_\-running}]{\setlength{\rightskip}{0pt plus 5cm}int lsredis\-\_\-running}}\label{pgpmac_8h_a7461eb2b5974a2ffac2189007d39193c}


Definition at line 76 of file lsredis.\-c.

\hypertarget{pgpmac_8h_a7a3e763682bd7f987d07f149e94b3bf8}{\index{pgpmac.\-h@{pgpmac.\-h}!md2\-\_\-status\-\_\-mutex@{md2\-\_\-status\-\_\-mutex}}
\index{md2\-\_\-status\-\_\-mutex@{md2\-\_\-status\-\_\-mutex}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{md2\-\_\-status\-\_\-mutex}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-mutex\-\_\-t md2\-\_\-status\-\_\-mutex}}\label{pgpmac_8h_a7a3e763682bd7f987d07f149e94b3bf8}


Synchronize reading/writting status buffer. 



Definition at line 352 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a1ccf455563dc8d828558b6a230e164a6}{\index{pgpmac.\-h@{pgpmac.\-h}!md2cmds\-\_\-cmd@{md2cmds\-\_\-cmd}}
\index{md2cmds\-\_\-cmd@{md2cmds\-\_\-cmd}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{md2cmds\-\_\-cmd}]{\setlength{\rightskip}{0pt plus 5cm}char md2cmds\-\_\-cmd\mbox{[}$\,$\mbox{]}}}\label{pgpmac_8h_a1ccf455563dc8d828558b6a230e164a6}


our command; 



Definition at line 24 of file md2cmds.\-c.

\hypertarget{pgpmac_8h_a08d5b18ec9478d753c46a3e28d1f2126}{\index{pgpmac.\-h@{pgpmac.\-h}!md2cmds\-\_\-cond@{md2cmds\-\_\-cond}}
\index{md2cmds\-\_\-cond@{md2cmds\-\_\-cond}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{md2cmds\-\_\-cond}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-cond\-\_\-t md2cmds\-\_\-cond}}\label{pgpmac_8h_a08d5b18ec9478d753c46a3e28d1f2126}


condition to signal when it's time to run an md2 command 



Definition at line 10 of file md2cmds.\-c.

\hypertarget{pgpmac_8h_a6a34fb6876abbd580629d3708c805e7f}{\index{pgpmac.\-h@{pgpmac.\-h}!md2cmds\-\_\-md\-\_\-status\-\_\-code@{md2cmds\-\_\-md\-\_\-status\-\_\-code}}
\index{md2cmds\-\_\-md\-\_\-status\-\_\-code@{md2cmds\-\_\-md\-\_\-status\-\_\-code}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{md2cmds\-\_\-md\-\_\-status\-\_\-code}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lsredis\-\_\-obj\-\_\-t}$\ast$ md2cmds\-\_\-md\-\_\-status\-\_\-code}}\label{pgpmac_8h_a6a34fb6876abbd580629d3708c805e7f}


Definition at line 26 of file md2cmds.\-c.

\hypertarget{pgpmac_8h_ad67304bb851dc6268b0cda2f40fc5aa8}{\index{pgpmac.\-h@{pgpmac.\-h}!md2cmds\-\_\-mutex@{md2cmds\-\_\-mutex}}
\index{md2cmds\-\_\-mutex@{md2cmds\-\_\-mutex}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{md2cmds\-\_\-mutex}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-mutex\-\_\-t md2cmds\-\_\-mutex}}\label{pgpmac_8h_ad67304bb851dc6268b0cda2f40fc5aa8}


mutex for the condition 



Definition at line 11 of file md2cmds.\-c.

\hypertarget{pgpmac_8h_ab517a930528e2b7d0993e11087765b03}{\index{pgpmac.\-h@{pgpmac.\-h}!md2cmds\-\_\-pg\-\_\-cond@{md2cmds\-\_\-pg\-\_\-cond}}
\index{md2cmds\-\_\-pg\-\_\-cond@{md2cmds\-\_\-pg\-\_\-cond}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{md2cmds\-\_\-pg\-\_\-cond}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-cond\-\_\-t md2cmds\-\_\-pg\-\_\-cond}}\label{pgpmac_8h_ab517a930528e2b7d0993e11087765b03}
\hypertarget{pgpmac_8h_a4d2c3ac81d4b13eb21f4ddcdda8c7308}{\index{pgpmac.\-h@{pgpmac.\-h}!md2cmds\-\_\-pg\-\_\-mutex@{md2cmds\-\_\-pg\-\_\-mutex}}
\index{md2cmds\-\_\-pg\-\_\-mutex@{md2cmds\-\_\-pg\-\_\-mutex}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{md2cmds\-\_\-pg\-\_\-mutex}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-mutex\-\_\-t md2cmds\-\_\-pg\-\_\-mutex}}\label{pgpmac_8h_a4d2c3ac81d4b13eb21f4ddcdda8c7308}
\hypertarget{pgpmac_8h_ab552f2e28dd9cccefafe01f27717101b}{\index{pgpmac.\-h@{pgpmac.\-h}!minikappa\-\_\-ok@{minikappa\-\_\-ok}}
\index{minikappa\-\_\-ok@{minikappa\-\_\-ok}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{minikappa\-\_\-ok}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-bi\-\_\-t}$\ast$ minikappa\-\_\-ok}}\label{pgpmac_8h_ab552f2e28dd9cccefafe01f27717101b}


Minikappa is O\-K (whatever that means) 



Definition at line 142 of file lspmac.\-c.

\hypertarget{pgpmac_8h_ad128c64890c7c0d4f836d9ec6e99216a}{\index{pgpmac.\-h@{pgpmac.\-h}!ncurses\-\_\-mutex@{ncurses\-\_\-mutex}}
\index{ncurses\-\_\-mutex@{ncurses\-\_\-mutex}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{ncurses\-\_\-mutex}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-mutex\-\_\-t ncurses\-\_\-mutex}}\label{pgpmac_8h_ad128c64890c7c0d4f836d9ec6e99216a}


allow more than one thread access to the screen 



Definition at line 242 of file pgpmac.\-c.

\hypertarget{pgpmac_8h_a8237e646ce032a840637a4ef7bff49b9}{\index{pgpmac.\-h@{pgpmac.\-h}!omega@{omega}}
\index{omega@{omega}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{omega}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ omega}}\label{pgpmac_8h_a8237e646ce032a840637a4ef7bff49b9}


M\-D2 omega axis (the air bearing) 



Definition at line 100 of file lspmac.\-c.

\hypertarget{pgpmac_8h_ae6631a094accc469661805bdf80fc6d8}{\index{pgpmac.\-h@{pgpmac.\-h}!omega\-\_\-zero\-\_\-time@{omega\-\_\-zero\-\_\-time}}
\index{omega\-\_\-zero\-\_\-time@{omega\-\_\-zero\-\_\-time}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{omega\-\_\-zero\-\_\-time}]{\setlength{\rightskip}{0pt plus 5cm}struct timespec omega\-\_\-zero\-\_\-time}}\label{pgpmac_8h_ae6631a094accc469661805bdf80fc6d8}


Time we believe that omega crossed zero. 



Definition at line 80 of file lspmac.\-c.

\hypertarget{pgpmac_8h_ad163e2bc6ebe322058c113dee76c11ff}{\index{pgpmac.\-h@{pgpmac.\-h}!pgpmac\-\_\-use\-\_\-autoscint@{pgpmac\-\_\-use\-\_\-autoscint}}
\index{pgpmac\-\_\-use\-\_\-autoscint@{pgpmac\-\_\-use\-\_\-autoscint}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{pgpmac\-\_\-use\-\_\-autoscint}]{\setlength{\rightskip}{0pt plus 5cm}int pgpmac\-\_\-use\-\_\-autoscint}}\label{pgpmac_8h_ad163e2bc6ebe322058c113dee76c11ff}


non-\/zero to automatically move the alignment stage when the scintillator moves (redis hash A\-U\-T\-O\-S\-C\-I\-N\-T in config.\-H\-O\-S\-T\-N\-A\-M\-E sets this) 



Definition at line 247 of file pgpmac.\-c.

\hypertarget{pgpmac_8h_ae002f31c03cce9bf96cf0e0c2907cb2b}{\index{pgpmac.\-h@{pgpmac.\-h}!pgpmac\-\_\-use\-\_\-pg@{pgpmac\-\_\-use\-\_\-pg}}
\index{pgpmac\-\_\-use\-\_\-pg@{pgpmac\-\_\-use\-\_\-pg}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{pgpmac\-\_\-use\-\_\-pg}]{\setlength{\rightskip}{0pt plus 5cm}int pgpmac\-\_\-use\-\_\-pg}}\label{pgpmac_8h_ae002f31c03cce9bf96cf0e0c2907cb2b}


non-\/zero to start up lspg thread, 0 to not (reids hash P\-G in config.\-H\-O\-S\-T\-N\-A\-M\-E sets this) 



Definition at line 246 of file pgpmac.\-c.

\hypertarget{pgpmac_8h_ac8070dc568ad974a3db42b51eca828cc}{\index{pgpmac.\-h@{pgpmac.\-h}!phi@{phi}}
\index{phi@{phi}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{phi}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ phi}}\label{pgpmac_8h_ac8070dc568ad974a3db42b51eca828cc}


Phi (not data collection axis) 



Definition at line 114 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a8a25bd9c593c6985107f90f999ce0b08}{\index{pgpmac.\-h@{pgpmac.\-h}!pmac\-\_\-queue\-\_\-cond@{pmac\-\_\-queue\-\_\-cond}}
\index{pmac\-\_\-queue\-\_\-cond@{pmac\-\_\-queue\-\_\-cond}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{pmac\-\_\-queue\-\_\-cond}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-cond\-\_\-t pmac\-\_\-queue\-\_\-cond}}\label{pgpmac_8h_a8a25bd9c593c6985107f90f999ce0b08}


wait for a command to be sent to P\-M\-A\-C before continuing 



Definition at line 86 of file lspmac.\-c.

\hypertarget{pgpmac_8h_acc1bb77b9bcbc4d970f841a41fd274b3}{\index{pgpmac.\-h@{pgpmac.\-h}!pmac\-\_\-queue\-\_\-mutex@{pmac\-\_\-queue\-\_\-mutex}}
\index{pmac\-\_\-queue\-\_\-mutex@{pmac\-\_\-queue\-\_\-mutex}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{pmac\-\_\-queue\-\_\-mutex}]{\setlength{\rightskip}{0pt plus 5cm}pthread\-\_\-mutex\-\_\-t pmac\-\_\-queue\-\_\-mutex}}\label{pgpmac_8h_acc1bb77b9bcbc4d970f841a41fd274b3}


manage access to the pmac command queue 



Definition at line 85 of file lspmac.\-c.

\hypertarget{pgpmac_8h_ac59ab990e48033a811aeb0281fb588fc}{\index{pgpmac.\-h@{pgpmac.\-h}!sample\-\_\-detected@{sample\-\_\-detected}}
\index{sample\-\_\-detected@{sample\-\_\-detected}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{sample\-\_\-detected}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-bi\-\_\-t}$\ast$ sample\-\_\-detected}}\label{pgpmac_8h_ac59ab990e48033a811aeb0281fb588fc}


smart magnet detected sample 



Definition at line 138 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a589431b3a79c21c251fcb97cc9126991}{\index{pgpmac.\-h@{pgpmac.\-h}!scint@{scint}}
\index{scint@{scint}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{scint}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ scint}}\label{pgpmac_8h_a589431b3a79c21c251fcb97cc9126991}


Scintillator Z. 



Definition at line 110 of file lspmac.\-c.

\hypertarget{pgpmac_8h_ae98a0792d6b4b96a33df0a31bdec6342}{\index{pgpmac.\-h@{pgpmac.\-h}!shutter\-\_\-open@{shutter\-\_\-open}}
\index{shutter\-\_\-open@{shutter\-\_\-open}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{shutter\-\_\-open}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-bi\-\_\-t}$\ast$ shutter\-\_\-open}}\label{pgpmac_8h_ae98a0792d6b4b96a33df0a31bdec6342}


shutter is open (note in pmc says this is a slow input) 



Definition at line 145 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a37903ed8430ac4d9ead609a78eb62f32}{\index{pgpmac.\-h@{pgpmac.\-h}!smart\-\_\-mag\-\_\-err@{smart\-\_\-mag\-\_\-err}}
\index{smart\-\_\-mag\-\_\-err@{smart\-\_\-mag\-\_\-err}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{smart\-\_\-mag\-\_\-err}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-bi\-\_\-t}$\ast$ smart\-\_\-mag\-\_\-err}}\label{pgpmac_8h_a37903ed8430ac4d9ead609a78eb62f32}


smart magnet error (coil broken perhaps) 



Definition at line 146 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a4892e918830dd12093d28c53a1c2df98}{\index{pgpmac.\-h@{pgpmac.\-h}!smart\-\_\-mag\-\_\-off@{smart\-\_\-mag\-\_\-off}}
\index{smart\-\_\-mag\-\_\-off@{smart\-\_\-mag\-\_\-off}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{smart\-\_\-mag\-\_\-off}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-bi\-\_\-t}$\ast$ smart\-\_\-mag\-\_\-off}}\label{pgpmac_8h_a4892e918830dd12093d28c53a1c2df98}


smart magnet is off 



Definition at line 147 of file lspmac.\-c.

\hypertarget{pgpmac_8h_a2dc6fa78bb6313fe8b696d646eaa2443}{\index{pgpmac.\-h@{pgpmac.\-h}!smart\-\_\-mag\-\_\-on@{smart\-\_\-mag\-\_\-on}}
\index{smart\-\_\-mag\-\_\-on@{smart\-\_\-mag\-\_\-on}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{smart\-\_\-mag\-\_\-on}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-bi\-\_\-t}$\ast$ smart\-\_\-mag\-\_\-on}}\label{pgpmac_8h_a2dc6fa78bb6313fe8b696d646eaa2443}


smart magnet is on 



Definition at line 143 of file lspmac.\-c.

\hypertarget{pgpmac_8h_abee73a0d9e5f3af9eb88d5cfd6b953c3}{\index{pgpmac.\-h@{pgpmac.\-h}!smart\-\_\-mag\-\_\-oo@{smart\-\_\-mag\-\_\-oo}}
\index{smart\-\_\-mag\-\_\-oo@{smart\-\_\-mag\-\_\-oo}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{smart\-\_\-mag\-\_\-oo}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ smart\-\_\-mag\-\_\-oo}}\label{pgpmac_8h_abee73a0d9e5f3af9eb88d5cfd6b953c3}


Smart Magnet on/off. 



Definition at line 121 of file lspmac.\-c.

\hypertarget{pgpmac_8h_ab0487111dbe3c05d0bd835eb2fb9a3f7}{\index{pgpmac.\-h@{pgpmac.\-h}!term\-\_\-input@{term\-\_\-input}}
\index{term\-\_\-input@{term\-\_\-input}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{term\-\_\-input}]{\setlength{\rightskip}{0pt plus 5cm}W\-I\-N\-D\-O\-W$\ast$ term\-\_\-input}}\label{pgpmac_8h_ab0487111dbe3c05d0bd835eb2fb9a3f7}


place to put the cursor 



Definition at line 238 of file pgpmac.\-c.

\hypertarget{pgpmac_8h_a65daf0f4a5bc6def23a9df98ff5ca57e}{\index{pgpmac.\-h@{pgpmac.\-h}!term\-\_\-output@{term\-\_\-output}}
\index{term\-\_\-output@{term\-\_\-output}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{term\-\_\-output}]{\setlength{\rightskip}{0pt plus 5cm}W\-I\-N\-D\-O\-W$\ast$ term\-\_\-output}}\label{pgpmac_8h_a65daf0f4a5bc6def23a9df98ff5ca57e}


place to print stuff out 



Definition at line 237 of file pgpmac.\-c.

\hypertarget{pgpmac_8h_ae746a6903fb8a4ea216def88eccedc3c}{\index{pgpmac.\-h@{pgpmac.\-h}!term\-\_\-status@{term\-\_\-status}}
\index{term\-\_\-status@{term\-\_\-status}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{term\-\_\-status}]{\setlength{\rightskip}{0pt plus 5cm}W\-I\-N\-D\-O\-W$\ast$ term\-\_\-status}}\label{pgpmac_8h_ae746a6903fb8a4ea216def88eccedc3c}


shutter, lamp, air, etc status 



Definition at line 239 of file pgpmac.\-c.

\hypertarget{pgpmac_8h_ae2d7da3afeb756716e6e4ee9cab78f8a}{\index{pgpmac.\-h@{pgpmac.\-h}!term\-\_\-status2@{term\-\_\-status2}}
\index{term\-\_\-status2@{term\-\_\-status2}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{term\-\_\-status2}]{\setlength{\rightskip}{0pt plus 5cm}W\-I\-N\-D\-O\-W$\ast$ term\-\_\-status2}}\label{pgpmac_8h_ae2d7da3afeb756716e6e4ee9cab78f8a}


shutter, lamp, air, etc status 



Definition at line 240 of file pgpmac.\-c.

\hypertarget{pgpmac_8h_ad53a42cfaa04eff0336a44c8c9986333}{\index{pgpmac.\-h@{pgpmac.\-h}!zoom@{zoom}}
\index{zoom@{zoom}!pgpmac.h@{pgpmac.\-h}}
\subsubsection[{zoom}]{\setlength{\rightskip}{0pt plus 5cm}{\bf lspmac\-\_\-motor\-\_\-t}$\ast$ zoom}}\label{pgpmac_8h_ad53a42cfaa04eff0336a44c8c9986333}


Optical zoom. 



Definition at line 105 of file lspmac.\-c.

