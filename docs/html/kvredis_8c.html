<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LS-CAT PGPMAC: kvredis.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LS-CAT PGPMAC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('kvredis_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">kvredis.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;hiredis/hiredis.h&gt;</code><br/>
<code>#include &lt;hiredis/async.h&gt;</code><br/>
<code>#include &lt;poll.h&gt;</code><br/>
<code>#include &lt;postgresql/libpq-fe.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
</div>
<p><a href="kvredis_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlspgQueryQueueStruct.html">lspgQueryQueueStruct</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Store each query along with it's callback function.  <a href="structlspgQueryQueueStruct.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a08fe83fe8226002ee8b80ce0a914fd11"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a08fe83fe8226002ee8b80ce0a914fd11">LS_PG_QUERY_QUEUE_LENGTH</a>&#160;&#160;&#160;512</td></tr>
<tr class="separator:a08fe83fe8226002ee8b80ce0a914fd11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a8ef1b4b5994d6dd12bf74454ea891b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a3a8ef1b4b5994d6dd12bf74454ea891b">LS_PG_QUERY_STRING_LENGTH</a>&#160;&#160;&#160;512</td></tr>
<tr class="separator:a3a8ef1b4b5994d6dd12bf74454ea891b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af443092447378c73bf93aa143576aba4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a>&#160;&#160;&#160;-4</td></tr>
<tr class="separator:af443092447378c73bf93aa143576aba4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7ea5876846b5f04c419aee22d3c0aa1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#ae7ea5876846b5f04c419aee22d3c0aa1">LS_PG_STATE_INIT_POLL</a>&#160;&#160;&#160;-3</td></tr>
<tr class="separator:ae7ea5876846b5f04c419aee22d3c0aa1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:accda8c3a598dc7f5b107b04986d8ab50"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>&#160;&#160;&#160;-2</td></tr>
<tr class="separator:accda8c3a598dc7f5b107b04986d8ab50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac70a1141f3b138055ea7143bd493187c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#ac70a1141f3b138055ea7143bd493187c">LS_PG_STATE_RESET_POLL</a>&#160;&#160;&#160;-1</td></tr>
<tr class="separator:ac70a1141f3b138055ea7143bd493187c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf1dd8ba4dafb91c296554c4cbf312e3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:aaf1dd8ba4dafb91c296554c4cbf312e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c6eb19f262a990e1f9ba630d9edc309"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a3c6eb19f262a990e1f9ba630d9edc309">LS_PG_STATE_SEND</a>&#160;&#160;&#160;2</td></tr>
<tr class="separator:a3c6eb19f262a990e1f9ba630d9edc309"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88a7e80c12fb0449c4b0857a0c7deb21"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a88a7e80c12fb0449c4b0857a0c7deb21">LS_PG_STATE_SEND_FLUSH</a>&#160;&#160;&#160;3</td></tr>
<tr class="separator:a88a7e80c12fb0449c4b0857a0c7deb21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a373e668840b4795ff9a71bc3f744d209"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a373e668840b4795ff9a71bc3f744d209">LS_PG_STATE_RECV</a>&#160;&#160;&#160;4</td></tr>
<tr class="separator:a373e668840b4795ff9a71bc3f744d209"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ae57432c0a6ac48a50457815dab2c5b4c"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structlspgQueryQueueStruct.html">lspgQueryQueueStruct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a></td></tr>
<tr class="memdesc:ae57432c0a6ac48a50457815dab2c5b4c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Store each query along with it's callback function.  <a href="#ae57432c0a6ac48a50457815dab2c5b4c"></a><br/></td></tr>
<tr class="separator:ae57432c0a6ac48a50457815dab2c5b4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa1941e6515a254f76cfd1f18d3c8fac3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#aa1941e6515a254f76cfd1f18d3c8fac3">redisDisconnectCB</a> (const redisAsyncContext *ac, int status)</td></tr>
<tr class="separator:aa1941e6515a254f76cfd1f18d3c8fac3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5dbdf77c680c97996882abbb6a142321"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a5dbdf77c680c97996882abbb6a142321">debugCB</a> (redisAsyncContext *ac, void *reply, void *privdata)</td></tr>
<tr class="separator:a5dbdf77c680c97996882abbb6a142321"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95668f6d7a4b8882c6a502af3b0a4705"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a95668f6d7a4b8882c6a502af3b0a4705">addRead</a> (void *data)</td></tr>
<tr class="separator:a95668f6d7a4b8882c6a502af3b0a4705"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3f87d428857a2d8e526e2443fadd410"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#ad3f87d428857a2d8e526e2443fadd410">delRead</a> (void *data)</td></tr>
<tr class="separator:ad3f87d428857a2d8e526e2443fadd410"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aacb58922ba249c3e15491826e682023c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#aacb58922ba249c3e15491826e682023c">addWrite</a> (void *data)</td></tr>
<tr class="separator:aacb58922ba249c3e15491826e682023c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d4f324dd0beeea83848e05550b5cf39"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a5d4f324dd0beeea83848e05550b5cf39">delWrite</a> (void *data)</td></tr>
<tr class="separator:a5d4f324dd0beeea83848e05550b5cf39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93a6e6dd9f422d01eeaa03d6ba4738a0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a93a6e6dd9f422d01eeaa03d6ba4738a0">cleanup</a> (void *data)</td></tr>
<tr class="separator:a93a6e6dd9f422d01eeaa03d6ba4738a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb8d1ff1e0f4fcdc85ad9c684271cb3d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#afb8d1ff1e0f4fcdc85ad9c684271cb3d">lspg_allkvs_cb</a> (<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *qqp, PGresult *pgr)</td></tr>
<tr class="separator:afb8d1ff1e0f4fcdc85ad9c684271cb3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62b110949d206fb22789191207e1d066"><td class="memItemLeft" align="right" valign="top">PQnoticeProcessor&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a62b110949d206fb22789191207e1d066">lspg_notice_processor</a> (void *arg, const char *msg)</td></tr>
<tr class="separator:a62b110949d206fb22789191207e1d066"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5f3ec8f197cc330c83dba70f310533c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#ad5f3ec8f197cc330c83dba70f310533c">lspg_query_next</a> ()</td></tr>
<tr class="memdesc:ad5f3ec8f197cc330c83dba70f310533c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the next item in the postgresql queue.  <a href="#ad5f3ec8f197cc330c83dba70f310533c"></a><br/></td></tr>
<tr class="separator:ad5f3ec8f197cc330c83dba70f310533c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3847589e641f7e16a0cd68ef30e37cca"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a3847589e641f7e16a0cd68ef30e37cca">lspg_query_reply_next</a> ()</td></tr>
<tr class="memdesc:a3847589e641f7e16a0cd68ef30e37cca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove the oldest item in the queue.  <a href="#a3847589e641f7e16a0cd68ef30e37cca"></a><br/></td></tr>
<tr class="separator:a3847589e641f7e16a0cd68ef30e37cca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6bf4f54117bedf903360883bb32699f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#ae6bf4f54117bedf903360883bb32699f">lspg_query_reply_peek</a> ()</td></tr>
<tr class="memdesc:ae6bf4f54117bedf903360883bb32699f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the next item in the reply queue but don't pop it since we may need it more than once.  <a href="#ae6bf4f54117bedf903360883bb32699f"></a><br/></td></tr>
<tr class="separator:ae6bf4f54117bedf903360883bb32699f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0bb9ef42da8fa21c4df48ec384ab69f4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4">lspg_query_push</a> (void(*cb)(<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *, PGresult *), char *fmt,...)</td></tr>
<tr class="memdesc:a0bb9ef42da8fa21c4df48ec384ab69f4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Place a query on the queue.  <a href="#a0bb9ef42da8fa21c4df48ec384ab69f4"></a><br/></td></tr>
<tr class="separator:a0bb9ef42da8fa21c4df48ec384ab69f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a038c5af23469b789fc1c55d21cb43029"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a038c5af23469b789fc1c55d21cb43029">lspg_receive</a> ()</td></tr>
<tr class="memdesc:a038c5af23469b789fc1c55d21cb43029"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receive a result of a query.  <a href="#a038c5af23469b789fc1c55d21cb43029"></a><br/></td></tr>
<tr class="separator:a038c5af23469b789fc1c55d21cb43029"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a581c18be0368425665a40b4b7f7d9714"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a581c18be0368425665a40b4b7f7d9714">lspg_pg_connect</a> ()</td></tr>
<tr class="memdesc:a581c18be0368425665a40b4b7f7d9714"><td class="mdescLeft">&#160;</td><td class="mdescRight">Connect to the pg server.  <a href="#a581c18be0368425665a40b4b7f7d9714"></a><br/></td></tr>
<tr class="separator:a581c18be0368425665a40b4b7f7d9714"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6485ac1749c5de3008dd0e0badaa09c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#af6485ac1749c5de3008dd0e0badaa09c">lspg_flush</a> ()</td></tr>
<tr class="memdesc:af6485ac1749c5de3008dd0e0badaa09c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flush psql output buffer (ie, send the query)  <a href="#af6485ac1749c5de3008dd0e0badaa09c"></a><br/></td></tr>
<tr class="separator:af6485ac1749c5de3008dd0e0badaa09c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab52a8c8245bf6561f40c0f224fc07ff4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#ab52a8c8245bf6561f40c0f224fc07ff4">lspg_next_state</a> ()</td></tr>
<tr class="memdesc:ab52a8c8245bf6561f40c0f224fc07ff4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implements our state machine Does not strictly only set the next state as it also calls some functions that, perhaps, alters the state mid-function.  <a href="#ab52a8c8245bf6561f40c0f224fc07ff4"></a><br/></td></tr>
<tr class="separator:ab52a8c8245bf6561f40c0f224fc07ff4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a714b15e117ffe7bfce4f2f2ce4725b0a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a714b15e117ffe7bfce4f2f2ce4725b0a">lspg_send_next_query</a> ()</td></tr>
<tr class="memdesc:a714b15e117ffe7bfce4f2f2ce4725b0a"><td class="mdescLeft">&#160;</td><td class="mdescRight">send the next queued query to the DB server  <a href="#a714b15e117ffe7bfce4f2f2ce4725b0a"></a><br/></td></tr>
<tr class="separator:a714b15e117ffe7bfce4f2f2ce4725b0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8d1fed4b461c2139a21826d524777d5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#aa8d1fed4b461c2139a21826d524777d5">lspg_pg_service</a> (struct pollfd *evt)</td></tr>
<tr class="memdesc:aa8d1fed4b461c2139a21826d524777d5"><td class="mdescLeft">&#160;</td><td class="mdescRight">I/O control to/from the postgresql server.  <a href="#aa8d1fed4b461c2139a21826d524777d5"></a><br/></td></tr>
<tr class="separator:aa8d1fed4b461c2139a21826d524777d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79856d1a06c278688563be6e5219cee5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a79856d1a06c278688563be6e5219cee5">fd_service</a> (struct pollfd *evt)</td></tr>
<tr class="separator:a79856d1a06c278688563be6e5219cee5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51af30a60f9f02777c6396b8247e356f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a51af30a60f9f02777c6396b8247e356f">main</a> ()</td></tr>
<tr class="separator:a51af30a60f9f02777c6396b8247e356f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a4d65536cb1094fb5deda0a852b181232"><td class="memItemLeft" align="right" valign="top">static redisAsyncContext *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a></td></tr>
<tr class="separator:a4d65536cb1094fb5deda0a852b181232"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a498efb0426f0d925e6cab0e7104812ae"><td class="memItemLeft" align="right" valign="top">static redisAsyncContext *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a498efb0426f0d925e6cab0e7104812ae">cmdac</a></td></tr>
<tr class="separator:a498efb0426f0d925e6cab0e7104812ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4937baac0cc78ea306d58b5f027867f1"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1">ls_pg_state</a> = <a class="el" href="lspg_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a></td></tr>
<tr class="memdesc:a4937baac0cc78ea306d58b5f027867f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">State of the lspg state machine.  <a href="#a4937baac0cc78ea306d58b5f027867f1"></a><br/></td></tr>
<tr class="separator:a4937baac0cc78ea306d58b5f027867f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad40ac52086f6b774928af45b09d54c6e"><td class="memItemLeft" align="right" valign="top">static struct timeval <br class="typebreak"/>
lspg_time_sent&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#ad40ac52086f6b774928af45b09d54c6e">now</a></td></tr>
<tr class="memdesc:ad40ac52086f6b774928af45b09d54c6e"><td class="mdescLeft">&#160;</td><td class="mdescRight">used to ensure we do not inundate the db server with connection requests  <a href="#ad40ac52086f6b774928af45b09d54c6e"></a><br/></td></tr>
<tr class="separator:ad40ac52086f6b774928af45b09d54c6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b15f24b2416f362a9e0039efc586fbb"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a6b15f24b2416f362a9e0039efc586fbb">kvseq</a> = 0</td></tr>
<tr class="memdesc:a6b15f24b2416f362a9e0039efc586fbb"><td class="mdescLeft">&#160;</td><td class="mdescRight">used to synchronize pg.kvs and redis  <a href="#a6b15f24b2416f362a9e0039efc586fbb"></a><br/></td></tr>
<tr class="separator:a6b15f24b2416f362a9e0039efc586fbb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a357d9d98f0b8c9625ccebcebfcdce955"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a357d9d98f0b8c9625ccebcebfcdce955">lspg_query_queue</a> [<a class="el" href="lspg_8c.html#a08fe83fe8226002ee8b80ce0a914fd11">LS_PG_QUERY_QUEUE_LENGTH</a>]</td></tr>
<tr class="memdesc:a357d9d98f0b8c9625ccebcebfcdce955"><td class="mdescLeft">&#160;</td><td class="mdescRight">Our query queue.  <a href="#a357d9d98f0b8c9625ccebcebfcdce955"></a><br/></td></tr>
<tr class="separator:a357d9d98f0b8c9625ccebcebfcdce955"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3cbe7f3161b3c1838ebc56a3bbcfd8a6"><td class="memItemLeft" align="right" valign="top">static unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6">lspg_query_queue_on</a> = 0</td></tr>
<tr class="memdesc:a3cbe7f3161b3c1838ebc56a3bbcfd8a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Next position to add something to the queue.  <a href="#a3cbe7f3161b3c1838ebc56a3bbcfd8a6"></a><br/></td></tr>
<tr class="separator:a3cbe7f3161b3c1838ebc56a3bbcfd8a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca86bb77d6cecfae9251743f4171bafb"><td class="memItemLeft" align="right" valign="top">static unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#aca86bb77d6cecfae9251743f4171bafb">lspg_query_queue_off</a> = 0</td></tr>
<tr class="memdesc:aca86bb77d6cecfae9251743f4171bafb"><td class="mdescLeft">&#160;</td><td class="mdescRight">The last item still being used (on == off means nothing in queue)  <a href="#aca86bb77d6cecfae9251743f4171bafb"></a><br/></td></tr>
<tr class="separator:aca86bb77d6cecfae9251743f4171bafb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2603b071afdbff7c0924b13de2454264"><td class="memItemLeft" align="right" valign="top">static unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a2603b071afdbff7c0924b13de2454264">lspg_query_queue_reply</a> = 0</td></tr>
<tr class="memdesc:a2603b071afdbff7c0924b13de2454264"><td class="mdescLeft">&#160;</td><td class="mdescRight">The current item being digested.  <a href="#a2603b071afdbff7c0924b13de2454264"></a><br/></td></tr>
<tr class="separator:a2603b071afdbff7c0924b13de2454264"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9012783dbbadf652a81649a289697cf3"><td class="memItemLeft" align="right" valign="top">static PGconn *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3">q</a> = NULL</td></tr>
<tr class="memdesc:a9012783dbbadf652a81649a289697cf3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Database connector.  <a href="#a9012783dbbadf652a81649a289697cf3"></a><br/></td></tr>
<tr class="separator:a9012783dbbadf652a81649a289697cf3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69ae04978986e6413ca7cefcb692b645"><td class="memItemLeft" align="right" valign="top">static PostgresPollingStatusType&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a69ae04978986e6413ca7cefcb692b645">lspg_connectPoll_response</a></td></tr>
<tr class="memdesc:a69ae04978986e6413ca7cefcb692b645"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used to determine state while connecting.  <a href="#a69ae04978986e6413ca7cefcb692b645"></a><br/></td></tr>
<tr class="separator:a69ae04978986e6413ca7cefcb692b645"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06c5a937e41a6c706a247777642ec1fb"><td class="memItemLeft" align="right" valign="top">static PostgresPollingStatusType&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a06c5a937e41a6c706a247777642ec1fb">lspg_resetPoll_response</a></td></tr>
<tr class="memdesc:a06c5a937e41a6c706a247777642ec1fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used to determine state while reconnecting.  <a href="#a06c5a937e41a6c706a247777642ec1fb"></a><br/></td></tr>
<tr class="separator:a06c5a937e41a6c706a247777642ec1fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af3f897b8ffa020ca54289bc5b28cb64d"><td class="memItemLeft" align="right" valign="top">static struct pollfd&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#af3f897b8ffa020ca54289bc5b28cb64d">lspgfd</a></td></tr>
<tr class="memdesc:af3f897b8ffa020ca54289bc5b28cb64d"><td class="mdescLeft">&#160;</td><td class="mdescRight">our poll info  <a href="#af3f897b8ffa020ca54289bc5b28cb64d"></a><br/></td></tr>
<tr class="separator:af3f897b8ffa020ca54289bc5b28cb64d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0cd3bdc79d035eb1595371c845d14367"><td class="memItemLeft" align="right" valign="top">static struct pollfd&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a0cd3bdc79d035eb1595371c845d14367">subfd</a></td></tr>
<tr class="memdesc:a0cd3bdc79d035eb1595371c845d14367"><td class="mdescLeft">&#160;</td><td class="mdescRight">poll info for redis subscribe channel  <a href="#a0cd3bdc79d035eb1595371c845d14367"></a><br/></td></tr>
<tr class="separator:a0cd3bdc79d035eb1595371c845d14367"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b0e607f794ed78360d09a52bb4feaef"><td class="memItemLeft" align="right" valign="top">static struct pollfd&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kvredis_8c.html#a9b0e607f794ed78360d09a52bb4feaef">cmdfd</a></td></tr>
<tr class="memdesc:a9b0e607f794ed78360d09a52bb4feaef"><td class="mdescLeft">&#160;</td><td class="mdescRight">poll info for redis command channel  <a href="#a9b0e607f794ed78360d09a52bb4feaef"></a><br/></td></tr>
<tr class="separator:a9b0e607f794ed78360d09a52bb4feaef"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a08fe83fe8226002ee8b80ce0a914fd11"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_QUERY_QUEUE_LENGTH&#160;&#160;&#160;512</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00012">12</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3a8ef1b4b5994d6dd12bf74454ea891b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_QUERY_STRING_LENGTH&#160;&#160;&#160;512</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00013">13</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="aaf1dd8ba4dafb91c296554c4cbf312e3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_STATE_IDLE&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00019">19</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="af443092447378c73bf93aa143576aba4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_STATE_INIT&#160;&#160;&#160;-4</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00015">15</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae7ea5876846b5f04c419aee22d3c0aa1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_STATE_INIT_POLL&#160;&#160;&#160;-3</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00016">16</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a373e668840b4795ff9a71bc3f744d209"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_STATE_RECV&#160;&#160;&#160;4</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00022">22</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="accda8c3a598dc7f5b107b04986d8ab50"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_STATE_RESET&#160;&#160;&#160;-2</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00017">17</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac70a1141f3b138055ea7143bd493187c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_STATE_RESET_POLL&#160;&#160;&#160;-1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00018">18</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3c6eb19f262a990e1f9ba630d9edc309"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_STATE_SEND&#160;&#160;&#160;2</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00020">20</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a88a7e80c12fb0449c4b0857a0c7deb21"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LS_PG_STATE_SEND_FLUSH&#160;&#160;&#160;3</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00021">21</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="ae57432c0a6ac48a50457815dab2c5b4c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlspgQueryQueueStruct.html">lspgQueryQueueStruct</a>  <a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Store each query along with it's callback function. </p>
<p>All calls are asynchronous </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a95668f6d7a4b8882c6a502af3b0a4705"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void addRead </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00111">111</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  <span class="keyword">struct </span>pollfd *pfd;</div>
<div class="line">  pfd = (<span class="keyword">struct </span>pollfd *)data;</div>
<div class="line">  pfd-&gt;events |= POLLIN;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aacb58922ba249c3e15491826e682023c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void addWrite </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00121">121</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>
<div class="fragment"><div class="line">                           {</div>
<div class="line">  <span class="keyword">struct </span>pollfd *pfd;</div>
<div class="line">  pfd = (<span class="keyword">struct </span>pollfd *)data;</div>
<div class="line">  pfd-&gt;events |= POLLOUT;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a93a6e6dd9f422d01eeaa03d6ba4738a0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cleanup </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00131">131</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  <span class="keyword">struct </span>pollfd *pfd;</div>
<div class="line">  pfd = (<span class="keyword">struct </span>pollfd *)data;</div>
<div class="line">  pfd-&gt;events &amp;= ~(POLLOUT | POLLIN);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5dbdf77c680c97996882abbb6a142321"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void debugCB </td>
          <td>(</td>
          <td class="paramtype">redisAsyncContext *&#160;</td>
          <td class="paramname"><em>ac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>reply</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>privdata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00063">63</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>
<div class="fragment"><div class="line">                                                                  {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> indentlevel = 0;</div>
<div class="line">  redisReply *r;</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line"></div>
<div class="line">  r = (redisReply *)reply;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( r == NULL) {</div>
<div class="line">    printf( <span class="stringliteral">&quot;Null reply.  Odd\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">switch</span>( r-&gt;type) {</div>
<div class="line">  <span class="keywordflow">case</span> REDIS_REPLY_STATUS:</div>
<div class="line">    printf( <span class="stringliteral">&quot;%*sSTATUS: %s\n&quot;</span>, indentlevel*4,<span class="stringliteral">&quot;&quot;</span>, r-&gt;str);</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> REDIS_REPLY_ERROR:</div>
<div class="line">    printf( <span class="stringliteral">&quot;%*sERROR: %s\n&quot;</span>, indentlevel*4, <span class="stringliteral">&quot;&quot;</span>, r-&gt;str);</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> REDIS_REPLY_INTEGER:</div>
<div class="line">    printf( <span class="stringliteral">&quot;%*sInteger: %lld\n&quot;</span>, indentlevel*4, <span class="stringliteral">&quot;&quot;</span>, r-&gt;integer);</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> REDIS_REPLY_NIL:</div>
<div class="line">    printf( <span class="stringliteral">&quot;%*s(nil)\n&quot;</span>, indentlevel*4, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> REDIS_REPLY_STRING:</div>
<div class="line">    printf( <span class="stringliteral">&quot;%*sSTRING: %s\n&quot;</span>, indentlevel*4, <span class="stringliteral">&quot;&quot;</span>, r-&gt;str);</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> REDIS_REPLY_ARRAY:</div>
<div class="line">    printf( <span class="stringliteral">&quot;%*sARRAY of %d elements\n&quot;</span>, indentlevel*4, <span class="stringliteral">&quot;&quot;</span>, (<span class="keywordtype">int</span>)r-&gt;elements);</div>
<div class="line">    indentlevel++;</div>
<div class="line">    <span class="keywordflow">for</span>( i=0; i&lt;r-&gt;elements; i++) {</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a5dbdf77c680c97996882abbb6a142321">debugCB</a>( ac, r-&gt;element[i], NULL);</div>
<div class="line">    }</div>
<div class="line">    indentlevel--;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">    </div>
<div class="line">  <span class="keywordflow">default</span>:</div>
<div class="line">    printf( <span class="stringliteral">&quot;%*sUnknown type %d\n&quot;</span>, indentlevel*4,<span class="stringliteral">&quot;&quot;</span>, r-&gt;type);</div>
<div class="line">    </div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad3f87d428857a2d8e526e2443fadd410"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void delRead </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00116">116</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">  <span class="keyword">struct </span>pollfd *pfd;</div>
<div class="line">  pfd = (<span class="keyword">struct </span>pollfd *)data;</div>
<div class="line">  pfd-&gt;events &amp;= ~POLLIN;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5d4f324dd0beeea83848e05550b5cf39"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void delWrite </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00126">126</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>
<div class="fragment"><div class="line">                           {</div>
<div class="line">  <span class="keyword">struct </span>pollfd *pfd;</div>
<div class="line">  pfd = (<span class="keyword">struct </span>pollfd *)data;</div>
<div class="line">  pfd-&gt;events &amp;= ~POLLOUT;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a79856d1a06c278688563be6e5219cee5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fd_service </td>
          <td>(</td>
          <td class="paramtype">struct pollfd *&#160;</td>
          <td class="paramname"><em>evt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00636">636</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>
<div class="fragment"><div class="line">                                     {</div>
<div class="line">  <span class="keywordflow">if</span>( evt-&gt;fd == <a class="code" href="kvredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;c.fd) {</div>
<div class="line">    <span class="keywordflow">if</span>( evt-&gt;revents &amp; POLLIN)</div>
<div class="line">      redisAsyncHandleRead( <a class="code" href="kvredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( evt-&gt;revents &amp; POLLOUT)</div>
<div class="line">      redisAsyncHandleWrite( <a class="code" href="kvredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span>( evt-&gt;fd == <a class="code" href="kvredis_8c.html#a498efb0426f0d925e6cab0e7104812ae">cmdac</a>-&gt;c.fd) {</div>
<div class="line">    <span class="keywordflow">if</span>( evt-&gt;revents &amp; POLLIN)</div>
<div class="line">      redisAsyncHandleRead( <a class="code" href="kvredis_8c.html#a498efb0426f0d925e6cab0e7104812ae">cmdac</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( evt-&gt;revents &amp; POLLOUT)</div>
<div class="line">      redisAsyncHandleWrite( <a class="code" href="kvredis_8c.html#a498efb0426f0d925e6cab0e7104812ae">cmdac</a>);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a> &amp;&amp; evt-&gt;fd == PQsocket( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>))</div>
<div class="line">    <a class="code" href="kvredis_8c.html#aa8d1fed4b461c2139a21826d524777d5" title="I/O control to/from the postgresql server.">lspg_pg_service</a>( evt);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="afb8d1ff1e0f4fcdc85ad9c684271cb3d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_allkvs_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *&#160;</td>
          <td class="paramname"><em>qqp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PGresult *&#160;</td>
          <td class="paramname"><em>pgr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00137">137</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>
<div class="fragment"><div class="line">                                                             {</div>
<div class="line">  <span class="keywordtype">int</span> kvname_col, kvvalue_col, kvseq_col, kvdbrtype_col;</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line">  <span class="keywordtype">int</span> seq;</div>
<div class="line">  <span class="keywordtype">char</span> *argv[8];</div>
<div class="line">  </div>
<div class="line">  kvname_col    = PQfnumber( pgr, <span class="stringliteral">&quot;rname&quot;</span>);</div>
<div class="line">  kvvalue_col   = PQfnumber( pgr, <span class="stringliteral">&quot;rvalue&quot;</span>);</div>
<div class="line">  kvseq_col     = PQfnumber( pgr, <span class="stringliteral">&quot;rseq&quot;</span>);</div>
<div class="line">  kvdbrtype_col = PQfnumber( pgr, <span class="stringliteral">&quot;rdbrtype&quot;</span>);</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">if</span>( kvname_col == -1 || kvvalue_col == -1 || kvseq_col == -1 || kvdbrtype_col == -1) {</div>
<div class="line">    fprintf( stderr, <span class="stringliteral">&quot;lspg_allkvs_cb: bad column number(s)\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  redisAsyncCommand( <a class="code" href="kvredis_8c.html#a498efb0426f0d925e6cab0e7104812ae">cmdac</a>, NULL, NULL, <span class="stringliteral">&quot;MULTI&quot;</span>);</div>
<div class="line">  <span class="keywordflow">for</span>( i=0; i&lt;PQntuples( pgr); i++) {</div>
<div class="line">    seq = atoi( PQgetvalue( pgr, i, kvseq_col));</div>
<div class="line">    <a class="code" href="kvredis_8c.html#a6b15f24b2416f362a9e0039efc586fbb" title="used to synchronize pg.kvs and redis">kvseq</a> = <a class="code" href="kvredis_8c.html#a6b15f24b2416f362a9e0039efc586fbb" title="used to synchronize pg.kvs and redis">kvseq</a> &lt; seq ? seq : <a class="code" href="kvredis_8c.html#a6b15f24b2416f362a9e0039efc586fbb" title="used to synchronize pg.kvs and redis">kvseq</a>;</div>
<div class="line"></div>
<div class="line">    argv[0] = <span class="stringliteral">&quot;HMSET&quot;</span>;</div>
<div class="line">    argv[1] = PQgetvalue( pgr, i, kvname_col);</div>
<div class="line">    argv[2] = <span class="stringliteral">&quot;VALUE&quot;</span>;</div>
<div class="line">    argv[3] = PQgetvalue( pgr, i, kvvalue_col);</div>
<div class="line">    argv[4] = <span class="stringliteral">&quot;SEQ&quot;</span>;</div>
<div class="line">    argv[5] = PQgetvalue( pgr, i, kvseq_col);</div>
<div class="line">    argv[6] = <span class="stringliteral">&quot;DBRTYPE&quot;</span>;</div>
<div class="line">    argv[7] = PQgetvalue( pgr, i, kvdbrtype_col);</div>
<div class="line">    redisAsyncCommandArgv( <a class="code" href="kvredis_8c.html#a498efb0426f0d925e6cab0e7104812ae">cmdac</a>, NULL, NULL, 8, (<span class="keyword">const</span> <span class="keywordtype">char</span> **)argv, NULL);</div>
<div class="line"></div>
<div class="line">    argv[0] = <span class="stringliteral">&quot;PUBLISH&quot;</span>;</div>
<div class="line">    argv[1] = <span class="stringliteral">&quot;REDIS_KV_CONNECTOR&quot;</span>;</div>
<div class="line">    argv[2] = PQgetvalue( pgr, i, kvname_col);</div>
<div class="line">    redisAsyncCommandArgv( <a class="code" href="kvredis_8c.html#a498efb0426f0d925e6cab0e7104812ae">cmdac</a>, NULL, NULL, 3, (<span class="keyword">const</span> <span class="keywordtype">char</span> **)argv, NULL);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  redisAsyncCommand( <a class="code" href="kvredis_8c.html#a498efb0426f0d925e6cab0e7104812ae">cmdac</a>, NULL, NULL, <span class="stringliteral">&quot;SET redis.kvseq %d&quot;</span>, <a class="code" href="kvredis_8c.html#a6b15f24b2416f362a9e0039efc586fbb" title="used to synchronize pg.kvs and redis">kvseq</a>);</div>
<div class="line"></div>
<div class="line">  redisAsyncCommand( <a class="code" href="kvredis_8c.html#a498efb0426f0d925e6cab0e7104812ae">cmdac</a>, NULL, NULL, <span class="stringliteral">&quot;EXEC&quot;</span>);</div>
<div class="line">  </div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af6485ac1749c5de3008dd0e0badaa09c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_flush </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Flush psql output buffer (ie, send the query) </p>

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00412">412</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>
<div class="fragment"><div class="line">                  {</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line"></div>
<div class="line">  err = PQflush( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">  <span class="keywordflow">switch</span>( err) {</div>
<div class="line">  <span class="keywordflow">case</span> -1:</div>
<div class="line">    <span class="comment">// an error occured</span></div>
<div class="line"></div>
<div class="line">    fprintf( stderr, <span class="stringliteral">&quot;flush failed: %s\n&quot;</span>, PQerrorMessage( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>));</div>
<div class="line"></div>
<div class="line">    <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="kvredis_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a>;</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// We should probably reset the connection and start from scratch.  Probably the connection died.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">          </div>
<div class="line">  <span class="keywordflow">case</span> 0:</div>
<div class="line">    <span class="comment">// goodness and joy.</span></div>
<div class="line">    <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="kvredis_8c.html#a373e668840b4795ff9a71bc3f744d209">LS_PG_STATE_RECV</a>;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> 1:</div>
<div class="line">    <span class="comment">// more sending to do</span></div>
<div class="line">    <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="kvredis_8c.html#a88a7e80c12fb0449c4b0857a0c7deb21">LS_PG_STATE_SEND_FLUSH</a>;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab52a8c8245bf6561f40c0f224fc07ff4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_next_state </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Implements our state machine Does not strictly only set the next state as it also calls some functions that, perhaps, alters the state mid-function. </p>

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00444">444</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>
<div class="fragment"><div class="line">                       {</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// connect to the database</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a> == NULL ||</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="kvredis_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a> ||</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="kvredis_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a> ||</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="kvredis_8c.html#ae7ea5876846b5f04c419aee22d3c0aa1">LS_PG_STATE_INIT_POLL</a> ||</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="kvredis_8c.html#ac70a1141f3b138055ea7143bd493187c">LS_PG_STATE_RESET_POLL</a>)</div>
<div class="line">    <a class="code" href="kvredis_8c.html#a581c18be0368425665a40b4b7f7d9714" title="Connect to the pg server.">lspg_pg_connect</a>( <a class="code" href="kvredis_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="kvredis_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a> &amp;&amp; <a class="code" href="kvredis_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6" title="Next position to add something to the queue.">lspg_query_queue_on</a> != <a class="code" href="kvredis_8c.html#aca86bb77d6cecfae9251743f4171bafb" title="The last item still being used (on == off means nothing in queue)">lspg_query_queue_off</a>)</div>
<div class="line">    <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="kvredis_8c.html#a3c6eb19f262a990e1f9ba630d9edc309">LS_PG_STATE_SEND</a>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">switch</span>( <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a>) {</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="kvredis_8c.html#ae7ea5876846b5f04c419aee22d3c0aa1">LS_PG_STATE_INIT_POLL</a>:</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> == PGRES_POLLING_WRITING)</div>
<div class="line">      <a class="code" href="kvredis_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = POLLOUT;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> == PGRES_POLLING_READING)</div>
<div class="line">      <a class="code" href="kvredis_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = POLLIN;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      <a class="code" href="kvredis_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = 0;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">      </div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="kvredis_8c.html#ac70a1141f3b138055ea7143bd493187c">LS_PG_STATE_RESET_POLL</a>:</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> == PGRES_POLLING_WRITING)</div>
<div class="line">      <a class="code" href="kvredis_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = POLLOUT;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> == PGRES_POLLING_READING)</div>
<div class="line">      <a class="code" href="kvredis_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = POLLIN;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      <a class="code" href="kvredis_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = 0;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="kvredis_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a>:</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="kvredis_8c.html#a373e668840b4795ff9a71bc3f744d209">LS_PG_STATE_RECV</a>:</div>
<div class="line">    <a class="code" href="kvredis_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = POLLIN;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="kvredis_8c.html#a3c6eb19f262a990e1f9ba630d9edc309">LS_PG_STATE_SEND</a>:</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="kvredis_8c.html#a88a7e80c12fb0449c4b0857a0c7deb21">LS_PG_STATE_SEND_FLUSH</a>:</div>
<div class="line">    <a class="code" href="kvredis_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = POLLOUT;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">default</span>:</div>
<div class="line">    <a class="code" href="kvredis_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events = 0;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a62b110949d206fb22789191207e1d066"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PQnoticeProcessor lspg_notice_processor </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00182">182</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>
<div class="fragment"><div class="line">                                                                     {</div>
<div class="line">  fprintf( stderr, <span class="stringliteral">&quot;lspg: %s&quot;</span>, msg);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a581c18be0368425665a40b4b7f7d9714"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_pg_connect </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Connect to the pg server. </p>

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00325">325</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>
<div class="fragment"><div class="line">                       {</div>
<div class="line">  PGresult *pgr;</div>
<div class="line">  <span class="keywordtype">int</span> wait_interval = 1;</div>
<div class="line">  <span class="keywordtype">int</span> connection_init = 0;</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>, err;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a> == NULL)</div>
<div class="line">    <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="kvredis_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">switch</span>( <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a>) {</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="kvredis_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a>:</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( lspg_time_sent.tv_sec != 0) {</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Reality check: if it&#39;s less the about 10 seconds since the last failed attempt</span></div>
<div class="line">      <span class="comment">// the just chill.</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      gettimeofday( &amp;<a class="code" href="kvredis_8c.html#ad40ac52086f6b774928af45b09d54c6e" title="used to ensure we do not inundate the db server with connection requests">now</a>, NULL);</div>
<div class="line">      <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#ad40ac52086f6b774928af45b09d54c6e" title="used to ensure we do not inundate the db server with connection requests">now</a>.tv_sec - lspg_time_sent.tv_sec &lt; 10) {</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a> = PQconnectStart( <span class="stringliteral">&quot;dbname=ls user=lsuser hostaddr=10.1.0.3&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a> == NULL) {</div>
<div class="line">      fprintf( stderr, <span class="stringliteral">&quot;Out of memory (lspg_pg_connect)&quot;</span>);</div>
<div class="line">      exit( -1);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    err = PQstatus( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( err == CONNECTION_BAD) {</div>
<div class="line">      fprintf( stderr, <span class="stringliteral">&quot;Trouble connecting to database&quot;</span>);</div>
<div class="line"></div>
<div class="line">      gettimeofday( &amp;lspg_time_sent, NULL);</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    err = PQsetnonblocking( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>, 1);</div>
<div class="line">    <span class="keywordflow">if</span>( err != 0) {</div>
<div class="line">      fprintf( stderr, <span class="stringliteral">&quot;Odd, could not set database connection to nonblocking&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="kvredis_8c.html#ae7ea5876846b5f04c419aee22d3c0aa1">LS_PG_STATE_INIT_POLL</a>;</div>
<div class="line">    <a class="code" href="kvredis_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> = PGRES_POLLING_WRITING;</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// set up the connection for poll</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <a class="code" href="kvredis_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.fd = PQsocket( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="kvredis_8c.html#ae7ea5876846b5f04c419aee22d3c0aa1">LS_PG_STATE_INIT_POLL</a>:</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> == PGRES_POLLING_FAILED) {</div>
<div class="line">      PQfinish( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a> = NULL;</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="kvredis_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a>;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> == PGRES_POLLING_OK) {</div>
<div class="line">      PQsetNoticeProcessor( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>, (PQnoticeProcessor)<a class="code" href="kvredis_8c.html#a62b110949d206fb22789191207e1d066">lspg_notice_processor</a>, NULL);</div>
<div class="line"></div>
<div class="line">      <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="kvredis_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="kvredis_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>:</div>
<div class="line">    err = PQresetStart( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( err == 0) {</div>
<div class="line">      PQfinish( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a> = NULL;</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="kvredis_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a>;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="kvredis_8c.html#ac70a1141f3b138055ea7143bd493187c">LS_PG_STATE_RESET_POLL</a>;</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> = PGRES_POLLING_WRITING;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">case</span> <a class="code" href="kvredis_8c.html#ac70a1141f3b138055ea7143bd493187c">LS_PG_STATE_RESET_POLL</a>:</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> == PGRES_POLLING_FAILED) {</div>
<div class="line">      PQfinish( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a> = NULL;</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="kvredis_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a>;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> == PGRES_POLLING_OK) {</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="kvredis_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa8d1fed4b461c2139a21826d524777d5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_pg_service </td>
          <td>(</td>
          <td class="paramtype">struct pollfd *&#160;</td>
          <td class="paramname"><em>evt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>I/O control to/from the postgresql server. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">evt</td><td>The pollfd object that we are responding to </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00543">543</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>
<div class="fragment"><div class="line">                       {</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Currently just used to check for notifies</span></div>
<div class="line">  <span class="comment">// Other socket communication is done syncronously</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( evt-&gt;revents &amp; POLLIN) {</div>
<div class="line">    <span class="keywordtype">int</span> err;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="kvredis_8c.html#ae7ea5876846b5f04c419aee22d3c0aa1">LS_PG_STATE_INIT_POLL</a>) {</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> = PQconnectPoll( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">      <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> == PGRES_POLLING_FAILED) {</div>
<div class="line">        <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="kvredis_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="kvredis_8c.html#ac70a1141f3b138055ea7143bd493187c">LS_PG_STATE_RESET_POLL</a>) {</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> = PQresetPoll( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">      <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> == PGRES_POLLING_FAILED) {</div>
<div class="line">        <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="kvredis_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// if in IDLE or RECV we need to call consumeInput first</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="kvredis_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a>) {</div>
<div class="line">      err = PQconsumeInput( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">      <span class="keywordflow">if</span>( err != 1) {</div>
<div class="line">        fprintf( stderr, <span class="stringliteral">&quot;consume input failed: %s&quot;</span>, PQerrorMessage( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>));</div>
<div class="line">        <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="kvredis_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>;</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">      }</div>
<div class="line">    }      </div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="kvredis_8c.html#a373e668840b4795ff9a71bc3f744d209">LS_PG_STATE_RECV</a>) {</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a038c5af23469b789fc1c55d21cb43029" title="Receive a result of a query.">lspg_receive</a>();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Check for notifies regardless of our state</span></div>
<div class="line">    <span class="comment">// Push as many requests as we have notifies.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    {</div>
<div class="line">      PGnotify *pgn;</div>
<div class="line"></div>
<div class="line">      <span class="keywordflow">while</span>( 1) {</div>
<div class="line">        pgn = PQnotifies( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">        <span class="keywordflow">if</span>( pgn == NULL)</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        </div>
<div class="line">        <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="kvredis_8c.html#afb8d1ff1e0f4fcdc85ad9c684271cb3d">lspg_allkvs_cb</a>, <span class="stringliteral">&quot;SELECT * FROM px.redis_kv_update(%d)&quot;</span>, <a class="code" href="kvredis_8c.html#a6b15f24b2416f362a9e0039efc586fbb" title="used to synchronize pg.kvs and redis">kvseq</a>);</div>
<div class="line"></div>
<div class="line">        PQfreemem( pgn);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( evt-&gt;revents &amp; POLLOUT) {</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="kvredis_8c.html#ae7ea5876846b5f04c419aee22d3c0aa1">LS_PG_STATE_INIT_POLL</a>) {</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> = PQconnectPoll( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">      <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a69ae04978986e6413ca7cefcb692b645" title="Used to determine state while connecting.">lspg_connectPoll_response</a> == PGRES_POLLING_FAILED) {</div>
<div class="line">        <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="kvredis_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="kvredis_8c.html#ac70a1141f3b138055ea7143bd493187c">LS_PG_STATE_RESET_POLL</a>) {</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> = PQresetPoll( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">      <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a06c5a937e41a6c706a247777642ec1fb" title="Used to determine state while reconnecting.">lspg_resetPoll_response</a> == PGRES_POLLING_FAILED) {</div>
<div class="line">        <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="kvredis_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="kvredis_8c.html#a3c6eb19f262a990e1f9ba630d9edc309">LS_PG_STATE_SEND</a>) {</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a714b15e117ffe7bfce4f2f2ce4725b0a" title="send the next queued query to the DB server">lspg_send_next_query</a>();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="kvredis_8c.html#a88a7e80c12fb0449c4b0857a0c7deb21">LS_PG_STATE_SEND_FLUSH</a>) {</div>
<div class="line">      <a class="code" href="kvredis_8c.html#af6485ac1749c5de3008dd0e0badaa09c" title="Flush psql output buffer (ie, send the query)">lspg_flush</a>();</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad5f3ec8f197cc330c83dba70f310533c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a>* lspg_query_next </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the next item in the postgresql queue. </p>
<p>If there is an item left in the queue then it is returned. Otherwise, NULL is returned. </p>

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00191">191</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>
<div class="fragment"><div class="line">                                      {</div>
<div class="line">  <a class="code" href="structlspgQueryQueueStruct.html" title="Store each query along with it&#39;s callback function.">lspg_query_queue_t</a> *rtn;</div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#aca86bb77d6cecfae9251743f4171bafb" title="The last item still being used (on == off means nothing in queue)">lspg_query_queue_off</a> == <a class="code" href="kvredis_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6" title="Next position to add something to the queue.">lspg_query_queue_on</a>)</div>
<div class="line">    <span class="comment">// Queue is empty</span></div>
<div class="line">    rtn = NULL;</div>
<div class="line">  <span class="keywordflow">else</span> {</div>
<div class="line">    rtn = &amp;(<a class="code" href="kvredis_8c.html#a357d9d98f0b8c9625ccebcebfcdce955" title="Our query queue.">lspg_query_queue</a>[(<a class="code" href="kvredis_8c.html#aca86bb77d6cecfae9251743f4171bafb" title="The last item still being used (on == off means nothing in queue)">lspg_query_queue_off</a>++) % <a class="code" href="kvredis_8c.html#a08fe83fe8226002ee8b80ce0a914fd11">LS_PG_QUERY_QUEUE_LENGTH</a>]); </div>
<div class="line"></div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0bb9ef42da8fa21c4df48ec384ab69f4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_query_push </td>
          <td>(</td>
          <td class="paramtype">void(*)(<a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> *, PGresult *)&#160;</td>
          <td class="paramname"><em>cb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Place a query on the queue. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cb</td><td>Our callback function that deals with the response </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fmt</td><td>Printf style function to generate the query </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00234">234</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>
<div class="fragment"><div class="line">                       {</div>
<div class="line">  <span class="keywordtype">int</span> idx;</div>
<div class="line">  va_list arg_ptr;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Pause the thread while we service the queue</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="keywordflow">if</span>( (<a class="code" href="kvredis_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6" title="Next position to add something to the queue.">lspg_query_queue_on</a> + 1) % <a class="code" href="kvredis_8c.html#a08fe83fe8226002ee8b80ce0a914fd11">LS_PG_QUERY_QUEUE_LENGTH</a> == <a class="code" href="kvredis_8c.html#aca86bb77d6cecfae9251743f4171bafb" title="The last item still being used (on == off means nothing in queue)">lspg_query_queue_off</a> % <a class="code" href="kvredis_8c.html#a08fe83fe8226002ee8b80ce0a914fd11">LS_PG_QUERY_QUEUE_LENGTH</a>) {</div>
<div class="line">    fprintf( stderr, <span class="stringliteral">&quot;lspg_query_push: queue is full.  Ignoring query \&quot;%s\&quot;\n&quot;</span>, fmt);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  idx = <a class="code" href="kvredis_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6" title="Next position to add something to the queue.">lspg_query_queue_on</a> % <a class="code" href="kvredis_8c.html#a08fe83fe8226002ee8b80ce0a914fd11">LS_PG_QUERY_QUEUE_LENGTH</a>;</div>
<div class="line"></div>
<div class="line">  va_start( arg_ptr, fmt);</div>
<div class="line">  vsnprintf( <a class="code" href="kvredis_8c.html#a357d9d98f0b8c9625ccebcebfcdce955" title="Our query queue.">lspg_query_queue</a>[idx].qs, <a class="code" href="kvredis_8c.html#a3a8ef1b4b5994d6dd12bf74454ea891b">LS_PG_QUERY_STRING_LENGTH</a>-1, fmt, arg_ptr);</div>
<div class="line">  va_end( arg_ptr);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="kvredis_8c.html#a357d9d98f0b8c9625ccebcebfcdce955" title="Our query queue.">lspg_query_queue</a>[idx].<a class="code" href="structlspgQueryQueueStruct.html#a1389b3ec4ddf9ed5cc0344d229a7ff9e" title="our queries should all be pretty short as we&#39;ll just be calling functions: fixed length here simplifi...">qs</a>[<a class="code" href="kvredis_8c.html#a3a8ef1b4b5994d6dd12bf74454ea891b">LS_PG_QUERY_STRING_LENGTH</a> - 1] = 0;</div>
<div class="line">  <a class="code" href="kvredis_8c.html#a357d9d98f0b8c9625ccebcebfcdce955" title="Our query queue.">lspg_query_queue</a>[idx].<a class="code" href="structlspgQueryQueueStruct.html#a53bac5ae4cab775423940bff5092a831" title="Callback function for when a query returns a result.">onResponse</a> = cb;</div>
<div class="line">  <a class="code" href="kvredis_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6" title="Next position to add something to the queue.">lspg_query_queue_on</a>++;</div>
<div class="line"></div>
<div class="line">};</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3847589e641f7e16a0cd68ef30e37cca"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_query_reply_next </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove the oldest item in the queue. </p>
<p>this is called only when there is nothing else to service the reply: this pop does not return anything. We use the ...reply_peek function to return the next item in the reply queue </p>

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00211">211</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>
<div class="fragment"><div class="line">                             {</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a2603b071afdbff7c0924b13de2454264" title="The current item being digested.">lspg_query_queue_reply</a> != <a class="code" href="kvredis_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6" title="Next position to add something to the queue.">lspg_query_queue_on</a>)</div>
<div class="line">    <a class="code" href="kvredis_8c.html#a2603b071afdbff7c0924b13de2454264" title="The current item being digested.">lspg_query_queue_reply</a>++;</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae6bf4f54117bedf903360883bb32699f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a>* lspg_query_reply_peek </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the next item in the reply queue but don't pop it since we may need it more than once. </p>
<p>Call <a class="el" href="kvredis_8c.html#a3847589e641f7e16a0cd68ef30e37cca" title="Remove the oldest item in the queue.">lspg_query_reply_next()</a> when done. </p>

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00221">221</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>
<div class="fragment"><div class="line">                                            {</div>
<div class="line">  <a class="code" href="structlspgQueryQueueStruct.html" title="Store each query along with it&#39;s callback function.">lspg_query_queue_t</a> *rtn;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a2603b071afdbff7c0924b13de2454264" title="The current item being digested.">lspg_query_queue_reply</a> == <a class="code" href="kvredis_8c.html#a3cbe7f3161b3c1838ebc56a3bbcfd8a6" title="Next position to add something to the queue.">lspg_query_queue_on</a>)</div>
<div class="line">    rtn = NULL;</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    rtn = &amp;(<a class="code" href="kvredis_8c.html#a357d9d98f0b8c9625ccebcebfcdce955" title="Our query queue.">lspg_query_queue</a>[(<a class="code" href="kvredis_8c.html#a2603b071afdbff7c0924b13de2454264" title="The current item being digested.">lspg_query_queue_reply</a>) % <a class="code" href="kvredis_8c.html#a08fe83fe8226002ee8b80ce0a914fd11">LS_PG_QUERY_QUEUE_LENGTH</a>]);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> rtn;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a038c5af23469b789fc1c55d21cb43029"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_receive </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Receive a result of a query. </p>

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00266">266</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>
<div class="fragment"><div class="line">                    {</div>
<div class="line">  PGresult *pgr;</div>
<div class="line">  <a class="code" href="structlspgQueryQueueStruct.html" title="Store each query along with it&#39;s callback function.">lspg_query_queue_t</a> *qqp;</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line"></div>
<div class="line">  err = PQconsumeInput( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">  <span class="keywordflow">if</span>( err != 1) {</div>
<div class="line">    fprintf( stderr, <span class="stringliteral">&quot;consume input failed: %s&quot;</span>, PQerrorMessage( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>));</div>
<div class="line">    <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="kvredis_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>;</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// We must call PQgetResult until it returns NULL before sending the next query</span></div>
<div class="line">  <span class="comment">// This implies that only one query can ever be active at a time and our queue</span></div>
<div class="line">  <span class="comment">// management should be simple</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// We should be in the LS_PG_STATE_RECV here</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span>( !PQisBusy( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>)) {</div>
<div class="line">    pgr = PQgetResult( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( pgr == NULL) {</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a3847589e641f7e16a0cd68ef30e37cca" title="Remove the oldest item in the queue.">lspg_query_reply_next</a>();</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// we are now done reading the response from the database</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="kvredis_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      ExecStatusType es;</div>
<div class="line"></div>
<div class="line">      qqp = <a class="code" href="kvredis_8c.html#ae6bf4f54117bedf903360883bb32699f" title="Return the next item in the reply queue but don&#39;t pop it since we may need it more than once...">lspg_query_reply_peek</a>();</div>
<div class="line">      es = PQresultStatus( pgr);</div>
<div class="line"></div>
<div class="line">      <span class="keywordflow">if</span>( es != PGRES_COMMAND_OK &amp;&amp; es != PGRES_TUPLES_OK) {</div>
<div class="line">        <span class="keywordtype">char</span> *emess;</div>
<div class="line">        emess = PQresultErrorMessage( pgr);</div>
<div class="line">        <span class="keywordflow">if</span>( emess != NULL &amp;&amp; emess[0] != 0) {</div>
<div class="line">          fprintf( stderr, <span class="stringliteral">&quot;Error from query &#39;%s&#39;:\n%s&quot;</span>, qqp-&gt;<a class="code" href="structlspgQueryQueueStruct.html#a1389b3ec4ddf9ed5cc0344d229a7ff9e" title="our queries should all be pretty short as we&#39;ll just be calling functions: fixed length here simplifi...">qs</a>, emess);</div>
<div class="line">        }</div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// Deal with the response</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// If the response is likely to take awhile we should probably</span></div>
<div class="line">        <span class="comment">// add a new state and put something in the main look to run the onResponse</span></div>
<div class="line">        <span class="comment">// routine in the main loop.  For now, though, we only expect very brief onResponse routines</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="keywordflow">if</span>( qqp != NULL &amp;&amp; qqp-&gt;<a class="code" href="structlspgQueryQueueStruct.html#a53bac5ae4cab775423940bff5092a831" title="Callback function for when a query returns a result.">onResponse</a> != NULL)</div>
<div class="line">          qqp-&gt;<a class="code" href="structlspgQueryQueueStruct.html#a53bac5ae4cab775423940bff5092a831" title="Callback function for when a query returns a result.">onResponse</a>( qqp, pgr);</div>
<div class="line">      }</div>
<div class="line">      PQclear( pgr);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a714b15e117ffe7bfce4f2f2ce4725b0a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lspg_send_next_query </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>send the next queued query to the DB server </p>

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00496">496</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>
<div class="fragment"><div class="line">                            {</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Normally we should be in the &quot;send&quot; state</span></div>
<div class="line">  <span class="comment">// but we can also send if we are servicing</span></div>
<div class="line">  <span class="comment">// a reply</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  <a class="code" href="structlspgQueryQueueStruct.html" title="Store each query along with it&#39;s callback function.">lspg_query_queue_t</a> *qqp;</div>
<div class="line">  <span class="keywordtype">int</span> err;</div>
<div class="line"></div>
<div class="line">  qqp = <a class="code" href="kvredis_8c.html#ad5f3ec8f197cc330c83dba70f310533c" title="Return the next item in the postgresql queue.">lspg_query_next</a>();</div>
<div class="line">  <span class="keywordflow">if</span>( qqp == NULL) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// A send without a query?  Should never happen.</span></div>
<div class="line">    <span class="comment">// But at least we shouldn&#39;t segfault if it does.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( qqp-&gt;<a class="code" href="structlspgQueryQueueStruct.html#a1389b3ec4ddf9ed5cc0344d229a7ff9e" title="our queries should all be pretty short as we&#39;ll just be calling functions: fixed length here simplifi...">qs</a>[0] == 0) {</div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Do we really have to check this case?</span></div>
<div class="line">    <span class="comment">// It would only come up if we stupidly pushed an empty query string</span></div>
<div class="line">    <span class="comment">// or ran off the end of the queue</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    fprintf( stderr, <span class="stringliteral">&quot;Popped empty query string.  Probably bad things are going on.\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="kvredis_8c.html#a3847589e641f7e16a0cd68ef30e37cca" title="Remove the oldest item in the queue.">lspg_query_reply_next</a>();</div>
<div class="line">    <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="kvredis_8c.html#aaf1dd8ba4dafb91c296554c4cbf312e3">LS_PG_STATE_IDLE</a>;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    err = PQsendQuery( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>, qqp-&gt;<a class="code" href="structlspgQueryQueueStruct.html#a1389b3ec4ddf9ed5cc0344d229a7ff9e" title="our queries should all be pretty short as we&#39;ll just be calling functions: fixed length here simplifi...">qs</a>);</div>
<div class="line">    <span class="keywordflow">if</span>( err == 0) {</div>
<div class="line">      fprintf( stderr, <span class="stringliteral">&quot;query failed: %s\n&quot;</span>, PQerrorMessage( <a class="code" href="kvredis_8c.html#a9012783dbbadf652a81649a289697cf3" title="Database connector.">q</a>));</div>
<div class="line"></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Don&#39;t wait for a reply, just reset the connection</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <a class="code" href="kvredis_8c.html#a3847589e641f7e16a0cd68ef30e37cca" title="Remove the oldest item in the queue.">lspg_query_reply_next</a>();</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> == <a class="code" href="kvredis_8c.html#accda8c3a598dc7f5b107b04986d8ab50">LS_PG_STATE_RESET</a>;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <a class="code" href="kvredis_8c.html#a4937baac0cc78ea306d58b5f027867f1" title="State of the lspg state machine.">ls_pg_state</a> = <a class="code" href="kvredis_8c.html#a88a7e80c12fb0449c4b0857a0c7deb21">LS_PG_STATE_SEND_FLUSH</a>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a51af30a60f9f02777c6396b8247e356f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">main </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00655">655</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>
<div class="fragment"><div class="line">       {</div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">struct </span>pollfd fda[3];</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">int</span> nfda = 0;</div>
<div class="line">  <span class="keywordtype">int</span> pollrtn;</div>
<div class="line">  <span class="keywordtype">int</span> poll_timeout_ms;</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code" href="namespacemk__pgpmac__redis.html#afa643a23a5984fe44c2182ada3dfa401">i</a>;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="kvredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a> = redisAsyncConnect(<span class="stringliteral">&quot;127.0.0.1&quot;</span>, 6379);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;err) {</div>
<div class="line">    fprintf( stderr, <span class="stringliteral">&quot;Error: %s\n&quot;</span>, <a class="code" href="kvredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;errstr);</div>
<div class="line">    exit( -1);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="kvredis_8c.html#a498efb0426f0d925e6cab0e7104812ae">cmdac</a> = redisAsyncConnect(<span class="stringliteral">&quot;127.0.0.1&quot;</span>, 6379);</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a498efb0426f0d925e6cab0e7104812ae">cmdac</a>-&gt;err) {</div>
<div class="line">    fprintf( stderr, <span class="stringliteral">&quot;Error: %s\n&quot;</span>, <a class="code" href="kvredis_8c.html#a498efb0426f0d925e6cab0e7104812ae">cmdac</a>-&gt;errstr);</div>
<div class="line">    exit( -1);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( redisAsyncSetDisconnectCallback( <a class="code" href="kvredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>, <a class="code" href="kvredis_8c.html#aa1941e6515a254f76cfd1f18d3c8fac3">redisDisconnectCB</a>) == REDIS_ERR) {</div>
<div class="line">    fprintf( stderr, <span class="stringliteral">&quot;Error: could not set disconnect callback\n&quot;</span>);</div>
<div class="line">    exit( -1);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( redisAsyncSetDisconnectCallback( <a class="code" href="kvredis_8c.html#a498efb0426f0d925e6cab0e7104812ae">cmdac</a>, <a class="code" href="kvredis_8c.html#aa1941e6515a254f76cfd1f18d3c8fac3">redisDisconnectCB</a>) == REDIS_ERR) {</div>
<div class="line">    fprintf( stderr, <span class="stringliteral">&quot;Error: could not set disconnect callback\n&quot;</span>);</div>
<div class="line">    exit( -1);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Set up redis events</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0cd3bdc79d035eb1595371c845d14367" title="poll info for redis subscribe channel">subfd</a>.fd           = <a class="code" href="kvredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;c.fd;</div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0cd3bdc79d035eb1595371c845d14367" title="poll info for redis subscribe channel">subfd</a>.events       = 0;</div>
<div class="line">  <a class="code" href="kvredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;ev.data     = &amp;<a class="code" href="kvredis_8c.html#a0cd3bdc79d035eb1595371c845d14367" title="poll info for redis subscribe channel">subfd</a>;</div>
<div class="line">  <a class="code" href="kvredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;ev.addRead  = <a class="code" href="kvredis_8c.html#a95668f6d7a4b8882c6a502af3b0a4705">addRead</a>;</div>
<div class="line">  <a class="code" href="kvredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;ev.delRead  = <a class="code" href="kvredis_8c.html#ad3f87d428857a2d8e526e2443fadd410">delRead</a>;</div>
<div class="line">  <a class="code" href="kvredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;ev.addWrite = <a class="code" href="kvredis_8c.html#aacb58922ba249c3e15491826e682023c">addWrite</a>;</div>
<div class="line">  <a class="code" href="kvredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;ev.delWrite = <a class="code" href="kvredis_8c.html#a5d4f324dd0beeea83848e05550b5cf39">delWrite</a>;</div>
<div class="line">  <a class="code" href="kvredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>-&gt;ev.cleanup  = <a class="code" href="kvredis_8c.html#a93a6e6dd9f422d01eeaa03d6ba4738a0">cleanup</a>;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="kvredis_8c.html#a9b0e607f794ed78360d09a52bb4feaef" title="poll info for redis command channel">cmdfd</a>.fd           = <a class="code" href="kvredis_8c.html#a498efb0426f0d925e6cab0e7104812ae">cmdac</a>-&gt;c.fd;</div>
<div class="line">  <a class="code" href="kvredis_8c.html#a9b0e607f794ed78360d09a52bb4feaef" title="poll info for redis command channel">cmdfd</a>.events       = 0;</div>
<div class="line">  <a class="code" href="kvredis_8c.html#a498efb0426f0d925e6cab0e7104812ae">cmdac</a>-&gt;ev.data     = &amp;<a class="code" href="kvredis_8c.html#a9b0e607f794ed78360d09a52bb4feaef" title="poll info for redis command channel">cmdfd</a>;</div>
<div class="line">  <a class="code" href="kvredis_8c.html#a498efb0426f0d925e6cab0e7104812ae">cmdac</a>-&gt;ev.addRead  = <a class="code" href="kvredis_8c.html#a95668f6d7a4b8882c6a502af3b0a4705">addRead</a>;</div>
<div class="line">  <a class="code" href="kvredis_8c.html#a498efb0426f0d925e6cab0e7104812ae">cmdac</a>-&gt;ev.delRead  = <a class="code" href="kvredis_8c.html#ad3f87d428857a2d8e526e2443fadd410">delRead</a>;</div>
<div class="line">  <a class="code" href="kvredis_8c.html#a498efb0426f0d925e6cab0e7104812ae">cmdac</a>-&gt;ev.addWrite = <a class="code" href="kvredis_8c.html#aacb58922ba249c3e15491826e682023c">addWrite</a>;</div>
<div class="line">  <a class="code" href="kvredis_8c.html#a498efb0426f0d925e6cab0e7104812ae">cmdac</a>-&gt;ev.delWrite = <a class="code" href="kvredis_8c.html#a5d4f324dd0beeea83848e05550b5cf39">delWrite</a>;</div>
<div class="line">  <a class="code" href="kvredis_8c.html#a498efb0426f0d925e6cab0e7104812ae">cmdac</a>-&gt;ev.cleanup  = <a class="code" href="kvredis_8c.html#a93a6e6dd9f422d01eeaa03d6ba4738a0">cleanup</a>;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <a class="code" href="kvredis_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.fd = -1;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( redisAsyncCommand( <a class="code" href="kvredis_8c.html#a498efb0426f0d925e6cab0e7104812ae">cmdac</a>, NULL, NULL, <span class="stringliteral">&quot;KEYS *&quot;</span>) == REDIS_ERR) {</div>
<div class="line">    fprintf( stderr, <span class="stringliteral">&quot;Error sending KEYS command\n&quot;</span>);</div>
<div class="line">    exit( -1);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>( redisAsyncCommand( <a class="code" href="kvredis_8c.html#a4d65536cb1094fb5deda0a852b181232">subac</a>, <a class="code" href="kvredis_8c.html#a5dbdf77c680c97996882abbb6a142321">debugCB</a>, NULL, <span class="stringliteral">&quot;PSUBSCRIBE MD2* UI*&quot;</span>) == REDIS_ERR) {</div>
<div class="line">    fprintf( stderr, <span class="stringliteral">&quot;Error sending PSUBSCRIBE command\n&quot;</span>);</div>
<div class="line">    exit( -1);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( <a class="code" href="kvredis_8c.html#afb8d1ff1e0f4fcdc85ad9c684271cb3d">lspg_allkvs_cb</a>, <span class="stringliteral">&quot;SELECT * FROM px.redis_kv_init()&quot;</span>);</div>
<div class="line">  <a class="code" href="kvredis_8c.html#a0bb9ef42da8fa21c4df48ec384ab69f4" title="Place a query on the queue.">lspg_query_push</a>( NULL, <span class="stringliteral">&quot;LISTEN REDIS_KV_CONNECTOR&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span>( 1) {</div>
<div class="line">    nfda = 0;</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a0cd3bdc79d035eb1595371c845d14367" title="poll info for redis subscribe channel">subfd</a>.fd != -1) {</div>
<div class="line">      fda[nfda].fd      = <a class="code" href="kvredis_8c.html#a0cd3bdc79d035eb1595371c845d14367" title="poll info for redis subscribe channel">subfd</a>.fd;</div>
<div class="line">      fda[nfda].events  = <a class="code" href="kvredis_8c.html#a0cd3bdc79d035eb1595371c845d14367" title="poll info for redis subscribe channel">subfd</a>.events;</div>
<div class="line">      fda[nfda].revents = 0;</div>
<div class="line"></div>
<div class="line">      nfda++;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#a9b0e607f794ed78360d09a52bb4feaef" title="poll info for redis command channel">cmdfd</a>.fd != -1) {</div>
<div class="line">      fda[nfda].fd      = <a class="code" href="kvredis_8c.html#a9b0e607f794ed78360d09a52bb4feaef" title="poll info for redis command channel">cmdfd</a>.fd;</div>
<div class="line">      fda[nfda].events  = <a class="code" href="kvredis_8c.html#a9b0e607f794ed78360d09a52bb4feaef" title="poll info for redis command channel">cmdfd</a>.events;</div>
<div class="line">      fda[nfda].revents = 0;</div>
<div class="line">      </div>
<div class="line">      nfda++;</div>
<div class="line">    }</div>
<div class="line">    poll_timeout_ms = -1;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="kvredis_8c.html#ab52a8c8245bf6561f40c0f224fc07ff4" title="Implements our state machine Does not strictly only set the next state as it also calls some function...">lspg_next_state</a>();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="kvredis_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.fd == -1) {</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Here a connection to the database is not established.</span></div>
<div class="line">      <span class="comment">// Periodicaly try again.  Should possibly arrange to reconnect</span></div>
<div class="line">      <span class="comment">// to signalfd but that&#39;s unlikely to be nessesary.</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      poll_timeout_ms = 10000;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      <span class="comment">// Arrange to peacfully do nothing until either the pg server sends us something</span></div>
<div class="line">      <span class="comment">// or someone pushs something onto our queue</span></div>
<div class="line">      <span class="comment">//</span></div>
<div class="line">      fda[nfda].fd      = <a class="code" href="kvredis_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.fd;</div>
<div class="line">      fda[nfda].events  = <a class="code" href="kvredis_8c.html#af3f897b8ffa020ca54289bc5b28cb64d" title="our poll info">lspgfd</a>.events;</div>
<div class="line">      fda[nfda].revents = 0;</div>
<div class="line">      nfda++;</div>
<div class="line">      poll_timeout_ms = -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    pollrtn = poll( fda, nfda, poll_timeout_ms);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>( i=0; i&lt;nfda; i++) {</div>
<div class="line">      <span class="keywordflow">if</span>( fda[i].revents) {</div>
<div class="line">        <a class="code" href="kvredis_8c.html#a79856d1a06c278688563be6e5219cee5">fd_service</a>( &amp;(fda[i]));</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa1941e6515a254f76cfd1f18d3c8fac3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void redisDisconnectCB </td>
          <td>(</td>
          <td class="paramtype">const redisAsyncContext *&#160;</td>
          <td class="paramname"><em>ac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>status</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00054">54</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>
<div class="fragment"><div class="line">                                                                {</div>
<div class="line">  <span class="keywordflow">if</span>( status == REDIS_OK) {</div>
<div class="line">    printf( <span class="stringliteral">&quot;OK, that was fun.\n&quot;</span>);</div>
<div class="line">    exit( 0);</div>
<div class="line">  }</div>
<div class="line">  fprintf( stderr, <span class="stringliteral">&quot;Opps, Disconnected with status %d\n&quot;</span>, status);</div>
<div class="line">  exit( -1);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a498efb0426f0d925e6cab0e7104812ae"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">redisAsyncContext * cmdac</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00009">9</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9b0e607f794ed78360d09a52bb4feaef"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct pollfd cmdfd</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>poll info for redis command channel </p>

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00050">50</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6b15f24b2416f362a9e0039efc586fbb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int kvseq = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>used to synchronize pg.kvs and redis </p>

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00026">26</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a4937baac0cc78ea306d58b5f027867f1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int ls_pg_state = <a class="el" href="lspg_8c.html#af443092447378c73bf93aa143576aba4">LS_PG_STATE_INIT</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>State of the lspg state machine. </p>

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00024">24</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a69ae04978986e6413ca7cefcb692b645"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">PostgresPollingStatusType lspg_connectPoll_response</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Used to determine state while connecting. </p>

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00046">46</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a357d9d98f0b8c9625ccebcebfcdce955"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="kvredis_8c.html#ae57432c0a6ac48a50457815dab2c5b4c">lspg_query_queue_t</a> lspg_query_queue[<a class="el" href="lspg_8c.html#a08fe83fe8226002ee8b80ce0a914fd11">LS_PG_QUERY_QUEUE_LENGTH</a>]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Our query queue. </p>

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00037">37</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="aca86bb77d6cecfae9251743f4171bafb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int lspg_query_queue_off = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The last item still being used (on == off means nothing in queue) </p>

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00039">39</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3cbe7f3161b3c1838ebc56a3bbcfd8a6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int lspg_query_queue_on = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Next position to add something to the queue. </p>

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00038">38</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2603b071afdbff7c0924b13de2454264"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int lspg_query_queue_reply = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The current item being digested. </p>
<p>Normally off &lt;= reply &lt;= on. Corner case of queue wrap arround works because we only increment and compare for equality. </p>

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00040">40</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a06c5a937e41a6c706a247777642ec1fb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">PostgresPollingStatusType lspg_resetPoll_response</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Used to determine state while reconnecting. </p>

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00047">47</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="af3f897b8ffa020ca54289bc5b28cb64d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct pollfd lspgfd</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>our poll info </p>

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00048">48</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad40ac52086f6b774928af45b09d54c6e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct timeval lspg_time_sent now</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>used to ensure we do not inundate the db server with connection requests </p>

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00025">25</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9012783dbbadf652a81649a289697cf3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">PGconn* q = NULL</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Database connector. </p>

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00045">45</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a4d65536cb1094fb5deda0a852b181232"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">redisAsyncContext* subac</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00009">9</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>

</div>
</div>
<a class="anchor" id="a0cd3bdc79d035eb1595371c845d14367"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct pollfd subfd</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>poll info for redis subscribe channel </p>

<p>Definition at line <a class="el" href="kvredis_8c_source.html#l00049">49</a> of file <a class="el" href="kvredis_8c_source.html">kvredis.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="kvredis_8c.html">kvredis.c</a></li>
    <li class="footer">Generated on Mon Dec 24 2012 18:43:18 for LS-CAT PGPMAC by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 </li>
  </ul>
</div>
</body>
</html>
